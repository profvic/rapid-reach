var YD=Object.defineProperty;var WD=(g,y,T)=>y in g?YD(g,y,{enumerable:!0,configurable:!0,writable:!0,value:T}):g[y]=T;var bS=(g,y,T)=>WD(g,typeof y!="symbol"?y+"":y,T);function XD(g,y){for(var T=0;T<y.length;T++){const k=y[T];if(typeof k!="string"&&!Array.isArray(k)){for(const L in k)if(L!=="default"&&!(L in g)){const $=Object.getOwnPropertyDescriptor(k,L);$&&Object.defineProperty(g,L,$.get?$:{enumerable:!0,get:()=>k[L]})}}}return Object.freeze(Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}))}(function(){const y=document.createElement("link").relList;if(y&&y.supports&&y.supports("modulepreload"))return;for(const L of document.querySelectorAll('link[rel="modulepreload"]'))k(L);new MutationObserver(L=>{for(const $ of L)if($.type==="childList")for(const X of $.addedNodes)X.tagName==="LINK"&&X.rel==="modulepreload"&&k(X)}).observe(document,{childList:!0,subtree:!0});function T(L){const $={};return L.integrity&&($.integrity=L.integrity),L.referrerPolicy&&($.referrerPolicy=L.referrerPolicy),L.crossOrigin==="use-credentials"?$.credentials="include":L.crossOrigin==="anonymous"?$.credentials="omit":$.credentials="same-origin",$}function k(L){if(L.ep)return;L.ep=!0;const $=T(L);fetch(L.href,$)}})();function kw(g){return g&&g.__esModule&&Object.prototype.hasOwnProperty.call(g,"default")?g.default:g}var wS={exports:{}},G1={},SS={exports:{}},Zx={exports:{}};Zx.exports;var tE;function KD(){return tE||(tE=1,function(g,y){/**
 * @license React
 * react.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(){function T(xe,it){Object.defineProperty($.prototype,xe,{get:function(){console.warn("%s(...) is deprecated in plain JavaScript React classes. %s",it[0],it[1])}})}function k(xe){return xe===null||typeof xe!="object"?null:(xe=po&&xe[po]||xe["@@iterator"],typeof xe=="function"?xe:null)}function L(xe,it){xe=(xe=xe.constructor)&&(xe.displayName||xe.name)||"ReactClass";var yn=xe+"."+it;Uo[yn]||(console.error("Can't call %s on a component that is not yet mounted. This is a no-op, but it might indicate a bug in your application. Instead, assign to `this.state` directly or define a `state = {};` class property with the desired state in the %s component.",it,xe),Uo[yn]=!0)}function $(xe,it,yn){this.props=xe,this.context=it,this.refs=cs,this.updater=yn||ls}function X(){}function a(xe,it,yn){this.props=xe,this.context=it,this.refs=cs,this.updater=yn||ls}function ee(xe){return""+xe}function se(xe){try{ee(xe);var it=!1}catch{it=!0}if(it){it=console;var yn=it.error,Sn=typeof Symbol=="function"&&Symbol.toStringTag&&xe[Symbol.toStringTag]||xe.constructor.name||"Object";return yn.call(it,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",Sn),ee(xe)}}function fe(xe){if(xe==null)return null;if(typeof xe=="function")return xe.$$typeof===Wi?null:xe.displayName||xe.name||null;if(typeof xe=="string")return xe;switch(xe){case tt:return"Fragment";case pn:return"Profiler";case un:return"StrictMode";case rr:return"Suspense";case kr:return"SuspenseList";case de:return"Activity"}if(typeof xe=="object")switch(typeof xe.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),xe.$$typeof){case sn:return"Portal";case ir:return(xe.displayName||"Context")+".Provider";case Vt:return(xe._context.displayName||"Context")+".Consumer";case Nr:var it=xe.render;return xe=xe.displayName,xe||(xe=it.displayName||it.name||"",xe=xe!==""?"ForwardRef("+xe+")":"ForwardRef"),xe;case sr:return it=xe.displayName||null,it!==null?it:fe(xe.type)||"Memo";case Yr:it=xe._payload,xe=xe._init;try{return fe(xe(it))}catch{}}return null}function ge(xe){if(xe===tt)return"<>";if(typeof xe=="object"&&xe!==null&&xe.$$typeof===Yr)return"<...>";try{var it=fe(xe);return it?"<"+it+">":"<...>"}catch{return"<...>"}}function le(){var xe=dr.A;return xe===null?null:xe.getOwner()}function ke(){return Error("react-stack-top-frame")}function Re(xe){if(ea.call(xe,"key")){var it=Object.getOwnPropertyDescriptor(xe,"key").get;if(it&&it.isReactWarning)return!1}return xe.key!==void 0}function Ue(xe,it){function yn(){ta||(ta=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",it))}yn.isReactWarning=!0,Object.defineProperty(xe,"key",{get:yn,configurable:!0})}function Pe(){var xe=fe(this.type);return mo[xe]||(mo[xe]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),xe=this.props.ref,xe!==void 0?xe:null}function We(xe,it,yn,Sn,kn,br,wr,Br){return yn=br.ref,xe={$$typeof:It,type:xe,key:it,props:br,_owner:kn},(yn!==void 0?yn:null)!==null?Object.defineProperty(xe,"ref",{enumerable:!1,get:Pe}):Object.defineProperty(xe,"ref",{enumerable:!1,value:null}),xe._store={},Object.defineProperty(xe._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(xe,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(xe,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:wr}),Object.defineProperty(xe,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:Br}),Object.freeze&&(Object.freeze(xe.props),Object.freeze(xe)),xe}function Tt(xe,it){return it=We(xe.type,it,void 0,void 0,xe._owner,xe.props,xe._debugStack,xe._debugTask),xe._store&&(it._store.validated=xe._store.validated),it}function wt(xe){return typeof xe=="object"&&xe!==null&&xe.$$typeof===It}function St(xe){var it={"=":"=0",":":"=2"};return"$"+xe.replace(/[=:]/g,function(yn){return it[yn]})}function Xt(xe,it){return typeof xe=="object"&&xe!==null&&xe.key!=null?(se(xe.key),St(""+xe.key)):it.toString(36)}function cn(){}function xt(xe){switch(xe.status){case"fulfilled":return xe.value;case"rejected":throw xe.reason;default:switch(typeof xe.status=="string"?xe.then(cn,cn):(xe.status="pending",xe.then(function(it){xe.status==="pending"&&(xe.status="fulfilled",xe.value=it)},function(it){xe.status==="pending"&&(xe.status="rejected",xe.reason=it)})),xe.status){case"fulfilled":return xe.value;case"rejected":throw xe.reason}}throw xe}function rn(xe,it,yn,Sn,kn){var br=typeof xe;(br==="undefined"||br==="boolean")&&(xe=null);var wr=!1;if(xe===null)wr=!0;else switch(br){case"bigint":case"string":case"number":wr=!0;break;case"object":switch(xe.$$typeof){case It:case sn:wr=!0;break;case Yr:return wr=xe._init,rn(wr(xe._payload),it,yn,Sn,kn)}}if(wr){wr=xe,kn=kn(wr);var Br=Sn===""?"."+Xt(wr,0):Sn;return Jn(kn)?(yn="",Br!=null&&(yn=Br.replace(na,"$&/")+"/"),rn(kn,it,yn,"",function(no){return no})):kn!=null&&(wt(kn)&&(kn.key!=null&&(wr&&wr.key===kn.key||se(kn.key)),yn=Tt(kn,yn+(kn.key==null||wr&&wr.key===kn.key?"":(""+kn.key).replace(na,"$&/")+"/")+Br),Sn!==""&&wr!=null&&wt(wr)&&wr.key==null&&wr._store&&!wr._store.validated&&(yn._store.validated=2),kn=yn),it.push(kn)),1}if(wr=0,Br=Sn===""?".":Sn+":",Jn(xe))for(var Er=0;Er<xe.length;Er++)Sn=xe[Er],br=Br+Xt(Sn,Er),wr+=rn(Sn,it,yn,br,kn);else if(Er=k(xe),typeof Er=="function")for(Er===xe.entries&&(ao||console.warn("Using Maps as children is not supported. Use an array of keyed ReactElements instead."),ao=!0),xe=Er.call(xe),Er=0;!(Sn=xe.next()).done;)Sn=Sn.value,br=Br+Xt(Sn,Er++),wr+=rn(Sn,it,yn,br,kn);else if(br==="object"){if(typeof xe.then=="function")return rn(xt(xe),it,yn,Sn,kn);throw it=String(xe),Error("Objects are not valid as a React child (found: "+(it==="[object Object]"?"object with keys {"+Object.keys(xe).join(", ")+"}":it)+"). If you meant to render a collection of children, use an array instead.")}return wr}function Ut(xe,it,yn){if(xe==null)return xe;var Sn=[],kn=0;return rn(xe,Sn,"","",function(br){return it.call(yn,br,kn++)}),Sn}function Yt(xe){if(xe._status===-1){var it=xe._result;it=it(),it.then(function(yn){(xe._status===0||xe._status===-1)&&(xe._status=1,xe._result=yn)},function(yn){(xe._status===0||xe._status===-1)&&(xe._status=2,xe._result=yn)}),xe._status===-1&&(xe._status=0,xe._result=it)}if(xe._status===1)return it=xe._result,it===void 0&&console.error(`lazy: Expected the result of a dynamic import() call. Instead received: %s

Your code should look like: 
  const MyComponent = lazy(() => import('./MyComponent'))

Did you accidentally put curly braces around the import?`,it),"default"in it||console.error(`lazy: Expected the result of a dynamic import() call. Instead received: %s

Your code should look like: 
  const MyComponent = lazy(() => import('./MyComponent'))`,it),it.default;throw xe._result}function Rt(){var xe=dr.H;return xe===null&&console.error(`Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:
1. You might have mismatching versions of React and the renderer (such as React DOM)
2. You might be breaking the Rules of Hooks
3. You might have more than one copy of React in the same app
See https://react.dev/link/invalid-hook-call for tips about how to debug and fix this problem.`),xe}function ln(){}function An(xe){if(bl===null)try{var it=("require"+Math.random()).slice(0,7);bl=(g&&g[it]).call(g,"timers").setImmediate}catch{bl=function(Sn){lc===!1&&(lc=!0,typeof MessageChannel>"u"&&console.error("This browser does not have a MessageChannel implementation, so enqueuing tasks via await act(async () => ...) will fail. Please file an issue at https://github.com/facebook/react/issues if you encounter this warning."));var kn=new MessageChannel;kn.port1.onmessage=Sn,kn.port2.postMessage(void 0)}}return bl(xe)}function mn(xe){return 1<xe.length&&typeof AggregateError=="function"?new AggregateError(xe):xe[0]}function $t(xe,it){it!==ks-1&&console.error("You seem to have overlapping act() calls, this is not supported. Be sure to await previous act() calls before making a new one. "),ks=it}function Nt(xe,it,yn){var Sn=dr.actQueue;if(Sn!==null)if(Sn.length!==0)try{Kt(Sn),An(function(){return Nt(xe,it,yn)});return}catch(kn){dr.thrownErrors.push(kn)}else dr.actQueue=null;0<dr.thrownErrors.length?(Sn=mn(dr.thrownErrors),dr.thrownErrors.length=0,yn(Sn)):it(xe)}function Kt(xe){if(!qi){qi=!0;var it=0;try{for(;it<xe.length;it++){var yn=xe[it];do{dr.didUsePromise=!1;var Sn=yn(!1);if(Sn!==null){if(dr.didUsePromise){xe[it]=yn,xe.splice(0,it);return}yn=Sn}else break}while(!0)}xe.length=0}catch(kn){xe.splice(0,it+1),dr.thrownErrors.push(kn)}finally{qi=!1}}}typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var It=Symbol.for("react.transitional.element"),sn=Symbol.for("react.portal"),tt=Symbol.for("react.fragment"),un=Symbol.for("react.strict_mode"),pn=Symbol.for("react.profiler"),Vt=Symbol.for("react.consumer"),ir=Symbol.for("react.context"),Nr=Symbol.for("react.forward_ref"),rr=Symbol.for("react.suspense"),kr=Symbol.for("react.suspense_list"),sr=Symbol.for("react.memo"),Yr=Symbol.for("react.lazy"),de=Symbol.for("react.activity"),po=Symbol.iterator,Uo={},ls={isMounted:function(){return!1},enqueueForceUpdate:function(xe){L(xe,"forceUpdate")},enqueueReplaceState:function(xe){L(xe,"replaceState")},enqueueSetState:function(xe){L(xe,"setState")}},qt=Object.assign,cs={};Object.freeze(cs),$.prototype.isReactComponent={},$.prototype.setState=function(xe,it){if(typeof xe!="object"&&typeof xe!="function"&&xe!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,xe,it,"setState")},$.prototype.forceUpdate=function(xe){this.updater.enqueueForceUpdate(this,xe,"forceUpdate")};var ti={isMounted:["isMounted","Instead, make sure to clean up subscriptions and pending requests in componentWillUnmount to prevent memory leaks."],replaceState:["replaceState","Refactor your code to use setState instead (see https://github.com/facebook/react/issues/3236)."]},Do;for(Do in ti)ti.hasOwnProperty(Do)&&T(Do,ti[Do]);X.prototype=$.prototype,ti=a.prototype=new X,ti.constructor=a,qt(ti,$.prototype),ti.isPureReactComponent=!0;var Jn=Array.isArray,Wi=Symbol.for("react.client.reference"),dr={H:null,A:null,T:null,S:null,V:null,actQueue:null,isBatchingLegacy:!1,didScheduleLegacyUpdate:!1,didUsePromise:!1,thrownErrors:[],getCurrentStack:null,recentlyCreatedOwnerStacks:0},ea=Object.prototype.hasOwnProperty,Rs=console.createTask?console.createTask:function(){return null};ti={"react-stack-bottom-frame":function(xe){return xe()}};var ta,$n,mo={},Fa=ti["react-stack-bottom-frame"].bind(ti,ke)(),Ua=Rs(ge(ke)),ao=!1,na=/\/+/g,us=typeof reportError=="function"?reportError:function(xe){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var it=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof xe=="object"&&xe!==null&&typeof xe.message=="string"?String(xe.message):String(xe),error:xe});if(!window.dispatchEvent(it))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",xe);return}console.error(xe)},lc=!1,bl=null,ks=0,jo=!1,qi=!1,ra=typeof queueMicrotask=="function"?function(xe){queueMicrotask(function(){return queueMicrotask(xe)})}:An;ti=Object.freeze({__proto__:null,c:function(xe){return Rt().useMemoCache(xe)}}),y.Children={map:Ut,forEach:function(xe,it,yn){Ut(xe,function(){it.apply(this,arguments)},yn)},count:function(xe){var it=0;return Ut(xe,function(){it++}),it},toArray:function(xe){return Ut(xe,function(it){return it})||[]},only:function(xe){if(!wt(xe))throw Error("React.Children.only expected to receive a single React element child.");return xe}},y.Component=$,y.Fragment=tt,y.Profiler=pn,y.PureComponent=a,y.StrictMode=un,y.Suspense=rr,y.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=dr,y.__COMPILER_RUNTIME=ti,y.act=function(xe){var it=dr.actQueue,yn=ks;ks++;var Sn=dr.actQueue=it!==null?it:[],kn=!1;try{var br=xe()}catch(Er){dr.thrownErrors.push(Er)}if(0<dr.thrownErrors.length)throw $t(it,yn),xe=mn(dr.thrownErrors),dr.thrownErrors.length=0,xe;if(br!==null&&typeof br=="object"&&typeof br.then=="function"){var wr=br;return ra(function(){kn||jo||(jo=!0,console.error("You called act(async () => ...) without await. This could lead to unexpected testing behaviour, interleaving multiple act calls and mixing their scopes. You should - await act(async () => ...);"))}),{then:function(Er,no){kn=!0,wr.then(function(ia){if($t(it,yn),yn===0){try{Kt(Sn),An(function(){return Nt(ia,Er,no)})}catch(ie){dr.thrownErrors.push(ie)}if(0<dr.thrownErrors.length){var ut=mn(dr.thrownErrors);dr.thrownErrors.length=0,no(ut)}}else Er(ia)},function(ia){$t(it,yn),0<dr.thrownErrors.length&&(ia=mn(dr.thrownErrors),dr.thrownErrors.length=0),no(ia)})}}}var Br=br;if($t(it,yn),yn===0&&(Kt(Sn),Sn.length!==0&&ra(function(){kn||jo||(jo=!0,console.error("A component suspended inside an `act` scope, but the `act` call was not awaited. When testing React components that depend on asynchronous data, you must await the result:\n\nawait act(() => ...)"))}),dr.actQueue=null),0<dr.thrownErrors.length)throw xe=mn(dr.thrownErrors),dr.thrownErrors.length=0,xe;return{then:function(Er,no){kn=!0,yn===0?(dr.actQueue=Sn,An(function(){return Nt(Br,Er,no)})):Er(Br)}}},y.cache=function(xe){return function(){return xe.apply(null,arguments)}},y.captureOwnerStack=function(){var xe=dr.getCurrentStack;return xe===null?null:xe()},y.cloneElement=function(xe,it,yn){if(xe==null)throw Error("The argument must be a React element, but you passed "+xe+".");var Sn=qt({},xe.props),kn=xe.key,br=xe._owner;if(it!=null){var wr;e:{if(ea.call(it,"ref")&&(wr=Object.getOwnPropertyDescriptor(it,"ref").get)&&wr.isReactWarning){wr=!1;break e}wr=it.ref!==void 0}wr&&(br=le()),Re(it)&&(se(it.key),kn=""+it.key);for(Br in it)!ea.call(it,Br)||Br==="key"||Br==="__self"||Br==="__source"||Br==="ref"&&it.ref===void 0||(Sn[Br]=it[Br])}var Br=arguments.length-2;if(Br===1)Sn.children=yn;else if(1<Br){wr=Array(Br);for(var Er=0;Er<Br;Er++)wr[Er]=arguments[Er+2];Sn.children=wr}for(Sn=We(xe.type,kn,void 0,void 0,br,Sn,xe._debugStack,xe._debugTask),kn=2;kn<arguments.length;kn++)br=arguments[kn],wt(br)&&br._store&&(br._store.validated=1);return Sn},y.createContext=function(xe){return xe={$$typeof:ir,_currentValue:xe,_currentValue2:xe,_threadCount:0,Provider:null,Consumer:null},xe.Provider=xe,xe.Consumer={$$typeof:Vt,_context:xe},xe._currentRenderer=null,xe._currentRenderer2=null,xe},y.createElement=function(xe,it,yn){for(var Sn=2;Sn<arguments.length;Sn++){var kn=arguments[Sn];wt(kn)&&kn._store&&(kn._store.validated=1)}if(Sn={},kn=null,it!=null)for(Er in $n||!("__self"in it)||"key"in it||($n=!0,console.warn("Your app (or one of its dependencies) is using an outdated JSX transform. Update to the modern JSX transform for faster performance: https://react.dev/link/new-jsx-transform")),Re(it)&&(se(it.key),kn=""+it.key),it)ea.call(it,Er)&&Er!=="key"&&Er!=="__self"&&Er!=="__source"&&(Sn[Er]=it[Er]);var br=arguments.length-2;if(br===1)Sn.children=yn;else if(1<br){for(var wr=Array(br),Br=0;Br<br;Br++)wr[Br]=arguments[Br+2];Object.freeze&&Object.freeze(wr),Sn.children=wr}if(xe&&xe.defaultProps)for(Er in br=xe.defaultProps,br)Sn[Er]===void 0&&(Sn[Er]=br[Er]);kn&&Ue(Sn,typeof xe=="function"?xe.displayName||xe.name||"Unknown":xe);var Er=1e4>dr.recentlyCreatedOwnerStacks++;return We(xe,kn,void 0,void 0,le(),Sn,Er?Error("react-stack-top-frame"):Fa,Er?Rs(ge(xe)):Ua)},y.createRef=function(){var xe={current:null};return Object.seal(xe),xe},y.forwardRef=function(xe){xe!=null&&xe.$$typeof===sr?console.error("forwardRef requires a render function but received a `memo` component. Instead of forwardRef(memo(...)), use memo(forwardRef(...))."):typeof xe!="function"?console.error("forwardRef requires a render function but was given %s.",xe===null?"null":typeof xe):xe.length!==0&&xe.length!==2&&console.error("forwardRef render functions accept exactly two parameters: props and ref. %s",xe.length===1?"Did you forget to use the ref parameter?":"Any additional parameter will be undefined."),xe!=null&&xe.defaultProps!=null&&console.error("forwardRef render functions do not support defaultProps. Did you accidentally pass a React component?");var it={$$typeof:Nr,render:xe},yn;return Object.defineProperty(it,"displayName",{enumerable:!1,configurable:!0,get:function(){return yn},set:function(Sn){yn=Sn,xe.name||xe.displayName||(Object.defineProperty(xe,"name",{value:Sn}),xe.displayName=Sn)}}),it},y.isValidElement=wt,y.lazy=function(xe){return{$$typeof:Yr,_payload:{_status:-1,_result:xe},_init:Yt}},y.memo=function(xe,it){xe==null&&console.error("memo: The first argument must be a component. Instead received: %s",xe===null?"null":typeof xe),it={$$typeof:sr,type:xe,compare:it===void 0?null:it};var yn;return Object.defineProperty(it,"displayName",{enumerable:!1,configurable:!0,get:function(){return yn},set:function(Sn){yn=Sn,xe.name||xe.displayName||(Object.defineProperty(xe,"name",{value:Sn}),xe.displayName=Sn)}}),it},y.startTransition=function(xe){var it=dr.T,yn={};dr.T=yn,yn._updatedFibers=new Set;try{var Sn=xe(),kn=dr.S;kn!==null&&kn(yn,Sn),typeof Sn=="object"&&Sn!==null&&typeof Sn.then=="function"&&Sn.then(ln,us)}catch(br){us(br)}finally{it===null&&yn._updatedFibers&&(xe=yn._updatedFibers.size,yn._updatedFibers.clear(),10<xe&&console.warn("Detected a large number of updates inside startTransition. If this is due to a subscription please re-write it to use React provided hooks. Otherwise concurrent mode guarantees are off the table.")),dr.T=it}},y.unstable_useCacheRefresh=function(){return Rt().useCacheRefresh()},y.use=function(xe){return Rt().use(xe)},y.useActionState=function(xe,it,yn){return Rt().useActionState(xe,it,yn)},y.useCallback=function(xe,it){return Rt().useCallback(xe,it)},y.useContext=function(xe){var it=Rt();return xe.$$typeof===Vt&&console.error("Calling useContext(Context.Consumer) is not supported and will cause bugs. Did you mean to call useContext(Context) instead?"),it.useContext(xe)},y.useDebugValue=function(xe,it){return Rt().useDebugValue(xe,it)},y.useDeferredValue=function(xe,it){return Rt().useDeferredValue(xe,it)},y.useEffect=function(xe,it,yn){xe==null&&console.warn("React Hook useEffect requires an effect callback. Did you forget to pass a callback to the hook?");var Sn=Rt();if(typeof yn=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Sn.useEffect(xe,it)},y.useId=function(){return Rt().useId()},y.useImperativeHandle=function(xe,it,yn){return Rt().useImperativeHandle(xe,it,yn)},y.useInsertionEffect=function(xe,it){return xe==null&&console.warn("React Hook useInsertionEffect requires an effect callback. Did you forget to pass a callback to the hook?"),Rt().useInsertionEffect(xe,it)},y.useLayoutEffect=function(xe,it){return xe==null&&console.warn("React Hook useLayoutEffect requires an effect callback. Did you forget to pass a callback to the hook?"),Rt().useLayoutEffect(xe,it)},y.useMemo=function(xe,it){return Rt().useMemo(xe,it)},y.useOptimistic=function(xe,it){return Rt().useOptimistic(xe,it)},y.useReducer=function(xe,it,yn){return Rt().useReducer(xe,it,yn)},y.useRef=function(xe){return Rt().useRef(xe)},y.useState=function(xe){return Rt().useState(xe)},y.useSyncExternalStore=function(xe,it,yn){return Rt().useSyncExternalStore(xe,it,yn)},y.useTransition=function(){return Rt().useTransition()},y.version="19.1.0",typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())})()}(Zx,Zx.exports)),Zx.exports}var nE;function Zv(){return nE||(nE=1,SS.exports=KD()),SS.exports}var rE;function JD(){if(rE)return G1;rE=1;/**
 * @license React
 * react-jsx-dev-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */return function(){function g(tt){if(tt==null)return null;if(typeof tt=="function")return tt.$$typeof===Yt?null:tt.displayName||tt.name||null;if(typeof tt=="string")return tt;switch(tt){case Ue:return"Fragment";case We:return"Profiler";case Pe:return"StrictMode";case Xt:return"Suspense";case cn:return"SuspenseList";case Ut:return"Activity"}if(typeof tt=="object")switch(typeof tt.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),tt.$$typeof){case Re:return"Portal";case wt:return(tt.displayName||"Context")+".Provider";case Tt:return(tt._context.displayName||"Context")+".Consumer";case St:var un=tt.render;return tt=tt.displayName,tt||(tt=un.displayName||un.name||"",tt=tt!==""?"ForwardRef("+tt+")":"ForwardRef"),tt;case xt:return un=tt.displayName||null,un!==null?un:g(tt.type)||"Memo";case rn:un=tt._payload,tt=tt._init;try{return g(tt(un))}catch{}}return null}function y(tt){return""+tt}function T(tt){try{y(tt);var un=!1}catch{un=!0}if(un){un=console;var pn=un.error,Vt=typeof Symbol=="function"&&Symbol.toStringTag&&tt[Symbol.toStringTag]||tt.constructor.name||"Object";return pn.call(un,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",Vt),y(tt)}}function k(tt){if(tt===Ue)return"<>";if(typeof tt=="object"&&tt!==null&&tt.$$typeof===rn)return"<...>";try{var un=g(tt);return un?"<"+un+">":"<...>"}catch{return"<...>"}}function L(){var tt=Rt.A;return tt===null?null:tt.getOwner()}function $(){return Error("react-stack-top-frame")}function X(tt){if(ln.call(tt,"key")){var un=Object.getOwnPropertyDescriptor(tt,"key").get;if(un&&un.isReactWarning)return!1}return tt.key!==void 0}function a(tt,un){function pn(){$t||($t=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",un))}pn.isReactWarning=!0,Object.defineProperty(tt,"key",{get:pn,configurable:!0})}function ee(){var tt=g(this.type);return Nt[tt]||(Nt[tt]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),tt=this.props.ref,tt!==void 0?tt:null}function se(tt,un,pn,Vt,ir,Nr,rr,kr){return pn=Nr.ref,tt={$$typeof:ke,type:tt,key:un,props:Nr,_owner:ir},(pn!==void 0?pn:null)!==null?Object.defineProperty(tt,"ref",{enumerable:!1,get:ee}):Object.defineProperty(tt,"ref",{enumerable:!1,value:null}),tt._store={},Object.defineProperty(tt._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(tt,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(tt,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:rr}),Object.defineProperty(tt,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:kr}),Object.freeze&&(Object.freeze(tt.props),Object.freeze(tt)),tt}function fe(tt,un,pn,Vt,ir,Nr,rr,kr){var sr=un.children;if(sr!==void 0)if(Vt)if(An(sr)){for(Vt=0;Vt<sr.length;Vt++)ge(sr[Vt]);Object.freeze&&Object.freeze(sr)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else ge(sr);if(ln.call(un,"key")){sr=g(tt);var Yr=Object.keys(un).filter(function(po){return po!=="key"});Vt=0<Yr.length?"{key: someKey, "+Yr.join(": ..., ")+": ...}":"{key: someKey}",sn[sr+Vt]||(Yr=0<Yr.length?"{"+Yr.join(": ..., ")+": ...}":"{}",console.error(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,Vt,sr,Yr,sr),sn[sr+Vt]=!0)}if(sr=null,pn!==void 0&&(T(pn),sr=""+pn),X(un)&&(T(un.key),sr=""+un.key),"key"in un){pn={};for(var de in un)de!=="key"&&(pn[de]=un[de])}else pn=un;return sr&&a(pn,typeof tt=="function"?tt.displayName||tt.name||"Unknown":tt),se(tt,sr,Nr,ir,L(),pn,rr,kr)}function ge(tt){typeof tt=="object"&&tt!==null&&tt.$$typeof===ke&&tt._store&&(tt._store.validated=1)}var le=Zv(),ke=Symbol.for("react.transitional.element"),Re=Symbol.for("react.portal"),Ue=Symbol.for("react.fragment"),Pe=Symbol.for("react.strict_mode"),We=Symbol.for("react.profiler"),Tt=Symbol.for("react.consumer"),wt=Symbol.for("react.context"),St=Symbol.for("react.forward_ref"),Xt=Symbol.for("react.suspense"),cn=Symbol.for("react.suspense_list"),xt=Symbol.for("react.memo"),rn=Symbol.for("react.lazy"),Ut=Symbol.for("react.activity"),Yt=Symbol.for("react.client.reference"),Rt=le.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ln=Object.prototype.hasOwnProperty,An=Array.isArray,mn=console.createTask?console.createTask:function(){return null};le={"react-stack-bottom-frame":function(tt){return tt()}};var $t,Nt={},Kt=le["react-stack-bottom-frame"].bind(le,$)(),It=mn(k($)),sn={};G1.Fragment=Ue,G1.jsxDEV=function(tt,un,pn,Vt,ir,Nr){var rr=1e4>Rt.recentlyCreatedOwnerStacks++;return fe(tt,un,pn,Vt,ir,Nr,rr?Error("react-stack-top-frame"):Kt,rr?mn(k(tt)):It)}}(),G1}var iE;function QD(){return iE||(iE=1,wS.exports=JD()),wS.exports}var he=QD(),Fe=Zv();const Np=kw(Fe),eM=XD({__proto__:null,default:Np},[Fe]);var TS={exports:{}},Ux={},ES={exports:{}},AS={},oE;function tM(){return oE||(oE=1,function(g){/**
 * @license React
 * scheduler.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(){function y(){if(Xt=!1,Ut){var Nt=g.unstable_now();ln=Nt;var Kt=!0;try{e:{wt=!1,St&&(St=!1,xt(Yt),Yt=-1),Tt=!0;var It=We;try{t:{for(X(Nt),Pe=k(ke);Pe!==null&&!(Pe.expirationTime>Nt&&ee());){var sn=Pe.callback;if(typeof sn=="function"){Pe.callback=null,We=Pe.priorityLevel;var tt=sn(Pe.expirationTime<=Nt);if(Nt=g.unstable_now(),typeof tt=="function"){Pe.callback=tt,X(Nt),Kt=!0;break t}Pe===k(ke)&&L(ke),X(Nt)}else L(ke);Pe=k(ke)}if(Pe!==null)Kt=!0;else{var un=k(Re);un!==null&&se(a,un.startTime-Nt),Kt=!1}}break e}finally{Pe=null,We=It,Tt=!1}Kt=void 0}}finally{Kt?An():Ut=!1}}}function T(Nt,Kt){var It=Nt.length;Nt.push(Kt);e:for(;0<It;){var sn=It-1>>>1,tt=Nt[sn];if(0<$(tt,Kt))Nt[sn]=Kt,Nt[It]=tt,It=sn;else break e}}function k(Nt){return Nt.length===0?null:Nt[0]}function L(Nt){if(Nt.length===0)return null;var Kt=Nt[0],It=Nt.pop();if(It!==Kt){Nt[0]=It;e:for(var sn=0,tt=Nt.length,un=tt>>>1;sn<un;){var pn=2*(sn+1)-1,Vt=Nt[pn],ir=pn+1,Nr=Nt[ir];if(0>$(Vt,It))ir<tt&&0>$(Nr,Vt)?(Nt[sn]=Nr,Nt[ir]=It,sn=ir):(Nt[sn]=Vt,Nt[pn]=It,sn=pn);else if(ir<tt&&0>$(Nr,It))Nt[sn]=Nr,Nt[ir]=It,sn=ir;else break e}}return Kt}function $(Nt,Kt){var It=Nt.sortIndex-Kt.sortIndex;return It!==0?It:Nt.id-Kt.id}function X(Nt){for(var Kt=k(Re);Kt!==null;){if(Kt.callback===null)L(Re);else if(Kt.startTime<=Nt)L(Re),Kt.sortIndex=Kt.expirationTime,T(ke,Kt);else break;Kt=k(Re)}}function a(Nt){if(St=!1,X(Nt),!wt)if(k(ke)!==null)wt=!0,Ut||(Ut=!0,An());else{var Kt=k(Re);Kt!==null&&se(a,Kt.startTime-Nt)}}function ee(){return Xt?!0:!(g.unstable_now()-ln<Rt)}function se(Nt,Kt){Yt=cn(function(){Nt(g.unstable_now())},Kt)}if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error()),g.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var fe=performance;g.unstable_now=function(){return fe.now()}}else{var ge=Date,le=ge.now();g.unstable_now=function(){return ge.now()-le}}var ke=[],Re=[],Ue=1,Pe=null,We=3,Tt=!1,wt=!1,St=!1,Xt=!1,cn=typeof setTimeout=="function"?setTimeout:null,xt=typeof clearTimeout=="function"?clearTimeout:null,rn=typeof setImmediate<"u"?setImmediate:null,Ut=!1,Yt=-1,Rt=5,ln=-1;if(typeof rn=="function")var An=function(){rn(y)};else if(typeof MessageChannel<"u"){var mn=new MessageChannel,$t=mn.port2;mn.port1.onmessage=y,An=function(){$t.postMessage(null)}}else An=function(){cn(y,0)};g.unstable_IdlePriority=5,g.unstable_ImmediatePriority=1,g.unstable_LowPriority=4,g.unstable_NormalPriority=3,g.unstable_Profiling=null,g.unstable_UserBlockingPriority=2,g.unstable_cancelCallback=function(Nt){Nt.callback=null},g.unstable_forceFrameRate=function(Nt){0>Nt||125<Nt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Rt=0<Nt?Math.floor(1e3/Nt):5},g.unstable_getCurrentPriorityLevel=function(){return We},g.unstable_next=function(Nt){switch(We){case 1:case 2:case 3:var Kt=3;break;default:Kt=We}var It=We;We=Kt;try{return Nt()}finally{We=It}},g.unstable_requestPaint=function(){Xt=!0},g.unstable_runWithPriority=function(Nt,Kt){switch(Nt){case 1:case 2:case 3:case 4:case 5:break;default:Nt=3}var It=We;We=Nt;try{return Kt()}finally{We=It}},g.unstable_scheduleCallback=function(Nt,Kt,It){var sn=g.unstable_now();switch(typeof It=="object"&&It!==null?(It=It.delay,It=typeof It=="number"&&0<It?sn+It:sn):It=sn,Nt){case 1:var tt=-1;break;case 2:tt=250;break;case 5:tt=1073741823;break;case 4:tt=1e4;break;default:tt=5e3}return tt=It+tt,Nt={id:Ue++,callback:Kt,priorityLevel:Nt,startTime:It,expirationTime:tt,sortIndex:-1},It>sn?(Nt.sortIndex=It,T(Re,Nt),k(ke)===null&&Nt===k(Re)&&(St?(xt(Yt),Yt=-1):St=!0,se(a,It-sn))):(Nt.sortIndex=tt,T(ke,Nt),wt||Tt||(wt=!0,Ut||(Ut=!0,An()))),Nt},g.unstable_shouldYield=ee,g.unstable_wrapCallback=function(Nt){var Kt=We;return function(){var It=We;We=Kt;try{return Nt.apply(this,arguments)}finally{We=It}}},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())})()}(AS)),AS}var sE;function nM(){return sE||(sE=1,ES.exports=tM()),ES.exports}var CS={exports:{}},Pa={},aE;function rM(){if(aE)return Pa;aE=1;/**
 * @license React
 * react-dom.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */return function(){function g(){}function y(ge){return""+ge}function T(ge,le,ke){var Re=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;try{y(Re);var Ue=!1}catch{Ue=!0}return Ue&&(console.error("The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",typeof Symbol=="function"&&Symbol.toStringTag&&Re[Symbol.toStringTag]||Re.constructor.name||"Object"),y(Re)),{$$typeof:se,key:Re==null?null:""+Re,children:ge,containerInfo:le,implementation:ke}}function k(ge,le){if(ge==="font")return"";if(typeof le=="string")return le==="use-credentials"?le:""}function L(ge){return ge===null?"`null`":ge===void 0?"`undefined`":ge===""?"an empty string":'something with type "'+typeof ge+'"'}function $(ge){return ge===null?"`null`":ge===void 0?"`undefined`":ge===""?"an empty string":typeof ge=="string"?JSON.stringify(ge):typeof ge=="number"?"`"+ge+"`":'something with type "'+typeof ge+'"'}function X(){var ge=fe.H;return ge===null&&console.error(`Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:
1. You might have mismatching versions of React and the renderer (such as React DOM)
2. You might be breaking the Rules of Hooks
3. You might have more than one copy of React in the same app
See https://react.dev/link/invalid-hook-call for tips about how to debug and fix this problem.`),ge}typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var a=Zv(),ee={d:{f:g,r:function(){throw Error("Invalid form element. requestFormReset must be passed a form that was rendered by React.")},D:g,C:g,L:g,m:g,X:g,S:g,M:g},p:0,findDOMNode:null},se=Symbol.for("react.portal"),fe=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;typeof Map=="function"&&Map.prototype!=null&&typeof Map.prototype.forEach=="function"&&typeof Set=="function"&&Set.prototype!=null&&typeof Set.prototype.clear=="function"&&typeof Set.prototype.forEach=="function"||console.error("React depends on Map and Set built-in types. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),Pa.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ee,Pa.createPortal=function(ge,le){var ke=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!le||le.nodeType!==1&&le.nodeType!==9&&le.nodeType!==11)throw Error("Target container is not a DOM element.");return T(ge,le,null,ke)},Pa.flushSync=function(ge){var le=fe.T,ke=ee.p;try{if(fe.T=null,ee.p=2,ge)return ge()}finally{fe.T=le,ee.p=ke,ee.d.f()&&console.error("flushSync was called from inside a lifecycle method. React cannot flush when React is already rendering. Consider moving this call to a scheduler task or micro task.")}},Pa.preconnect=function(ge,le){typeof ge=="string"&&ge?le!=null&&typeof le!="object"?console.error("ReactDOM.preconnect(): Expected the `options` argument (second) to be an object but encountered %s instead. The only supported option at this time is `crossOrigin` which accepts a string.",$(le)):le!=null&&typeof le.crossOrigin!="string"&&console.error("ReactDOM.preconnect(): Expected the `crossOrigin` option (second argument) to be a string but encountered %s instead. Try removing this option or passing a string value instead.",L(le.crossOrigin)):console.error("ReactDOM.preconnect(): Expected the `href` argument (first) to be a non-empty string but encountered %s instead.",L(ge)),typeof ge=="string"&&(le?(le=le.crossOrigin,le=typeof le=="string"?le==="use-credentials"?le:"":void 0):le=null,ee.d.C(ge,le))},Pa.prefetchDNS=function(ge){if(typeof ge!="string"||!ge)console.error("ReactDOM.prefetchDNS(): Expected the `href` argument (first) to be a non-empty string but encountered %s instead.",L(ge));else if(1<arguments.length){var le=arguments[1];typeof le=="object"&&le.hasOwnProperty("crossOrigin")?console.error("ReactDOM.prefetchDNS(): Expected only one argument, `href`, but encountered %s as a second argument instead. This argument is reserved for future options and is currently disallowed. It looks like the you are attempting to set a crossOrigin property for this DNS lookup hint. Browsers do not perform DNS queries using CORS and setting this attribute on the resource hint has no effect. Try calling ReactDOM.prefetchDNS() with just a single string argument, `href`.",$(le)):console.error("ReactDOM.prefetchDNS(): Expected only one argument, `href`, but encountered %s as a second argument instead. This argument is reserved for future options and is currently disallowed. Try calling ReactDOM.prefetchDNS() with just a single string argument, `href`.",$(le))}typeof ge=="string"&&ee.d.D(ge)},Pa.preinit=function(ge,le){if(typeof ge=="string"&&ge?le==null||typeof le!="object"?console.error("ReactDOM.preinit(): Expected the `options` argument (second) to be an object with an `as` property describing the type of resource to be preinitialized but encountered %s instead.",$(le)):le.as!=="style"&&le.as!=="script"&&console.error('ReactDOM.preinit(): Expected the `as` property in the `options` argument (second) to contain a valid value describing the type of resource to be preinitialized but encountered %s instead. Valid values for `as` are "style" and "script".',$(le.as)):console.error("ReactDOM.preinit(): Expected the `href` argument (first) to be a non-empty string but encountered %s instead.",L(ge)),typeof ge=="string"&&le&&typeof le.as=="string"){var ke=le.as,Re=k(ke,le.crossOrigin),Ue=typeof le.integrity=="string"?le.integrity:void 0,Pe=typeof le.fetchPriority=="string"?le.fetchPriority:void 0;ke==="style"?ee.d.S(ge,typeof le.precedence=="string"?le.precedence:void 0,{crossOrigin:Re,integrity:Ue,fetchPriority:Pe}):ke==="script"&&ee.d.X(ge,{crossOrigin:Re,integrity:Ue,fetchPriority:Pe,nonce:typeof le.nonce=="string"?le.nonce:void 0})}},Pa.preinitModule=function(ge,le){var ke="";if(typeof ge=="string"&&ge||(ke+=" The `href` argument encountered was "+L(ge)+"."),le!==void 0&&typeof le!="object"?ke+=" The `options` argument encountered was "+L(le)+".":le&&"as"in le&&le.as!=="script"&&(ke+=" The `as` option encountered was "+$(le.as)+"."),ke)console.error("ReactDOM.preinitModule(): Expected up to two arguments, a non-empty `href` string and, optionally, an `options` object with a valid `as` property.%s",ke);else switch(ke=le&&typeof le.as=="string"?le.as:"script",ke){case"script":break;default:ke=$(ke),console.error('ReactDOM.preinitModule(): Currently the only supported "as" type for this function is "script" but received "%s" instead. This warning was generated for `href` "%s". In the future other module types will be supported, aligning with the import-attributes proposal. Learn more here: (https://github.com/tc39/proposal-import-attributes)',ke,ge)}typeof ge=="string"&&(typeof le=="object"&&le!==null?(le.as==null||le.as==="script")&&(ke=k(le.as,le.crossOrigin),ee.d.M(ge,{crossOrigin:ke,integrity:typeof le.integrity=="string"?le.integrity:void 0,nonce:typeof le.nonce=="string"?le.nonce:void 0})):le==null&&ee.d.M(ge))},Pa.preload=function(ge,le){var ke="";if(typeof ge=="string"&&ge||(ke+=" The `href` argument encountered was "+L(ge)+"."),le==null||typeof le!="object"?ke+=" The `options` argument encountered was "+L(le)+".":typeof le.as=="string"&&le.as||(ke+=" The `as` option encountered was "+L(le.as)+"."),ke&&console.error('ReactDOM.preload(): Expected two arguments, a non-empty `href` string and an `options` object with an `as` property valid for a `<link rel="preload" as="..." />` tag.%s',ke),typeof ge=="string"&&typeof le=="object"&&le!==null&&typeof le.as=="string"){ke=le.as;var Re=k(ke,le.crossOrigin);ee.d.L(ge,ke,{crossOrigin:Re,integrity:typeof le.integrity=="string"?le.integrity:void 0,nonce:typeof le.nonce=="string"?le.nonce:void 0,type:typeof le.type=="string"?le.type:void 0,fetchPriority:typeof le.fetchPriority=="string"?le.fetchPriority:void 0,referrerPolicy:typeof le.referrerPolicy=="string"?le.referrerPolicy:void 0,imageSrcSet:typeof le.imageSrcSet=="string"?le.imageSrcSet:void 0,imageSizes:typeof le.imageSizes=="string"?le.imageSizes:void 0,media:typeof le.media=="string"?le.media:void 0})}},Pa.preloadModule=function(ge,le){var ke="";typeof ge=="string"&&ge||(ke+=" The `href` argument encountered was "+L(ge)+"."),le!==void 0&&typeof le!="object"?ke+=" The `options` argument encountered was "+L(le)+".":le&&"as"in le&&typeof le.as!="string"&&(ke+=" The `as` option encountered was "+L(le.as)+"."),ke&&console.error('ReactDOM.preloadModule(): Expected two arguments, a non-empty `href` string and, optionally, an `options` object with an `as` property valid for a `<link rel="modulepreload" as="..." />` tag.%s',ke),typeof ge=="string"&&(le?(ke=k(le.as,le.crossOrigin),ee.d.m(ge,{as:typeof le.as=="string"&&le.as!=="script"?le.as:void 0,crossOrigin:ke,integrity:typeof le.integrity=="string"?le.integrity:void 0})):ee.d.m(ge))},Pa.requestFormReset=function(ge){ee.d.r(ge)},Pa.unstable_batchedUpdates=function(ge,le){return ge(le)},Pa.useFormState=function(ge,le,ke){return X().useFormState(ge,le,ke)},Pa.useFormStatus=function(){return X().useHostTransitionStatus()},Pa.version="19.1.0",typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}(),Pa}var lE;function yA(){return lE||(lE=1,CS.exports=rM()),CS.exports}var cE;function iM(){if(cE)return Ux;cE=1;/**
 * @license React
 * react-dom-client.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */return function(){function g(n,o){for(n=n.memoizedState;n!==null&&0<o;)n=n.next,o--;return n}function y(n,o,p,b){if(p>=o.length)return b;var O=o[p],z=es(n)?n.slice():Fr({},n);return z[O]=y(n[O],o,p+1,b),z}function T(n,o,p){if(o.length!==p.length)console.warn("copyWithRename() expects paths of the same length");else{for(var b=0;b<p.length-1;b++)if(o[b]!==p[b]){console.warn("copyWithRename() expects paths to be the same except for the deepest key");return}return k(n,o,p,0)}}function k(n,o,p,b){var O=o[b],z=es(n)?n.slice():Fr({},n);return b+1===o.length?(z[p[b]]=z[O],es(z)?z.splice(O,1):delete z[O]):z[O]=k(n[O],o,p,b+1),z}function L(n,o,p){var b=o[p],O=es(n)?n.slice():Fr({},n);return p+1===o.length?(es(O)?O.splice(b,1):delete O[b],O):(O[b]=L(n[b],o,p+1),O)}function $(){return!1}function X(){return null}function a(){}function ee(){console.error("Do not call Hooks inside useEffect(...), useMemo(...), or other built-in Hooks. You can only call Hooks at the top level of your React function. For more information, see https://react.dev/link/rules-of-hooks")}function se(){console.error("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().")}function fe(){}function ge(n){var o=[];return n.forEach(function(p){o.push(p)}),o.sort().join(", ")}function le(n,o,p,b){return new Xp(n,o,p,b)}function ke(n,o){n.context===Yl&&(c0(n.current,2,o,n,null,null),xh())}function Re(n,o){if(Zs!==null){var p=o.staleFamilies;o=o.updatedFamilies,Ki(),fc(n.current,o,p),xh()}}function Ue(n){Zs=n}function Pe(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function We(n){var o=n,p=n;if(n.alternate)for(;o.return;)o=o.return;else{n=o;do o=n,(o.flags&4098)!==0&&(p=o.return),n=o.return;while(n)}return o.tag===3?p:null}function Tt(n){if(n.tag===13){var o=n.memoizedState;if(o===null&&(n=n.alternate,n!==null&&(o=n.memoizedState)),o!==null)return o.dehydrated}return null}function wt(n){if(We(n)!==n)throw Error("Unable to find node on an unmounted component.")}function St(n){var o=n.alternate;if(!o){if(o=We(n),o===null)throw Error("Unable to find node on an unmounted component.");return o!==n?null:n}for(var p=n,b=o;;){var O=p.return;if(O===null)break;var z=O.alternate;if(z===null){if(b=O.return,b!==null){p=b;continue}break}if(O.child===z.child){for(z=O.child;z;){if(z===p)return wt(O),n;if(z===b)return wt(O),o;z=z.sibling}throw Error("Unable to find node on an unmounted component.")}if(p.return!==b.return)p=O,b=z;else{for(var W=!1,oe=O.child;oe;){if(oe===p){W=!0,p=O,b=z;break}if(oe===b){W=!0,b=O,p=z;break}oe=oe.sibling}if(!W){for(oe=z.child;oe;){if(oe===p){W=!0,p=z,b=O;break}if(oe===b){W=!0,b=z,p=O;break}oe=oe.sibling}if(!W)throw Error("Child was not found in either parent set. This indicates a bug in React related to the return pointer. Please file an issue.")}}if(p.alternate!==b)throw Error("Return fibers should always be each others' alternates. This error is likely caused by a bug in React. Please file an issue.")}if(p.tag!==3)throw Error("Unable to find node on an unmounted component.");return p.stateNode.current===p?n:o}function Xt(n){var o=n.tag;if(o===5||o===26||o===27||o===6)return n;for(n=n.child;n!==null;){if(o=Xt(n),o!==null)return o;n=n.sibling}return null}function cn(n){return n===null||typeof n!="object"?null:(n=Ky&&n[Ky]||n["@@iterator"],typeof n=="function"?n:null)}function xt(n){if(n==null)return null;if(typeof n=="function")return n.$$typeof===x0?null:n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Vl:return"Fragment";case g0:return"Profiler";case u_:return"StrictMode";case d_:return"Suspense";case y0:return"SuspenseList";case v0:return"Activity"}if(typeof n=="object")switch(typeof n.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),n.$$typeof){case ul:return"Portal";case du:return(n.displayName||"Context")+".Provider";case _0:return(n._context.displayName||"Context")+".Consumer";case dl:var o=n.render;return n=n.displayName,n||(n=o.displayName||o.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case h_:return o=n.displayName||null,o!==null?o:xt(n.type)||"Memo";case Wo:o=n._payload,n=n._init;try{return xt(n(o))}catch{}}return null}function rn(n){return typeof n.tag=="number"?Ut(n):typeof n.name=="string"?n.name:null}function Ut(n){var o=n.type;switch(n.tag){case 31:return"Activity";case 24:return"Cache";case 9:return(o._context.displayName||"Context")+".Consumer";case 10:return(o.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=o.render,n=n.displayName||n.name||"",o.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 26:case 27:case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return xt(o);case 8:return o===u_?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o;break;case 29:if(o=n._debugInfo,o!=null){for(var p=o.length-1;0<=p;p--)if(typeof o[p].name=="string")return o[p].name}if(n.return!==null)return Ut(n.return)}return null}function Yt(n){return{current:n}}function Rt(n,o){0>hu?console.error("Unexpected pop."):(o!==ql[hu]&&console.error("Unexpected Fiber popped."),n.current=f_[hu],f_[hu]=null,ql[hu]=null,hu--)}function ln(n,o,p){hu++,f_[hu]=n.current,ql[hu]=p,n.current=o}function An(n){return n===null&&console.error("Expected host context to exist. This error is likely caused by a bug in React. Please file an issue."),n}function mn(n,o){ln(Ch,o,n),ln(p_,n,n),ln(Ah,null,n);var p=o.nodeType;switch(p){case 9:case 11:p=p===9?"#document":"#fragment",o=(o=o.documentElement)&&(o=o.namespaceURI)?fn(o):Je;break;default:if(p=o.tagName,o=o.namespaceURI)o=fn(o),o=ar(o,p);else switch(p){case"svg":o=vt;break;case"math":o=_t;break;default:o=Je}}p=p.toLowerCase(),p=Os(null,p),p={context:o,ancestorInfo:p},Rt(Ah,n),ln(Ah,p,n)}function $t(n){Rt(Ah,n),Rt(p_,n),Rt(Ch,n)}function Nt(){return An(Ah.current)}function Kt(n){n.memoizedState!==null&&ln(Jy,n,n);var o=An(Ah.current),p=n.type,b=ar(o.context,p);p=Os(o.ancestorInfo,p),b={context:b,ancestorInfo:p},o!==b&&(ln(p_,n,n),ln(Ah,b,n))}function It(n){p_.current===n&&(Rt(Ah,n),Rt(p_,n)),Jy.current===n&&(Rt(Jy,n),ki._currentValue=so)}function sn(n){return typeof Symbol=="function"&&Symbol.toStringTag&&n[Symbol.toStringTag]||n.constructor.name||"Object"}function tt(n){try{return un(n),!1}catch{return!0}}function un(n){return""+n}function pn(n,o){if(tt(n))return console.error("The provided `%s` attribute is an unsupported type %s. This value must be coerced to a string before using it here.",o,sn(n)),un(n)}function Vt(n,o){if(tt(n))return console.error("The provided `%s` CSS property is an unsupported type %s. This value must be coerced to a string before using it here.",o,sn(n)),un(n)}function ir(n){if(tt(n))return console.error("Form field values (value, checked, defaultValue, or defaultChecked props) must be strings, not %s. This value must be coerced to a string before using it here.",sn(n)),un(n)}function Nr(n){if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")return!1;var o=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(o.isDisabled)return!0;if(!o.supportsFiber)return console.error("The installed version of React DevTools is too old and will not work with the current version of React. Please update React DevTools. https://react.dev/link/react-devtools"),!0;try{Kf=o.inject(n),Gs=o}catch(p){console.error("React instrumentation encountered an error: %s.",p)}return!!o.checkDCE}function rr(n){if(typeof w0=="function"&&S0(n),Gs&&typeof Gs.setStrictMode=="function")try{Gs.setStrictMode(Kf,n)}catch(o){Cc||(Cc=!0,console.error("React instrumentation encountered an error: %s",o))}}function kr(n){Ln=n}function sr(){Ln!==null&&typeof Ln.markCommitStopped=="function"&&Ln.markCommitStopped()}function Yr(n){Ln!==null&&typeof Ln.markComponentRenderStarted=="function"&&Ln.markComponentRenderStarted(n)}function de(){Ln!==null&&typeof Ln.markComponentRenderStopped=="function"&&Ln.markComponentRenderStopped()}function po(n){Ln!==null&&typeof Ln.markRenderStarted=="function"&&Ln.markRenderStarted(n)}function Uo(){Ln!==null&&typeof Ln.markRenderStopped=="function"&&Ln.markRenderStopped()}function ls(n,o){Ln!==null&&typeof Ln.markStateUpdateScheduled=="function"&&Ln.markStateUpdateScheduled(n,o)}function qt(n){return n>>>=0,n===0?32:31-(T0(n)/Mb|0)|0}function cs(n){if(n&1)return"SyncHydrationLane";if(n&2)return"Sync";if(n&4)return"InputContinuousHydration";if(n&8)return"InputContinuous";if(n&16)return"DefaultHydration";if(n&32)return"Default";if(n&128)return"TransitionHydration";if(n&4194048)return"Transition";if(n&62914560)return"Retry";if(n&67108864)return"SelectiveHydration";if(n&134217728)return"IdleHydration";if(n&268435456)return"Idle";if(n&536870912)return"Offscreen";if(n&1073741824)return"Deferred"}function ti(n){var o=n&42;if(o!==0)return o;switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return n&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return console.error("Should have found matching lanes. This is a bug in React."),n}}function Do(n,o,p){var b=n.pendingLanes;if(b===0)return 0;var O=0,z=n.suspendedLanes,W=n.pingedLanes;n=n.warmLanes;var oe=b&134217727;return oe!==0?(b=oe&~z,b!==0?O=ti(b):(W&=oe,W!==0?O=ti(W):p||(p=oe&~n,p!==0&&(O=ti(p))))):(oe=b&~z,oe!==0?O=ti(oe):W!==0?O=ti(W):p||(p=b&~n,p!==0&&(O=ti(p)))),O===0?0:o!==0&&o!==O&&(o&z)===0&&(z=O&-O,p=o&-o,z>=p||z===32&&(p&4194048)!==0)?o:O}function Jn(n,o){return(n.pendingLanes&~(n.suspendedLanes&~n.pingedLanes)&o)===0}function Wi(n,o){switch(n){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return console.error("Should have found matching lanes. This is a bug in React."),-1}}function dr(){var n=Gm;return Gm<<=1,(Gm&4194048)===0&&(Gm=256),n}function ea(){var n=nv;return nv<<=1,(nv&62914560)===0&&(nv=4194304),n}function Rs(n){for(var o=[],p=0;31>p;p++)o.push(n);return o}function ta(n,o){n.pendingLanes|=o,o!==268435456&&(n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0)}function $n(n,o,p,b,O,z){var W=n.pendingLanes;n.pendingLanes=p,n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0,n.expiredLanes&=p,n.entangledLanes&=p,n.errorRecoveryDisabledLanes&=p,n.shellSuspendCounter=0;var oe=n.entanglements,Ce=n.expirationTimes,Be=n.hiddenUpdates;for(p=W&~p;0<p;){var Dt=31-$s(p),Ft=1<<Dt;oe[Dt]=0,Ce[Dt]=-1;var Et=Be[Dt];if(Et!==null)for(Be[Dt]=null,Dt=0;Dt<Et.length;Dt++){var Gt=Et[Dt];Gt!==null&&(Gt.lane&=-536870913)}p&=~Ft}b!==0&&mo(n,b,0),z!==0&&O===0&&n.tag!==0&&(n.suspendedLanes|=z&~(W&~o))}function mo(n,o,p){n.pendingLanes|=o,n.suspendedLanes&=~o;var b=31-$s(o);n.entangledLanes|=o,n.entanglements[b]=n.entanglements[b]|1073741824|p&4194090}function Fa(n,o){var p=n.entangledLanes|=o;for(n=n.entanglements;p;){var b=31-$s(p),O=1<<b;O&o|n[b]&o&&(n[b]|=o),p&=~O}}function Ua(n){switch(n){case 2:n=1;break;case 8:n=4;break;case 32:n=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:n=128;break;case 268435456:n=134217728;break;default:n=0}return n}function ao(n,o,p){if(Hl)for(n=n.pendingUpdatersLaneMap;0<p;){var b=31-$s(p),O=1<<b;n[b].add(o),p&=~O}}function na(n,o){if(Hl)for(var p=n.pendingUpdatersLaneMap,b=n.memoizedUpdaters;0<o;){var O=31-$s(o);n=1<<O,O=p[O],0<O.size&&(O.forEach(function(z){var W=z.alternate;W!==null&&b.has(W)||b.add(z)}),O.clear()),o&=~n}}function us(n){return n&=-n,Gl<n?fu<n?(n&134217727)!==0?yd:m_:fu:Gl}function lc(){var n=yi.p;return n!==0?n:(n=window.event,n===void 0?yd:d0(n.type))}function bl(n,o){var p=yi.p;try{return yi.p=n,o()}finally{yi.p=p}}function ks(n){delete n[Po],delete n[ts],delete n[Jf],delete n[Rb],delete n[kb]}function jo(n){var o=n[Po];if(o)return o;for(var p=n.parentNode;p;){if(o=p[Dc]||p[Po]){if(p=o.alternate,o.child!==null||p!==null&&p.child!==null)for(n=zm(n);n!==null;){if(p=n[Po])return p;n=zm(n)}return o}n=p,p=n.parentNode}return null}function qi(n){if(n=n[Po]||n[Dc]){var o=n.tag;if(o===5||o===6||o===13||o===26||o===27||o===3)return n}return null}function ra(n){var o=n.tag;if(o===5||o===26||o===27||o===6)return n.stateNode;throw Error("getNodeFromInstance: Invalid argument.")}function xe(n){var o=n[E0];return o||(o=n[E0]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function it(n){n[$m]=!0}function yn(n,o){Sn(n,o),Sn(n+"Capture",o)}function Sn(n,o){Qf[n]&&console.error("EventRegistry: More than one plugin attempted to publish the same registration name, `%s`.",n),Qf[n]=o;var p=n.toLowerCase();for(rv[p]=n,n==="onDoubleClick"&&(rv.ondblclick=n),n=0;n<o.length;n++)Ob.add(o[n])}function kn(n,o){iv[o.type]||o.onChange||o.onInput||o.readOnly||o.disabled||o.value==null||console.error(n==="select"?"You provided a `value` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultValue`. Otherwise, set `onChange`.":"You provided a `value` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultValue`. Otherwise, set either `onChange` or `readOnly`."),o.onChange||o.readOnly||o.disabled||o.checked==null||console.error("You provided a `checked` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultChecked`. Otherwise, set either `onChange` or `readOnly`.")}function br(n){return _d.call(A0,n)?!0:_d.call(Nb,n)?!1:Ib.test(n)?A0[n]=!0:(Nb[n]=!0,console.error("Invalid attribute name: `%s`",n),!1)}function wr(n,o,p){if(br(o)){if(!n.hasAttribute(o)){switch(typeof p){case"symbol":case"object":return p;case"function":return p;case"boolean":if(p===!1)return p}return p===void 0?void 0:null}return n=n.getAttribute(o),n===""&&p===!0?!0:(pn(p,o),n===""+p?p:n)}}function Br(n,o,p){if(br(o))if(p===null)n.removeAttribute(o);else{switch(typeof p){case"undefined":case"function":case"symbol":n.removeAttribute(o);return;case"boolean":var b=o.toLowerCase().slice(0,5);if(b!=="data-"&&b!=="aria-"){n.removeAttribute(o);return}}pn(p,o),n.setAttribute(o,""+p)}}function Er(n,o,p){if(p===null)n.removeAttribute(o);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(o);return}pn(p,o),n.setAttribute(o,""+p)}}function no(n,o,p,b){if(b===null)n.removeAttribute(p);else{switch(typeof b){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(p);return}pn(b,p),n.setAttributeNS(o,p,""+b)}}function ia(){}function ut(){if(ep===0){C0=console.log,D0=console.info,M0=console.warn,R0=console.error,k0=console.group,zb=console.groupCollapsed,O0=console.groupEnd;var n={configurable:!0,enumerable:!0,value:ia,writable:!0};Object.defineProperties(console,{info:n,log:n,warn:n,error:n,group:n,groupCollapsed:n,groupEnd:n})}ep++}function ie(){if(ep--,ep===0){var n={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:Fr({},n,{value:C0}),info:Fr({},n,{value:D0}),warn:Fr({},n,{value:M0}),error:Fr({},n,{value:R0}),group:Fr({},n,{value:k0}),groupCollapsed:Fr({},n,{value:zb}),groupEnd:Fr({},n,{value:O0})})}0>ep&&console.error("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}function ae(n){if(ov===void 0)try{throw Error()}catch(p){var o=p.stack.trim().match(/\n( *(at )?)/);ov=o&&o[1]||"",Zm=-1<p.stack.indexOf(`
    at`)?" (<anonymous>)":-1<p.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ov+n+Zm}function we(n,o){if(!n||sv)return"";var p=av.get(n);if(p!==void 0)return p;sv=!0,p=Error.prepareStackTrace,Error.prepareStackTrace=void 0;var b=null;b=Pt.H,Pt.H=null,ut();try{var O={DetermineComponentFrameRoot:function(){try{if(o){var Et=function(){throw Error()};if(Object.defineProperty(Et.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Et,[])}catch(Hn){var Gt=Hn}Reflect.construct(n,[],Et)}else{try{Et.call()}catch(Hn){Gt=Hn}n.call(Et.prototype)}}else{try{throw Error()}catch(Hn){Gt=Hn}(Et=n())&&typeof Et.catch=="function"&&Et.catch(function(){})}}catch(Hn){if(Hn&&Gt&&typeof Hn.stack=="string")return[Hn.stack,Gt.stack]}return[null,null]}};O.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var z=Object.getOwnPropertyDescriptor(O.DetermineComponentFrameRoot,"name");z&&z.configurable&&Object.defineProperty(O.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var W=O.DetermineComponentFrameRoot(),oe=W[0],Ce=W[1];if(oe&&Ce){var Be=oe.split(`
`),Dt=Ce.split(`
`);for(W=z=0;z<Be.length&&!Be[z].includes("DetermineComponentFrameRoot");)z++;for(;W<Dt.length&&!Dt[W].includes("DetermineComponentFrameRoot");)W++;if(z===Be.length||W===Dt.length)for(z=Be.length-1,W=Dt.length-1;1<=z&&0<=W&&Be[z]!==Dt[W];)W--;for(;1<=z&&0<=W;z--,W--)if(Be[z]!==Dt[W]){if(z!==1||W!==1)do if(z--,W--,0>W||Be[z]!==Dt[W]){var Ft=`
`+Be[z].replace(" at new "," at ");return n.displayName&&Ft.includes("<anonymous>")&&(Ft=Ft.replace("<anonymous>",n.displayName)),typeof n=="function"&&av.set(n,Ft),Ft}while(1<=z&&0<=W);break}}}finally{sv=!1,Pt.H=b,ie(),Error.prepareStackTrace=p}return Be=(Be=n?n.displayName||n.name:"")?ae(Be):"",typeof n=="function"&&av.set(n,Be),Be}function Oe(n){var o=Error.prepareStackTrace;if(Error.prepareStackTrace=void 0,n=n.stack,Error.prepareStackTrace=o,n.startsWith(`Error: react-stack-top-frame
`)&&(n=n.slice(29)),o=n.indexOf(`
`),o!==-1&&(n=n.slice(o+1)),o=n.indexOf("react-stack-bottom-frame"),o!==-1&&(o=n.lastIndexOf(`
`,o)),o!==-1)n=n.slice(0,o);else return"";return n}function Ie(n){switch(n.tag){case 26:case 27:case 5:return ae(n.type);case 16:return ae("Lazy");case 13:return ae("Suspense");case 19:return ae("SuspenseList");case 0:case 15:return we(n.type,!1);case 11:return we(n.type.render,!1);case 1:return we(n.type,!0);case 31:return ae("Activity");default:return""}}function je(n){try{var o="";do{o+=Ie(n);var p=n._debugInfo;if(p)for(var b=p.length-1;0<=b;b--){var O=p[b];if(typeof O.name=="string"){var z=o,W=O.env,oe=ae(O.name+(W?" ["+W+"]":""));o=z+oe}}n=n.return}while(n);return o}catch(Ce){return`
Error generating stack: `+Ce.message+`
`+Ce.stack}}function rt(n){return(n=n?n.displayName||n.name:"")?ae(n):""}function $e(){if(fl===null)return null;var n=fl._debugOwner;return n!=null?rn(n):null}function at(){if(fl===null)return"";var n=fl;try{var o="";switch(n.tag===6&&(n=n.return),n.tag){case 26:case 27:case 5:o+=ae(n.type);break;case 13:o+=ae("Suspense");break;case 19:o+=ae("SuspenseList");break;case 31:o+=ae("Activity");break;case 30:case 0:case 15:case 1:n._debugOwner||o!==""||(o+=rt(n.type));break;case 11:n._debugOwner||o!==""||(o+=rt(n.type.render))}for(;n;)if(typeof n.tag=="number"){var p=n;n=p._debugOwner;var b=p._debugStack;n&&b&&(typeof b!="string"&&(p._debugStack=b=Oe(b)),b!==""&&(o+=`
`+b))}else if(n.debugStack!=null){var O=n.debugStack;(n=n.owner)&&O&&(o+=`
`+Oe(O))}else break;var z=o}catch(W){z=`
Error generating stack: `+W.message+`
`+W.stack}return z}function Ye(n,o,p,b,O,z,W){var oe=fl;ct(n);try{return n!==null&&n._debugTask?n._debugTask.run(o.bind(null,p,b,O,z,W)):o(p,b,O,z,W)}finally{ct(oe)}throw Error("runWithFiberInDEV should never be called in production. This is a bug in React.")}function ct(n){Pt.getCurrentStack=n===null?null:at,pu=!1,fl=n}function At(n){switch(typeof n){case"bigint":case"boolean":case"number":case"string":case"undefined":return n;case"object":return ir(n),n;default:return""}}function Qt(n){var o=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function on(n){var o=Qt(n)?"checked":"value",p=Object.getOwnPropertyDescriptor(n.constructor.prototype,o);ir(n[o]);var b=""+n[o];if(!n.hasOwnProperty(o)&&typeof p<"u"&&typeof p.get=="function"&&typeof p.set=="function"){var O=p.get,z=p.set;return Object.defineProperty(n,o,{configurable:!0,get:function(){return O.call(this)},set:function(W){ir(W),b=""+W,z.call(this,W)}}),Object.defineProperty(n,o,{enumerable:p.enumerable}),{getValue:function(){return b},setValue:function(W){ir(W),b=""+W},stopTracking:function(){n._valueTracker=null,delete n[o]}}}}function Nn(n){n._valueTracker||(n._valueTracker=on(n))}function jn(n){if(!n)return!1;var o=n._valueTracker;if(!o)return!0;var p=o.getValue(),b="";return n&&(b=Qt(n)?n.checked?"true":"false":n.value),n=b,n!==p?(o.setValue(n),!0):!1}function Un(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function zn(n){return n.replace(rS,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function Wr(n,o){o.checked===void 0||o.defaultChecked===void 0||Lb||(console.error("%s contains an input of type %s with both checked and defaultChecked props. Input elements must be either controlled or uncontrolled (specify either the checked prop, or the defaultChecked prop, but not both). Decide between using a controlled or uncontrolled input element and remove one of these props. More info: https://react.dev/link/controlled-components",$e()||"A component",o.type),Lb=!0),o.value===void 0||o.defaultValue===void 0||Pb||(console.error("%s contains an input of type %s with both value and defaultValue props. Input elements must be either controlled or uncontrolled (specify either the value prop, or the defaultValue prop, but not both). Decide between using a controlled or uncontrolled input element and remove one of these props. More info: https://react.dev/link/controlled-components",$e()||"A component",o.type),Pb=!0)}function si(n,o,p,b,O,z,W,oe){n.name="",W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"?(pn(W,"type"),n.type=W):n.removeAttribute("type"),o!=null?W==="number"?(o===0&&n.value===""||n.value!=o)&&(n.value=""+At(o)):n.value!==""+At(o)&&(n.value=""+At(o)):W!=="submit"&&W!=="reset"||n.removeAttribute("value"),o!=null?Ar(n,W,At(o)):p!=null?Ar(n,W,At(p)):b!=null&&n.removeAttribute("value"),O==null&&z!=null&&(n.defaultChecked=!!z),O!=null&&(n.checked=O&&typeof O!="function"&&typeof O!="symbol"),oe!=null&&typeof oe!="function"&&typeof oe!="symbol"&&typeof oe!="boolean"?(pn(oe,"name"),n.name=""+At(oe)):n.removeAttribute("name")}function Qn(n,o,p,b,O,z,W,oe){if(z!=null&&typeof z!="function"&&typeof z!="symbol"&&typeof z!="boolean"&&(pn(z,"type"),n.type=z),o!=null||p!=null){if(!(z!=="submit"&&z!=="reset"||o!=null))return;p=p!=null?""+At(p):"",o=o!=null?""+At(o):p,oe||o===n.value||(n.value=o),n.defaultValue=o}b=b??O,b=typeof b!="function"&&typeof b!="symbol"&&!!b,n.checked=oe?n.checked:!!b,n.defaultChecked=!!b,W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"&&(pn(W,"name"),n.name=W)}function Ar(n,o,p){o==="number"&&Un(n.ownerDocument)===n||n.defaultValue===""+p||(n.defaultValue=""+p)}function Rr(n,o){o.value==null&&(typeof o.children=="object"&&o.children!==null?Wy.Children.forEach(o.children,function(p){p==null||typeof p=="string"||typeof p=="number"||typeof p=="bigint"||Fb||(Fb=!0,console.error("Cannot infer the option value of complex children. Pass a `value` prop or use a plain string as children to <option>."))}):o.dangerouslySetInnerHTML==null||I0||(I0=!0,console.error("Pass a `value` prop if you set dangerouslyInnerHTML so React knows which value should be selected."))),o.selected==null||Bb||(console.error("Use the `defaultValue` or `value` props on <select> instead of setting `selected` on <option>."),Bb=!0)}function Or(){var n=$e();return n?`

Check the render method of \``+n+"`.":""}function fi(n,o,p,b){if(n=n.options,o){o={};for(var O=0;O<p.length;O++)o["$"+p[O]]=!0;for(p=0;p<n.length;p++)O=o.hasOwnProperty("$"+n[p].value),n[p].selected!==O&&(n[p].selected=O),O&&b&&(n[p].defaultSelected=!0)}else{for(p=""+At(p),o=null,O=0;O<n.length;O++){if(n[O].value===p){n[O].selected=!0,b&&(n[O].defaultSelected=!0);return}o!==null||n[O].disabled||(o=n[O])}o!==null&&(o.selected=!0)}}function ro(n,o){for(n=0;n<jb.length;n++){var p=jb[n];if(o[p]!=null){var b=es(o[p]);o.multiple&&!b?console.error("The `%s` prop supplied to <select> must be an array if `multiple` is true.%s",p,Or()):!o.multiple&&b&&console.error("The `%s` prop supplied to <select> must be a scalar value if `multiple` is false.%s",p,Or())}}o.value===void 0||o.defaultValue===void 0||Ub||(console.error("Select elements must be either controlled or uncontrolled (specify either the value prop, or the defaultValue prop, but not both). Decide between using a controlled or uncontrolled select element and remove one of these props. More info: https://react.dev/link/controlled-components"),Ub=!0)}function Mo(n,o){o.value===void 0||o.defaultValue===void 0||Vb||(console.error("%s contains a textarea with both value and defaultValue props. Textarea elements must be either controlled or uncontrolled (specify either the value prop, or the defaultValue prop, but not both). Decide between using a controlled or uncontrolled textarea and remove one of these props. More info: https://react.dev/link/controlled-components",$e()||"A component"),Vb=!0),o.children!=null&&o.value==null&&console.error("Use the `defaultValue` or `value` props instead of setting children on <textarea>.")}function oa(n,o,p){if(o!=null&&(o=""+At(o),o!==n.value&&(n.value=o),p==null)){n.defaultValue!==o&&(n.defaultValue=o);return}n.defaultValue=p!=null?""+At(p):""}function Vo(n,o,p,b){if(o==null){if(b!=null){if(p!=null)throw Error("If you supply `defaultValue` on a <textarea>, do not pass children.");if(es(b)){if(1<b.length)throw Error("<textarea> can only have at most one child.");b=b[0]}p=b}p==null&&(p=""),o=p}p=At(o),n.defaultValue=p,b=n.textContent,b===p&&b!==""&&b!==null&&(n.value=b)}function io(n,o){return n.serverProps===void 0&&n.serverTail.length===0&&n.children.length===1&&3<n.distanceFromLeaf&&n.distanceFromLeaf>15-o?io(n.children[0],o):n}function pi(n){return"  "+"  ".repeat(n)}function ja(n){return"+ "+"  ".repeat(n)}function Ro(n){return"- "+"  ".repeat(n)}function Va(n){switch(n.tag){case 26:case 27:case 5:return n.type;case 16:return"Lazy";case 13:return"Suspense";case 19:return"SuspenseList";case 0:case 15:return n=n.type,n.displayName||n.name||null;case 11:return n=n.type.render,n.displayName||n.name||null;case 1:return n=n.type,n.displayName||n.name||null;default:return null}}function Eu(n,o){return lv.test(n)?(n=JSON.stringify(n),n.length>o-2?8>o?'{"..."}':"{"+n.slice(0,o-7)+'..."}':"{"+n+"}"):n.length>o?5>o?'{"..."}':n.slice(0,o-3)+"...":n}function Au(n,o,p){var b=120-2*p;if(o===null)return ja(p)+Eu(n,b)+`
`;if(typeof o=="string"){for(var O=0;O<o.length&&O<n.length&&o.charCodeAt(O)===n.charCodeAt(O);O++);return O>b-8&&10<O&&(n="..."+n.slice(O-8),o="..."+o.slice(O-8)),ja(p)+Eu(n,b)+`
`+Ro(p)+Eu(o,b)+`
`}return pi(p)+Eu(n,b)+`
`}function Cu(n){return Object.prototype.toString.call(n).replace(/^\[object (.*)\]$/,function(o,p){return p})}function wl(n,o){switch(typeof n){case"string":return n=JSON.stringify(n),n.length>o?5>o?'"..."':n.slice(0,o-4)+'..."':n;case"object":if(n===null)return"null";if(es(n))return"[...]";if(n.$$typeof===gd)return(o=xt(n.type))?"<"+o+">":"<...>";var p=Cu(n);if(p==="Object"){p="",o-=2;for(var b in n)if(n.hasOwnProperty(b)){var O=JSON.stringify(b);if(O!=='"'+b+'"'&&(b=O),o-=b.length-2,O=wl(n[b],15>o?o:15),o-=O.length,0>o){p+=p===""?"...":", ...";break}p+=(p===""?"":",")+b+":"+O}return"{"+p+"}"}return p;case"function":return(o=n.displayName||n.name)?"function "+o:"function";default:return String(n)}}function jc(n,o){return typeof n!="string"||lv.test(n)?"{"+wl(n,o-2)+"}":n.length>o-2?5>o?'"..."':'"'+n.slice(0,o-5)+'..."':'"'+n+'"'}function jp(n,o,p){var b=120-p.length-n.length,O=[],z;for(z in o)if(o.hasOwnProperty(z)&&z!=="children"){var W=jc(o[z],120-p.length-z.length-1);b-=z.length+W.length+2,O.push(z+"="+W)}return O.length===0?p+"<"+n+`>
`:0<b?p+"<"+n+" "+O.join(" ")+`>
`:p+"<"+n+`
`+p+"  "+O.join(`
`+p+"  ")+`
`+p+`>
`}function _y(n,o,p){var b="",O=Fr({},o),z;for(z in n)if(n.hasOwnProperty(z)){delete O[z];var W=120-2*p-z.length-2,oe=wl(n[z],W);o.hasOwnProperty(z)?(W=wl(o[z],W),b+=ja(p)+z+": "+oe+`
`,b+=Ro(p)+z+": "+W+`
`):b+=ja(p)+z+": "+oe+`
`}for(var Ce in O)O.hasOwnProperty(Ce)&&(n=wl(O[Ce],120-2*p-Ce.length-2),b+=Ro(p)+Ce+": "+n+`
`);return b}function Dg(n,o,p,b){var O="",z=new Map;for(Be in p)p.hasOwnProperty(Be)&&z.set(Be.toLowerCase(),Be);if(z.size===1&&z.has("children"))O+=jp(n,o,pi(b));else{for(var W in o)if(o.hasOwnProperty(W)&&W!=="children"){var oe=120-2*(b+1)-W.length-1,Ce=z.get(W.toLowerCase());if(Ce!==void 0){z.delete(W.toLowerCase());var Be=o[W];Ce=p[Ce];var Dt=jc(Be,oe);oe=jc(Ce,oe),typeof Be=="object"&&Be!==null&&typeof Ce=="object"&&Ce!==null&&Cu(Be)==="Object"&&Cu(Ce)==="Object"&&(2<Object.keys(Be).length||2<Object.keys(Ce).length||-1<Dt.indexOf("...")||-1<oe.indexOf("..."))?O+=pi(b+1)+W+`={{
`+_y(Be,Ce,b+2)+pi(b+1)+`}}
`:(O+=ja(b+1)+W+"="+Dt+`
`,O+=Ro(b+1)+W+"="+oe+`
`)}else O+=pi(b+1)+W+"="+jc(o[W],oe)+`
`}z.forEach(function(Ft){if(Ft!=="children"){var Et=120-2*(b+1)-Ft.length-1;O+=Ro(b+1)+Ft+"="+jc(p[Ft],Et)+`
`}}),O=O===""?pi(b)+"<"+n+`>
`:pi(b)+"<"+n+`
`+O+pi(b)+`>
`}return n=p.children,o=o.children,typeof n=="string"||typeof n=="number"||typeof n=="bigint"?(z="",(typeof o=="string"||typeof o=="number"||typeof o=="bigint")&&(z=""+o),O+=Au(z,""+n,b+1)):(typeof o=="string"||typeof o=="number"||typeof o=="bigint")&&(O=n==null?O+Au(""+o,null,b+1):O+Au(""+o,void 0,b+1)),O}function Du(n,o){var p=Va(n);if(p===null){for(p="",n=n.child;n;)p+=Du(n,o),n=n.sibling;return p}return pi(o)+"<"+p+`>
`}function ds(n,o){var p=io(n,o);if(p!==n&&(n.children.length!==1||n.children[0]!==p))return pi(o)+`...
`+ds(p,o+1);p="";var b=n.fiber._debugInfo;if(b)for(var O=0;O<b.length;O++){var z=b[O].name;typeof z=="string"&&(p+=pi(o)+"<"+z+`>
`,o++)}if(b="",O=n.fiber.pendingProps,n.fiber.tag===6)b=Au(O,n.serverProps,o),o++;else if(z=Va(n.fiber),z!==null)if(n.serverProps===void 0){b=o;var W=120-2*b-z.length-2,oe="";for(Be in O)if(O.hasOwnProperty(Be)&&Be!=="children"){var Ce=jc(O[Be],15);if(W-=Be.length+Ce.length+2,0>W){oe+=" ...";break}oe+=" "+Be+"="+Ce}b=pi(b)+"<"+z+oe+`>
`,o++}else n.serverProps===null?(b=jp(z,O,ja(o)),o++):typeof n.serverProps=="string"?console.error("Should not have matched a non HostText fiber to a Text node. This is a bug in React."):(b=Dg(z,O,n.serverProps,o),o++);var Be="";for(O=n.fiber.child,z=0;O&&z<n.children.length;)W=n.children[z],W.fiber===O?(Be+=ds(W,o),z++):Be+=Du(O,o),O=O.sibling;for(O&&0<n.children.length&&(Be+=pi(o)+`...
`),O=n.serverTail,n.serverProps===null&&o--,n=0;n<O.length;n++)z=O[n],Be=typeof z=="string"?Be+(Ro(o)+Eu(z,120-2*o)+`
`):Be+jp(z.type,z.props,Ro(o));return p+b+Be}function sa(n){try{return`

`+ds(n,0)}catch{return""}}function cc(n,o,p){for(var b=o,O=null,z=0;b;)b===n&&(z=0),O={fiber:b,children:O!==null?[O]:[],serverProps:b===o?p:b===n?null:void 0,serverTail:[],distanceFromLeaf:z},z++,b=b.return;return O!==null?sa(O).replaceAll(/^[+-]/gm,">"):""}function Os(n,o){var p=Fr({},n||P0),b={tag:o};return z0.indexOf(o)!==-1&&(p.aTagInScope=null,p.buttonTagInScope=null,p.nobrTagInScope=null),qb.indexOf(o)!==-1&&(p.pTagInButtonScope=null),N0.indexOf(o)!==-1&&o!=="address"&&o!=="div"&&o!=="p"&&(p.listItemTagAutoclosing=null,p.dlItemTagAutoclosing=null),p.current=b,o==="form"&&(p.formTag=b),o==="a"&&(p.aTagInScope=b),o==="button"&&(p.buttonTagInScope=b),o==="nobr"&&(p.nobrTagInScope=b),o==="p"&&(p.pTagInButtonScope=b),o==="li"&&(p.listItemTagAutoclosing=b),(o==="dd"||o==="dt")&&(p.dlItemTagAutoclosing=b),o==="#document"||o==="html"?p.containerTagInScope=null:p.containerTagInScope||(p.containerTagInScope=b),n!==null||o!=="#document"&&o!=="html"&&o!=="body"?p.implicitRootScope===!0&&(p.implicitRootScope=!1):p.implicitRootScope=!0,p}function hs(n,o,p){switch(o){case"select":return n==="hr"||n==="option"||n==="optgroup"||n==="script"||n==="template"||n==="#text";case"optgroup":return n==="option"||n==="#text";case"option":return n==="#text";case"tr":return n==="th"||n==="td"||n==="style"||n==="script"||n==="template";case"tbody":case"thead":case"tfoot":return n==="tr"||n==="style"||n==="script"||n==="template";case"colgroup":return n==="col"||n==="template";case"table":return n==="caption"||n==="colgroup"||n==="tbody"||n==="tfoot"||n==="thead"||n==="style"||n==="script"||n==="template";case"head":return n==="base"||n==="basefont"||n==="bgsound"||n==="link"||n==="meta"||n==="title"||n==="noscript"||n==="noframes"||n==="style"||n==="script"||n==="template";case"html":if(p)break;return n==="head"||n==="body"||n==="frameset";case"frameset":return n==="frame";case"#document":if(!p)return n==="html"}switch(n){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return o!=="h1"&&o!=="h2"&&o!=="h3"&&o!=="h4"&&o!=="h5"&&o!=="h6";case"rp":case"rt":return Hb.indexOf(o)===-1;case"caption":case"col":case"colgroup":case"frameset":case"frame":case"tbody":case"td":case"tfoot":case"th":case"thead":case"tr":return o==null;case"head":return p||o===null;case"html":return p&&o==="#document"||o===null;case"body":return p&&(o==="#document"||o==="html")||o===null}return!0}function qd(n,o){switch(n){case"address":case"article":case"aside":case"blockquote":case"center":case"details":case"dialog":case"dir":case"div":case"dl":case"fieldset":case"figcaption":case"figure":case"footer":case"header":case"hgroup":case"main":case"menu":case"nav":case"ol":case"p":case"section":case"summary":case"ul":case"pre":case"listing":case"table":case"hr":case"xmp":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return o.pTagInButtonScope;case"form":return o.formTag||o.pTagInButtonScope;case"li":return o.listItemTagAutoclosing;case"dd":case"dt":return o.dlItemTagAutoclosing;case"button":return o.buttonTagInScope;case"a":return o.aTagInScope;case"nobr":return o.nobrTagInScope}return null}function Vp(n,o){for(;n;){switch(n.tag){case 5:case 26:case 27:if(n.type===o)return n}n=n.return}return null}function Hd(n,o){o=o||P0;var p=o.current;if(o=(p=hs(n,p&&p.tag,o.implicitRootScope)?null:p)?null:qd(n,o),o=p||o,!o)return!0;var b=o.tag;if(o=String(!!p)+"|"+n+"|"+b,g_[o])return!1;g_[o]=!0;var O=(o=fl)?Vp(o.return,b):null,z=o!==null&&O!==null?cc(O,o,null):"",W="<"+n+">";return p?(p="",b==="table"&&n==="tr"&&(p+=" Add a <tbody>, <thead> or <tfoot> to your code to match the DOM tree generated by the browser."),console.error(`In HTML, %s cannot be a child of <%s>.%s
This will cause a hydration error.%s`,W,b,p,z)):console.error(`In HTML, %s cannot be a descendant of <%s>.
This will cause a hydration error.%s`,W,b,z),o&&(n=o.return,O===null||n===null||O===n&&n._debugOwner===o._debugOwner||Ye(O,function(){console.error(`<%s> cannot contain a nested %s.
See this log for the ancestor stack trace.`,b,W)})),!1}function Is(n,o,p){if(p||hs("#text",o,!1))return!0;if(p="#text|"+o,g_[p])return!1;g_[p]=!0;var b=(p=fl)?Vp(p,o):null;return p=p!==null&&b!==null?cc(b,p,p.tag!==6?{children:null}:null):"",/\S/.test(n)?console.error(`In HTML, text nodes cannot be a child of <%s>.
This will cause a hydration error.%s`,o,p):console.error(`In HTML, whitespace text nodes cannot be a child of <%s>. Make sure you don't have any extra whitespace between tags on each line of your source code.
This will cause a hydration error.%s`,o,p),!1}function go(n,o){if(o){var p=n.firstChild;if(p&&p===n.lastChild&&p.nodeType===3){p.nodeValue=o;return}}n.textContent=o}function yy(n){return n.replace(iS,function(o,p){return p.toUpperCase()})}function qp(n,o,p){var b=o.indexOf("--")===0;b||(-1<o.indexOf("-")?tp.hasOwnProperty(o)&&tp[o]||(tp[o]=!0,console.error("Unsupported style property %s. Did you mean %s?",o,yy(o.replace(Gb,"ms-")))):F0.test(o)?tp.hasOwnProperty(o)&&tp[o]||(tp[o]=!0,console.error("Unsupported vendor-prefixed style property %s. Did you mean %s?",o,o.charAt(0).toUpperCase()+o.slice(1))):!Ym.test(p)||U0.hasOwnProperty(p)&&U0[p]||(U0[p]=!0,console.error(`Style property values shouldn't contain a semicolon. Try "%s: %s" instead.`,o,p.replace(Ym,""))),typeof p=="number"&&(isNaN(p)?$b||($b=!0,console.error("`NaN` is an invalid value for the `%s` css style property.",o)):isFinite(p)||Zb||(Zb=!0,console.error("`Infinity` is an invalid value for the `%s` css style property.",o)))),p==null||typeof p=="boolean"||p===""?b?n.setProperty(o,""):o==="float"?n.cssFloat="":n[o]="":b?n.setProperty(o,p):typeof p!="number"||p===0||Yb.has(o)?o==="float"?n.cssFloat=p:(Vt(p,o),n[o]=(""+p).trim()):n[o]=p+"px"}function aa(n,o,p){if(o!=null&&typeof o!="object")throw Error("The `style` prop expects a mapping from style properties to values, not a string. For example, style={{marginRight: spacing + 'em'}} when using JSX.");if(o&&Object.freeze(o),n=n.style,p!=null){if(o){var b={};if(p){for(var O in p)if(p.hasOwnProperty(O)&&!o.hasOwnProperty(O))for(var z=cv[O]||[O],W=0;W<z.length;W++)b[z[W]]=O}for(var oe in o)if(o.hasOwnProperty(oe)&&(!p||p[oe]!==o[oe]))for(O=cv[oe]||[oe],z=0;z<O.length;z++)b[O[z]]=oe;oe={};for(var Ce in o)for(O=cv[Ce]||[Ce],z=0;z<O.length;z++)oe[O[z]]=Ce;Ce={};for(var Be in b)if(O=b[Be],(z=oe[Be])&&O!==z&&(W=O+","+z,!Ce[W])){Ce[W]=!0,W=console;var Dt=o[O];W.error.call(W,"%s a style property during rerender (%s) when a conflicting property is set (%s) can lead to styling bugs. To avoid this, don't mix shorthand and non-shorthand properties for the same value; instead, replace the shorthand with separate values.",Dt==null||typeof Dt=="boolean"||Dt===""?"Removing":"Updating",O,z)}}for(var Ft in p)!p.hasOwnProperty(Ft)||o!=null&&o.hasOwnProperty(Ft)||(Ft.indexOf("--")===0?n.setProperty(Ft,""):Ft==="float"?n.cssFloat="":n[Ft]="");for(var Et in o)Be=o[Et],o.hasOwnProperty(Et)&&p[Et]!==Be&&qp(n,Et,Be)}else for(b in o)o.hasOwnProperty(b)&&qp(n,b,o[b])}function gr(n){if(n.indexOf("-")===-1)return!1;switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function Hp(n){return oS.get(n)||n}function En(n,o){if(_d.call($i,o)&&$i[o])return!0;if(Xb.test(o)){if(n="aria-"+o.slice(4).toLowerCase(),n=Wb.hasOwnProperty(n)?n:null,n==null)return console.error("Invalid ARIA attribute `%s`. ARIA attributes follow the pattern aria-* and must be lowercase.",o),$i[o]=!0;if(o!==n)return console.error("Invalid ARIA attribute `%s`. Did you mean `%s`?",o,n),$i[o]=!0}if(Mc.test(o)){if(n=o.toLowerCase(),n=Wb.hasOwnProperty(n)?n:null,n==null)return $i[o]=!0,!1;o!==n&&(console.error("Unknown ARIA attribute `%s`. Did you mean `%s`?",o,n),$i[o]=!0)}return!0}function vy(n,o){var p=[],b;for(b in o)En(n,b)||p.push(b);o=p.map(function(O){return"`"+O+"`"}).join(", "),p.length===1?console.error("Invalid aria prop %s on <%s> tag. For details, see https://react.dev/link/invalid-aria-props",o,n):1<p.length&&console.error("Invalid aria props %s on <%s> tag. For details, see https://react.dev/link/invalid-aria-props",o,n)}function xy(n,o,p,b){if(_d.call(ns,o)&&ns[o])return!0;var O=o.toLowerCase();if(O==="onfocusin"||O==="onfocusout")return console.error("React uses onFocus and onBlur instead of onFocusIn and onFocusOut. All React events are normalized to bubble, so onFocusIn and onFocusOut are not needed/supported by React."),ns[o]=!0;if(typeof p=="function"&&(n==="form"&&o==="action"||n==="input"&&o==="formAction"||n==="button"&&o==="formAction"))return!0;if(b!=null){if(n=b.possibleRegistrationNames,b.registrationNameDependencies.hasOwnProperty(o))return!0;if(b=n.hasOwnProperty(O)?n[O]:null,b!=null)return console.error("Invalid event handler property `%s`. Did you mean `%s`?",o,b),ns[o]=!0;if(np.test(o))return console.error("Unknown event handler property `%s`. It will be ignored.",o),ns[o]=!0}else if(np.test(o))return sS.test(o)&&console.error("Invalid event handler property `%s`. React events use the camelCase naming convention, for example `onClick`.",o),ns[o]=!0;if(aS.test(o)||y_.test(o))return!0;if(O==="innerhtml")return console.error("Directly setting property `innerHTML` is not permitted. For more information, lookup documentation on `dangerouslySetInnerHTML`."),ns[o]=!0;if(O==="aria")return console.error("The `aria` attribute is reserved for future use in React. Pass individual `aria-` attributes instead."),ns[o]=!0;if(O==="is"&&p!==null&&p!==void 0&&typeof p!="string")return console.error("Received a `%s` for a string attribute `is`. If this is expected, cast the value to a string.",typeof p),ns[o]=!0;if(typeof p=="number"&&isNaN(p))return console.error("Received NaN for the `%s` attribute. If this is expected, cast the value to a string.",o),ns[o]=!0;if(__.hasOwnProperty(O)){if(O=__[O],O!==o)return console.error("Invalid DOM property `%s`. Did you mean `%s`?",o,O),ns[o]=!0}else if(o!==O)return console.error("React does not recognize the `%s` prop on a DOM element. If you intentionally want it to appear in the DOM as a custom attribute, spell it as lowercase `%s` instead. If you accidentally passed it from a parent component, remove it from the DOM element.",o,O),ns[o]=!0;switch(o){case"dangerouslySetInnerHTML":case"children":case"style":case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":return!0;case"innerText":case"textContent":return!0}switch(typeof p){case"boolean":switch(o){case"autoFocus":case"checked":case"multiple":case"muted":case"selected":case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":case"capture":case"download":case"inert":return!0;default:return O=o.toLowerCase().slice(0,5),O==="data-"||O==="aria-"?!0:(p?console.error('Received `%s` for a non-boolean attribute `%s`.\n\nIf you want to write it to the DOM, pass a string instead: %s="%s" or %s={value.toString()}.',p,o,o,p,o):console.error('Received `%s` for a non-boolean attribute `%s`.\n\nIf you want to write it to the DOM, pass a string instead: %s="%s" or %s={value.toString()}.\n\nIf you used to conditionally omit it with %s={condition && value}, pass %s={condition ? value : undefined} instead.',p,o,o,p,o,o,o),ns[o]=!0)}case"function":case"symbol":return ns[o]=!0,!1;case"string":if(p==="false"||p==="true"){switch(o){case"checked":case"selected":case"multiple":case"muted":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":case"inert":break;default:return!0}console.error("Received the string `%s` for the boolean attribute `%s`. %s Did you mean %s={%s}?",p,o,p==="false"?"The browser will interpret it as a truthy value.":'Although this works, it will not work as expected if you pass the string "false".',o,p),ns[o]=!0}}return!0}function uf(n,o,p){var b=[],O;for(O in o)xy(n,O,o[O],p)||b.push(O);o=b.map(function(z){return"`"+z+"`"}).join(", "),b.length===1?console.error("Invalid value for prop %s on <%s> tag. Either remove it from the element, or pass a string or number value to keep it in the DOM. For details, see https://react.dev/link/attribute-behavior ",o,n):1<b.length&&console.error("Invalid values for props %s on <%s> tag. Either remove them from the element, or pass a string or number value to keep them in the DOM. For details, see https://react.dev/link/attribute-behavior ",o,n)}function or(n){return lS.test(""+n)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":n}function Ns(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}function df(n){var o=qi(n);if(o&&(n=o.stateNode)){var p=n[ts]||null;e:switch(n=o.stateNode,o.type){case"input":if(si(n,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name),o=p.name,p.type==="radio"&&o!=null){for(p=n;p.parentNode;)p=p.parentNode;for(pn(o,"name"),p=p.querySelectorAll('input[name="'+zn(""+o)+'"][type="radio"]'),o=0;o<p.length;o++){var b=p[o];if(b!==n&&b.form===n.form){var O=b[ts]||null;if(!O)throw Error("ReactDOMInput: Mixing React and non-React radio inputs with the same `name` is not supported.");si(b,O.value,O.defaultValue,O.defaultValue,O.checked,O.defaultChecked,O.type,O.name)}}for(o=0;o<p.length;o++)b=p[o],b.form===n.form&&jn(b)}break e;case"textarea":oa(n,p.value,p.defaultValue);break e;case"select":o=p.value,o!=null&&fi(n,!!p.multiple,o,!1)}}}function Mu(n,o,p){if(hv)return n(o,p);hv=!0;try{var b=n(o);return b}finally{if(hv=!1,(rp!==null||Dh!==null)&&(xh(),rp&&(o=rp,n=Dh,Dh=rp=null,df(o),n)))for(o=0;o<n.length;o++)df(n[o])}}function dn(n,o){var p=n.stateNode;if(p===null)return null;var b=p[ts]||null;if(b===null)return null;p=b[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(b=!b.disabled)||(n=n.type,b=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!b;break e;default:n=!1}if(n)return null;if(p&&typeof p!="function")throw Error("Expected `"+o+"` listener to be a function, instead got a value of `"+typeof p+"` type.");return p}function Cr(){if(fv)return fv;var n,o=x_,p=o.length,b,O="value"in Rc?Rc.value:Rc.textContent,z=O.length;for(n=0;n<p&&o[n]===O[n];n++);var W=p-n;for(b=1;b<=W&&o[p-b]===O[z-b];b++);return fv=O.slice(n,1<b?1-b:void 0)}function cr(n){var o=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&o===13&&(n=13)):n=o,n===10&&(n=13),32<=n||n===13?n:0}function lo(){return!0}function Ru(){return!1}function Wn(n){function o(p,b,O,z,W){this._reactName=p,this._targetInst=O,this.type=b,this.nativeEvent=z,this.target=W,this.currentTarget=null;for(var oe in n)n.hasOwnProperty(oe)&&(p=n[oe],this[oe]=p?p(z):z[oe]);return this.isDefaultPrevented=(z.defaultPrevented!=null?z.defaultPrevented:z.returnValue===!1)?lo:Ru,this.isPropagationStopped=Ru,this}return Fr(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var p=this.nativeEvent;p&&(p.preventDefault?p.preventDefault():typeof p.returnValue!="unknown"&&(p.returnValue=!1),this.isDefaultPrevented=lo)},stopPropagation:function(){var p=this.nativeEvent;p&&(p.stopPropagation?p.stopPropagation():typeof p.cancelBubble!="unknown"&&(p.cancelBubble=!0),this.isPropagationStopped=lo)},persist:function(){},isPersistent:lo}),o}function uc(n){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(n):(n=s1[n])?!!o[n]:!1}function ku(){return uc}function Sl(n,o){switch(n){case"keyup":return kc.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==_v;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function _o(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}function Ii(n,o){switch(n){case"compositionend":return _o(o);case"keypress":return o.which!==S_?null:(T_=!0,G0);case"textInput":return n=o.data,n===G0&&T_?null:n;default:return null}}function qa(n,o){if(vd)return n==="compositionend"||!Rh&&Sl(n,o)?(n=Cr(),fv=x_=Rc=null,vd=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return H0&&o.locale!=="ko"?null:o.data;default:return null}}function Ou(n){var o=n&&n.nodeName&&n.nodeName.toLowerCase();return o==="input"?!!fS[n.type]:o==="textarea"}function Mg(n){if(!$l)return!1;n="on"+n;var o=n in document;return o||(o=document.createElement("div"),o.setAttribute(n,"return;"),o=typeof o[n]=="function"),o}function Iu(n,o,p,b){rp?Dh?Dh.push(b):Dh=[b]:rp=b,o=Xe(o,"onChange"),0<o.length&&(p=new pv("onChange","change",null,p,b),n.push({event:p,listeners:o}))}function Gp(n){Ae(n,0)}function Vc(n){var o=ra(n);if(jn(o))return n}function ko(n,o){if(n==="change")return o}function Ha(){E_&&(E_.detachEvent("onpropertychange",Oo),A_=E_=null)}function Oo(n){if(n.propertyName==="value"&&Vc(A_)){var o=[];Iu(o,A_,n,Ns(n)),Mu(Gp,o)}}function hf(n,o,p){n==="focusin"?(Ha(),E_=o,A_=p,E_.attachEvent("onpropertychange",Oo)):n==="focusout"&&Ha()}function Ga(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Vc(A_)}function Hi(n,o){if(n==="click")return Vc(o)}function co(n,o){if(n==="input"||n==="change")return Vc(o)}function dc(n,o){return n===o&&(n!==0||1/n===1/o)||n!==n&&o!==o}function wi(n,o){if(bs(n,o))return!0;if(typeof n!="object"||n===null||typeof o!="object"||o===null)return!1;var p=Object.keys(n),b=Object.keys(o);if(p.length!==b.length)return!1;for(b=0;b<p.length;b++){var O=p[b];if(!_d.call(o,O)||!bs(n[O],o[O]))return!1}return!0}function $p(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function zs(n,o){var p=$p(n);n=0;for(var b;p;){if(p.nodeType===3){if(b=n+p.textContent.length,n<=o&&b>=o)return{node:p,offset:o-n};n=b}e:{for(;p;){if(p.nextSibling){p=p.nextSibling;break e}p=p.parentNode}p=void 0}p=$p(p)}}function Nu(n,o){return n&&o?n===o?!0:n&&n.nodeType===3?!1:o&&o.nodeType===3?Nu(n,o.parentNode):"contains"in n?n.contains(o):n.compareDocumentPosition?!!(n.compareDocumentPosition(o)&16):!1:!1}function hc(n){n=n!=null&&n.ownerDocument!=null&&n.ownerDocument.defaultView!=null?n.ownerDocument.defaultView:window;for(var o=Un(n.document);o instanceof n.HTMLIFrameElement;){try{var p=typeof o.contentWindow.location.href=="string"}catch{p=!1}if(p)n=o.contentWindow;else break;o=Un(n.document)}return o}function $a(n){var o=n&&n.nodeName&&n.nodeName.toLowerCase();return o&&(o==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||o==="textarea"||n.contentEditable==="true")}function by(n,o,p){var b=p.window===p?p.document:p.nodeType===9?p:p.ownerDocument;vv||cp==null||cp!==Un(b)||(b=cp,"selectionStart"in b&&$a(b)?b={start:b.selectionStart,end:b.selectionEnd}:(b=(b.ownerDocument&&b.ownerDocument.defaultView||window).getSelection(),b={anchorNode:b.anchorNode,anchorOffset:b.anchorOffset,focusNode:b.focusNode,focusOffset:b.focusOffset}),Jm&&wi(Jm,b)||(Jm=b,b=Xe(yv,"onSelect"),0<b.length&&(o=new pv("onSelect","select",null,o,p),n.push({event:o,listeners:b}),o.target=cp)))}function fs(n,o){var p={};return p[n.toLowerCase()]=o.toLowerCase(),p["Webkit"+n]="webkit"+o,p["Moz"+n]="moz"+o,p}function zu(n){if(xv[n])return xv[n];if(!Qm[n])return n;var o=Qm[n],p;for(p in o)if(o.hasOwnProperty(p)&&p in bv)return xv[n]=o[p];return n}function Ps(n,o){wv.set(n,o),yn(o,[n])}function Ci(n,o){if(typeof n=="object"&&n!==null){var p=Sv.get(n);return p!==void 0?p:(o={value:n,source:o,stack:je(o)},Sv.set(n,o),o)}return{value:n,source:o,stack:je(o)}}function Zp(){for(var n=pl,o=Y0=pl=0;o<n;){var p=Zl[o];Zl[o++]=null;var b=Zl[o];Zl[o++]=null;var O=Zl[o];Zl[o++]=null;var z=Zl[o];if(Zl[o++]=null,b!==null&&O!==null){var W=b.pending;W===null?O.next=O:(O.next=W.next,W.next=O),b.pending=O}z!==0&&wy(p,O,z)}}function Tl(n,o,p,b){Zl[pl++]=n,Zl[pl++]=o,Zl[pl++]=p,Zl[pl++]=b,Y0|=b,n.lanes|=b,n=n.alternate,n!==null&&(n.lanes|=b)}function Yp(n,o,p,b){return Tl(n,o,p,b),Wp(n)}function Io(n,o){return Tl(n,null,null,o),Wp(n)}function wy(n,o,p){n.lanes|=p;var b=n.alternate;b!==null&&(b.lanes|=p);for(var O=!1,z=n.return;z!==null;)z.childLanes|=p,b=z.alternate,b!==null&&(b.childLanes|=p),z.tag===22&&(n=z.stateNode,n===null||n._visibility&up||(O=!0)),n=z,z=z.return;return n.tag===3?(z=n.stateNode,O&&o!==null&&(O=31-$s(p),n=z.hiddenUpdates,b=n[O],b===null?n[O]=[o]:b.push(o),o.lane=p|536870912),z):null}function Wp(n){if(ey>q1)throw tf=ey=0,Rp=ef=null,Error("Maximum update depth exceeded. This can happen when a component repeatedly calls setState inside componentWillUpdate or componentDidUpdate. React limits the number of nested updates to prevent infinite loops.");tf>xS&&(tf=0,Rp=null,console.error("Maximum update depth exceeded. This can happen when a component calls setState inside useEffect, but useEffect either doesn't have a dependency array, or one of the dependencies changes on every render.")),n.alternate===null&&(n.flags&4098)!==0&&d(n);for(var o=n,p=o.return;p!==null;)o.alternate===null&&(o.flags&4098)!==0&&d(n),o=p,p=o.return;return o.tag===3?o.stateNode:null}function Za(n){if(Zs===null)return n;var o=Zs(n);return o===void 0?n:o.current}function Pu(n){if(Zs===null)return n;var o=Zs(n);return o===void 0?n!=null&&typeof n.render=="function"&&(o=Za(n.render),n.render!==o)?(o={$$typeof:dl,render:o},n.displayName!==void 0&&(o.displayName=n.displayName),o):n:o.current}function Sy(n,o){if(Zs===null)return!1;var p=n.elementType;o=o.type;var b=!1,O=typeof o=="object"&&o!==null?o.$$typeof:null;switch(n.tag){case 1:typeof o=="function"&&(b=!0);break;case 0:(typeof o=="function"||O===Wo)&&(b=!0);break;case 11:(O===dl||O===Wo)&&(b=!0);break;case 14:case 15:(O===h_||O===Wo)&&(b=!0);break;default:return!1}return!!(b&&(n=Zs(p),n!==void 0&&n===Zs(o)))}function qc(n){Zs!==null&&typeof WeakSet=="function"&&(gu===null&&(gu=new WeakSet),gu.add(n))}function fc(n,o,p){var b=n.alternate,O=n.child,z=n.sibling,W=n.tag,oe=n.type,Ce=null;switch(W){case 0:case 15:case 1:Ce=oe;break;case 11:Ce=oe.render}if(Zs===null)throw Error("Expected resolveFamily to be set during hot reload.");var Be=!1;oe=!1,Ce!==null&&(Ce=Zs(Ce),Ce!==void 0&&(p.has(Ce)?oe=!0:o.has(Ce)&&(W===1?oe=!0:Be=!0))),gu!==null&&(gu.has(n)||b!==null&&gu.has(b))&&(oe=!0),oe&&(n._debugNeedsRemount=!0),(oe||Be)&&(b=Io(n,2),b!==null&&Ei(b,n,2)),O===null||oe||fc(O,o,p),z!==null&&fc(z,o,p)}function Xp(n,o,p,b){this.tag=n,this.key=p,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=b,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null,this.actualDuration=-0,this.actualStartTime=-1.1,this.treeBaseDuration=this.selfBaseDuration=-0,this._debugTask=this._debugStack=this._debugOwner=this._debugInfo=null,this._debugNeedsRemount=!1,this._debugHookTypes=null,_1||typeof Object.preventExtensions!="function"||Object.preventExtensions(this)}function El(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Ya(n,o){var p=n.alternate;switch(p===null?(p=le(n.tag,o,n.key,n.mode),p.elementType=n.elementType,p.type=n.type,p.stateNode=n.stateNode,p._debugOwner=n._debugOwner,p._debugStack=n._debugStack,p._debugTask=n._debugTask,p._debugHookTypes=n._debugHookTypes,p.alternate=n,n.alternate=p):(p.pendingProps=o,p.type=n.type,p.flags=0,p.subtreeFlags=0,p.deletions=null,p.actualDuration=-0,p.actualStartTime=-1.1),p.flags=n.flags&65011712,p.childLanes=n.childLanes,p.lanes=n.lanes,p.child=n.child,p.memoizedProps=n.memoizedProps,p.memoizedState=n.memoizedState,p.updateQueue=n.updateQueue,o=n.dependencies,p.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext,_debugThenableState:o._debugThenableState},p.sibling=n.sibling,p.index=n.index,p.ref=n.ref,p.refCleanup=n.refCleanup,p.selfBaseDuration=n.selfBaseDuration,p.treeBaseDuration=n.treeBaseDuration,p._debugInfo=n._debugInfo,p._debugNeedsRemount=n._debugNeedsRemount,p.tag){case 0:case 15:p.type=Za(n.type);break;case 1:p.type=Za(n.type);break;case 11:p.type=Pu(n.type)}return p}function Ty(n,o){n.flags&=65011714;var p=n.alternate;return p===null?(n.childLanes=0,n.lanes=o,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null,n.selfBaseDuration=0,n.treeBaseDuration=0):(n.childLanes=p.childLanes,n.lanes=p.lanes,n.child=p.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=p.memoizedProps,n.memoizedState=p.memoizedState,n.updateQueue=p.updateQueue,n.type=p.type,o=p.dependencies,n.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext,_debugThenableState:o._debugThenableState},n.selfBaseDuration=p.selfBaseDuration,n.treeBaseDuration=p.treeBaseDuration),n}function Rg(n,o,p,b,O,z){var W=0,oe=n;if(typeof n=="function")El(n)&&(W=1),oe=Za(oe);else if(typeof n=="string")W=Nt(),W=Jw(n,p,W)?26:n==="html"||n==="head"||n==="body"?27:5;else e:switch(n){case v0:return o=le(31,p,o,O),o.elementType=v0,o.lanes=z,o;case Vl:return Lu(p.children,O,z,o);case u_:W=8,O|=Ys,O|=Ws;break;case g0:return n=p,b=O,typeof n.id!="string"&&console.error('Profiler must specify an "id" of type `string` as a prop. Received the type `%s` instead.',typeof n.id),o=le(12,n,o,b|ws),o.elementType=g0,o.lanes=z,o.stateNode={effectDuration:0,passiveEffectDuration:0},o;case d_:return o=le(13,p,o,O),o.elementType=d_,o.lanes=z,o;case y0:return o=le(19,p,o,O),o.elementType=y0,o.lanes=z,o;default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case Eb:case du:W=10;break e;case _0:W=9;break e;case dl:W=11,oe=Pu(oe);break e;case h_:W=14;break e;case Wo:W=16,oe=null;break e}oe="",(n===void 0||typeof n=="object"&&n!==null&&Object.keys(n).length===0)&&(oe+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports."),n===null?p="null":es(n)?p="array":n!==void 0&&n.$$typeof===gd?(p="<"+(xt(n.type)||"Unknown")+" />",oe=" Did you accidentally export a JSX literal instead of a component?"):p=typeof n,(W=b?rn(b):null)&&(oe+=`

Check the render method of \``+W+"`."),W=29,p=Error("Element type is invalid: expected a string (for built-in components) or a class/function (for composite components) but got: "+(p+"."+oe)),oe=null}return o=le(W,p,o,O),o.elementType=n,o.type=oe,o.lanes=z,o._debugOwner=b,o}function ff(n,o,p){return o=Rg(n.type,n.key,n.props,n._owner,o,p),o._debugOwner=n._owner,o._debugStack=n._debugStack,o._debugTask=n._debugTask,o}function Lu(n,o,p,b){return n=le(7,n,b,o),n.lanes=p,n}function Al(n,o,p){return n=le(6,n,null,o),n.lanes=p,n}function Xn(n,o,p){return o=le(4,n.children!==null?n.children:[],n.key,o),o.lanes=p,o.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},o}function _n(n,o){ba(),dp[tg++]=Ev,dp[tg++]=M_,M_=n,Ev=o}function pf(n,o,p){ba(),ml[Wl++]=xd,ml[Wl++]=bd,ml[Wl++]=Ih,Ih=n;var b=xd;n=bd;var O=32-$s(b)-1;b&=~(1<<O),p+=1;var z=32-$s(o)+O;if(30<z){var W=O-O%5;z=(b&(1<<W)-1).toString(32),b>>=W,O-=W,xd=1<<32-$s(o)+O|p<<O|b,bd=z+n}else xd=1<<z|p<<O|b,bd=n}function Bn(n){ba(),n.return!==null&&(_n(n,1),pf(n,1,0))}function Wa(n){for(;n===M_;)M_=dp[--tg],dp[tg]=null,Ev=dp[--tg],dp[tg]=null;for(;n===Ih;)Ih=ml[--Wl],ml[Wl]=null,bd=ml[--Wl],ml[Wl]=null,xd=ml[--Wl],ml[Wl]=null}function ba(){Jr||console.error("Expected to be hydrating. This is a bug in React. Please file an issue.")}function Dn(n,o){if(n.return===null){if(Kl===null)Kl={fiber:n,children:[],serverProps:void 0,serverTail:[],distanceFromLeaf:o};else{if(Kl.fiber!==n)throw Error("Saw multiple hydration diff roots in a pass. This is a bug in React.");Kl.distanceFromLeaf>o&&(Kl.distanceFromLeaf=o)}return Kl}var p=Dn(n.return,o+1).children;return 0<p.length&&p[p.length-1].fiber===n?(p=p[p.length-1],p.distanceFromLeaf>o&&(p.distanceFromLeaf=o),p):(o={fiber:n,children:[],serverProps:void 0,serverTail:[],distanceFromLeaf:o},p.push(o),o)}function mf(n,o){Xl||(n=Dn(n,0),n.serverProps=null,o!==null&&(o=Fl(o),n.serverTail.push(o)))}function la(n){var o="",p=Kl;throw p!==null&&(Kl=null,o=sa(p)),zt(Ci(Error(`Hydration failed because the server rendered HTML didn't match the client. As a result this tree will be regenerated on the client. This can happen if a SSR-ed Client Component used:

- A server/client branch \`if (typeof window !== 'undefined')\`.
- Variable input such as \`Date.now()\` or \`Math.random()\` which changes each time it's called.
- Date formatting in a user's locale which doesn't match the server.
- External changing data without sending a snapshot of it along with the HTML.
- Invalid HTML tag nesting.

It can also happen if the client has a browser extension installed which messes with the HTML before React loaded.

https://react.dev/link/hydration-mismatch`+o),n)),ng}function Bu(n){var o=n.stateNode,p=n.type,b=n.memoizedProps;switch(o[Po]=n,o[ts]=b,Mt(p,b),p){case"dialog":ve("cancel",o),ve("close",o);break;case"iframe":case"object":case"embed":ve("load",o);break;case"video":case"audio":for(p=0;p<S.length;p++)ve(S[p],o);break;case"source":ve("error",o);break;case"img":case"image":case"link":ve("error",o),ve("load",o);break;case"details":ve("toggle",o);break;case"input":kn("input",b),ve("invalid",o),Wr(o,b),Qn(o,b.value,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name,!0),Nn(o);break;case"option":Rr(o,b);break;case"select":kn("select",b),ve("invalid",o),ro(o,b);break;case"textarea":kn("textarea",b),ve("invalid",o),Mo(o,b),Vo(o,b.value,b.defaultValue,b.children),Nn(o)}p=b.children,typeof p!="string"&&typeof p!="number"&&typeof p!="bigint"||o.textContent===""+p||b.suppressHydrationWarning===!0||yt(o.textContent,p)?(b.popover!=null&&(ve("beforetoggle",o),ve("toggle",o)),b.onScroll!=null&&ve("scroll",o),b.onScrollEnd!=null&&ve("scrollend",o),b.onClick!=null&&(o.onclick=st),o=!0):o=!1,o||la(n)}function Kp(n){for(rs=n.return;rs;)switch(rs.tag){case 5:case 13:Jl=!1;return;case 27:case 3:Jl=!0;return;default:rs=rs.return}}function Cl(n){if(n!==rs)return!1;if(!Jr)return Kp(n),Jr=!0,!1;var o=n.tag,p;if((p=o!==3&&o!==27)&&((p=o===5)&&(p=n.type,p=!(p!=="form"&&p!=="button")||Dr(n.type,n.memoizedProps)),p=!p),p&&Zi){for(p=Zi;p;){var b=Dn(n,0),O=Fl(p);b.serverTail.push(O),p=O.type==="Suspense"?Ul(p):Pi(p.nextSibling)}la(n)}if(Kp(n),o===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error("Expected to have a hydrated suspense instance. This error is likely caused by a bug in React. Please file an issue.");Zi=Ul(n)}else o===27?(o=Zi,Fi(n.type)?(n=On,On=null,Zi=n):Zi=o):Zi=rs?Pi(n.stateNode.nextSibling):null;return!0}function mi(){Zi=rs=null,Xl=Jr=!1}function Gd(){var n=wd;return n!==null&&(xa===null?xa=n:xa.push.apply(xa,n),wd=null),n}function zt(n){wd===null?wd=[n]:wd.push(n)}function gf(){var n=Kl;if(n!==null){Kl=null;for(var o=sa(n);0<n.children.length;)n=n.children[0];Ye(n.fiber,function(){console.error(`A tree hydrated but some attributes of the server rendered HTML didn't match the client properties. This won't be patched up. This can happen if a SSR-ed Client Component used:

- A server/client branch \`if (typeof window !== 'undefined')\`.
- Variable input such as \`Date.now()\` or \`Math.random()\` which changes each time it's called.
- Date formatting in a user's locale which doesn't match the server.
- External changing data without sending a snapshot of it along with the HTML.
- Invalid HTML tag nesting.

It can also happen if the client has a browser extension installed which messes with the HTML before React loaded.

%s%s`,"https://react.dev/link/hydration-mismatch",o)})}}function wa(){hp=k_=null,fp=!1}function zi(n,o,p){ln(R_,o._currentValue,n),o._currentValue=p,ln(rg,o._currentRenderer,n),o._currentRenderer!==void 0&&o._currentRenderer!==null&&o._currentRenderer!==K0&&console.error("Detected multiple renderers concurrently rendering the same context provider. This is currently unsupported."),o._currentRenderer=K0}function Dl(n,o){n._currentValue=R_.current;var p=rg.current;Rt(rg,o),n._currentRenderer=p,Rt(R_,o)}function $d(n,o,p){for(;n!==null;){var b=n.alternate;if((n.childLanes&o)!==o?(n.childLanes|=o,b!==null&&(b.childLanes|=o)):b!==null&&(b.childLanes&o)!==o&&(b.childLanes|=o),n===p)break;n=n.return}n!==p&&console.error("Expected to find the propagation root when scheduling context work. This error is likely caused by a bug in React. Please file an issue.")}function Xa(n,o,p,b){var O=n.child;for(O!==null&&(O.return=n);O!==null;){var z=O.dependencies;if(z!==null){var W=O.child;z=z.firstContext;e:for(;z!==null;){var oe=z;z=O;for(var Ce=0;Ce<o.length;Ce++)if(oe.context===o[Ce]){z.lanes|=p,oe=z.alternate,oe!==null&&(oe.lanes|=p),$d(z.return,p,n),b||(W=null);break e}z=oe.next}}else if(O.tag===18){if(W=O.return,W===null)throw Error("We just came from a parent so we must have had a parent. This is a bug in React.");W.lanes|=p,z=W.alternate,z!==null&&(z.lanes|=p),$d(W,p,n),W=null}else W=O.child;if(W!==null)W.return=O;else for(W=O;W!==null;){if(W===n){W=null;break}if(O=W.sibling,O!==null){O.return=W.return,W=O;break}W=W.return}O=W}}function Ml(n,o,p,b){n=null;for(var O=o,z=!1;O!==null;){if(!z){if((O.flags&524288)!==0)z=!0;else if((O.flags&262144)!==0)break}if(O.tag===10){var W=O.alternate;if(W===null)throw Error("Should have a current fiber. This is a bug in React.");if(W=W.memoizedProps,W!==null){var oe=O.type;bs(O.pendingProps.value,W.value)||(n!==null?n.push(oe):n=[oe])}}else if(O===Jy.current){if(W=O.alternate,W===null)throw Error("Should have a current fiber. This is a bug in React.");W.memoizedState.memoizedState!==O.memoizedState.memoizedState&&(n!==null?n.push(ki):n=[ki])}O=O.return}n!==null&&Xa(o,n,p,b),o.flags|=262144}function Ka(n){for(n=n.firstContext;n!==null;){if(!bs(n.context._currentValue,n.memoizedValue))return!0;n=n.next}return!1}function Sa(n){k_=n,hp=null,n=n.dependencies,n!==null&&(n.firstContext=null)}function Si(n){return fp&&console.error("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo()."),Ey(k_,n)}function Jp(n,o){return k_===null&&Sa(n),Ey(n,o)}function Ey(n,o){var p=o._currentValue;if(o={context:o,memoizedValue:p,next:null},hp===null){if(n===null)throw Error("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().");hp=o,n.dependencies={lanes:0,firstContext:o,_debugThenableState:null},n.flags|=524288}else hp=hp.next=o;return p}function _f(){return{controller:new J0,data:new Map,refCount:0}}function Hc(n){n.controller.signal.aborted&&console.warn("A cache instance was retained after it was already freed. This likely indicates a bug in React."),n.refCount++}function Zd(n){n.refCount--,0>n.refCount&&console.warn("A cache instance was released after it was already freed. This likely indicates a bug in React."),n.refCount===0&&Q0(ex,function(){n.controller.abort()})}function Rl(){var n=Nh;return Nh=0,n}function Fu(n){var o=Nh;return Nh=n,o}function yf(n){var o=Nh;return Nh+=n,o}function pc(n){Ss=Sd(),0>n.actualStartTime&&(n.actualStartTime=Ss)}function kg(n){if(0<=Ss){var o=Sd()-Ss;n.actualDuration+=o,n.selfBaseDuration=o,Ss=-1}}function Ay(n){if(0<=Ss){var o=Sd()-Ss;n.actualDuration+=o,Ss=-1}}function ca(){if(0<=Ss){var n=Sd()-Ss;Ss=-1,Nh+=n}}function Ja(){Ss=Sd()}function Gc(n){for(var o=n.child;o;)n.actualDuration+=o.actualDuration,o=o.sibling}function Qa(n,o){if(ig===null){var p=ig=[];Dv=0,zh=te(),pp={status:"pending",value:void 0,then:function(b){p.push(b)}}}return Dv++,o.then(Qp,Qp),o}function Qp(){if(--Dv===0&&ig!==null){pp!==null&&(pp.status="fulfilled");var n=ig;ig=null,zh=0,pp=null;for(var o=0;o<n.length;o++)(0,n[o])()}}function em(n,o){var p=[],b={status:"pending",value:null,reason:null,then:function(O){p.push(O)}};return n.then(function(){b.status="fulfilled",b.value=o;for(var O=0;O<p.length;O++)(0,p[O])(o)},function(O){for(b.status="rejected",b.reason=O,O=0;O<p.length;O++)(0,p[O])(void 0)}),b}function Uu(){var n=Ph.current;return n!==null?n:Li.pooledCache}function ju(n,o){o===null?ln(Ph,Ph.current,n):ln(Ph,o.pool,n)}function mc(){var n=Uu();return n===null?null:{parent:Eo._currentValue,pool:n}}function vf(){return{didWarnAboutUncachedPromise:!1,thenables:[]}}function tm(n){return n=n.status,n==="fulfilled"||n==="rejected"}function kl(){}function Vu(n,o,p){Pt.actQueue!==null&&(Pt.didUsePromise=!0);var b=n.thenables;switch(p=b[p],p===void 0?b.push(o):p!==o&&(n.didWarnAboutUncachedPromise||(n.didWarnAboutUncachedPromise=!0,console.error("A component was suspended by an uncached promise. Creating promises inside a Client Component or hook is not yet supported, except via a Suspense-compatible library or framework.")),o.then(kl,kl),o=p),o.status){case"fulfilled":return o.value;case"rejected":throw n=o.reason,Wd(n),n;default:if(typeof o.status=="string")o.then(kl,kl);else{if(n=Li,n!==null&&100<n.shellSuspendCounter)throw Error("An unknown Component is an async Client Component. Only Server Components can be async at the moment. This error is often caused by accidentally adding `'use client'` to a module that was originally written for the server.");n=o,n.status="pending",n.then(function(O){if(o.status==="pending"){var z=o;z.status="fulfilled",z.value=O}},function(O){if(o.status==="pending"){var z=o;z.status="rejected",z.reason=O}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw n=o.reason,Wd(n),n}throw L_=o,Rv=!0,_p}}function Yd(){if(L_===null)throw Error("Expected a suspended thenable. This is a bug in React. Please file an issue.");var n=L_;return L_=null,Rv=!1,n}function Wd(n){if(n===_p||n===Mv)throw Error("Hooks are not supported inside an async component. This error is often caused by accidentally adding `'use client'` to a module that was originally written for the server.")}function el(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function gc(n,o){n=n.updateQueue,o.updateQueue===n&&(o.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,callbacks:null})}function ua(n){return{lane:n,tag:ix,payload:null,callback:null,next:null}}function Ol(n,o,p){var b=n.updateQueue;if(b===null)return null;if(b=b.shared,Ed===b&&!ax){var O=Ut(n);console.error(`An update (setState, replaceState, or forceUpdate) was scheduled from inside an update function. Update functions should be pure, with zero side-effects. Consider using componentDidUpdate or a callback.

Please update the following component: %s`,O),ax=!0}return(Ai&Xs)!==Na?(O=b.pending,O===null?o.next=o:(o.next=O.next,O.next=o),b.pending=o,o=Wp(n),wy(n,null,p),o):(Tl(n,b,o,p),Wp(n))}function $c(n,o,p){if(o=o.updateQueue,o!==null&&(o=o.shared,(p&4194048)!==0)){var b=o.lanes;b&=n.pendingLanes,p|=b,o.lanes=p,Fa(n,p)}}function Zc(n,o){var p=n.updateQueue,b=n.alternate;if(b!==null&&(b=b.updateQueue,p===b)){var O=null,z=null;if(p=p.firstBaseUpdate,p!==null){do{var W={lane:p.lane,tag:p.tag,payload:p.payload,callback:null,next:null};z===null?O=z=W:z=z.next=W,p=p.next}while(p!==null);z===null?O=z=o:z=z.next=o}else O=z=o;p={baseState:b.baseState,firstBaseUpdate:O,lastBaseUpdate:z,shared:b.shared,callbacks:b.callbacks},n.updateQueue=p;return}n=p.lastBaseUpdate,n===null?p.firstBaseUpdate=o:n.next=o,p.lastBaseUpdate=o}function Ls(){if(Fh){var n=pp;if(n!==null)throw n}}function er(n,o,p,b){Fh=!1;var O=n.updateQueue;Td=!1,Ed=O.shared;var z=O.firstBaseUpdate,W=O.lastBaseUpdate,oe=O.shared.pending;if(oe!==null){O.shared.pending=null;var Ce=oe,Be=Ce.next;Ce.next=null,W===null?z=Be:W.next=Be,W=Ce;var Dt=n.alternate;Dt!==null&&(Dt=Dt.updateQueue,oe=Dt.lastBaseUpdate,oe!==W&&(oe===null?Dt.firstBaseUpdate=Be:oe.next=Be,Dt.lastBaseUpdate=Ce))}if(z!==null){var Ft=O.baseState;W=0,Dt=Be=Ce=null,oe=z;do{var Et=oe.lane&-536870913,Gt=Et!==oe.lane;if(Gt?(Tr&Et)===Et:(b&Et)===Et){Et!==0&&Et===zh&&(Fh=!0),Dt!==null&&(Dt=Dt.next={lane:0,tag:oe.tag,payload:oe.payload,callback:null,next:null});e:{Et=n;var Hn=oe,Mr=o,Yi=p;switch(Hn.tag){case ox:if(Hn=Hn.payload,typeof Hn=="function"){fp=!0;var oi=Hn.call(Yi,Ft,Mr);if(Et.mode&Ys){rr(!0);try{Hn.call(Yi,Ft,Mr)}finally{rr(!1)}}fp=!1,Ft=oi;break e}Ft=Hn;break e;case B_:Et.flags=Et.flags&-65537|128;case ix:if(oi=Hn.payload,typeof oi=="function"){if(fp=!0,Hn=oi.call(Yi,Ft,Mr),Et.mode&Ys){rr(!0);try{oi.call(Yi,Ft,Mr)}finally{rr(!1)}}fp=!1}else Hn=oi;if(Hn==null)break e;Ft=Fr({},Ft,Hn);break e;case sx:Td=!0}}Et=oe.callback,Et!==null&&(n.flags|=64,Gt&&(n.flags|=8192),Gt=O.callbacks,Gt===null?O.callbacks=[Et]:Gt.push(Et))}else Gt={lane:Et,tag:oe.tag,payload:oe.payload,callback:oe.callback,next:null},Dt===null?(Be=Dt=Gt,Ce=Ft):Dt=Dt.next=Gt,W|=Et;if(oe=oe.next,oe===null){if(oe=O.shared.pending,oe===null)break;Gt=oe,oe=Gt.next,Gt.next=null,O.lastBaseUpdate=Gt,O.shared.pending=null}}while(!0);Dt===null&&(Ce=Ft),O.baseState=Ce,O.firstBaseUpdate=Be,O.lastBaseUpdate=Dt,z===null&&(O.shared.lanes=0),yl|=W,n.lanes=W,n.memoizedState=Ft}Ed=null}function Og(n,o){if(typeof n!="function")throw Error("Invalid argument passed as callback. Expected a function. Instead received: "+n);n.call(o)}function Cy(n,o){var p=n.shared.hiddenCallbacks;if(p!==null)for(n.shared.hiddenCallbacks=null,n=0;n<p.length;n++)Og(p[n],o)}function qu(n,o){var p=n.callbacks;if(p!==null)for(n.callbacks=null,n=0;n<p.length;n++)Og(p[n],o)}function nm(n,o){var p=rc;ln(Uh,p,n),ln(yp,o,n),rc=p|o.baseLanes}function Ig(n){ln(Uh,rc,n),ln(yp,yp.current,n)}function ni(n){rc=Uh.current,Rt(yp,n),Rt(Uh,n)}function qr(){var n=Lt;nc===null?nc=[n]:nc.push(n)}function gn(){var n=Lt;if(nc!==null&&(vu++,nc[vu]!==n)){var o=Ut(ur);if(!kv.has(o)&&(kv.add(o),nc!==null)){for(var p="",b=0;b<=vu;b++){var O=nc[b],z=b===vu?n:O;for(O=b+1+". "+O;30>O.length;)O+=" ";O+=z+`
`,p+=O}console.error(`React has detected a change in the order of Hooks called by %s. This will lead to bugs and errors if not fixed. For more information, read the Rules of Hooks: https://react.dev/link/rules-of-hooks

   Previous render            Next render
   ------------------------------------------------------
%s   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
`,o,p)}}}function Yc(n){n==null||es(n)||console.error("%s received a final argument that is not an array (instead, received `%s`). When specified, the final argument must be an array.",Lt,typeof n)}function Xd(){var n=Ut(ur);vp.has(n)||(vp.add(n),console.error("ReactDOM.useFormState has been renamed to React.useActionState. Please update %s to use React.useActionState.",n))}function Gi(){throw Error(`Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:
1. You might have mismatching versions of React and the renderer (such as React DOM)
2. You might be breaking the Rules of Hooks
3. You might have more than one copy of React in the same app
See https://react.dev/link/invalid-hook-call for tips about how to debug and fix this problem.`)}function rm(n,o){if(Cd)return!1;if(o===null)return console.error("%s received a final argument during this render, but not during the previous render. Even though the final argument is optional, its type cannot change between renders.",Lt),!1;n.length!==o.length&&console.error(`The final argument passed to %s changed size between renders. The order and size of this array must remain constant.

Previous: %s
Incoming: %s`,Lt,"["+o.join(", ")+"]","["+n.join(", ")+"]");for(var p=0;p<o.length&&p<n.length;p++)if(!bs(n[p],o[p]))return!1;return!0}function im(n,o,p,b,O,z){_u=z,ur=o,nc=n!==null?n._debugHookTypes:null,vu=-1,Cd=n!==null&&n.type!==o.type,(Object.prototype.toString.call(p)==="[object AsyncFunction]"||Object.prototype.toString.call(p)==="[object AsyncGeneratorFunction]")&&(z=Ut(ur),U_.has(z)||(U_.add(z),console.error("%s is an async Client Component. Only Server Components can be async at the moment. This error is often caused by accidentally adding `'use client'` to a module that was originally written for the server.",z===null?"An unknown Component":"<"+z+">"))),o.memoizedState=null,o.updateQueue=null,o.lanes=0,Pt.H=n!==null&&n.memoizedState!==null?wp:nc!==null?bp:Dd,yu=z=(o.mode&Ys)!==Mi;var W=Sp(p,b,O);if(yu=!1,xp&&(W=Hu(o,p,b,O)),z){rr(!0);try{W=Hu(o,p,b,O)}finally{rr(!1)}}return Dy(n,o),W}function Dy(n,o){o._debugHookTypes=nc,o.dependencies===null?Ad!==null&&(o.dependencies={lanes:0,firstContext:null,_debugThenableState:Ad}):o.dependencies._debugThenableState=Ad,Pt.H=lg;var p=Oi!==null&&Oi.next!==null;if(_u=0,nc=Lt=Ao=Oi=ur=null,vu=-1,n!==null&&(n.flags&65011712)!==(o.flags&65011712)&&console.error("Internal React error: Expected static flag was missing. Please notify the React team."),j_=!1,V_=0,Ad=null,p)throw Error("Rendered fewer hooks than expected. This may be caused by an accidental early return statement.");n===null||Xo||(n=n.dependencies,n!==null&&Ka(n)&&(Xo=!0)),Rv?(Rv=!1,n=!0):n=!1,n&&(o=Ut(o)||"Unknown",F_.has(o)||U_.has(o)||(F_.add(o),console.error("`use` was called from inside a try/catch block. This is not allowed and can lead to unexpected behavior. To handle errors triggered by `use`, wrap your component in a error boundary.")))}function Hu(n,o,p,b){ur=n;var O=0;do{if(xp&&(Ad=null),V_=0,xp=!1,O>=mS)throw Error("Too many re-renders. React limits the number of renders to prevent an infinite loop.");if(O+=1,Cd=!1,Ao=Oi=null,n.updateQueue!=null){var z=n.updateQueue;z.lastEffect=null,z.events=null,z.stores=null,z.memoCache!=null&&(z.memoCache.index=0)}vu=-1,Pt.H=Ov,z=Sp(o,p,b)}while(xp);return z}function xf(){var n=Pt.H,o=n.useState()[0];return o=typeof o.then=="function"?Gu(o):o,n=n.useState()[0],(Oi!==null?Oi.memoizedState:null)!==n&&(ur.flags|=1024),o}function om(){var n=jh!==0;return jh=0,n}function ps(n,o,p){o.updateQueue=n.updateQueue,o.flags=(o.mode&Ws)!==Mi?o.flags&-402655237:o.flags&-2053,n.lanes&=~p}function bf(n){if(j_){for(n=n.memoizedState;n!==null;){var o=n.queue;o!==null&&(o.pending=null),n=n.next}j_=!1}_u=0,nc=Ao=Oi=ur=null,vu=-1,Lt=null,xp=!1,V_=jh=0,Ad=null}function qo(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ao===null?ur.memoizedState=Ao=n:Ao=Ao.next=n,Ao}function ai(){if(Oi===null){var n=ur.alternate;n=n!==null?n.memoizedState:null}else n=Oi.next;var o=Ao===null?ur.memoizedState:Ao.next;if(o!==null)Ao=o,Oi=n;else{if(n===null)throw ur.alternate===null?Error("Update hook called on initial render. This is likely a bug in React. Please file an issue."):Error("Rendered more hooks than during the previous render.");Oi=n,n={memoizedState:Oi.memoizedState,baseState:Oi.baseState,baseQueue:Oi.baseQueue,queue:Oi.queue,next:null},Ao===null?ur.memoizedState=Ao=n:Ao=Ao.next=n}return Ao}function wf(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Gu(n){var o=V_;return V_+=1,Ad===null&&(Ad=vf()),n=Vu(Ad,n,o),o=ur,(Ao===null?o.memoizedState:Ao.next)===null&&(o=o.alternate,Pt.H=o!==null&&o.memoizedState!==null?wp:Dd),n}function Il(n){if(n!==null&&typeof n=="object"){if(typeof n.then=="function")return Gu(n);if(n.$$typeof===du)return Si(n)}throw Error("An unsupported type was passed to use(): "+String(n))}function Nl(n){var o=null,p=ur.updateQueue;if(p!==null&&(o=p.memoCache),o==null){var b=ur.alternate;b!==null&&(b=b.updateQueue,b!==null&&(b=b.memoCache,b!=null&&(o={data:b.data.map(function(O){return O.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),p===null&&(p=wf(),ur.updateQueue=p),p.memoCache=o,p=o.data[o.index],p===void 0||Cd)for(p=o.data[o.index]=Array(n),b=0;b<n;b++)p[b]=Ac;else p.length!==n&&console.error("Expected a constant size argument for each invocation of useMemoCache. The previous cache was allocated with size %s but size %s was requested.",p.length,n);return o.index++,p}function da(n,o){return typeof o=="function"?o(n):o}function Sf(n,o,p){var b=qo();if(p!==void 0){var O=p(o);if(yu){rr(!0);try{p(o)}finally{rr(!1)}}}else O=o;return b.memoizedState=b.baseState=O,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:O},b.queue=n,n=n.dispatch=Ny.bind(null,ur,n),[b.memoizedState,n]}function _c(n){var o=ai();return sm(o,Oi,n)}function sm(n,o,p){var b=n.queue;if(b===null)throw Error("Should have a queue. You are likely calling Hooks conditionally, which is not allowed. (https://react.dev/link/invalid-hook-call)");b.lastRenderedReducer=p;var O=n.baseQueue,z=b.pending;if(z!==null){if(O!==null){var W=O.next;O.next=z.next,z.next=W}o.baseQueue!==O&&console.error("Internal error: Expected work-in-progress queue to be a clone. This is a bug in React."),o.baseQueue=O=z,b.pending=null}if(z=n.baseState,O===null)n.memoizedState=z;else{o=O.next;var oe=W=null,Ce=null,Be=o,Dt=!1;do{var Ft=Be.lane&-536870913;if(Ft!==Be.lane?(Tr&Ft)===Ft:(_u&Ft)===Ft){var Et=Be.revertLane;if(Et===0)Ce!==null&&(Ce=Ce.next={lane:0,revertLane:0,action:Be.action,hasEagerState:Be.hasEagerState,eagerState:Be.eagerState,next:null}),Ft===zh&&(Dt=!0);else if((_u&Et)===Et){Be=Be.next,Et===zh&&(Dt=!0);continue}else Ft={lane:0,revertLane:Be.revertLane,action:Be.action,hasEagerState:Be.hasEagerState,eagerState:Be.eagerState,next:null},Ce===null?(oe=Ce=Ft,W=z):Ce=Ce.next=Ft,ur.lanes|=Et,yl|=Et;Ft=Be.action,yu&&p(z,Ft),z=Be.hasEagerState?Be.eagerState:p(z,Ft)}else Et={lane:Ft,revertLane:Be.revertLane,action:Be.action,hasEagerState:Be.hasEagerState,eagerState:Be.eagerState,next:null},Ce===null?(oe=Ce=Et,W=z):Ce=Ce.next=Et,ur.lanes|=Ft,yl|=Ft;Be=Be.next}while(Be!==null&&Be!==o);if(Ce===null?W=z:Ce.next=oe,!bs(z,n.memoizedState)&&(Xo=!0,Dt&&(p=pp,p!==null)))throw p;n.memoizedState=z,n.baseState=W,n.baseQueue=Ce,b.lastRenderedState=z}return O===null&&(b.lanes=0),[n.memoizedState,b.dispatch]}function Kd(n){var o=ai(),p=o.queue;if(p===null)throw Error("Should have a queue. You are likely calling Hooks conditionally, which is not allowed. (https://react.dev/link/invalid-hook-call)");p.lastRenderedReducer=n;var b=p.dispatch,O=p.pending,z=o.memoizedState;if(O!==null){p.pending=null;var W=O=O.next;do z=n(z,W.action),W=W.next;while(W!==O);bs(z,o.memoizedState)||(Xo=!0),o.memoizedState=z,o.baseQueue===null&&(o.baseState=z),p.lastRenderedState=z}return[z,b]}function Wc(n,o,p){var b=ur,O=qo();if(Jr){if(p===void 0)throw Error("Missing getServerSnapshot, which is required for server-rendered content. Will revert to client rendering.");var z=p();ag||z===p()||(console.error("The result of getServerSnapshot should be cached to avoid an infinite loop"),ag=!0)}else{if(z=o(),ag||(p=o(),bs(z,p)||(console.error("The result of getSnapshot should be cached to avoid an infinite loop"),ag=!0)),Li===null)throw Error("Expected a work-in-progress root. This is a bug in React. Please file an issue.");(Tr&124)!==0||My(b,o,z)}return O.memoizedState=z,p={value:z,getSnapshot:o},O.queue=p,Xu(ky.bind(null,b,p,n),[n]),b.flags|=2048,Wu(tc|uo,Xc(),Ry.bind(null,b,p,z,o),null),z}function am(n,o,p){var b=ur,O=ai(),z=Jr;if(z){if(p===void 0)throw Error("Missing getServerSnapshot, which is required for server-rendered content. Will revert to client rendering.");p=p()}else if(p=o(),!ag){var W=o();bs(p,W)||(console.error("The result of getSnapshot should be cached to avoid an infinite loop"),ag=!0)}(W=!bs((Oi||O).memoizedState,p))&&(O.memoizedState=p,Xo=!0),O=O.queue;var oe=ky.bind(null,b,O,n);if(Jo(2048,uo,oe,[n]),O.getSnapshot!==o||W||Ao!==null&&Ao.memoizedState.tag&tc){if(b.flags|=2048,Wu(tc|uo,Xc(),Ry.bind(null,b,O,p,o),null),Li===null)throw Error("Expected a work-in-progress root. This is a bug in React. Please file an issue.");z||(_u&124)!==0||My(b,o,p)}return p}function My(n,o,p){n.flags|=16384,n={getSnapshot:o,value:p},o=ur.updateQueue,o===null?(o=wf(),ur.updateQueue=o,o.stores=[n]):(p=o.stores,p===null?o.stores=[n]:p.push(n))}function Ry(n,o,p,b){o.value=p,o.getSnapshot=b,Oy(o)&&Iy(n)}function ky(n,o,p){return p(function(){Oy(o)&&Iy(n)})}function Oy(n){var o=n.getSnapshot;n=n.value;try{var p=o();return!bs(n,p)}catch{return!0}}function Iy(n){var o=Io(n,2);o!==null&&Ei(o,n,2)}function $u(n){var o=qo();if(typeof n=="function"){var p=n;if(n=p(),yu){rr(!0);try{p()}finally{rr(!1)}}}return o.memoizedState=o.baseState=n,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:da,lastRenderedState:n},o}function Tf(n){n=$u(n);var o=n.queue,p=If.bind(null,ur,o);return o.dispatch=p,[n.memoizedState,p]}function Ef(n){var o=qo();o.memoizedState=o.baseState=n;var p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=p,o=mm.bind(null,ur,!0,p),p.dispatch=o,[n,o]}function Zu(n,o){var p=ai();return Ng(p,Oi,n,o)}function Ng(n,o,p,b){return n.baseState=p,sm(n,Oi,typeof b=="function"?b:da)}function zg(n,o){var p=ai();return Oi!==null?Ng(p,Oi,n,o):(p.baseState=n,[n,p.queue.dispatch])}function Pg(n,o,p,b,O){if(nh(n))throw Error("Cannot update form state while rendering.");if(n=o.action,n!==null){var z={payload:O,action:n,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(W){z.listeners.push(W)}};Pt.T!==null?p(!0):z.isTransition=!1,b(z),p=o.pending,p===null?(z.next=o.pending=z,Af(o,z)):(z.next=p.next,o.pending=p.next=z)}}function Af(n,o){var p=o.action,b=o.payload,O=n.state;if(o.isTransition){var z=Pt.T,W={};Pt.T=W,Pt.T._updatedFibers=new Set;try{var oe=p(O,b),Ce=Pt.S;Ce!==null&&Ce(W,oe),ha(n,o,oe)}catch(Be){tl(n,o,Be)}finally{Pt.T=z,z===null&&W._updatedFibers&&(n=W._updatedFibers.size,W._updatedFibers.clear(),10<n&&console.warn("Detected a large number of updates inside startTransition. If this is due to a subscription please re-write it to use React provided hooks. Otherwise concurrent mode guarantees are off the table."))}}else try{W=p(O,b),ha(n,o,W)}catch(Be){tl(n,o,Be)}}function ha(n,o,p){p!==null&&typeof p=="object"&&typeof p.then=="function"?(p.then(function(b){lm(n,o,b)},function(b){return tl(n,o,b)}),o.isTransition||console.error("An async function with useActionState was called outside of a transition. This is likely not what you intended (for example, isPending will not update correctly). Either call the returned function inside startTransition, or pass it to an `action` or `formAction` prop.")):lm(n,o,p)}function lm(n,o,p){o.status="fulfilled",o.value=p,cm(o),n.state=p,o=n.pending,o!==null&&(p=o.next,p===o?n.pending=null:(p=p.next,o.next=p,Af(n,p)))}function tl(n,o,p){var b=n.pending;if(n.pending=null,b!==null){b=b.next;do o.status="rejected",o.reason=p,cm(o),o=o.next;while(o!==b)}n.action=null}function cm(n){n=n.listeners;for(var o=0;o<n.length;o++)(0,n[o])()}function Yu(n,o){return o}function yc(n,o){if(Jr){var p=Li.formState;if(p!==null){e:{var b=ur;if(Jr){if(Zi){t:{for(var O=Zi,z=Jl;O.nodeType!==8;){if(!z){O=null;break t}if(O=Pi(O.nextSibling),O===null){O=null;break t}}z=O.data,O=z===Ge||z===Ve?O:null}if(O){Zi=Pi(O.nextSibling),b=O.data===Ge;break e}}la(b)}b=!1}b&&(o=p[0])}}return p=qo(),p.memoizedState=p.baseState=o,b={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Yu,lastRenderedState:o},p.queue=b,p=If.bind(null,ur,b),b.dispatch=p,b=$u(!1),z=mm.bind(null,ur,!1,b.queue),b=qo(),O={state:o,dispatch:null,action:n,pending:null},b.queue=O,p=Pg.bind(null,ur,O,z,p),O.dispatch=p,b.memoizedState=n,[o,p,!1]}function Cf(n){var o=ai();return um(o,Oi,n)}function um(n,o,p){if(o=sm(n,o,Yu)[0],n=_c(da)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var b=Gu(o)}catch(W){throw W===_p?Mv:W}else b=o;o=ai();var O=o.queue,z=O.dispatch;return p!==o.memoizedState&&(ur.flags|=2048,Wu(tc|uo,Xc(),dm.bind(null,O,p),null)),[b,z,n]}function dm(n,o){n.action=o}function Df(n){var o=ai(),p=Oi;if(p!==null)return um(o,p,n);ai(),o=o.memoizedState,p=ai();var b=p.queue.dispatch;return p.memoizedState=n,[o,b,!1]}function Wu(n,o,p,b){return n={tag:n,create:p,deps:b,inst:o,next:null},o=ur.updateQueue,o===null&&(o=wf(),ur.updateQueue=o),p=o.lastEffect,p===null?o.lastEffect=n.next=n:(b=p.next,p.next=n,n.next=b,o.lastEffect=n),n}function Xc(){return{destroy:void 0,resource:void 0}}function Lg(n){var o=qo();return n={current:n},o.memoizedState=n}function Kc(n,o,p,b){var O=qo();b=b===void 0?null:b,ur.flags|=n,O.memoizedState=Wu(tc|o,Xc(),p,b)}function Jo(n,o,p,b){var O=ai();b=b===void 0?null:b;var z=O.memoizedState.inst;Oi!==null&&b!==null&&rm(b,Oi.memoizedState.deps)?O.memoizedState=Wu(o,z,p,b):(ur.flags|=n,O.memoizedState=Wu(tc|o,z,p,b))}function Xu(n,o){(ur.mode&Ws)!==Mi&&(ur.mode&D_)===Mi?Kc(276826112,uo,n,o):Kc(8390656,uo,n,o)}function Mf(n,o){var p=4194308;return(ur.mode&Ws)!==Mi&&(p|=134217728),Kc(p,is,n,o)}function Rf(n,o){if(typeof o=="function"){n=n();var p=o(n);return function(){typeof p=="function"?p():o(null)}}if(o!=null)return o.hasOwnProperty("current")||console.error("Expected useImperativeHandle() first argument to either be a ref callback or React.createRef() object. Instead received: %s.","an object with keys {"+Object.keys(o).join(", ")+"}"),n=n(),o.current=n,function(){o.current=null}}function Jc(n,o,p){typeof o!="function"&&console.error("Expected useImperativeHandle() second argument to be a function that creates a handle. Instead received: %s.",o!==null?typeof o:"null"),p=p!=null?p.concat([n]):null;var b=4194308;(ur.mode&Ws)!==Mi&&(b|=134217728),Kc(b,is,Rf.bind(null,o,n),p)}function Jd(n,o,p){typeof o!="function"&&console.error("Expected useImperativeHandle() second argument to be a function that creates a handle. Instead received: %s.",o!==null?typeof o:"null"),p=p!=null?p.concat([n]):null,Jo(4,is,Rf.bind(null,o,n),p)}function Qc(n,o){return qo().memoizedState=[n,o===void 0?null:o],n}function Qd(n,o){var p=ai();o=o===void 0?null:o;var b=p.memoizedState;return o!==null&&rm(o,b[1])?b[0]:(p.memoizedState=[n,o],n)}function eh(n,o){var p=qo();o=o===void 0?null:o;var b=n();if(yu){rr(!0);try{n()}finally{rr(!1)}}return p.memoizedState=[b,o],b}function Ku(n,o){var p=ai();o=o===void 0?null:o;var b=p.memoizedState;if(o!==null&&rm(o,b[1]))return b[0];if(b=n(),yu){rr(!0);try{n()}finally{rr(!1)}}return p.memoizedState=[b,o],b}function Ju(n,o){var p=qo();return eu(p,n,o)}function Bg(n,o){var p=ai();return kf(p,Oi.memoizedState,n,o)}function Fg(n,o){var p=ai();return Oi===null?eu(p,n,o):kf(p,Oi.memoizedState,n,o)}function eu(n,o,p){return p===void 0||(_u&1073741824)!==0?n.memoizedState=o:(n.memoizedState=p,n=lu(),ur.lanes|=n,yl|=n,p)}function kf(n,o,p,b){return bs(p,o)?p:yp.current!==null?(n=eu(n,p,b),bs(n,o)||(Xo=!0),n):(_u&42)===0?(Xo=!0,n.memoizedState=p):(n=lu(),ur.lanes|=n,yl|=n,o)}function nn(n,o,p,b,O){var z=yi.p;yi.p=z!==0&&z<fu?z:fu;var W=Pt.T,oe={};Pt.T=oe,mm(n,!1,o,p),oe._updatedFibers=new Set;try{var Ce=O(),Be=Pt.S;if(Be!==null&&Be(oe,Ce),Ce!==null&&typeof Ce=="object"&&typeof Ce.then=="function"){var Dt=em(Ce,b);ed(n,o,Dt,$o(n))}else ed(n,o,b,$o(n))}catch(Ft){ed(n,o,{then:function(){},status:"rejected",reason:Ft},$o(n))}finally{yi.p=z,Pt.T=W,W===null&&oe._updatedFibers&&(n=oe._updatedFibers.size,oe._updatedFibers.clear(),10<n&&console.warn("Detected a large number of updates inside startTransition. If this is due to a subscription please re-write it to use React provided hooks. Otherwise concurrent mode guarantees are off the table."))}}function Of(n,o,p,b){if(n.tag!==5)throw Error("Expected the form instance to be a HostComponent. This is a bug in React.");var O=hm(n).queue;nn(n,O,o,so,p===null?fe:function(){return vc(n),p(b)})}function hm(n){var o=n.memoizedState;if(o!==null)return o;o={memoizedState:so,baseState:so,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:da,lastRenderedState:so},next:null};var p={};return o.next={memoizedState:p,baseState:p,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:da,lastRenderedState:p},next:null},n.memoizedState=o,n=n.alternate,n!==null&&(n.memoizedState=o),o}function vc(n){Pt.T===null&&console.error("requestFormReset was called outside a transition or action. To fix, move to an action, or wrap with startTransition.");var o=hm(n).next.queue;ed(n,o,{},$o(n))}function ms(){var n=$u(!1);return n=nn.bind(null,ur,n.queue,!0,!1),qo().memoizedState=n,[!1,n]}function vn(){var n=_c(da)[0],o=ai().memoizedState;return[typeof n=="boolean"?n:Gu(n),o]}function fm(){var n=Kd(da)[0],o=ai().memoizedState;return[typeof n=="boolean"?n:Gu(n),o]}function Qu(){return Si(ki)}function pm(){var n=qo(),o=Li.identifierPrefix;if(Jr){var p=bd,b=xd;p=(b&~(1<<32-$s(b)-1)).toString(32)+p,o="«"+o+"R"+p,p=jh++,0<p&&(o+="H"+p.toString(32)),o+="»"}else p=x1++,o="«"+o+"r"+p.toString(32)+"»";return n.memoizedState=o}function th(){return qo().memoizedState=Ug.bind(null,ur)}function Ug(n,o){for(var p=n.return;p!==null;){switch(p.tag){case 24:case 3:var b=$o(p);n=ua(b);var O=Ol(p,n,b);O!==null&&(Ei(O,p,b),$c(O,p,b)),p=_f(),o!=null&&O!==null&&console.error("The seed argument is not enabled outside experimental channels."),n.payload={cache:p};return}p=p.return}}function Ny(n,o,p){var b=arguments;typeof b[3]=="function"&&console.error("State updates from the useState() and useReducer() Hooks don't support the second callback argument. To execute a side effect after rendering, declare it in the component body with useEffect()."),b=$o(n);var O={lane:b,revertLane:0,action:p,hasEagerState:!1,eagerState:null,next:null};nh(n)?nl(o,O):(O=Yp(n,o,O,b),O!==null&&(Ei(O,n,b),gm(O,o,b))),ls(n,b)}function If(n,o,p){var b=arguments;typeof b[3]=="function"&&console.error("State updates from the useState() and useReducer() Hooks don't support the second callback argument. To execute a side effect after rendering, declare it in the component body with useEffect()."),b=$o(n),ed(n,o,p,b),ls(n,b)}function ed(n,o,p,b){var O={lane:b,revertLane:0,action:p,hasEagerState:!1,eagerState:null,next:null};if(nh(n))nl(o,O);else{var z=n.alternate;if(n.lanes===0&&(z===null||z.lanes===0)&&(z=o.lastRenderedReducer,z!==null)){var W=Pt.H;Pt.H=_l;try{var oe=o.lastRenderedState,Ce=z(oe,p);if(O.hasEagerState=!0,O.eagerState=Ce,bs(Ce,oe))return Tl(n,o,O,0),Li===null&&Zp(),!1}catch{}finally{Pt.H=W}}if(p=Yp(n,o,O,b),p!==null)return Ei(p,n,b),gm(p,o,b),!0}return!1}function mm(n,o,p,b){if(Pt.T===null&&zh===0&&console.error("An optimistic state update occurred outside a transition or action. To fix, move the update to an action, or wrap with startTransition."),b={lane:2,revertLane:te(),action:b,hasEagerState:!1,eagerState:null,next:null},nh(n)){if(o)throw Error("Cannot update optimistic state while rendering.");console.error("Cannot call startTransition while rendering.")}else o=Yp(n,p,b,2),o!==null&&Ei(o,n,2);ls(n,2)}function nh(n){var o=n.alternate;return n===ur||o!==null&&o===ur}function nl(n,o){xp=j_=!0;var p=n.pending;p===null?o.next=o:(o.next=p.next,p.next=o),n.pending=o}function gm(n,o,p){if((p&4194048)!==0){var b=o.lanes;b&=n.pendingLanes,p|=b,o.lanes=p,Fa(n,p)}}function yo(n){var o=Ur;return n!=null&&(Ur=o===null?n:o.concat(n)),o}function No(n,o,p){for(var b=Object.keys(n.props),O=0;O<b.length;O++){var z=b[O];if(z!=="children"&&z!=="key"){o===null&&(o=ff(n,p.mode,0),o._debugInfo=Ur,o.return=p),Ye(o,function(W){console.error("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",W)},z);break}}}function rl(n){var o=qh;return qh+=1,ug===null&&(ug=vf()),Vu(ug,n,o)}function xc(n,o){o=o.props.ref,n.ref=o!==void 0?o:null}function td(n,o){throw o.$$typeof===Tb?Error(`A React Element from an older version of React was rendered. This is not supported. It can happen if:
- Multiple copies of the "react" package is used.
- A library pre-bundled an old copy of "react" or "react/jsx-runtime".
- A compiler tries to "inline" JSX instead of using the runtime.`):(n=Object.prototype.toString.call(o),Error("Objects are not valid as a React child (found: "+(n==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead."))}function bc(n,o){var p=Ut(n)||"Component";D1[p]||(D1[p]=!0,o=o.displayName||o.name||"Component",n.tag===3?console.error(`Functions are not valid as a React child. This may happen if you return %s instead of <%s /> from render. Or maybe you meant to call this function rather than return it.
  root.render(%s)`,o,o,o):console.error(`Functions are not valid as a React child. This may happen if you return %s instead of <%s /> from render. Or maybe you meant to call this function rather than return it.
  <%s>{%s}</%s>`,o,o,p,o,p))}function nd(n,o){var p=Ut(n)||"Component";M1[p]||(M1[p]=!0,o=String(o),n.tag===3?console.error(`Symbols are not valid as a React child.
  root.render(%s)`,o):console.error(`Symbols are not valid as a React child.
  <%s>%s</%s>`,p,o,p))}function jg(n){function o(et,nt){if(n){var ht=et.deletions;ht===null?(et.deletions=[nt],et.flags|=16):ht.push(nt)}}function p(et,nt){if(!n)return null;for(;nt!==null;)o(et,nt),nt=nt.sibling;return null}function b(et){for(var nt=new Map;et!==null;)et.key!==null?nt.set(et.key,et):nt.set(et.index,et),et=et.sibling;return nt}function O(et,nt){return et=Ya(et,nt),et.index=0,et.sibling=null,et}function z(et,nt,ht){return et.index=ht,n?(ht=et.alternate,ht!==null?(ht=ht.index,ht<nt?(et.flags|=67108866,nt):ht):(et.flags|=67108866,nt)):(et.flags|=1048576,nt)}function W(et){return n&&et.alternate===null&&(et.flags|=67108866),et}function oe(et,nt,ht,Zt){return nt===null||nt.tag!==6?(nt=Al(ht,et.mode,Zt),nt.return=et,nt._debugOwner=et,nt._debugTask=et._debugTask,nt._debugInfo=Ur,nt):(nt=O(nt,ht),nt.return=et,nt._debugInfo=Ur,nt)}function Ce(et,nt,ht,Zt){var Cn=ht.type;return Cn===Vl?(nt=Dt(et,nt,ht.props.children,Zt,ht.key),No(ht,nt,et),nt):nt!==null&&(nt.elementType===Cn||Sy(nt,ht)||typeof Cn=="object"&&Cn!==null&&Cn.$$typeof===Wo&&Vh(Cn)===nt.type)?(nt=O(nt,ht.props),xc(nt,ht),nt.return=et,nt._debugOwner=ht._owner,nt._debugInfo=Ur,nt):(nt=ff(ht,et.mode,Zt),xc(nt,ht),nt.return=et,nt._debugInfo=Ur,nt)}function Be(et,nt,ht,Zt){return nt===null||nt.tag!==4||nt.stateNode.containerInfo!==ht.containerInfo||nt.stateNode.implementation!==ht.implementation?(nt=Xn(ht,et.mode,Zt),nt.return=et,nt._debugInfo=Ur,nt):(nt=O(nt,ht.children||[]),nt.return=et,nt._debugInfo=Ur,nt)}function Dt(et,nt,ht,Zt,Cn){return nt===null||nt.tag!==7?(nt=Lu(ht,et.mode,Zt,Cn),nt.return=et,nt._debugOwner=et,nt._debugTask=et._debugTask,nt._debugInfo=Ur,nt):(nt=O(nt,ht),nt.return=et,nt._debugInfo=Ur,nt)}function Ft(et,nt,ht){if(typeof nt=="string"&&nt!==""||typeof nt=="number"||typeof nt=="bigint")return nt=Al(""+nt,et.mode,ht),nt.return=et,nt._debugOwner=et,nt._debugTask=et._debugTask,nt._debugInfo=Ur,nt;if(typeof nt=="object"&&nt!==null){switch(nt.$$typeof){case gd:return ht=ff(nt,et.mode,ht),xc(ht,nt),ht.return=et,et=yo(nt._debugInfo),ht._debugInfo=Ur,Ur=et,ht;case ul:return nt=Xn(nt,et.mode,ht),nt.return=et,nt._debugInfo=Ur,nt;case Wo:var Zt=yo(nt._debugInfo);return nt=Vh(nt),et=Ft(et,nt,ht),Ur=Zt,et}if(es(nt)||cn(nt))return ht=Lu(nt,et.mode,ht,null),ht.return=et,ht._debugOwner=et,ht._debugTask=et._debugTask,et=yo(nt._debugInfo),ht._debugInfo=Ur,Ur=et,ht;if(typeof nt.then=="function")return Zt=yo(nt._debugInfo),et=Ft(et,rl(nt),ht),Ur=Zt,et;if(nt.$$typeof===du)return Ft(et,Jp(et,nt),ht);td(et,nt)}return typeof nt=="function"&&bc(et,nt),typeof nt=="symbol"&&nd(et,nt),null}function Et(et,nt,ht,Zt){var Cn=nt!==null?nt.key:null;if(typeof ht=="string"&&ht!==""||typeof ht=="number"||typeof ht=="bigint")return Cn!==null?null:oe(et,nt,""+ht,Zt);if(typeof ht=="object"&&ht!==null){switch(ht.$$typeof){case gd:return ht.key===Cn?(Cn=yo(ht._debugInfo),et=Ce(et,nt,ht,Zt),Ur=Cn,et):null;case ul:return ht.key===Cn?Be(et,nt,ht,Zt):null;case Wo:return Cn=yo(ht._debugInfo),ht=Vh(ht),et=Et(et,nt,ht,Zt),Ur=Cn,et}if(es(ht)||cn(ht))return Cn!==null?null:(Cn=yo(ht._debugInfo),et=Dt(et,nt,ht,Zt,null),Ur=Cn,et);if(typeof ht.then=="function")return Cn=yo(ht._debugInfo),et=Et(et,nt,rl(ht),Zt),Ur=Cn,et;if(ht.$$typeof===du)return Et(et,nt,Jp(et,ht),Zt);td(et,ht)}return typeof ht=="function"&&bc(et,ht),typeof ht=="symbol"&&nd(et,ht),null}function Gt(et,nt,ht,Zt,Cn){if(typeof Zt=="string"&&Zt!==""||typeof Zt=="number"||typeof Zt=="bigint")return et=et.get(ht)||null,oe(nt,et,""+Zt,Cn);if(typeof Zt=="object"&&Zt!==null){switch(Zt.$$typeof){case gd:return ht=et.get(Zt.key===null?ht:Zt.key)||null,et=yo(Zt._debugInfo),nt=Ce(nt,ht,Zt,Cn),Ur=et,nt;case ul:return et=et.get(Zt.key===null?ht:Zt.key)||null,Be(nt,et,Zt,Cn);case Wo:var Pr=yo(Zt._debugInfo);return Zt=Vh(Zt),nt=Gt(et,nt,ht,Zt,Cn),Ur=Pr,nt}if(es(Zt)||cn(Zt))return ht=et.get(ht)||null,et=yo(Zt._debugInfo),nt=Dt(nt,ht,Zt,Cn,null),Ur=et,nt;if(typeof Zt.then=="function")return Pr=yo(Zt._debugInfo),nt=Gt(et,nt,ht,rl(Zt),Cn),Ur=Pr,nt;if(Zt.$$typeof===du)return Gt(et,nt,ht,Jp(nt,Zt),Cn);td(nt,Zt)}return typeof Zt=="function"&&bc(nt,Zt),typeof Zt=="symbol"&&nd(nt,Zt),null}function Hn(et,nt,ht,Zt){if(typeof ht!="object"||ht===null)return Zt;switch(ht.$$typeof){case gd:case ul:a(et,nt,ht);var Cn=ht.key;if(typeof Cn!="string")break;if(Zt===null){Zt=new Set,Zt.add(Cn);break}if(!Zt.has(Cn)){Zt.add(Cn);break}Ye(nt,function(){console.error("Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.",Cn)});break;case Wo:ht=Vh(ht),Hn(et,nt,ht,Zt)}return Zt}function Mr(et,nt,ht,Zt){for(var Cn=null,Pr=null,Gn=null,Lr=nt,Vr=nt=0,to=null;Lr!==null&&Vr<ht.length;Vr++){Lr.index>Vr?(to=Lr,Lr=null):to=Lr.sibling;var Ko=Et(et,Lr,ht[Vr],Zt);if(Ko===null){Lr===null&&(Lr=to);break}Cn=Hn(et,Ko,ht[Vr],Cn),n&&Lr&&Ko.alternate===null&&o(et,Lr),nt=z(Ko,nt,Vr),Gn===null?Pr=Ko:Gn.sibling=Ko,Gn=Ko,Lr=to}if(Vr===ht.length)return p(et,Lr),Jr&&_n(et,Vr),Pr;if(Lr===null){for(;Vr<ht.length;Vr++)Lr=Ft(et,ht[Vr],Zt),Lr!==null&&(Cn=Hn(et,Lr,ht[Vr],Cn),nt=z(Lr,nt,Vr),Gn===null?Pr=Lr:Gn.sibling=Lr,Gn=Lr);return Jr&&_n(et,Vr),Pr}for(Lr=b(Lr);Vr<ht.length;Vr++)to=Gt(Lr,et,Vr,ht[Vr],Zt),to!==null&&(Cn=Hn(et,to,ht[Vr],Cn),n&&to.alternate!==null&&Lr.delete(to.key===null?Vr:to.key),nt=z(to,nt,Vr),Gn===null?Pr=to:Gn.sibling=to,Gn=to);return n&&Lr.forEach(function(Op){return o(et,Op)}),Jr&&_n(et,Vr),Pr}function Yi(et,nt,ht,Zt){if(ht==null)throw Error("An iterable object provided no iterator.");for(var Cn=null,Pr=null,Gn=nt,Lr=nt=0,Vr=null,to=null,Ko=ht.next();Gn!==null&&!Ko.done;Lr++,Ko=ht.next()){Gn.index>Lr?(Vr=Gn,Gn=null):Vr=Gn.sibling;var Op=Et(et,Gn,Ko.value,Zt);if(Op===null){Gn===null&&(Gn=Vr);break}to=Hn(et,Op,Ko.value,to),n&&Gn&&Op.alternate===null&&o(et,Gn),nt=z(Op,nt,Lr),Pr===null?Cn=Op:Pr.sibling=Op,Pr=Op,Gn=Vr}if(Ko.done)return p(et,Gn),Jr&&_n(et,Lr),Cn;if(Gn===null){for(;!Ko.done;Lr++,Ko=ht.next())Gn=Ft(et,Ko.value,Zt),Gn!==null&&(to=Hn(et,Gn,Ko.value,to),nt=z(Gn,nt,Lr),Pr===null?Cn=Gn:Pr.sibling=Gn,Pr=Gn);return Jr&&_n(et,Lr),Cn}for(Gn=b(Gn);!Ko.done;Lr++,Ko=ht.next())Vr=Gt(Gn,et,Lr,Ko.value,Zt),Vr!==null&&(to=Hn(et,Vr,Ko.value,to),n&&Vr.alternate!==null&&Gn.delete(Vr.key===null?Lr:Vr.key),nt=z(Vr,nt,Lr),Pr===null?Cn=Vr:Pr.sibling=Vr,Pr=Vr);return n&&Gn.forEach(function(ZD){return o(et,ZD)}),Jr&&_n(et,Lr),Cn}function oi(et,nt,ht,Zt){if(typeof ht=="object"&&ht!==null&&ht.type===Vl&&ht.key===null&&(No(ht,null,et),ht=ht.props.children),typeof ht=="object"&&ht!==null){switch(ht.$$typeof){case gd:var Cn=yo(ht._debugInfo);e:{for(var Pr=ht.key;nt!==null;){if(nt.key===Pr){if(Pr=ht.type,Pr===Vl){if(nt.tag===7){p(et,nt.sibling),Zt=O(nt,ht.props.children),Zt.return=et,Zt._debugOwner=ht._owner,Zt._debugInfo=Ur,No(ht,Zt,et),et=Zt;break e}}else if(nt.elementType===Pr||Sy(nt,ht)||typeof Pr=="object"&&Pr!==null&&Pr.$$typeof===Wo&&Vh(Pr)===nt.type){p(et,nt.sibling),Zt=O(nt,ht.props),xc(Zt,ht),Zt.return=et,Zt._debugOwner=ht._owner,Zt._debugInfo=Ur,et=Zt;break e}p(et,nt);break}else o(et,nt);nt=nt.sibling}ht.type===Vl?(Zt=Lu(ht.props.children,et.mode,Zt,ht.key),Zt.return=et,Zt._debugOwner=et,Zt._debugTask=et._debugTask,Zt._debugInfo=Ur,No(ht,Zt,et),et=Zt):(Zt=ff(ht,et.mode,Zt),xc(Zt,ht),Zt.return=et,Zt._debugInfo=Ur,et=Zt)}return et=W(et),Ur=Cn,et;case ul:e:{for(Cn=ht,ht=Cn.key;nt!==null;){if(nt.key===ht)if(nt.tag===4&&nt.stateNode.containerInfo===Cn.containerInfo&&nt.stateNode.implementation===Cn.implementation){p(et,nt.sibling),Zt=O(nt,Cn.children||[]),Zt.return=et,et=Zt;break e}else{p(et,nt);break}else o(et,nt);nt=nt.sibling}Zt=Xn(Cn,et.mode,Zt),Zt.return=et,et=Zt}return W(et);case Wo:return Cn=yo(ht._debugInfo),ht=Vh(ht),et=oi(et,nt,ht,Zt),Ur=Cn,et}if(es(ht))return Cn=yo(ht._debugInfo),et=Mr(et,nt,ht,Zt),Ur=Cn,et;if(cn(ht)){if(Cn=yo(ht._debugInfo),Pr=cn(ht),typeof Pr!="function")throw Error("An object is not an iterable. This error is likely caused by a bug in React. Please file an issue.");var Gn=Pr.call(ht);return Gn===ht?(et.tag!==0||Object.prototype.toString.call(et.type)!=="[object GeneratorFunction]"||Object.prototype.toString.call(Gn)!=="[object Generator]")&&(fx||console.error("Using Iterators as children is unsupported and will likely yield unexpected results because enumerating a generator mutates it. You may convert it to an array with `Array.from()` or the `[...spread]` operator before rendering. You can also use an Iterable that can iterate multiple times over the same items."),fx=!0):ht.entries!==Pr||hx||(console.error("Using Maps as children is not supported. Use an array of keyed ReactElements instead."),hx=!0),et=Yi(et,nt,Gn,Zt),Ur=Cn,et}if(typeof ht.then=="function")return Cn=yo(ht._debugInfo),et=oi(et,nt,rl(ht),Zt),Ur=Cn,et;if(ht.$$typeof===du)return oi(et,nt,Jp(et,ht),Zt);td(et,ht)}return typeof ht=="string"&&ht!==""||typeof ht=="number"||typeof ht=="bigint"?(Cn=""+ht,nt!==null&&nt.tag===6?(p(et,nt.sibling),Zt=O(nt,Cn),Zt.return=et,et=Zt):(p(et,nt),Zt=Al(Cn,et.mode,Zt),Zt.return=et,Zt._debugOwner=et,Zt._debugTask=et._debugTask,Zt._debugInfo=Ur,et=Zt),W(et)):(typeof ht=="function"&&bc(et,ht),typeof ht=="symbol"&&nd(et,ht),p(et,nt))}return function(et,nt,ht,Zt){var Cn=Ur;Ur=null;try{qh=0;var Pr=oi(et,nt,ht,Zt);return ug=null,Pr}catch(to){if(to===_p||to===Mv)throw to;var Gn=le(29,to,null,et.mode);Gn.lanes=Zt,Gn.return=et;var Lr=Gn._debugInfo=Ur;if(Gn._debugOwner=et._debugOwner,Gn._debugTask=et._debugTask,Lr!=null){for(var Vr=Lr.length-1;0<=Vr;Vr--)if(typeof Lr[Vr].stack=="string"){Gn._debugOwner=Lr[Vr],Gn._debugTask=Lr[Vr].debugTask;break}}return Gn}finally{Ur=Cn}}}function vo(n){var o=n.alternate;ln(Lo,Lo.current&hg,n),ln(Ts,n,n),Ia===null&&(o===null||yp.current!==null||o.memoizedState!==null)&&(Ia=n)}function Hr(n){if(n.tag===22){if(ln(Lo,Lo.current,n),ln(Ts,n,n),Ia===null){var o=n.alternate;o!==null&&o.memoizedState!==null&&(Ia=n)}}else fa(n)}function fa(n){ln(Lo,Lo.current,n),ln(Ts,Ts.current,n)}function il(n){Rt(Ts,n),Ia===n&&(Ia=null),Rt(Lo,n)}function rh(n){for(var o=n;o!==null;){if(o.tag===13){var p=o.memoizedState;if(p!==null&&(p=p.dehydrated,p===null||p.data===Ee||Yo(p)))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}function ih(n){if(n!==null&&typeof n!="function"){var o=String(n);$_.has(o)||($_.add(o),console.error("Expected the last optional `callback` argument to be a function. Instead received: %s.",n))}}function rd(n,o,p,b){var O=n.memoizedState,z=p(b,O);if(n.mode&Ys){rr(!0);try{z=p(b,O)}finally{rr(!1)}}z===void 0&&(o=xt(o)||"Component",xx.has(o)||(xx.add(o),console.error("%s.getDerivedStateFromProps(): A valid state object (or null) must be returned. You have returned undefined.",o))),O=z==null?O:Fr({},O,z),n.memoizedState=O,n.lanes===0&&(n.updateQueue.baseState=O)}function id(n,o,p,b,O,z,W){var oe=n.stateNode;if(typeof oe.shouldComponentUpdate=="function"){if(p=oe.shouldComponentUpdate(b,z,W),n.mode&Ys){rr(!0);try{p=oe.shouldComponentUpdate(b,z,W)}finally{rr(!1)}}return p===void 0&&console.error("%s.shouldComponentUpdate(): Returned undefined instead of a boolean value. Make sure to return true or false.",xt(o)||"Component"),p}return o.prototype&&o.prototype.isPureReactComponent?!wi(p,b)||!wi(O,z):!0}function od(n,o,p,b){var O=o.state;typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(p,b),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(p,b),o.state!==O&&(n=Ut(n)||"Component",mx.has(n)||(mx.add(n),console.error("%s.componentWillReceiveProps(): Assigning directly to this.state is deprecated (except inside a component's constructor). Use setState instead.",n)),Z_.enqueueReplaceState(o,o.state,null))}function Ta(n,o){var p=o;if("ref"in o){p={};for(var b in o)b!=="ref"&&(p[b]=o[b])}if(n=n.defaultProps){p===o&&(p=Fr({},p));for(var O in n)p[O]===void 0&&(p[O]=n[O])}return p}function Ot(n){Nv(n),console.warn(`%s

%s
`,Ap?"An error occurred in the <"+Ap+"> component.":"An error occurred in one of your React components.",`Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://react.dev/link/error-boundaries to learn more about error boundaries.`)}function en(n){var o=Ap?"The above error occurred in the <"+Ap+"> component.":"The above error occurred in one of your React components.",p="React will try to recreate this component tree from scratch using the error boundary you provided, "+((zv||"Anonymous")+".");if(typeof n=="object"&&n!==null&&typeof n.environmentName=="string"){var b=n.environmentName;n=[`%o

%s

%s
`,n,o,p].slice(0),typeof n[0]=="string"?n.splice(0,1,Vi+n[0],Fo,Qs+b+Qs,ho):n.splice(0,0,Vi,Fo,Qs+b+Qs,ho),n.unshift(console),b=rf.apply(console.error,n),b()}else console.error(`%o

%s

%s
`,n,o,p)}function sd(n){Nv(n)}function li(n,o){try{Ap=o.source?Ut(o.source):null,zv=null;var p=o.value;if(Pt.actQueue!==null)Pt.thrownErrors.push(p);else{var b=n.onUncaughtError;b(p,{componentStack:o.stack})}}catch(O){setTimeout(function(){throw O})}}function Qe(n,o,p){try{Ap=p.source?Ut(p.source):null,zv=Ut(o);var b=n.onCaughtError;b(p.value,{componentStack:p.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(O){setTimeout(function(){throw O})}}function _m(n,o,p){return p=ua(p),p.tag=B_,p.payload={element:null},p.callback=function(){Ye(o.source,li,n,o)},p}function oh(n){return n=ua(n),n.tag=B_,n}function Nf(n,o,p,b){var O=p.type.getDerivedStateFromError;if(typeof O=="function"){var z=b.value;n.payload=function(){return O(z)},n.callback=function(){qc(p),Ye(b.source,Qe,o,p,b)}}var W=p.stateNode;W!==null&&typeof W.componentDidCatch=="function"&&(n.callback=function(){qc(p),Ye(b.source,Qe,o,p,b),typeof O!="function"&&(Id===null?Id=new Set([this]):Id.add(this)),gS(this,b),typeof O=="function"||(p.lanes&2)===0&&console.error("%s: Error boundaries should implement getDerivedStateFromError(). In that method, return a state update to display an error message or fallback UI.",Ut(p)||"Unknown")})}function Vg(n,o,p,b,O){if(p.flags|=32768,Hl&&m(n,O),b!==null&&typeof b=="object"&&typeof b.then=="function"){if(o=p.alternate,o!==null&&Ml(o,p,O,!0),Jr&&(Xl=!0),p=Ts.current,p!==null){switch(p.tag){case 13:return Ia===null?cu():p.alternate===null&&xi===kd&&(xi=Hh),p.flags&=-257,p.flags|=65536,p.lanes=O,b===rx?p.flags|=16384:(o=p.updateQueue,o===null?p.updateQueue=new Set([b]):o.add(b),qf(n,b,O)),!1;case 22:return p.flags|=65536,b===rx?p.flags|=16384:(o=p.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([b])},p.updateQueue=o):(p=o.retryQueue,p===null?o.retryQueue=new Set([b]):p.add(b)),qf(n,b,O)),!1}throw Error("Unexpected Suspense handler tag ("+p.tag+"). This is a bug in React.")}return qf(n,b,O),cu(),!1}if(Jr)return Xl=!0,o=Ts.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=O,b!==ng&&zt(Ci(Error("There was an error while hydrating but React was able to recover by instead client rendering from the nearest Suspense boundary.",{cause:b}),p))):(b!==ng&&zt(Ci(Error("There was an error while hydrating but React was able to recover by instead client rendering the entire root.",{cause:b}),p)),n=n.current.alternate,n.flags|=65536,O&=-O,n.lanes|=O,b=Ci(b,p),O=_m(n.stateNode,b,O),Zc(n,O),xi!==zc&&(xi=Ri)),!1;var z=Ci(Error("There was an error during concurrent rendering but React was able to recover by instead synchronously rendering the entire root.",{cause:b}),p);if(Yh===null?Yh=[z]:Yh.push(z),xi!==zc&&(xi=Ri),o===null)return!0;b=Ci(b,p),p=o;do{switch(p.tag){case 3:return p.flags|=65536,n=O&-O,p.lanes|=n,n=_m(p.stateNode,b,n),Zc(p,n),!1;case 1:if(o=p.type,z=p.stateNode,(p.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||z!==null&&typeof z.componentDidCatch=="function"&&(Id===null||!Id.has(z))))return p.flags|=65536,O&=-O,p.lanes|=O,O=oh(O),Nf(O,n,p,b),Zc(p,O),!1}p=p.return}while(p!==null);return!1}function zo(n,o,p,b){o.child=n===null?R1(o,null,p,b):dg(o,n.child,p,b)}function qg(n,o,p,b,O){p=p.render;var z=o.ref;if("ref"in b){var W={};for(var oe in b)oe!=="ref"&&(W[oe]=b[oe])}else W=b;return Sa(o),Yr(o),b=im(n,o,p,W,z,O),oe=om(),de(),n!==null&&!Xo?(ps(n,o,O),Bs(n,o,O)):(Jr&&oe&&Bn(o),o.flags|=1,zo(n,o,b,O),o.child)}function ad(n,o,p,b,O){if(n===null){var z=p.type;return typeof z=="function"&&!El(z)&&z.defaultProps===void 0&&p.compare===null?(p=Za(z),o.tag=15,o.type=p,sh(o,z),zy(n,o,p,b,O)):(n=Rg(p.type,null,b,o,o.mode,O),n.ref=o.ref,n.return=o,o.child=n)}if(z=n.child,!sl(n,O)){var W=z.memoizedProps;if(p=p.compare,p=p!==null?p:wi,p(W,b)&&n.ref===o.ref)return Bs(n,o,O)}return o.flags|=1,n=Ya(z,b),n.ref=o.ref,n.return=o,o.child=n}function zy(n,o,p,b,O){if(n!==null){var z=n.memoizedProps;if(wi(z,b)&&n.ref===o.ref&&o.type===n.type)if(Xo=!1,o.pendingProps=b=z,sl(n,O))(n.flags&131072)!==0&&(Xo=!0);else return o.lanes=n.lanes,Bs(n,o,O)}return zl(n,o,p,b,O)}function Py(n,o,p){var b=o.pendingProps,O=b.children,z=n!==null?n.memoizedState:null;if(b.mode==="hidden"){if((o.flags&128)!==0){if(b=z!==null?z.baseLanes|p:p,n!==null){for(O=o.child=n.child,z=0;O!==null;)z=z|O.lanes|O.childLanes,O=O.sibling;o.childLanes=z&~b}else o.childLanes=0,o.child=null;return Hg(n,o,b,p)}if((p&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},n!==null&&ju(o,z!==null?z.cachePool:null),z!==null?nm(o,z):Ig(o),Hr(o);else return o.lanes=o.childLanes=536870912,Hg(n,o,z!==null?z.baseLanes|p:p,p)}else z!==null?(ju(o,z.cachePool),nm(o,z),fa(o),o.memoizedState=null):(n!==null&&ju(o,null),Ig(o),fa(o));return zo(n,o,O,p),o.child}function Hg(n,o,p,b){var O=Uu();return O=O===null?null:{parent:Eo._currentValue,pool:O},o.memoizedState={baseLanes:p,cachePool:O},n!==null&&ju(o,null),Ig(o),Hr(o),n!==null&&Ml(n,o,b,!0),null}function ld(n,o){var p=o.ref;if(p===null)n!==null&&n.ref!==null&&(o.flags|=4194816);else{if(typeof p!="function"&&typeof p!="object")throw Error("Expected ref to be a function, an object returned by React.createRef(), or undefined/null.");(n===null||n.ref!==p)&&(o.flags|=4194816)}}function zl(n,o,p,b,O){if(p.prototype&&typeof p.prototype.render=="function"){var z=xt(p)||"Unknown";Tx[z]||(console.error("The <%s /> component appears to have a render method, but doesn't extend React.Component. This is likely to cause errors. Change %s to extend React.Component instead.",z,z),Tx[z]=!0)}return o.mode&Ys&&Ic.recordLegacyContextWarning(o,null),n===null&&(sh(o,o.type),p.contextTypes&&(z=xt(p)||"Unknown",Md[z]||(Md[z]=!0,console.error("%s uses the legacy contextTypes API which was removed in React 19. Use React.createContext() with React.useContext() instead. (https://react.dev/link/legacy-context)",z)))),Sa(o),Yr(o),p=im(n,o,p,b,void 0,O),b=om(),de(),n!==null&&!Xo?(ps(n,o,O),Bs(n,o,O)):(Jr&&b&&Bn(o),o.flags|=1,zo(n,o,p,O),o.child)}function ym(n,o,p,b,O,z){return Sa(o),Yr(o),vu=-1,Cd=n!==null&&n.type!==o.type,o.updateQueue=null,p=Hu(o,b,p,O),Dy(n,o),b=om(),de(),n!==null&&!Xo?(ps(n,o,z),Bs(n,o,z)):(Jr&&b&&Bn(o),o.flags|=1,zo(n,o,p,z),o.child)}function vm(n,o,p,b,O){switch(X(o)){case!1:var z=o.stateNode,W=new o.type(o.memoizedProps,z.context).state;z.updater.enqueueSetState(z,W,null);break;case!0:o.flags|=128,o.flags|=65536,z=Error("Simulated error coming from DevTools");var oe=O&-O;if(o.lanes|=oe,W=Li,W===null)throw Error("Expected a work-in-progress root. This is a bug in React. Please file an issue.");oe=oh(oe),Nf(oe,W,o,Ci(z,o)),Zc(o,oe)}if(Sa(o),o.stateNode===null){if(W=Yl,z=p.contextType,"contextType"in p&&z!==null&&(z===void 0||z.$$typeof!==du)&&!wx.has(p)&&(wx.add(p),oe=z===void 0?" However, it is set to undefined. This can be caused by a typo or by mixing up named and default imports. This can also happen due to a circular dependency, so try moving the createContext() call to a separate file.":typeof z!="object"?" However, it is set to a "+typeof z+".":z.$$typeof===_0?" Did you accidentally pass the Context.Consumer instead?":" However, it is set to an object with keys {"+Object.keys(z).join(", ")+"}.",console.error("%s defines an invalid contextType. contextType should point to the Context object returned by React.createContext().%s",xt(p)||"Component",oe)),typeof z=="object"&&z!==null&&(W=Si(z)),z=new p(b,W),o.mode&Ys){rr(!0);try{z=new p(b,W)}finally{rr(!1)}}if(W=o.memoizedState=z.state!==null&&z.state!==void 0?z.state:null,z.updater=Z_,o.stateNode=z,z._reactInternals=o,z._reactInternalInstance=px,typeof p.getDerivedStateFromProps=="function"&&W===null&&(W=xt(p)||"Component",gx.has(W)||(gx.add(W),console.error("`%s` uses `getDerivedStateFromProps` but its initial state is %s. This is not recommended. Instead, define the initial state by assigning an object to `this.state` in the constructor of `%s`. This ensures that `getDerivedStateFromProps` arguments have a consistent shape.",W,z.state===null?"null":"undefined",W))),typeof p.getDerivedStateFromProps=="function"||typeof z.getSnapshotBeforeUpdate=="function"){var Ce=oe=W=null;if(typeof z.componentWillMount=="function"&&z.componentWillMount.__suppressDeprecationWarning!==!0?W="componentWillMount":typeof z.UNSAFE_componentWillMount=="function"&&(W="UNSAFE_componentWillMount"),typeof z.componentWillReceiveProps=="function"&&z.componentWillReceiveProps.__suppressDeprecationWarning!==!0?oe="componentWillReceiveProps":typeof z.UNSAFE_componentWillReceiveProps=="function"&&(oe="UNSAFE_componentWillReceiveProps"),typeof z.componentWillUpdate=="function"&&z.componentWillUpdate.__suppressDeprecationWarning!==!0?Ce="componentWillUpdate":typeof z.UNSAFE_componentWillUpdate=="function"&&(Ce="UNSAFE_componentWillUpdate"),W!==null||oe!==null||Ce!==null){z=xt(p)||"Component";var Be=typeof p.getDerivedStateFromProps=="function"?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";yx.has(z)||(yx.add(z),console.error(`Unsafe legacy lifecycles will not be called for components using new component APIs.

%s uses %s but also contains the following legacy lifecycles:%s%s%s

The above lifecycles should be removed. Learn more about this warning here:
https://react.dev/link/unsafe-component-lifecycles`,z,Be,W!==null?`
  `+W:"",oe!==null?`
  `+oe:"",Ce!==null?`
  `+Ce:""))}}z=o.stateNode,W=xt(p)||"Component",z.render||(p.prototype&&typeof p.prototype.render=="function"?console.error("No `render` method found on the %s instance: did you accidentally return an object from the constructor?",W):console.error("No `render` method found on the %s instance: you may have forgotten to define `render`.",W)),!z.getInitialState||z.getInitialState.isReactClassApproved||z.state||console.error("getInitialState was defined on %s, a plain JavaScript class. This is only supported for classes created using React.createClass. Did you mean to define a state property instead?",W),z.getDefaultProps&&!z.getDefaultProps.isReactClassApproved&&console.error("getDefaultProps was defined on %s, a plain JavaScript class. This is only supported for classes created using React.createClass. Use a static property to define defaultProps instead.",W),z.contextType&&console.error("contextType was defined as an instance property on %s. Use a static property to define contextType instead.",W),p.childContextTypes&&!G_.has(p)&&(G_.add(p),console.error("%s uses the legacy childContextTypes API which was removed in React 19. Use React.createContext() instead. (https://react.dev/link/legacy-context)",W)),p.contextTypes&&!bx.has(p)&&(bx.add(p),console.error("%s uses the legacy contextTypes API which was removed in React 19. Use React.createContext() with static contextType instead. (https://react.dev/link/legacy-context)",W)),typeof z.componentShouldUpdate=="function"&&console.error("%s has a method called componentShouldUpdate(). Did you mean shouldComponentUpdate()? The name is phrased as a question because the function is expected to return a value.",W),p.prototype&&p.prototype.isPureReactComponent&&typeof z.shouldComponentUpdate<"u"&&console.error("%s has a method called shouldComponentUpdate(). shouldComponentUpdate should not be used when extending React.PureComponent. Please extend React.Component if shouldComponentUpdate is used.",xt(p)||"A pure component"),typeof z.componentDidUnmount=="function"&&console.error("%s has a method called componentDidUnmount(). But there is no such lifecycle method. Did you mean componentWillUnmount()?",W),typeof z.componentDidReceiveProps=="function"&&console.error("%s has a method called componentDidReceiveProps(). But there is no such lifecycle method. If you meant to update the state in response to changing props, use componentWillReceiveProps(). If you meant to fetch data or run side-effects or mutations after React has updated the UI, use componentDidUpdate().",W),typeof z.componentWillRecieveProps=="function"&&console.error("%s has a method called componentWillRecieveProps(). Did you mean componentWillReceiveProps()?",W),typeof z.UNSAFE_componentWillRecieveProps=="function"&&console.error("%s has a method called UNSAFE_componentWillRecieveProps(). Did you mean UNSAFE_componentWillReceiveProps()?",W),oe=z.props!==b,z.props!==void 0&&oe&&console.error("When calling super() in `%s`, make sure to pass up the same props that your component's constructor was passed.",W),z.defaultProps&&console.error("Setting defaultProps as an instance property on %s is not supported and will be ignored. Instead, define defaultProps as a static property on %s.",W,W),typeof z.getSnapshotBeforeUpdate!="function"||typeof z.componentDidUpdate=="function"||_x.has(p)||(_x.add(p),console.error("%s: getSnapshotBeforeUpdate() should be used with componentDidUpdate(). This component defines getSnapshotBeforeUpdate() only.",xt(p))),typeof z.getDerivedStateFromProps=="function"&&console.error("%s: getDerivedStateFromProps() is defined as an instance method and will be ignored. Instead, declare it as a static method.",W),typeof z.getDerivedStateFromError=="function"&&console.error("%s: getDerivedStateFromError() is defined as an instance method and will be ignored. Instead, declare it as a static method.",W),typeof p.getSnapshotBeforeUpdate=="function"&&console.error("%s: getSnapshotBeforeUpdate() is defined as a static method and will be ignored. Instead, declare it as an instance method.",W),(oe=z.state)&&(typeof oe!="object"||es(oe))&&console.error("%s.state: must be set to an object or null",W),typeof z.getChildContext=="function"&&typeof p.childContextTypes!="object"&&console.error("%s.getChildContext(): childContextTypes must be defined in order to use getChildContext().",W),z=o.stateNode,z.props=b,z.state=o.memoizedState,z.refs={},el(o),W=p.contextType,z.context=typeof W=="object"&&W!==null?Si(W):Yl,z.state===b&&(W=xt(p)||"Component",vx.has(W)||(vx.add(W),console.error("%s: It is not recommended to assign props directly to state because updates to props won't be reflected in state. In most cases, it is better to use props directly.",W))),o.mode&Ys&&Ic.recordLegacyContextWarning(o,z),Ic.recordUnsafeLifecycleWarnings(o,z),z.state=o.memoizedState,W=p.getDerivedStateFromProps,typeof W=="function"&&(rd(o,p,W,b),z.state=o.memoizedState),typeof p.getDerivedStateFromProps=="function"||typeof z.getSnapshotBeforeUpdate=="function"||typeof z.UNSAFE_componentWillMount!="function"&&typeof z.componentWillMount!="function"||(W=z.state,typeof z.componentWillMount=="function"&&z.componentWillMount(),typeof z.UNSAFE_componentWillMount=="function"&&z.UNSAFE_componentWillMount(),W!==z.state&&(console.error("%s.componentWillMount(): Assigning directly to this.state is deprecated (except inside a component's constructor). Use setState instead.",Ut(o)||"Component"),Z_.enqueueReplaceState(z,z.state,null)),er(o,b,z,O),Ls(),z.state=o.memoizedState),typeof z.componentDidMount=="function"&&(o.flags|=4194308),(o.mode&Ws)!==Mi&&(o.flags|=134217728),z=!0}else if(n===null){z=o.stateNode;var Dt=o.memoizedProps;oe=Ta(p,Dt),z.props=oe;var Ft=z.context;Ce=p.contextType,W=Yl,typeof Ce=="object"&&Ce!==null&&(W=Si(Ce)),Be=p.getDerivedStateFromProps,Ce=typeof Be=="function"||typeof z.getSnapshotBeforeUpdate=="function",Dt=o.pendingProps!==Dt,Ce||typeof z.UNSAFE_componentWillReceiveProps!="function"&&typeof z.componentWillReceiveProps!="function"||(Dt||Ft!==W)&&od(o,z,b,W),Td=!1;var Et=o.memoizedState;z.state=Et,er(o,b,z,O),Ls(),Ft=o.memoizedState,Dt||Et!==Ft||Td?(typeof Be=="function"&&(rd(o,p,Be,b),Ft=o.memoizedState),(oe=Td||id(o,p,oe,b,Et,Ft,W))?(Ce||typeof z.UNSAFE_componentWillMount!="function"&&typeof z.componentWillMount!="function"||(typeof z.componentWillMount=="function"&&z.componentWillMount(),typeof z.UNSAFE_componentWillMount=="function"&&z.UNSAFE_componentWillMount()),typeof z.componentDidMount=="function"&&(o.flags|=4194308),(o.mode&Ws)!==Mi&&(o.flags|=134217728)):(typeof z.componentDidMount=="function"&&(o.flags|=4194308),(o.mode&Ws)!==Mi&&(o.flags|=134217728),o.memoizedProps=b,o.memoizedState=Ft),z.props=b,z.state=Ft,z.context=W,z=oe):(typeof z.componentDidMount=="function"&&(o.flags|=4194308),(o.mode&Ws)!==Mi&&(o.flags|=134217728),z=!1)}else{z=o.stateNode,gc(n,o),W=o.memoizedProps,Ce=Ta(p,W),z.props=Ce,Be=o.pendingProps,Et=z.context,Ft=p.contextType,oe=Yl,typeof Ft=="object"&&Ft!==null&&(oe=Si(Ft)),Dt=p.getDerivedStateFromProps,(Ft=typeof Dt=="function"||typeof z.getSnapshotBeforeUpdate=="function")||typeof z.UNSAFE_componentWillReceiveProps!="function"&&typeof z.componentWillReceiveProps!="function"||(W!==Be||Et!==oe)&&od(o,z,b,oe),Td=!1,Et=o.memoizedState,z.state=Et,er(o,b,z,O),Ls();var Gt=o.memoizedState;W!==Be||Et!==Gt||Td||n!==null&&n.dependencies!==null&&Ka(n.dependencies)?(typeof Dt=="function"&&(rd(o,p,Dt,b),Gt=o.memoizedState),(Ce=Td||id(o,p,Ce,b,Et,Gt,oe)||n!==null&&n.dependencies!==null&&Ka(n.dependencies))?(Ft||typeof z.UNSAFE_componentWillUpdate!="function"&&typeof z.componentWillUpdate!="function"||(typeof z.componentWillUpdate=="function"&&z.componentWillUpdate(b,Gt,oe),typeof z.UNSAFE_componentWillUpdate=="function"&&z.UNSAFE_componentWillUpdate(b,Gt,oe)),typeof z.componentDidUpdate=="function"&&(o.flags|=4),typeof z.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof z.componentDidUpdate!="function"||W===n.memoizedProps&&Et===n.memoizedState||(o.flags|=4),typeof z.getSnapshotBeforeUpdate!="function"||W===n.memoizedProps&&Et===n.memoizedState||(o.flags|=1024),o.memoizedProps=b,o.memoizedState=Gt),z.props=b,z.state=Gt,z.context=oe,z=Ce):(typeof z.componentDidUpdate!="function"||W===n.memoizedProps&&Et===n.memoizedState||(o.flags|=4),typeof z.getSnapshotBeforeUpdate!="function"||W===n.memoizedProps&&Et===n.memoizedState||(o.flags|=1024),z=!1)}if(oe=z,ld(n,o),W=(o.flags&128)!==0,oe||W){if(oe=o.stateNode,ct(o),W&&typeof p.getDerivedStateFromError!="function")p=null,Ss=-1;else{if(Yr(o),p=Tp(oe),o.mode&Ys){rr(!0);try{Tp(oe)}finally{rr(!1)}}de()}o.flags|=1,n!==null&&W?(o.child=dg(o,n.child,null,O),o.child=dg(o,null,p,O)):zo(n,o,p,O),o.memoizedState=oe.state,n=o.child}else n=Bs(n,o,O);return O=o.stateNode,z&&O.props!==b&&(fg||console.error("It looks like %s is reassigning its own `this.props` while rendering. This is not supported and can lead to confusing bugs.",Ut(o)||"a component"),fg=!0),n}function tu(n,o,p,b){return mi(),o.flags|=256,zo(n,o,p,b),o.child}function sh(n,o){o&&o.childContextTypes&&console.error(`childContextTypes cannot be defined on a function component.
  %s.childContextTypes = ...`,o.displayName||o.name||"Component"),typeof o.getDerivedStateFromProps=="function"&&(n=xt(o)||"Unknown",k1[n]||(console.error("%s: Function components do not support getDerivedStateFromProps.",n),k1[n]=!0)),typeof o.contextType=="object"&&o.contextType!==null&&(o=xt(o)||"Unknown",Ex[o]||(console.error("%s: Function components do not support contextType.",o),Ex[o]=!0))}function nu(n){return{baseLanes:n,cachePool:mc()}}function ol(n,o,p){return n=n!==null?n.childLanes&~p:0,o&&(n|=za),n}function Gg(n,o,p){var b,O=o.pendingProps;$(o)&&(o.flags|=128);var z=!1,W=(o.flags&128)!==0;if((b=W)||(b=n!==null&&n.memoizedState===null?!1:(Lo.current&Ep)!==0),b&&(z=!0,o.flags&=-129),b=(o.flags&32)!==0,o.flags&=-33,n===null){if(Jr){if(z?vo(o):fa(o),Jr){var oe=Zi,Ce;if(!(Ce=!oe)){e:{var Be=oe;for(Ce=Jl;Be.nodeType!==8;){if(!Ce){Ce=null;break e}if(Be=Pi(Be.nextSibling),Be===null){Ce=null;break e}}Ce=Be}Ce!==null?(ba(),o.memoizedState={dehydrated:Ce,treeContext:Ih!==null?{id:xd,overflow:bd}:null,retryLane:536870912,hydrationErrors:null},Be=le(18,null,null,Mi),Be.stateNode=Ce,Be.return=o,o.child=Be,rs=o,Zi=null,Ce=!0):Ce=!1,Ce=!Ce}Ce&&(mf(o,oe),la(o))}if(oe=o.memoizedState,oe!==null&&(oe=oe.dehydrated,oe!==null))return Yo(oe)?o.lanes=32:o.lanes=536870912,null;il(o)}return oe=O.children,O=O.fallback,z?(fa(o),z=o.mode,oe=xm({mode:"hidden",children:oe},z),O=Lu(O,z,p,null),oe.return=o,O.return=o,oe.sibling=O,o.child=oe,z=o.child,z.memoizedState=nu(p),z.childLanes=ol(n,b,p),o.memoizedState=Ax,O):(vo(o),Xi(o,oe))}var Dt=n.memoizedState;if(Dt!==null&&(oe=Dt.dehydrated,oe!==null)){if(W)o.flags&256?(vo(o),o.flags&=-257,o=cd(n,o,p)):o.memoizedState!==null?(fa(o),o.child=n.child,o.flags|=128,o=null):(fa(o),z=O.fallback,oe=o.mode,O=xm({mode:"visible",children:O.children},oe),z=Lu(z,oe,p,null),z.flags|=2,O.return=o,z.return=o,O.sibling=z,o.child=O,dg(o,n.child,null,p),O=o.child,O.memoizedState=nu(p),O.childLanes=ol(n,b,p),o.memoizedState=Ax,o=z);else if(vo(o),Jr&&console.error("We should not be hydrating here. This is a bug in React. Please file a bug."),Yo(oe)){if(b=oe.nextSibling&&oe.nextSibling.dataset,b){Ce=b.dgst;var Ft=b.msg;Be=b.stck;var Et=b.cstck}oe=Ft,b=Ce,O=Be,Ce=z=Et,z=Error(oe||"The server could not finish this Suspense boundary, likely due to an error during server rendering. Switched to client rendering."),z.stack=O||"",z.digest=b,b=Ce===void 0?null:Ce,O={value:z,source:null,stack:b},typeof b=="string"&&Sv.set(z,O),zt(O),o=cd(n,o,p)}else if(Xo||Ml(n,o,p,!1),b=(p&n.childLanes)!==0,Xo||b){if(b=Li,b!==null&&(O=p&-p,O=(O&42)!==0?1:Ua(O),O=(O&(b.suspendedLanes|p))!==0?0:O,O!==0&&O!==Dt.retryLane))throw Dt.retryLane=O,Io(n,O),Ei(b,n,O),Sx;oe.data===Ee||cu(),o=cd(n,o,p)}else oe.data===Ee?(o.flags|=192,o.child=n.child,o=null):(n=Dt.treeContext,Zi=Pi(oe.nextSibling),rs=o,Jr=!0,wd=null,Xl=!1,Kl=null,Jl=!1,n!==null&&(ba(),ml[Wl++]=xd,ml[Wl++]=bd,ml[Wl++]=Ih,xd=n.id,bd=n.overflow,Ih=o),o=Xi(o,O.children),o.flags|=4096);return o}return z?(fa(o),z=O.fallback,oe=o.mode,Ce=n.child,Be=Ce.sibling,O=Ya(Ce,{mode:"hidden",children:O.children}),O.subtreeFlags=Ce.subtreeFlags&65011712,Be!==null?z=Ya(Be,z):(z=Lu(z,oe,p,null),z.flags|=2),z.return=o,O.return=o,O.sibling=z,o.child=O,O=z,z=o.child,oe=n.child.memoizedState,oe===null?oe=nu(p):(Ce=oe.cachePool,Ce!==null?(Be=Eo._currentValue,Ce=Ce.parent!==Be?{parent:Be,pool:Be}:Ce):Ce=mc(),oe={baseLanes:oe.baseLanes|p,cachePool:Ce}),z.memoizedState=oe,z.childLanes=ol(n,b,p),o.memoizedState=Ax,O):(vo(o),p=n.child,n=p.sibling,p=Ya(p,{mode:"visible",children:O.children}),p.return=o,p.sibling=null,n!==null&&(b=o.deletions,b===null?(o.deletions=[n],o.flags|=16):b.push(n)),o.child=p,o.memoizedState=null,p)}function Xi(n,o){return o=xm({mode:"visible",children:o},n.mode),o.return=n,n.child=o}function xm(n,o){return n=le(22,n,null,o),n.lanes=0,n.stateNode={_visibility:up,_pendingMarkers:null,_retryCache:null,_transitions:null},n}function cd(n,o,p){return dg(o,n.child,null,p),n=Xi(o,o.pendingProps.children),n.flags|=2,o.memoizedState=null,n}function Xr(n,o,p){n.lanes|=o;var b=n.alternate;b!==null&&(b.lanes|=o),$d(n.return,o,p)}function _r(n,o){var p=es(n);return n=!p&&typeof cn(n)=="function",p||n?(p=p?"array":"iterable",console.error("A nested %s was passed to row #%s in <SuspenseList />. Wrap it in an additional SuspenseList to configure its revealOrder: <SuspenseList revealOrder=...> ... <SuspenseList revealOrder=...>{%s}</SuspenseList> ... </SuspenseList>",p,o,p),!1):!0}function bm(n,o,p,b,O){var z=n.memoizedState;z===null?n.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:b,tail:p,tailMode:O}:(z.isBackwards=o,z.rendering=null,z.renderingStartTime=0,z.last=b,z.tail=p,z.tailMode=O)}function Pl(n,o,p){var b=o.pendingProps,O=b.revealOrder,z=b.tail;if(b=b.children,O!==void 0&&O!=="forwards"&&O!=="backwards"&&O!=="together"&&!O1[O])if(O1[O]=!0,typeof O=="string")switch(O.toLowerCase()){case"together":case"forwards":case"backwards":console.error('"%s" is not a valid value for revealOrder on <SuspenseList />. Use lowercase "%s" instead.',O,O.toLowerCase());break;case"forward":case"backward":console.error('"%s" is not a valid value for revealOrder on <SuspenseList />. React uses the -s suffix in the spelling. Use "%ss" instead.',O,O.toLowerCase());break;default:console.error('"%s" is not a supported revealOrder on <SuspenseList />. Did you mean "together", "forwards" or "backwards"?',O)}else console.error('%s is not a supported value for revealOrder on <SuspenseList />. Did you mean "together", "forwards" or "backwards"?',O);z===void 0||pg[z]||(z!=="collapsed"&&z!=="hidden"?(pg[z]=!0,console.error('"%s" is not a supported value for tail on <SuspenseList />. Did you mean "collapsed" or "hidden"?',z)):O!=="forwards"&&O!=="backwards"&&(pg[z]=!0,console.error('<SuspenseList tail="%s" /> is only valid if revealOrder is "forwards" or "backwards". Did you mean to specify revealOrder="forwards"?',z)));e:if((O==="forwards"||O==="backwards")&&b!==void 0&&b!==null&&b!==!1)if(es(b)){for(var W=0;W<b.length;W++)if(!_r(b[W],W))break e}else if(W=cn(b),typeof W=="function"){if(W=W.call(b))for(var oe=W.next(),Ce=0;!oe.done;oe=W.next()){if(!_r(oe.value,Ce))break e;Ce++}}else console.error('A single row was passed to a <SuspenseList revealOrder="%s" />. This is not useful since it needs multiple rows. Did you mean to pass multiple children or an array?',O);if(zo(n,o,b,p),b=Lo.current,(b&Ep)!==0)b=b&hg|Ep,o.flags|=128;else{if(n!==null&&(n.flags&128)!==0)e:for(n=o.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Xr(n,p,o);else if(n.tag===19)Xr(n,p,o);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===o)break e;for(;n.sibling===null;){if(n.return===null||n.return===o)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}b&=hg}switch(ln(Lo,b,o),O){case"forwards":for(p=o.child,O=null;p!==null;)n=p.alternate,n!==null&&rh(n)===null&&(O=p),p=p.sibling;p=O,p===null?(O=o.child,o.child=null):(O=p.sibling,p.sibling=null),bm(o,!1,O,p,z);break;case"backwards":for(p=null,O=o.child,o.child=null;O!==null;){if(n=O.alternate,n!==null&&rh(n)===null){o.child=O;break}n=O.sibling,O.sibling=p,p=O,O=n}bm(o,!0,p,null,z);break;case"together":bm(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function Bs(n,o,p){if(n!==null&&(o.dependencies=n.dependencies),Ss=-1,yl|=o.lanes,(p&o.childLanes)===0)if(n!==null){if(Ml(n,o,p,!1),(p&o.childLanes)===0)return null}else return null;if(n!==null&&o.child!==n.child)throw Error("Resuming work not yet implemented.");if(o.child!==null){for(n=o.child,p=Ya(n,n.pendingProps),o.child=p,p.return=o;n.sibling!==null;)n=n.sibling,p=p.sibling=Ya(n,n.pendingProps),p.return=o;p.sibling=null}return o.child}function sl(n,o){return(n.lanes&o)!==0?!0:(n=n.dependencies,!!(n!==null&&Ka(n)))}function ud(n,o,p){switch(o.tag){case 3:mn(o,o.stateNode.containerInfo),zi(o,Eo,n.memoizedState.cache),mi();break;case 27:case 5:Kt(o);break;case 4:mn(o,o.stateNode.containerInfo);break;case 10:zi(o,o.type,o.memoizedProps.value);break;case 12:(p&o.childLanes)!==0&&(o.flags|=4),o.flags|=2048;var b=o.stateNode;b.effectDuration=-0,b.passiveEffectDuration=-0;break;case 13:if(b=o.memoizedState,b!==null)return b.dehydrated!==null?(vo(o),o.flags|=128,null):(p&o.child.childLanes)!==0?Gg(n,o,p):(vo(o),n=Bs(n,o,p),n!==null?n.sibling:null);vo(o);break;case 19:var O=(n.flags&128)!==0;if(b=(p&o.childLanes)!==0,b||(Ml(n,o,p,!1),b=(p&o.childLanes)!==0),O){if(b)return Pl(n,o,p);o.flags|=128}if(O=o.memoizedState,O!==null&&(O.rendering=null,O.tail=null,O.lastEffect=null),ln(Lo,Lo.current,o),b)break;return null;case 22:case 23:return o.lanes=0,Py(n,o,p);case 24:zi(o,Eo,n.memoizedState.cache)}return Bs(n,o,p)}function dd(n,o,p){if(o._debugNeedsRemount&&n!==null){p=Rg(o.type,o.key,o.pendingProps,o._debugOwner||null,o.mode,o.lanes),p._debugStack=o._debugStack,p._debugTask=o._debugTask;var b=o.return;if(b===null)throw Error("Cannot swap the root fiber.");if(n.alternate=null,o.alternate=null,p.index=o.index,p.sibling=o.sibling,p.return=o.return,p.ref=o.ref,p._debugInfo=o._debugInfo,o===b.child)b.child=p;else{var O=b.child;if(O===null)throw Error("Expected parent to have a child.");for(;O.sibling!==o;)if(O=O.sibling,O===null)throw Error("Expected to find the previous sibling.");O.sibling=p}return o=b.deletions,o===null?(b.deletions=[n],b.flags|=16):o.push(n),p.flags|=2,p}if(n!==null)if(n.memoizedProps!==o.pendingProps||o.type!==n.type)Xo=!0;else{if(!sl(n,p)&&(o.flags&128)===0)return Xo=!1,ud(n,o,p);Xo=(n.flags&131072)!==0}else Xo=!1,(b=Jr)&&(ba(),b=(o.flags&1048576)!==0),b&&(b=o.index,ba(),pf(o,Ev,b));switch(o.lanes=0,o.tag){case 16:e:if(b=o.pendingProps,n=Vh(o.elementType),o.type=n,typeof n=="function")El(n)?(b=Ta(n,b),o.tag=1,o.type=n=Za(n),o=vm(null,o,n,b,p)):(o.tag=0,sh(o,n),o.type=n=Za(n),o=zl(null,o,n,b,p));else{if(n!=null){if(O=n.$$typeof,O===dl){o.tag=11,o.type=n=Pu(n),o=qg(null,o,n,b,p);break e}else if(O===h_){o.tag=14,o=ad(null,o,n,b,p);break e}}throw o="",n!==null&&typeof n=="object"&&n.$$typeof===Wo&&(o=" Did you wrap a component in React.lazy() more than once?"),n=xt(n)||n,Error("Element type is invalid. Received a promise that resolves to: "+n+". Lazy element type must resolve to a class or function."+o)}return o;case 0:return zl(n,o,o.type,o.pendingProps,p);case 1:return b=o.type,O=Ta(b,o.pendingProps),vm(n,o,b,O,p);case 3:e:{if(mn(o,o.stateNode.containerInfo),n===null)throw Error("Should have a current fiber. This is a bug in React.");b=o.pendingProps;var z=o.memoizedState;O=z.element,gc(n,o),er(o,b,null,p);var W=o.memoizedState;if(b=W.cache,zi(o,Eo,b),b!==z.cache&&Xa(o,[Eo],p,!0),Ls(),b=W.element,z.isDehydrated)if(z={element:b,isDehydrated:!1,cache:W.cache},o.updateQueue.baseState=z,o.memoizedState=z,o.flags&256){o=tu(n,o,b,p);break e}else if(b!==O){O=Ci(Error("This root received an early update, before anything was able hydrate. Switched the entire root to client rendering."),o),zt(O),o=tu(n,o,b,p);break e}else{switch(n=o.stateNode.containerInfo,n.nodeType){case 9:n=n.body;break;default:n=n.nodeName==="HTML"?n.ownerDocument.body:n}for(Zi=Pi(n.firstChild),rs=o,Jr=!0,wd=null,Xl=!1,Kl=null,Jl=!0,n=R1(o,null,b,p),o.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling}else{if(mi(),b===O){o=Bs(n,o,p);break e}zo(n,o,b,p)}o=o.child}return o;case 26:return ld(n,o),n===null?(n=o0(o.type,null,o.pendingProps,null))?o.memoizedState=n:Jr||(n=o.type,p=o.pendingProps,b=An(Ch.current),b=Pn(b).createElement(n),b[Po]=o,b[ts]=p,kt(b,n,p),it(b),o.stateNode=b):o.memoizedState=o0(o.type,n.memoizedProps,o.pendingProps,n.memoizedState),null;case 27:return Kt(o),n===null&&Jr&&(b=An(Ch.current),O=Nt(),b=o.stateNode=Lm(o.type,o.pendingProps,b,O,!1),Xl||(O=Kn(b,o.type,o.pendingProps,O),O!==null&&(Dn(o,0).serverProps=O)),rs=o,Jl=!0,O=Zi,Fi(o.type)?(On=O,Zi=Pi(b.firstChild)):Zi=O),zo(n,o,o.pendingProps.children,p),ld(n,o),n===null&&(o.flags|=4194304),o.child;case 5:return n===null&&Jr&&(z=Nt(),b=Hd(o.type,z.ancestorInfo),O=Zi,(W=!O)||(W=Hs(O,o.type,o.pendingProps,Jl),W!==null?(o.stateNode=W,Xl||(z=Kn(W,o.type,o.pendingProps,z),z!==null&&(Dn(o,0).serverProps=z)),rs=o,Zi=Pi(W.firstChild),Jl=!1,z=!0):z=!1,W=!z),W&&(b&&mf(o,O),la(o))),Kt(o),O=o.type,z=o.pendingProps,W=n!==null?n.memoizedProps:null,b=z.children,Dr(O,z)?b=null:W!==null&&Dr(O,W)&&(o.flags|=32),o.memoizedState!==null&&(O=im(n,o,xf,null,null,p),ki._currentValue=O),ld(n,o),zo(n,o,b,p),o.child;case 6:return n===null&&Jr&&(n=o.pendingProps,p=Nt(),b=p.ancestorInfo.current,n=b!=null?Is(n,b.tag,p.ancestorInfo.implicitRootScope):!0,p=Zi,(b=!p)||(b=ka(p,o.pendingProps,Jl),b!==null?(o.stateNode=b,rs=o,Zi=null,b=!0):b=!1,b=!b),b&&(n&&mf(o,p),la(o))),null;case 13:return Gg(n,o,p);case 4:return mn(o,o.stateNode.containerInfo),b=o.pendingProps,n===null?o.child=dg(o,null,b,p):zo(n,o,b,p),o.child;case 11:return qg(n,o,o.type,o.pendingProps,p);case 7:return zo(n,o,o.pendingProps,p),o.child;case 8:return zo(n,o,o.pendingProps.children,p),o.child;case 12:return o.flags|=4,o.flags|=2048,b=o.stateNode,b.effectDuration=-0,b.passiveEffectDuration=-0,zo(n,o,o.pendingProps.children,p),o.child;case 10:return b=o.type,O=o.pendingProps,z=O.value,"value"in O||I1||(I1=!0,console.error("The `value` prop is required for the `<Context.Provider>`. Did you misspell it or forget to pass it?")),zi(o,b,z),zo(n,o,O.children,p),o.child;case 9:return O=o.type._context,b=o.pendingProps.children,typeof b!="function"&&console.error("A context consumer was rendered with multiple children, or a child that isn't a function. A context consumer expects a single child that is a function. If you did pass a function, make sure there is no trailing or leading whitespace around it."),Sa(o),O=Si(O),Yr(o),b=Sp(b,O,void 0),de(),o.flags|=1,zo(n,o,b,p),o.child;case 14:return ad(n,o,o.type,o.pendingProps,p);case 15:return zy(n,o,o.type,o.pendingProps,p);case 19:return Pl(n,o,p);case 31:return b=o.pendingProps,p=o.mode,b={mode:b.mode,children:b.children},n===null?(n=xm(b,p),n.ref=o.ref,o.child=n,n.return=o,o=n):(n=Ya(n.child,b),n.ref=o.ref,o.child=n,n.return=o,o=n),o;case 22:return Py(n,o,p);case 24:return Sa(o),b=Si(Eo),n===null?(O=Uu(),O===null&&(O=Li,z=_f(),O.pooledCache=z,Hc(z),z!==null&&(O.pooledCacheLanes|=p),O=z),o.memoizedState={parent:b,cache:O},el(o),zi(o,Eo,O)):((n.lanes&p)!==0&&(gc(n,o),er(o,null,null,p),Ls()),O=n.memoizedState,z=o.memoizedState,O.parent!==b?(O={parent:b,cache:b},o.memoizedState=O,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=O),zi(o,Eo,b)):(b=z.cache,zi(o,Eo,b),b!==O.cache&&Xa(o,[Eo],p,!0))),zo(n,o,o.pendingProps.children,p),o.child;case 29:throw o.pendingProps}throw Error("Unknown unit of work tag ("+o.tag+"). This error is likely caused by a bug in React. Please file an issue.")}function al(n){n.flags|=4}function pa(n,o){if(o.type!=="stylesheet"||(o.state.loading&mr)!==Vn)n.flags&=-16777217;else if(n.flags|=16777216,!Fm(o)){if(o=Ts.current,o!==null&&((Tr&4194048)===Tr?Ia!==null:(Tr&62914560)!==Tr&&(Tr&536870912)===0||o!==Ia))throw L_=rx,nx;n.flags|=8192}}function ah(n,o){o!==null&&(n.flags|=4),n.flags&16384&&(o=n.tag!==22?ea():536870912,n.lanes|=o,Zh|=o)}function gs(n,o){if(!Jr)switch(n.tailMode){case"hidden":o=n.tail;for(var p=null;o!==null;)o.alternate!==null&&(p=o),o=o.sibling;p===null?n.tail=null:p.sibling=null;break;case"collapsed":p=n.tail;for(var b=null;p!==null;)p.alternate!==null&&(b=p),p=p.sibling;b===null?o||n.tail===null?n.tail=null:n.tail.sibling=null:b.sibling=null}}function gi(n){var o=n.alternate!==null&&n.alternate.child===n.child,p=0,b=0;if(o)if((n.mode&ws)!==Mi){for(var O=n.selfBaseDuration,z=n.child;z!==null;)p|=z.lanes|z.childLanes,b|=z.subtreeFlags&65011712,b|=z.flags&65011712,O+=z.treeBaseDuration,z=z.sibling;n.treeBaseDuration=O}else for(O=n.child;O!==null;)p|=O.lanes|O.childLanes,b|=O.subtreeFlags&65011712,b|=O.flags&65011712,O.return=n,O=O.sibling;else if((n.mode&ws)!==Mi){O=n.actualDuration,z=n.selfBaseDuration;for(var W=n.child;W!==null;)p|=W.lanes|W.childLanes,b|=W.subtreeFlags,b|=W.flags,O+=W.actualDuration,z+=W.treeBaseDuration,W=W.sibling;n.actualDuration=O,n.treeBaseDuration=z}else for(O=n.child;O!==null;)p|=O.lanes|O.childLanes,b|=O.subtreeFlags,b|=O.flags,O.return=n,O=O.sibling;return n.subtreeFlags|=b,n.childLanes=p,o}function wm(n,o,p){var b=o.pendingProps;switch(Wa(o),o.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return gi(o),null;case 1:return gi(o),null;case 3:return p=o.stateNode,b=null,n!==null&&(b=n.memoizedState.cache),o.memoizedState.cache!==b&&(o.flags|=2048),Dl(Eo,o),$t(o),p.pendingContext&&(p.context=p.pendingContext,p.pendingContext=null),(n===null||n.child===null)&&(Cl(o)?(gf(),al(o)):n===null||n.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,Gd())),gi(o),null;case 26:return p=o.memoizedState,n===null?(al(o),p!==null?(gi(o),pa(o,p)):(gi(o),o.flags&=-16777217)):p?p!==n.memoizedState?(al(o),gi(o),pa(o,p)):(gi(o),o.flags&=-16777217):(n.memoizedProps!==b&&al(o),gi(o),o.flags&=-16777217),null;case 27:It(o),p=An(Ch.current);var O=o.type;if(n!==null&&o.stateNode!=null)n.memoizedProps!==b&&al(o);else{if(!b){if(o.stateNode===null)throw Error("We must have new props for new mounts. This error is likely caused by a bug in React. Please file an issue.");return gi(o),null}n=Nt(),Cl(o)?Bu(o):(n=Lm(O,b,p,n,!0),o.stateNode=n,al(o))}return gi(o),null;case 5:if(It(o),p=o.type,n!==null&&o.stateNode!=null)n.memoizedProps!==b&&al(o);else{if(!b){if(o.stateNode===null)throw Error("We must have new props for new mounts. This error is likely caused by a bug in React. Please file an issue.");return gi(o),null}if(O=Nt(),Cl(o))Bu(o);else{switch(n=An(Ch.current),Hd(p,O.ancestorInfo),O=O.context,n=Pn(n),O){case vt:n=n.createElementNS(Wm,p);break;case _t:n=n.createElementNS(uv,p);break;default:switch(p){case"svg":n=n.createElementNS(Wm,p);break;case"math":n=n.createElementNS(uv,p);break;case"script":n=n.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild);break;case"select":n=typeof b.is=="string"?n.createElement("select",{is:b.is}):n.createElement("select"),b.multiple?n.multiple=!0:b.size&&(n.size=b.size);break;default:n=typeof b.is=="string"?n.createElement(p,{is:b.is}):n.createElement(p),p.indexOf("-")===-1&&(p!==p.toLowerCase()&&console.error("<%s /> is using incorrect casing. Use PascalCase for React components, or lowercase for HTML elements.",p),Object.prototype.toString.call(n)!=="[object HTMLUnknownElement]"||_d.call(Bt,p)||(Bt[p]=!0,console.error("The tag <%s> is unrecognized in this browser. If you meant to render a React component, start its name with an uppercase letter.",p)))}}n[Po]=o,n[ts]=b;e:for(O=o.child;O!==null;){if(O.tag===5||O.tag===6)n.appendChild(O.stateNode);else if(O.tag!==4&&O.tag!==27&&O.child!==null){O.child.return=O,O=O.child;continue}if(O===o)break e;for(;O.sibling===null;){if(O.return===null||O.return===o)break e;O=O.return}O.sibling.return=O.return,O=O.sibling}o.stateNode=n;e:switch(kt(n,p,b),p){case"button":case"input":case"select":case"textarea":n=!!b.autoFocus;break e;case"img":n=!0;break e;default:n=!1}n&&al(o)}}return gi(o),o.flags&=-16777217,null;case 6:if(n&&o.stateNode!=null)n.memoizedProps!==b&&al(o);else{if(typeof b!="string"&&o.stateNode===null)throw Error("We must have new props for new mounts. This error is likely caused by a bug in React. Please file an issue.");if(n=An(Ch.current),p=Nt(),Cl(o)){n=o.stateNode,p=o.memoizedProps,O=!Xl,b=null;var z=rs;if(z!==null)switch(z.tag){case 3:O&&(O=cl(n,p,b),O!==null&&(Dn(o,0).serverProps=O));break;case 27:case 5:b=z.memoizedProps,O&&(O=cl(n,p,b),O!==null&&(Dn(o,0).serverProps=O))}n[Po]=o,n=!!(n.nodeValue===p||b!==null&&b.suppressHydrationWarning===!0||yt(n.nodeValue,p)),n||la(o)}else O=p.ancestorInfo.current,O!=null&&Is(b,O.tag,p.ancestorInfo.implicitRootScope),n=Pn(n).createTextNode(b),n[Po]=o,o.stateNode=n}return gi(o),null;case 13:if(b=o.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(O=Cl(o),b!==null&&b.dehydrated!==null){if(n===null){if(!O)throw Error("A dehydrated suspense component was completed without a hydrated node. This is probably a bug in React.");if(O=o.memoizedState,O=O!==null?O.dehydrated:null,!O)throw Error("Expected to have a hydrated suspense instance. This error is likely caused by a bug in React. Please file an issue.");O[Po]=o,gi(o),(o.mode&ws)!==Mi&&b!==null&&(O=o.child,O!==null&&(o.treeBaseDuration-=O.treeBaseDuration))}else gf(),mi(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4,gi(o),(o.mode&ws)!==Mi&&b!==null&&(O=o.child,O!==null&&(o.treeBaseDuration-=O.treeBaseDuration));O=!1}else O=Gd(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=O),O=!0;if(!O)return o.flags&256?(il(o),o):(il(o),null)}return il(o),(o.flags&128)!==0?(o.lanes=p,(o.mode&ws)!==Mi&&Gc(o),o):(p=b!==null,n=n!==null&&n.memoizedState!==null,p&&(b=o.child,O=null,b.alternate!==null&&b.alternate.memoizedState!==null&&b.alternate.memoizedState.cachePool!==null&&(O=b.alternate.memoizedState.cachePool.pool),z=null,b.memoizedState!==null&&b.memoizedState.cachePool!==null&&(z=b.memoizedState.cachePool.pool),z!==O&&(b.flags|=2048)),p!==n&&p&&(o.child.flags|=8192),ah(o,o.updateQueue),gi(o),(o.mode&ws)!==Mi&&p&&(n=o.child,n!==null&&(o.treeBaseDuration-=n.treeBaseDuration)),null);case 4:return $t(o),n===null&&Te(o.stateNode.containerInfo),gi(o),null;case 10:return Dl(o.type,o),gi(o),null;case 19:if(Rt(Lo,o),O=o.memoizedState,O===null)return gi(o),null;if(b=(o.flags&128)!==0,z=O.rendering,z===null)if(b)gs(O,!1);else{if(xi!==kd||n!==null&&(n.flags&128)!==0)for(n=o.child;n!==null;){if(z=rh(n),z!==null){for(o.flags|=128,gs(O,!1),n=z.updateQueue,o.updateQueue=n,ah(o,n),o.subtreeFlags=0,n=p,p=o.child;p!==null;)Ty(p,n),p=p.sibling;return ln(Lo,Lo.current&hg|Ep,o),o.child}n=n.sibling}O.tail!==null&&hl()>Fv&&(o.flags|=128,b=!0,gs(O,!1),o.lanes=4194304)}else{if(!b)if(n=rh(z),n!==null){if(o.flags|=128,b=!0,n=n.updateQueue,o.updateQueue=n,ah(o,n),gs(O,!0),O.tail===null&&O.tailMode==="hidden"&&!z.alternate&&!Jr)return gi(o),null}else 2*hl()-O.renderingStartTime>Fv&&p!==536870912&&(o.flags|=128,b=!0,gs(O,!1),o.lanes=4194304);O.isBackwards?(z.sibling=o.child,o.child=z):(n=O.last,n!==null?n.sibling=z:o.child=z,O.last=z)}return O.tail!==null?(n=O.tail,O.rendering=n,O.tail=n.sibling,O.renderingStartTime=hl(),n.sibling=null,p=Lo.current,p=b?p&hg|Ep:p&hg,ln(Lo,p,o),n):(gi(o),null);case 22:case 23:return il(o),ni(o),b=o.memoizedState!==null,n!==null?n.memoizedState!==null!==b&&(o.flags|=8192):b&&(o.flags|=8192),b?(p&536870912)!==0&&(o.flags&128)===0&&(gi(o),o.subtreeFlags&6&&(o.flags|=8192)):gi(o),p=o.updateQueue,p!==null&&ah(o,p.retryQueue),p=null,n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(p=n.memoizedState.cachePool.pool),b=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(b=o.memoizedState.cachePool.pool),b!==p&&(o.flags|=2048),n!==null&&Rt(Ph,o),null;case 24:return p=null,n!==null&&(p=n.memoizedState.cache),o.memoizedState.cache!==p&&(o.flags|=2048),Dl(Eo,o),gi(o),null;case 25:return null;case 30:return null}throw Error("Unknown unit of work tag ("+o.tag+"). This error is likely caused by a bug in React. Please file an issue.")}function Sm(n,o){switch(Wa(o),o.tag){case 1:return n=o.flags,n&65536?(o.flags=n&-65537|128,(o.mode&ws)!==Mi&&Gc(o),o):null;case 3:return Dl(Eo,o),$t(o),n=o.flags,(n&65536)!==0&&(n&128)===0?(o.flags=n&-65537|128,o):null;case 26:case 27:case 5:return It(o),null;case 13:if(il(o),n=o.memoizedState,n!==null&&n.dehydrated!==null){if(o.alternate===null)throw Error("Threw in newly mounted dehydrated component. This is likely a bug in React. Please file an issue.");mi()}return n=o.flags,n&65536?(o.flags=n&-65537|128,(o.mode&ws)!==Mi&&Gc(o),o):null;case 19:return Rt(Lo,o),null;case 4:return $t(o),null;case 10:return Dl(o.type,o),null;case 22:case 23:return il(o),ni(o),n!==null&&Rt(Ph,o),n=o.flags,n&65536?(o.flags=n&-65537|128,(o.mode&ws)!==Mi&&Gc(o),o):null;case 24:return Dl(Eo,o),null;case 25:return null;default:return null}}function Tm(n,o){switch(Wa(o),o.tag){case 3:Dl(Eo,o),$t(o);break;case 26:case 27:case 5:It(o);break;case 4:$t(o);break;case 13:il(o);break;case 19:Rt(Lo,o);break;case 10:Dl(o.type,o);break;case 22:case 23:il(o),ni(o),n!==null&&Rt(Ph,o);break;case 24:Dl(Eo,o)}}function Ea(n){return(n.mode&ws)!==Mi}function ru(n,o){Ea(n)?(Ja(),Aa(o,n),ca()):Aa(o,n)}function zf(n,o,p){Ea(n)?(Ja(),iu(p,n,o),ca()):iu(p,n,o)}function Aa(n,o){try{var p=o.updateQueue,b=p!==null?p.lastEffect:null;if(b!==null){var O=b.next;p=O;do{if((p.tag&n)===n&&((n&uo)!==ec?Ln!==null&&typeof Ln.markComponentPassiveEffectMountStarted=="function"&&Ln.markComponentPassiveEffectMountStarted(o):(n&is)!==ec&&Ln!==null&&typeof Ln.markComponentLayoutEffectMountStarted=="function"&&Ln.markComponentLayoutEffectMountStarted(o),b=void 0,(n&ya)!==ec&&(nf=!0),b=Ye(o,_S,p),(n&ya)!==ec&&(nf=!1),(n&uo)!==ec?Ln!==null&&typeof Ln.markComponentPassiveEffectMountStopped=="function"&&Ln.markComponentPassiveEffectMountStopped():(n&is)!==ec&&Ln!==null&&typeof Ln.markComponentLayoutEffectMountStopped=="function"&&Ln.markComponentLayoutEffectMountStopped(),b!==void 0&&typeof b!="function")){var z=void 0;z=(p.tag&is)!==0?"useLayoutEffect":(p.tag&ya)!==0?"useInsertionEffect":"useEffect";var W=void 0;W=b===null?" You returned null. If your effect does not require clean up, return undefined (or nothing).":typeof b.then=="function"?`

It looks like you wrote `+z+`(async () => ...) or returned a Promise. Instead, write the async function inside your effect and call it immediately:

`+z+`(() => {
  async function fetchData() {
    // You can await here
    const response = await MyAPI.getData(someId);
    // ...
  }
  fetchData();
}, [someId]); // Or [] if effect doesn't need props or state

Learn more about data fetching with Hooks: https://react.dev/link/hooks-data-fetching`:" You returned: "+b,Ye(o,function(oe,Ce){console.error("%s must not return anything besides a function, which is used for clean-up.%s",oe,Ce)},z,W)}p=p.next}while(p!==O)}}catch(oe){Sr(o,o.return,oe)}}function iu(n,o,p){try{var b=o.updateQueue,O=b!==null?b.lastEffect:null;if(O!==null){var z=O.next;b=z;do{if((b.tag&n)===n){var W=b.inst,oe=W.destroy;oe!==void 0&&(W.destroy=void 0,(n&uo)!==ec?Ln!==null&&typeof Ln.markComponentPassiveEffectUnmountStarted=="function"&&Ln.markComponentPassiveEffectUnmountStarted(o):(n&is)!==ec&&Ln!==null&&typeof Ln.markComponentLayoutEffectUnmountStarted=="function"&&Ln.markComponentLayoutEffectUnmountStarted(o),(n&ya)!==ec&&(nf=!0),O=o,Ye(O,Iv,O,p,oe),(n&ya)!==ec&&(nf=!1),(n&uo)!==ec?Ln!==null&&typeof Ln.markComponentPassiveEffectUnmountStopped=="function"&&Ln.markComponentPassiveEffectUnmountStopped():(n&is)!==ec&&Ln!==null&&typeof Ln.markComponentLayoutEffectUnmountStopped=="function"&&Ln.markComponentLayoutEffectUnmountStopped())}b=b.next}while(b!==z)}}catch(Ce){Sr(o,o.return,Ce)}}function lh(n,o){Ea(n)?(Ja(),Aa(o,n),ca()):Aa(o,n)}function Pf(n,o,p){Ea(n)?(Ja(),iu(p,n,o),ca()):iu(p,n,o)}function Em(n){var o=n.updateQueue;if(o!==null){var p=n.stateNode;n.type.defaultProps||"ref"in n.memoizedProps||fg||(p.props!==n.memoizedProps&&console.error("Expected %s props to match memoized props before processing the update queue. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",Ut(n)||"instance"),p.state!==n.memoizedState&&console.error("Expected %s state to match memoized state before processing the update queue. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",Ut(n)||"instance"));try{Ye(n,qu,o,p)}catch(b){Sr(n,n.return,b)}}}function xo(n,o,p){return n.getSnapshotBeforeUpdate(o,p)}function Am(n,o){var p=o.memoizedProps,b=o.memoizedState;o=n.stateNode,n.type.defaultProps||"ref"in n.memoizedProps||fg||(o.props!==n.memoizedProps&&console.error("Expected %s props to match memoized props before getSnapshotBeforeUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",Ut(n)||"instance"),o.state!==n.memoizedState&&console.error("Expected %s state to match memoized state before getSnapshotBeforeUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",Ut(n)||"instance"));try{var O=Ta(n.type,p,n.elementType===n.type),z=Ye(n,xo,o,O,b);p=N1,z!==void 0||p.has(n.type)||(p.add(n.type),Ye(n,function(){console.error("%s.getSnapshotBeforeUpdate(): A snapshot value (or null) must be returned. You have returned undefined.",Ut(n))})),o.__reactInternalSnapshotBeforeUpdate=z}catch(W){Sr(n,n.return,W)}}function Lf(n,o,p){p.props=Ta(n.type,n.memoizedProps),p.state=n.memoizedState,Ea(n)?(Ja(),Ye(n,T1,n,o,p),ca()):Ye(n,T1,n,o,p)}function Fs(n){var o=n.ref;if(o!==null){switch(n.tag){case 26:case 27:case 5:var p=n.stateNode;break;case 30:p=n.stateNode;break;default:p=n.stateNode}if(typeof o=="function")if(Ea(n))try{Ja(),n.refCleanup=o(p)}finally{ca()}else n.refCleanup=o(p);else typeof o=="string"?console.error("String refs are no longer supported."):o.hasOwnProperty("current")||console.error("Unexpected ref object provided for %s. Use either a ref-setter function or React.createRef().",Ut(n)),o.current=p}}function ou(n,o){try{Ye(n,Fs,n)}catch(p){Sr(n,o,p)}}function Ca(n,o){var p=n.ref,b=n.refCleanup;if(p!==null)if(typeof b=="function")try{if(Ea(n))try{Ja(),Ye(n,b)}finally{ca(n)}else Ye(n,b)}catch(O){Sr(n,o,O)}finally{n.refCleanup=null,n=n.alternate,n!=null&&(n.refCleanup=null)}else if(typeof p=="function")try{if(Ea(n))try{Ja(),Ye(n,p,null)}finally{ca(n)}else Ye(n,p,null)}catch(O){Sr(n,o,O)}else p.current=null}function Cm(n,o,p,b){var O=n.memoizedProps,z=O.id,W=O.onCommit;O=O.onRender,o=o===null?"mount":"update",Cv&&(o="nested-update"),typeof O=="function"&&O(z,o,n.actualDuration,n.treeBaseDuration,n.actualStartTime,p),typeof W=="function"&&W(n.memoizedProps.id,o,b,p)}function ch(n,o,p,b){var O=n.memoizedProps;n=O.id,O=O.onPostCommit,o=o===null?"mount":"update",Cv&&(o="nested-update"),typeof O=="function"&&O(n,o,b,p)}function uh(n){var o=n.type,p=n.memoizedProps,b=n.stateNode;try{Ye(n,Bi,b,o,p,n)}catch(O){Sr(n,n.return,O)}}function dh(n,o,p){try{Ye(n,Ji,n.stateNode,n.type,p,o,n)}catch(b){Sr(n,n.return,b)}}function Bf(n){return n.tag===5||n.tag===3||n.tag===26||n.tag===27&&Fi(n.type)||n.tag===4}function hh(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Bf(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.tag===27&&Fi(n.type)||n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function fh(n,o,p){var b=n.tag;if(b===5||b===6)n=n.stateNode,o?(p.nodeType===9?p.body:p.nodeName==="HTML"?p.ownerDocument.body:p).insertBefore(n,o):(o=p.nodeType===9?p.body:p.nodeName==="HTML"?p.ownerDocument.body:p,o.appendChild(n),p=p._reactRootContainer,p!=null||o.onclick!==null||(o.onclick=st));else if(b!==4&&(b===27&&Fi(n.type)&&(p=n.stateNode,o=null),n=n.child,n!==null))for(fh(n,o,p),n=n.sibling;n!==null;)fh(n,o,p),n=n.sibling}function ph(n,o,p){var b=n.tag;if(b===5||b===6)n=n.stateNode,o?p.insertBefore(n,o):p.appendChild(n);else if(b!==4&&(b===27&&Fi(n.type)&&(p=n.stateNode),n=n.child,n!==null))for(ph(n,o,p),n=n.sibling;n!==null;)ph(n,o,p),n=n.sibling}function $g(n){for(var o,p=n.return;p!==null;){if(Bf(p)){o=p;break}p=p.return}if(o==null)throw Error("Expected to find a host parent. This error is likely caused by a bug in React. Please file an issue.");switch(o.tag){case 27:o=o.stateNode,p=hh(n),ph(n,p,o);break;case 5:p=o.stateNode,o.flags&32&&(Qi(p),o.flags&=-33),o=hh(n),ph(n,o,p);break;case 3:case 4:o=o.stateNode.containerInfo,p=hh(n),fh(n,p,o);break;default:throw Error("Invalid host parent fiber. This error is likely caused by a bug in React. Please file an issue.")}}function mh(n){var o=n.stateNode,p=n.memoizedProps;try{Ye(n,gb,n.type,p,o,n)}catch(b){Sr(n,n.return,b)}}function Ly(n,o){if(n=n.containerInfo,tn=ry,n=hc(n),$a(n)){if("selectionStart"in n)var p={start:n.selectionStart,end:n.selectionEnd};else e:{p=(p=n.ownerDocument)&&p.defaultView||window;var b=p.getSelection&&p.getSelection();if(b&&b.rangeCount!==0){p=b.anchorNode;var O=b.anchorOffset,z=b.focusNode;b=b.focusOffset;try{p.nodeType,z.nodeType}catch{p=null;break e}var W=0,oe=-1,Ce=-1,Be=0,Dt=0,Ft=n,Et=null;t:for(;;){for(var Gt;Ft!==p||O!==0&&Ft.nodeType!==3||(oe=W+O),Ft!==z||b!==0&&Ft.nodeType!==3||(Ce=W+b),Ft.nodeType===3&&(W+=Ft.nodeValue.length),(Gt=Ft.firstChild)!==null;)Et=Ft,Ft=Gt;for(;;){if(Ft===n)break t;if(Et===p&&++Be===O&&(oe=W),Et===z&&++Dt===b&&(Ce=W),(Gt=Ft.nextSibling)!==null)break;Ft=Et,Et=Ft.parentNode}Ft=Gt}p=oe===-1||Ce===-1?null:{start:oe,end:Ce}}else p=null}p=p||{start:0,end:0}}else p=null;for(Ct={focusedElem:n,selectionRange:p},ry=!1,os=o;os!==null;)if(o=os,n=o.child,(o.subtreeFlags&1024)!==0&&n!==null)n.return=o,os=n;else for(;os!==null;){switch(n=o=os,p=n.alternate,O=n.flags,n.tag){case 0:break;case 11:case 15:break;case 1:(O&1024)!==0&&p!==null&&Am(n,p);break;case 3:if((O&1024)!==0){if(n=n.stateNode.containerInfo,p=n.nodeType,p===9)Ra(n);else if(p===1)switch(n.nodeName){case"HEAD":case"HTML":case"BODY":Ra(n);break;default:n.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((O&1024)!==0)throw Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}if(n=o.sibling,n!==null){n.return=o.return,os=n;break}os=o.return}}function Zg(n,o,p){var b=p.flags;switch(p.tag){case 0:case 11:case 15:wc(n,p),b&4&&ru(p,is|tc);break;case 1:if(wc(n,p),b&4)if(n=p.stateNode,o===null)p.type.defaultProps||"ref"in p.memoizedProps||fg||(n.props!==p.memoizedProps&&console.error("Expected %s props to match memoized props before componentDidMount. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",Ut(p)||"instance"),n.state!==p.memoizedState&&console.error("Expected %s state to match memoized state before componentDidMount. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",Ut(p)||"instance")),Ea(p)?(Ja(),Ye(p,ux,p,n),ca()):Ye(p,ux,p,n);else{var O=Ta(p.type,o.memoizedProps);o=o.memoizedState,p.type.defaultProps||"ref"in p.memoizedProps||fg||(n.props!==p.memoizedProps&&console.error("Expected %s props to match memoized props before componentDidUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",Ut(p)||"instance"),n.state!==p.memoizedState&&console.error("Expected %s state to match memoized state before componentDidUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",Ut(p)||"instance")),Ea(p)?(Ja(),Ye(p,b1,p,n,O,o,n.__reactInternalSnapshotBeforeUpdate),ca()):Ye(p,b1,p,n,O,o,n.__reactInternalSnapshotBeforeUpdate)}b&64&&Em(p),b&512&&ou(p,p.return);break;case 3:if(o=Rl(),wc(n,p),b&64&&(b=p.updateQueue,b!==null)){if(O=null,p.child!==null)switch(p.child.tag){case 27:case 5:O=p.child.stateNode;break;case 1:O=p.child.stateNode}try{Ye(p,qu,b,O)}catch(W){Sr(p,p.return,W)}}n.effectDuration+=Fu(o);break;case 27:o===null&&b&4&&mh(p);case 26:case 5:wc(n,p),o===null&&b&4&&uh(p),b&512&&ou(p,p.return);break;case 12:if(b&4){b=Rl(),wc(n,p),n=p.stateNode,n.effectDuration+=yf(b);try{Ye(p,Cm,p,o,I_,n.effectDuration)}catch(W){Sr(p,p.return,W)}}else wc(n,p);break;case 13:wc(n,p),b&4&&gh(n,p),b&64&&(n=p.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&(p=uu.bind(null,p),Oa(n,p))));break;case 22:if(b=p.memoizedState!==null||Rd,!b){o=o!==null&&o.memoizedState!==null||Co,O=Rd;var z=Co;Rd=b,(Co=o)&&!z?Sc(n,p,(p.subtreeFlags&8772)!==0):wc(n,p),Rd=O,Co=z}break;case 30:break;default:wc(n,p)}}function Yg(n){var o=n.alternate;o!==null&&(n.alternate=null,Yg(o)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(o=n.stateNode,o!==null&&ks(o)),n.stateNode=null,n._debugOwner=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function Ll(n,o,p){for(p=p.child;p!==null;)Wg(n,o,p),p=p.sibling}function Wg(n,o,p){if(Gs&&typeof Gs.onCommitFiberUnmount=="function")try{Gs.onCommitFiberUnmount(Kf,p)}catch(z){Cc||(Cc=!0,console.error("React instrumentation encountered an error: %s",z))}switch(p.tag){case 26:Co||Ca(p,o),Ll(n,o,p),p.memoizedState?p.memoizedState.count--:p.stateNode&&(p=p.stateNode,p.parentNode.removeChild(p));break;case 27:Co||Ca(p,o);var b=Bo,O=Ui;Fi(p.type)&&(Bo=p.stateNode,Ui=!1),Ll(n,o,p),Ye(p,r_,p.stateNode),Bo=b,Ui=O;break;case 5:Co||Ca(p,o);case 6:if(b=Bo,O=Ui,Bo=null,Ll(n,o,p),Bo=b,Ui=O,Bo!==null)if(Ui)try{Ye(p,ui,Bo,p.stateNode)}catch(z){Sr(p,o,z)}else try{Ye(p,fr,Bo,p.stateNode)}catch(z){Sr(p,o,z)}break;case 18:Bo!==null&&(Ui?(n=Bo,xr(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,p.stateNode),qm(n)):xr(Bo,p.stateNode));break;case 4:b=Bo,O=Ui,Bo=p.stateNode.containerInfo,Ui=!0,Ll(n,o,p),Bo=b,Ui=O;break;case 0:case 11:case 14:case 15:Co||iu(ya,p,o),Co||zf(p,o,is),Ll(n,o,p);break;case 1:Co||(Ca(p,o),b=p.stateNode,typeof b.componentWillUnmount=="function"&&Lf(p,o,b)),Ll(n,o,p);break;case 21:Ll(n,o,p);break;case 22:Co=(b=Co)||p.memoizedState!==null,Ll(n,o,p),Co=b;break;default:Ll(n,o,p)}}function gh(n,o){if(o.memoizedState===null&&(n=o.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null))))try{Ye(o,Pm,n)}catch(p){Sr(o,o.return,p)}}function Ff(n){switch(n.tag){case 13:case 19:var o=n.stateNode;return o===null&&(o=n.stateNode=new z1),o;case 22:return n=n.stateNode,o=n._retryCache,o===null&&(o=n._retryCache=new z1),o;default:throw Error("Unexpected Suspense handler tag ("+n.tag+"). This is a bug in React.")}}function Qo(n,o){var p=Ff(n);o.forEach(function(b){var O=r0.bind(null,n,b);if(!p.has(b)){if(p.add(b),Hl)if(mg!==null&&gg!==null)m(gg,mg);else throw Error("Expected finished root and lanes to be set. This is a bug in React.");b.then(O,O)}})}function Ho(n,o){var p=o.deletions;if(p!==null)for(var b=0;b<p.length;b++){var O=n,z=o,W=p[b],oe=z;e:for(;oe!==null;){switch(oe.tag){case 27:if(Fi(oe.type)){Bo=oe.stateNode,Ui=!1;break e}break;case 5:Bo=oe.stateNode,Ui=!1;break e;case 3:case 4:Bo=oe.stateNode.containerInfo,Ui=!0;break e}oe=oe.return}if(Bo===null)throw Error("Expected to find a host parent. This error is likely caused by a bug in React. Please file an issue.");Wg(O,z,W),Bo=null,Ui=!1,O=W,z=O.alternate,z!==null&&(z.return=null),O.return=null}if(o.subtreeFlags&13878)for(o=o.child;o!==null;)Xg(o,n),o=o.sibling}function Xg(n,o){var p=n.alternate,b=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:Ho(o,n),Us(n),b&4&&(iu(ya|tc,n,n.return),Aa(ya|tc,n),zf(n,n.return,is|tc));break;case 1:Ho(o,n),Us(n),b&512&&(Co||p===null||Ca(p,p.return)),b&64&&Rd&&(n=n.updateQueue,n!==null&&(b=n.callbacks,b!==null&&(p=n.shared.hiddenCallbacks,n.shared.hiddenCallbacks=p===null?b:p.concat(b))));break;case 26:var O=va;if(Ho(o,n),Us(n),b&512&&(Co||p===null||Ca(p,p.return)),b&4)if(o=p!==null?p.memoizedState:null,b=n.memoizedState,p===null)if(b===null)if(n.stateNode===null){e:{b=n.type,p=n.memoizedProps,o=O.ownerDocument||O;t:switch(b){case"title":O=o.getElementsByTagName("title")[0],(!O||O[$m]||O[Po]||O.namespaceURI===Wm||O.hasAttribute("itemprop"))&&(O=o.createElement(b),o.head.insertBefore(O,o.querySelector("head > title"))),kt(O,b,p),O[Po]=n,it(O),b=O;break e;case"link":var z=yb("link","href",o).get(b+(p.href||""));if(z){for(var W=0;W<z.length;W++)if(O=z[W],O.getAttribute("href")===(p.href==null||p.href===""?null:p.href)&&O.getAttribute("rel")===(p.rel==null?null:p.rel)&&O.getAttribute("title")===(p.title==null?null:p.title)&&O.getAttribute("crossorigin")===(p.crossOrigin==null?null:p.crossOrigin)){z.splice(W,1);break t}}O=o.createElement(b),kt(O,b,p),o.head.appendChild(O);break;case"meta":if(z=yb("meta","content",o).get(b+(p.content||""))){for(W=0;W<z.length;W++)if(O=z[W],pn(p.content,"content"),O.getAttribute("content")===(p.content==null?null:""+p.content)&&O.getAttribute("name")===(p.name==null?null:p.name)&&O.getAttribute("property")===(p.property==null?null:p.property)&&O.getAttribute("http-equiv")===(p.httpEquiv==null?null:p.httpEquiv)&&O.getAttribute("charset")===(p.charSet==null?null:p.charSet)){z.splice(W,1);break t}}O=o.createElement(b),kt(O,b,p),o.head.appendChild(O);break;default:throw Error('getNodesForType encountered a type it did not expect: "'+b+'". This is a bug in React.')}O[Po]=n,it(O),b=O}n.stateNode=b}else vb(O,n.type,n.stateNode);else n.stateNode=So(O,b,n.memoizedProps);else o!==b?(o===null?p.stateNode!==null&&(p=p.stateNode,p.parentNode.removeChild(p)):o.count--,b===null?vb(O,n.type,n.stateNode):So(O,b,n.memoizedProps)):b===null&&n.stateNode!==null&&dh(n,n.memoizedProps,p.memoizedProps);break;case 27:Ho(o,n),Us(n),b&512&&(Co||p===null||Ca(p,p.return)),p!==null&&b&4&&dh(n,n.memoizedProps,p.memoizedProps);break;case 5:if(Ho(o,n),Us(n),b&512&&(Co||p===null||Ca(p,p.return)),n.flags&32){o=n.stateNode;try{Ye(n,Qi,o)}catch(Dt){Sr(n,n.return,Dt)}}b&4&&n.stateNode!=null&&(o=n.memoizedProps,dh(n,o,p!==null?p.memoizedProps:o)),b&1024&&(Cx=!0,n.type!=="form"&&console.error("Unexpected host component type. Expected a form. This is a bug in React."));break;case 6:if(Ho(o,n),Us(n),b&4){if(n.stateNode===null)throw Error("This should have a text node initialized. This error is likely caused by a bug in React. Please file an issue.");b=n.memoizedProps,p=p!==null?p.memoizedProps:b,o=n.stateNode;try{Ye(n,ma,o,p,b)}catch(Dt){Sr(n,n.return,Dt)}}break;case 3:if(O=Rl(),di=null,z=va,va=Vy(o.containerInfo),Ho(o,n),va=z,Us(n),b&4&&p!==null&&p.memoizedState.isDehydrated)try{Ye(n,Th,o.containerInfo)}catch(Dt){Sr(n,n.return,Dt)}Cx&&(Cx=!1,By(n)),o.effectDuration+=Fu(O);break;case 4:b=va,va=Vy(n.stateNode.containerInfo),Ho(o,n),Us(n),va=b;break;case 12:b=Rl(),Ho(o,n),Us(n),n.stateNode.effectDuration+=yf(b);break;case 13:Ho(o,n),Us(n),n.child.flags&8192&&n.memoizedState!==null!=(p!==null&&p.memoizedState!==null)&&(Lv=hl()),b&4&&(b=n.updateQueue,b!==null&&(n.updateQueue=null,Qo(n,b)));break;case 22:O=n.memoizedState!==null;var oe=p!==null&&p.memoizedState!==null,Ce=Rd,Be=Co;if(Rd=Ce||O,Co=Be||oe,Ho(o,n),Co=Be,Rd=Ce,Us(n),b&8192)e:for(o=n.stateNode,o._visibility=O?o._visibility&-2:o._visibility|up,O&&(p===null||oe||Rd||Co||su(n)),p=null,o=n;;){if(o.tag===5||o.tag===26){if(p===null){oe=p=o;try{z=oe.stateNode,O?Ye(oe,$r,z):Ye(oe,ii,oe.stateNode,oe.memoizedProps)}catch(Dt){Sr(oe,oe.return,Dt)}}}else if(o.tag===6){if(p===null){oe=o;try{W=oe.stateNode,O?Ye(oe,wo,W):Ye(oe,eo,W,oe.memoizedProps)}catch(Dt){Sr(oe,oe.return,Dt)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===n)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===n)break e;for(;o.sibling===null;){if(o.return===null||o.return===n)break e;p===o&&(p=null),o=o.return}p===o&&(p=null),o.sibling.return=o.return,o=o.sibling}b&4&&(b=n.updateQueue,b!==null&&(p=b.retryQueue,p!==null&&(b.retryQueue=null,Qo(n,p))));break;case 19:Ho(o,n),Us(n),b&4&&(b=n.updateQueue,b!==null&&(n.updateQueue=null,Qo(n,b)));break;case 30:break;case 21:break;default:Ho(o,n),Us(n)}}function Us(n){var o=n.flags;if(o&2){try{Ye(n,$g,n)}catch(p){Sr(n,n.return,p)}n.flags&=-3}o&4096&&(n.flags&=-4097)}function By(n){if(n.subtreeFlags&1024)for(n=n.child;n!==null;){var o=n;By(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),n=n.sibling}}function wc(n,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)Zg(n,o.alternate,o),o=o.sibling}function ri(n){switch(n.tag){case 0:case 11:case 14:case 15:zf(n,n.return,is),su(n);break;case 1:Ca(n,n.return);var o=n.stateNode;typeof o.componentWillUnmount=="function"&&Lf(n,n.return,o),su(n);break;case 27:Ye(n,r_,n.stateNode);case 26:case 5:Ca(n,n.return),su(n);break;case 22:n.memoizedState===null&&su(n);break;case 30:su(n);break;default:su(n)}}function su(n){for(n=n.child;n!==null;)ri(n),n=n.sibling}function Dm(n,o,p,b){var O=p.flags;switch(p.tag){case 0:case 11:case 15:Sc(n,p,b),ru(p,is);break;case 1:if(Sc(n,p,b),o=p.stateNode,typeof o.componentDidMount=="function"&&Ye(p,ux,p,o),o=p.updateQueue,o!==null){n=p.stateNode;try{Ye(p,Cy,o,n)}catch(z){Sr(p,p.return,z)}}b&&O&64&&Em(p),ou(p,p.return);break;case 27:mh(p);case 26:case 5:Sc(n,p,b),b&&o===null&&O&4&&uh(p),ou(p,p.return);break;case 12:if(b&&O&4){O=Rl(),Sc(n,p,b),b=p.stateNode,b.effectDuration+=yf(O);try{Ye(p,Cm,p,o,I_,b.effectDuration)}catch(z){Sr(p,p.return,z)}}else Sc(n,p,b);break;case 13:Sc(n,p,b),b&&O&4&&gh(n,p);break;case 22:p.memoizedState===null&&Sc(n,p,b),ou(p,p.return);break;case 30:break;default:Sc(n,p,b)}}function Sc(n,o,p){for(p=p&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;)Dm(n,o.alternate,o,p),o=o.sibling}function hd(n,o){var p=null;n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(p=n.memoizedState.cachePool.pool),n=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(n=o.memoizedState.cachePool.pool),n!==p&&(n!=null&&Hc(n),p!=null&&Zd(p))}function Uf(n,o){n=null,o.alternate!==null&&(n=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==n&&(Hc(o),n!=null&&Zd(n))}function js(n,o,p,b){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)jf(n,o,p,b),o=o.sibling}function jf(n,o,p,b){var O=o.flags;switch(o.tag){case 0:case 11:case 15:js(n,o,p,b),O&2048&&lh(o,uo|tc);break;case 1:js(n,o,p,b);break;case 3:var z=Rl();js(n,o,p,b),O&2048&&(p=null,o.alternate!==null&&(p=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==p&&(Hc(o),p!=null&&Zd(p))),n.passiveEffectDuration+=Fu(z);break;case 12:if(O&2048){O=Rl(),js(n,o,p,b),n=o.stateNode,n.passiveEffectDuration+=yf(O);try{Ye(o,ch,o,o.alternate,I_,n.passiveEffectDuration)}catch(oe){Sr(o,o.return,oe)}}else js(n,o,p,b);break;case 13:js(n,o,p,b);break;case 23:break;case 22:z=o.stateNode;var W=o.alternate;o.memoizedState!==null?z._visibility&Oh?js(n,o,p,b):Ti(n,o):z._visibility&Oh?js(n,o,p,b):(z._visibility|=Oh,_s(n,o,p,b,(o.subtreeFlags&10256)!==0)),O&2048&&hd(W,o);break;case 24:js(n,o,p,b),O&2048&&Uf(o.alternate,o);break;default:js(n,o,p,b)}}function _s(n,o,p,b,O){for(O=O&&(o.subtreeFlags&10256)!==0,o=o.child;o!==null;)_h(n,o,p,b,O),o=o.sibling}function _h(n,o,p,b,O){var z=o.flags;switch(o.tag){case 0:case 11:case 15:_s(n,o,p,b,O),lh(o,uo);break;case 23:break;case 22:var W=o.stateNode;o.memoizedState!==null?W._visibility&Oh?_s(n,o,p,b,O):Ti(n,o):(W._visibility|=Oh,_s(n,o,p,b,O)),O&&z&2048&&hd(o.alternate,o);break;case 24:_s(n,o,p,b,O),O&&z&2048&&Uf(o.alternate,o);break;default:_s(n,o,p,b,O)}}function Ti(n,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var p=n,b=o,O=b.flags;switch(b.tag){case 22:Ti(p,b),O&2048&&hd(b.alternate,b);break;case 24:Ti(p,b),O&2048&&Uf(b.alternate,b);break;default:Ti(p,b)}o=o.sibling}}function Go(n){if(n.subtreeFlags&Y_)for(n=n.child;n!==null;)fd(n),n=n.sibling}function fd(n){switch(n.tag){case 26:Go(n),n.flags&Y_&&n.memoizedState!==null&&$f(va,n.memoizedState,n.memoizedProps);break;case 5:Go(n);break;case 3:case 4:var o=va;va=Vy(n.stateNode.containerInfo),Go(n),va=o;break;case 22:n.memoizedState===null&&(o=n.alternate,o!==null&&o.memoizedState!==null?(o=Y_,Y_=16777216,Go(n),Y_=o):Go(n));break;default:Go(n)}}function yh(n){var o=n.alternate;if(o!==null&&(n=o.child,n!==null)){o.child=null;do o=n.sibling,n.sibling=null,n=o;while(n!==null)}}function vh(n){var o=n.deletions;if((n.flags&16)!==0){if(o!==null)for(var p=0;p<o.length;p++){var b=o[p];os=b,Fy(b,n)}yh(n)}if(n.subtreeFlags&10256)for(n=n.child;n!==null;)Kg(n),n=n.sibling}function Kg(n){switch(n.tag){case 0:case 11:case 15:vh(n),n.flags&2048&&Pf(n,n.return,uo|tc);break;case 3:var o=Rl();vh(n),n.stateNode.passiveEffectDuration+=Fu(o);break;case 12:o=Rl(),vh(n),n.stateNode.passiveEffectDuration+=yf(o);break;case 22:o=n.stateNode,n.memoizedState!==null&&o._visibility&Oh&&(n.return===null||n.return.tag!==13)?(o._visibility&=-3,au(n)):vh(n);break;default:vh(n)}}function au(n){var o=n.deletions;if((n.flags&16)!==0){if(o!==null)for(var p=0;p<o.length;p++){var b=o[p];os=b,Fy(b,n)}yh(n)}for(n=n.child;n!==null;)Mm(n),n=n.sibling}function Mm(n){switch(n.tag){case 0:case 11:case 15:Pf(n,n.return,uo),au(n);break;case 22:var o=n.stateNode;o._visibility&Oh&&(o._visibility&=-3,au(n));break;default:au(n)}}function Fy(n,o){for(;os!==null;){var p=os,b=p;switch(b.tag){case 0:case 11:case 15:Pf(b,o,uo);break;case 23:case 22:b.memoizedState!==null&&b.memoizedState.cachePool!==null&&(b=b.memoizedState.cachePool.pool,b!=null&&Hc(b));break;case 24:Zd(b.memoizedState.cache)}if(b=p.child,b!==null)b.return=p,os=b;else e:for(p=n;os!==null;){b=os;var O=b.sibling,z=b.return;if(Yg(b),b===p){os=null;break e}if(O!==null){O.return=z,os=O;break e}os=z}}}function Jg(){yS.forEach(function(n){return n()})}function Rm(){var n=typeof IS_REACT_ACT_ENVIRONMENT<"u"?IS_REACT_ACT_ENVIRONMENT:void 0;return n||Pt.actQueue===null||console.error("The current testing environment is not configured to support act(...)"),n}function $o(n){if((Ai&Xs)!==Na&&Tr!==0)return Tr&-Tr;var o=Pt.T;return o!==null?(o._updatedFibers||(o._updatedFibers=new Set),o._updatedFibers.add(n),n=zh,n!==0?n:te()):lc()}function lu(){za===0&&(za=(Tr&536870912)===0||Jr?dr():536870912);var n=Ts.current;return n!==null&&(n.flags|=32),za}function Ei(n,o,p){if(nf&&console.error("useInsertionEffect must not schedule updates."),jv&&(ty=!0),(n===Li&&(vi===Es||vi===Cp)||n.cancelPendingCommit!==null)&&(bh(n,0),ys(n,Tr,za,!1)),ta(n,p),(Ai&Xs)!==0&&n===Li){if(pu)switch(o.tag){case 0:case 11:case 15:n=jr&&Ut(jr)||"Unknown",Vv.has(n)||(Vv.add(n),o=Ut(o)||"Unknown",console.error("Cannot update a component (`%s`) while rendering a different component (`%s`). To locate the bad setState() call inside `%s`, follow the stack trace as described in https://react.dev/link/setstate-in-render",o,n,n));break;case 1:xg||(console.error("Cannot update during an existing state transition (such as within `render`). Render methods should be a pure function of props and state."),xg=!0)}}else Hl&&ao(n,o,p),w(o),n===Li&&((Ai&Xs)===Na&&(xu|=p),xi===zc&&ys(n,Tr,za,!1)),R(n)}function Da(n,o,p){if((Ai&(Xs|Nc))!==Na)throw Error("Should not already be working.");var b=!p&&(o&124)===0&&(o&n.expiredLanes)===0||Jn(n,o),O=b?wh(n,o):km(n,o,!0),z=b;do{if(O===kd){Dp&&!b&&ys(n,o,0,!1);break}else{if(p=n.current.alternate,z&&!pd(p)){O=km(n,o,!1),z=!1;continue}if(O===Ri){if(z=o,n.errorRecoveryDisabledLanes&z)var W=0;else W=n.pendingLanes&-536870913,W=W!==0?W:W&536870912?536870912:0;if(W!==0){o=W;e:{O=n;var oe=W;W=Yh;var Ce=O.current.memoizedState.isDehydrated;if(Ce&&(bh(O,oe).flags|=256),oe=km(O,oe,!1),oe!==Ri){if(Mp&&!Ce){O.errorRecoveryDisabledLanes|=z,xu|=z,O=zc;break e}O=xa,xa=W,O!==null&&(xa===null?xa=O:xa.push.apply(xa,O))}O=oe}if(z=!1,O!==Ri)continue}}if(O===yg){bh(n,0),ys(n,o,0,!0);break}e:{switch(b=n,O){case kd:case yg:throw Error("Root did not complete. This is a bug in React.");case zc:if((o&4194048)!==o)break;case Gh:ys(b,o,za,!Od);break e;case Ri:xa=null;break;case Hh:case Dx:break;default:throw Error("Unknown root exit status.")}if(Pt.actQueue!==null)hr(b,p,o,xa,Q_,Wh,za,xu,Zh);else{if((o&62914560)===o&&(z=Lv+Bv-hl(),10<z)){if(ys(b,o,za,!Od),Do(b,0,!0)!==0)break e;b.timeoutHandle=xn(Tc.bind(null,b,p,xa,Q_,Wh,o,za,xu,Zh,Od,O,vS,O_,0),z);break e}Tc(b,p,xa,Q_,Wh,o,za,xu,Zh,Od,O,F1,O_,0)}}}break}while(!0);R(n)}function Tc(n,o,p,b,O,z,W,oe,Ce,Be,Dt,Ft,Et,Gt){if(n.timeoutHandle=an,Ft=o.subtreeFlags,(Ft&8192||(Ft&16785408)===16785408)&&(hi={stylesheets:null,count:0,unsuspend:xb},fd(o),Ft=s_(),Ft!==null)){n.cancelPendingCommit=Ft(hr.bind(null,n,o,z,p,b,O,W,oe,Ce,Dt,U1,Et,Gt)),ys(n,z,W,!Be);return}hr(n,o,z,p,b,O,W,oe,Ce)}function pd(n){for(var o=n;;){var p=o.tag;if((p===0||p===11||p===15)&&o.flags&16384&&(p=o.updateQueue,p!==null&&(p=p.stores,p!==null)))for(var b=0;b<p.length;b++){var O=p[b],z=O.getSnapshot;O=O.value;try{if(!bs(z(),O))return!1}catch{return!1}}if(p=o.child,o.subtreeFlags&16384&&p!==null)p.return=o,o=p;else{if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function ys(n,o,p,b){o&=~$h,o&=~xu,n.suspendedLanes|=o,n.pingedLanes&=~o,b&&(n.warmLanes|=o),b=n.expirationTimes;for(var O=o;0<O;){var z=31-$s(O),W=1<<z;b[z]=-1,O&=~W}p!==0&&mo(n,p,o)}function xh(){return(Ai&(Xs|Nc))===Na?(N(0),!1):!0}function Qg(){if(jr!==null){if(vi===Ks)var n=jr.return;else n=jr,wa(),bf(n),ug=null,qh=0,n=jr;for(;n!==null;)Tm(n.alternate,n),n=n.return;jr=null}}function bh(n,o){var p=n.timeoutHandle;p!==an&&(n.timeoutHandle=an,Jt(p)),p=n.cancelPendingCommit,p!==null&&(n.cancelPendingCommit=null,p()),Qg(),Li=n,jr=p=Ya(n.current,null),Tr=o,vi=Ks,Js=null,Od=!1,Dp=Jn(n,o),Mp=!1,xi=kd,Zh=za=$h=xu=yl=0,xa=Yh=null,Wh=!1,(o&8)!==0&&(o|=o&32);var b=n.entangledLanes;if(b!==0)for(n=n.entanglements,b&=o;0<b;){var O=31-$s(b),z=1<<O;o|=n[O],b&=~z}return rc=o,Zp(),o=Av(),1e3<o-X0&&(Pt.recentlyCreatedOwnerStacks=0,X0=o),Ic.discardPendingWarnings(),p}function Vf(n,o){ur=null,Pt.H=lg,Pt.getCurrentStack=null,pu=!1,fl=null,o===_p||o===Mv?(o=Yd(),vi=X_):o===nx?(o=Yd(),vi=B1):vi=o===Sx?Pv:o!==null&&typeof o=="object"&&typeof o.then=="function"?As:W_,Js=o;var p=jr;if(p===null)xi=yg,li(n,Ci(o,n.current));else switch(p.mode&ws&&kg(p),de(),vi){case W_:Ln!==null&&typeof Ln.markComponentErrored=="function"&&Ln.markComponentErrored(p,o,Tr);break;case Es:case Cp:case X_:case As:case K_:Ln!==null&&typeof Ln.markComponentSuspended=="function"&&Ln.markComponentSuspended(p,o,Tr)}}function e_(){var n=Pt.H;return Pt.H=lg,n===null?lg:n}function Zo(){var n=Pt.A;return Pt.A=P1,n}function cu(){xi=zc,Od||(Tr&4194048)!==Tr&&Ts.current!==null||(Dp=!0),(yl&134217727)===0&&(xu&134217727)===0||Li===null||ys(Li,Tr,za,!1)}function km(n,o,p){var b=Ai;Ai|=Xs;var O=e_(),z=Zo();if(Li!==n||Tr!==o){if(Hl){var W=n.memoizedUpdaters;0<W.size&&(m(n,Tr),W.clear()),na(n,o)}Q_=null,bh(n,o)}po(o),o=!1,W=xi;e:do try{if(vi!==Ks&&jr!==null){var oe=jr,Ce=Js;switch(vi){case Pv:Qg(),W=Gh;break e;case X_:case Es:case Cp:case As:Ts.current===null&&(o=!0);var Be=vi;if(vi=Ks,Js=null,Ma(n,oe,Ce,Be),p&&Dp){W=kd;break e}break;default:Be=vi,vi=Ks,Js=null,Ma(n,oe,Ce,Be)}}t_(),W=xi;break}catch(Dt){Vf(n,Dt)}while(!0);return o&&n.shellSuspendCounter++,wa(),Ai=b,Pt.H=O,Pt.A=z,Uo(),jr===null&&(Li=null,Tr=0,Zp()),W}function t_(){for(;jr!==null;)Vs(jr)}function wh(n,o){var p=Ai;Ai|=Xs;var b=e_(),O=Zo();if(Li!==n||Tr!==o){if(Hl){var z=n.memoizedUpdaters;0<z.size&&(m(n,Tr),z.clear()),na(n,o)}Q_=null,Fv=hl()+J_,bh(n,o)}else Dp=Jn(n,o);po(o);e:do try{if(vi!==Ks&&jr!==null)t:switch(o=jr,z=Js,vi){case W_:vi=Ks,Js=null,Ma(n,o,z,W_);break;case Es:case Cp:if(tm(z)){vi=Ks,Js=null,qs(o);break}o=function(){vi!==Es&&vi!==Cp||Li!==n||(vi=K_),R(n)},z.then(o,o);break e;case X_:vi=K_;break e;case B1:vi=Mx;break e;case K_:tm(z)?(vi=Ks,Js=null,qs(o)):(vi=Ks,Js=null,Ma(n,o,z,K_));break;case Mx:var W=null;switch(jr.tag){case 26:W=jr.memoizedState;case 5:case 27:var oe=jr;if(!W||Fm(W)){vi=Ks,Js=null;var Ce=oe.sibling;if(Ce!==null)jr=Ce;else{var Be=oe.return;Be!==null?(jr=Be,Bl(Be)):jr=null}break t}break;default:console.error("Unexpected type of fiber triggered a suspensey commit. This is a bug in React.")}vi=Ks,Js=null,Ma(n,o,z,Mx);break;case As:vi=Ks,Js=null,Ma(n,o,z,As);break;case Pv:Qg(),xi=Gh;break e;default:throw Error("Unexpected SuspendedReason. This is a bug in React.")}Pt.actQueue!==null?t_():Om();break}catch(Dt){Vf(n,Dt)}while(!0);return wa(),Pt.H=b,Pt.A=O,Ai=p,jr!==null?(Ln!==null&&typeof Ln.markRenderYielded=="function"&&Ln.markRenderYielded(),kd):(Uo(),Li=null,Tr=0,Zp(),xi)}function Om(){for(;jr!==null&&!Wf();)Vs(jr)}function Vs(n){var o=n.alternate;(n.mode&ws)!==Mi?(pc(n),o=Ye(n,dd,o,n,rc),kg(n)):o=Ye(n,dd,o,n,rc),n.memoizedProps=n.pendingProps,o===null?Bl(n):jr=o}function qs(n){var o=Ye(n,Sh,n);n.memoizedProps=n.pendingProps,o===null?Bl(n):jr=o}function Sh(n){var o=n.alternate,p=(n.mode&ws)!==Mi;switch(p&&pc(n),n.tag){case 15:case 0:o=ym(o,n,n.pendingProps,n.type,void 0,Tr);break;case 11:o=ym(o,n,n.pendingProps,n.type.render,n.ref,Tr);break;case 5:bf(n);default:Tm(o,n),n=jr=Ty(n,rc),o=dd(o,n,rc)}return p&&kg(n),o}function Ma(n,o,p,b){wa(),bf(o),ug=null,qh=0;var O=o.return;try{if(Vg(n,O,o,p,Tr)){xi=yg,li(n,Ci(p,n.current)),jr=null;return}}catch(z){if(O!==null)throw jr=O,z;xi=yg,li(n,Ci(p,n.current)),jr=null;return}o.flags&32768?(Jr||b===W_?n=!0:Dp||(Tr&536870912)!==0?n=!1:(Od=n=!0,(b===Es||b===Cp||b===X_||b===As)&&(b=Ts.current,b!==null&&b.tag===13&&(b.flags|=16384))),Im(o,n)):Bl(o)}function Bl(n){var o=n;do{if((o.flags&32768)!==0){Im(o,Od);return}var p=o.alternate;if(n=o.return,pc(o),p=Ye(o,wm,p,o,rc),(o.mode&ws)!==Mi&&Ay(o),p!==null){jr=p;return}if(o=o.sibling,o!==null){jr=o;return}jr=o=n}while(o!==null);xi===kd&&(xi=Dx)}function Im(n,o){do{var p=Sm(n.alternate,n);if(p!==null){p.flags&=32767,jr=p;return}if((n.mode&ws)!==Mi){Ay(n),p=n.actualDuration;for(var b=n.child;b!==null;)p+=b.actualDuration,b=b.sibling;n.actualDuration=p}if(p=n.return,p!==null&&(p.flags|=32768,p.subtreeFlags=0,p.deletions=null),!o&&(n=n.sibling,n!==null)){jr=n;return}jr=n=p}while(n!==null);xi=Gh,jr=null}function hr(n,o,p,b,O,z,W,oe,Ce){n.cancelPendingCommit=null;do Ki();while(ss!==Xh);if(Ic.flushLegacyContextWarning(),Ic.flushPendingUnsafeLifecycleWarnings(),(Ai&(Xs|Nc))!==Na)throw Error("Should not already be working.");if(Ln!==null&&typeof Ln.markCommitStarted=="function"&&Ln.markCommitStarted(p),o===null)sr();else{if(p===0&&console.error("finishedLanes should not be empty during a commit. This is a bug in React."),o===n.current)throw Error("Cannot commit the same tree as before. This error is likely caused by a bug in React. Please file an issue.");if(z=o.lanes|o.childLanes,z|=Y0,$n(n,p,z,W,oe,Ce),n===Li&&(jr=Li=null,Tr=0),vg=o,Jh=n,Qh=p,Uv=z,Ix=O,V1=b,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(n.callbackNode=null,n.callbackPriority=0,v(Xf,function(){return bo(),null})):(n.callbackNode=null,n.callbackPriority=0),I_=Sd(),b=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||b){b=Pt.T,Pt.T=null,O=yi.p,yi.p=Gl,W=Ai,Ai|=Nc;try{Ly(n,o,p)}finally{Ai=W,yi.p=O,Pt.T=b}}ss=j1,Ec(),Uy(),jy()}}function Ec(){if(ss===j1){ss=Xh;var n=Jh,o=vg,p=Qh,b=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||b){b=Pt.T,Pt.T=null;var O=yi.p;yi.p=Gl;var z=Ai;Ai|=Nc;try{mg=p,gg=n,Xg(o,n),gg=mg=null,p=Ct;var W=hc(n.containerInfo),oe=p.focusedElem,Ce=p.selectionRange;if(W!==oe&&oe&&oe.ownerDocument&&Nu(oe.ownerDocument.documentElement,oe)){if(Ce!==null&&$a(oe)){var Be=Ce.start,Dt=Ce.end;if(Dt===void 0&&(Dt=Be),"selectionStart"in oe)oe.selectionStart=Be,oe.selectionEnd=Math.min(Dt,oe.value.length);else{var Ft=oe.ownerDocument||document,Et=Ft&&Ft.defaultView||window;if(Et.getSelection){var Gt=Et.getSelection(),Hn=oe.textContent.length,Mr=Math.min(Ce.start,Hn),Yi=Ce.end===void 0?Mr:Math.min(Ce.end,Hn);!Gt.extend&&Mr>Yi&&(W=Yi,Yi=Mr,Mr=W);var oi=zs(oe,Mr),et=zs(oe,Yi);if(oi&&et&&(Gt.rangeCount!==1||Gt.anchorNode!==oi.node||Gt.anchorOffset!==oi.offset||Gt.focusNode!==et.node||Gt.focusOffset!==et.offset)){var nt=Ft.createRange();nt.setStart(oi.node,oi.offset),Gt.removeAllRanges(),Mr>Yi?(Gt.addRange(nt),Gt.extend(et.node,et.offset)):(nt.setEnd(et.node,et.offset),Gt.addRange(nt))}}}}for(Ft=[],Gt=oe;Gt=Gt.parentNode;)Gt.nodeType===1&&Ft.push({element:Gt,left:Gt.scrollLeft,top:Gt.scrollTop});for(typeof oe.focus=="function"&&oe.focus(),oe=0;oe<Ft.length;oe++){var ht=Ft[oe];ht.element.scrollLeft=ht.left,ht.element.scrollTop=ht.top}}ry=!!tn,Ct=tn=null}finally{Ai=z,yi.p=O,Pt.T=b}}n.current=o,ss=Rx}}function Uy(){if(ss===Rx){ss=Xh;var n=Jh,o=vg,p=Qh,b=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||b){b=Pt.T,Pt.T=null;var O=yi.p;yi.p=Gl;var z=Ai;Ai|=Nc;try{Ln!==null&&typeof Ln.markLayoutEffectsStarted=="function"&&Ln.markLayoutEffectsStarted(p),mg=p,gg=n,Zg(n,o.alternate,o),gg=mg=null,Ln!==null&&typeof Ln.markLayoutEffectsStopped=="function"&&Ln.markLayoutEffectsStopped()}finally{Ai=z,yi.p=O,Pt.T=b}}ss=Kh}}function jy(){if(ss===kx||ss===Kh){ss=Xh,Cb();var n=Jh,o=vg,p=Qh,b=V1,O=(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0;O?ss=Ox:(ss=Xh,vg=Jh=null,ll(n,n.pendingLanes),tf=0,Rp=null);var z=n.pendingLanes;if(z===0&&(Id=null),O||i(n),O=us(p),o=o.stateNode,Gs&&typeof Gs.onCommitFiberRoot=="function")try{var W=(o.current.flags&128)===128;switch(O){case Gl:var oe=Qy;break;case fu:oe=Hm;break;case yd:oe=Xf;break;case m_:oe=tv;break;default:oe=Xf}Gs.onCommitFiberRoot(Kf,o,oe,W)}catch(Ft){Cc||(Cc=!0,console.error("React instrumentation encountered an error: %s",Ft))}if(Hl&&n.memoizedUpdaters.clear(),Jg(),b!==null){W=Pt.T,oe=yi.p,yi.p=Gl,Pt.T=null;try{var Ce=n.onRecoverableError;for(o=0;o<b.length;o++){var Be=b[o],Dt=Nm(Be.stack);Ye(Be.source,Ce,Be.value,Dt)}}finally{Pt.T=W,yi.p=oe}}(Qh&3)!==0&&Ki(),R(n),z=n.pendingLanes,(p&4194090)!==0&&(z&42)!==0?(N_=!0,n===ef?ey++:(ey=0,ef=n)):ey=0,N(0),sr()}}function Nm(n){return n={componentStack:n},Object.defineProperty(n,"digest",{get:function(){console.error('You are accessing "digest" from the errorInfo object passed to onRecoverableError. This property is no longer provided as part of errorInfo but can be accessed as a property of the Error instance itself.')}}),n}function ll(n,o){(n.pooledCacheLanes&=o)===0&&(o=n.pooledCache,o!=null&&(n.pooledCache=null,Zd(o)))}function Ki(n){return Ec(),Uy(),jy(),bo()}function bo(){if(ss!==Ox)return!1;var n=Jh,o=Uv;Uv=0;var p=us(Qh),b=yd>p?yd:p;p=Pt.T;var O=yi.p;try{yi.p=b,Pt.T=null,b=Ix,Ix=null;var z=Jh,W=Qh;if(ss=Xh,vg=Jh=null,Qh=0,(Ai&(Xs|Nc))!==Na)throw Error("Cannot flush passive effects while already rendering.");jv=!0,ty=!1,Ln!==null&&typeof Ln.markPassiveEffectsStarted=="function"&&Ln.markPassiveEffectsStarted(W);var oe=Ai;if(Ai|=Nc,Kg(z.current),jf(z,z.current,W,b),Ln!==null&&typeof Ln.markPassiveEffectsStopped=="function"&&Ln.markPassiveEffectsStopped(),i(z),Ai=oe,N(0,!1),ty?z===Rp?tf++:(tf=0,Rp=z):tf=0,ty=jv=!1,Gs&&typeof Gs.onPostCommitFiberRoot=="function")try{Gs.onPostCommitFiberRoot(Kf,z)}catch(Be){Cc||(Cc=!0,console.error("React instrumentation encountered an error: %s",Be))}var Ce=z.current.stateNode;return Ce.effectDuration=0,Ce.passiveEffectDuration=0,!0}finally{yi.p=O,Pt.T=p,ll(n,o)}}function vs(n,o,p){o=Ci(p,o),o=_m(n.stateNode,o,2),n=Ol(n,o,2),n!==null&&(ta(n,2),R(n))}function Sr(n,o,p){if(nf=!1,n.tag===3)vs(n,n,p);else{for(;o!==null;){if(o.tag===3){vs(o,n,p);return}if(o.tag===1){var b=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof b.componentDidCatch=="function"&&(Id===null||!Id.has(b))){n=Ci(p,n),p=oh(2),b=Ol(o,p,2),b!==null&&(Nf(p,b,o,n),ta(b,2),R(b));return}}o=o.return}console.error(`Internal React error: Attempted to capture a commit phase error inside a detached tree. This indicates a bug in React. Potential causes include deleting the same fiber more than once, committing an already-finished tree, or an inconsistent return pointer.

Error message:

%s`,p)}}function qf(n,o,p){var b=n.pingCache;if(b===null){b=n.pingCache=new L1;var O=new Set;b.set(o,O)}else O=b.get(o),O===void 0&&(O=new Set,b.set(o,O));O.has(p)||(Mp=!0,O.add(p),b=xs.bind(null,n,o,p),Hl&&m(n,p),o.then(b,b))}function xs(n,o,p){var b=n.pingCache;b!==null&&b.delete(o),n.pingedLanes|=n.suspendedLanes&p,n.warmLanes&=~p,Rm()&&Pt.actQueue===null&&console.error(`A suspended resource finished loading inside a test, but the event was not wrapped in act(...).

When testing, code that resolves suspended data should be wrapped into act(...):

act(() => {
  /* finish loading suspended data */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act`),Li===n&&(Tr&p)===p&&(xi===zc||xi===Hh&&(Tr&62914560)===Tr&&hl()-Lv<Bv?(Ai&Xs)===Na&&bh(n,0):$h|=p,Zh===Tr&&(Zh=0)),R(n)}function n_(n,o){o===0&&(o=ea()),n=Io(n,o),n!==null&&(ta(n,o),R(n))}function uu(n){var o=n.memoizedState,p=0;o!==null&&(p=o.retryLane),n_(n,p)}function r0(n,o){var p=0;switch(n.tag){case 13:var b=n.stateNode,O=n.memoizedState;O!==null&&(p=O.retryLane);break;case 19:b=n.stateNode;break;case 22:b=n.stateNode._retryCache;break;default:throw Error("Pinged unknown suspense boundary type. This is probably a bug in React.")}b!==null&&b.delete(o),n_(n,p)}function h(n,o,p){if((o.subtreeFlags&67117056)!==0)for(o=o.child;o!==null;){var b=n,O=o,z=O.type===u_;z=p||z,O.tag!==22?O.flags&67108864?z&&Ye(O,t,b,O,(O.mode&D_)===Mi):h(b,O,z):O.memoizedState===null&&(z&&O.flags&8192?Ye(O,t,b,O):O.subtreeFlags&67108864&&Ye(O,h,b,O,z)),o=o.sibling}}function t(n,o){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:!0;rr(!0);try{ri(o),p&&Mm(o),Dm(n,o.alternate,o,!1),p&&_h(n,o,0,null,!1,0)}finally{rr(!1)}}function i(n){var o=!0;n.current.mode&(Ys|Ws)||(o=!1),h(n,n.current,o)}function d(n){if((Ai&Xs)===Na){var o=n.tag;if(o===3||o===1||o===0||o===11||o===14||o===15){if(o=Ut(n)||"ReactComponent",ny!==null){if(ny.has(o))return;ny.add(o)}else ny=new Set([o]);Ye(n,function(){console.error("Can't perform a React state update on a component that hasn't mounted yet. This indicates that you have a side-effect in your render function that asynchronously later calls tries to update the component. Move this work to useEffect instead.")})}}}function m(n,o){Hl&&n.memoizedUpdaters.forEach(function(p){ao(n,p,o)})}function v(n,o){var p=Pt.actQueue;return p!==null?(p.push(o),H1):b0(n,o)}function w(n){Rm()&&Pt.actQueue===null&&Ye(n,function(){console.error(`An update to %s inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act`,Ut(n))})}function R(n){n!==e&&n.next===null&&(e===null?s=e=n:e=e.next=n),u=!0,Pt.actQueue!==null?l||(l=!0,K()):r||(r=!0,K())}function N(n,o){if(!c&&u){c=!0;do for(var p=!1,b=s;b!==null;){if(n!==0){var O=b.pendingLanes;if(O===0)var z=0;else{var W=b.suspendedLanes,oe=b.pingedLanes;z=(1<<31-$s(42|n)+1)-1,z&=O&~(W&~oe),z=z&201326741?z&201326741|1:z?z|2:0}z!==0&&(p=!0,Z(b,z))}else z=Tr,z=Do(b,b===Li?z:0,b.cancelPendingCommit!==null||b.timeoutHandle!==an),(z&3)===0||Jn(b,z)||(p=!0,Z(b,z));b=b.next}while(p);c=!1}}function P(){F()}function F(){u=l=r=!1;var n=0;f!==0&&(vr()&&(n=f),f=0);for(var o=hl(),p=null,b=s;b!==null;){var O=b.next,z=V(b,o);z===0?(b.next=null,p===null?s=O:p.next=O,O===null&&(e=p)):(p=b,(n!==0||(z&3)!==0)&&(u=!0)),b=O}N(n)}function V(n,o){for(var p=n.suspendedLanes,b=n.pingedLanes,O=n.expirationTimes,z=n.pendingLanes&-62914561;0<z;){var W=31-$s(z),oe=1<<W,Ce=O[W];Ce===-1?((oe&p)===0||(oe&b)!==0)&&(O[W]=Wi(oe,o)):Ce<=o&&(n.expiredLanes|=oe),z&=~oe}if(o=Li,p=Tr,p=Do(n,n===o?p:0,n.cancelPendingCommit!==null||n.timeoutHandle!==an),b=n.callbackNode,p===0||n===o&&(vi===Es||vi===Cp)||n.cancelPendingCommit!==null)return b!==null&&Q(b),n.callbackNode=null,n.callbackPriority=0;if((p&3)===0||Jn(n,p)){if(o=p&-p,o!==n.callbackPriority||Pt.actQueue!==null&&b!==x)Q(b);else return o;switch(us(p)){case Gl:case fu:p=Hm;break;case yd:p=Xf;break;case m_:p=tv;break;default:p=Xf}return b=j.bind(null,n),Pt.actQueue!==null?(Pt.actQueue.push(b),p=x):p=b0(p,b),n.callbackPriority=o,n.callbackNode=p,o}return b!==null&&Q(b),n.callbackPriority=2,n.callbackNode=null,2}function j(n,o){if(N_=Cv=!1,ss!==Xh&&ss!==Ox)return n.callbackNode=null,n.callbackPriority=0,null;var p=n.callbackNode;if(Ki()&&n.callbackNode!==p)return null;var b=Tr;return b=Do(n,n===Li?b:0,n.cancelPendingCommit!==null||n.timeoutHandle!==an),b===0?null:(Da(n,b,o),V(n,hl()),n.callbackNode!=null&&n.callbackNode===p?j.bind(null,n):null)}function Z(n,o){if(Ki())return null;Cv=N_,N_=!1,Da(n,o,!0)}function Q(n){n!==x&&n!==null&&nS(n)}function K(){Pt.actQueue!==null&&Pt.actQueue.push(function(){return F(),null}),qn(function(){(Ai&(Xs|Nc))!==Na?b0(Qy,P):F()})}function te(){return f===0&&(f=dr()),f}function re(n){return n==null||typeof n=="symbol"||typeof n=="boolean"?null:typeof n=="function"?n:(pn(n,"action"),or(""+n))}function pe(n,o){var p=o.ownerDocument.createElement("input");return p.name=o.name,p.value=o.value,n.id&&p.setAttribute("form",n.id),o.parentNode.insertBefore(p,o),n=new FormData(n),p.parentNode.removeChild(p),n}function be(n,o,p,b,O){if(o==="submit"&&p&&p.stateNode===O){var z=re((O[ts]||null).action),W=b.submitter;W&&(o=(o=W[ts]||null)?re(o.formAction):W.getAttribute("formAction"),o!==null&&(z=o,W=null));var oe=new pv("action","action",null,b,O);n.push({event:oe,listeners:[{instance:null,listener:function(){if(b.defaultPrevented){if(f!==0){var Ce=W?pe(O,W):new FormData(O),Be={pending:!0,data:Ce,method:O.method,action:z};Object.freeze(Be),Of(p,Be,null,Ce)}}else typeof z=="function"&&(oe.preventDefault(),Ce=W?pe(O,W):new FormData(O),Be={pending:!0,data:Ce,method:O.method,action:z},Object.freeze(Be),Of(p,Be,z,Ce))},currentTarget:O}]})}}function ye(n,o,p){n.currentTarget=p;try{o(n)}catch(b){Nv(b)}n.currentTarget=null}function Ae(n,o){o=(o&4)!==0;for(var p=0;p<n.length;p++){var b=n[p];e:{var O=void 0,z=b.event;if(b=b.listeners,o)for(var W=b.length-1;0<=W;W--){var oe=b[W],Ce=oe.instance,Be=oe.currentTarget;if(oe=oe.listener,Ce!==O&&z.isPropagationStopped())break e;Ce!==null?Ye(Ce,ye,z,oe,Be):ye(z,oe,Be),O=Ce}else for(W=0;W<b.length;W++){if(oe=b[W],Ce=oe.instance,Be=oe.currentTarget,oe=oe.listener,Ce!==O&&z.isPropagationStopped())break e;Ce!==null?Ye(Ce,ye,z,oe,Be):ye(z,oe,Be),O=Ce}}}}function ve(n,o){C.has(n)||console.error('Did not expect a listenToNonDelegatedEvent() call for "%s". This is a bug in React. Please file an issue.',n);var p=o[Jf];p===void 0&&(p=o[Jf]=new Set);var b=n+"__bubble";p.has(b)||(Me(o,n,2,!1),p.add(b))}function Se(n,o,p){C.has(n)&&!o&&console.error('Did not expect a listenToNativeEvent() call for "%s" in the bubble phase. This is a bug in React. Please file an issue.',n);var b=0;o&&(b|=4),Me(p,n,b,o)}function Te(n){if(!n[_]){n[_]=!0,Ob.forEach(function(p){p!=="selectionchange"&&(C.has(p)||Se(p,!1,n),Se(p,!0,n))});var o=n.nodeType===9?n:n.ownerDocument;o===null||o[_]||(o[_]=!0,Se("selectionchange",!1,o))}}function Me(n,o,p,b){switch(d0(o)){case Gl:var O=Gy;break;case fu:O=Sb;break;default:O=Um}p=O.bind(null,o,p,n),O=void 0,!j0||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(O=!0),b?O!==void 0?n.addEventListener(o,p,{capture:!0,passive:O}):n.addEventListener(o,p,!0):O!==void 0?n.addEventListener(o,p,{passive:O}):n.addEventListener(o,p,!1)}function ze(n,o,p,b,O){var z=b;if((o&1)===0&&(o&2)===0&&b!==null)e:for(;;){if(b===null)return;var W=b.tag;if(W===3||W===4){var oe=b.stateNode.containerInfo;if(oe===O)break;if(W===4)for(W=b.return;W!==null;){var Ce=W.tag;if((Ce===3||Ce===4)&&W.stateNode.containerInfo===O)return;W=W.return}for(;oe!==null;){if(W=jo(oe),W===null)return;if(Ce=W.tag,Ce===5||Ce===6||Ce===26||Ce===27){b=z=W;continue e}oe=oe.parentNode}}b=b.return}Mu(function(){var Be=z,Dt=Ns(p),Ft=[];e:{var Et=wv.get(n);if(Et!==void 0){var Gt=pv,Hn=n;switch(n){case"keypress":if(cr(p)===0)break e;case"keydown":case"keyup":Gt=hS;break;case"focusin":Hn="focus",Gt=mv;break;case"focusout":Hn="blur",Gt=mv;break;case"beforeblur":case"afterblur":Gt=mv;break;case"click":if(p.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Gt=Kb;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Gt=Qb;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Gt=Km;break;case p1:case m1:case eg:Gt=V0;break;case C_:Gt=c1;break;case"scroll":case"scrollend":Gt=_a;break;case"wheel":Gt=gv;break;case"copy":case"cut":case"paste":Gt=uS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Gt=q0;break;case"toggle":case"beforetoggle":Gt=h1}var Mr=(o&4)!==0,Yi=!Mr&&(n==="scroll"||n==="scrollend"),oi=Mr?Et!==null?Et+"Capture":null:Et;Mr=[];for(var et=Be,nt;et!==null;){var ht=et;if(nt=ht.stateNode,ht=ht.tag,ht!==5&&ht!==26&&ht!==27||nt===null||oi===null||(ht=dn(et,oi),ht!=null&&Mr.push(ot(et,ht,nt))),Yi)break;et=et.return}0<Mr.length&&(Et=new Gt(Et,Hn,null,p,Dt),Ft.push({event:Et,listeners:Mr}))}}if((o&7)===0){e:{if(Et=n==="mouseover"||n==="pointerover",Gt=n==="mouseout"||n==="pointerout",Et&&p!==v_&&(Hn=p.relatedTarget||p.fromElement)&&(jo(Hn)||Hn[Dc]))break e;if((Gt||Et)&&(Et=Dt.window===Dt?Dt:(Et=Dt.ownerDocument)?Et.defaultView||Et.parentWindow:window,Gt?(Hn=p.relatedTarget||p.toElement,Gt=Be,Hn=Hn?jo(Hn):null,Hn!==null&&(Yi=We(Hn),Mr=Hn.tag,Hn!==Yi||Mr!==5&&Mr!==27&&Mr!==6)&&(Hn=null)):(Gt=null,Hn=Be),Gt!==Hn)){if(Mr=Kb,ht="onMouseLeave",oi="onMouseEnter",et="mouse",(n==="pointerout"||n==="pointerover")&&(Mr=q0,ht="onPointerLeave",oi="onPointerEnter",et="pointer"),Yi=Gt==null?Et:ra(Gt),nt=Hn==null?Et:ra(Hn),Et=new Mr(ht,et+"leave",Gt,p,Dt),Et.target=Yi,Et.relatedTarget=nt,ht=null,jo(Dt)===Be&&(Mr=new Mr(oi,et+"enter",Hn,p,Dt),Mr.target=nt,Mr.relatedTarget=Yi,ht=Mr),Yi=ht,Gt&&Hn)t:{for(Mr=Gt,oi=Hn,et=0,nt=Mr;nt;nt=ft(nt))et++;for(nt=0,ht=oi;ht;ht=ft(ht))nt++;for(;0<et-nt;)Mr=ft(Mr),et--;for(;0<nt-et;)oi=ft(oi),nt--;for(;et--;){if(Mr===oi||oi!==null&&Mr===oi.alternate)break t;Mr=ft(Mr),oi=ft(oi)}Mr=null}else Mr=null;Gt!==null&&gt(Ft,Et,Gt,Mr,!1),Hn!==null&&Yi!==null&&gt(Ft,Yi,Hn,Mr,!0)}}e:{if(Et=Be?ra(Be):window,Gt=Et.nodeName&&Et.nodeName.toLowerCase(),Gt==="select"||Gt==="input"&&Et.type==="file")var Zt=ko;else if(Ou(Et))if(lp)Zt=co;else{Zt=Ga;var Cn=hf}else Gt=Et.nodeName,!Gt||Gt.toLowerCase()!=="input"||Et.type!=="checkbox"&&Et.type!=="radio"?Be&&gr(Be.elementType)&&(Zt=ko):Zt=Hi;if(Zt&&(Zt=Zt(n,Be))){Iu(Ft,Zt,p,Dt);break e}Cn&&Cn(n,Et,Be),n==="focusout"&&Be&&Et.type==="number"&&Be.memoizedProps.value!=null&&Ar(Et,"number",Et.value)}switch(Cn=Be?ra(Be):window,n){case"focusin":(Ou(Cn)||Cn.contentEditable==="true")&&(cp=Cn,yv=Be,Jm=null);break;case"focusout":Jm=yv=cp=null;break;case"mousedown":vv=!0;break;case"contextmenu":case"mouseup":case"dragend":vv=!1,by(Ft,p,Dt);break;case"selectionchange":if(pS)break;case"keydown":case"keyup":by(Ft,p,Dt)}var Pr;if(Rh)e:{switch(n){case"compositionstart":var Gn="onCompositionStart";break e;case"compositionend":Gn="onCompositionEnd";break e;case"compositionupdate":Gn="onCompositionUpdate";break e}Gn=void 0}else vd?Sl(n,p)&&(Gn="onCompositionEnd"):n==="keydown"&&p.keyCode===_v&&(Gn="onCompositionStart");Gn&&(H0&&p.locale!=="ko"&&(vd||Gn!=="onCompositionStart"?Gn==="onCompositionEnd"&&vd&&(Pr=Cr()):(Rc=Dt,x_="value"in Rc?Rc.value:Rc.textContent,vd=!0)),Cn=Xe(Be,Gn),0<Cn.length&&(Gn=new mu(Gn,n,null,p,Dt),Ft.push({event:Gn,listeners:Cn}),Pr?Gn.data=Pr:(Pr=_o(p),Pr!==null&&(Gn.data=Pr)))),(Pr=f1?Ii(n,p):qa(n,p))&&(Gn=Xe(Be,"onBeforeInput"),0<Gn.length&&(Cn=new r1("onBeforeInput","beforeinput",null,p,Dt),Ft.push({event:Cn,listeners:Gn}),Cn.data=Pr)),be(Ft,n,Be,p,Dt)}Ae(Ft,o)})}function ot(n,o,p){return{instance:n,listener:o,currentTarget:p}}function Xe(n,o){for(var p=o+"Capture",b=[];n!==null;){var O=n,z=O.stateNode;if(O=O.tag,O!==5&&O!==26&&O!==27||z===null||(O=dn(n,p),O!=null&&b.unshift(ot(n,O,z)),O=dn(n,o),O!=null&&b.push(ot(n,O,z))),n.tag===3)return b;n=n.return}return[]}function ft(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5&&n.tag!==27);return n||null}function gt(n,o,p,b,O){for(var z=o._reactName,W=[];p!==null&&p!==b;){var oe=p,Ce=oe.alternate,Be=oe.stateNode;if(oe=oe.tag,Ce!==null&&Ce===b)break;oe!==5&&oe!==26&&oe!==27||Be===null||(Ce=Be,O?(Be=dn(p,z),Be!=null&&W.unshift(ot(p,Be,Ce))):O||(Be=dn(p,z),Be!=null&&W.push(ot(p,Be,Ce)))),p=p.return}W.length!==0&&n.push({event:o,listeners:W})}function Mt(n,o){vy(n,o),n!=="input"&&n!=="textarea"&&n!=="select"||o==null||o.value!==null||dv||(dv=!0,n==="select"&&o.multiple?console.error("`value` prop on `%s` should not be null. Consider using an empty array when `multiple` is set to `true` to clear the component or `undefined` for uncontrolled components.",n):console.error("`value` prop on `%s` should not be null. Consider using an empty string to clear the component or `undefined` for uncontrolled components.",n));var p={registrationNameDependencies:Qf,possibleRegistrationNames:rv};gr(n)||typeof o.is=="string"||uf(n,o,p),o.contentEditable&&!o.suppressContentEditableWarning&&o.children!=null&&console.error("A component is `contentEditable` and contains `children` managed by React. It is now your responsibility to guarantee that none of those nodes are unexpectedly modified or duplicated. This is probably not intentional.")}function He(n,o,p,b){o!==p&&(p=lt(p),lt(o)!==p&&(b[n]=o))}function mt(n,o,p){o.forEach(function(b){p[hn(b)]=b==="style"?In(n):n.getAttribute(b)})}function qe(n,o){o===!1?console.error("Expected `%s` listener to be a function, instead got `false`.\n\nIf you used to conditionally omit it with %s={condition && value}, pass %s={condition ? value : undefined} instead.",n,n,n):console.error("Expected `%s` listener to be a function, instead got a value of `%s` type.",n,typeof o)}function pt(n,o){return n=n.namespaceURI===uv||n.namespaceURI===Wm?n.ownerDocument.createElementNS(n.namespaceURI,n.tagName):n.ownerDocument.createElement(n.tagName),n.innerHTML=o,n.innerHTML}function lt(n){return tt(n)&&(console.error("The provided HTML markup uses a value of unsupported type %s. This value must be coerced to a string before using it here.",sn(n)),un(n)),(typeof n=="string"?n:""+n).replace(H,`
`).replace(q,"")}function yt(n,o){return o=lt(o),lt(n)===o}function st(){}function dt(n,o,p,b,O,z){switch(p){case"children":typeof b=="string"?(Is(b,o,!1),o==="body"||o==="textarea"&&b===""||go(n,b)):(typeof b=="number"||typeof b=="bigint")&&(Is(""+b,o,!1),o!=="body"&&go(n,""+b));break;case"className":Er(n,"class",b);break;case"tabIndex":Er(n,"tabindex",b);break;case"dir":case"role":case"viewBox":case"width":case"height":Er(n,p,b);break;case"style":aa(n,b,z);break;case"data":if(o!=="object"){Er(n,"data",b);break}case"src":case"href":if(b===""&&(o!=="a"||p!=="href")){console.error(p==="src"?'An empty string ("") was passed to the %s attribute. This may cause the browser to download the whole page again over the network. To fix this, either do not render the element at all or pass null to %s instead of an empty string.':'An empty string ("") was passed to the %s attribute. To fix this, either do not render the element at all or pass null to %s instead of an empty string.',p,p),n.removeAttribute(p);break}if(b==null||typeof b=="function"||typeof b=="symbol"||typeof b=="boolean"){n.removeAttribute(p);break}pn(b,p),b=or(""+b),n.setAttribute(p,b);break;case"action":case"formAction":if(b!=null&&(o==="form"?p==="formAction"?console.error("You can only pass the formAction prop to <input> or <button>. Use the action prop on <form>."):typeof b=="function"&&(O.encType==null&&O.method==null||B||(B=!0,console.error("Cannot specify a encType or method for a form that specifies a function as the action. React provides those automatically. They will get overridden.")),O.target==null||I||(I=!0,console.error("Cannot specify a target for a form that specifies a function as the action. The function will always be executed in the same window."))):o==="input"||o==="button"?p==="action"?console.error("You can only pass the action prop to <form>. Use the formAction prop on <input> or <button>."):o!=="input"||O.type==="submit"||O.type==="image"||A?o!=="button"||O.type==null||O.type==="submit"||A?typeof b=="function"&&(O.name==null||D||(D=!0,console.error('Cannot specify a "name" prop for a button that specifies a function as a formAction. React needs it to encode which action should be invoked. It will get overridden.')),O.formEncType==null&&O.formMethod==null||B||(B=!0,console.error("Cannot specify a formEncType or formMethod for a button that specifies a function as a formAction. React provides those automatically. They will get overridden.")),O.formTarget==null||I||(I=!0,console.error("Cannot specify a formTarget for a button that specifies a function as a formAction. The function will always be executed in the same window."))):(A=!0,console.error('A button can only specify a formAction along with type="submit" or no type.')):(A=!0,console.error('An input can only specify a formAction along with type="submit" or type="image".')):console.error(p==="action"?"You can only pass the action prop to <form>.":"You can only pass the formAction prop to <input> or <button>.")),typeof b=="function"){n.setAttribute(p,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof z=="function"&&(p==="formAction"?(o!=="input"&&dt(n,o,"name",O.name,O,null),dt(n,o,"formEncType",O.formEncType,O,null),dt(n,o,"formMethod",O.formMethod,O,null),dt(n,o,"formTarget",O.formTarget,O,null)):(dt(n,o,"encType",O.encType,O,null),dt(n,o,"method",O.method,O,null),dt(n,o,"target",O.target,O,null)));if(b==null||typeof b=="symbol"||typeof b=="boolean"){n.removeAttribute(p);break}pn(b,p),b=or(""+b),n.setAttribute(p,b);break;case"onClick":b!=null&&(typeof b!="function"&&qe(p,b),n.onclick=st);break;case"onScroll":b!=null&&(typeof b!="function"&&qe(p,b),ve("scroll",n));break;case"onScrollEnd":b!=null&&(typeof b!="function"&&qe(p,b),ve("scrollend",n));break;case"dangerouslySetInnerHTML":if(b!=null){if(typeof b!="object"||!("__html"in b))throw Error("`props.dangerouslySetInnerHTML` must be in the form `{__html: ...}`. Please visit https://react.dev/link/dangerously-set-inner-html for more information.");if(p=b.__html,p!=null){if(O.children!=null)throw Error("Can only set one of `children` or `props.dangerouslySetInnerHTML`.");n.innerHTML=p}}break;case"multiple":n.multiple=b&&typeof b!="function"&&typeof b!="symbol";break;case"muted":n.muted=b&&typeof b!="function"&&typeof b!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(b==null||typeof b=="function"||typeof b=="boolean"||typeof b=="symbol"){n.removeAttribute("xlink:href");break}pn(b,p),p=or(""+b),n.setAttributeNS(Y,"xlink:href",p);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":b!=null&&typeof b!="function"&&typeof b!="symbol"?(pn(b,p),n.setAttribute(p,""+b)):n.removeAttribute(p);break;case"inert":b!==""||G[p]||(G[p]=!0,console.error("Received an empty string for a boolean attribute `%s`. This will treat the attribute as if it were false. Either pass `false` to silence this warning, or pass `true` if you used an empty string in earlier versions of React to indicate this attribute is true.",p));case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":b&&typeof b!="function"&&typeof b!="symbol"?n.setAttribute(p,""):n.removeAttribute(p);break;case"capture":case"download":b===!0?n.setAttribute(p,""):b!==!1&&b!=null&&typeof b!="function"&&typeof b!="symbol"?(pn(b,p),n.setAttribute(p,b)):n.removeAttribute(p);break;case"cols":case"rows":case"size":case"span":b!=null&&typeof b!="function"&&typeof b!="symbol"&&!isNaN(b)&&1<=b?(pn(b,p),n.setAttribute(p,b)):n.removeAttribute(p);break;case"rowSpan":case"start":b==null||typeof b=="function"||typeof b=="symbol"||isNaN(b)?n.removeAttribute(p):(pn(b,p),n.setAttribute(p,b));break;case"popover":ve("beforetoggle",n),ve("toggle",n),Br(n,"popover",b);break;case"xlinkActuate":no(n,Y,"xlink:actuate",b);break;case"xlinkArcrole":no(n,Y,"xlink:arcrole",b);break;case"xlinkRole":no(n,Y,"xlink:role",b);break;case"xlinkShow":no(n,Y,"xlink:show",b);break;case"xlinkTitle":no(n,Y,"xlink:title",b);break;case"xlinkType":no(n,Y,"xlink:type",b);break;case"xmlBase":no(n,J,"xml:base",b);break;case"xmlLang":no(n,J,"xml:lang",b);break;case"xmlSpace":no(n,J,"xml:space",b);break;case"is":z!=null&&console.error('Cannot update the "is" prop after it has been initialized.'),Br(n,"is",b);break;case"innerText":case"textContent":break;case"popoverTarget":U||b==null||typeof b!="object"||(U=!0,console.error("The `popoverTarget` prop expects the ID of an Element as a string. Received %s instead.",b));default:!(2<p.length)||p[0]!=="o"&&p[0]!=="O"||p[1]!=="n"&&p[1]!=="N"?(p=Hp(p),Br(n,p,b)):Qf.hasOwnProperty(p)&&b!=null&&typeof b!="function"&&qe(p,b)}}function Ht(n,o,p,b,O,z){switch(p){case"style":aa(n,b,z);break;case"dangerouslySetInnerHTML":if(b!=null){if(typeof b!="object"||!("__html"in b))throw Error("`props.dangerouslySetInnerHTML` must be in the form `{__html: ...}`. Please visit https://react.dev/link/dangerously-set-inner-html for more information.");if(p=b.__html,p!=null){if(O.children!=null)throw Error("Can only set one of `children` or `props.dangerouslySetInnerHTML`.");n.innerHTML=p}}break;case"children":typeof b=="string"?go(n,b):(typeof b=="number"||typeof b=="bigint")&&go(n,""+b);break;case"onScroll":b!=null&&(typeof b!="function"&&qe(p,b),ve("scroll",n));break;case"onScrollEnd":b!=null&&(typeof b!="function"&&qe(p,b),ve("scrollend",n));break;case"onClick":b!=null&&(typeof b!="function"&&qe(p,b),n.onclick=st);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(Qf.hasOwnProperty(p))b!=null&&typeof b!="function"&&qe(p,b);else e:{if(p[0]==="o"&&p[1]==="n"&&(O=p.endsWith("Capture"),o=p.slice(2,O?p.length-7:void 0),z=n[ts]||null,z=z!=null?z[p]:null,typeof z=="function"&&n.removeEventListener(o,z,O),typeof b=="function")){typeof z!="function"&&z!==null&&(p in n?n[p]=null:n.hasAttribute(p)&&n.removeAttribute(p)),n.addEventListener(o,b,O);break e}p in n?n[p]=b:b===!0?n.setAttribute(p,""):Br(n,p,b)}}}function kt(n,o,p){switch(Mt(o,p),o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ve("error",n),ve("load",n);var b=!1,O=!1,z;for(z in p)if(p.hasOwnProperty(z)){var W=p[z];if(W!=null)switch(z){case"src":b=!0;break;case"srcSet":O=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(o+" is a void element tag and must neither have `children` nor use `dangerouslySetInnerHTML`.");default:dt(n,o,z,W,p,null)}}O&&dt(n,o,"srcSet",p.srcSet,p,null),b&&dt(n,o,"src",p.src,p,null);return;case"input":kn("input",p),ve("invalid",n);var oe=z=W=O=null,Ce=null,Be=null;for(b in p)if(p.hasOwnProperty(b)){var Dt=p[b];if(Dt!=null)switch(b){case"name":O=Dt;break;case"type":W=Dt;break;case"checked":Ce=Dt;break;case"defaultChecked":Be=Dt;break;case"value":z=Dt;break;case"defaultValue":oe=Dt;break;case"children":case"dangerouslySetInnerHTML":if(Dt!=null)throw Error(o+" is a void element tag and must neither have `children` nor use `dangerouslySetInnerHTML`.");break;default:dt(n,o,b,Dt,p,null)}}Wr(n,p),Qn(n,z,oe,Ce,Be,W,O,!1),Nn(n);return;case"select":kn("select",p),ve("invalid",n),b=W=z=null;for(O in p)if(p.hasOwnProperty(O)&&(oe=p[O],oe!=null))switch(O){case"value":z=oe;break;case"defaultValue":W=oe;break;case"multiple":b=oe;default:dt(n,o,O,oe,p,null)}ro(n,p),o=z,p=W,n.multiple=!!b,o!=null?fi(n,!!b,o,!1):p!=null&&fi(n,!!b,p,!0);return;case"textarea":kn("textarea",p),ve("invalid",n),z=O=b=null;for(W in p)if(p.hasOwnProperty(W)&&(oe=p[W],oe!=null))switch(W){case"value":b=oe;break;case"defaultValue":O=oe;break;case"children":z=oe;break;case"dangerouslySetInnerHTML":if(oe!=null)throw Error("`dangerouslySetInnerHTML` does not make sense on <textarea>.");break;default:dt(n,o,W,oe,p,null)}Mo(n,p),Vo(n,b,O,z),Nn(n);return;case"option":Rr(n,p);for(Ce in p)if(p.hasOwnProperty(Ce)&&(b=p[Ce],b!=null))switch(Ce){case"selected":n.selected=b&&typeof b!="function"&&typeof b!="symbol";break;default:dt(n,o,Ce,b,p,null)}return;case"dialog":ve("beforetoggle",n),ve("toggle",n),ve("cancel",n),ve("close",n);break;case"iframe":case"object":ve("load",n);break;case"video":case"audio":for(b=0;b<S.length;b++)ve(S[b],n);break;case"image":ve("error",n),ve("load",n);break;case"details":ve("toggle",n);break;case"embed":case"source":case"link":ve("error",n),ve("load",n);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Be in p)if(p.hasOwnProperty(Be)&&(b=p[Be],b!=null))switch(Be){case"children":case"dangerouslySetInnerHTML":throw Error(o+" is a void element tag and must neither have `children` nor use `dangerouslySetInnerHTML`.");default:dt(n,o,Be,b,p,null)}return;default:if(gr(o)){for(Dt in p)p.hasOwnProperty(Dt)&&(b=p[Dt],b!==void 0&&Ht(n,o,Dt,b,p,void 0));return}}for(oe in p)p.hasOwnProperty(oe)&&(b=p[oe],b!=null&&dt(n,o,oe,b,p,null))}function Wt(n,o,p,b){switch(Mt(o,b),o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var O=null,z=null,W=null,oe=null,Ce=null,Be=null,Dt=null;for(Gt in p){var Ft=p[Gt];if(p.hasOwnProperty(Gt)&&Ft!=null)switch(Gt){case"checked":break;case"value":break;case"defaultValue":Ce=Ft;default:b.hasOwnProperty(Gt)||dt(n,o,Gt,null,b,Ft)}}for(var Et in b){var Gt=b[Et];if(Ft=p[Et],b.hasOwnProperty(Et)&&(Gt!=null||Ft!=null))switch(Et){case"type":z=Gt;break;case"name":O=Gt;break;case"checked":Be=Gt;break;case"defaultChecked":Dt=Gt;break;case"value":W=Gt;break;case"defaultValue":oe=Gt;break;case"children":case"dangerouslySetInnerHTML":if(Gt!=null)throw Error(o+" is a void element tag and must neither have `children` nor use `dangerouslySetInnerHTML`.");break;default:Gt!==Ft&&dt(n,o,Et,Gt,b,Ft)}}o=p.type==="checkbox"||p.type==="radio"?p.checked!=null:p.value!=null,b=b.type==="checkbox"||b.type==="radio"?b.checked!=null:b.value!=null,o||!b||M||(console.error("A component is changing an uncontrolled input to be controlled. This is likely caused by the value changing from undefined to a defined value, which should not happen. Decide between using a controlled or uncontrolled input element for the lifetime of the component. More info: https://react.dev/link/controlled-components"),M=!0),!o||b||E||(console.error("A component is changing a controlled input to be uncontrolled. This is likely caused by the value changing from a defined to undefined, which should not happen. Decide between using a controlled or uncontrolled input element for the lifetime of the component. More info: https://react.dev/link/controlled-components"),E=!0),si(n,W,oe,Ce,Be,Dt,z,O);return;case"select":Gt=W=oe=Et=null;for(z in p)if(Ce=p[z],p.hasOwnProperty(z)&&Ce!=null)switch(z){case"value":break;case"multiple":Gt=Ce;default:b.hasOwnProperty(z)||dt(n,o,z,null,b,Ce)}for(O in b)if(z=b[O],Ce=p[O],b.hasOwnProperty(O)&&(z!=null||Ce!=null))switch(O){case"value":Et=z;break;case"defaultValue":oe=z;break;case"multiple":W=z;default:z!==Ce&&dt(n,o,O,z,b,Ce)}b=oe,o=W,p=Gt,Et!=null?fi(n,!!o,Et,!1):!!p!=!!o&&(b!=null?fi(n,!!o,b,!0):fi(n,!!o,o?[]:"",!1));return;case"textarea":Gt=Et=null;for(oe in p)if(O=p[oe],p.hasOwnProperty(oe)&&O!=null&&!b.hasOwnProperty(oe))switch(oe){case"value":break;case"children":break;default:dt(n,o,oe,null,b,O)}for(W in b)if(O=b[W],z=p[W],b.hasOwnProperty(W)&&(O!=null||z!=null))switch(W){case"value":Et=O;break;case"defaultValue":Gt=O;break;case"children":break;case"dangerouslySetInnerHTML":if(O!=null)throw Error("`dangerouslySetInnerHTML` does not make sense on <textarea>.");break;default:O!==z&&dt(n,o,W,O,b,z)}oa(n,Et,Gt);return;case"option":for(var Hn in p)if(Et=p[Hn],p.hasOwnProperty(Hn)&&Et!=null&&!b.hasOwnProperty(Hn))switch(Hn){case"selected":n.selected=!1;break;default:dt(n,o,Hn,null,b,Et)}for(Ce in b)if(Et=b[Ce],Gt=p[Ce],b.hasOwnProperty(Ce)&&Et!==Gt&&(Et!=null||Gt!=null))switch(Ce){case"selected":n.selected=Et&&typeof Et!="function"&&typeof Et!="symbol";break;default:dt(n,o,Ce,Et,b,Gt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Mr in p)Et=p[Mr],p.hasOwnProperty(Mr)&&Et!=null&&!b.hasOwnProperty(Mr)&&dt(n,o,Mr,null,b,Et);for(Be in b)if(Et=b[Be],Gt=p[Be],b.hasOwnProperty(Be)&&Et!==Gt&&(Et!=null||Gt!=null))switch(Be){case"children":case"dangerouslySetInnerHTML":if(Et!=null)throw Error(o+" is a void element tag and must neither have `children` nor use `dangerouslySetInnerHTML`.");break;default:dt(n,o,Be,Et,b,Gt)}return;default:if(gr(o)){for(var Yi in p)Et=p[Yi],p.hasOwnProperty(Yi)&&Et!==void 0&&!b.hasOwnProperty(Yi)&&Ht(n,o,Yi,void 0,b,Et);for(Dt in b)Et=b[Dt],Gt=p[Dt],!b.hasOwnProperty(Dt)||Et===Gt||Et===void 0&&Gt===void 0||Ht(n,o,Dt,Et,b,Gt);return}}for(var oi in p)Et=p[oi],p.hasOwnProperty(oi)&&Et!=null&&!b.hasOwnProperty(oi)&&dt(n,o,oi,null,b,Et);for(Ft in b)Et=b[Ft],Gt=p[Ft],!b.hasOwnProperty(Ft)||Et===Gt||Et==null&&Gt==null||dt(n,o,Ft,Et,b,Gt)}function hn(n){switch(n){case"class":return"className";case"for":return"htmlFor";default:return n}}function In(n){var o={};n=n.style;for(var p=0;p<n.length;p++){var b=n[p];o[b]=n.getPropertyValue(b)}return o}function bn(n,o,p){if(o!=null&&typeof o!="object")console.error("The `style` prop expects a mapping from style properties to values, not a string. For example, style={{marginRight: spacing + 'em'}} when using JSX.");else{var b,O=b="",z;for(z in o)if(o.hasOwnProperty(z)){var W=o[z];W!=null&&typeof W!="boolean"&&W!==""&&(z.indexOf("--")===0?(Vt(W,z),b+=O+z+":"+(""+W).trim()):typeof W!="number"||W===0||Yb.has(z)?(Vt(W,z),b+=O+z.replace(L0,"-$1").toLowerCase().replace(B0,"-ms-")+":"+(""+W).trim()):b+=O+z.replace(L0,"-$1").toLowerCase().replace(B0,"-ms-")+":"+W+"px",O=";")}b=b||null,o=n.getAttribute("style"),o!==b&&(b=lt(b),lt(o)!==b&&(p.style=In(n)))}}function Tn(n,o,p,b,O,z){if(O.delete(p),n=n.getAttribute(p),n===null)switch(typeof b){case"undefined":case"function":case"symbol":case"boolean":return}else if(b!=null)switch(typeof b){case"function":case"symbol":case"boolean":break;default:if(pn(b,o),n===""+b)return}He(o,n,b,z)}function Mn(n,o,p,b,O,z){if(O.delete(p),n=n.getAttribute(p),n===null){switch(typeof b){case"function":case"symbol":return}if(!b)return}else switch(typeof b){case"function":case"symbol":break;default:if(b)return}He(o,n,b,z)}function tr(n,o,p,b,O,z){if(O.delete(p),n=n.getAttribute(p),n===null)switch(typeof b){case"undefined":case"function":case"symbol":return}else if(b!=null)switch(typeof b){case"function":case"symbol":break;default:if(pn(b,p),n===""+b)return}He(o,n,b,z)}function yr(n,o,p,b,O,z){if(O.delete(p),n=n.getAttribute(p),n===null)switch(typeof b){case"undefined":case"function":case"symbol":case"boolean":return;default:if(isNaN(b))return}else if(b!=null)switch(typeof b){case"function":case"symbol":case"boolean":break;default:if(!isNaN(b)&&(pn(b,o),n===""+b))return}He(o,n,b,z)}function Gr(n,o,p,b,O,z){if(O.delete(p),n=n.getAttribute(p),n===null)switch(typeof b){case"undefined":case"function":case"symbol":case"boolean":return}else if(b!=null)switch(typeof b){case"function":case"symbol":case"boolean":break;default:if(pn(b,o),p=or(""+b),n===p)return}He(o,n,b,z)}function Kn(n,o,p,b){for(var O={},z=new Set,W=n.attributes,oe=0;oe<W.length;oe++)switch(W[oe].name.toLowerCase()){case"value":break;case"checked":break;case"selected":break;default:z.add(W[oe].name)}if(gr(o)){for(var Ce in p)if(p.hasOwnProperty(Ce)){var Be=p[Ce];if(Be!=null){if(Qf.hasOwnProperty(Ce))typeof Be!="function"&&qe(Ce,Be);else if(p.suppressHydrationWarning!==!0)switch(Ce){case"children":typeof Be!="string"&&typeof Be!="number"||He("children",n.textContent,Be,O);continue;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":continue;case"dangerouslySetInnerHTML":W=n.innerHTML,Be=Be?Be.__html:void 0,Be!=null&&(Be=pt(n,Be),He(Ce,W,Be,O));continue;case"style":z.delete(Ce),bn(n,Be,O);continue;case"offsetParent":case"offsetTop":case"offsetLeft":case"offsetWidth":case"offsetHeight":case"isContentEditable":case"outerText":case"outerHTML":z.delete(Ce.toLowerCase()),console.error("Assignment to read-only property will result in a no-op: `%s`",Ce);continue;case"className":z.delete("class"),W=wr(n,"class",Be),He("className",W,Be,O);continue;default:b.context===Je&&o!=="svg"&&o!=="math"?z.delete(Ce.toLowerCase()):z.delete(Ce),W=wr(n,Ce,Be),He(Ce,W,Be,O)}}}}else for(Be in p)if(p.hasOwnProperty(Be)&&(Ce=p[Be],Ce!=null)){if(Qf.hasOwnProperty(Be))typeof Ce!="function"&&qe(Be,Ce);else if(p.suppressHydrationWarning!==!0)switch(Be){case"children":typeof Ce!="string"&&typeof Ce!="number"||He("children",n.textContent,Ce,O);continue;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"value":case"checked":case"selected":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":continue;case"dangerouslySetInnerHTML":W=n.innerHTML,Ce=Ce?Ce.__html:void 0,Ce!=null&&(Ce=pt(n,Ce),W!==Ce&&(O[Be]={__html:W}));continue;case"className":Tn(n,Be,"class",Ce,z,O);continue;case"tabIndex":Tn(n,Be,"tabindex",Ce,z,O);continue;case"style":z.delete(Be),bn(n,Ce,O);continue;case"multiple":z.delete(Be),He(Be,n.multiple,Ce,O);continue;case"muted":z.delete(Be),He(Be,n.muted,Ce,O);continue;case"autoFocus":z.delete("autofocus"),He(Be,n.autofocus,Ce,O);continue;case"data":if(o!=="object"){z.delete(Be),W=n.getAttribute("data"),He(Be,W,Ce,O);continue}case"src":case"href":if(!(Ce!==""||o==="a"&&Be==="href"||o==="object"&&Be==="data")){console.error(Be==="src"?'An empty string ("") was passed to the %s attribute. This may cause the browser to download the whole page again over the network. To fix this, either do not render the element at all or pass null to %s instead of an empty string.':'An empty string ("") was passed to the %s attribute. To fix this, either do not render the element at all or pass null to %s instead of an empty string.',Be,Be);continue}Gr(n,Be,Be,Ce,z,O);continue;case"action":case"formAction":if(W=n.getAttribute(Be),typeof Ce=="function"){z.delete(Be.toLowerCase()),Be==="formAction"?(z.delete("name"),z.delete("formenctype"),z.delete("formmethod"),z.delete("formtarget")):(z.delete("enctype"),z.delete("method"),z.delete("target"));continue}else if(W===ne){z.delete(Be.toLowerCase()),He(Be,"function",Ce,O);continue}Gr(n,Be,Be.toLowerCase(),Ce,z,O);continue;case"xlinkHref":Gr(n,Be,"xlink:href",Ce,z,O);continue;case"contentEditable":tr(n,Be,"contenteditable",Ce,z,O);continue;case"spellCheck":tr(n,Be,"spellcheck",Ce,z,O);continue;case"draggable":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":tr(n,Be,Be,Ce,z,O);continue;case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":Mn(n,Be,Be.toLowerCase(),Ce,z,O);continue;case"capture":case"download":e:{oe=n;var Dt=W=Be,Ft=O;if(z.delete(Dt),oe=oe.getAttribute(Dt),oe===null)switch(typeof Ce){case"undefined":case"function":case"symbol":break e;default:if(Ce===!1)break e}else if(Ce!=null)switch(typeof Ce){case"function":case"symbol":break;case"boolean":if(Ce===!0&&oe==="")break e;break;default:if(pn(Ce,W),oe===""+Ce)break e}He(W,oe,Ce,Ft)}continue;case"cols":case"rows":case"size":case"span":e:{if(oe=n,Dt=W=Be,Ft=O,z.delete(Dt),oe=oe.getAttribute(Dt),oe===null)switch(typeof Ce){case"undefined":case"function":case"symbol":case"boolean":break e;default:if(isNaN(Ce)||1>Ce)break e}else if(Ce!=null)switch(typeof Ce){case"function":case"symbol":case"boolean":break;default:if(!(isNaN(Ce)||1>Ce)&&(pn(Ce,W),oe===""+Ce))break e}He(W,oe,Ce,Ft)}continue;case"rowSpan":yr(n,Be,"rowspan",Ce,z,O);continue;case"start":yr(n,Be,Be,Ce,z,O);continue;case"xHeight":Tn(n,Be,"x-height",Ce,z,O);continue;case"xlinkActuate":Tn(n,Be,"xlink:actuate",Ce,z,O);continue;case"xlinkArcrole":Tn(n,Be,"xlink:arcrole",Ce,z,O);continue;case"xlinkRole":Tn(n,Be,"xlink:role",Ce,z,O);continue;case"xlinkShow":Tn(n,Be,"xlink:show",Ce,z,O);continue;case"xlinkTitle":Tn(n,Be,"xlink:title",Ce,z,O);continue;case"xlinkType":Tn(n,Be,"xlink:type",Ce,z,O);continue;case"xmlBase":Tn(n,Be,"xml:base",Ce,z,O);continue;case"xmlLang":Tn(n,Be,"xml:lang",Ce,z,O);continue;case"xmlSpace":Tn(n,Be,"xml:space",Ce,z,O);continue;case"inert":Ce!==""||G[Be]||(G[Be]=!0,console.error("Received an empty string for a boolean attribute `%s`. This will treat the attribute as if it were false. Either pass `false` to silence this warning, or pass `true` if you used an empty string in earlier versions of React to indicate this attribute is true.",Be)),Mn(n,Be,Be,Ce,z,O);continue;default:if(!(2<Be.length)||Be[0]!=="o"&&Be[0]!=="O"||Be[1]!=="n"&&Be[1]!=="N"){oe=Hp(Be),W=!1,b.context===Je&&o!=="svg"&&o!=="math"?z.delete(oe.toLowerCase()):(Dt=Be.toLowerCase(),Dt=__.hasOwnProperty(Dt)&&__[Dt]||null,Dt!==null&&Dt!==Be&&(W=!0,z.delete(Dt)),z.delete(oe));e:if(Dt=n,Ft=oe,oe=Ce,br(Ft))if(Dt.hasAttribute(Ft))Dt=Dt.getAttribute(Ft),pn(oe,Ft),oe=Dt===""+oe?oe:Dt;else{switch(typeof oe){case"function":case"symbol":break e;case"boolean":if(Dt=Ft.toLowerCase().slice(0,5),Dt!=="data-"&&Dt!=="aria-")break e}oe=oe===void 0?void 0:null}else oe=void 0;W||He(Be,oe,Ce,O)}}}return 0<z.size&&p.suppressHydrationWarning!==!0&&mt(n,z,O),Object.keys(O).length===0?null:O}function ci(n,o){switch(n.length){case 0:return"";case 1:return n[0];case 2:return n[0]+" "+o+" "+n[1];default:return n.slice(0,-1).join(", ")+", "+o+" "+n[n.length-1]}}function Pn(n){return n.nodeType===9?n:n.ownerDocument}function fn(n){switch(n){case Wm:return vt;case uv:return _t;default:return Je}}function ar(n,o){if(n===Je)switch(o){case"svg":return vt;case"math":return _t;default:return Je}return n===vt&&o==="foreignObject"?Je:n}function Dr(n,o){return n==="textarea"||n==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}function vr(){var n=window.event;return n&&n.type==="popstate"?n===bt?!1:(bt=n,!0):(bt=null,!1)}function Di(n){setTimeout(function(){throw n})}function Bi(n,o,p){switch(o){case"button":case"input":case"select":case"textarea":p.autoFocus&&n.focus();break;case"img":p.src?n.src=p.src:p.srcSet&&(n.srcset=p.srcSet)}}function Ji(n,o,p,b){Wt(n,o,p,b),n[ts]=b}function Qi(n){go(n,"")}function ma(n,o,p){n.nodeValue=p}function Fi(n){return n==="head"}function fr(n,o){n.removeChild(o)}function ui(n,o){(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n).removeChild(o)}function xr(n,o){var p=o,b=0,O=0;do{var z=p.nextSibling;if(n.removeChild(p),z&&z.nodeType===8)if(p=z.data,p===ue){if(0<b&&8>b){p=b;var W=n.ownerDocument;if(p&De&&r_(W.documentElement),p&Le&&r_(W.body),p&Ne)for(p=W.head,r_(p),W=p.firstChild;W;){var oe=W.nextSibling,Ce=W.nodeName;W[$m]||Ce==="SCRIPT"||Ce==="STYLE"||Ce==="LINK"&&W.rel.toLowerCase()==="stylesheet"||p.removeChild(W),W=oe}}if(O===0){n.removeChild(z),qm(o);return}O--}else p===ce||p===Ee||p===_e?O++:b=p.charCodeAt(0)-48;else b=0;p=z}while(p);qm(o)}function $r(n){n=n.style,typeof n.setProperty=="function"?n.setProperty("display","none","important"):n.display="none"}function wo(n){n.nodeValue=""}function ii(n,o){o=o[Ze],o=o!=null&&o.hasOwnProperty("display")?o.display:null,n.style.display=o==null||typeof o=="boolean"?"":(""+o).trim()}function eo(n,o){n.nodeValue=o}function Ra(n){var o=n.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var p=o;switch(o=o.nextSibling,p.nodeName){case"HTML":case"HEAD":case"BODY":Ra(p),ks(p);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(p.rel.toLowerCase()==="stylesheet")continue}n.removeChild(p)}}function Hs(n,o,p,b){for(;n.nodeType===1;){var O=p;if(n.nodeName.toLowerCase()!==o.toLowerCase()){if(!b&&(n.nodeName!=="INPUT"||n.type!=="hidden"))break}else if(b){if(!n[$m])switch(o){case"meta":if(!n.hasAttribute("itemprop"))break;return n;case"link":if(z=n.getAttribute("rel"),z==="stylesheet"&&n.hasAttribute("data-precedence"))break;if(z!==O.rel||n.getAttribute("href")!==(O.href==null||O.href===""?null:O.href)||n.getAttribute("crossorigin")!==(O.crossOrigin==null?null:O.crossOrigin)||n.getAttribute("title")!==(O.title==null?null:O.title))break;return n;case"style":if(n.hasAttribute("data-precedence"))break;return n;case"script":if(z=n.getAttribute("src"),(z!==(O.src==null?null:O.src)||n.getAttribute("type")!==(O.type==null?null:O.type)||n.getAttribute("crossorigin")!==(O.crossOrigin==null?null:O.crossOrigin))&&z&&n.hasAttribute("async")&&!n.hasAttribute("itemprop"))break;return n;default:return n}}else if(o==="input"&&n.type==="hidden"){pn(O.name,"name");var z=O.name==null?null:""+O.name;if(O.type==="hidden"&&n.getAttribute("name")===z)return n}else return n;if(n=Pi(n.nextSibling),n===null)break}return null}function ka(n,o,p){if(o==="")return null;for(;n.nodeType!==3;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!p||(n=Pi(n.nextSibling),n===null))return null;return n}function Yo(n){return n.data===_e||n.data===Ee&&n.ownerDocument.readyState===Ke}function Oa(n,o){var p=n.ownerDocument;if(n.data!==Ee||p.readyState===Ke)o();else{var b=function(){o(),p.removeEventListener("DOMContentLoaded",b)};p.addEventListener("DOMContentLoaded",b),n._reactRetry=b}}function Pi(n){for(;n!=null;n=n.nextSibling){var o=n.nodeType;if(o===1||o===3)break;if(o===8){if(o=n.data,o===ce||o===_e||o===Ee||o===Ge||o===Ve)break;if(o===ue)return null}}return n}function Fl(n){if(n.nodeType===1){for(var o=n.nodeName.toLowerCase(),p={},b=n.attributes,O=0;O<b.length;O++){var z=b[O];p[hn(z.name)]=z.name.toLowerCase()==="style"?In(n):z.value}return{type:o,props:p}}return n.nodeType===8?{type:"Suspense",props:{}}:n.nodeValue}function cl(n,o,p){return p===null||p[me]!==!0?(n.nodeValue===o?n=null:(o=lt(o),n=lt(n.nodeValue)===o?null:n.nodeValue),n):null}function Ul(n){n=n.nextSibling;for(var o=0;n;){if(n.nodeType===8){var p=n.data;if(p===ue){if(o===0)return Pi(n.nextSibling);o--}else p!==ce&&p!==_e&&p!==Ee||o++}n=n.nextSibling}return null}function zm(n){n=n.previousSibling;for(var o=0;n;){if(n.nodeType===8){var p=n.data;if(p===ce||p===_e||p===Ee){if(o===0)return n;o--}else p===ue&&o++}n=n.previousSibling}return null}function Th(n){qm(n)}function Pm(n){qm(n)}function Lm(n,o,p,b,O){switch(O&&Hd(n,b.ancestorInfo),o=Pn(p),n){case"html":if(n=o.documentElement,!n)throw Error("React expected an <html> element (document.documentElement) to exist in the Document but one was not found. React never removes the documentElement for any Document it renders into so the cause is likely in some other script running on this page.");return n;case"head":if(n=o.head,!n)throw Error("React expected a <head> element (document.head) to exist in the Document but one was not found. React never removes the head for any Document it renders into so the cause is likely in some other script running on this page.");return n;case"body":if(n=o.body,!n)throw Error("React expected a <body> element (document.body) to exist in the Document but one was not found. React never removes the body for any Document it renders into so the cause is likely in some other script running on this page.");return n;default:throw Error("resolveSingletonInstance was called with an element type that is not supported. This is a bug in React.")}}function gb(n,o,p,b){if(!p[Dc]&&qi(p)){var O=p.tagName.toLowerCase();console.error("You are mounting a new %s component when a previous one has not first unmounted. It is an error to render more than one %s component at a time and attributes and children of these components will likely fail in unpredictable ways. Please only render a single instance of <%s> and if you need to mount a new one, ensure any previous ones have unmounted first.",O,O,O)}switch(n){case"html":case"head":case"body":break;default:console.error("acquireSingletonInstance was called with an element type that is not supported. This is a bug in React.")}for(O=p.attributes;O.length;)p.removeAttributeNode(O[0]);kt(p,n,o),p[Po]=b,p[ts]=o}function r_(n){for(var o=n.attributes;o.length;)n.removeAttributeNode(o[0]);ks(n)}function Vy(n){return typeof n.getRootNode=="function"?n.getRootNode():n.nodeType===9?n:n.ownerDocument}function i0(n,o,p){var b=Kr;if(b&&typeof o=="string"&&o){var O=zn(o);O='link[rel="'+n+'"][href="'+O+'"]',typeof p=="string"&&(O+='[crossorigin="'+p+'"]'),lr.has(O)||(lr.add(O),n={rel:n,crossOrigin:p,href:o},b.querySelector(O)===null&&(o=b.createElement("link"),kt(o,"link",n),it(o),b.head.appendChild(o)))}}function o0(n,o,p,b){var O=(O=Ch.current)?Vy(O):null;if(!O)throw Error('"resourceRoot" was expected to exist. This is a bug in React.');switch(n){case"meta":case"title":return null;case"style":return typeof p.precedence=="string"&&typeof p.href=="string"?(p=Hf(p.href),o=xe(O).hoistableStyles,b=o.get(p),b||(b={type:"style",instance:null,count:0,state:null},o.set(p,b)),b):{type:"void",instance:null,count:0,state:null};case"link":if(p.rel==="stylesheet"&&typeof p.href=="string"&&typeof p.precedence=="string"){n=Hf(p.href);var z=xe(O).hoistableStyles,W=z.get(n);if(!W&&(O=O.ownerDocument||O,W={type:"stylesheet",instance:null,count:0,state:{loading:Vn,preload:null}},z.set(n,W),(z=O.querySelector(Bm(n)))&&!z._p&&(W.instance=z,W.state.loading=Fn|mr),!wn.has(n))){var oe={rel:"preload",as:"style",href:p.href,crossOrigin:p.crossOrigin,integrity:p.integrity,media:p.media,hrefLang:p.hrefLang,referrerPolicy:p.referrerPolicy};wn.set(n,oe),z||_b(O,n,oe,W.state)}if(o&&b===null)throw p=`

  - `+i_(o)+`
  + `+i_(p),Error("Expected <link> not to update to be updated to a stylesheet with precedence. Check the `rel`, `href`, and `precedence` props of this component. Alternatively, check whether two different <link> components render in the same slot or share the same key."+p);return W}if(o&&b!==null)throw p=`

  - `+i_(o)+`
  + `+i_(p),Error("Expected stylesheet with precedence to not be updated to a different kind of <link>. Check the `rel`, `href`, and `precedence` props of this component. Alternatively, check whether two different <link> components render in the same slot or share the same key."+p);return null;case"script":return o=p.async,p=p.src,typeof p=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(p=Eh(p),o=xe(O).hoistableScripts,b=o.get(p),b||(b={type:"script",instance:null,count:0,state:null},o.set(p,b)),b):{type:"void",instance:null,count:0,state:null};default:throw Error('getResource encountered a type it did not expect: "'+n+'". this is a bug in React.')}}function i_(n){var o=0,p="<link";return typeof n.rel=="string"?(o++,p+=' rel="'+n.rel+'"'):_d.call(n,"rel")&&(o++,p+=' rel="'+(n.rel===null?"null":"invalid type "+typeof n.rel)+'"'),typeof n.href=="string"?(o++,p+=' href="'+n.href+'"'):_d.call(n,"href")&&(o++,p+=' href="'+(n.href===null?"null":"invalid type "+typeof n.href)+'"'),typeof n.precedence=="string"?(o++,p+=' precedence="'+n.precedence+'"'):_d.call(n,"precedence")&&(o++,p+=" precedence={"+(n.precedence===null?"null":"invalid type "+typeof n.precedence)+"}"),Object.getOwnPropertyNames(n).length>o&&(p+=" ..."),p+" />"}function Hf(n){return'href="'+zn(n)+'"'}function Bm(n){return'link[rel="stylesheet"]['+n+"]"}function s0(n){return Fr({},n,{"data-precedence":n.precedence,precedence:null})}function _b(n,o,p,b){n.querySelector('link[rel="preload"][as="style"]['+o+"]")?b.loading=Fn:(o=n.createElement("link"),b.preload=o,o.addEventListener("load",function(){return b.loading|=Fn}),o.addEventListener("error",function(){return b.loading|=nr}),kt(o,"link",p),it(o),n.head.appendChild(o))}function Eh(n){return'[src="'+zn(n)+'"]'}function jl(n){return"script[async]"+n}function So(n,o,p){if(o.count++,o.instance===null)switch(o.type){case"style":var b=n.querySelector('style[data-href~="'+zn(p.href)+'"]');if(b)return o.instance=b,it(b),b;var O=Fr({},p,{"data-href":p.href,"data-precedence":p.precedence,href:null,precedence:null});return b=(n.ownerDocument||n).createElement("style"),it(b),kt(b,"style",O),o_(b,p.precedence,n),o.instance=b;case"stylesheet":O=Hf(p.href);var z=n.querySelector(Bm(O));if(z)return o.state.loading|=mr,o.instance=z,it(z),z;b=s0(p),(O=wn.get(O))&&Gf(b,O),z=(n.ownerDocument||n).createElement("link"),it(z);var W=z;return W._p=new Promise(function(oe,Ce){W.onload=oe,W.onerror=Ce}),kt(z,"link",b),o.state.loading|=mr,o_(z,p.precedence,n),o.instance=z;case"script":return z=Eh(p.src),(O=n.querySelector(jl(z)))?(o.instance=O,it(O),O):(b=p,(O=wn.get(z))&&(b=Fr({},p),a0(b,O)),n=n.ownerDocument||n,O=n.createElement("script"),it(O),kt(O,"link",b),n.head.appendChild(O),o.instance=O);case"void":return null;default:throw Error('acquireResource encountered a resource type it did not expect: "'+o.type+'". this is a bug in React.')}else o.type==="stylesheet"&&(o.state.loading&mr)===Vn&&(b=o.instance,o.state.loading|=mr,o_(b,p.precedence,n));return o.instance}function o_(n,o,p){for(var b=p.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),O=b.length?b[b.length-1]:null,z=O,W=0;W<b.length;W++){var oe=b[W];if(oe.dataset.precedence===o)z=oe;else if(z!==O)break}z?z.parentNode.insertBefore(n,z.nextSibling):(o=p.nodeType===9?p.head:p,o.insertBefore(n,o.firstChild))}function Gf(n,o){n.crossOrigin==null&&(n.crossOrigin=o.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=o.referrerPolicy),n.title==null&&(n.title=o.title)}function a0(n,o){n.crossOrigin==null&&(n.crossOrigin=o.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=o.referrerPolicy),n.integrity==null&&(n.integrity=o.integrity)}function yb(n,o,p){if(di===null){var b=new Map,O=di=new Map;O.set(p,b)}else O=di,b=O.get(p),b||(b=new Map,O.set(p,b));if(b.has(n))return b;for(b.set(n,null),p=p.getElementsByTagName(n),O=0;O<p.length;O++){var z=p[O];if(!(z[$m]||z[Po]||n==="link"&&z.getAttribute("rel")==="stylesheet")&&z.namespaceURI!==Wm){var W=z.getAttribute(o)||"";W=n+W;var oe=b.get(W);oe?oe.push(z):b.set(W,[z])}}return b}function vb(n,o,p){n=n.ownerDocument||n,n.head.insertBefore(p,o==="title"?n.querySelector("head > title"):null)}function Jw(n,o,p){var b=!p.ancestorInfo.containerTagInScope;if(p.context===vt||o.itemProp!=null)return!b||o.itemProp==null||n!=="meta"&&n!=="title"&&n!=="style"&&n!=="link"&&n!=="script"||console.error("Cannot render a <%s> outside the main document if it has an `itemProp` prop. `itemProp` suggests the tag belongs to an `itemScope` which can appear anywhere in the DOM. If you were intending for React to hoist this <%s> remove the `itemProp` prop. Otherwise, try moving this tag into the <head> or <body> of the Document.",n,n),!1;switch(n){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href===""){b&&console.error('Cannot render a <style> outside the main document without knowing its precedence and a unique href key. React can hoist and deduplicate <style> tags if you provide a `precedence` prop along with an `href` prop that does not conflict with the `href` values used in any other hoisted <style> or <link rel="stylesheet" ...> tags.  Note that hoisting <style> tags is considered an advanced feature that most will not use directly. Consider moving the <style> tag to the <head> or consider adding a `precedence="default"` and `href="some unique resource identifier"`.');break}return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError){if(o.rel==="stylesheet"&&typeof o.precedence=="string"){n=o.href;var O=o.onError,z=o.disabled;p=[],o.onLoad&&p.push("`onLoad`"),O&&p.push("`onError`"),z!=null&&p.push("`disabled`"),O=ci(p,"and"),O+=p.length===1?" prop":" props",z=p.length===1?"an "+O:"the "+O,p.length&&console.error('React encountered a <link rel="stylesheet" href="%s" ... /> with a `precedence` prop that also included %s. The presence of loading and error handlers indicates an intent to manage the stylesheet loading state from your from your Component code and React will not hoist or deduplicate this stylesheet. If your intent was to have React hoist and deduplciate this stylesheet using the `precedence` prop remove the %s, otherwise remove the `precedence` prop.',n,z,O)}b&&(typeof o.rel!="string"||typeof o.href!="string"||o.href===""?console.error("Cannot render a <link> outside the main document without a `rel` and `href` prop. Try adding a `rel` and/or `href` prop to this <link> or moving the link into the <head> tag"):(o.onError||o.onLoad)&&console.error("Cannot render a <link> with onLoad or onError listeners outside the main document. Try removing onLoad={...} and onError={...} or moving it into the root <head> tag or somewhere in the <body>."));break}switch(o.rel){case"stylesheet":return n=o.precedence,o=o.disabled,typeof n!="string"&&b&&console.error('Cannot render a <link rel="stylesheet" /> outside the main document without knowing its precedence. Consider adding precedence="default" or moving it into the root <head> tag.'),typeof n=="string"&&o==null;default:return!0}case"script":if(n=o.async&&typeof o.async!="function"&&typeof o.async!="symbol",!n||o.onLoad||o.onError||!o.src||typeof o.src!="string"){b&&(n?o.onLoad||o.onError?console.error("Cannot render a <script> with onLoad or onError listeners outside the main document. Try removing onLoad={...} and onError={...} or moving it into the root <head> tag or somewhere in the <body>."):console.error("Cannot render a <script> outside the main document without `async={true}` and a non-empty `src` prop. Ensure there is a valid `src` and either make the script async or move it into the root <head> tag or somewhere in the <body>."):console.error('Cannot render a sync or defer <script> outside the main document without knowing its order. Try adding async="" or moving it into the root <head> tag.'));break}return!0;case"noscript":case"template":b&&console.error("Cannot render <%s> outside the main document. Try moving it into the root <head> tag.",n)}return!1}function Fm(n){return!(n.type==="stylesheet"&&(n.state.loading&pr)===Vn)}function xb(){}function $f(n,o,p){if(hi===null)throw Error("Internal React Error: suspendedState null when it was expected to exists. Please report this as a React bug.");var b=hi;if(o.type==="stylesheet"&&(typeof p.media!="string"||matchMedia(p.media).matches!==!1)&&(o.state.loading&mr)===Vn){if(o.instance===null){var O=Hf(p.href),z=n.querySelector(Bm(O));if(z){n=z._p,n!==null&&typeof n=="object"&&typeof n.then=="function"&&(b.count++,b=qy.bind(b),n.then(b,b)),o.state.loading|=mr,o.instance=z,it(z);return}z=n.ownerDocument||n,p=s0(p),(O=wn.get(O))&&Gf(p,O),z=z.createElement("link"),it(z);var W=z;W._p=new Promise(function(oe,Ce){W.onload=oe,W.onerror=Ce}),kt(z,"link",p),o.instance=z}b.stylesheets===null&&(b.stylesheets=new Map),b.stylesheets.set(o,n),(n=o.state.preload)&&(o.state.loading&pr)===Vn&&(b.count++,o=qy.bind(b),n.addEventListener("load",o),n.addEventListener("error",o))}}function s_(){if(hi===null)throw Error("Internal React Error: suspendedState null when it was expected to exists. Please report this as a React bug.");var n=hi;return n.stylesheets&&n.count===0&&l0(n,n.stylesheets),0<n.count?function(o){var p=setTimeout(function(){if(n.stylesheets&&l0(n,n.stylesheets),n.unsuspend){var b=n.unsuspend;n.unsuspend=null,b()}},6e4);return n.unsuspend=o,function(){n.unsuspend=null,clearTimeout(p)}}:null}function qy(){if(this.count--,this.count===0){if(this.stylesheets)l0(this,this.stylesheets);else if(this.unsuspend){var n=this.unsuspend;this.unsuspend=null,n()}}}function l0(n,o){n.stylesheets=null,n.unsuspend!==null&&(n.count++,ji=new Map,o.forEach(Qw,n),ji=null,qy.call(n))}function Qw(n,o){if(!(o.state.loading&mr)){var p=ji.get(n);if(p)var b=p.get(zr);else{p=new Map,ji.set(n,p);for(var O=n.querySelectorAll("link[data-precedence],style[data-precedence]"),z=0;z<O.length;z++){var W=O[z];(W.nodeName==="LINK"||W.getAttribute("media")!=="not all")&&(p.set(W.dataset.precedence,W),b=W)}b&&p.set(zr,b)}O=o.instance,W=O.getAttribute("data-precedence"),z=p.get(W)||b,z===b&&p.set(zr,O),p.set(W,O),this.count++,b=qy.bind(this),O.addEventListener("load",b),O.addEventListener("error",b),z?z.parentNode.insertBefore(O,z.nextSibling):(n=n.nodeType===9?n.head:n,n.insertBefore(O,n.firstChild)),o.state.loading|=mr}}function eS(n,o,p,b,O,z,W,oe){for(this.tag=1,this.containerInfo=n,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=an,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Rs(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Rs(0),this.hiddenUpdates=Rs(null),this.identifierPrefix=b,this.onUncaughtError=O,this.onCaughtError=z,this.onRecoverableError=W,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=oe,this.incompleteTransitions=new Map,this.passiveEffectDuration=this.effectDuration=-0,this.memoizedUpdaters=new Set,n=this.pendingUpdatersLaneMap=[],o=0;31>o;o++)n.push(new Set);this._debugRootType=p?"hydrateRoot()":"createRoot()"}function bb(n,o,p,b,O,z,W,oe,Ce,Be,Dt,Ft){return n=new eS(n,o,p,W,oe,Ce,Be,Ft),o=Tv,z===!0&&(o|=Ys|Ws),Hl&&(o|=ws),z=le(3,null,null,o),n.current=z,z.stateNode=n,o=_f(),Hc(o),n.pooledCache=o,Hc(o),z.memoizedState={element:b,isDehydrated:p,cache:o},el(z),n}function wb(n){return n?(n=Yl,n):Yl}function c0(n,o,p,b,O,z){if(Gs&&typeof Gs.onScheduleFiberRoot=="function")try{Gs.onScheduleFiberRoot(Kf,b,p)}catch(W){Cc||(Cc=!0,console.error("React instrumentation encountered an error: %s",W))}Ln!==null&&typeof Ln.markRenderScheduled=="function"&&Ln.markRenderScheduled(o),O=wb(O),b.context===null?b.context=O:b.pendingContext=O,pu&&fl!==null&&!vl&&(vl=!0,console.error(`Render methods should be a pure function of props and state; triggering nested component updates from render is not allowed. If necessary, trigger nested updates in componentDidUpdate.

Check the render method of %s.`,Ut(fl)||"Unknown")),b=ua(o),b.payload={element:p},z=z===void 0?null:z,z!==null&&(typeof z!="function"&&console.error("Expected the last optional `callback` argument to be a function. Instead received: %s.",z),b.callback=z),p=Ol(n,b,o),p!==null&&(Ei(p,n,o),$c(p,n,o))}function Hy(n,o){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var p=n.retryLane;n.retryLane=p!==0&&p<o?p:o}}function u0(n,o){Hy(n,o),(n=n.alternate)&&Hy(n,o)}function Zf(n){if(n.tag===13){var o=Io(n,67108864);o!==null&&Ei(o,n,67108864),u0(n,67108864)}}function tS(){return fl}function oo(){for(var n=new Map,o=1,p=0;31>p;p++){var b=cs(o);n.set(o,b),o*=2}return n}function Gy(n,o,p,b){var O=Pt.T;Pt.T=null;var z=yi.p;try{yi.p=Gl,Um(n,o,p,b)}finally{yi.p=z,Pt.T=O}}function Sb(n,o,p,b){var O=Pt.T;Pt.T=null;var z=yi.p;try{yi.p=fu,Um(n,o,p,b)}finally{yi.p=z,Pt.T=O}}function Um(n,o,p,b){if(ry){var O=jm(b);if(O===null)ze(n,o,b,iy,p),h0(n,b);else if(f0(O,n,o,p,b))b.stopPropagation();else if(h0(n,b),o&4&&-1<Fx.indexOf(n)){for(;O!==null;){var z=qi(O);if(z!==null)switch(z.tag){case 3:if(z=z.stateNode,z.current.memoizedState.isDehydrated){var W=ti(z.pendingLanes);if(W!==0){var oe=z;for(oe.pendingLanes|=2,oe.entangledLanes|=2;W;){var Ce=1<<31-$s(W);oe.entanglements[1]|=Ce,W&=~Ce}R(z),(Ai&(Xs|Nc))===Na&&(Fv=hl()+J_,N(0))}}break;case 13:oe=Io(z,2),oe!==null&&Ei(oe,z,2),xh(),u0(z,2)}if(z=jm(b),z===null&&ze(n,o,b,iy,p),z===O)break;O=z}O!==null&&b.stopPropagation()}else ze(n,o,b,null,p)}}function jm(n){return n=Ns(n),Yf(n)}function Yf(n){if(iy=null,n=jo(n),n!==null){var o=We(n);if(o===null)n=null;else{var p=o.tag;if(p===13){if(n=Tt(o),n!==null)return n;n=null}else if(p===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;n=null}else o!==n&&(n=null)}}return iy=n,null}function d0(n){switch(n){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return Gl;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return fu;case"message":switch(Db()){case Qy:return Gl;case Hm:return fu;case Xf:case ev:return yd;case tv:return m_;default:return yd}default:return yd}}function h0(n,o){switch(n){case"focusin":case"focusout":bu=null;break;case"dragenter":case"dragleave":Cs=null;break;case"mouseover":case"mouseout":Pd=null;break;case"pointerover":case"pointerout":Pc.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":kp.delete(o.pointerId)}}function md(n,o,p,b,O,z){return n===null||n.nativeEvent!==z?(n={blockedOn:o,domEventName:p,eventSystemFlags:b,nativeEvent:z,targetContainers:[O]},o!==null&&(o=qi(o),o!==null&&Zf(o)),n):(n.eventSystemFlags|=b,o=n.targetContainers,O!==null&&o.indexOf(O)===-1&&o.push(O),n)}function f0(n,o,p,b,O){switch(o){case"focusin":return bu=md(bu,n,o,p,b,O),!0;case"dragenter":return Cs=md(Cs,n,o,p,b,O),!0;case"mouseover":return Pd=md(Pd,n,o,p,b,O),!0;case"pointerover":var z=O.pointerId;return Pc.set(z,md(Pc.get(z)||null,n,o,p,b,O)),!0;case"gotpointercapture":return z=O.pointerId,kp.set(z,md(kp.get(z)||null,n,o,p,b,O)),!0}return!1}function a_(n){var o=jo(n.target);if(o!==null){var p=We(o);if(p!==null){if(o=p.tag,o===13){if(o=Tt(p),o!==null){n.blockedOn=o,bl(n.priority,function(){if(p.tag===13){var b=$o(p);b=Ua(b);var O=Io(p,b);O!==null&&Ei(O,p,b),u0(p,b)}});return}}else if(o===3&&p.stateNode.current.memoizedState.isDehydrated){n.blockedOn=p.tag===3?p.stateNode.containerInfo:null;return}}}n.blockedOn=null}function $y(n){if(n.blockedOn!==null)return!1;for(var o=n.targetContainers;0<o.length;){var p=jm(n.nativeEvent);if(p===null){p=n.nativeEvent;var b=new p.constructor(p.type,p),O=b;v_!==null&&console.error("Expected currently replaying event to be null. This error is likely caused by a bug in React. Please file an issue."),v_=O,p.target.dispatchEvent(b),v_===null&&console.error("Expected currently replaying event to not be null. This error is likely caused by a bug in React. Please file an issue."),v_=null}else return o=qi(p),o!==null&&Zf(o),n.blockedOn=p,!1;o.shift()}return!0}function p0(n,o,p){$y(n)&&p.delete(o)}function m0(){oy=!1,bu!==null&&$y(bu)&&(bu=null),Cs!==null&&$y(Cs)&&(Cs=null),Pd!==null&&$y(Pd)&&(Pd=null),Pc.forEach(p0),kp.forEach(p0)}function Vm(n,o){n.blockedOn===o&&(n.blockedOn=null,oy||(oy=!0,To.unstable_scheduleCallback(To.unstable_NormalPriority,m0)))}function Zy(n){Lc!==n&&(Lc=n,To.unstable_scheduleCallback(To.unstable_NormalPriority,function(){Lc===n&&(Lc=null);for(var o=0;o<n.length;o+=3){var p=n[o],b=n[o+1],O=n[o+2];if(typeof b!="function"){if(Yf(b||p)===null)continue;break}var z=qi(p);z!==null&&(n.splice(o,3),o-=3,p={pending:!0,data:O,method:p.method,action:b},Object.freeze(p),Of(z,p,b,O))}}))}function qm(n){function o(Ce){return Vm(Ce,n)}bu!==null&&Vm(bu,n),Cs!==null&&Vm(Cs,n),Pd!==null&&Vm(Pd,n),Pc.forEach(o),kp.forEach(o);for(var p=0;p<wu.length;p++){var b=wu[p];b.blockedOn===n&&(b.blockedOn=null)}for(;0<wu.length&&(p=wu[0],p.blockedOn===null);)a_(p),p.blockedOn===null&&wu.shift();if(p=(n.ownerDocument||n).$$reactFormReplay,p!=null)for(b=0;b<p.length;b+=3){var O=p[b],z=p[b+1],W=O[ts]||null;if(typeof z=="function")W||Zy(p);else if(W){var oe=null;if(z&&z.hasAttribute("formAction")){if(O=z,W=z[ts]||null)oe=W.formAction;else if(Yf(O)!==null)continue}else oe=W.action;typeof oe=="function"?p[b+1]=oe:(p.splice(b,3),b-=3),Zy(p)}}}function l_(n){this._internalRoot=n}function c_(n){this._internalRoot=n}function Yy(n){n[Dc]&&(n._reactRootContainer?console.error("You are calling ReactDOMClient.createRoot() on a container that was previously passed to ReactDOM.render(). This is not supported."):console.error("You are calling ReactDOMClient.createRoot() on a container that has already been passed to createRoot() before. Instead, call root.render() on the existing root instead if you want to update it."))}typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var To=nM(),Wy=Zv(),Xy=yA(),Fr=Object.assign,Tb=Symbol.for("react.element"),gd=Symbol.for("react.transitional.element"),ul=Symbol.for("react.portal"),Vl=Symbol.for("react.fragment"),u_=Symbol.for("react.strict_mode"),g0=Symbol.for("react.profiler"),Eb=Symbol.for("react.provider"),_0=Symbol.for("react.consumer"),du=Symbol.for("react.context"),dl=Symbol.for("react.forward_ref"),d_=Symbol.for("react.suspense"),y0=Symbol.for("react.suspense_list"),h_=Symbol.for("react.memo"),Wo=Symbol.for("react.lazy"),v0=Symbol.for("react.activity"),Ac=Symbol.for("react.memo_cache_sentinel"),Ky=Symbol.iterator,x0=Symbol.for("react.client.reference"),es=Array.isArray,Pt=Wy.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,yi=Xy.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Ab=Object.freeze({pending:!1,data:null,method:null,action:null}),f_=[],ql=[],hu=-1,Ah=Yt(null),p_=Yt(null),Ch=Yt(null),Jy=Yt(null),_d=Object.prototype.hasOwnProperty,b0=To.unstable_scheduleCallback,nS=To.unstable_cancelCallback,Wf=To.unstable_shouldYield,Cb=To.unstable_requestPaint,hl=To.unstable_now,Db=To.unstable_getCurrentPriorityLevel,Qy=To.unstable_ImmediatePriority,Hm=To.unstable_UserBlockingPriority,Xf=To.unstable_NormalPriority,ev=To.unstable_LowPriority,tv=To.unstable_IdlePriority,w0=To.log,S0=To.unstable_setDisableYieldValue,Kf=null,Gs=null,Ln=null,Cc=!1,Hl=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u",$s=Math.clz32?Math.clz32:qt,T0=Math.log,Mb=Math.LN2,Gm=256,nv=4194304,Gl=2,fu=8,yd=32,m_=268435456,ga=Math.random().toString(36).slice(2),Po="__reactFiber$"+ga,ts="__reactProps$"+ga,Dc="__reactContainer$"+ga,Jf="__reactEvents$"+ga,Rb="__reactListeners$"+ga,kb="__reactHandles$"+ga,E0="__reactResources$"+ga,$m="__reactMarker$"+ga,Ob=new Set,Qf={},rv={},iv={button:!0,checkbox:!0,image:!0,hidden:!0,radio:!0,reset:!0,submit:!0},Ib=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Nb={},A0={},ep=0,C0,D0,M0,R0,k0,zb,O0;ia.__reactDisabledLog=!0;var ov,Zm,sv=!1,av=new(typeof WeakMap=="function"?WeakMap:Map),fl=null,pu=!1,rS=/[\n"\\]/g,Pb=!1,Lb=!1,Bb=!1,Fb=!1,I0=!1,Ub=!1,jb=["value","defaultValue"],Vb=!1,lv=/["'&<>\n\t]|^\s|\s$/,N0="address applet area article aside base basefont bgsound blockquote body br button caption center col colgroup dd details dir div dl dt embed fieldset figcaption figure footer form frame frameset h1 h2 h3 h4 h5 h6 head header hgroup hr html iframe img input isindex li link listing main marquee menu menuitem meta nav noembed noframes noscript object ol p param plaintext pre script section select source style summary table tbody td template textarea tfoot th thead title tr track ul wbr xmp".split(" "),z0="applet caption html table td th marquee object template foreignObject desc title".split(" "),qb=z0.concat(["button"]),Hb="dd dt li option optgroup p rp rt".split(" "),P0={current:null,formTag:null,aTagInScope:null,buttonTagInScope:null,nobrTagInScope:null,pTagInButtonScope:null,listItemTagAutoclosing:null,dlItemTagAutoclosing:null,containerTagInScope:null,implicitRootScope:!1},g_={},cv={animation:"animationDelay animationDirection animationDuration animationFillMode animationIterationCount animationName animationPlayState animationTimingFunction".split(" "),background:"backgroundAttachment backgroundClip backgroundColor backgroundImage backgroundOrigin backgroundPositionX backgroundPositionY backgroundRepeat backgroundSize".split(" "),backgroundPosition:["backgroundPositionX","backgroundPositionY"],border:"borderBottomColor borderBottomStyle borderBottomWidth borderImageOutset borderImageRepeat borderImageSlice borderImageSource borderImageWidth borderLeftColor borderLeftStyle borderLeftWidth borderRightColor borderRightStyle borderRightWidth borderTopColor borderTopStyle borderTopWidth".split(" "),borderBlockEnd:["borderBlockEndColor","borderBlockEndStyle","borderBlockEndWidth"],borderBlockStart:["borderBlockStartColor","borderBlockStartStyle","borderBlockStartWidth"],borderBottom:["borderBottomColor","borderBottomStyle","borderBottomWidth"],borderColor:["borderBottomColor","borderLeftColor","borderRightColor","borderTopColor"],borderImage:["borderImageOutset","borderImageRepeat","borderImageSlice","borderImageSource","borderImageWidth"],borderInlineEnd:["borderInlineEndColor","borderInlineEndStyle","borderInlineEndWidth"],borderInlineStart:["borderInlineStartColor","borderInlineStartStyle","borderInlineStartWidth"],borderLeft:["borderLeftColor","borderLeftStyle","borderLeftWidth"],borderRadius:["borderBottomLeftRadius","borderBottomRightRadius","borderTopLeftRadius","borderTopRightRadius"],borderRight:["borderRightColor","borderRightStyle","borderRightWidth"],borderStyle:["borderBottomStyle","borderLeftStyle","borderRightStyle","borderTopStyle"],borderTop:["borderTopColor","borderTopStyle","borderTopWidth"],borderWidth:["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth"],columnRule:["columnRuleColor","columnRuleStyle","columnRuleWidth"],columns:["columnCount","columnWidth"],flex:["flexBasis","flexGrow","flexShrink"],flexFlow:["flexDirection","flexWrap"],font:"fontFamily fontFeatureSettings fontKerning fontLanguageOverride fontSize fontSizeAdjust fontStretch fontStyle fontVariant fontVariantAlternates fontVariantCaps fontVariantEastAsian fontVariantLigatures fontVariantNumeric fontVariantPosition fontWeight lineHeight".split(" "),fontVariant:"fontVariantAlternates fontVariantCaps fontVariantEastAsian fontVariantLigatures fontVariantNumeric fontVariantPosition".split(" "),gap:["columnGap","rowGap"],grid:"gridAutoColumns gridAutoFlow gridAutoRows gridTemplateAreas gridTemplateColumns gridTemplateRows".split(" "),gridArea:["gridColumnEnd","gridColumnStart","gridRowEnd","gridRowStart"],gridColumn:["gridColumnEnd","gridColumnStart"],gridColumnGap:["columnGap"],gridGap:["columnGap","rowGap"],gridRow:["gridRowEnd","gridRowStart"],gridRowGap:["rowGap"],gridTemplate:["gridTemplateAreas","gridTemplateColumns","gridTemplateRows"],listStyle:["listStyleImage","listStylePosition","listStyleType"],margin:["marginBottom","marginLeft","marginRight","marginTop"],marker:["markerEnd","markerMid","markerStart"],mask:"maskClip maskComposite maskImage maskMode maskOrigin maskPositionX maskPositionY maskRepeat maskSize".split(" "),maskPosition:["maskPositionX","maskPositionY"],outline:["outlineColor","outlineStyle","outlineWidth"],overflow:["overflowX","overflowY"],padding:["paddingBottom","paddingLeft","paddingRight","paddingTop"],placeContent:["alignContent","justifyContent"],placeItems:["alignItems","justifyItems"],placeSelf:["alignSelf","justifySelf"],textDecoration:["textDecorationColor","textDecorationLine","textDecorationStyle"],textEmphasis:["textEmphasisColor","textEmphasisStyle"],transition:["transitionDelay","transitionDuration","transitionProperty","transitionTimingFunction"],wordWrap:["overflowWrap"]},L0=/([A-Z])/g,B0=/^ms-/,F0=/^(?:webkit|moz|o)[A-Z]/,Gb=/^-ms-/,iS=/-(.)/g,Ym=/;\s*$/,tp={},U0={},$b=!1,Zb=!1,Yb=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" ")),uv="http://www.w3.org/1998/Math/MathML",Wm="http://www.w3.org/2000/svg",oS=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),__={accept:"accept",acceptcharset:"acceptCharset","accept-charset":"acceptCharset",accesskey:"accessKey",action:"action",allowfullscreen:"allowFullScreen",alt:"alt",as:"as",async:"async",autocapitalize:"autoCapitalize",autocomplete:"autoComplete",autocorrect:"autoCorrect",autofocus:"autoFocus",autoplay:"autoPlay",autosave:"autoSave",capture:"capture",cellpadding:"cellPadding",cellspacing:"cellSpacing",challenge:"challenge",charset:"charSet",checked:"checked",children:"children",cite:"cite",class:"className",classid:"classID",classname:"className",cols:"cols",colspan:"colSpan",content:"content",contenteditable:"contentEditable",contextmenu:"contextMenu",controls:"controls",controlslist:"controlsList",coords:"coords",crossorigin:"crossOrigin",dangerouslysetinnerhtml:"dangerouslySetInnerHTML",data:"data",datetime:"dateTime",default:"default",defaultchecked:"defaultChecked",defaultvalue:"defaultValue",defer:"defer",dir:"dir",disabled:"disabled",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback",download:"download",draggable:"draggable",enctype:"encType",enterkeyhint:"enterKeyHint",fetchpriority:"fetchPriority",for:"htmlFor",form:"form",formmethod:"formMethod",formaction:"formAction",formenctype:"formEncType",formnovalidate:"formNoValidate",formtarget:"formTarget",frameborder:"frameBorder",headers:"headers",height:"height",hidden:"hidden",high:"high",href:"href",hreflang:"hrefLang",htmlfor:"htmlFor",httpequiv:"httpEquiv","http-equiv":"httpEquiv",icon:"icon",id:"id",imagesizes:"imageSizes",imagesrcset:"imageSrcSet",inert:"inert",innerhtml:"innerHTML",inputmode:"inputMode",integrity:"integrity",is:"is",itemid:"itemID",itemprop:"itemProp",itemref:"itemRef",itemscope:"itemScope",itemtype:"itemType",keyparams:"keyParams",keytype:"keyType",kind:"kind",label:"label",lang:"lang",list:"list",loop:"loop",low:"low",manifest:"manifest",marginwidth:"marginWidth",marginheight:"marginHeight",max:"max",maxlength:"maxLength",media:"media",mediagroup:"mediaGroup",method:"method",min:"min",minlength:"minLength",multiple:"multiple",muted:"muted",name:"name",nomodule:"noModule",nonce:"nonce",novalidate:"noValidate",open:"open",optimum:"optimum",pattern:"pattern",placeholder:"placeholder",playsinline:"playsInline",poster:"poster",preload:"preload",profile:"profile",radiogroup:"radioGroup",readonly:"readOnly",referrerpolicy:"referrerPolicy",rel:"rel",required:"required",reversed:"reversed",role:"role",rows:"rows",rowspan:"rowSpan",sandbox:"sandbox",scope:"scope",scoped:"scoped",scrolling:"scrolling",seamless:"seamless",selected:"selected",shape:"shape",size:"size",sizes:"sizes",span:"span",spellcheck:"spellCheck",src:"src",srcdoc:"srcDoc",srclang:"srcLang",srcset:"srcSet",start:"start",step:"step",style:"style",summary:"summary",tabindex:"tabIndex",target:"target",title:"title",type:"type",usemap:"useMap",value:"value",width:"width",wmode:"wmode",wrap:"wrap",about:"about",accentheight:"accentHeight","accent-height":"accentHeight",accumulate:"accumulate",additive:"additive",alignmentbaseline:"alignmentBaseline","alignment-baseline":"alignmentBaseline",allowreorder:"allowReorder",alphabetic:"alphabetic",amplitude:"amplitude",arabicform:"arabicForm","arabic-form":"arabicForm",ascent:"ascent",attributename:"attributeName",attributetype:"attributeType",autoreverse:"autoReverse",azimuth:"azimuth",basefrequency:"baseFrequency",baselineshift:"baselineShift","baseline-shift":"baselineShift",baseprofile:"baseProfile",bbox:"bbox",begin:"begin",bias:"bias",by:"by",calcmode:"calcMode",capheight:"capHeight","cap-height":"capHeight",clip:"clip",clippath:"clipPath","clip-path":"clipPath",clippathunits:"clipPathUnits",cliprule:"clipRule","clip-rule":"clipRule",color:"color",colorinterpolation:"colorInterpolation","color-interpolation":"colorInterpolation",colorinterpolationfilters:"colorInterpolationFilters","color-interpolation-filters":"colorInterpolationFilters",colorprofile:"colorProfile","color-profile":"colorProfile",colorrendering:"colorRendering","color-rendering":"colorRendering",contentscripttype:"contentScriptType",contentstyletype:"contentStyleType",cursor:"cursor",cx:"cx",cy:"cy",d:"d",datatype:"datatype",decelerate:"decelerate",descent:"descent",diffuseconstant:"diffuseConstant",direction:"direction",display:"display",divisor:"divisor",dominantbaseline:"dominantBaseline","dominant-baseline":"dominantBaseline",dur:"dur",dx:"dx",dy:"dy",edgemode:"edgeMode",elevation:"elevation",enablebackground:"enableBackground","enable-background":"enableBackground",end:"end",exponent:"exponent",externalresourcesrequired:"externalResourcesRequired",fill:"fill",fillopacity:"fillOpacity","fill-opacity":"fillOpacity",fillrule:"fillRule","fill-rule":"fillRule",filter:"filter",filterres:"filterRes",filterunits:"filterUnits",floodopacity:"floodOpacity","flood-opacity":"floodOpacity",floodcolor:"floodColor","flood-color":"floodColor",focusable:"focusable",fontfamily:"fontFamily","font-family":"fontFamily",fontsize:"fontSize","font-size":"fontSize",fontsizeadjust:"fontSizeAdjust","font-size-adjust":"fontSizeAdjust",fontstretch:"fontStretch","font-stretch":"fontStretch",fontstyle:"fontStyle","font-style":"fontStyle",fontvariant:"fontVariant","font-variant":"fontVariant",fontweight:"fontWeight","font-weight":"fontWeight",format:"format",from:"from",fx:"fx",fy:"fy",g1:"g1",g2:"g2",glyphname:"glyphName","glyph-name":"glyphName",glyphorientationhorizontal:"glyphOrientationHorizontal","glyph-orientation-horizontal":"glyphOrientationHorizontal",glyphorientationvertical:"glyphOrientationVertical","glyph-orientation-vertical":"glyphOrientationVertical",glyphref:"glyphRef",gradienttransform:"gradientTransform",gradientunits:"gradientUnits",hanging:"hanging",horizadvx:"horizAdvX","horiz-adv-x":"horizAdvX",horizoriginx:"horizOriginX","horiz-origin-x":"horizOriginX",ideographic:"ideographic",imagerendering:"imageRendering","image-rendering":"imageRendering",in2:"in2",in:"in",inlist:"inlist",intercept:"intercept",k1:"k1",k2:"k2",k3:"k3",k4:"k4",k:"k",kernelmatrix:"kernelMatrix",kernelunitlength:"kernelUnitLength",kerning:"kerning",keypoints:"keyPoints",keysplines:"keySplines",keytimes:"keyTimes",lengthadjust:"lengthAdjust",letterspacing:"letterSpacing","letter-spacing":"letterSpacing",lightingcolor:"lightingColor","lighting-color":"lightingColor",limitingconeangle:"limitingConeAngle",local:"local",markerend:"markerEnd","marker-end":"markerEnd",markerheight:"markerHeight",markermid:"markerMid","marker-mid":"markerMid",markerstart:"markerStart","marker-start":"markerStart",markerunits:"markerUnits",markerwidth:"markerWidth",mask:"mask",maskcontentunits:"maskContentUnits",maskunits:"maskUnits",mathematical:"mathematical",mode:"mode",numoctaves:"numOctaves",offset:"offset",opacity:"opacity",operator:"operator",order:"order",orient:"orient",orientation:"orientation",origin:"origin",overflow:"overflow",overlineposition:"overlinePosition","overline-position":"overlinePosition",overlinethickness:"overlineThickness","overline-thickness":"overlineThickness",paintorder:"paintOrder","paint-order":"paintOrder",panose1:"panose1","panose-1":"panose1",pathlength:"pathLength",patterncontentunits:"patternContentUnits",patterntransform:"patternTransform",patternunits:"patternUnits",pointerevents:"pointerEvents","pointer-events":"pointerEvents",points:"points",pointsatx:"pointsAtX",pointsaty:"pointsAtY",pointsatz:"pointsAtZ",popover:"popover",popovertarget:"popoverTarget",popovertargetaction:"popoverTargetAction",prefix:"prefix",preservealpha:"preserveAlpha",preserveaspectratio:"preserveAspectRatio",primitiveunits:"primitiveUnits",property:"property",r:"r",radius:"radius",refx:"refX",refy:"refY",renderingintent:"renderingIntent","rendering-intent":"renderingIntent",repeatcount:"repeatCount",repeatdur:"repeatDur",requiredextensions:"requiredExtensions",requiredfeatures:"requiredFeatures",resource:"resource",restart:"restart",result:"result",results:"results",rotate:"rotate",rx:"rx",ry:"ry",scale:"scale",security:"security",seed:"seed",shaperendering:"shapeRendering","shape-rendering":"shapeRendering",slope:"slope",spacing:"spacing",specularconstant:"specularConstant",specularexponent:"specularExponent",speed:"speed",spreadmethod:"spreadMethod",startoffset:"startOffset",stddeviation:"stdDeviation",stemh:"stemh",stemv:"stemv",stitchtiles:"stitchTiles",stopcolor:"stopColor","stop-color":"stopColor",stopopacity:"stopOpacity","stop-opacity":"stopOpacity",strikethroughposition:"strikethroughPosition","strikethrough-position":"strikethroughPosition",strikethroughthickness:"strikethroughThickness","strikethrough-thickness":"strikethroughThickness",string:"string",stroke:"stroke",strokedasharray:"strokeDasharray","stroke-dasharray":"strokeDasharray",strokedashoffset:"strokeDashoffset","stroke-dashoffset":"strokeDashoffset",strokelinecap:"strokeLinecap","stroke-linecap":"strokeLinecap",strokelinejoin:"strokeLinejoin","stroke-linejoin":"strokeLinejoin",strokemiterlimit:"strokeMiterlimit","stroke-miterlimit":"strokeMiterlimit",strokewidth:"strokeWidth","stroke-width":"strokeWidth",strokeopacity:"strokeOpacity","stroke-opacity":"strokeOpacity",suppresscontenteditablewarning:"suppressContentEditableWarning",suppresshydrationwarning:"suppressHydrationWarning",surfacescale:"surfaceScale",systemlanguage:"systemLanguage",tablevalues:"tableValues",targetx:"targetX",targety:"targetY",textanchor:"textAnchor","text-anchor":"textAnchor",textdecoration:"textDecoration","text-decoration":"textDecoration",textlength:"textLength",textrendering:"textRendering","text-rendering":"textRendering",to:"to",transform:"transform",transformorigin:"transformOrigin","transform-origin":"transformOrigin",typeof:"typeof",u1:"u1",u2:"u2",underlineposition:"underlinePosition","underline-position":"underlinePosition",underlinethickness:"underlineThickness","underline-thickness":"underlineThickness",unicode:"unicode",unicodebidi:"unicodeBidi","unicode-bidi":"unicodeBidi",unicoderange:"unicodeRange","unicode-range":"unicodeRange",unitsperem:"unitsPerEm","units-per-em":"unitsPerEm",unselectable:"unselectable",valphabetic:"vAlphabetic","v-alphabetic":"vAlphabetic",values:"values",vectoreffect:"vectorEffect","vector-effect":"vectorEffect",version:"version",vertadvy:"vertAdvY","vert-adv-y":"vertAdvY",vertoriginx:"vertOriginX","vert-origin-x":"vertOriginX",vertoriginy:"vertOriginY","vert-origin-y":"vertOriginY",vhanging:"vHanging","v-hanging":"vHanging",videographic:"vIdeographic","v-ideographic":"vIdeographic",viewbox:"viewBox",viewtarget:"viewTarget",visibility:"visibility",vmathematical:"vMathematical","v-mathematical":"vMathematical",vocab:"vocab",widths:"widths",wordspacing:"wordSpacing","word-spacing":"wordSpacing",writingmode:"writingMode","writing-mode":"writingMode",x1:"x1",x2:"x2",x:"x",xchannelselector:"xChannelSelector",xheight:"xHeight","x-height":"xHeight",xlinkactuate:"xlinkActuate","xlink:actuate":"xlinkActuate",xlinkarcrole:"xlinkArcrole","xlink:arcrole":"xlinkArcrole",xlinkhref:"xlinkHref","xlink:href":"xlinkHref",xlinkrole:"xlinkRole","xlink:role":"xlinkRole",xlinkshow:"xlinkShow","xlink:show":"xlinkShow",xlinktitle:"xlinkTitle","xlink:title":"xlinkTitle",xlinktype:"xlinkType","xlink:type":"xlinkType",xmlbase:"xmlBase","xml:base":"xmlBase",xmllang:"xmlLang","xml:lang":"xmlLang",xmlns:"xmlns","xml:space":"xmlSpace",xmlnsxlink:"xmlnsXlink","xmlns:xlink":"xmlnsXlink",xmlspace:"xmlSpace",y1:"y1",y2:"y2",y:"y",ychannelselector:"yChannelSelector",z:"z",zoomandpan:"zoomAndPan"},Wb={"aria-current":0,"aria-description":0,"aria-details":0,"aria-disabled":0,"aria-hidden":0,"aria-invalid":0,"aria-keyshortcuts":0,"aria-label":0,"aria-roledescription":0,"aria-autocomplete":0,"aria-checked":0,"aria-expanded":0,"aria-haspopup":0,"aria-level":0,"aria-modal":0,"aria-multiline":0,"aria-multiselectable":0,"aria-orientation":0,"aria-placeholder":0,"aria-pressed":0,"aria-readonly":0,"aria-required":0,"aria-selected":0,"aria-sort":0,"aria-valuemax":0,"aria-valuemin":0,"aria-valuenow":0,"aria-valuetext":0,"aria-atomic":0,"aria-busy":0,"aria-live":0,"aria-relevant":0,"aria-dropeffect":0,"aria-grabbed":0,"aria-activedescendant":0,"aria-colcount":0,"aria-colindex":0,"aria-colspan":0,"aria-controls":0,"aria-describedby":0,"aria-errormessage":0,"aria-flowto":0,"aria-labelledby":0,"aria-owns":0,"aria-posinset":0,"aria-rowcount":0,"aria-rowindex":0,"aria-rowspan":0,"aria-setsize":0},$i={},Mc=RegExp("^(aria)-[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Xb=RegExp("^(aria)[A-Z][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),dv=!1,ns={},np=/^on./,sS=/^on[^A-Z]/,aS=RegExp("^(aria)-[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),y_=RegExp("^(aria)[A-Z][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),lS=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i,v_=null,rp=null,Dh=null,hv=!1,$l=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),j0=!1;if($l)try{var Xm={};Object.defineProperty(Xm,"passive",{get:function(){j0=!0}}),window.addEventListener("test",Xm,Xm),window.removeEventListener("test",Xm,Xm)}catch{j0=!1}var Rc=null,x_=null,fv=null,ip={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pv=Wn(ip),b_=Fr({},ip,{view:0,detail:0}),_a=Wn(b_),op,Mh,sp,ap=Fr({},b_,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ku,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==sp&&(sp&&n.type==="mousemove"?(op=n.screenX-sp.screenX,Mh=n.screenY-sp.screenY):Mh=op=0,sp=n),op)},movementY:function(n){return"movementY"in n?n.movementY:Mh}}),Kb=Wn(ap),Jb=Fr({},ap,{dataTransfer:0}),Qb=Wn(Jb),cS=Fr({},b_,{relatedTarget:0}),mv=Wn(cS),e1=Fr({},ip,{animationName:0,elapsedTime:0,pseudoElement:0}),V0=Wn(e1),t1=Fr({},ip,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),uS=Wn(t1),n1=Fr({},ip,{data:0}),mu=Wn(n1),r1=mu,i1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},o1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},s1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"},dS=Fr({},b_,{key:function(n){if(n.key){var o=i1[n.key]||n.key;if(o!=="Unidentified")return o}return n.type==="keypress"?(n=cr(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?o1[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ku,charCode:function(n){return n.type==="keypress"?cr(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?cr(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),hS=Wn(dS),a1=Fr({},ap,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),q0=Wn(a1),l1=Fr({},b_,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ku}),Km=Wn(l1),w_=Fr({},ip,{propertyName:0,elapsedTime:0,pseudoElement:0}),c1=Wn(w_),u1=Fr({},ap,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),gv=Wn(u1),d1=Fr({},ip,{newState:0,oldState:0}),h1=Wn(d1),kc=[9,13,27,32],_v=229,Rh=$l&&"CompositionEvent"in window,Oc=null;$l&&"documentMode"in document&&(Oc=document.documentMode);var f1=$l&&"TextEvent"in window&&!Oc,H0=$l&&(!Rh||Oc&&8<Oc&&11>=Oc),S_=32,G0=String.fromCharCode(S_),T_=!1,vd=!1,fS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0},E_=null,A_=null,lp=!1;$l&&(lp=Mg("input")&&(!document.documentMode||9<document.documentMode));var bs=typeof Object.is=="function"?Object.is:dc,pS=$l&&"documentMode"in document&&11>=document.documentMode,cp=null,yv=null,Jm=null,vv=!1,Qm={animationend:fs("Animation","AnimationEnd"),animationiteration:fs("Animation","AnimationIteration"),animationstart:fs("Animation","AnimationStart"),transitionrun:fs("Transition","TransitionRun"),transitionstart:fs("Transition","TransitionStart"),transitioncancel:fs("Transition","TransitionCancel"),transitionend:fs("Transition","TransitionEnd")},xv={},bv={};$l&&(bv=document.createElement("div").style,"AnimationEvent"in window||(delete Qm.animationend.animation,delete Qm.animationiteration.animation,delete Qm.animationstart.animation),"TransitionEvent"in window||delete Qm.transitionend.transition);var p1=zu("animationend"),m1=zu("animationiteration"),eg=zu("animationstart"),kh=zu("transitionrun"),g1=zu("transitionstart"),$0=zu("transitioncancel"),C_=zu("transitionend"),wv=new Map,Z0="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Z0.push("scrollEnd");var Sv=new WeakMap,up=1,Oh=2,Zl=[],pl=0,Y0=0,Yl={};Object.freeze(Yl);var Zs=null,gu=null,Mi=0,Tv=1,ws=2,Ys=8,Ws=16,D_=64,_1=!1;try{var W0=Object.preventExtensions({})}catch{_1=!0}var dp=[],tg=0,M_=null,Ev=0,ml=[],Wl=0,Ih=null,xd=1,bd="",rs=null,Zi=null,Jr=!1,Xl=!1,Kl=null,wd=null,Jl=!1,ng=Error("Hydration Mismatch Exception: This is not a real error, and should not leak into userspace. If you're seeing this, it's likely a bug in React."),X0=0;if(typeof performance=="object"&&typeof performance.now=="function")var y1=performance,Av=function(){return y1.now()};else{var v1=Date;Av=function(){return v1.now()}}var R_=Yt(null),rg=Yt(null),K0={},k_=null,hp=null,fp=!1,J0=typeof AbortController<"u"?AbortController:function(){var n=[],o=this.signal={aborted:!1,addEventListener:function(p,b){n.push(b)}};this.abort=function(){o.aborted=!0,n.forEach(function(p){return p()})}},Q0=To.unstable_scheduleCallback,ex=To.unstable_NormalPriority,Eo={$$typeof:du,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0,_currentRenderer:null,_currentRenderer2:null},Sd=To.unstable_now,O_=-0,I_=-0,Ss=-1.1,Nh=-0,Cv=!1,N_=!1,ig=null,Dv=0,zh=0,pp=null,tx=Pt.S;Pt.S=function(n,o){typeof o=="object"&&o!==null&&typeof o.then=="function"&&Qa(n,o),tx!==null&&tx(n,o)};var Ph=Yt(null),Ic={recordUnsafeLifecycleWarnings:function(){},flushPendingUnsafeLifecycleWarnings:function(){},recordLegacyContextWarning:function(){},flushLegacyContextWarning:function(){},discardPendingWarnings:function(){}},mp=[],og=[],sg=[],Lh=[],Ql=[],gp=[],Bh=new Set;Ic.recordUnsafeLifecycleWarnings=function(n,o){Bh.has(n.type)||(typeof o.componentWillMount=="function"&&o.componentWillMount.__suppressDeprecationWarning!==!0&&mp.push(n),n.mode&Ys&&typeof o.UNSAFE_componentWillMount=="function"&&og.push(n),typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps.__suppressDeprecationWarning!==!0&&sg.push(n),n.mode&Ys&&typeof o.UNSAFE_componentWillReceiveProps=="function"&&Lh.push(n),typeof o.componentWillUpdate=="function"&&o.componentWillUpdate.__suppressDeprecationWarning!==!0&&Ql.push(n),n.mode&Ys&&typeof o.UNSAFE_componentWillUpdate=="function"&&gp.push(n))},Ic.flushPendingUnsafeLifecycleWarnings=function(){var n=new Set;0<mp.length&&(mp.forEach(function(oe){n.add(Ut(oe)||"Component"),Bh.add(oe.type)}),mp=[]);var o=new Set;0<og.length&&(og.forEach(function(oe){o.add(Ut(oe)||"Component"),Bh.add(oe.type)}),og=[]);var p=new Set;0<sg.length&&(sg.forEach(function(oe){p.add(Ut(oe)||"Component"),Bh.add(oe.type)}),sg=[]);var b=new Set;0<Lh.length&&(Lh.forEach(function(oe){b.add(Ut(oe)||"Component"),Bh.add(oe.type)}),Lh=[]);var O=new Set;0<Ql.length&&(Ql.forEach(function(oe){O.add(Ut(oe)||"Component"),Bh.add(oe.type)}),Ql=[]);var z=new Set;if(0<gp.length&&(gp.forEach(function(oe){z.add(Ut(oe)||"Component"),Bh.add(oe.type)}),gp=[]),0<o.size){var W=ge(o);console.error(`Using UNSAFE_componentWillMount in strict mode is not recommended and may indicate bugs in your code. See https://react.dev/link/unsafe-component-lifecycles for details.

* Move code with side effects to componentDidMount, and set initial state in the constructor.

Please update the following components: %s`,W)}0<b.size&&(W=ge(b),console.error(`Using UNSAFE_componentWillReceiveProps in strict mode is not recommended and may indicate bugs in your code. See https://react.dev/link/unsafe-component-lifecycles for details.

* Move data fetching code or side effects to componentDidUpdate.
* If you're updating state whenever props change, refactor your code to use memoization techniques or move it to static getDerivedStateFromProps. Learn more at: https://react.dev/link/derived-state

Please update the following components: %s`,W)),0<z.size&&(W=ge(z),console.error(`Using UNSAFE_componentWillUpdate in strict mode is not recommended and may indicate bugs in your code. See https://react.dev/link/unsafe-component-lifecycles for details.

* Move data fetching code or side effects to componentDidUpdate.

Please update the following components: %s`,W)),0<n.size&&(W=ge(n),console.warn(`componentWillMount has been renamed, and is not recommended for use. See https://react.dev/link/unsafe-component-lifecycles for details.

* Move code with side effects to componentDidMount, and set initial state in the constructor.
* Rename componentWillMount to UNSAFE_componentWillMount to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run \`npx react-codemod rename-unsafe-lifecycles\` in your project source folder.

Please update the following components: %s`,W)),0<p.size&&(W=ge(p),console.warn(`componentWillReceiveProps has been renamed, and is not recommended for use. See https://react.dev/link/unsafe-component-lifecycles for details.

* Move data fetching code or side effects to componentDidUpdate.
* If you're updating state whenever props change, refactor your code to use memoization techniques or move it to static getDerivedStateFromProps. Learn more at: https://react.dev/link/derived-state
* Rename componentWillReceiveProps to UNSAFE_componentWillReceiveProps to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run \`npx react-codemod rename-unsafe-lifecycles\` in your project source folder.

Please update the following components: %s`,W)),0<O.size&&(W=ge(O),console.warn(`componentWillUpdate has been renamed, and is not recommended for use. See https://react.dev/link/unsafe-component-lifecycles for details.

* Move data fetching code or side effects to componentDidUpdate.
* Rename componentWillUpdate to UNSAFE_componentWillUpdate to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run \`npx react-codemod rename-unsafe-lifecycles\` in your project source folder.

Please update the following components: %s`,W))};var z_=new Map,P_=new Set;Ic.recordLegacyContextWarning=function(n,o){for(var p=null,b=n;b!==null;)b.mode&Ys&&(p=b),b=b.return;p===null?console.error("Expected to find a StrictMode component in a strict mode tree. This error is likely caused by a bug in React. Please file an issue."):!P_.has(n.type)&&(b=z_.get(p),n.type.contextTypes!=null||n.type.childContextTypes!=null||o!==null&&typeof o.getChildContext=="function")&&(b===void 0&&(b=[],z_.set(p,b)),b.push(n))},Ic.flushLegacyContextWarning=function(){z_.forEach(function(n){if(n.length!==0){var o=n[0],p=new Set;n.forEach(function(O){p.add(Ut(O)||"Component"),P_.add(O.type)});var b=ge(p);Ye(o,function(){console.error(`Legacy context API has been detected within a strict-mode tree.

The old API will be supported in all 16.x releases, but applications using it should migrate to the new version.

Please update the following components: %s

Learn more about this warning here: https://react.dev/link/legacy-context`,b)})}})},Ic.discardPendingWarnings=function(){mp=[],og=[],sg=[],Lh=[],Ql=[],gp=[],z_=new Map};var _p=Error("Suspense Exception: This is not a real error! It's an implementation detail of `use` to interrupt the current render. You must either rethrow it immediately, or move the `use` call outside of the `try/catch` block. Capturing without rethrowing will lead to unexpected behavior.\n\nTo handle async errors, wrap your component in an error boundary, or call the promise's `.catch` method and pass the result to `use`."),nx=Error("Suspense Exception: This is not a real error, and should not leak into userspace. If you're seeing this, it's likely a bug in React."),Mv=Error("Suspense Exception: This is not a real error! It's an implementation detail of `useActionState` to interrupt the current render. You must either rethrow it immediately, or move the `useActionState` call outside of the `try/catch` block. Capturing without rethrowing will lead to unexpected behavior.\n\nTo handle async errors, wrap your component in an error boundary."),rx={then:function(){console.error('Internal React error: A listener was unexpectedly attached to a "noop" thenable. This is a bug in React. Please file an issue.')}},L_=null,Rv=!1,ec=0,tc=1,ya=2,is=4,uo=8,ix=0,ox=1,sx=2,B_=3,Td=!1,ax=!1,Ed=null,Fh=!1,yp=Yt(null),Uh=Yt(0),ag,kv=new Set,F_=new Set,U_=new Set,vp=new Set,_u=0,ur=null,Oi=null,Ao=null,j_=!1,xp=!1,yu=!1,jh=0,V_=0,Ad=null,x1=0,mS=25,Lt=null,nc=null,vu=-1,Cd=!1,lg={readContext:Si,use:Il,useCallback:Gi,useContext:Gi,useEffect:Gi,useImperativeHandle:Gi,useLayoutEffect:Gi,useInsertionEffect:Gi,useMemo:Gi,useReducer:Gi,useRef:Gi,useState:Gi,useDebugValue:Gi,useDeferredValue:Gi,useTransition:Gi,useSyncExternalStore:Gi,useId:Gi,useHostTransitionStatus:Gi,useFormState:Gi,useActionState:Gi,useOptimistic:Gi,useMemoCache:Gi,useCacheRefresh:Gi},Dd=null,bp=null,wp=null,Ov=null,gl=null,_l=null,cg=null;Dd={readContext:function(n){return Si(n)},use:Il,useCallback:function(n,o){return Lt="useCallback",qr(),Yc(o),Qc(n,o)},useContext:function(n){return Lt="useContext",qr(),Si(n)},useEffect:function(n,o){return Lt="useEffect",qr(),Yc(o),Xu(n,o)},useImperativeHandle:function(n,o,p){return Lt="useImperativeHandle",qr(),Yc(p),Jc(n,o,p)},useInsertionEffect:function(n,o){Lt="useInsertionEffect",qr(),Yc(o),Kc(4,ya,n,o)},useLayoutEffect:function(n,o){return Lt="useLayoutEffect",qr(),Yc(o),Mf(n,o)},useMemo:function(n,o){Lt="useMemo",qr(),Yc(o);var p=Pt.H;Pt.H=gl;try{return eh(n,o)}finally{Pt.H=p}},useReducer:function(n,o,p){Lt="useReducer",qr();var b=Pt.H;Pt.H=gl;try{return Sf(n,o,p)}finally{Pt.H=b}},useRef:function(n){return Lt="useRef",qr(),Lg(n)},useState:function(n){Lt="useState",qr();var o=Pt.H;Pt.H=gl;try{return Tf(n)}finally{Pt.H=o}},useDebugValue:function(){Lt="useDebugValue",qr()},useDeferredValue:function(n,o){return Lt="useDeferredValue",qr(),Ju(n,o)},useTransition:function(){return Lt="useTransition",qr(),ms()},useSyncExternalStore:function(n,o,p){return Lt="useSyncExternalStore",qr(),Wc(n,o,p)},useId:function(){return Lt="useId",qr(),pm()},useFormState:function(n,o){return Lt="useFormState",qr(),Xd(),yc(n,o)},useActionState:function(n,o){return Lt="useActionState",qr(),yc(n,o)},useOptimistic:function(n){return Lt="useOptimistic",qr(),Ef(n)},useHostTransitionStatus:Qu,useMemoCache:Nl,useCacheRefresh:function(){return Lt="useCacheRefresh",qr(),th()}},bp={readContext:function(n){return Si(n)},use:Il,useCallback:function(n,o){return Lt="useCallback",gn(),Qc(n,o)},useContext:function(n){return Lt="useContext",gn(),Si(n)},useEffect:function(n,o){return Lt="useEffect",gn(),Xu(n,o)},useImperativeHandle:function(n,o,p){return Lt="useImperativeHandle",gn(),Jc(n,o,p)},useInsertionEffect:function(n,o){Lt="useInsertionEffect",gn(),Kc(4,ya,n,o)},useLayoutEffect:function(n,o){return Lt="useLayoutEffect",gn(),Mf(n,o)},useMemo:function(n,o){Lt="useMemo",gn();var p=Pt.H;Pt.H=gl;try{return eh(n,o)}finally{Pt.H=p}},useReducer:function(n,o,p){Lt="useReducer",gn();var b=Pt.H;Pt.H=gl;try{return Sf(n,o,p)}finally{Pt.H=b}},useRef:function(n){return Lt="useRef",gn(),Lg(n)},useState:function(n){Lt="useState",gn();var o=Pt.H;Pt.H=gl;try{return Tf(n)}finally{Pt.H=o}},useDebugValue:function(){Lt="useDebugValue",gn()},useDeferredValue:function(n,o){return Lt="useDeferredValue",gn(),Ju(n,o)},useTransition:function(){return Lt="useTransition",gn(),ms()},useSyncExternalStore:function(n,o,p){return Lt="useSyncExternalStore",gn(),Wc(n,o,p)},useId:function(){return Lt="useId",gn(),pm()},useActionState:function(n,o){return Lt="useActionState",gn(),yc(n,o)},useFormState:function(n,o){return Lt="useFormState",gn(),Xd(),yc(n,o)},useOptimistic:function(n){return Lt="useOptimistic",gn(),Ef(n)},useHostTransitionStatus:Qu,useMemoCache:Nl,useCacheRefresh:function(){return Lt="useCacheRefresh",gn(),th()}},wp={readContext:function(n){return Si(n)},use:Il,useCallback:function(n,o){return Lt="useCallback",gn(),Qd(n,o)},useContext:function(n){return Lt="useContext",gn(),Si(n)},useEffect:function(n,o){Lt="useEffect",gn(),Jo(2048,uo,n,o)},useImperativeHandle:function(n,o,p){return Lt="useImperativeHandle",gn(),Jd(n,o,p)},useInsertionEffect:function(n,o){return Lt="useInsertionEffect",gn(),Jo(4,ya,n,o)},useLayoutEffect:function(n,o){return Lt="useLayoutEffect",gn(),Jo(4,is,n,o)},useMemo:function(n,o){Lt="useMemo",gn();var p=Pt.H;Pt.H=_l;try{return Ku(n,o)}finally{Pt.H=p}},useReducer:function(n,o,p){Lt="useReducer",gn();var b=Pt.H;Pt.H=_l;try{return _c(n,o,p)}finally{Pt.H=b}},useRef:function(){return Lt="useRef",gn(),ai().memoizedState},useState:function(){Lt="useState",gn();var n=Pt.H;Pt.H=_l;try{return _c(da)}finally{Pt.H=n}},useDebugValue:function(){Lt="useDebugValue",gn()},useDeferredValue:function(n,o){return Lt="useDeferredValue",gn(),Bg(n,o)},useTransition:function(){return Lt="useTransition",gn(),vn()},useSyncExternalStore:function(n,o,p){return Lt="useSyncExternalStore",gn(),am(n,o,p)},useId:function(){return Lt="useId",gn(),ai().memoizedState},useFormState:function(n){return Lt="useFormState",gn(),Xd(),Cf(n)},useActionState:function(n){return Lt="useActionState",gn(),Cf(n)},useOptimistic:function(n,o){return Lt="useOptimistic",gn(),Zu(n,o)},useHostTransitionStatus:Qu,useMemoCache:Nl,useCacheRefresh:function(){return Lt="useCacheRefresh",gn(),ai().memoizedState}},Ov={readContext:function(n){return Si(n)},use:Il,useCallback:function(n,o){return Lt="useCallback",gn(),Qd(n,o)},useContext:function(n){return Lt="useContext",gn(),Si(n)},useEffect:function(n,o){Lt="useEffect",gn(),Jo(2048,uo,n,o)},useImperativeHandle:function(n,o,p){return Lt="useImperativeHandle",gn(),Jd(n,o,p)},useInsertionEffect:function(n,o){return Lt="useInsertionEffect",gn(),Jo(4,ya,n,o)},useLayoutEffect:function(n,o){return Lt="useLayoutEffect",gn(),Jo(4,is,n,o)},useMemo:function(n,o){Lt="useMemo",gn();var p=Pt.H;Pt.H=cg;try{return Ku(n,o)}finally{Pt.H=p}},useReducer:function(n,o,p){Lt="useReducer",gn();var b=Pt.H;Pt.H=cg;try{return Kd(n,o,p)}finally{Pt.H=b}},useRef:function(){return Lt="useRef",gn(),ai().memoizedState},useState:function(){Lt="useState",gn();var n=Pt.H;Pt.H=cg;try{return Kd(da)}finally{Pt.H=n}},useDebugValue:function(){Lt="useDebugValue",gn()},useDeferredValue:function(n,o){return Lt="useDeferredValue",gn(),Fg(n,o)},useTransition:function(){return Lt="useTransition",gn(),fm()},useSyncExternalStore:function(n,o,p){return Lt="useSyncExternalStore",gn(),am(n,o,p)},useId:function(){return Lt="useId",gn(),ai().memoizedState},useFormState:function(n){return Lt="useFormState",gn(),Xd(),Df(n)},useActionState:function(n){return Lt="useActionState",gn(),Df(n)},useOptimistic:function(n,o){return Lt="useOptimistic",gn(),zg(n,o)},useHostTransitionStatus:Qu,useMemoCache:Nl,useCacheRefresh:function(){return Lt="useCacheRefresh",gn(),ai().memoizedState}},gl={readContext:function(n){return se(),Si(n)},use:function(n){return ee(),Il(n)},useCallback:function(n,o){return Lt="useCallback",ee(),qr(),Qc(n,o)},useContext:function(n){return Lt="useContext",ee(),qr(),Si(n)},useEffect:function(n,o){return Lt="useEffect",ee(),qr(),Xu(n,o)},useImperativeHandle:function(n,o,p){return Lt="useImperativeHandle",ee(),qr(),Jc(n,o,p)},useInsertionEffect:function(n,o){Lt="useInsertionEffect",ee(),qr(),Kc(4,ya,n,o)},useLayoutEffect:function(n,o){return Lt="useLayoutEffect",ee(),qr(),Mf(n,o)},useMemo:function(n,o){Lt="useMemo",ee(),qr();var p=Pt.H;Pt.H=gl;try{return eh(n,o)}finally{Pt.H=p}},useReducer:function(n,o,p){Lt="useReducer",ee(),qr();var b=Pt.H;Pt.H=gl;try{return Sf(n,o,p)}finally{Pt.H=b}},useRef:function(n){return Lt="useRef",ee(),qr(),Lg(n)},useState:function(n){Lt="useState",ee(),qr();var o=Pt.H;Pt.H=gl;try{return Tf(n)}finally{Pt.H=o}},useDebugValue:function(){Lt="useDebugValue",ee(),qr()},useDeferredValue:function(n,o){return Lt="useDeferredValue",ee(),qr(),Ju(n,o)},useTransition:function(){return Lt="useTransition",ee(),qr(),ms()},useSyncExternalStore:function(n,o,p){return Lt="useSyncExternalStore",ee(),qr(),Wc(n,o,p)},useId:function(){return Lt="useId",ee(),qr(),pm()},useFormState:function(n,o){return Lt="useFormState",ee(),qr(),yc(n,o)},useActionState:function(n,o){return Lt="useActionState",ee(),qr(),yc(n,o)},useOptimistic:function(n){return Lt="useOptimistic",ee(),qr(),Ef(n)},useMemoCache:function(n){return ee(),Nl(n)},useHostTransitionStatus:Qu,useCacheRefresh:function(){return Lt="useCacheRefresh",qr(),th()}},_l={readContext:function(n){return se(),Si(n)},use:function(n){return ee(),Il(n)},useCallback:function(n,o){return Lt="useCallback",ee(),gn(),Qd(n,o)},useContext:function(n){return Lt="useContext",ee(),gn(),Si(n)},useEffect:function(n,o){Lt="useEffect",ee(),gn(),Jo(2048,uo,n,o)},useImperativeHandle:function(n,o,p){return Lt="useImperativeHandle",ee(),gn(),Jd(n,o,p)},useInsertionEffect:function(n,o){return Lt="useInsertionEffect",ee(),gn(),Jo(4,ya,n,o)},useLayoutEffect:function(n,o){return Lt="useLayoutEffect",ee(),gn(),Jo(4,is,n,o)},useMemo:function(n,o){Lt="useMemo",ee(),gn();var p=Pt.H;Pt.H=_l;try{return Ku(n,o)}finally{Pt.H=p}},useReducer:function(n,o,p){Lt="useReducer",ee(),gn();var b=Pt.H;Pt.H=_l;try{return _c(n,o,p)}finally{Pt.H=b}},useRef:function(){return Lt="useRef",ee(),gn(),ai().memoizedState},useState:function(){Lt="useState",ee(),gn();var n=Pt.H;Pt.H=_l;try{return _c(da)}finally{Pt.H=n}},useDebugValue:function(){Lt="useDebugValue",ee(),gn()},useDeferredValue:function(n,o){return Lt="useDeferredValue",ee(),gn(),Bg(n,o)},useTransition:function(){return Lt="useTransition",ee(),gn(),vn()},useSyncExternalStore:function(n,o,p){return Lt="useSyncExternalStore",ee(),gn(),am(n,o,p)},useId:function(){return Lt="useId",ee(),gn(),ai().memoizedState},useFormState:function(n){return Lt="useFormState",ee(),gn(),Cf(n)},useActionState:function(n){return Lt="useActionState",ee(),gn(),Cf(n)},useOptimistic:function(n,o){return Lt="useOptimistic",ee(),gn(),Zu(n,o)},useMemoCache:function(n){return ee(),Nl(n)},useHostTransitionStatus:Qu,useCacheRefresh:function(){return Lt="useCacheRefresh",gn(),ai().memoizedState}},cg={readContext:function(n){return se(),Si(n)},use:function(n){return ee(),Il(n)},useCallback:function(n,o){return Lt="useCallback",ee(),gn(),Qd(n,o)},useContext:function(n){return Lt="useContext",ee(),gn(),Si(n)},useEffect:function(n,o){Lt="useEffect",ee(),gn(),Jo(2048,uo,n,o)},useImperativeHandle:function(n,o,p){return Lt="useImperativeHandle",ee(),gn(),Jd(n,o,p)},useInsertionEffect:function(n,o){return Lt="useInsertionEffect",ee(),gn(),Jo(4,ya,n,o)},useLayoutEffect:function(n,o){return Lt="useLayoutEffect",ee(),gn(),Jo(4,is,n,o)},useMemo:function(n,o){Lt="useMemo",ee(),gn();var p=Pt.H;Pt.H=_l;try{return Ku(n,o)}finally{Pt.H=p}},useReducer:function(n,o,p){Lt="useReducer",ee(),gn();var b=Pt.H;Pt.H=_l;try{return Kd(n,o,p)}finally{Pt.H=b}},useRef:function(){return Lt="useRef",ee(),gn(),ai().memoizedState},useState:function(){Lt="useState",ee(),gn();var n=Pt.H;Pt.H=_l;try{return Kd(da)}finally{Pt.H=n}},useDebugValue:function(){Lt="useDebugValue",ee(),gn()},useDeferredValue:function(n,o){return Lt="useDeferredValue",ee(),gn(),Fg(n,o)},useTransition:function(){return Lt="useTransition",ee(),gn(),fm()},useSyncExternalStore:function(n,o,p){return Lt="useSyncExternalStore",ee(),gn(),am(n,o,p)},useId:function(){return Lt="useId",ee(),gn(),ai().memoizedState},useFormState:function(n){return Lt="useFormState",ee(),gn(),Df(n)},useActionState:function(n){return Lt="useActionState",ee(),gn(),Df(n)},useOptimistic:function(n,o){return Lt="useOptimistic",ee(),gn(),zg(n,o)},useMemoCache:function(n){return ee(),Nl(n)},useHostTransitionStatus:Qu,useCacheRefresh:function(){return Lt="useCacheRefresh",gn(),ai().memoizedState}};var q_={"react-stack-bottom-frame":function(n,o,p){var b=pu;pu=!0;try{return n(o,p)}finally{pu=b}}},Sp=q_["react-stack-bottom-frame"].bind(q_),lx={"react-stack-bottom-frame":function(n){var o=pu;pu=!0;try{return n.render()}finally{pu=o}}},Tp=lx["react-stack-bottom-frame"].bind(lx),cx={"react-stack-bottom-frame":function(n,o){try{o.componentDidMount()}catch(p){Sr(n,n.return,p)}}},ux=cx["react-stack-bottom-frame"].bind(cx),dx={"react-stack-bottom-frame":function(n,o,p,b,O){try{o.componentDidUpdate(p,b,O)}catch(z){Sr(n,n.return,z)}}},b1=dx["react-stack-bottom-frame"].bind(dx),w1={"react-stack-bottom-frame":function(n,o){var p=o.stack;n.componentDidCatch(o.value,{componentStack:p!==null?p:""})}},gS=w1["react-stack-bottom-frame"].bind(w1),S1={"react-stack-bottom-frame":function(n,o,p){try{p.componentWillUnmount()}catch(b){Sr(n,o,b)}}},T1=S1["react-stack-bottom-frame"].bind(S1),H_={"react-stack-bottom-frame":function(n){n.resourceKind!=null&&console.error("Expected only SimpleEffects when enableUseEffectCRUDOverload is disabled, got %s",n.resourceKind);var o=n.create;return n=n.inst,o=o(),n.destroy=o}},_S=H_["react-stack-bottom-frame"].bind(H_),E1={"react-stack-bottom-frame":function(n,o,p){try{p()}catch(b){Sr(n,o,b)}}},Iv=E1["react-stack-bottom-frame"].bind(E1),A1={"react-stack-bottom-frame":function(n){var o=n._init;return o(n._payload)}},Vh=A1["react-stack-bottom-frame"].bind(A1),ug=null,qh=0,Ur=null,hx,fx=hx=!1,C1={},D1={},M1={};a=function(n,o,p){if(p!==null&&typeof p=="object"&&p._store&&(!p._store.validated&&p.key==null||p._store.validated===2)){if(typeof p._store!="object")throw Error("React Component in warnForMissingKey should have a _store. This error is likely caused by a bug in React. Please file an issue.");p._store.validated=1;var b=Ut(n),O=b||"null";if(!C1[O]){C1[O]=!0,p=p._owner,n=n._debugOwner;var z="";n&&typeof n.tag=="number"&&(O=Ut(n))&&(z=`

Check the render method of \``+O+"`."),z||b&&(z=`

Check the top-level render call using <`+b+">.");var W="";p!=null&&n!==p&&(b=null,typeof p.tag=="number"?b=Ut(p):typeof p.name=="string"&&(b=p.name),b&&(W=" It was passed a child from "+b+".")),Ye(o,function(){console.error('Each child in a list should have a unique "key" prop.%s%s See https://react.dev/link/warning-keys for more information.',z,W)})}}};var dg=jg(!0),R1=jg(!1),Ts=Yt(null),Ia=null,hg=1,Ep=2,Lo=Yt(0),px={},mx=new Set,gx=new Set,_x=new Set,yx=new Set,vx=new Set,xx=new Set,bx=new Set,G_=new Set,wx=new Set,$_=new Set;Object.freeze(px);var Z_={enqueueSetState:function(n,o,p){n=n._reactInternals;var b=$o(n),O=ua(b);O.payload=o,p!=null&&(ih(p),O.callback=p),o=Ol(n,O,b),o!==null&&(Ei(o,n,b),$c(o,n,b)),ls(n,b)},enqueueReplaceState:function(n,o,p){n=n._reactInternals;var b=$o(n),O=ua(b);O.tag=ox,O.payload=o,p!=null&&(ih(p),O.callback=p),o=Ol(n,O,b),o!==null&&(Ei(o,n,b),$c(o,n,b)),ls(n,b)},enqueueForceUpdate:function(n,o){n=n._reactInternals;var p=$o(n),b=ua(p);b.tag=sx,o!=null&&(ih(o),b.callback=o),o=Ol(n,b,p),o!==null&&(Ei(o,n,p),$c(o,n,p)),Ln!==null&&typeof Ln.markForceUpdateScheduled=="function"&&Ln.markForceUpdateScheduled(n,p)}},Nv=typeof reportError=="function"?reportError:function(n){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof n=="object"&&n!==null&&typeof n.message=="string"?String(n.message):String(n),error:n});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",n);return}console.error(n)},Ap=null,zv=null,Sx=Error("This is not a real error. It's an implementation detail of React's selective hydration feature. If this leaks into userspace, it's a bug in React. Please file an issue."),Xo=!1,Tx={},Ex={},Md={},k1={},fg=!1,O1={},pg={},Ax={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null},I1=!1,N1=null;N1=new Set;var Rd=!1,Co=!1,Cx=!1,z1=typeof WeakSet=="function"?WeakSet:Set,os=null,mg=null,gg=null,Bo=null,Ui=!1,va=null,Y_=8192,P1={getCacheForType:function(n){var o=Si(Eo),p=o.data.get(n);return p===void 0&&(p=n(),o.data.set(n,p)),p},getOwner:function(){return fl}};if(typeof Symbol=="function"&&Symbol.for){var _g=Symbol.for;_g("selector.component"),_g("selector.has_pseudo_class"),_g("selector.role"),_g("selector.test_id"),_g("selector.text")}var yS=[],L1=typeof WeakMap=="function"?WeakMap:Map,Na=0,Xs=2,Nc=4,kd=0,yg=1,Ri=2,Hh=3,zc=4,Gh=6,Dx=5,Ai=Na,Li=null,jr=null,Tr=0,Ks=0,W_=1,Es=2,X_=3,B1=4,Mx=5,As=6,K_=7,Pv=8,Cp=9,vi=Ks,Js=null,Od=!1,Dp=!1,Mp=!1,rc=0,xi=kd,yl=0,xu=0,$h=0,za=0,Zh=0,Yh=null,xa=null,Wh=!1,Lv=0,Bv=300,Fv=1/0,J_=500,Q_=null,Id=null,F1=0,U1=1,vS=2,Xh=0,j1=1,Rx=2,Kh=3,kx=4,Ox=5,ss=0,Jh=null,vg=null,Qh=0,Uv=0,Ix=null,V1=null,q1=50,ey=0,ef=null,jv=!1,ty=!1,xS=50,tf=0,Rp=null,nf=!1,ny=null,xg=!1,Vv=new Set,H1={},s=null,e=null,r=!1,l=!1,u=!1,c=!1,f=0,x={};(function(){for(var n=0;n<Z0.length;n++){var o=Z0[n],p=o.toLowerCase();o=o[0].toUpperCase()+o.slice(1),Ps(p,"on"+o)}Ps(p1,"onAnimationEnd"),Ps(m1,"onAnimationIteration"),Ps(eg,"onAnimationStart"),Ps("dblclick","onDoubleClick"),Ps("focusin","onFocus"),Ps("focusout","onBlur"),Ps(kh,"onTransitionRun"),Ps(g1,"onTransitionStart"),Ps($0,"onTransitionCancel"),Ps(C_,"onTransitionEnd")})(),Sn("onMouseEnter",["mouseout","mouseover"]),Sn("onMouseLeave",["mouseout","mouseover"]),Sn("onPointerEnter",["pointerout","pointerover"]),Sn("onPointerLeave",["pointerout","pointerover"]),yn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),yn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),yn("onBeforeInput",["compositionend","keypress","textInput","paste"]),yn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),yn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),yn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var S="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),C=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(S)),_="_reactListening"+Math.random().toString(36).slice(2),E=!1,M=!1,A=!1,D=!1,I=!1,B=!1,U=!1,G={},H=/\r\n?/g,q=/\u0000|\uFFFD/g,Y="http://www.w3.org/1999/xlink",J="http://www.w3.org/XML/1998/namespace",ne="javascript:throw new Error('React form unexpectedly submitted.')",me="suppressHydrationWarning",ce="$",ue="/$",Ee="$?",_e="$!",De=1,Le=2,Ne=4,Ge="F!",Ve="F",Ke="complete",Ze="style",Je=0,vt=1,_t=2,tn=null,Ct=null,Bt={dialog:!0,webview:!0},bt=null,xn=typeof setTimeout=="function"?setTimeout:void 0,Jt=typeof clearTimeout=="function"?clearTimeout:void 0,an=-1,Rn=typeof Promise=="function"?Promise:void 0,qn=typeof queueMicrotask=="function"?queueMicrotask:typeof Rn<"u"?function(n){return Rn.resolve(null).then(n).catch(Di)}:xn,On=null,Vn=0,Fn=1,nr=2,pr=3,mr=4,wn=new Map,lr=new Set,Ir=yi.d;yi.d={f:function(){var n=Ir.f(),o=xh();return n||o},r:function(n){var o=qi(n);o!==null&&o.tag===5&&o.type==="form"?vc(o):Ir.r(n)},D:function(n){Ir.D(n),i0("dns-prefetch",n,null)},C:function(n,o){Ir.C(n,o),i0("preconnect",n,o)},L:function(n,o,p){Ir.L(n,o,p);var b=Kr;if(b&&n&&o){var O='link[rel="preload"][as="'+zn(o)+'"]';o==="image"&&p&&p.imageSrcSet?(O+='[imagesrcset="'+zn(p.imageSrcSet)+'"]',typeof p.imageSizes=="string"&&(O+='[imagesizes="'+zn(p.imageSizes)+'"]')):O+='[href="'+zn(n)+'"]';var z=O;switch(o){case"style":z=Hf(n);break;case"script":z=Eh(n)}wn.has(z)||(n=Fr({rel:"preload",href:o==="image"&&p&&p.imageSrcSet?void 0:n,as:o},p),wn.set(z,n),b.querySelector(O)!==null||o==="style"&&b.querySelector(Bm(z))||o==="script"&&b.querySelector(jl(z))||(o=b.createElement("link"),kt(o,"link",n),it(o),b.head.appendChild(o)))}},m:function(n,o){Ir.m(n,o);var p=Kr;if(p&&n){var b=o&&typeof o.as=="string"?o.as:"script",O='link[rel="modulepreload"][as="'+zn(b)+'"][href="'+zn(n)+'"]',z=O;switch(b){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":z=Eh(n)}if(!wn.has(z)&&(n=Fr({rel:"modulepreload",href:n},o),wn.set(z,n),p.querySelector(O)===null)){switch(b){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(p.querySelector(jl(z)))return}b=p.createElement("link"),kt(b,"link",n),it(b),p.head.appendChild(b)}}},X:function(n,o){Ir.X(n,o);var p=Kr;if(p&&n){var b=xe(p).hoistableScripts,O=Eh(n),z=b.get(O);z||(z=p.querySelector(jl(O)),z||(n=Fr({src:n,async:!0},o),(o=wn.get(O))&&a0(n,o),z=p.createElement("script"),it(z),kt(z,"link",n),p.head.appendChild(z)),z={type:"script",instance:z,count:1,state:null},b.set(O,z))}},S:function(n,o,p){Ir.S(n,o,p);var b=Kr;if(b&&n){var O=xe(b).hoistableStyles,z=Hf(n);o=o||"default";var W=O.get(z);if(!W){var oe={loading:Vn,preload:null};if(W=b.querySelector(Bm(z)))oe.loading=Fn|mr;else{n=Fr({rel:"stylesheet",href:n,"data-precedence":o},p),(p=wn.get(z))&&Gf(n,p);var Ce=W=b.createElement("link");it(Ce),kt(Ce,"link",n),Ce._p=new Promise(function(Be,Dt){Ce.onload=Be,Ce.onerror=Dt}),Ce.addEventListener("load",function(){oe.loading|=Fn}),Ce.addEventListener("error",function(){oe.loading|=nr}),oe.loading|=mr,o_(W,o,b)}W={type:"stylesheet",instance:W,count:1,state:oe},O.set(z,W)}}},M:function(n,o){Ir.M(n,o);var p=Kr;if(p&&n){var b=xe(p).hoistableScripts,O=Eh(n),z=b.get(O);z||(z=p.querySelector(jl(O)),z||(n=Fr({src:n,async:!0,type:"module"},o),(o=wn.get(O))&&a0(n,o),z=p.createElement("script"),it(z),kt(z,"link",n),p.head.appendChild(z)),z={type:"script",instance:z,count:1,state:null},b.set(O,z))}}};var Kr=typeof document>"u"?null:document,di=null,hi=null,zr=null,ji=null,so=Ab,ki={$$typeof:du,Provider:null,Consumer:null,_currentValue:so,_currentValue2:so,_threadCount:0},Vi="%c%s%c ",Fo="background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px",ho="",Qs=" ",rf=Function.prototype.bind,vl=!1,ic=null,Nd=null,zd=null,of=null,Nx=null,zx=null,Px=null,Lx=null,Bx=null;ic=function(n,o,p,b){o=g(n,o),o!==null&&(p=y(o.memoizedState,p,0,b),o.memoizedState=p,o.baseState=p,n.memoizedProps=Fr({},n.memoizedProps),p=Io(n,2),p!==null&&Ei(p,n,2))},Nd=function(n,o,p){o=g(n,o),o!==null&&(p=L(o.memoizedState,p,0),o.memoizedState=p,o.baseState=p,n.memoizedProps=Fr({},n.memoizedProps),p=Io(n,2),p!==null&&Ei(p,n,2))},zd=function(n,o,p,b){o=g(n,o),o!==null&&(p=T(o.memoizedState,p,b),o.memoizedState=p,o.baseState=p,n.memoizedProps=Fr({},n.memoizedProps),p=Io(n,2),p!==null&&Ei(p,n,2))},of=function(n,o,p){n.pendingProps=y(n.memoizedProps,o,0,p),n.alternate&&(n.alternate.pendingProps=n.pendingProps),o=Io(n,2),o!==null&&Ei(o,n,2)},Nx=function(n,o){n.pendingProps=L(n.memoizedProps,o,0),n.alternate&&(n.alternate.pendingProps=n.pendingProps),o=Io(n,2),o!==null&&Ei(o,n,2)},zx=function(n,o,p){n.pendingProps=T(n.memoizedProps,o,p),n.alternate&&(n.alternate.pendingProps=n.pendingProps),o=Io(n,2),o!==null&&Ei(o,n,2)},Px=function(n){var o=Io(n,2);o!==null&&Ei(o,n,2)},Lx=function(n){X=n},Bx=function(n){$=n};var ry=!0,iy=null,oy=!1,bu=null,Cs=null,Pd=null,Pc=new Map,kp=new Map,wu=[],Fx="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" "),Lc=null;if(c_.prototype.render=l_.prototype.render=function(n){var o=this._internalRoot;if(o===null)throw Error("Cannot update an unmounted root.");var p=arguments;typeof p[1]=="function"?console.error("does not support the second callback argument. To execute a side effect after rendering, declare it in a component body with useEffect()."):Pe(p[1])?console.error("You passed a container to the second argument of root.render(...). You don't need to pass it again since you already passed it to create the root."):typeof p[1]<"u"&&console.error("You passed a second argument to root.render(...) but it only accepts one argument."),p=n;var b=o.current,O=$o(b);c0(b,O,p,o,null,null)},c_.prototype.unmount=l_.prototype.unmount=function(){var n=arguments;if(typeof n[0]=="function"&&console.error("does not support a callback argument. To execute a side effect after rendering, declare it in a component body with useEffect()."),n=this._internalRoot,n!==null){this._internalRoot=null;var o=n.containerInfo;(Ai&(Xs|Nc))!==Na&&console.error("Attempted to synchronously unmount a root while React was already rendering. React cannot finish unmounting the root until the current render has completed, which may lead to a race condition."),c0(n.current,2,null,n,null,null),xh(),o[Dc]=null}},c_.prototype.unstable_scheduleHydration=function(n){if(n){var o=lc();n={blockedOn:null,target:n,priority:o};for(var p=0;p<wu.length&&o!==0&&o<wu[p].priority;p++);wu.splice(p,0,n),p===0&&a_(n)}},function(){var n=Wy.version;if(n!=="19.1.0")throw Error(`Incompatible React versions: The "react" and "react-dom" packages must have the exact same version. Instead got:
  - react:      `+(n+`
  - react-dom:  19.1.0
Learn more: https://react.dev/warnings/version-mismatch`))}(),typeof Map=="function"&&Map.prototype!=null&&typeof Map.prototype.forEach=="function"&&typeof Set=="function"&&Set.prototype!=null&&typeof Set.prototype.clear=="function"&&typeof Set.prototype.forEach=="function"||console.error("React depends on Map and Set built-in types. Make sure that you load a polyfill in older browsers. https://react.dev/link/react-polyfills"),yi.findDOMNode=function(n){var o=n._reactInternals;if(o===void 0)throw typeof n.render=="function"?Error("Unable to find node on an unmounted component."):(n=Object.keys(n).join(","),Error("Argument appears to not be a ReactComponent. Keys: "+n));return n=St(o),n=n!==null?Xt(n):null,n=n===null?null:n.stateNode,n},!function(){var n={bundleType:1,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:Pt,reconcilerVersion:"19.1.0"};return n.overrideHookState=ic,n.overrideHookStateDeletePath=Nd,n.overrideHookStateRenamePath=zd,n.overrideProps=of,n.overridePropsDeletePath=Nx,n.overridePropsRenamePath=zx,n.scheduleUpdate=Px,n.setErrorHandler=Lx,n.setSuspenseHandler=Bx,n.scheduleRefresh=Re,n.scheduleRoot=ke,n.setRefreshHandler=Ue,n.getCurrentFiber=tS,n.getLaneLabelMap=oo,n.injectProfilingHooks=kr,Nr(n)}()&&$l&&window.top===window.self&&(-1<navigator.userAgent.indexOf("Chrome")&&navigator.userAgent.indexOf("Edge")===-1||-1<navigator.userAgent.indexOf("Firefox"))){var qv=window.location.protocol;/^(https?|file):$/.test(qv)&&console.info("%cDownload the React DevTools for a better development experience: https://react.dev/link/react-devtools"+(qv==="file:"?`
You might need to use a local HTTP server (instead of file://): https://react.dev/link/react-devtools-faq`:""),"font-weight:bold")}Ux.createRoot=function(n,o){if(!Pe(n))throw Error("Target container is not a DOM element.");Yy(n);var p=!1,b="",O=Ot,z=en,W=sd,oe=null;return o!=null&&(o.hydrate?console.warn("hydrate through createRoot is deprecated. Use ReactDOMClient.hydrateRoot(container, <App />) instead."):typeof o=="object"&&o!==null&&o.$$typeof===gd&&console.error(`You passed a JSX element to createRoot. You probably meant to call root.render instead. Example usage:

  let root = createRoot(domContainer);
  root.render(<App />);`),o.unstable_strictMode===!0&&(p=!0),o.identifierPrefix!==void 0&&(b=o.identifierPrefix),o.onUncaughtError!==void 0&&(O=o.onUncaughtError),o.onCaughtError!==void 0&&(z=o.onCaughtError),o.onRecoverableError!==void 0&&(W=o.onRecoverableError),o.unstable_transitionCallbacks!==void 0&&(oe=o.unstable_transitionCallbacks)),o=bb(n,1,!1,null,null,p,b,O,z,W,oe,null),n[Dc]=o.current,Te(n),new l_(o)},Ux.hydrateRoot=function(n,o,p){if(!Pe(n))throw Error("Target container is not a DOM element.");Yy(n),o===void 0&&console.error("Must provide initial children as second argument to hydrateRoot. Example usage: hydrateRoot(domContainer, <App />)");var b=!1,O="",z=Ot,W=en,oe=sd,Ce=null,Be=null;return p!=null&&(p.unstable_strictMode===!0&&(b=!0),p.identifierPrefix!==void 0&&(O=p.identifierPrefix),p.onUncaughtError!==void 0&&(z=p.onUncaughtError),p.onCaughtError!==void 0&&(W=p.onCaughtError),p.onRecoverableError!==void 0&&(oe=p.onRecoverableError),p.unstable_transitionCallbacks!==void 0&&(Ce=p.unstable_transitionCallbacks),p.formState!==void 0&&(Be=p.formState)),o=bb(n,1,!0,o,p??null,b,O,z,W,oe,Ce,Be),o.context=wb(null),p=o.current,b=$o(p),b=Ua(b),O=ua(b),O.callback=null,Ol(p,O,b),p=b,o.current.lanes=p,ta(o,p),R(o),n[Dc]=o.current,Te(n),new c_(o)},Ux.version="19.1.0",typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}(),Ux}var uE;function oM(){return uE||(uE=1,TS.exports=iM()),TS.exports}var sM=oM();const aM=kw(sM);var jx={},dE;function lM(){if(dE)return jx;dE=1,Object.defineProperty(jx,"__esModule",{value:!0}),jx.parse=X,jx.serialize=se;const g=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,y=/^[\u0021-\u003A\u003C-\u007E]*$/,T=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,k=/^[\u0020-\u003A\u003D-\u007E]*$/,L=Object.prototype.toString,$=(()=>{const le=function(){};return le.prototype=Object.create(null),le})();function X(le,ke){const Re=new $,Ue=le.length;if(Ue<2)return Re;const Pe=(ke==null?void 0:ke.decode)||fe;let We=0;do{const Tt=le.indexOf("=",We);if(Tt===-1)break;const wt=le.indexOf(";",We),St=wt===-1?Ue:wt;if(Tt>St){We=le.lastIndexOf(";",Tt-1)+1;continue}const Xt=a(le,We,Tt),cn=ee(le,Tt,Xt),xt=le.slice(Xt,cn);if(Re[xt]===void 0){let rn=a(le,Tt+1,St),Ut=ee(le,St,rn);const Yt=Pe(le.slice(rn,Ut));Re[xt]=Yt}We=St+1}while(We<Ue);return Re}function a(le,ke,Re){do{const Ue=le.charCodeAt(ke);if(Ue!==32&&Ue!==9)return ke}while(++ke<Re);return Re}function ee(le,ke,Re){for(;ke>Re;){const Ue=le.charCodeAt(--ke);if(Ue!==32&&Ue!==9)return ke+1}return Re}function se(le,ke,Re){const Ue=(Re==null?void 0:Re.encode)||encodeURIComponent;if(!g.test(le))throw new TypeError(`argument name is invalid: ${le}`);const Pe=Ue(ke);if(!y.test(Pe))throw new TypeError(`argument val is invalid: ${ke}`);let We=le+"="+Pe;if(!Re)return We;if(Re.maxAge!==void 0){if(!Number.isInteger(Re.maxAge))throw new TypeError(`option maxAge is invalid: ${Re.maxAge}`);We+="; Max-Age="+Re.maxAge}if(Re.domain){if(!T.test(Re.domain))throw new TypeError(`option domain is invalid: ${Re.domain}`);We+="; Domain="+Re.domain}if(Re.path){if(!k.test(Re.path))throw new TypeError(`option path is invalid: ${Re.path}`);We+="; Path="+Re.path}if(Re.expires){if(!ge(Re.expires)||!Number.isFinite(Re.expires.valueOf()))throw new TypeError(`option expires is invalid: ${Re.expires}`);We+="; Expires="+Re.expires.toUTCString()}if(Re.httpOnly&&(We+="; HttpOnly"),Re.secure&&(We+="; Secure"),Re.partitioned&&(We+="; Partitioned"),Re.priority)switch(typeof Re.priority=="string"?Re.priority.toLowerCase():void 0){case"low":We+="; Priority=Low";break;case"medium":We+="; Priority=Medium";break;case"high":We+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${Re.priority}`)}if(Re.sameSite)switch(typeof Re.sameSite=="string"?Re.sameSite.toLowerCase():Re.sameSite){case!0:case"strict":We+="; SameSite=Strict";break;case"lax":We+="; SameSite=Lax";break;case"none":We+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${Re.sameSite}`)}return We}function fe(le){if(le.indexOf("%")===-1)return le;try{return decodeURIComponent(le)}catch{return le}}function ge(le){return L.call(le)==="[object Date]"}return jx}lM();var hE="popstate";function cM(g={}){function y(k,L){let{pathname:$,search:X,hash:a}=k.location;return KS("",{pathname:$,search:X,hash:a},L.state&&L.state.usr||null,L.state&&L.state.key||"default")}function T(k,L){return typeof L=="string"?L:tb(L)}return dM(y,T,null,g)}function fo(g,y){if(g===!1||g===null||typeof g>"u")throw new Error(y)}function Ud(g,y){if(!g){typeof console<"u"&&console.warn(y);try{throw new Error(y)}catch{}}}function uM(){return Math.random().toString(36).substring(2,10)}function fE(g,y){return{usr:g.state,key:g.key,idx:y}}function KS(g,y,T=null,k){return{pathname:typeof g=="string"?g:g.pathname,search:"",hash:"",...typeof y=="string"?Yv(y):y,state:T,key:y&&y.key||k||uM()}}function tb({pathname:g="/",search:y="",hash:T=""}){return y&&y!=="?"&&(g+=y.charAt(0)==="?"?y:"?"+y),T&&T!=="#"&&(g+=T.charAt(0)==="#"?T:"#"+T),g}function Yv(g){let y={};if(g){let T=g.indexOf("#");T>=0&&(y.hash=g.substring(T),g=g.substring(0,T));let k=g.indexOf("?");k>=0&&(y.search=g.substring(k),g=g.substring(0,k)),g&&(y.pathname=g)}return y}function dM(g,y,T,k={}){let{window:L=document.defaultView,v5Compat:$=!1}=k,X=L.history,a="POP",ee=null,se=fe();se==null&&(se=0,X.replaceState({...X.state,idx:se},""));function fe(){return(X.state||{idx:null}).idx}function ge(){a="POP";let Pe=fe(),We=Pe==null?null:Pe-se;se=Pe,ee&&ee({action:a,location:Ue.location,delta:We})}function le(Pe,We){a="PUSH";let Tt=KS(Ue.location,Pe,We);se=fe()+1;let wt=fE(Tt,se),St=Ue.createHref(Tt);try{X.pushState(wt,"",St)}catch(Xt){if(Xt instanceof DOMException&&Xt.name==="DataCloneError")throw Xt;L.location.assign(St)}$&&ee&&ee({action:a,location:Ue.location,delta:1})}function ke(Pe,We){a="REPLACE";let Tt=KS(Ue.location,Pe,We);se=fe();let wt=fE(Tt,se),St=Ue.createHref(Tt);X.replaceState(wt,"",St),$&&ee&&ee({action:a,location:Ue.location,delta:0})}function Re(Pe){let We=L.location.origin!=="null"?L.location.origin:L.location.href,Tt=typeof Pe=="string"?Pe:tb(Pe);return Tt=Tt.replace(/ $/,"%20"),fo(We,`No window.location.(origin|href) available to create URL for href: ${Tt}`),new URL(Tt,We)}let Ue={get action(){return a},get location(){return g(L,X)},listen(Pe){if(ee)throw new Error("A history only accepts one active listener");return L.addEventListener(hE,ge),ee=Pe,()=>{L.removeEventListener(hE,ge),ee=null}},createHref(Pe){return y(L,Pe)},createURL:Re,encodeLocation(Pe){let We=Re(Pe);return{pathname:We.pathname,search:We.search,hash:We.hash}},push:le,replace:ke,go(Pe){return X.go(Pe)}};return Ue}function vA(g,y,T="/"){return hM(g,y,T,!1)}function hM(g,y,T,k){let L=typeof y=="string"?Yv(y):y,$=Lp(L.pathname||"/",T);if($==null)return null;let X=xA(g);fM(X);let a=null;for(let ee=0;a==null&&ee<X.length;++ee){let se=TM($);a=wM(X[ee],se,k)}return a}function xA(g,y=[],T=[],k=""){let L=($,X,a)=>{let ee={relativePath:a===void 0?$.path||"":a,caseSensitive:$.caseSensitive===!0,childrenIndex:X,route:$};ee.relativePath.startsWith("/")&&(fo(ee.relativePath.startsWith(k),`Absolute route path "${ee.relativePath}" nested under path "${k}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),ee.relativePath=ee.relativePath.slice(k.length));let se=Pp([k,ee.relativePath]),fe=T.concat(ee);$.children&&$.children.length>0&&(fo($.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${se}".`),xA($.children,y,fe,se)),!($.path==null&&!$.index)&&y.push({path:se,score:xM(se,$.index),routesMeta:fe})};return g.forEach(($,X)=>{var a;if($.path===""||!((a=$.path)!=null&&a.includes("?")))L($,X);else for(let ee of bA($.path))L($,X,ee)}),y}function bA(g){let y=g.split("/");if(y.length===0)return[];let[T,...k]=y,L=T.endsWith("?"),$=T.replace(/\?$/,"");if(k.length===0)return L?[$,""]:[$];let X=bA(k.join("/")),a=[];return a.push(...X.map(ee=>ee===""?$:[$,ee].join("/"))),L&&a.push(...X),a.map(ee=>g.startsWith("/")&&ee===""?"/":ee)}function fM(g){g.sort((y,T)=>y.score!==T.score?T.score-y.score:bM(y.routesMeta.map(k=>k.childrenIndex),T.routesMeta.map(k=>k.childrenIndex)))}var pM=/^:[\w-]+$/,mM=3,gM=2,_M=1,yM=10,vM=-2,pE=g=>g==="*";function xM(g,y){let T=g.split("/"),k=T.length;return T.some(pE)&&(k+=vM),y&&(k+=gM),T.filter(L=>!pE(L)).reduce((L,$)=>L+(pM.test($)?mM:$===""?_M:yM),k)}function bM(g,y){return g.length===y.length&&g.slice(0,-1).every((k,L)=>k===y[L])?g[g.length-1]-y[y.length-1]:0}function wM(g,y,T=!1){let{routesMeta:k}=g,L={},$="/",X=[];for(let a=0;a<k.length;++a){let ee=k[a],se=a===k.length-1,fe=$==="/"?y:y.slice($.length)||"/",ge=ww({path:ee.relativePath,caseSensitive:ee.caseSensitive,end:se},fe),le=ee.route;if(!ge&&se&&T&&!k[k.length-1].route.index&&(ge=ww({path:ee.relativePath,caseSensitive:ee.caseSensitive,end:!1},fe)),!ge)return null;Object.assign(L,ge.params),X.push({params:L,pathname:Pp([$,ge.pathname]),pathnameBase:DM(Pp([$,ge.pathnameBase])),route:le}),ge.pathnameBase!=="/"&&($=Pp([$,ge.pathnameBase]))}return X}function ww(g,y){typeof g=="string"&&(g={path:g,caseSensitive:!1,end:!0});let[T,k]=SM(g.path,g.caseSensitive,g.end),L=y.match(T);if(!L)return null;let $=L[0],X=$.replace(/(.)\/+$/,"$1"),a=L.slice(1);return{params:k.reduce((se,{paramName:fe,isOptional:ge},le)=>{if(fe==="*"){let Re=a[le]||"";X=$.slice(0,$.length-Re.length).replace(/(.)\/+$/,"$1")}const ke=a[le];return ge&&!ke?se[fe]=void 0:se[fe]=(ke||"").replace(/%2F/g,"/"),se},{}),pathname:$,pathnameBase:X,pattern:g}}function SM(g,y=!1,T=!0){Ud(g==="*"||!g.endsWith("*")||g.endsWith("/*"),`Route path "${g}" will be treated as if it were "${g.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${g.replace(/\*$/,"/*")}".`);let k=[],L="^"+g.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(X,a,ee)=>(k.push({paramName:a,isOptional:ee!=null}),ee?"/?([^\\/]+)?":"/([^\\/]+)"));return g.endsWith("*")?(k.push({paramName:"*"}),L+=g==="*"||g==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):T?L+="\\/*$":g!==""&&g!=="/"&&(L+="(?:(?=\\/|$))"),[new RegExp(L,y?void 0:"i"),k]}function TM(g){try{return g.split("/").map(y=>decodeURIComponent(y).replace(/\//g,"%2F")).join("/")}catch(y){return Ud(!1,`The URL path "${g}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${y}).`),g}}function Lp(g,y){if(y==="/")return g;if(!g.toLowerCase().startsWith(y.toLowerCase()))return null;let T=y.endsWith("/")?y.length-1:y.length,k=g.charAt(T);return k&&k!=="/"?null:g.slice(T)||"/"}function EM(g,y="/"){let{pathname:T,search:k="",hash:L=""}=typeof g=="string"?Yv(g):g;return{pathname:T?T.startsWith("/")?T:AM(T,y):y,search:MM(k),hash:RM(L)}}function AM(g,y){let T=y.replace(/\/+$/,"").split("/");return g.split("/").forEach(L=>{L===".."?T.length>1&&T.pop():L!=="."&&T.push(L)}),T.length>1?T.join("/"):"/"}function DS(g,y,T,k){return`Cannot include a '${g}' character in a manually specified \`to.${y}\` field [${JSON.stringify(k)}].  Please separate it out to the \`to.${T}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function CM(g){return g.filter((y,T)=>T===0||y.route.path&&y.route.path.length>0)}function DT(g){let y=CM(g);return y.map((T,k)=>k===y.length-1?T.pathname:T.pathnameBase)}function MT(g,y,T,k=!1){let L;typeof g=="string"?L=Yv(g):(L={...g},fo(!L.pathname||!L.pathname.includes("?"),DS("?","pathname","search",L)),fo(!L.pathname||!L.pathname.includes("#"),DS("#","pathname","hash",L)),fo(!L.search||!L.search.includes("#"),DS("#","search","hash",L)));let $=g===""||L.pathname==="",X=$?"/":L.pathname,a;if(X==null)a=T;else{let ge=y.length-1;if(!k&&X.startsWith("..")){let le=X.split("/");for(;le[0]==="..";)le.shift(),ge-=1;L.pathname=le.join("/")}a=ge>=0?y[ge]:"/"}let ee=EM(L,a),se=X&&X!=="/"&&X.endsWith("/"),fe=($||X===".")&&T.endsWith("/");return!ee.pathname.endsWith("/")&&(se||fe)&&(ee.pathname+="/"),ee}var Pp=g=>g.join("/").replace(/\/\/+/g,"/"),DM=g=>g.replace(/\/+$/,"").replace(/^\/*/,"/"),MM=g=>!g||g==="?"?"":g.startsWith("?")?g:"?"+g,RM=g=>!g||g==="#"?"":g.startsWith("#")?g:"#"+g;function kM(g){return g!=null&&typeof g.status=="number"&&typeof g.statusText=="string"&&typeof g.internal=="boolean"&&"data"in g}var wA=["POST","PUT","PATCH","DELETE"];new Set(wA);var OM=["GET",...wA];new Set(OM);var Wv=Fe.createContext(null);Wv.displayName="DataRouter";var Ow=Fe.createContext(null);Ow.displayName="DataRouterState";var SA=Fe.createContext({isTransitioning:!1});SA.displayName="ViewTransition";var IM=Fe.createContext(new Map);IM.displayName="Fetchers";var NM=Fe.createContext(null);NM.displayName="Await";var jd=Fe.createContext(null);jd.displayName="Navigation";var ab=Fe.createContext(null);ab.displayName="Location";var Tu=Fe.createContext({outlet:null,matches:[],isDataRoute:!1});Tu.displayName="Route";var RT=Fe.createContext(null);RT.displayName="RouteError";function zM(g,{relative:y}={}){fo(Xv(),"useHref() may be used only in the context of a <Router> component.");let{basename:T,navigator:k}=Fe.useContext(jd),{hash:L,pathname:$,search:X}=lb(g,{relative:y}),a=$;return T!=="/"&&(a=$==="/"?T:Pp([T,$])),k.createHref({pathname:a,search:X,hash:L})}function Xv(){return Fe.useContext(ab)!=null}function Fp(){return fo(Xv(),"useLocation() may be used only in the context of a <Router> component."),Fe.useContext(ab).location}var TA="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function EA(g){Fe.useContext(jd).static||Fe.useLayoutEffect(g)}function Cg(){let{isDataRoute:g}=Fe.useContext(Tu);return g?KM():PM()}function PM(){fo(Xv(),"useNavigate() may be used only in the context of a <Router> component.");let g=Fe.useContext(Wv),{basename:y,navigator:T}=Fe.useContext(jd),{matches:k}=Fe.useContext(Tu),{pathname:L}=Fp(),$=JSON.stringify(DT(k)),X=Fe.useRef(!1);return EA(()=>{X.current=!0}),Fe.useCallback((ee,se={})=>{if(Ud(X.current,TA),!X.current)return;if(typeof ee=="number"){T.go(ee);return}let fe=MT(ee,JSON.parse($),L,se.relative==="path");g==null&&y!=="/"&&(fe.pathname=fe.pathname==="/"?y:Pp([y,fe.pathname])),(se.replace?T.replace:T.push)(fe,se.state,se)},[y,T,$,L,g])}var LM=Fe.createContext(null);function BM(g){let y=Fe.useContext(Tu).outlet;return y&&Fe.createElement(LM.Provider,{value:g},y)}function FM(){let{matches:g}=Fe.useContext(Tu),y=g[g.length-1];return y?y.params:{}}function lb(g,{relative:y}={}){let{matches:T}=Fe.useContext(Tu),{pathname:k}=Fp(),L=JSON.stringify(DT(T));return Fe.useMemo(()=>MT(g,JSON.parse(L),k,y==="path"),[g,L,k,y])}function UM(g,y){return AA(g,y)}function AA(g,y,T,k){var Tt;fo(Xv(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:L,static:$}=Fe.useContext(jd),{matches:X}=Fe.useContext(Tu),a=X[X.length-1],ee=a?a.params:{},se=a?a.pathname:"/",fe=a?a.pathnameBase:"/",ge=a&&a.route;{let wt=ge&&ge.path||"";CA(se,!ge||wt.endsWith("*")||wt.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${se}" (under <Route path="${wt}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${wt}"> to <Route path="${wt==="/"?"*":`${wt}/*`}">.`)}let le=Fp(),ke;if(y){let wt=typeof y=="string"?Yv(y):y;fo(fe==="/"||((Tt=wt.pathname)==null?void 0:Tt.startsWith(fe)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${fe}" but pathname "${wt.pathname}" was given in the \`location\` prop.`),ke=wt}else ke=le;let Re=ke.pathname||"/",Ue=Re;if(fe!=="/"){let wt=fe.replace(/^\//,"").split("/");Ue="/"+Re.replace(/^\//,"").split("/").slice(wt.length).join("/")}let Pe=!$&&T&&T.matches&&T.matches.length>0?T.matches:vA(g,{pathname:Ue});Ud(ge||Pe!=null,`No routes matched location "${ke.pathname}${ke.search}${ke.hash}" `),Ud(Pe==null||Pe[Pe.length-1].route.element!==void 0||Pe[Pe.length-1].route.Component!==void 0||Pe[Pe.length-1].route.lazy!==void 0,`Matched leaf route at location "${ke.pathname}${ke.search}${ke.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let We=GM(Pe&&Pe.map(wt=>Object.assign({},wt,{params:Object.assign({},ee,wt.params),pathname:Pp([fe,L.encodeLocation?L.encodeLocation(wt.pathname).pathname:wt.pathname]),pathnameBase:wt.pathnameBase==="/"?fe:Pp([fe,L.encodeLocation?L.encodeLocation(wt.pathnameBase).pathname:wt.pathnameBase])})),X,T,k);return y&&We?Fe.createElement(ab.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...ke},navigationType:"POP"}},We):We}function jM(){let g=XM(),y=kM(g)?`${g.status} ${g.statusText}`:g instanceof Error?g.message:JSON.stringify(g),T=g instanceof Error?g.stack:null,k="rgba(200,200,200, 0.5)",L={padding:"0.5rem",backgroundColor:k},$={padding:"2px 4px",backgroundColor:k},X=null;return console.error("Error handled by React Router default ErrorBoundary:",g),X=Fe.createElement(Fe.Fragment,null,Fe.createElement("p",null,"💿 Hey developer 👋"),Fe.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Fe.createElement("code",{style:$},"ErrorBoundary")," or"," ",Fe.createElement("code",{style:$},"errorElement")," prop on your route.")),Fe.createElement(Fe.Fragment,null,Fe.createElement("h2",null,"Unexpected Application Error!"),Fe.createElement("h3",{style:{fontStyle:"italic"}},y),T?Fe.createElement("pre",{style:L},T):null,X)}var VM=Fe.createElement(jM,null),qM=class extends Fe.Component{constructor(g){super(g),this.state={location:g.location,revalidation:g.revalidation,error:g.error}}static getDerivedStateFromError(g){return{error:g}}static getDerivedStateFromProps(g,y){return y.location!==g.location||y.revalidation!=="idle"&&g.revalidation==="idle"?{error:g.error,location:g.location,revalidation:g.revalidation}:{error:g.error!==void 0?g.error:y.error,location:y.location,revalidation:g.revalidation||y.revalidation}}componentDidCatch(g,y){console.error("React Router caught the following error during render",g,y)}render(){return this.state.error!==void 0?Fe.createElement(Tu.Provider,{value:this.props.routeContext},Fe.createElement(RT.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function HM({routeContext:g,match:y,children:T}){let k=Fe.useContext(Wv);return k&&k.static&&k.staticContext&&(y.route.errorElement||y.route.ErrorBoundary)&&(k.staticContext._deepestRenderedBoundaryId=y.route.id),Fe.createElement(Tu.Provider,{value:g},T)}function GM(g,y=[],T=null,k=null){if(g==null){if(!T)return null;if(T.errors)g=T.matches;else if(y.length===0&&!T.initialized&&T.matches.length>0)g=T.matches;else return null}let L=g,$=T==null?void 0:T.errors;if($!=null){let ee=L.findIndex(se=>se.route.id&&($==null?void 0:$[se.route.id])!==void 0);fo(ee>=0,`Could not find a matching route for errors on route IDs: ${Object.keys($).join(",")}`),L=L.slice(0,Math.min(L.length,ee+1))}let X=!1,a=-1;if(T)for(let ee=0;ee<L.length;ee++){let se=L[ee];if((se.route.HydrateFallback||se.route.hydrateFallbackElement)&&(a=ee),se.route.id){let{loaderData:fe,errors:ge}=T,le=se.route.loader&&!fe.hasOwnProperty(se.route.id)&&(!ge||ge[se.route.id]===void 0);if(se.route.lazy||le){X=!0,a>=0?L=L.slice(0,a+1):L=[L[0]];break}}}return L.reduceRight((ee,se,fe)=>{let ge,le=!1,ke=null,Re=null;T&&(ge=$&&se.route.id?$[se.route.id]:void 0,ke=se.route.errorElement||VM,X&&(a<0&&fe===0?(CA("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),le=!0,Re=null):a===fe&&(le=!0,Re=se.route.hydrateFallbackElement||null)));let Ue=y.concat(L.slice(0,fe+1)),Pe=()=>{let We;return ge?We=ke:le?We=Re:se.route.Component?We=Fe.createElement(se.route.Component,null):se.route.element?We=se.route.element:We=ee,Fe.createElement(HM,{match:se,routeContext:{outlet:ee,matches:Ue,isDataRoute:T!=null},children:We})};return T&&(se.route.ErrorBoundary||se.route.errorElement||fe===0)?Fe.createElement(qM,{location:T.location,revalidation:T.revalidation,component:ke,error:ge,children:Pe(),routeContext:{outlet:null,matches:Ue,isDataRoute:!0}}):Pe()},null)}function kT(g){return`${g} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function $M(g){let y=Fe.useContext(Wv);return fo(y,kT(g)),y}function ZM(g){let y=Fe.useContext(Ow);return fo(y,kT(g)),y}function YM(g){let y=Fe.useContext(Tu);return fo(y,kT(g)),y}function OT(g){let y=YM(g),T=y.matches[y.matches.length-1];return fo(T.route.id,`${g} can only be used on routes that contain a unique "id"`),T.route.id}function WM(){return OT("useRouteId")}function XM(){var k;let g=Fe.useContext(RT),y=ZM("useRouteError"),T=OT("useRouteError");return g!==void 0?g:(k=y.errors)==null?void 0:k[T]}function KM(){let{router:g}=$M("useNavigate"),y=OT("useNavigate"),T=Fe.useRef(!1);return EA(()=>{T.current=!0}),Fe.useCallback(async(L,$={})=>{Ud(T.current,TA),T.current&&(typeof L=="number"?g.navigate(L):await g.navigate(L,{fromRouteId:y,...$}))},[g,y])}var mE={};function CA(g,y,T){!y&&!mE[g]&&(mE[g]=!0,Ud(!1,T))}Fe.memo(JM);function JM({routes:g,future:y,state:T}){return AA(g,void 0,T,y)}function DA({to:g,replace:y,state:T,relative:k}){fo(Xv(),"<Navigate> may be used only in the context of a <Router> component.");let{static:L}=Fe.useContext(jd);Ud(!L,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:$}=Fe.useContext(Tu),{pathname:X}=Fp(),a=Cg(),ee=MT(g,DT($),X,k==="path"),se=JSON.stringify(ee);return Fe.useEffect(()=>{a(JSON.parse(se),{replace:y,state:T,relative:k})},[a,se,k,y,T]),null}function MA(g){return BM(g.context)}function af(g){fo(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function QM({basename:g="/",children:y=null,location:T,navigationType:k="POP",navigator:L,static:$=!1}){fo(!Xv(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let X=g.replace(/^\/*/,"/"),a=Fe.useMemo(()=>({basename:X,navigator:L,static:$,future:{}}),[X,L,$]);typeof T=="string"&&(T=Yv(T));let{pathname:ee="/",search:se="",hash:fe="",state:ge=null,key:le="default"}=T,ke=Fe.useMemo(()=>{let Re=Lp(ee,X);return Re==null?null:{location:{pathname:Re,search:se,hash:fe,state:ge,key:le},navigationType:k}},[X,ee,se,fe,ge,le,k]);return Ud(ke!=null,`<Router basename="${X}"> is not able to match the URL "${ee}${se}${fe}" because it does not start with the basename, so the <Router> won't render anything.`),ke==null?null:Fe.createElement(jd.Provider,{value:a},Fe.createElement(ab.Provider,{children:y,value:ke}))}function eR({children:g,location:y}){return UM(JS(g),y)}function JS(g,y=[]){let T=[];return Fe.Children.forEach(g,(k,L)=>{if(!Fe.isValidElement(k))return;let $=[...y,L];if(k.type===Fe.Fragment){T.push.apply(T,JS(k.props.children,$));return}fo(k.type===af,`[${typeof k.type=="string"?k.type:k.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),fo(!k.props.index||!k.props.children,"An index route cannot have child routes.");let X={id:k.props.id||$.join("-"),caseSensitive:k.props.caseSensitive,element:k.props.element,Component:k.props.Component,index:k.props.index,path:k.props.path,loader:k.props.loader,action:k.props.action,hydrateFallbackElement:k.props.hydrateFallbackElement,HydrateFallback:k.props.HydrateFallback,errorElement:k.props.errorElement,ErrorBoundary:k.props.ErrorBoundary,hasErrorBoundary:k.props.hasErrorBoundary===!0||k.props.ErrorBoundary!=null||k.props.errorElement!=null,shouldRevalidate:k.props.shouldRevalidate,handle:k.props.handle,lazy:k.props.lazy};k.props.children&&(X.children=JS(k.props.children,$)),T.push(X)}),T}var nw="get",rw="application/x-www-form-urlencoded";function Iw(g){return g!=null&&typeof g.tagName=="string"}function tR(g){return Iw(g)&&g.tagName.toLowerCase()==="button"}function nR(g){return Iw(g)&&g.tagName.toLowerCase()==="form"}function rR(g){return Iw(g)&&g.tagName.toLowerCase()==="input"}function iR(g){return!!(g.metaKey||g.altKey||g.ctrlKey||g.shiftKey)}function oR(g,y){return g.button===0&&(!y||y==="_self")&&!iR(g)}var $1=null;function sR(){if($1===null)try{new FormData(document.createElement("form"),0),$1=!1}catch{$1=!0}return $1}var aR=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function MS(g){return g!=null&&!aR.has(g)?(Ud(!1,`"${g}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${rw}"`),null):g}function lR(g,y){let T,k,L,$,X;if(nR(g)){let a=g.getAttribute("action");k=a?Lp(a,y):null,T=g.getAttribute("method")||nw,L=MS(g.getAttribute("enctype"))||rw,$=new FormData(g)}else if(tR(g)||rR(g)&&(g.type==="submit"||g.type==="image")){let a=g.form;if(a==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let ee=g.getAttribute("formaction")||a.getAttribute("action");if(k=ee?Lp(ee,y):null,T=g.getAttribute("formmethod")||a.getAttribute("method")||nw,L=MS(g.getAttribute("formenctype"))||MS(a.getAttribute("enctype"))||rw,$=new FormData(a,g),!sR()){let{name:se,type:fe,value:ge}=g;if(fe==="image"){let le=se?`${se}.`:"";$.append(`${le}x`,"0"),$.append(`${le}y`,"0")}else se&&$.append(se,ge)}}else{if(Iw(g))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');T=nw,k=null,L=rw,X=g}return $&&L==="text/plain"&&(X=$,$=void 0),{action:k,method:T.toLowerCase(),encType:L,formData:$,body:X}}function IT(g,y){if(g===!1||g===null||typeof g>"u")throw new Error(y)}async function cR(g,y){if(g.id in y)return y[g.id];try{let T=await import(g.module);return y[g.id]=T,T}catch(T){return console.error(`Error loading route module \`${g.module}\`, reloading page...`),console.error(T),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function uR(g){return g==null?!1:g.href==null?g.rel==="preload"&&typeof g.imageSrcSet=="string"&&typeof g.imageSizes=="string":typeof g.rel=="string"&&typeof g.href=="string"}async function dR(g,y,T){let k=await Promise.all(g.map(async L=>{let $=y.routes[L.route.id];if($){let X=await cR($,T);return X.links?X.links():[]}return[]}));return mR(k.flat(1).filter(uR).filter(L=>L.rel==="stylesheet"||L.rel==="preload").map(L=>L.rel==="stylesheet"?{...L,rel:"prefetch",as:"style"}:{...L,rel:"prefetch"}))}function gE(g,y,T,k,L,$){let X=(ee,se)=>T[se]?ee.route.id!==T[se].route.id:!0,a=(ee,se)=>{var fe;return T[se].pathname!==ee.pathname||((fe=T[se].route.path)==null?void 0:fe.endsWith("*"))&&T[se].params["*"]!==ee.params["*"]};return $==="assets"?y.filter((ee,se)=>X(ee,se)||a(ee,se)):$==="data"?y.filter((ee,se)=>{var ge;let fe=k.routes[ee.route.id];if(!fe||!fe.hasLoader)return!1;if(X(ee,se)||a(ee,se))return!0;if(ee.route.shouldRevalidate){let le=ee.route.shouldRevalidate({currentUrl:new URL(L.pathname+L.search+L.hash,window.origin),currentParams:((ge=T[0])==null?void 0:ge.params)||{},nextUrl:new URL(g,window.origin),nextParams:ee.params,defaultShouldRevalidate:!0});if(typeof le=="boolean")return le}return!0}):[]}function hR(g,y,{includeHydrateFallback:T}={}){return fR(g.map(k=>{let L=y.routes[k.route.id];if(!L)return[];let $=[L.module];return L.clientActionModule&&($=$.concat(L.clientActionModule)),L.clientLoaderModule&&($=$.concat(L.clientLoaderModule)),T&&L.hydrateFallbackModule&&($=$.concat(L.hydrateFallbackModule)),L.imports&&($=$.concat(L.imports)),$}).flat(1))}function fR(g){return[...new Set(g)]}function pR(g){let y={},T=Object.keys(g).sort();for(let k of T)y[k]=g[k];return y}function mR(g,y){let T=new Set;return new Set(y),g.reduce((k,L)=>{let $=JSON.stringify(pR(L));return T.has($)||(T.add($),k.push({key:$,link:L})),k},[])}var gR=new Set([100,101,204,205]);function _R(g,y){let T=typeof g=="string"?new URL(g,typeof window>"u"?"server://singlefetch/":window.location.origin):g;return T.pathname==="/"?T.pathname="_root.data":y&&Lp(T.pathname,y)==="/"?T.pathname=`${y.replace(/\/$/,"")}/_root.data`:T.pathname=`${T.pathname.replace(/\/$/,"")}.data`,T}function RA(){let g=Fe.useContext(Wv);return IT(g,"You must render this element inside a <DataRouterContext.Provider> element"),g}function yR(){let g=Fe.useContext(Ow);return IT(g,"You must render this element inside a <DataRouterStateContext.Provider> element"),g}var NT=Fe.createContext(void 0);NT.displayName="FrameworkContext";function kA(){let g=Fe.useContext(NT);return IT(g,"You must render this element inside a <HydratedRouter> element"),g}function vR(g,y){let T=Fe.useContext(NT),[k,L]=Fe.useState(!1),[$,X]=Fe.useState(!1),{onFocus:a,onBlur:ee,onMouseEnter:se,onMouseLeave:fe,onTouchStart:ge}=y,le=Fe.useRef(null);Fe.useEffect(()=>{if(g==="render"&&X(!0),g==="viewport"){let Ue=We=>{We.forEach(Tt=>{X(Tt.isIntersecting)})},Pe=new IntersectionObserver(Ue,{threshold:.5});return le.current&&Pe.observe(le.current),()=>{Pe.disconnect()}}},[g]),Fe.useEffect(()=>{if(k){let Ue=setTimeout(()=>{X(!0)},100);return()=>{clearTimeout(Ue)}}},[k]);let ke=()=>{L(!0)},Re=()=>{L(!1),X(!1)};return T?g!=="intent"?[$,le,{}]:[$,le,{onFocus:Vx(a,ke),onBlur:Vx(ee,Re),onMouseEnter:Vx(se,ke),onMouseLeave:Vx(fe,Re),onTouchStart:Vx(ge,ke)}]:[!1,le,{}]}function Vx(g,y){return T=>{g&&g(T),T.defaultPrevented||y(T)}}function xR({page:g,...y}){let{router:T}=RA(),k=Fe.useMemo(()=>vA(T.routes,g,T.basename),[T.routes,g,T.basename]);return k?Fe.createElement(wR,{page:g,matches:k,...y}):null}function bR(g){let{manifest:y,routeModules:T}=kA(),[k,L]=Fe.useState([]);return Fe.useEffect(()=>{let $=!1;return dR(g,y,T).then(X=>{$||L(X)}),()=>{$=!0}},[g,y,T]),k}function wR({page:g,matches:y,...T}){let k=Fp(),{manifest:L,routeModules:$}=kA(),{basename:X}=RA(),{loaderData:a,matches:ee}=yR(),se=Fe.useMemo(()=>gE(g,y,ee,L,k,"data"),[g,y,ee,L,k]),fe=Fe.useMemo(()=>gE(g,y,ee,L,k,"assets"),[g,y,ee,L,k]),ge=Fe.useMemo(()=>{if(g===k.pathname+k.search+k.hash)return[];let Re=new Set,Ue=!1;if(y.forEach(We=>{var wt;let Tt=L.routes[We.route.id];!Tt||!Tt.hasLoader||(!se.some(St=>St.route.id===We.route.id)&&We.route.id in a&&((wt=$[We.route.id])!=null&&wt.shouldRevalidate)||Tt.hasClientLoader?Ue=!0:Re.add(We.route.id))}),Re.size===0)return[];let Pe=_R(g,X);return Ue&&Re.size>0&&Pe.searchParams.set("_routes",y.filter(We=>Re.has(We.route.id)).map(We=>We.route.id).join(",")),[Pe.pathname+Pe.search]},[X,a,k,L,se,y,g,$]),le=Fe.useMemo(()=>hR(fe,L),[fe,L]),ke=bR(fe);return Fe.createElement(Fe.Fragment,null,ge.map(Re=>Fe.createElement("link",{key:Re,rel:"prefetch",as:"fetch",href:Re,...T})),le.map(Re=>Fe.createElement("link",{key:Re,rel:"modulepreload",href:Re,...T})),ke.map(({key:Re,link:Ue})=>Fe.createElement("link",{key:Re,...Ue})))}function SR(...g){return y=>{g.forEach(T=>{typeof T=="function"?T(y):T!=null&&(T.current=y)})}}var OA=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{OA&&(window.__reactRouterVersion="7.5.2")}catch{}function TR({basename:g,children:y,window:T}){let k=Fe.useRef();k.current==null&&(k.current=cM({window:T,v5Compat:!0}));let L=k.current,[$,X]=Fe.useState({action:L.action,location:L.location}),a=Fe.useCallback(ee=>{Fe.startTransition(()=>X(ee))},[X]);return Fe.useLayoutEffect(()=>L.listen(a),[L,a]),Fe.createElement(QM,{basename:g,children:y,location:$.location,navigationType:$.action,navigator:L})}var IA=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,cb=Fe.forwardRef(function({onClick:y,discover:T="render",prefetch:k="none",relative:L,reloadDocument:$,replace:X,state:a,target:ee,to:se,preventScrollReset:fe,viewTransition:ge,...le},ke){let{basename:Re}=Fe.useContext(jd),Ue=typeof se=="string"&&IA.test(se),Pe,We=!1;if(typeof se=="string"&&Ue&&(Pe=se,OA))try{let Ut=new URL(window.location.href),Yt=se.startsWith("//")?new URL(Ut.protocol+se):new URL(se),Rt=Lp(Yt.pathname,Re);Yt.origin===Ut.origin&&Rt!=null?se=Rt+Yt.search+Yt.hash:We=!0}catch{Ud(!1,`<Link to="${se}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let Tt=zM(se,{relative:L}),[wt,St,Xt]=vR(k,le),cn=CR(se,{replace:X,state:a,target:ee,preventScrollReset:fe,relative:L,viewTransition:ge});function xt(Ut){y&&y(Ut),Ut.defaultPrevented||cn(Ut)}let rn=Fe.createElement("a",{...le,...Xt,href:Pe||Tt,onClick:We||$?y:xt,ref:SR(ke,St),target:ee,"data-discover":!Ue&&T==="render"?"true":void 0});return wt&&!Ue?Fe.createElement(Fe.Fragment,null,rn,Fe.createElement(xR,{page:Tt})):rn});cb.displayName="Link";var ay=Fe.forwardRef(function({"aria-current":y="page",caseSensitive:T=!1,className:k="",end:L=!1,style:$,to:X,viewTransition:a,children:ee,...se},fe){let ge=lb(X,{relative:se.relative}),le=Fp(),ke=Fe.useContext(Ow),{navigator:Re,basename:Ue}=Fe.useContext(jd),Pe=ke!=null&&OR(ge)&&a===!0,We=Re.encodeLocation?Re.encodeLocation(ge).pathname:ge.pathname,Tt=le.pathname,wt=ke&&ke.navigation&&ke.navigation.location?ke.navigation.location.pathname:null;T||(Tt=Tt.toLowerCase(),wt=wt?wt.toLowerCase():null,We=We.toLowerCase()),wt&&Ue&&(wt=Lp(wt,Ue)||wt);const St=We!=="/"&&We.endsWith("/")?We.length-1:We.length;let Xt=Tt===We||!L&&Tt.startsWith(We)&&Tt.charAt(St)==="/",cn=wt!=null&&(wt===We||!L&&wt.startsWith(We)&&wt.charAt(We.length)==="/"),xt={isActive:Xt,isPending:cn,isTransitioning:Pe},rn=Xt?y:void 0,Ut;typeof k=="function"?Ut=k(xt):Ut=[k,Xt?"active":null,cn?"pending":null,Pe?"transitioning":null].filter(Boolean).join(" ");let Yt=typeof $=="function"?$(xt):$;return Fe.createElement(cb,{...se,"aria-current":rn,className:Ut,ref:fe,style:Yt,to:X,viewTransition:a},typeof ee=="function"?ee(xt):ee)});ay.displayName="NavLink";var ER=Fe.forwardRef(({discover:g="render",fetcherKey:y,navigate:T,reloadDocument:k,replace:L,state:$,method:X=nw,action:a,onSubmit:ee,relative:se,preventScrollReset:fe,viewTransition:ge,...le},ke)=>{let Re=RR(),Ue=kR(a,{relative:se}),Pe=X.toLowerCase()==="get"?"get":"post",We=typeof a=="string"&&IA.test(a),Tt=wt=>{if(ee&&ee(wt),wt.defaultPrevented)return;wt.preventDefault();let St=wt.nativeEvent.submitter,Xt=(St==null?void 0:St.getAttribute("formmethod"))||X;Re(St||wt.currentTarget,{fetcherKey:y,method:Xt,navigate:T,replace:L,state:$,relative:se,preventScrollReset:fe,viewTransition:ge})};return Fe.createElement("form",{ref:ke,method:Pe,action:Ue,onSubmit:k?ee:Tt,...le,"data-discover":!We&&g==="render"?"true":void 0})});ER.displayName="Form";function AR(g){return`${g} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function NA(g){let y=Fe.useContext(Wv);return fo(y,AR(g)),y}function CR(g,{target:y,replace:T,state:k,preventScrollReset:L,relative:$,viewTransition:X}={}){let a=Cg(),ee=Fp(),se=lb(g,{relative:$});return Fe.useCallback(fe=>{if(oR(fe,y)){fe.preventDefault();let ge=T!==void 0?T:tb(ee)===tb(se);a(g,{replace:ge,state:k,preventScrollReset:L,relative:$,viewTransition:X})}},[ee,a,se,T,k,y,g,L,$,X])}var DR=0,MR=()=>`__${String(++DR)}__`;function RR(){let{router:g}=NA("useSubmit"),{basename:y}=Fe.useContext(jd),T=WM();return Fe.useCallback(async(k,L={})=>{let{action:$,method:X,encType:a,formData:ee,body:se}=lR(k,y);if(L.navigate===!1){let fe=L.fetcherKey||MR();await g.fetch(fe,T,L.action||$,{preventScrollReset:L.preventScrollReset,formData:ee,body:se,formMethod:L.method||X,formEncType:L.encType||a,flushSync:L.flushSync})}else await g.navigate(L.action||$,{preventScrollReset:L.preventScrollReset,formData:ee,body:se,formMethod:L.method||X,formEncType:L.encType||a,replace:L.replace,state:L.state,fromRouteId:T,flushSync:L.flushSync,viewTransition:L.viewTransition})},[g,y,T])}function kR(g,{relative:y}={}){let{basename:T}=Fe.useContext(jd),k=Fe.useContext(Tu);fo(k,"useFormAction must be used inside a RouteContext");let[L]=k.matches.slice(-1),$={...lb(g||".",{relative:y})},X=Fp();if(g==null){$.search=X.search;let a=new URLSearchParams($.search),ee=a.getAll("index");if(ee.some(fe=>fe==="")){a.delete("index"),ee.filter(ge=>ge).forEach(ge=>a.append("index",ge));let fe=a.toString();$.search=fe?`?${fe}`:""}}return(!g||g===".")&&L.route.index&&($.search=$.search?$.search.replace(/^\?/,"?index&"):"?index"),T!=="/"&&($.pathname=$.pathname==="/"?T:Pp([T,$.pathname])),tb($)}function OR(g,y={}){let T=Fe.useContext(SA);fo(T!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:k}=NA("useViewTransitionState"),L=lb(g,{relative:y.relative});if(!T.isTransitioning)return!1;let $=Lp(T.currentLocation.pathname,k)||T.currentLocation.pathname,X=Lp(T.nextLocation.pathname,k)||T.nextLocation.pathname;return ww(L.pathname,X)!=null||ww(L.pathname,$)!=null}new TextEncoder;[...gR];var zT=yA();const IR=kw(zT);var RS={exports:{}},kS={},_E;function NR(){if(_E)return kS;_E=1;/**
 * @license React
 * use-sync-external-store-with-selector.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */return function(){function g(ee,se){return ee===se&&(ee!==0||1/ee===1/se)||ee!==ee&&se!==se}typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var y=Zv(),T=typeof Object.is=="function"?Object.is:g,k=y.useSyncExternalStore,L=y.useRef,$=y.useEffect,X=y.useMemo,a=y.useDebugValue;kS.useSyncExternalStoreWithSelector=function(ee,se,fe,ge,le){var ke=L(null);if(ke.current===null){var Re={hasValue:!1,value:null};ke.current=Re}else Re=ke.current;ke=X(function(){function Pe(Xt){if(!We){if(We=!0,Tt=Xt,Xt=ge(Xt),le!==void 0&&Re.hasValue){var cn=Re.value;if(le(cn,Xt))return wt=cn}return wt=Xt}if(cn=wt,T(Tt,Xt))return cn;var xt=ge(Xt);return le!==void 0&&le(cn,xt)?(Tt=Xt,cn):(Tt=Xt,wt=xt)}var We=!1,Tt,wt,St=fe===void 0?null:fe;return[function(){return Pe(se())},St===null?void 0:function(){return Pe(St())}]},[se,fe,ge,le]);var Ue=k(ee,ke[0],ke[1]);return $(function(){Re.hasValue=!0,Re.value=Ue},[Ue]),a(Ue),Ue},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}(),kS}var yE;function zR(){return yE||(yE=1,RS.exports=NR()),RS.exports}var PR=zR();function LR(g){g()}function BR(){let g=null,y=null;return{clear(){g=null,y=null},notify(){LR(()=>{let T=g;for(;T;)T.callback(),T=T.next})},get(){const T=[];let k=g;for(;k;)T.push(k),k=k.next;return T},subscribe(T){let k=!0;const L=y={callback:T,next:null,prev:y};return L.prev?L.prev.next=L:g=L,function(){!k||g===null||(k=!1,L.next?L.next.prev=L.prev:y=L.prev,L.prev?L.prev.next=L.next:g=L.next)}}}}var vE={notify(){},get:()=>[]};function FR(g,y){let T,k=vE,L=0,$=!1;function X(Ue){fe();const Pe=k.subscribe(Ue);let We=!1;return()=>{We||(We=!0,Pe(),ge())}}function a(){k.notify()}function ee(){Re.onStateChange&&Re.onStateChange()}function se(){return $}function fe(){L++,T||(T=g.subscribe(ee),k=BR())}function ge(){L--,T&&L===0&&(T(),T=void 0,k.clear(),k=vE)}function le(){$||($=!0,fe())}function ke(){$&&($=!1,ge())}const Re={addNestedSub:X,notifyNestedSubs:a,handleChangeWrapper:ee,isSubscribed:se,trySubscribe:le,tryUnsubscribe:ke,getListeners:()=>k};return Re}var UR=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",jR=UR(),VR=()=>typeof navigator<"u"&&navigator.product==="ReactNative",qR=VR(),HR=()=>jR||qR?Fe.useLayoutEffect:Fe.useEffect,GR=HR(),OS=Symbol.for("react-redux-context"),IS=typeof globalThis<"u"?globalThis:{};function $R(){if(!Fe.createContext)return{};const g=IS[OS]??(IS[OS]=new Map);let y=g.get(Fe.createContext);return y||(y=Fe.createContext(null),y.displayName="ReactRedux",g.set(Fe.createContext,y)),y}var Ag=$R();function ZR(g){const{children:y,context:T,serverState:k,store:L}=g,$=Fe.useMemo(()=>{const ee=FR(L),se={store:L,subscription:ee,getServerState:k?()=>k:void 0};{const{identityFunctionCheck:fe="once",stabilityCheck:ge="once"}=g;return Object.assign(se,{stabilityCheck:ge,identityFunctionCheck:fe})}},[L,k]),X=Fe.useMemo(()=>L.getState(),[L]);GR(()=>{const{subscription:ee}=$;return ee.onStateChange=ee.notifyNestedSubs,ee.trySubscribe(),X!==L.getState()&&ee.notifyNestedSubs(),()=>{ee.tryUnsubscribe(),ee.onStateChange=void 0}},[$,X]);const a=T||Ag;return Fe.createElement(a.Provider,{value:$},y)}var YR=ZR;function PT(g=Ag){return function(){const T=Fe.useContext(g);if(!T)throw new Error("could not find react-redux context value; please ensure the component is wrapped in a <Provider>");return T}}var zA=PT();function PA(g=Ag){const y=g===Ag?zA:PT(g),T=()=>{const{store:k}=y();return k};return Object.assign(T,{withTypes:()=>T}),T}var WR=PA();function XR(g=Ag){const y=g===Ag?WR:PA(g),T=()=>y().dispatch;return Object.assign(T,{withTypes:()=>T}),T}var Up=XR(),KR=(g,y)=>g===y;function JR(g=Ag){const y=g===Ag?zA:PT(g),T=(k,L={})=>{const{equalityFn:$=KR}=typeof L=="function"?{equalityFn:L}:L;{if(!k)throw new Error("You must pass a selector to useSelector");if(typeof k!="function")throw new Error("You must pass a function as a selector to useSelector");if(typeof $!="function")throw new Error("You must pass a function as an equality function to useSelector")}const X=y(),{store:a,subscription:ee,getServerState:se}=X,fe=Fe.useRef(!0),ge=Fe.useCallback({[k.name](ke){const Re=k(ke);{const{devModeChecks:Ue={}}=typeof L=="function"?{}:L,{identityFunctionCheck:Pe,stabilityCheck:We}=X,{identityFunctionCheck:Tt,stabilityCheck:wt}={stabilityCheck:We,identityFunctionCheck:Pe,...Ue};if(wt==="always"||wt==="once"&&fe.current){const St=k(ke);if(!$(Re,St)){let Xt;try{throw new Error}catch(cn){({stack:Xt}=cn)}console.warn("Selector "+(k.name||"unknown")+` returned a different result when called with the same parameters. This can lead to unnecessary rerenders.
Selectors that return a new reference (such as an object or an array) should be memoized: https://redux.js.org/usage/deriving-data-selectors#optimizing-selectors-with-memoization`,{state:ke,selected:Re,selected2:St,stack:Xt})}}if((Tt==="always"||Tt==="once"&&fe.current)&&Re===ke){let St;try{throw new Error}catch(Xt){({stack:St}=Xt)}console.warn("Selector "+(k.name||"unknown")+` returned the root state when called. This can lead to unnecessary rerenders.
Selectors that return the entire state are almost certainly a mistake, as they will cause a rerender whenever *anything* in state changes.`,{stack:St})}fe.current&&(fe.current=!1)}return Re}}[k.name],[k]),le=PR.useSyncExternalStoreWithSelector(ee.addNestedSub,a.getState,se||a.getState,ge,$);return Fe.useDebugValue(le),le};return Object.assign(T,{withTypes:()=>T}),T}var Ba=JR();function Bc(g,y,{checkForDefaultPrevented:T=!0}={}){return function(L){if(g==null||g(L),T===!1||!L.defaultPrevented)return y==null?void 0:y(L)}}function xE(g,y){if(typeof g=="function")return g(y);g!=null&&(g.current=y)}function LA(...g){return y=>{let T=!1;const k=g.map(L=>{const $=xE(L,y);return!T&&typeof $=="function"&&(T=!0),$});if(T)return()=>{for(let L=0;L<k.length;L++){const $=k[L];typeof $=="function"?$():xE(g[L],null)}}}}function hy(...g){return Fe.useCallback(LA(...g),g)}var NS={exports:{}},qx={},bE;function QR(){if(bE)return qx;bE=1;/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */return function(){function g(tt){if(tt==null)return null;if(typeof tt=="function")return tt.$$typeof===Yt?null:tt.displayName||tt.name||null;if(typeof tt=="string")return tt;switch(tt){case Ue:return"Fragment";case We:return"Profiler";case Pe:return"StrictMode";case Xt:return"Suspense";case cn:return"SuspenseList";case Ut:return"Activity"}if(typeof tt=="object")switch(typeof tt.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),tt.$$typeof){case Re:return"Portal";case wt:return(tt.displayName||"Context")+".Provider";case Tt:return(tt._context.displayName||"Context")+".Consumer";case St:var un=tt.render;return tt=tt.displayName,tt||(tt=un.displayName||un.name||"",tt=tt!==""?"ForwardRef("+tt+")":"ForwardRef"),tt;case xt:return un=tt.displayName||null,un!==null?un:g(tt.type)||"Memo";case rn:un=tt._payload,tt=tt._init;try{return g(tt(un))}catch{}}return null}function y(tt){return""+tt}function T(tt){try{y(tt);var un=!1}catch{un=!0}if(un){un=console;var pn=un.error,Vt=typeof Symbol=="function"&&Symbol.toStringTag&&tt[Symbol.toStringTag]||tt.constructor.name||"Object";return pn.call(un,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",Vt),y(tt)}}function k(tt){if(tt===Ue)return"<>";if(typeof tt=="object"&&tt!==null&&tt.$$typeof===rn)return"<...>";try{var un=g(tt);return un?"<"+un+">":"<...>"}catch{return"<...>"}}function L(){var tt=Rt.A;return tt===null?null:tt.getOwner()}function $(){return Error("react-stack-top-frame")}function X(tt){if(ln.call(tt,"key")){var un=Object.getOwnPropertyDescriptor(tt,"key").get;if(un&&un.isReactWarning)return!1}return tt.key!==void 0}function a(tt,un){function pn(){$t||($t=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",un))}pn.isReactWarning=!0,Object.defineProperty(tt,"key",{get:pn,configurable:!0})}function ee(){var tt=g(this.type);return Nt[tt]||(Nt[tt]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),tt=this.props.ref,tt!==void 0?tt:null}function se(tt,un,pn,Vt,ir,Nr,rr,kr){return pn=Nr.ref,tt={$$typeof:ke,type:tt,key:un,props:Nr,_owner:ir},(pn!==void 0?pn:null)!==null?Object.defineProperty(tt,"ref",{enumerable:!1,get:ee}):Object.defineProperty(tt,"ref",{enumerable:!1,value:null}),tt._store={},Object.defineProperty(tt._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(tt,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(tt,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:rr}),Object.defineProperty(tt,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:kr}),Object.freeze&&(Object.freeze(tt.props),Object.freeze(tt)),tt}function fe(tt,un,pn,Vt,ir,Nr,rr,kr){var sr=un.children;if(sr!==void 0)if(Vt)if(An(sr)){for(Vt=0;Vt<sr.length;Vt++)ge(sr[Vt]);Object.freeze&&Object.freeze(sr)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else ge(sr);if(ln.call(un,"key")){sr=g(tt);var Yr=Object.keys(un).filter(function(po){return po!=="key"});Vt=0<Yr.length?"{key: someKey, "+Yr.join(": ..., ")+": ...}":"{key: someKey}",sn[sr+Vt]||(Yr=0<Yr.length?"{"+Yr.join(": ..., ")+": ...}":"{}",console.error(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,Vt,sr,Yr,sr),sn[sr+Vt]=!0)}if(sr=null,pn!==void 0&&(T(pn),sr=""+pn),X(un)&&(T(un.key),sr=""+un.key),"key"in un){pn={};for(var de in un)de!=="key"&&(pn[de]=un[de])}else pn=un;return sr&&a(pn,typeof tt=="function"?tt.displayName||tt.name||"Unknown":tt),se(tt,sr,Nr,ir,L(),pn,rr,kr)}function ge(tt){typeof tt=="object"&&tt!==null&&tt.$$typeof===ke&&tt._store&&(tt._store.validated=1)}var le=Zv(),ke=Symbol.for("react.transitional.element"),Re=Symbol.for("react.portal"),Ue=Symbol.for("react.fragment"),Pe=Symbol.for("react.strict_mode"),We=Symbol.for("react.profiler"),Tt=Symbol.for("react.consumer"),wt=Symbol.for("react.context"),St=Symbol.for("react.forward_ref"),Xt=Symbol.for("react.suspense"),cn=Symbol.for("react.suspense_list"),xt=Symbol.for("react.memo"),rn=Symbol.for("react.lazy"),Ut=Symbol.for("react.activity"),Yt=Symbol.for("react.client.reference"),Rt=le.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ln=Object.prototype.hasOwnProperty,An=Array.isArray,mn=console.createTask?console.createTask:function(){return null};le={"react-stack-bottom-frame":function(tt){return tt()}};var $t,Nt={},Kt=le["react-stack-bottom-frame"].bind(le,$)(),It=mn(k($)),sn={};qx.Fragment=Ue,qx.jsx=function(tt,un,pn,Vt,ir){var Nr=1e4>Rt.recentlyCreatedOwnerStacks++;return fe(tt,un,pn,!1,Vt,ir,Nr?Error("react-stack-top-frame"):Kt,Nr?mn(k(tt)):It)},qx.jsxs=function(tt,un,pn,Vt,ir){var Nr=1e4>Rt.recentlyCreatedOwnerStacks++;return fe(tt,un,pn,!0,Vt,ir,Nr?Error("react-stack-top-frame"):Kt,Nr?mn(k(tt)):It)}}(),qx}var wE;function e2(){return wE||(wE=1,NS.exports=QR()),NS.exports}var ei=e2();function BA(g,y=[]){let T=[];function k($,X){const a=Fe.createContext(X),ee=T.length;T=[...T,X];const se=ge=>{var We;const{scope:le,children:ke,...Re}=ge,Ue=((We=le==null?void 0:le[g])==null?void 0:We[ee])||a,Pe=Fe.useMemo(()=>Re,Object.values(Re));return ei.jsx(Ue.Provider,{value:Pe,children:ke})};se.displayName=$+"Provider";function fe(ge,le){var Ue;const ke=((Ue=le==null?void 0:le[g])==null?void 0:Ue[ee])||a,Re=Fe.useContext(ke);if(Re)return Re;if(X!==void 0)return X;throw new Error(`\`${ge}\` must be used within \`${$}\``)}return[se,fe]}const L=()=>{const $=T.map(X=>Fe.createContext(X));return function(a){const ee=(a==null?void 0:a[g])||$;return Fe.useMemo(()=>({[`__scope${g}`]:{...a,[g]:ee}}),[a,ee])}};return L.scopeName=g,[k,t2(L,...y)]}function t2(...g){const y=g[0];if(g.length===1)return y;const T=()=>{const k=g.map(L=>({useScope:L(),scopeName:L.scopeName}));return function($){const X=k.reduce((a,{useScope:ee,scopeName:se})=>{const ge=ee($)[`__scope${se}`];return{...a,...ge}},{});return Fe.useMemo(()=>({[`__scope${y.scopeName}`]:X}),[X])}};return T.scopeName=y.scopeName,T}function QS(g){const y=n2(g),T=Fe.forwardRef((k,L)=>{const{children:$,...X}=k,a=Fe.Children.toArray($),ee=a.find(i2);if(ee){const se=ee.props.children,fe=a.map(ge=>ge===ee?Fe.Children.count(se)>1?Fe.Children.only(null):Fe.isValidElement(se)?se.props.children:null:ge);return ei.jsx(y,{...X,ref:L,children:Fe.isValidElement(se)?Fe.cloneElement(se,void 0,fe):null})}return ei.jsx(y,{...X,ref:L,children:$})});return T.displayName=`${g}.Slot`,T}function n2(g){const y=Fe.forwardRef((T,k)=>{const{children:L,...$}=T;if(Fe.isValidElement(L)){const X=s2(L),a=o2($,L.props);return L.type!==Fe.Fragment&&(a.ref=k?LA(k,X):X),Fe.cloneElement(L,a)}return Fe.Children.count(L)>1?Fe.Children.only(null):null});return y.displayName=`${g}.SlotClone`,y}var r2=Symbol("radix.slottable");function i2(g){return Fe.isValidElement(g)&&typeof g.type=="function"&&"__radixId"in g.type&&g.type.__radixId===r2}function o2(g,y){const T={...y};for(const k in y){const L=g[k],$=y[k];/^on[A-Z]/.test(k)?L&&$?T[k]=(...a)=>{$(...a),L(...a)}:L&&(T[k]=L):k==="style"?T[k]={...L,...$}:k==="className"&&(T[k]=[L,$].filter(Boolean).join(" "))}return{...g,...T}}function s2(g){var k,L;let y=(k=Object.getOwnPropertyDescriptor(g.props,"ref"))==null?void 0:k.get,T=y&&"isReactWarning"in y&&y.isReactWarning;return T?g.ref:(y=(L=Object.getOwnPropertyDescriptor(g,"ref"))==null?void 0:L.get,T=y&&"isReactWarning"in y&&y.isReactWarning,T?g.props.ref:g.props.ref||g.ref)}function a2(g){const y=g+"CollectionProvider",[T,k]=BA(y),[L,$]=T(y,{collectionRef:{current:null},itemMap:new Map}),X=Ue=>{const{scope:Pe,children:We}=Ue,Tt=Np.useRef(null),wt=Np.useRef(new Map).current;return ei.jsx(L,{scope:Pe,itemMap:wt,collectionRef:Tt,children:We})};X.displayName=y;const a=g+"CollectionSlot",ee=QS(a),se=Np.forwardRef((Ue,Pe)=>{const{scope:We,children:Tt}=Ue,wt=$(a,We),St=hy(Pe,wt.collectionRef);return ei.jsx(ee,{ref:St,children:Tt})});se.displayName=a;const fe=g+"CollectionItemSlot",ge="data-radix-collection-item",le=QS(fe),ke=Np.forwardRef((Ue,Pe)=>{const{scope:We,children:Tt,...wt}=Ue,St=Np.useRef(null),Xt=hy(Pe,St),cn=$(fe,We);return Np.useEffect(()=>(cn.itemMap.set(St,{ref:St,...wt}),()=>void cn.itemMap.delete(St))),ei.jsx(le,{[ge]:"",ref:Xt,children:Tt})});ke.displayName=fe;function Re(Ue){const Pe=$(g+"CollectionConsumer",Ue);return Np.useCallback(()=>{const Tt=Pe.collectionRef.current;if(!Tt)return[];const wt=Array.from(Tt.querySelectorAll(`[${ge}]`));return Array.from(Pe.itemMap.values()).sort((cn,xt)=>wt.indexOf(cn.ref.current)-wt.indexOf(xt.ref.current))},[Pe.collectionRef,Pe.itemMap])}return[{Provider:X,Slot:se,ItemSlot:ke},Re,k]}var l2=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],cf=l2.reduce((g,y)=>{const T=QS(`Primitive.${y}`),k=Fe.forwardRef((L,$)=>{const{asChild:X,...a}=L,ee=X?T:y;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),ei.jsx(ee,{...a,ref:$})});return k.displayName=`Primitive.${y}`,{...g,[y]:k}},{});function FA(g,y){g&&zT.flushSync(()=>g.dispatchEvent(y))}function fy(g){const y=Fe.useRef(g);return Fe.useEffect(()=>{y.current=g}),Fe.useMemo(()=>(...T)=>{var k;return(k=y.current)==null?void 0:k.call(y,...T)},[])}function c2(g,y=globalThis==null?void 0:globalThis.document){const T=fy(g);Fe.useEffect(()=>{const k=L=>{L.key==="Escape"&&T(L)};return y.addEventListener("keydown",k,{capture:!0}),()=>y.removeEventListener("keydown",k,{capture:!0})},[T,y])}var u2="DismissableLayer",eT="dismissableLayer.update",d2="dismissableLayer.pointerDownOutside",h2="dismissableLayer.focusOutside",SE,UA=Fe.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),jA=Fe.forwardRef((g,y)=>{const{disableOutsidePointerEvents:T=!1,onEscapeKeyDown:k,onPointerDownOutside:L,onFocusOutside:$,onInteractOutside:X,onDismiss:a,...ee}=g,se=Fe.useContext(UA),[fe,ge]=Fe.useState(null),le=(fe==null?void 0:fe.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,ke]=Fe.useState({}),Re=hy(y,xt=>ge(xt)),Ue=Array.from(se.layers),[Pe]=[...se.layersWithOutsidePointerEventsDisabled].slice(-1),We=Ue.indexOf(Pe),Tt=fe?Ue.indexOf(fe):-1,wt=se.layersWithOutsidePointerEventsDisabled.size>0,St=Tt>=We,Xt=p2(xt=>{const rn=xt.target,Ut=[...se.branches].some(Yt=>Yt.contains(rn));!St||Ut||(L==null||L(xt),X==null||X(xt),xt.defaultPrevented||a==null||a())},le),cn=m2(xt=>{const rn=xt.target;[...se.branches].some(Yt=>Yt.contains(rn))||($==null||$(xt),X==null||X(xt),xt.defaultPrevented||a==null||a())},le);return c2(xt=>{Tt===se.layers.size-1&&(k==null||k(xt),!xt.defaultPrevented&&a&&(xt.preventDefault(),a()))},le),Fe.useEffect(()=>{if(fe)return T&&(se.layersWithOutsidePointerEventsDisabled.size===0&&(SE=le.body.style.pointerEvents,le.body.style.pointerEvents="none"),se.layersWithOutsidePointerEventsDisabled.add(fe)),se.layers.add(fe),TE(),()=>{T&&se.layersWithOutsidePointerEventsDisabled.size===1&&(le.body.style.pointerEvents=SE)}},[fe,le,T,se]),Fe.useEffect(()=>()=>{fe&&(se.layers.delete(fe),se.layersWithOutsidePointerEventsDisabled.delete(fe),TE())},[fe,se]),Fe.useEffect(()=>{const xt=()=>ke({});return document.addEventListener(eT,xt),()=>document.removeEventListener(eT,xt)},[]),ei.jsx(cf.div,{...ee,ref:Re,style:{pointerEvents:wt?St?"auto":"none":void 0,...g.style},onFocusCapture:Bc(g.onFocusCapture,cn.onFocusCapture),onBlurCapture:Bc(g.onBlurCapture,cn.onBlurCapture),onPointerDownCapture:Bc(g.onPointerDownCapture,Xt.onPointerDownCapture)})});jA.displayName=u2;var f2="DismissableLayerBranch",VA=Fe.forwardRef((g,y)=>{const T=Fe.useContext(UA),k=Fe.useRef(null),L=hy(y,k);return Fe.useEffect(()=>{const $=k.current;if($)return T.branches.add($),()=>{T.branches.delete($)}},[T.branches]),ei.jsx(cf.div,{...g,ref:L})});VA.displayName=f2;function p2(g,y=globalThis==null?void 0:globalThis.document){const T=fy(g),k=Fe.useRef(!1),L=Fe.useRef(()=>{});return Fe.useEffect(()=>{const $=a=>{if(a.target&&!k.current){let ee=function(){qA(d2,T,se,{discrete:!0})};const se={originalEvent:a};a.pointerType==="touch"?(y.removeEventListener("click",L.current),L.current=ee,y.addEventListener("click",L.current,{once:!0})):ee()}else y.removeEventListener("click",L.current);k.current=!1},X=window.setTimeout(()=>{y.addEventListener("pointerdown",$)},0);return()=>{window.clearTimeout(X),y.removeEventListener("pointerdown",$),y.removeEventListener("click",L.current)}},[y,T]),{onPointerDownCapture:()=>k.current=!0}}function m2(g,y=globalThis==null?void 0:globalThis.document){const T=fy(g),k=Fe.useRef(!1);return Fe.useEffect(()=>{const L=$=>{$.target&&!k.current&&qA(h2,T,{originalEvent:$},{discrete:!1})};return y.addEventListener("focusin",L),()=>y.removeEventListener("focusin",L)},[y,T]),{onFocusCapture:()=>k.current=!0,onBlurCapture:()=>k.current=!1}}function TE(){const g=new CustomEvent(eT);document.dispatchEvent(g)}function qA(g,y,T,{discrete:k}){const L=T.originalEvent.target,$=new CustomEvent(g,{bubbles:!1,cancelable:!0,detail:T});y&&L.addEventListener(g,y,{once:!0}),k?FA(L,$):L.dispatchEvent($)}var g2=jA,_2=VA,nb=globalThis!=null&&globalThis.document?Fe.useLayoutEffect:()=>{},y2="Portal",HA=Fe.forwardRef((g,y)=>{var a;const{container:T,...k}=g,[L,$]=Fe.useState(!1);nb(()=>$(!0),[]);const X=T||L&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return X?IR.createPortal(ei.jsx(cf.div,{...k,ref:y}),X):null});HA.displayName=y2;function v2(g,y){return Fe.useReducer((T,k)=>y[T][k]??T,g)}var GA=g=>{const{present:y,children:T}=g,k=x2(y),L=typeof T=="function"?T({present:k.isPresent}):Fe.Children.only(T),$=hy(k.ref,b2(L));return typeof T=="function"||k.isPresent?Fe.cloneElement(L,{ref:$}):null};GA.displayName="Presence";function x2(g){const[y,T]=Fe.useState(),k=Fe.useRef(null),L=Fe.useRef(g),$=Fe.useRef("none"),X=g?"mounted":"unmounted",[a,ee]=v2(X,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return Fe.useEffect(()=>{const se=Z1(k.current);$.current=a==="mounted"?se:"none"},[a]),nb(()=>{const se=k.current,fe=L.current;if(fe!==g){const le=$.current,ke=Z1(se);g?ee("MOUNT"):ke==="none"||(se==null?void 0:se.display)==="none"?ee("UNMOUNT"):ee(fe&&le!==ke?"ANIMATION_OUT":"UNMOUNT"),L.current=g}},[g,ee]),nb(()=>{if(y){let se;const fe=y.ownerDocument.defaultView??window,ge=ke=>{const Ue=Z1(k.current).includes(ke.animationName);if(ke.target===y&&Ue&&(ee("ANIMATION_END"),!L.current)){const Pe=y.style.animationFillMode;y.style.animationFillMode="forwards",se=fe.setTimeout(()=>{y.style.animationFillMode==="forwards"&&(y.style.animationFillMode=Pe)})}},le=ke=>{ke.target===y&&($.current=Z1(k.current))};return y.addEventListener("animationstart",le),y.addEventListener("animationcancel",ge),y.addEventListener("animationend",ge),()=>{fe.clearTimeout(se),y.removeEventListener("animationstart",le),y.removeEventListener("animationcancel",ge),y.removeEventListener("animationend",ge)}}else ee("ANIMATION_END")},[y,ee]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:Fe.useCallback(se=>{k.current=se?getComputedStyle(se):null,T(se)},[])}}function Z1(g){return(g==null?void 0:g.animationName)||"none"}function b2(g){var k,L;let y=(k=Object.getOwnPropertyDescriptor(g.props,"ref"))==null?void 0:k.get,T=y&&"isReactWarning"in y&&y.isReactWarning;return T?g.ref:(y=(L=Object.getOwnPropertyDescriptor(g,"ref"))==null?void 0:L.get,T=y&&"isReactWarning"in y&&y.isReactWarning,T?g.props.ref:g.props.ref||g.ref)}var w2=eM[" useInsertionEffect ".trim().toString()]||nb;function S2({prop:g,defaultProp:y,onChange:T=()=>{},caller:k}){const[L,$,X]=T2({defaultProp:y,onChange:T}),a=g!==void 0,ee=a?g:L;{const fe=Fe.useRef(g!==void 0);Fe.useEffect(()=>{const ge=fe.current;ge!==a&&console.warn(`${k} is changing from ${ge?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),fe.current=a},[a,k])}const se=Fe.useCallback(fe=>{var ge;if(a){const le=E2(fe)?fe(g):fe;le!==g&&((ge=X.current)==null||ge.call(X,le))}else $(fe)},[a,g,$,X]);return[ee,se]}function T2({defaultProp:g,onChange:y}){const[T,k]=Fe.useState(g),L=Fe.useRef(T),$=Fe.useRef(y);return w2(()=>{$.current=y},[y]),Fe.useEffect(()=>{var X;L.current!==T&&((X=$.current)==null||X.call($,T),L.current=T)},[T,L]),[T,k,$]}function E2(g){return typeof g=="function"}var A2=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),C2="VisuallyHidden",LT=Fe.forwardRef((g,y)=>ei.jsx(cf.span,{...g,ref:y,style:{...A2,...g.style}}));LT.displayName=C2;var BT="ToastProvider",[FT,D2,M2]=a2("Toast"),[$A,yz]=BA("Toast",[M2]),[R2,Nw]=$A(BT),ZA=g=>{const{__scopeToast:y,label:T="Notification",duration:k=5e3,swipeDirection:L="right",swipeThreshold:$=50,children:X}=g,[a,ee]=Fe.useState(null),[se,fe]=Fe.useState(0),ge=Fe.useRef(!1),le=Fe.useRef(!1);return T.trim()||console.error(`Invalid prop \`label\` supplied to \`${BT}\`. Expected non-empty \`string\`.`),ei.jsx(FT.Provider,{scope:y,children:ei.jsx(R2,{scope:y,label:T,duration:k,swipeDirection:L,swipeThreshold:$,toastCount:se,viewport:a,onViewportChange:ee,onToastAdd:Fe.useCallback(()=>fe(ke=>ke+1),[]),onToastRemove:Fe.useCallback(()=>fe(ke=>ke-1),[]),isFocusedToastEscapeKeyDownRef:ge,isClosePausedRef:le,children:X})})};ZA.displayName=BT;var YA="ToastViewport",k2=["F8"],tT="toast.viewportPause",nT="toast.viewportResume",WA=Fe.forwardRef((g,y)=>{const{__scopeToast:T,hotkey:k=k2,label:L="Notifications ({hotkey})",...$}=g,X=Nw(YA,T),a=D2(T),ee=Fe.useRef(null),se=Fe.useRef(null),fe=Fe.useRef(null),ge=Fe.useRef(null),le=hy(y,ge,X.onViewportChange),ke=k.join("+").replace(/Key/g,"").replace(/Digit/g,""),Re=X.toastCount>0;Fe.useEffect(()=>{const Pe=We=>{var wt;k.length!==0&&k.every(St=>We[St]||We.code===St)&&((wt=ge.current)==null||wt.focus())};return document.addEventListener("keydown",Pe),()=>document.removeEventListener("keydown",Pe)},[k]),Fe.useEffect(()=>{const Pe=ee.current,We=ge.current;if(Re&&Pe&&We){const Tt=()=>{if(!X.isClosePausedRef.current){const cn=new CustomEvent(tT);We.dispatchEvent(cn),X.isClosePausedRef.current=!0}},wt=()=>{if(X.isClosePausedRef.current){const cn=new CustomEvent(nT);We.dispatchEvent(cn),X.isClosePausedRef.current=!1}},St=cn=>{!Pe.contains(cn.relatedTarget)&&wt()},Xt=()=>{Pe.contains(document.activeElement)||wt()};return Pe.addEventListener("focusin",Tt),Pe.addEventListener("focusout",St),Pe.addEventListener("pointermove",Tt),Pe.addEventListener("pointerleave",Xt),window.addEventListener("blur",Tt),window.addEventListener("focus",wt),()=>{Pe.removeEventListener("focusin",Tt),Pe.removeEventListener("focusout",St),Pe.removeEventListener("pointermove",Tt),Pe.removeEventListener("pointerleave",Xt),window.removeEventListener("blur",Tt),window.removeEventListener("focus",wt)}}},[Re,X.isClosePausedRef]);const Ue=Fe.useCallback(({tabbingDirection:Pe})=>{const Tt=a().map(wt=>{const St=wt.ref.current,Xt=[St,...H2(St)];return Pe==="forwards"?Xt:Xt.reverse()});return(Pe==="forwards"?Tt.reverse():Tt).flat()},[a]);return Fe.useEffect(()=>{const Pe=ge.current;if(Pe){const We=Tt=>{var Xt,cn,xt;const wt=Tt.altKey||Tt.ctrlKey||Tt.metaKey;if(Tt.key==="Tab"&&!wt){const rn=document.activeElement,Ut=Tt.shiftKey;if(Tt.target===Pe&&Ut){(Xt=se.current)==null||Xt.focus();return}const ln=Ue({tabbingDirection:Ut?"backwards":"forwards"}),An=ln.findIndex(mn=>mn===rn);zS(ln.slice(An+1))?Tt.preventDefault():Ut?(cn=se.current)==null||cn.focus():(xt=fe.current)==null||xt.focus()}};return Pe.addEventListener("keydown",We),()=>Pe.removeEventListener("keydown",We)}},[a,Ue]),ei.jsxs(_2,{ref:ee,role:"region","aria-label":L.replace("{hotkey}",ke),tabIndex:-1,style:{pointerEvents:Re?void 0:"none"},children:[Re&&ei.jsx(rT,{ref:se,onFocusFromOutsideViewport:()=>{const Pe=Ue({tabbingDirection:"forwards"});zS(Pe)}}),ei.jsx(FT.Slot,{scope:T,children:ei.jsx(cf.ol,{tabIndex:-1,...$,ref:le})}),Re&&ei.jsx(rT,{ref:fe,onFocusFromOutsideViewport:()=>{const Pe=Ue({tabbingDirection:"backwards"});zS(Pe)}})]})});WA.displayName=YA;var XA="ToastFocusProxy",rT=Fe.forwardRef((g,y)=>{const{__scopeToast:T,onFocusFromOutsideViewport:k,...L}=g,$=Nw(XA,T);return ei.jsx(LT,{"aria-hidden":!0,tabIndex:0,...L,ref:y,style:{position:"fixed"},onFocus:X=>{var se;const a=X.relatedTarget;!((se=$.viewport)!=null&&se.contains(a))&&k()}})});rT.displayName=XA;var ub="Toast",O2="toast.swipeStart",I2="toast.swipeMove",N2="toast.swipeCancel",z2="toast.swipeEnd",KA=Fe.forwardRef((g,y)=>{const{forceMount:T,open:k,defaultOpen:L,onOpenChange:$,...X}=g,[a,ee]=S2({prop:k,defaultProp:L??!0,onChange:$,caller:ub});return ei.jsx(GA,{present:T||a,children:ei.jsx(B2,{open:a,...X,ref:y,onClose:()=>ee(!1),onPause:fy(g.onPause),onResume:fy(g.onResume),onSwipeStart:Bc(g.onSwipeStart,se=>{se.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Bc(g.onSwipeMove,se=>{const{x:fe,y:ge}=se.detail.delta;se.currentTarget.setAttribute("data-swipe","move"),se.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${fe}px`),se.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${ge}px`)}),onSwipeCancel:Bc(g.onSwipeCancel,se=>{se.currentTarget.setAttribute("data-swipe","cancel"),se.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),se.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),se.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),se.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Bc(g.onSwipeEnd,se=>{const{x:fe,y:ge}=se.detail.delta;se.currentTarget.setAttribute("data-swipe","end"),se.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),se.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),se.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${fe}px`),se.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${ge}px`),ee(!1)})})})});KA.displayName=ub;var[P2,L2]=$A(ub,{onClose(){}}),B2=Fe.forwardRef((g,y)=>{const{__scopeToast:T,type:k="foreground",duration:L,open:$,onClose:X,onEscapeKeyDown:a,onPause:ee,onResume:se,onSwipeStart:fe,onSwipeMove:ge,onSwipeCancel:le,onSwipeEnd:ke,...Re}=g,Ue=Nw(ub,T),[Pe,We]=Fe.useState(null),Tt=hy(y,mn=>We(mn)),wt=Fe.useRef(null),St=Fe.useRef(null),Xt=L||Ue.duration,cn=Fe.useRef(0),xt=Fe.useRef(Xt),rn=Fe.useRef(0),{onToastAdd:Ut,onToastRemove:Yt}=Ue,Rt=fy(()=>{var $t;(Pe==null?void 0:Pe.contains(document.activeElement))&&(($t=Ue.viewport)==null||$t.focus()),X()}),ln=Fe.useCallback(mn=>{!mn||mn===1/0||(window.clearTimeout(rn.current),cn.current=new Date().getTime(),rn.current=window.setTimeout(Rt,mn))},[Rt]);Fe.useEffect(()=>{const mn=Ue.viewport;if(mn){const $t=()=>{ln(xt.current),se==null||se()},Nt=()=>{const Kt=new Date().getTime()-cn.current;xt.current=xt.current-Kt,window.clearTimeout(rn.current),ee==null||ee()};return mn.addEventListener(tT,Nt),mn.addEventListener(nT,$t),()=>{mn.removeEventListener(tT,Nt),mn.removeEventListener(nT,$t)}}},[Ue.viewport,Xt,ee,se,ln]),Fe.useEffect(()=>{$&&!Ue.isClosePausedRef.current&&ln(Xt)},[$,Xt,Ue.isClosePausedRef,ln]),Fe.useEffect(()=>(Ut(),()=>Yt()),[Ut,Yt]);const An=Fe.useMemo(()=>Pe?iC(Pe):null,[Pe]);return Ue.viewport?ei.jsxs(ei.Fragment,{children:[An&&ei.jsx(F2,{__scopeToast:T,role:"status","aria-live":k==="foreground"?"assertive":"polite","aria-atomic":!0,children:An}),ei.jsx(P2,{scope:T,onClose:Rt,children:zT.createPortal(ei.jsx(FT.ItemSlot,{scope:T,children:ei.jsx(g2,{asChild:!0,onEscapeKeyDown:Bc(a,()=>{Ue.isFocusedToastEscapeKeyDownRef.current||Rt(),Ue.isFocusedToastEscapeKeyDownRef.current=!1}),children:ei.jsx(cf.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":$?"open":"closed","data-swipe-direction":Ue.swipeDirection,...Re,ref:Tt,style:{userSelect:"none",touchAction:"none",...g.style},onKeyDown:Bc(g.onKeyDown,mn=>{mn.key==="Escape"&&(a==null||a(mn.nativeEvent),mn.nativeEvent.defaultPrevented||(Ue.isFocusedToastEscapeKeyDownRef.current=!0,Rt()))}),onPointerDown:Bc(g.onPointerDown,mn=>{mn.button===0&&(wt.current={x:mn.clientX,y:mn.clientY})}),onPointerMove:Bc(g.onPointerMove,mn=>{if(!wt.current)return;const $t=mn.clientX-wt.current.x,Nt=mn.clientY-wt.current.y,Kt=!!St.current,It=["left","right"].includes(Ue.swipeDirection),sn=["left","up"].includes(Ue.swipeDirection)?Math.min:Math.max,tt=It?sn(0,$t):0,un=It?0:sn(0,Nt),pn=mn.pointerType==="touch"?10:2,Vt={x:tt,y:un},ir={originalEvent:mn,delta:Vt};Kt?(St.current=Vt,Y1(I2,ge,ir,{discrete:!1})):EE(Vt,Ue.swipeDirection,pn)?(St.current=Vt,Y1(O2,fe,ir,{discrete:!1}),mn.target.setPointerCapture(mn.pointerId)):(Math.abs($t)>pn||Math.abs(Nt)>pn)&&(wt.current=null)}),onPointerUp:Bc(g.onPointerUp,mn=>{const $t=St.current,Nt=mn.target;if(Nt.hasPointerCapture(mn.pointerId)&&Nt.releasePointerCapture(mn.pointerId),St.current=null,wt.current=null,$t){const Kt=mn.currentTarget,It={originalEvent:mn,delta:$t};EE($t,Ue.swipeDirection,Ue.swipeThreshold)?Y1(z2,ke,It,{discrete:!0}):Y1(N2,le,It,{discrete:!0}),Kt.addEventListener("click",sn=>sn.preventDefault(),{once:!0})}})})})}),Ue.viewport)})]}):null}),F2=g=>{const{__scopeToast:y,children:T,...k}=g,L=Nw(ub,y),[$,X]=Fe.useState(!1),[a,ee]=Fe.useState(!1);return V2(()=>X(!0)),Fe.useEffect(()=>{const se=window.setTimeout(()=>ee(!0),1e3);return()=>window.clearTimeout(se)},[]),a?null:ei.jsx(HA,{asChild:!0,children:ei.jsx(LT,{...k,children:$&&ei.jsxs(ei.Fragment,{children:[L.label," ",T]})})})},U2="ToastTitle",JA=Fe.forwardRef((g,y)=>{const{__scopeToast:T,...k}=g;return ei.jsx(cf.div,{...k,ref:y})});JA.displayName=U2;var j2="ToastDescription",QA=Fe.forwardRef((g,y)=>{const{__scopeToast:T,...k}=g;return ei.jsx(cf.div,{...k,ref:y})});QA.displayName=j2;var eC="ToastAction",tC=Fe.forwardRef((g,y)=>{const{altText:T,...k}=g;return T.trim()?ei.jsx(rC,{altText:T,asChild:!0,children:ei.jsx(UT,{...k,ref:y})}):(console.error(`Invalid prop \`altText\` supplied to \`${eC}\`. Expected non-empty \`string\`.`),null)});tC.displayName=eC;var nC="ToastClose",UT=Fe.forwardRef((g,y)=>{const{__scopeToast:T,...k}=g,L=L2(nC,T);return ei.jsx(rC,{asChild:!0,children:ei.jsx(cf.button,{type:"button",...k,ref:y,onClick:Bc(g.onClick,L.onClose)})})});UT.displayName=nC;var rC=Fe.forwardRef((g,y)=>{const{__scopeToast:T,altText:k,...L}=g;return ei.jsx(cf.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":k||void 0,...L,ref:y})});function iC(g){const y=[];return Array.from(g.childNodes).forEach(k=>{if(k.nodeType===k.TEXT_NODE&&k.textContent&&y.push(k.textContent),q2(k)){const L=k.ariaHidden||k.hidden||k.style.display==="none",$=k.dataset.radixToastAnnounceExclude==="";if(!L)if($){const X=k.dataset.radixToastAnnounceAlt;X&&y.push(X)}else y.push(...iC(k))}}),y}function Y1(g,y,T,{discrete:k}){const L=T.originalEvent.currentTarget,$=new CustomEvent(g,{bubbles:!0,cancelable:!0,detail:T});y&&L.addEventListener(g,y,{once:!0}),k?FA(L,$):L.dispatchEvent($)}var EE=(g,y,T=0)=>{const k=Math.abs(g.x),L=Math.abs(g.y),$=k>L;return y==="left"||y==="right"?$&&k>T:!$&&L>T};function V2(g=()=>{}){const y=fy(g);nb(()=>{let T=0,k=0;return T=window.requestAnimationFrame(()=>k=window.requestAnimationFrame(y)),()=>{window.cancelAnimationFrame(T),window.cancelAnimationFrame(k)}},[y])}function q2(g){return g.nodeType===g.ELEMENT_NODE}function H2(g){const y=[],T=document.createTreeWalker(g,NodeFilter.SHOW_ELEMENT,{acceptNode:k=>{const L=k.tagName==="INPUT"&&k.type==="hidden";return k.disabled||k.hidden||L?NodeFilter.FILTER_SKIP:k.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;T.nextNode();)y.push(T.currentNode);return y}function zS(g){const y=document.activeElement;return g.some(T=>T===y?!0:(T.focus(),document.activeElement!==y))}var G2=ZA,oC=WA,sC=KA,aC=JA,lC=QA,cC=tC,uC=UT;function dC(g){var y,T,k="";if(typeof g=="string"||typeof g=="number")k+=g;else if(typeof g=="object")if(Array.isArray(g)){var L=g.length;for(y=0;y<L;y++)g[y]&&(T=dC(g[y]))&&(k&&(k+=" "),k+=T)}else for(T in g)g[T]&&(k&&(k+=" "),k+=T);return k}function hC(){for(var g,y,T=0,k="",L=arguments.length;T<L;T++)(g=arguments[T])&&(y=dC(g))&&(k&&(k+=" "),k+=y);return k}const AE=g=>typeof g=="boolean"?`${g}`:g===0?"0":g,CE=hC,$2=(g,y)=>T=>{var k;if((y==null?void 0:y.variants)==null)return CE(g,T==null?void 0:T.class,T==null?void 0:T.className);const{variants:L,defaultVariants:$}=y,X=Object.keys(L).map(se=>{const fe=T==null?void 0:T[se],ge=$==null?void 0:$[se];if(fe===null)return null;const le=AE(fe)||AE(ge);return L[se][le]}),a=T&&Object.entries(T).reduce((se,fe)=>{let[ge,le]=fe;return le===void 0||(se[ge]=le),se},{}),ee=y==null||(k=y.compoundVariants)===null||k===void 0?void 0:k.reduce((se,fe)=>{let{class:ge,className:le,...ke}=fe;return Object.entries(ke).every(Re=>{let[Ue,Pe]=Re;return Array.isArray(Pe)?Pe.includes({...$,...a}[Ue]):{...$,...a}[Ue]===Pe})?[...se,ge,le]:se},[]);return CE(g,X,ee,T==null?void 0:T.class,T==null?void 0:T.className)};/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z2=g=>g.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Y2=g=>g.replace(/^([A-Z])|[\s-_]+(\w)/g,(y,T,k)=>k?k.toUpperCase():T.toLowerCase()),DE=g=>{const y=Y2(g);return y.charAt(0).toUpperCase()+y.slice(1)},fC=(...g)=>g.filter((y,T,k)=>!!y&&y.trim()!==""&&k.indexOf(y)===T).join(" ").trim(),W2=g=>{for(const y in g)if(y.startsWith("aria-")||y==="role"||y==="title")return!0};/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var X2={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K2=Fe.forwardRef(({color:g="currentColor",size:y=24,strokeWidth:T=2,absoluteStrokeWidth:k,className:L="",children:$,iconNode:X,...a},ee)=>Fe.createElement("svg",{ref:ee,...X2,width:y,height:y,stroke:g,strokeWidth:k?Number(T)*24/Number(y):T,className:fC("lucide",L),...!$&&!W2(a)&&{"aria-hidden":"true"},...a},[...X.map(([se,fe])=>Fe.createElement(se,fe)),...Array.isArray($)?$:[$]]));/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ms=(g,y)=>{const T=Fe.forwardRef(({className:k,...L},$)=>Fe.createElement(K2,{ref:$,iconNode:y,className:fC(`lucide-${Z2(DE(g))}`,`lucide-${g}`,k),...L}));return T.displayName=DE(g),T};/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J2=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Q2=Ms("arrow-right",J2);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ek=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],tk=Ms("bell",ek);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nk=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],pC=Ms("check",nk);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rk=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],mC=Ms("circle-alert",rk);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ik=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]],ok=Ms("circle-stop",ik);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sk=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],gC=Ms("clock",sk);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ak=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],lk=Ms("eye",ak);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ck=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]],ME=Ms("house",ck);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uk=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],dk=Ms("loader",uk);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hk=[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]],RE=Ms("log-out",hk);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fk=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],pk=Ms("map-pin",fk);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mk=[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]],gk=Ms("menu",mk);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _k=[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],yk=Ms("mic",_k);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vk=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],iT=Ms("navigation",vk);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xk=[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]],bk=Ms("phone",xk);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wk=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Sk=Ms("save",wk);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tk=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],rb=Ms("triangle-alert",Tk);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ek=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Sw=Ms("user",Ek);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ak=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],zw=Ms("x",Ak),jT="-",Ck=g=>{const y=Mk(g),{conflictingClassGroups:T,conflictingClassGroupModifiers:k}=g;return{getClassGroupId:X=>{const a=X.split(jT);return a[0]===""&&a.length!==1&&a.shift(),_C(a,y)||Dk(X)},getConflictingClassGroupIds:(X,a)=>{const ee=T[X]||[];return a&&k[X]?[...ee,...k[X]]:ee}}},_C=(g,y)=>{var X;if(g.length===0)return y.classGroupId;const T=g[0],k=y.nextPart.get(T),L=k?_C(g.slice(1),k):void 0;if(L)return L;if(y.validators.length===0)return;const $=g.join(jT);return(X=y.validators.find(({validator:a})=>a($)))==null?void 0:X.classGroupId},kE=/^\[(.+)\]$/,Dk=g=>{if(kE.test(g)){const y=kE.exec(g)[1],T=y==null?void 0:y.substring(0,y.indexOf(":"));if(T)return"arbitrary.."+T}},Mk=g=>{const{theme:y,classGroups:T}=g,k={nextPart:new Map,validators:[]};for(const L in T)oT(T[L],k,L,y);return k},oT=(g,y,T,k)=>{g.forEach(L=>{if(typeof L=="string"){const $=L===""?y:OE(y,L);$.classGroupId=T;return}if(typeof L=="function"){if(Rk(L)){oT(L(k),y,T,k);return}y.validators.push({validator:L,classGroupId:T});return}Object.entries(L).forEach(([$,X])=>{oT(X,OE(y,$),T,k)})})},OE=(g,y)=>{let T=g;return y.split(jT).forEach(k=>{T.nextPart.has(k)||T.nextPart.set(k,{nextPart:new Map,validators:[]}),T=T.nextPart.get(k)}),T},Rk=g=>g.isThemeGetter,kk=g=>{if(g<1)return{get:()=>{},set:()=>{}};let y=0,T=new Map,k=new Map;const L=($,X)=>{T.set($,X),y++,y>g&&(y=0,k=T,T=new Map)};return{get($){let X=T.get($);if(X!==void 0)return X;if((X=k.get($))!==void 0)return L($,X),X},set($,X){T.has($)?T.set($,X):L($,X)}}},sT="!",aT=":",Ok=aT.length,Ik=g=>{const{prefix:y,experimentalParseClassName:T}=g;let k=L=>{const $=[];let X=0,a=0,ee=0,se;for(let Re=0;Re<L.length;Re++){let Ue=L[Re];if(X===0&&a===0){if(Ue===aT){$.push(L.slice(ee,Re)),ee=Re+Ok;continue}if(Ue==="/"){se=Re;continue}}Ue==="["?X++:Ue==="]"?X--:Ue==="("?a++:Ue===")"&&a--}const fe=$.length===0?L:L.substring(ee),ge=Nk(fe),le=ge!==fe,ke=se&&se>ee?se-ee:void 0;return{modifiers:$,hasImportantModifier:le,baseClassName:ge,maybePostfixModifierPosition:ke}};if(y){const L=y+aT,$=k;k=X=>X.startsWith(L)?$(X.substring(L.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:X,maybePostfixModifierPosition:void 0}}if(T){const L=k;k=$=>T({className:$,parseClassName:L})}return k},Nk=g=>g.endsWith(sT)?g.substring(0,g.length-1):g.startsWith(sT)?g.substring(1):g,zk=g=>{const y=Object.fromEntries(g.orderSensitiveModifiers.map(k=>[k,!0]));return k=>{if(k.length<=1)return k;const L=[];let $=[];return k.forEach(X=>{X[0]==="["||y[X]?(L.push(...$.sort(),X),$=[]):$.push(X)}),L.push(...$.sort()),L}},Pk=g=>({cache:kk(g.cacheSize),parseClassName:Ik(g),sortModifiers:zk(g),...Ck(g)}),Lk=/\s+/,Bk=(g,y)=>{const{parseClassName:T,getClassGroupId:k,getConflictingClassGroupIds:L,sortModifiers:$}=y,X=[],a=g.trim().split(Lk);let ee="";for(let se=a.length-1;se>=0;se-=1){const fe=a[se],{isExternal:ge,modifiers:le,hasImportantModifier:ke,baseClassName:Re,maybePostfixModifierPosition:Ue}=T(fe);if(ge){ee=fe+(ee.length>0?" "+ee:ee);continue}let Pe=!!Ue,We=k(Pe?Re.substring(0,Ue):Re);if(!We){if(!Pe){ee=fe+(ee.length>0?" "+ee:ee);continue}if(We=k(Re),!We){ee=fe+(ee.length>0?" "+ee:ee);continue}Pe=!1}const Tt=$(le).join(":"),wt=ke?Tt+sT:Tt,St=wt+We;if(X.includes(St))continue;X.push(St);const Xt=L(We,Pe);for(let cn=0;cn<Xt.length;++cn){const xt=Xt[cn];X.push(wt+xt)}ee=fe+(ee.length>0?" "+ee:ee)}return ee};function Fk(){let g=0,y,T,k="";for(;g<arguments.length;)(y=arguments[g++])&&(T=yC(y))&&(k&&(k+=" "),k+=T);return k}const yC=g=>{if(typeof g=="string")return g;let y,T="";for(let k=0;k<g.length;k++)g[k]&&(y=yC(g[k]))&&(T&&(T+=" "),T+=y);return T};function Uk(g,...y){let T,k,L,$=X;function X(ee){const se=y.reduce((fe,ge)=>ge(fe),g());return T=Pk(se),k=T.cache.get,L=T.cache.set,$=a,a(ee)}function a(ee){const se=k(ee);if(se)return se;const fe=Bk(ee,T);return L(ee,fe),fe}return function(){return $(Fk.apply(null,arguments))}}const Ds=g=>{const y=T=>T[g]||[];return y.isThemeGetter=!0,y},vC=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,xC=/^\((?:(\w[\w-]*):)?(.+)\)$/i,jk=/^\d+\/\d+$/,Vk=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,qk=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Hk=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Gk=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,$k=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Hv=g=>jk.test(g),Qr=g=>!!g&&!Number.isNaN(Number(g)),bg=g=>!!g&&Number.isInteger(Number(g)),PS=g=>g.endsWith("%")&&Qr(g.slice(0,-1)),Ip=g=>Vk.test(g),Zk=()=>!0,Yk=g=>qk.test(g)&&!Hk.test(g),bC=()=>!1,Wk=g=>Gk.test(g),Xk=g=>$k.test(g),Kk=g=>!Zn(g)&&!Yn(g),Jk=g=>Kv(g,TC,bC),Zn=g=>vC.test(g),sy=g=>Kv(g,EC,Yk),LS=g=>Kv(g,rO,Qr),IE=g=>Kv(g,wC,bC),Qk=g=>Kv(g,SC,Xk),W1=g=>Kv(g,AC,Wk),Yn=g=>xC.test(g),Hx=g=>Jv(g,EC),eO=g=>Jv(g,iO),NE=g=>Jv(g,wC),tO=g=>Jv(g,TC),nO=g=>Jv(g,SC),X1=g=>Jv(g,AC,!0),Kv=(g,y,T)=>{const k=vC.exec(g);return k?k[1]?y(k[1]):T(k[2]):!1},Jv=(g,y,T=!1)=>{const k=xC.exec(g);return k?k[1]?y(k[1]):T:!1},wC=g=>g==="position"||g==="percentage",SC=g=>g==="image"||g==="url",TC=g=>g==="length"||g==="size"||g==="bg-size",EC=g=>g==="length",rO=g=>g==="number",iO=g=>g==="family-name",AC=g=>g==="shadow",oO=()=>{const g=Ds("color"),y=Ds("font"),T=Ds("text"),k=Ds("font-weight"),L=Ds("tracking"),$=Ds("leading"),X=Ds("breakpoint"),a=Ds("container"),ee=Ds("spacing"),se=Ds("radius"),fe=Ds("shadow"),ge=Ds("inset-shadow"),le=Ds("text-shadow"),ke=Ds("drop-shadow"),Re=Ds("blur"),Ue=Ds("perspective"),Pe=Ds("aspect"),We=Ds("ease"),Tt=Ds("animate"),wt=()=>["auto","avoid","all","avoid-page","page","left","right","column"],St=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],Xt=()=>[...St(),Yn,Zn],cn=()=>["auto","hidden","clip","visible","scroll"],xt=()=>["auto","contain","none"],rn=()=>[Yn,Zn,ee],Ut=()=>[Hv,"full","auto",...rn()],Yt=()=>[bg,"none","subgrid",Yn,Zn],Rt=()=>["auto",{span:["full",bg,Yn,Zn]},bg,Yn,Zn],ln=()=>[bg,"auto",Yn,Zn],An=()=>["auto","min","max","fr",Yn,Zn],mn=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],$t=()=>["start","end","center","stretch","center-safe","end-safe"],Nt=()=>["auto",...rn()],Kt=()=>[Hv,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...rn()],It=()=>[g,Yn,Zn],sn=()=>[...St(),NE,IE,{position:[Yn,Zn]}],tt=()=>["no-repeat",{repeat:["","x","y","space","round"]}],un=()=>["auto","cover","contain",tO,Jk,{size:[Yn,Zn]}],pn=()=>[PS,Hx,sy],Vt=()=>["","none","full",se,Yn,Zn],ir=()=>["",Qr,Hx,sy],Nr=()=>["solid","dashed","dotted","double"],rr=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],kr=()=>[Qr,PS,NE,IE],sr=()=>["","none",Re,Yn,Zn],Yr=()=>["none",Qr,Yn,Zn],de=()=>["none",Qr,Yn,Zn],po=()=>[Qr,Yn,Zn],Uo=()=>[Hv,"full",...rn()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Ip],breakpoint:[Ip],color:[Zk],container:[Ip],"drop-shadow":[Ip],ease:["in","out","in-out"],font:[Kk],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Ip],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Ip],shadow:[Ip],spacing:["px",Qr],text:[Ip],"text-shadow":[Ip],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",Hv,Zn,Yn,Pe]}],container:["container"],columns:[{columns:[Qr,Zn,Yn,a]}],"break-after":[{"break-after":wt()}],"break-before":[{"break-before":wt()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:Xt()}],overflow:[{overflow:cn()}],"overflow-x":[{"overflow-x":cn()}],"overflow-y":[{"overflow-y":cn()}],overscroll:[{overscroll:xt()}],"overscroll-x":[{"overscroll-x":xt()}],"overscroll-y":[{"overscroll-y":xt()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:Ut()}],"inset-x":[{"inset-x":Ut()}],"inset-y":[{"inset-y":Ut()}],start:[{start:Ut()}],end:[{end:Ut()}],top:[{top:Ut()}],right:[{right:Ut()}],bottom:[{bottom:Ut()}],left:[{left:Ut()}],visibility:["visible","invisible","collapse"],z:[{z:[bg,"auto",Yn,Zn]}],basis:[{basis:[Hv,"full","auto",a,...rn()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[Qr,Hv,"auto","initial","none",Zn]}],grow:[{grow:["",Qr,Yn,Zn]}],shrink:[{shrink:["",Qr,Yn,Zn]}],order:[{order:[bg,"first","last","none",Yn,Zn]}],"grid-cols":[{"grid-cols":Yt()}],"col-start-end":[{col:Rt()}],"col-start":[{"col-start":ln()}],"col-end":[{"col-end":ln()}],"grid-rows":[{"grid-rows":Yt()}],"row-start-end":[{row:Rt()}],"row-start":[{"row-start":ln()}],"row-end":[{"row-end":ln()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":An()}],"auto-rows":[{"auto-rows":An()}],gap:[{gap:rn()}],"gap-x":[{"gap-x":rn()}],"gap-y":[{"gap-y":rn()}],"justify-content":[{justify:[...mn(),"normal"]}],"justify-items":[{"justify-items":[...$t(),"normal"]}],"justify-self":[{"justify-self":["auto",...$t()]}],"align-content":[{content:["normal",...mn()]}],"align-items":[{items:[...$t(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...$t(),{baseline:["","last"]}]}],"place-content":[{"place-content":mn()}],"place-items":[{"place-items":[...$t(),"baseline"]}],"place-self":[{"place-self":["auto",...$t()]}],p:[{p:rn()}],px:[{px:rn()}],py:[{py:rn()}],ps:[{ps:rn()}],pe:[{pe:rn()}],pt:[{pt:rn()}],pr:[{pr:rn()}],pb:[{pb:rn()}],pl:[{pl:rn()}],m:[{m:Nt()}],mx:[{mx:Nt()}],my:[{my:Nt()}],ms:[{ms:Nt()}],me:[{me:Nt()}],mt:[{mt:Nt()}],mr:[{mr:Nt()}],mb:[{mb:Nt()}],ml:[{ml:Nt()}],"space-x":[{"space-x":rn()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":rn()}],"space-y-reverse":["space-y-reverse"],size:[{size:Kt()}],w:[{w:[a,"screen",...Kt()]}],"min-w":[{"min-w":[a,"screen","none",...Kt()]}],"max-w":[{"max-w":[a,"screen","none","prose",{screen:[X]},...Kt()]}],h:[{h:["screen",...Kt()]}],"min-h":[{"min-h":["screen","none",...Kt()]}],"max-h":[{"max-h":["screen",...Kt()]}],"font-size":[{text:["base",T,Hx,sy]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[k,Yn,LS]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",PS,Zn]}],"font-family":[{font:[eO,Zn,y]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[L,Yn,Zn]}],"line-clamp":[{"line-clamp":[Qr,"none",Yn,LS]}],leading:[{leading:[$,...rn()]}],"list-image":[{"list-image":["none",Yn,Zn]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",Yn,Zn]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:It()}],"text-color":[{text:It()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Nr(),"wavy"]}],"text-decoration-thickness":[{decoration:[Qr,"from-font","auto",Yn,sy]}],"text-decoration-color":[{decoration:It()}],"underline-offset":[{"underline-offset":[Qr,"auto",Yn,Zn]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:rn()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Yn,Zn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Yn,Zn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:sn()}],"bg-repeat":[{bg:tt()}],"bg-size":[{bg:un()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},bg,Yn,Zn],radial:["",Yn,Zn],conic:[bg,Yn,Zn]},nO,Qk]}],"bg-color":[{bg:It()}],"gradient-from-pos":[{from:pn()}],"gradient-via-pos":[{via:pn()}],"gradient-to-pos":[{to:pn()}],"gradient-from":[{from:It()}],"gradient-via":[{via:It()}],"gradient-to":[{to:It()}],rounded:[{rounded:Vt()}],"rounded-s":[{"rounded-s":Vt()}],"rounded-e":[{"rounded-e":Vt()}],"rounded-t":[{"rounded-t":Vt()}],"rounded-r":[{"rounded-r":Vt()}],"rounded-b":[{"rounded-b":Vt()}],"rounded-l":[{"rounded-l":Vt()}],"rounded-ss":[{"rounded-ss":Vt()}],"rounded-se":[{"rounded-se":Vt()}],"rounded-ee":[{"rounded-ee":Vt()}],"rounded-es":[{"rounded-es":Vt()}],"rounded-tl":[{"rounded-tl":Vt()}],"rounded-tr":[{"rounded-tr":Vt()}],"rounded-br":[{"rounded-br":Vt()}],"rounded-bl":[{"rounded-bl":Vt()}],"border-w":[{border:ir()}],"border-w-x":[{"border-x":ir()}],"border-w-y":[{"border-y":ir()}],"border-w-s":[{"border-s":ir()}],"border-w-e":[{"border-e":ir()}],"border-w-t":[{"border-t":ir()}],"border-w-r":[{"border-r":ir()}],"border-w-b":[{"border-b":ir()}],"border-w-l":[{"border-l":ir()}],"divide-x":[{"divide-x":ir()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":ir()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...Nr(),"hidden","none"]}],"divide-style":[{divide:[...Nr(),"hidden","none"]}],"border-color":[{border:It()}],"border-color-x":[{"border-x":It()}],"border-color-y":[{"border-y":It()}],"border-color-s":[{"border-s":It()}],"border-color-e":[{"border-e":It()}],"border-color-t":[{"border-t":It()}],"border-color-r":[{"border-r":It()}],"border-color-b":[{"border-b":It()}],"border-color-l":[{"border-l":It()}],"divide-color":[{divide:It()}],"outline-style":[{outline:[...Nr(),"none","hidden"]}],"outline-offset":[{"outline-offset":[Qr,Yn,Zn]}],"outline-w":[{outline:["",Qr,Hx,sy]}],"outline-color":[{outline:It()}],shadow:[{shadow:["","none",fe,X1,W1]}],"shadow-color":[{shadow:It()}],"inset-shadow":[{"inset-shadow":["none",ge,X1,W1]}],"inset-shadow-color":[{"inset-shadow":It()}],"ring-w":[{ring:ir()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:It()}],"ring-offset-w":[{"ring-offset":[Qr,sy]}],"ring-offset-color":[{"ring-offset":It()}],"inset-ring-w":[{"inset-ring":ir()}],"inset-ring-color":[{"inset-ring":It()}],"text-shadow":[{"text-shadow":["none",le,X1,W1]}],"text-shadow-color":[{"text-shadow":It()}],opacity:[{opacity:[Qr,Yn,Zn]}],"mix-blend":[{"mix-blend":[...rr(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":rr()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[Qr]}],"mask-image-linear-from-pos":[{"mask-linear-from":kr()}],"mask-image-linear-to-pos":[{"mask-linear-to":kr()}],"mask-image-linear-from-color":[{"mask-linear-from":It()}],"mask-image-linear-to-color":[{"mask-linear-to":It()}],"mask-image-t-from-pos":[{"mask-t-from":kr()}],"mask-image-t-to-pos":[{"mask-t-to":kr()}],"mask-image-t-from-color":[{"mask-t-from":It()}],"mask-image-t-to-color":[{"mask-t-to":It()}],"mask-image-r-from-pos":[{"mask-r-from":kr()}],"mask-image-r-to-pos":[{"mask-r-to":kr()}],"mask-image-r-from-color":[{"mask-r-from":It()}],"mask-image-r-to-color":[{"mask-r-to":It()}],"mask-image-b-from-pos":[{"mask-b-from":kr()}],"mask-image-b-to-pos":[{"mask-b-to":kr()}],"mask-image-b-from-color":[{"mask-b-from":It()}],"mask-image-b-to-color":[{"mask-b-to":It()}],"mask-image-l-from-pos":[{"mask-l-from":kr()}],"mask-image-l-to-pos":[{"mask-l-to":kr()}],"mask-image-l-from-color":[{"mask-l-from":It()}],"mask-image-l-to-color":[{"mask-l-to":It()}],"mask-image-x-from-pos":[{"mask-x-from":kr()}],"mask-image-x-to-pos":[{"mask-x-to":kr()}],"mask-image-x-from-color":[{"mask-x-from":It()}],"mask-image-x-to-color":[{"mask-x-to":It()}],"mask-image-y-from-pos":[{"mask-y-from":kr()}],"mask-image-y-to-pos":[{"mask-y-to":kr()}],"mask-image-y-from-color":[{"mask-y-from":It()}],"mask-image-y-to-color":[{"mask-y-to":It()}],"mask-image-radial":[{"mask-radial":[Yn,Zn]}],"mask-image-radial-from-pos":[{"mask-radial-from":kr()}],"mask-image-radial-to-pos":[{"mask-radial-to":kr()}],"mask-image-radial-from-color":[{"mask-radial-from":It()}],"mask-image-radial-to-color":[{"mask-radial-to":It()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":St()}],"mask-image-conic-pos":[{"mask-conic":[Qr]}],"mask-image-conic-from-pos":[{"mask-conic-from":kr()}],"mask-image-conic-to-pos":[{"mask-conic-to":kr()}],"mask-image-conic-from-color":[{"mask-conic-from":It()}],"mask-image-conic-to-color":[{"mask-conic-to":It()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:sn()}],"mask-repeat":[{mask:tt()}],"mask-size":[{mask:un()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",Yn,Zn]}],filter:[{filter:["","none",Yn,Zn]}],blur:[{blur:sr()}],brightness:[{brightness:[Qr,Yn,Zn]}],contrast:[{contrast:[Qr,Yn,Zn]}],"drop-shadow":[{"drop-shadow":["","none",ke,X1,W1]}],"drop-shadow-color":[{"drop-shadow":It()}],grayscale:[{grayscale:["",Qr,Yn,Zn]}],"hue-rotate":[{"hue-rotate":[Qr,Yn,Zn]}],invert:[{invert:["",Qr,Yn,Zn]}],saturate:[{saturate:[Qr,Yn,Zn]}],sepia:[{sepia:["",Qr,Yn,Zn]}],"backdrop-filter":[{"backdrop-filter":["","none",Yn,Zn]}],"backdrop-blur":[{"backdrop-blur":sr()}],"backdrop-brightness":[{"backdrop-brightness":[Qr,Yn,Zn]}],"backdrop-contrast":[{"backdrop-contrast":[Qr,Yn,Zn]}],"backdrop-grayscale":[{"backdrop-grayscale":["",Qr,Yn,Zn]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Qr,Yn,Zn]}],"backdrop-invert":[{"backdrop-invert":["",Qr,Yn,Zn]}],"backdrop-opacity":[{"backdrop-opacity":[Qr,Yn,Zn]}],"backdrop-saturate":[{"backdrop-saturate":[Qr,Yn,Zn]}],"backdrop-sepia":[{"backdrop-sepia":["",Qr,Yn,Zn]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":rn()}],"border-spacing-x":[{"border-spacing-x":rn()}],"border-spacing-y":[{"border-spacing-y":rn()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",Yn,Zn]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[Qr,"initial",Yn,Zn]}],ease:[{ease:["linear","initial",We,Yn,Zn]}],delay:[{delay:[Qr,Yn,Zn]}],animate:[{animate:["none",Tt,Yn,Zn]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[Ue,Yn,Zn]}],"perspective-origin":[{"perspective-origin":Xt()}],rotate:[{rotate:Yr()}],"rotate-x":[{"rotate-x":Yr()}],"rotate-y":[{"rotate-y":Yr()}],"rotate-z":[{"rotate-z":Yr()}],scale:[{scale:de()}],"scale-x":[{"scale-x":de()}],"scale-y":[{"scale-y":de()}],"scale-z":[{"scale-z":de()}],"scale-3d":["scale-3d"],skew:[{skew:po()}],"skew-x":[{"skew-x":po()}],"skew-y":[{"skew-y":po()}],transform:[{transform:[Yn,Zn,"","none","gpu","cpu"]}],"transform-origin":[{origin:Xt()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:Uo()}],"translate-x":[{"translate-x":Uo()}],"translate-y":[{"translate-y":Uo()}],"translate-z":[{"translate-z":Uo()}],"translate-none":["translate-none"],accent:[{accent:It()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:It()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Yn,Zn]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":rn()}],"scroll-mx":[{"scroll-mx":rn()}],"scroll-my":[{"scroll-my":rn()}],"scroll-ms":[{"scroll-ms":rn()}],"scroll-me":[{"scroll-me":rn()}],"scroll-mt":[{"scroll-mt":rn()}],"scroll-mr":[{"scroll-mr":rn()}],"scroll-mb":[{"scroll-mb":rn()}],"scroll-ml":[{"scroll-ml":rn()}],"scroll-p":[{"scroll-p":rn()}],"scroll-px":[{"scroll-px":rn()}],"scroll-py":[{"scroll-py":rn()}],"scroll-ps":[{"scroll-ps":rn()}],"scroll-pe":[{"scroll-pe":rn()}],"scroll-pt":[{"scroll-pt":rn()}],"scroll-pr":[{"scroll-pr":rn()}],"scroll-pb":[{"scroll-pb":rn()}],"scroll-pl":[{"scroll-pl":rn()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Yn,Zn]}],fill:[{fill:["none",...It()]}],"stroke-w":[{stroke:[Qr,Hx,sy,LS]}],stroke:[{stroke:["none",...It()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},sO=Uk(oO);function Qv(...g){return sO(hC(g))}const aO=G2,CC=Fe.forwardRef(({className:g,...y},T)=>he.jsxDEV(oC,{ref:T,className:Qv("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",g),...y},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/ui/toast.jsx",lineNumber:10,columnNumber:3},void 0));CC.displayName=oC.displayName;const lO=$2("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),DC=Fe.forwardRef(({className:g,variant:y,...T},k)=>he.jsxDEV(sC,{ref:k,className:Qv(lO({variant:y}),g),...T},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/ui/toast.jsx",lineNumber:39,columnNumber:5},void 0));DC.displayName=sC.displayName;const cO=Fe.forwardRef(({className:g,...y},T)=>he.jsxDEV(cC,{ref:T,className:Qv("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",g),...y},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/ui/toast.jsx",lineNumber:49,columnNumber:3},void 0));cO.displayName=cC.displayName;const MC=Fe.forwardRef(({className:g,...y},T)=>he.jsxDEV(uC,{ref:T,className:Qv("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",g),"toast-close":"",...y,children:he.jsxDEV(zw,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/ui/toast.jsx",lineNumber:70,columnNumber:5},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/ui/toast.jsx",lineNumber:61,columnNumber:3},void 0));MC.displayName=uC.displayName;const RC=Fe.forwardRef(({className:g,...y},T)=>he.jsxDEV(aC,{ref:T,className:Qv("text-sm font-semibold",g),...y},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/ui/toast.jsx",lineNumber:76,columnNumber:3},void 0));RC.displayName=aC.displayName;const kC=Fe.forwardRef(({className:g,...y},T)=>he.jsxDEV(lC,{ref:T,className:Qv("text-sm opacity-90",g),...y},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/ui/toast.jsx",lineNumber:85,columnNumber:3},void 0));kC.displayName=lC.displayName;const uO=5,dO=1e6,zp={ADD_TOAST:"ADD_TOAST",UPDATE_TOAST:"UPDATE_TOAST",DISMISS_TOAST:"DISMISS_TOAST",REMOVE_TOAST:"REMOVE_TOAST"};let BS=0;function hO(){return BS=(BS+1)%Number.MAX_SAFE_INTEGER,BS.toString()}const FS=new Map,zE=g=>{if(FS.has(g))return;const y=setTimeout(()=>{FS.delete(g),Kx({type:zp.REMOVE_TOAST,toastId:g})},dO);FS.set(g,y)},fO=(g,y)=>{switch(y.type){case zp.ADD_TOAST:return{...g,toasts:[y.toast,...g.toasts].slice(0,uO)};case zp.UPDATE_TOAST:return{...g,toasts:g.toasts.map(T=>T.id===y.toast.id?{...T,...y.toast}:T)};case zp.DISMISS_TOAST:{const{toastId:T}=y;return T?zE(T):g.toasts.forEach(k=>{zE(k.id)}),{...g,toasts:g.toasts.map(k=>k.id===T||T===void 0?{...k,open:!1}:k)}}case zp.REMOVE_TOAST:return y.toastId===void 0?{...g,toasts:[]}:{...g,toasts:g.toasts.filter(T=>T.id!==y.toastId)}}},iw=[];let ow={toasts:[]};function Kx(g){ow=fO(ow,g),iw.forEach(y=>{y(ow)})}function pO({...g}){const y=hO(),T=L=>Kx({type:zp.UPDATE_TOAST,toast:{...L,id:y}}),k=()=>Kx({type:zp.DISMISS_TOAST,toastId:y});return Kx({type:zp.ADD_TOAST,toast:{...g,id:y,open:!0,onOpenChange:L=>{L||k()}}}),{id:y,dismiss:k,update:T}}function mO(){const[g,y]=Fe.useState(ow);return Fe.useEffect(()=>(iw.push(y),()=>{const T=iw.indexOf(y);T>-1&&iw.splice(T,1)}),[g]),{...g,toast:pO,dismiss:T=>Kx({type:zp.DISMISS_TOAST,toastId:T})}}function gO(){const{toasts:g}=mO();return he.jsxDEV(aO,{children:[g.map(function({id:y,title:T,description:k,action:L,...$}){return he.jsxDEV(DC,{...$,children:[he.jsxDEV("div",{className:"grid gap-1",children:[T&&he.jsxDEV(RC,{children:T},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/ui/toaster.jsx",lineNumber:20,columnNumber:25},this),k&&he.jsxDEV(kC,{children:k},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/ui/toaster.jsx",lineNumber:22,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/ui/toaster.jsx",lineNumber:19,columnNumber:13},this),L,he.jsxDEV(MC,{},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/ui/toaster.jsx",lineNumber:26,columnNumber:13},this)]},y,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/ui/toaster.jsx",lineNumber:18,columnNumber:11},this)}),he.jsxDEV(CC,{},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/ui/toaster.jsx",lineNumber:30,columnNumber:7},this)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/ui/toaster.jsx",lineNumber:15,columnNumber:5},this)}var _O=typeof Symbol=="function"&&Symbol.observable||"@@observable",PE=_O,US=()=>Math.random().toString(36).substring(7).split("").join("."),yO={INIT:`@@redux/INIT${US()}`,REPLACE:`@@redux/REPLACE${US()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${US()}`},uy=yO;function db(g){if(typeof g!="object"||g===null)return!1;let y=g;for(;Object.getPrototypeOf(y)!==null;)y=Object.getPrototypeOf(y);return Object.getPrototypeOf(g)===y||Object.getPrototypeOf(g)===null}function vO(g){if(g===void 0)return"undefined";if(g===null)return"null";const y=typeof g;switch(y){case"boolean":case"string":case"number":case"symbol":case"function":return y}if(Array.isArray(g))return"array";if(wO(g))return"date";if(bO(g))return"error";const T=xO(g);switch(T){case"Symbol":case"Promise":case"WeakMap":case"WeakSet":case"Map":case"Set":return T}return Object.prototype.toString.call(g).slice(8,-1).toLowerCase().replace(/\s/g,"")}function xO(g){return typeof g.constructor=="function"?g.constructor.name:null}function bO(g){return g instanceof Error||typeof g.message=="string"&&g.constructor&&typeof g.constructor.stackTraceLimit=="number"}function wO(g){return g instanceof Date?!0:typeof g.toDateString=="function"&&typeof g.getDate=="function"&&typeof g.setDate=="function"}function wg(g){let y=typeof g;return y=vO(g),y}function OC(g,y,T){if(typeof g!="function")throw new Error(`Expected the root reducer to be a function. Instead, received: '${wg(g)}'`);if(typeof y=="function"&&typeof T=="function"||typeof T=="function"&&typeof arguments[3]=="function")throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function. See https://redux.js.org/tutorials/fundamentals/part-4-store#creating-a-store-with-enhancers for an example.");if(typeof y=="function"&&typeof T>"u"&&(T=y,y=void 0),typeof T<"u"){if(typeof T!="function")throw new Error(`Expected the enhancer to be a function. Instead, received: '${wg(T)}'`);return T(OC)(g,y)}let k=g,L=y,$=new Map,X=$,a=0,ee=!1;function se(){X===$&&(X=new Map,$.forEach((Pe,We)=>{X.set(We,Pe)}))}function fe(){if(ee)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return L}function ge(Pe){if(typeof Pe!="function")throw new Error(`Expected the listener to be a function. Instead, received: '${wg(Pe)}'`);if(ee)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api/store#subscribelistener for more details.");let We=!0;se();const Tt=a++;return X.set(Tt,Pe),function(){if(We){if(ee)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api/store#subscribelistener for more details.");We=!1,se(),X.delete(Tt),$=null}}}function le(Pe){if(!db(Pe))throw new Error(`Actions must be plain objects. Instead, the actual type was: '${wg(Pe)}'. You may need to add middleware to your store setup to handle dispatching other values, such as 'redux-thunk' to handle dispatching functions. See https://redux.js.org/tutorials/fundamentals/part-4-store#middleware and https://redux.js.org/tutorials/fundamentals/part-6-async-logic#using-the-redux-thunk-middleware for examples.`);if(typeof Pe.type>"u")throw new Error('Actions may not have an undefined "type" property. You may have misspelled an action type string constant.');if(typeof Pe.type!="string")throw new Error(`Action "type" property must be a string. Instead, the actual type was: '${wg(Pe.type)}'. Value was: '${Pe.type}' (stringified)`);if(ee)throw new Error("Reducers may not dispatch actions.");try{ee=!0,L=k(L,Pe)}finally{ee=!1}return($=X).forEach(Tt=>{Tt()}),Pe}function ke(Pe){if(typeof Pe!="function")throw new Error(`Expected the nextReducer to be a function. Instead, received: '${wg(Pe)}`);k=Pe,le({type:uy.REPLACE})}function Re(){const Pe=ge;return{subscribe(We){if(typeof We!="object"||We===null)throw new Error(`Expected the observer to be an object. Instead, received: '${wg(We)}'`);function Tt(){const St=We;St.next&&St.next(fe())}return Tt(),{unsubscribe:Pe(Tt)}},[PE](){return this}}}return le({type:uy.INIT}),{dispatch:le,subscribe:ge,getState:fe,replaceReducer:ke,[PE]:Re}}function LE(g){typeof console<"u"&&typeof console.error=="function"&&console.error(g);try{throw new Error(g)}catch{}}function SO(g,y,T,k){const L=Object.keys(y),$=T&&T.type===uy.INIT?"preloadedState argument passed to createStore":"previous state received by the reducer";if(L.length===0)return"Store does not have a valid reducer. Make sure the argument passed to combineReducers is an object whose values are reducers.";if(!db(g))return`The ${$} has unexpected type of "${wg(g)}". Expected argument to be an object with the following keys: "${L.join('", "')}"`;const X=Object.keys(g).filter(a=>!y.hasOwnProperty(a)&&!k[a]);if(X.forEach(a=>{k[a]=!0}),!(T&&T.type===uy.REPLACE)&&X.length>0)return`Unexpected ${X.length>1?"keys":"key"} "${X.join('", "')}" found in ${$}. Expected to find one of the known reducer keys instead: "${L.join('", "')}". Unexpected keys will be ignored.`}function TO(g){Object.keys(g).forEach(y=>{const T=g[y];if(typeof T(void 0,{type:uy.INIT})>"u")throw new Error(`The slice reducer for key "${y}" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.`);if(typeof T(void 0,{type:uy.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(`The slice reducer for key "${y}" returned undefined when probed with a random type. Don't try to handle '${uy.INIT}' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.`)})}function EO(g){const y=Object.keys(g),T={};for(let X=0;X<y.length;X++){const a=y[X];typeof g[a]>"u"&&LE(`No reducer provided for key "${a}"`),typeof g[a]=="function"&&(T[a]=g[a])}const k=Object.keys(T);let L;L={};let $;try{TO(T)}catch(X){$=X}return function(a={},ee){if($)throw $;{const ge=SO(a,T,ee,L);ge&&LE(ge)}let se=!1;const fe={};for(let ge=0;ge<k.length;ge++){const le=k[ge],ke=T[le],Re=a[le],Ue=ke(Re,ee);if(typeof Ue>"u"){const Pe=ee&&ee.type;throw new Error(`When called with an action of type ${Pe?`"${String(Pe)}"`:"(unknown type)"}, the slice reducer for key "${le}" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.`)}fe[le]=Ue,se=se||Ue!==Re}return se=se||k.length!==Object.keys(a).length,se?fe:a}}function Tw(...g){return g.length===0?y=>y:g.length===1?g[0]:g.reduce((y,T)=>(...k)=>y(T(...k)))}function AO(...g){return y=>(T,k)=>{const L=y(T,k);let $=()=>{throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")};const X={getState:L.getState,dispatch:(ee,...se)=>$(ee,...se)},a=g.map(ee=>ee(X));return $=Tw(...a)(L.dispatch),{...L,dispatch:$}}}function IC(g){return db(g)&&"type"in g&&typeof g.type=="string"}var NC=Symbol.for("immer-nothing"),BE=Symbol.for("immer-draftable"),Fc=Symbol.for("immer-state"),CO=[function(g){return`The plugin for '${g}' has not been loaded into Immer. To enable the plugin, import and call \`enable${g}()\` when initializing your application.`},function(g){return`produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '${g}'`},"This object has been frozen and should not be mutated",function(g){return"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+g},"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.","Immer forbids circular references","The first or second argument to `produce` must be a function","The third argument to `produce` must be a function or undefined","First argument to `createDraft` must be a plain object, an array, or an immerable object","First argument to `finishDraft` must be a draft returned by `createDraft`",function(g){return`'current' expects a draft, got: ${g}`},"Object.defineProperty() cannot be used on an Immer draft","Object.setPrototypeOf() cannot be used on an Immer draft","Immer only supports deleting array indices","Immer only supports setting array indices and the 'length' property",function(g){return`'original' expects a draft, got: ${g}`}];function oc(g,...y){{const T=CO[g],k=typeof T=="function"?T.apply(null,y):T;throw new Error(`[Immer] ${k}`)}}var $v=Object.getPrototypeOf;function py(g){return!!g&&!!g[Fc]}function Bp(g){var y;return g?zC(g)||Array.isArray(g)||!!g[BE]||!!((y=g.constructor)!=null&&y[BE])||Lw(g)||Bw(g):!1}var DO=Object.prototype.constructor.toString();function zC(g){if(!g||typeof g!="object")return!1;const y=$v(g);if(y===null)return!0;const T=Object.hasOwnProperty.call(y,"constructor")&&y.constructor;return T===Object?!0:typeof T=="function"&&Function.toString.call(T)===DO}function Ew(g,y){Pw(g)===0?Reflect.ownKeys(g).forEach(T=>{y(T,g[T],g)}):g.forEach((T,k)=>y(k,T,g))}function Pw(g){const y=g[Fc];return y?y.type_:Array.isArray(g)?1:Lw(g)?2:Bw(g)?3:0}function lT(g,y){return Pw(g)===2?g.has(y):Object.prototype.hasOwnProperty.call(g,y)}function PC(g,y,T){const k=Pw(g);k===2?g.set(y,T):k===3?g.add(T):g[y]=T}function MO(g,y){return g===y?g!==0||1/g===1/y:g!==g&&y!==y}function Lw(g){return g instanceof Map}function Bw(g){return g instanceof Set}function ly(g){return g.copy_||g.base_}function cT(g,y){if(Lw(g))return new Map(g);if(Bw(g))return new Set(g);if(Array.isArray(g))return Array.prototype.slice.call(g);const T=zC(g);if(y===!0||y==="class_only"&&!T){const k=Object.getOwnPropertyDescriptors(g);delete k[Fc];let L=Reflect.ownKeys(k);for(let $=0;$<L.length;$++){const X=L[$],a=k[X];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(k[X]={configurable:!0,writable:!0,enumerable:a.enumerable,value:g[X]})}return Object.create($v(g),k)}else{const k=$v(g);if(k!==null&&T)return{...g};const L=Object.create(k);return Object.assign(L,g)}}function VT(g,y=!1){return Fw(g)||py(g)||!Bp(g)||(Pw(g)>1&&(g.set=g.add=g.clear=g.delete=RO),Object.freeze(g),y&&Object.entries(g).forEach(([T,k])=>VT(k,!0))),g}function RO(){oc(2)}function Fw(g){return Object.isFrozen(g)}var kO={};function my(g){const y=kO[g];return y||oc(0,g),y}var ib;function LC(){return ib}function OO(g,y){return{drafts_:[],parent_:g,immer_:y,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function FE(g,y){y&&(my("Patches"),g.patches_=[],g.inversePatches_=[],g.patchListener_=y)}function uT(g){dT(g),g.drafts_.forEach(IO),g.drafts_=null}function dT(g){g===ib&&(ib=g.parent_)}function UE(g){return ib=OO(ib,g)}function IO(g){const y=g[Fc];y.type_===0||y.type_===1?y.revoke_():y.revoked_=!0}function jE(g,y){y.unfinalizedDrafts_=y.drafts_.length;const T=y.drafts_[0];return g!==void 0&&g!==T?(T[Fc].modified_&&(uT(y),oc(4)),Bp(g)&&(g=Aw(y,g),y.parent_||Cw(y,g)),y.patches_&&my("Patches").generateReplacementPatches_(T[Fc].base_,g,y.patches_,y.inversePatches_)):g=Aw(y,T,[]),uT(y),y.patches_&&y.patchListener_(y.patches_,y.inversePatches_),g!==NC?g:void 0}function Aw(g,y,T){if(Fw(y))return y;const k=y[Fc];if(!k)return Ew(y,(L,$)=>VE(g,k,y,L,$,T)),y;if(k.scope_!==g)return y;if(!k.modified_)return Cw(g,k.base_,!0),k.base_;if(!k.finalized_){k.finalized_=!0,k.scope_.unfinalizedDrafts_--;const L=k.copy_;let $=L,X=!1;k.type_===3&&($=new Set(L),L.clear(),X=!0),Ew($,(a,ee)=>VE(g,k,L,a,ee,T,X)),Cw(g,L,!1),T&&g.patches_&&my("Patches").generatePatches_(k,T,g.patches_,g.inversePatches_)}return k.copy_}function VE(g,y,T,k,L,$,X){if(L===T&&oc(5),py(L)){const a=$&&y&&y.type_!==3&&!lT(y.assigned_,k)?$.concat(k):void 0,ee=Aw(g,L,a);if(PC(T,k,ee),py(ee))g.canAutoFreeze_=!1;else return}else X&&T.add(L);if(Bp(L)&&!Fw(L)){if(!g.immer_.autoFreeze_&&g.unfinalizedDrafts_<1)return;Aw(g,L),(!y||!y.scope_.parent_)&&typeof k!="symbol"&&Object.prototype.propertyIsEnumerable.call(T,k)&&Cw(g,L)}}function Cw(g,y,T=!1){!g.parent_&&g.immer_.autoFreeze_&&g.canAutoFreeze_&&VT(y,T)}function NO(g,y){const T=Array.isArray(g),k={type_:T?1:0,scope_:y?y.scope_:LC(),modified_:!1,finalized_:!1,assigned_:{},parent_:y,base_:g,draft_:null,copy_:null,revoke_:null,isManual_:!1};let L=k,$=qT;T&&(L=[k],$=ob);const{revoke:X,proxy:a}=Proxy.revocable(L,$);return k.draft_=a,k.revoke_=X,a}var qT={get(g,y){if(y===Fc)return g;const T=ly(g);if(!lT(T,y))return zO(g,T,y);const k=T[y];return g.finalized_||!Bp(k)?k:k===jS(g.base_,y)?(VS(g),g.copy_[y]=fT(k,g)):k},has(g,y){return y in ly(g)},ownKeys(g){return Reflect.ownKeys(ly(g))},set(g,y,T){const k=BC(ly(g),y);if(k!=null&&k.set)return k.set.call(g.draft_,T),!0;if(!g.modified_){const L=jS(ly(g),y),$=L==null?void 0:L[Fc];if($&&$.base_===T)return g.copy_[y]=T,g.assigned_[y]=!1,!0;if(MO(T,L)&&(T!==void 0||lT(g.base_,y)))return!0;VS(g),hT(g)}return g.copy_[y]===T&&(T!==void 0||y in g.copy_)||Number.isNaN(T)&&Number.isNaN(g.copy_[y])||(g.copy_[y]=T,g.assigned_[y]=!0),!0},deleteProperty(g,y){return jS(g.base_,y)!==void 0||y in g.base_?(g.assigned_[y]=!1,VS(g),hT(g)):delete g.assigned_[y],g.copy_&&delete g.copy_[y],!0},getOwnPropertyDescriptor(g,y){const T=ly(g),k=Reflect.getOwnPropertyDescriptor(T,y);return k&&{writable:!0,configurable:g.type_!==1||y!=="length",enumerable:k.enumerable,value:T[y]}},defineProperty(){oc(11)},getPrototypeOf(g){return $v(g.base_)},setPrototypeOf(){oc(12)}},ob={};Ew(qT,(g,y)=>{ob[g]=function(){return arguments[0]=arguments[0][0],y.apply(this,arguments)}});ob.deleteProperty=function(g,y){return isNaN(parseInt(y))&&oc(13),ob.set.call(this,g,y,void 0)};ob.set=function(g,y,T){return y!=="length"&&isNaN(parseInt(y))&&oc(14),qT.set.call(this,g[0],y,T,g[0])};function jS(g,y){const T=g[Fc];return(T?ly(T):g)[y]}function zO(g,y,T){var L;const k=BC(y,T);return k?"value"in k?k.value:(L=k.get)==null?void 0:L.call(g.draft_):void 0}function BC(g,y){if(!(y in g))return;let T=$v(g);for(;T;){const k=Object.getOwnPropertyDescriptor(T,y);if(k)return k;T=$v(T)}}function hT(g){g.modified_||(g.modified_=!0,g.parent_&&hT(g.parent_))}function VS(g){g.copy_||(g.copy_=cT(g.base_,g.scope_.immer_.useStrictShallowCopy_))}var PO=class{constructor(g){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(y,T,k)=>{if(typeof y=="function"&&typeof T!="function"){const $=T;T=y;const X=this;return function(ee=$,...se){return X.produce(ee,fe=>T.call(this,fe,...se))}}typeof T!="function"&&oc(6),k!==void 0&&typeof k!="function"&&oc(7);let L;if(Bp(y)){const $=UE(this),X=fT(y,void 0);let a=!0;try{L=T(X),a=!1}finally{a?uT($):dT($)}return FE($,k),jE(L,$)}else if(!y||typeof y!="object"){if(L=T(y),L===void 0&&(L=y),L===NC&&(L=void 0),this.autoFreeze_&&VT(L,!0),k){const $=[],X=[];my("Patches").generateReplacementPatches_(y,L,$,X),k($,X)}return L}else oc(1,y)},this.produceWithPatches=(y,T)=>{if(typeof y=="function")return(X,...a)=>this.produceWithPatches(X,ee=>y(ee,...a));let k,L;return[this.produce(y,T,(X,a)=>{k=X,L=a}),k,L]},typeof(g==null?void 0:g.autoFreeze)=="boolean"&&this.setAutoFreeze(g.autoFreeze),typeof(g==null?void 0:g.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(g.useStrictShallowCopy)}createDraft(g){Bp(g)||oc(8),py(g)&&(g=LO(g));const y=UE(this),T=fT(g,void 0);return T[Fc].isManual_=!0,dT(y),T}finishDraft(g,y){const T=g&&g[Fc];(!T||!T.isManual_)&&oc(9);const{scope_:k}=T;return FE(k,y),jE(void 0,k)}setAutoFreeze(g){this.autoFreeze_=g}setUseStrictShallowCopy(g){this.useStrictShallowCopy_=g}applyPatches(g,y){let T;for(T=y.length-1;T>=0;T--){const L=y[T];if(L.path.length===0&&L.op==="replace"){g=L.value;break}}T>-1&&(y=y.slice(T+1));const k=my("Patches").applyPatches_;return py(g)?k(g,y):this.produce(g,L=>k(L,y))}};function fT(g,y){const T=Lw(g)?my("MapSet").proxyMap_(g,y):Bw(g)?my("MapSet").proxySet_(g,y):NO(g,y);return(y?y.scope_:LC()).drafts_.push(T),T}function LO(g){return py(g)||oc(10,g),FC(g)}function FC(g){if(!Bp(g)||Fw(g))return g;const y=g[Fc];let T;if(y){if(!y.modified_)return y.base_;y.finalized_=!0,T=cT(g,y.scope_.immer_.useStrictShallowCopy_)}else T=cT(g,!0);return Ew(T,(k,L)=>{PC(T,k,FC(L))}),y&&(y.finalized_=!1),T}var Uc=new PO,UC=Uc.produce;Uc.produceWithPatches.bind(Uc);Uc.setAutoFreeze.bind(Uc);Uc.setUseStrictShallowCopy.bind(Uc);Uc.applyPatches.bind(Uc);Uc.createDraft.bind(Uc);Uc.finishDraft.bind(Uc);function jC(g){return({dispatch:T,getState:k})=>L=>$=>typeof $=="function"?$(T,k,g):L($)}var BO=jC(),FO=jC,UO=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?Tw:Tw.apply(null,arguments)},VC=g=>g&&typeof g.match=="function";function Jx(g,y){function T(...k){if(y){let L=y(...k);if(!L)throw new Error("prepareAction did not return an object");return{type:g,payload:L.payload,..."meta"in L&&{meta:L.meta},..."error"in L&&{error:L.error}}}return{type:g,payload:k[0]}}return T.toString=()=>`${g}`,T.type=g,T.match=k=>IC(k)&&k.type===g,T}function jO(g){return typeof g=="function"&&"type"in g&&VC(g)}function VO(g){const y=g?`${g}`.split("/"):[],T=y[y.length-1]||"actionCreator";return`Detected an action creator with type "${g||"unknown"}" being dispatched. 
Make sure you're calling the action creator before dispatching, i.e. \`dispatch(${T}())\` instead of \`dispatch(${T})\`. This is necessary even if the action has no payload.`}function qO(g={}){const{isActionCreator:y=jO}=g;return()=>T=>k=>(y(k)&&console.warn(VO(k.type)),T(k))}function qC(g,y){let T=0;return{measureTime(k){const L=Date.now();try{return k()}finally{const $=Date.now();T+=$-L}},warnIfExceeded(){T>g&&console.warn(`${y} took ${T}ms, which is more than the warning threshold of ${g}ms. 
If your state or actions are very large, you may want to disable the middleware as it might cause too much of a slowdown in development mode. See https://redux-toolkit.js.org/api/getDefaultMiddleware for instructions.
It is disabled in production builds, so you don't need to worry about that.`)}}}var HC=class Yx extends Array{constructor(...y){super(...y),Object.setPrototypeOf(this,Yx.prototype)}static get[Symbol.species](){return Yx}concat(...y){return super.concat.apply(this,y)}prepend(...y){return y.length===1&&Array.isArray(y[0])?new Yx(...y[0].concat(this)):new Yx(...y.concat(this))}};function qE(g){return Bp(g)?UC(g,()=>{}):g}function K1(g,y,T){return g.has(y)?g.get(y):g.set(y,T(y)).get(y)}function HO(g){return typeof g!="object"||g==null||Object.isFrozen(g)}function GO(g,y,T){const k=GC(g,y,T);return{detectMutations(){return $C(g,y,k,T)}}}function GC(g,y=[],T,k="",L=new Set){const $={value:T};if(!g(T)&&!L.has(T)){L.add(T),$.children={};for(const X in T){const a=k?k+"."+X:X;y.length&&y.indexOf(a)!==-1||($.children[X]=GC(g,y,T[X],a))}}return $}function $C(g,y=[],T,k,L=!1,$=""){const X=T?T.value:void 0,a=X===k;if(L&&!a&&!Number.isNaN(k))return{wasMutated:!0,path:$};if(g(X)||g(k))return{wasMutated:!1};const ee={};for(let fe in T.children)ee[fe]=!0;for(let fe in k)ee[fe]=!0;const se=y.length>0;for(let fe in ee){const ge=$?$+"."+fe:fe;if(se&&y.some(Re=>Re instanceof RegExp?Re.test(ge):ge===Re))continue;const le=$C(g,y,T.children[fe],k[fe],a,ge);if(le.wasMutated)return le}return{wasMutated:!1}}function $O(g={}){{let y=function(a,ee,se,fe){return JSON.stringify(a,T(ee,fe),se)},T=function(a,ee){let se=[],fe=[];return ee||(ee=function(ge,le){return se[0]===le?"[Circular ~]":"[Circular ~."+fe.slice(0,se.indexOf(le)).join(".")+"]"}),function(ge,le){if(se.length>0){var ke=se.indexOf(this);~ke?se.splice(ke+1):se.push(this),~ke?fe.splice(ke,1/0,ge):fe.push(ge),~se.indexOf(le)&&(le=ee.call(this,ge,le))}else se.push(le);return a==null?le:a.call(this,ge,le)}},{isImmutable:k=HO,ignoredPaths:L,warnAfter:$=32}=g;const X=GO.bind(null,k,L);return({getState:a})=>{let ee=a(),se=X(ee),fe;return ge=>le=>{const ke=qC($,"ImmutableStateInvariantMiddleware");ke.measureTime(()=>{if(ee=a(),fe=se.detectMutations(),se=X(ee),fe.wasMutated)throw new Error(`A state mutation was detected between dispatches, in the path '${fe.path||""}'.  This may cause incorrect behavior. (https://redux.js.org/style-guide/style-guide#do-not-mutate-state)`)});const Re=ge(le);return ke.measureTime(()=>{if(ee=a(),fe=se.detectMutations(),se=X(ee),fe.wasMutated)throw new Error(`A state mutation was detected inside a dispatch, in the path: ${fe.path||""}. Take a look at the reducer(s) handling the action ${y(le)}. (https://redux.js.org/style-guide/style-guide#do-not-mutate-state)`)}),ke.warnIfExceeded(),Re}}}}function ZC(g){const y=typeof g;return g==null||y==="string"||y==="boolean"||y==="number"||Array.isArray(g)||db(g)}function pT(g,y="",T=ZC,k,L=[],$){let X;if(!T(g))return{keyPath:y||"<root>",value:g};if(typeof g!="object"||g===null||$!=null&&$.has(g))return!1;const a=k!=null?k(g):Object.entries(g),ee=L.length>0;for(const[se,fe]of a){const ge=y?y+"."+se:se;if(!(ee&&L.some(ke=>ke instanceof RegExp?ke.test(ge):ge===ke))){if(!T(fe))return{keyPath:ge,value:fe};if(typeof fe=="object"&&(X=pT(fe,ge,T,k,L,$),X))return X}}return $&&YC(g)&&$.add(g),!1}function YC(g){if(!Object.isFrozen(g))return!1;for(const y of Object.values(g))if(!(typeof y!="object"||y===null)&&!YC(y))return!1;return!0}function ZO(g={}){{const{isSerializable:y=ZC,getEntries:T,ignoredActions:k=[],ignoredActionPaths:L=["meta.arg","meta.baseQueryMeta"],ignoredPaths:$=[],warnAfter:X=32,ignoreState:a=!1,ignoreActions:ee=!1,disableCache:se=!1}=g,fe=!se&&WeakSet?new WeakSet:void 0;return ge=>le=>ke=>{if(!IC(ke))return le(ke);const Re=le(ke),Ue=qC(X,"SerializableStateInvariantMiddleware");return!ee&&!(k.length&&k.indexOf(ke.type)!==-1)&&Ue.measureTime(()=>{const Pe=pT(ke,"",y,T,L,fe);if(Pe){const{keyPath:We,value:Tt}=Pe;console.error(`A non-serializable value was detected in an action, in the path: \`${We}\`. Value:`,Tt,`
Take a look at the logic that dispatched this action: `,ke,`
(See https://redux.js.org/faq/actions#why-should-type-be-a-string-or-at-least-serializable-why-should-my-action-types-be-constants)`,`
(To allow non-serializable values see: https://redux-toolkit.js.org/usage/usage-guide#working-with-non-serializable-data)`)}}),a||(Ue.measureTime(()=>{const Pe=ge.getState(),We=pT(Pe,"",y,T,$,fe);if(We){const{keyPath:Tt,value:wt}=We;console.error(`A non-serializable value was detected in the state, in the path: \`${Tt}\`. Value:`,wt,`
Take a look at the reducer(s) handling this action type: ${ke.type}.
(See https://redux.js.org/faq/organizing-state#can-i-put-functions-promises-or-other-non-serializable-items-in-my-store-state)`)}}),Ue.warnIfExceeded()),Re}}}function J1(g){return typeof g=="boolean"}var YO=()=>function(y){const{thunk:T=!0,immutableCheck:k=!0,serializableCheck:L=!0,actionCreatorCheck:$=!0}=y??{};let X=new HC;T&&(J1(T)?X.push(BO):X.push(FO(T.extraArgument)));{if(k){let a={};J1(k)||(a=k),X.unshift($O(a))}if(L){let a={};J1(L)||(a=L),X.push(ZO(a))}if($){let a={};J1($)||(a=$),X.unshift(qO(a))}}return X},WO="RTK_autoBatch",HE=g=>y=>{setTimeout(y,g)},XO=(g={type:"raf"})=>y=>(...T)=>{const k=y(...T);let L=!0,$=!1,X=!1;const a=new Set,ee=g.type==="tick"?queueMicrotask:g.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:HE(10):g.type==="callback"?g.queueNotification:HE(g.timeout),se=()=>{X=!1,$&&($=!1,a.forEach(fe=>fe()))};return Object.assign({},k,{subscribe(fe){const ge=()=>L&&fe(),le=k.subscribe(ge);return a.add(fe),()=>{le(),a.delete(fe)}},dispatch(fe){var ge;try{return L=!((ge=fe==null?void 0:fe.meta)!=null&&ge[WO]),$=!L,$&&(X||(X=!0,ee(se))),k.dispatch(fe)}finally{L=!0}}})},KO=g=>function(T){const{autoBatch:k=!0}=T??{};let L=new HC(g);return k&&L.push(XO(typeof k=="object"?k:void 0)),L};function JO(g){const y=YO(),{reducer:T=void 0,middleware:k,devTools:L=!0,duplicateMiddlewareCheck:$=!0,preloadedState:X=void 0,enhancers:a=void 0}=g||{};let ee;if(typeof T=="function")ee=T;else if(db(T))ee=EO(T);else throw new Error("`reducer` is a required argument, and must be a function or an object of functions that can be passed to combineReducers");if(k&&typeof k!="function")throw new Error("`middleware` field must be a callback");let se;if(typeof k=="function"){if(se=k(y),!Array.isArray(se))throw new Error("when using a middleware builder function, an array of middleware must be returned")}else se=y();if(se.some(Ue=>typeof Ue!="function"))throw new Error("each middleware provided to configureStore must be a function");if($){let Ue=new Set;se.forEach(Pe=>{if(Ue.has(Pe))throw new Error("Duplicate middleware references found when creating the store. Ensure that each middleware is only included once.");Ue.add(Pe)})}let fe=Tw;L&&(fe=UO({trace:!0,...typeof L=="object"&&L}));const ge=AO(...se),le=KO(ge);if(a&&typeof a!="function")throw new Error("`enhancers` field must be a callback");let ke=typeof a=="function"?a(le):le();if(!Array.isArray(ke))throw new Error("`enhancers` callback must return an array");if(ke.some(Ue=>typeof Ue!="function"))throw new Error("each enhancer provided to configureStore must be a function");se.length&&!ke.includes(ge)&&console.error("middlewares were provided, but middleware enhancer was not included in final enhancers - make sure to call `getDefaultEnhancers`");const Re=fe(...ke);return OC(ee,X,Re)}function WC(g){const y={},T=[];let k;const L={addCase($,X){{if(T.length>0)throw new Error("`builder.addCase` should only be called before calling `builder.addMatcher`");if(k)throw new Error("`builder.addCase` should only be called before calling `builder.addDefaultCase`")}const a=typeof $=="string"?$:$.type;if(!a)throw new Error("`builder.addCase` cannot be called with an empty action type");if(a in y)throw new Error(`\`builder.addCase\` cannot be called with two reducers for the same action type '${a}'`);return y[a]=X,L},addMatcher($,X){if(k)throw new Error("`builder.addMatcher` should only be called before calling `builder.addDefaultCase`");return T.push({matcher:$,reducer:X}),L},addDefaultCase($){if(k)throw new Error("`builder.addDefaultCase` can only be called once");return k=$,L}};return g(L),[y,T,k]}function QO(g){return typeof g=="function"}function eI(g,y){if(typeof y=="object")throw new Error("The object notation for `createReducer` has been removed. Please use the 'builder callback' notation instead: https://redux-toolkit.js.org/api/createReducer");let[T,k,L]=WC(y),$;if(QO(g))$=()=>qE(g());else{const a=qE(g);$=()=>a}function X(a=$(),ee){let se=[T[ee.type],...k.filter(({matcher:fe})=>fe(ee)).map(({reducer:fe})=>fe)];return se.filter(fe=>!!fe).length===0&&(se=[L]),se.reduce((fe,ge)=>{if(ge)if(py(fe)){const ke=ge(fe,ee);return ke===void 0?fe:ke}else{if(Bp(fe))return UC(fe,le=>ge(le,ee));{const le=ge(fe,ee);if(le===void 0){if(fe===null)return fe;throw Error("A case reducer on a non-draftable value must not return undefined")}return le}}return fe},a)}return X.getInitialState=$,X}var tI=(g,y)=>VC(g)?g.match(y):g(y);function nI(...g){return y=>g.some(T=>tI(T,y))}var rI="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",iI=(g=21)=>{let y="",T=g;for(;T--;)y+=rI[Math.random()*64|0];return y},oI=["name","message","stack","code"],qS=class{constructor(g,y){bS(this,"_type");this.payload=g,this.meta=y}},GE=class{constructor(g,y){bS(this,"_type");this.payload=g,this.meta=y}},sI=g=>{if(typeof g=="object"&&g!==null){const y={};for(const T of oI)typeof g[T]=="string"&&(y[T]=g[T]);return y}return{message:String(g)}},$E="External signal was aborted",xl=(()=>{function g(y,T,k){const L=Jx(y+"/fulfilled",(ee,se,fe,ge)=>({payload:ee,meta:{...ge||{},arg:fe,requestId:se,requestStatus:"fulfilled"}})),$=Jx(y+"/pending",(ee,se,fe)=>({payload:void 0,meta:{...fe||{},arg:se,requestId:ee,requestStatus:"pending"}})),X=Jx(y+"/rejected",(ee,se,fe,ge,le)=>({payload:ge,error:(k&&k.serializeError||sI)(ee||"Rejected"),meta:{...le||{},arg:fe,requestId:se,rejectedWithValue:!!ge,requestStatus:"rejected",aborted:(ee==null?void 0:ee.name)==="AbortError",condition:(ee==null?void 0:ee.name)==="ConditionError"}}));function a(ee,{signal:se}={}){return(fe,ge,le)=>{const ke=k!=null&&k.idGenerator?k.idGenerator(ee):iI(),Re=new AbortController;let Ue,Pe;function We(wt){Pe=wt,Re.abort()}se&&(se.aborted?We($E):se.addEventListener("abort",()=>We($E),{once:!0}));const Tt=async function(){var Xt,cn;let wt;try{let xt=(Xt=k==null?void 0:k.condition)==null?void 0:Xt.call(k,ee,{getState:ge,extra:le});if(lI(xt)&&(xt=await xt),xt===!1||Re.signal.aborted)throw{name:"ConditionError",message:"Aborted due to condition callback returning false."};const rn=new Promise((Ut,Yt)=>{Ue=()=>{Yt({name:"AbortError",message:Pe||"Aborted"})},Re.signal.addEventListener("abort",Ue)});fe($(ke,ee,(cn=k==null?void 0:k.getPendingMeta)==null?void 0:cn.call(k,{requestId:ke,arg:ee},{getState:ge,extra:le}))),wt=await Promise.race([rn,Promise.resolve(T(ee,{dispatch:fe,getState:ge,extra:le,requestId:ke,signal:Re.signal,abort:We,rejectWithValue:(Ut,Yt)=>new qS(Ut,Yt),fulfillWithValue:(Ut,Yt)=>new GE(Ut,Yt)})).then(Ut=>{if(Ut instanceof qS)throw Ut;return Ut instanceof GE?L(Ut.payload,ke,ee,Ut.meta):L(Ut,ke,ee)})])}catch(xt){wt=xt instanceof qS?X(null,ke,ee,xt.payload,xt.meta):X(xt,ke,ee)}finally{Ue&&Re.signal.removeEventListener("abort",Ue)}return k&&!k.dispatchConditionRejection&&X.match(wt)&&wt.meta.condition||fe(wt),wt}();return Object.assign(Tt,{abort:We,requestId:ke,arg:ee,unwrap(){return Tt.then(aI)}})}}return Object.assign(a,{pending:$,rejected:X,fulfilled:L,settled:nI(X,L),typePrefix:y})}return g.withTypes=()=>g,g})();function aI(g){if(g.meta&&g.meta.rejectedWithValue)throw g.payload;if(g.error)throw g.error;return g.payload}function lI(g){return g!==null&&typeof g=="object"&&typeof g.then=="function"}var cI=Symbol.for("rtk-slice-createasyncthunk");function uI(g,y){return`${g}/${y}`}function dI({creators:g}={}){var T;const y=(T=g==null?void 0:g.asyncThunk)==null?void 0:T[cI];return function(L){const{name:$,reducerPath:X=$}=L;if(!$)throw new Error("`name` is a required option for createSlice");typeof process<"u"&&L.initialState===void 0&&console.error("You must provide an `initialState` value that is not `undefined`. You may have misspelled `initialState`");const a=(typeof L.reducers=="function"?L.reducers(fI()):L.reducers)||{},ee=Object.keys(a),se={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},fe={addCase(St,Xt){const cn=typeof St=="string"?St:St.type;if(!cn)throw new Error("`context.addCase` cannot be called with an empty action type");if(cn in se.sliceCaseReducersByType)throw new Error("`context.addCase` cannot be called with two reducers for the same action type: "+cn);return se.sliceCaseReducersByType[cn]=Xt,fe},addMatcher(St,Xt){return se.sliceMatchers.push({matcher:St,reducer:Xt}),fe},exposeAction(St,Xt){return se.actionCreators[St]=Xt,fe},exposeCaseReducer(St,Xt){return se.sliceCaseReducersByName[St]=Xt,fe}};ee.forEach(St=>{const Xt=a[St],cn={reducerName:St,type:uI($,St),createNotation:typeof L.reducers=="function"};mI(Xt)?_I(cn,Xt,fe,y):pI(cn,Xt,fe)});function ge(){if(typeof L.extraReducers=="object")throw new Error("The object notation for `createSlice.extraReducers` has been removed. Please use the 'builder callback' notation instead: https://redux-toolkit.js.org/api/createSlice");const[St={},Xt=[],cn=void 0]=typeof L.extraReducers=="function"?WC(L.extraReducers):[L.extraReducers],xt={...St,...se.sliceCaseReducersByType};return eI(L.initialState,rn=>{for(let Ut in xt)rn.addCase(Ut,xt[Ut]);for(let Ut of se.sliceMatchers)rn.addMatcher(Ut.matcher,Ut.reducer);for(let Ut of Xt)rn.addMatcher(Ut.matcher,Ut.reducer);cn&&rn.addDefaultCase(cn)})}const le=St=>St,ke=new Map,Re=new WeakMap;let Ue;function Pe(St,Xt){return Ue||(Ue=ge()),Ue(St,Xt)}function We(){return Ue||(Ue=ge()),Ue.getInitialState()}function Tt(St,Xt=!1){function cn(rn){let Ut=rn[St];if(typeof Ut>"u")if(Xt)Ut=K1(Re,cn,We);else throw new Error("selectSlice returned undefined for an uninjected slice reducer");return Ut}function xt(rn=le){const Ut=K1(ke,Xt,()=>new WeakMap);return K1(Ut,rn,()=>{const Yt={};for(const[Rt,ln]of Object.entries(L.selectors??{}))Yt[Rt]=hI(ln,rn,()=>K1(Re,rn,We),Xt);return Yt})}return{reducerPath:St,getSelectors:xt,get selectors(){return xt(cn)},selectSlice:cn}}const wt={name:$,reducer:Pe,actions:se.actionCreators,caseReducers:se.sliceCaseReducersByName,getInitialState:We,...Tt(X),injectInto(St,{reducerPath:Xt,...cn}={}){const xt=Xt??X;return St.inject({reducerPath:xt,reducer:Pe},cn),{...wt,...Tt(xt,!0)}}};return wt}}function hI(g,y,T,k){function L($,...X){let a=y($);if(typeof a>"u")if(k)a=T();else throw new Error("selectState returned undefined for an uninjected slice reducer");return g(a,...X)}return L.unwrapped=g,L}var Uw=dI();function fI(){function g(y,T){return{_reducerDefinitionType:"asyncThunk",payloadCreator:y,...T}}return g.withTypes=()=>g,{reducer(y){return Object.assign({[y.name](...T){return y(...T)}}[y.name],{_reducerDefinitionType:"reducer"})},preparedReducer(y,T){return{_reducerDefinitionType:"reducerWithPrepare",prepare:y,reducer:T}},asyncThunk:g}}function pI({type:g,reducerName:y,createNotation:T},k,L){let $,X;if("reducer"in k){if(T&&!gI(k))throw new Error("Please use the `create.preparedReducer` notation for prepared action creators with the `create` notation.");$=k.reducer,X=k.prepare}else $=k;L.addCase(g,$).exposeCaseReducer(y,$).exposeAction(y,X?Jx(g,X):Jx(g))}function mI(g){return g._reducerDefinitionType==="asyncThunk"}function gI(g){return g._reducerDefinitionType==="reducerWithPrepare"}function _I({type:g,reducerName:y},T,k,L){if(!L)throw new Error("Cannot use `create.asyncThunk` in the built-in `createSlice`. Use `buildCreateSlice({ creators: { asyncThunk: asyncThunkCreator } })` to create a customised version of `createSlice`.");const{payloadCreator:$,fulfilled:X,pending:a,rejected:ee,settled:se,options:fe}=T,ge=L(g,$,fe);k.exposeAction(y,ge),X&&k.addCase(ge.fulfilled,X),a&&k.addCase(ge.pending,a),ee&&k.addCase(ge.rejected,ee),se&&k.addMatcher(ge.settled,se),k.exposeCaseReducer(y,{fulfilled:X||Q1,pending:a||Q1,rejected:ee||Q1,settled:se||Q1})}function Q1(){}function XC(g,y){return function(){return g.apply(y,arguments)}}const{toString:yI}=Object.prototype,{getPrototypeOf:HT}=Object,{iterator:jw,toStringTag:KC}=Symbol,Vw=(g=>y=>{const T=yI.call(y);return g[T]||(g[T]=T.slice(8,-1).toLowerCase())})(Object.create(null)),Vd=g=>(g=g.toLowerCase(),y=>Vw(y)===g),qw=g=>y=>typeof y===g,{isArray:e0}=Array,sb=qw("undefined");function vI(g){return g!==null&&!sb(g)&&g.constructor!==null&&!sb(g.constructor)&&sc(g.constructor.isBuffer)&&g.constructor.isBuffer(g)}const JC=Vd("ArrayBuffer");function xI(g){let y;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?y=ArrayBuffer.isView(g):y=g&&g.buffer&&JC(g.buffer),y}const bI=qw("string"),sc=qw("function"),QC=qw("number"),Hw=g=>g!==null&&typeof g=="object",wI=g=>g===!0||g===!1,sw=g=>{if(Vw(g)!=="object")return!1;const y=HT(g);return(y===null||y===Object.prototype||Object.getPrototypeOf(y)===null)&&!(KC in g)&&!(jw in g)},SI=Vd("Date"),TI=Vd("File"),EI=Vd("Blob"),AI=Vd("FileList"),CI=g=>Hw(g)&&sc(g.pipe),DI=g=>{let y;return g&&(typeof FormData=="function"&&g instanceof FormData||sc(g.append)&&((y=Vw(g))==="formdata"||y==="object"&&sc(g.toString)&&g.toString()==="[object FormData]"))},MI=Vd("URLSearchParams"),[RI,kI,OI,II]=["ReadableStream","Request","Response","Headers"].map(Vd),NI=g=>g.trim?g.trim():g.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function hb(g,y,{allOwnKeys:T=!1}={}){if(g===null||typeof g>"u")return;let k,L;if(typeof g!="object"&&(g=[g]),e0(g))for(k=0,L=g.length;k<L;k++)y.call(null,g[k],k,g);else{const $=T?Object.getOwnPropertyNames(g):Object.keys(g),X=$.length;let a;for(k=0;k<X;k++)a=$[k],y.call(null,g[a],a,g)}}function eD(g,y){y=y.toLowerCase();const T=Object.keys(g);let k=T.length,L;for(;k-- >0;)if(L=T[k],y===L.toLowerCase())return L;return null}const cy=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,tD=g=>!sb(g)&&g!==cy;function mT(){const{caseless:g}=tD(this)&&this||{},y={},T=(k,L)=>{const $=g&&eD(y,L)||L;sw(y[$])&&sw(k)?y[$]=mT(y[$],k):sw(k)?y[$]=mT({},k):e0(k)?y[$]=k.slice():y[$]=k};for(let k=0,L=arguments.length;k<L;k++)arguments[k]&&hb(arguments[k],T);return y}const zI=(g,y,T,{allOwnKeys:k}={})=>(hb(y,(L,$)=>{T&&sc(L)?g[$]=XC(L,T):g[$]=L},{allOwnKeys:k}),g),PI=g=>(g.charCodeAt(0)===65279&&(g=g.slice(1)),g),LI=(g,y,T,k)=>{g.prototype=Object.create(y.prototype,k),g.prototype.constructor=g,Object.defineProperty(g,"super",{value:y.prototype}),T&&Object.assign(g.prototype,T)},BI=(g,y,T,k)=>{let L,$,X;const a={};if(y=y||{},g==null)return y;do{for(L=Object.getOwnPropertyNames(g),$=L.length;$-- >0;)X=L[$],(!k||k(X,g,y))&&!a[X]&&(y[X]=g[X],a[X]=!0);g=T!==!1&&HT(g)}while(g&&(!T||T(g,y))&&g!==Object.prototype);return y},FI=(g,y,T)=>{g=String(g),(T===void 0||T>g.length)&&(T=g.length),T-=y.length;const k=g.indexOf(y,T);return k!==-1&&k===T},UI=g=>{if(!g)return null;if(e0(g))return g;let y=g.length;if(!QC(y))return null;const T=new Array(y);for(;y-- >0;)T[y]=g[y];return T},jI=(g=>y=>g&&y instanceof g)(typeof Uint8Array<"u"&&HT(Uint8Array)),VI=(g,y)=>{const k=(g&&g[jw]).call(g);let L;for(;(L=k.next())&&!L.done;){const $=L.value;y.call(g,$[0],$[1])}},qI=(g,y)=>{let T;const k=[];for(;(T=g.exec(y))!==null;)k.push(T);return k},HI=Vd("HTMLFormElement"),GI=g=>g.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(T,k,L){return k.toUpperCase()+L}),ZE=(({hasOwnProperty:g})=>(y,T)=>g.call(y,T))(Object.prototype),$I=Vd("RegExp"),nD=(g,y)=>{const T=Object.getOwnPropertyDescriptors(g),k={};hb(T,(L,$)=>{let X;(X=y(L,$,g))!==!1&&(k[$]=X||L)}),Object.defineProperties(g,k)},ZI=g=>{nD(g,(y,T)=>{if(sc(g)&&["arguments","caller","callee"].indexOf(T)!==-1)return!1;const k=g[T];if(sc(k)){if(y.enumerable=!1,"writable"in y){y.writable=!1;return}y.set||(y.set=()=>{throw Error("Can not rewrite read-only method '"+T+"'")})}})},YI=(g,y)=>{const T={},k=L=>{L.forEach($=>{T[$]=!0})};return e0(g)?k(g):k(String(g).split(y)),T},WI=()=>{},XI=(g,y)=>g!=null&&Number.isFinite(g=+g)?g:y;function KI(g){return!!(g&&sc(g.append)&&g[KC]==="FormData"&&g[jw])}const JI=g=>{const y=new Array(10),T=(k,L)=>{if(Hw(k)){if(y.indexOf(k)>=0)return;if(!("toJSON"in k)){y[L]=k;const $=e0(k)?[]:{};return hb(k,(X,a)=>{const ee=T(X,L+1);!sb(ee)&&($[a]=ee)}),y[L]=void 0,$}}return k};return T(g,0)},QI=Vd("AsyncFunction"),e3=g=>g&&(Hw(g)||sc(g))&&sc(g.then)&&sc(g.catch),rD=((g,y)=>g?setImmediate:y?((T,k)=>(cy.addEventListener("message",({source:L,data:$})=>{L===cy&&$===T&&k.length&&k.shift()()},!1),L=>{k.push(L),cy.postMessage(T,"*")}))(`axios@${Math.random()}`,[]):T=>setTimeout(T))(typeof setImmediate=="function",sc(cy.postMessage)),t3=typeof queueMicrotask<"u"?queueMicrotask.bind(cy):typeof process<"u"&&process.nextTick||rD,n3=g=>g!=null&&sc(g[jw]),jt={isArray:e0,isArrayBuffer:JC,isBuffer:vI,isFormData:DI,isArrayBufferView:xI,isString:bI,isNumber:QC,isBoolean:wI,isObject:Hw,isPlainObject:sw,isReadableStream:RI,isRequest:kI,isResponse:OI,isHeaders:II,isUndefined:sb,isDate:SI,isFile:TI,isBlob:EI,isRegExp:$I,isFunction:sc,isStream:CI,isURLSearchParams:MI,isTypedArray:jI,isFileList:AI,forEach:hb,merge:mT,extend:zI,trim:NI,stripBOM:PI,inherits:LI,toFlatObject:BI,kindOf:Vw,kindOfTest:Vd,endsWith:FI,toArray:UI,forEachEntry:VI,matchAll:qI,isHTMLForm:HI,hasOwnProperty:ZE,hasOwnProp:ZE,reduceDescriptors:nD,freezeMethods:ZI,toObjectSet:YI,toCamelCase:GI,noop:WI,toFiniteNumber:XI,findKey:eD,global:cy,isContextDefined:tD,isSpecCompliantForm:KI,toJSONObject:JI,isAsyncFn:QI,isThenable:e3,setImmediate:rD,asap:t3,isIterable:n3};function Zr(g,y,T,k,L){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=g,this.name="AxiosError",y&&(this.code=y),T&&(this.config=T),k&&(this.request=k),L&&(this.response=L,this.status=L.status?L.status:null)}jt.inherits(Zr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:jt.toJSONObject(this.config),code:this.code,status:this.status}}});const iD=Zr.prototype,oD={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(g=>{oD[g]={value:g}});Object.defineProperties(Zr,oD);Object.defineProperty(iD,"isAxiosError",{value:!0});Zr.from=(g,y,T,k,L,$)=>{const X=Object.create(iD);return jt.toFlatObject(g,X,function(ee){return ee!==Error.prototype},a=>a!=="isAxiosError"),Zr.call(X,g.message,y,T,k,L),X.cause=g,X.name=g.name,$&&Object.assign(X,$),X};const r3=null;function gT(g){return jt.isPlainObject(g)||jt.isArray(g)}function sD(g){return jt.endsWith(g,"[]")?g.slice(0,-2):g}function YE(g,y,T){return g?g.concat(y).map(function(L,$){return L=sD(L),!T&&$?"["+L+"]":L}).join(T?".":""):y}function i3(g){return jt.isArray(g)&&!g.some(gT)}const o3=jt.toFlatObject(jt,{},null,function(y){return/^is[A-Z]/.test(y)});function Gw(g,y,T){if(!jt.isObject(g))throw new TypeError("target must be an object");y=y||new FormData,T=jt.toFlatObject(T,{metaTokens:!0,dots:!1,indexes:!1},!1,function(Ue,Pe){return!jt.isUndefined(Pe[Ue])});const k=T.metaTokens,L=T.visitor||fe,$=T.dots,X=T.indexes,ee=(T.Blob||typeof Blob<"u"&&Blob)&&jt.isSpecCompliantForm(y);if(!jt.isFunction(L))throw new TypeError("visitor must be a function");function se(Re){if(Re===null)return"";if(jt.isDate(Re))return Re.toISOString();if(!ee&&jt.isBlob(Re))throw new Zr("Blob is not supported. Use a Buffer instead.");return jt.isArrayBuffer(Re)||jt.isTypedArray(Re)?ee&&typeof Blob=="function"?new Blob([Re]):Buffer.from(Re):Re}function fe(Re,Ue,Pe){let We=Re;if(Re&&!Pe&&typeof Re=="object"){if(jt.endsWith(Ue,"{}"))Ue=k?Ue:Ue.slice(0,-2),Re=JSON.stringify(Re);else if(jt.isArray(Re)&&i3(Re)||(jt.isFileList(Re)||jt.endsWith(Ue,"[]"))&&(We=jt.toArray(Re)))return Ue=sD(Ue),We.forEach(function(wt,St){!(jt.isUndefined(wt)||wt===null)&&y.append(X===!0?YE([Ue],St,$):X===null?Ue:Ue+"[]",se(wt))}),!1}return gT(Re)?!0:(y.append(YE(Pe,Ue,$),se(Re)),!1)}const ge=[],le=Object.assign(o3,{defaultVisitor:fe,convertValue:se,isVisitable:gT});function ke(Re,Ue){if(!jt.isUndefined(Re)){if(ge.indexOf(Re)!==-1)throw Error("Circular reference detected in "+Ue.join("."));ge.push(Re),jt.forEach(Re,function(We,Tt){(!(jt.isUndefined(We)||We===null)&&L.call(y,We,jt.isString(Tt)?Tt.trim():Tt,Ue,le))===!0&&ke(We,Ue?Ue.concat(Tt):[Tt])}),ge.pop()}}if(!jt.isObject(g))throw new TypeError("data must be an object");return ke(g),y}function WE(g){const y={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(g).replace(/[!'()~]|%20|%00/g,function(k){return y[k]})}function GT(g,y){this._pairs=[],g&&Gw(g,this,y)}const aD=GT.prototype;aD.append=function(y,T){this._pairs.push([y,T])};aD.toString=function(y){const T=y?function(k){return y.call(this,k,WE)}:WE;return this._pairs.map(function(L){return T(L[0])+"="+T(L[1])},"").join("&")};function s3(g){return encodeURIComponent(g).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function lD(g,y,T){if(!y)return g;const k=T&&T.encode||s3;jt.isFunction(T)&&(T={serialize:T});const L=T&&T.serialize;let $;if(L?$=L(y,T):$=jt.isURLSearchParams(y)?y.toString():new GT(y,T).toString(k),$){const X=g.indexOf("#");X!==-1&&(g=g.slice(0,X)),g+=(g.indexOf("?")===-1?"?":"&")+$}return g}class XE{constructor(){this.handlers=[]}use(y,T,k){return this.handlers.push({fulfilled:y,rejected:T,synchronous:k?k.synchronous:!1,runWhen:k?k.runWhen:null}),this.handlers.length-1}eject(y){this.handlers[y]&&(this.handlers[y]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(y){jt.forEach(this.handlers,function(k){k!==null&&y(k)})}}const cD={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},a3=typeof URLSearchParams<"u"?URLSearchParams:GT,l3=typeof FormData<"u"?FormData:null,c3=typeof Blob<"u"?Blob:null,u3={isBrowser:!0,classes:{URLSearchParams:a3,FormData:l3,Blob:c3},protocols:["http","https","file","blob","url","data"]},$T=typeof window<"u"&&typeof document<"u",_T=typeof navigator=="object"&&navigator||void 0,d3=$T&&(!_T||["ReactNative","NativeScript","NS"].indexOf(_T.product)<0),h3=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",f3=$T&&window.location.href||"http://localhost",p3=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:$T,hasStandardBrowserEnv:d3,hasStandardBrowserWebWorkerEnv:h3,navigator:_T,origin:f3},Symbol.toStringTag,{value:"Module"})),La={...p3,...u3};function m3(g,y){return Gw(g,new La.classes.URLSearchParams,Object.assign({visitor:function(T,k,L,$){return La.isNode&&jt.isBuffer(T)?(this.append(k,T.toString("base64")),!1):$.defaultVisitor.apply(this,arguments)}},y))}function g3(g){return jt.matchAll(/\w+|\[(\w*)]/g,g).map(y=>y[0]==="[]"?"":y[1]||y[0])}function _3(g){const y={},T=Object.keys(g);let k;const L=T.length;let $;for(k=0;k<L;k++)$=T[k],y[$]=g[$];return y}function uD(g){function y(T,k,L,$){let X=T[$++];if(X==="__proto__")return!0;const a=Number.isFinite(+X),ee=$>=T.length;return X=!X&&jt.isArray(L)?L.length:X,ee?(jt.hasOwnProp(L,X)?L[X]=[L[X],k]:L[X]=k,!a):((!L[X]||!jt.isObject(L[X]))&&(L[X]=[]),y(T,k,L[X],$)&&jt.isArray(L[X])&&(L[X]=_3(L[X])),!a)}if(jt.isFormData(g)&&jt.isFunction(g.entries)){const T={};return jt.forEachEntry(g,(k,L)=>{y(g3(k),L,T,0)}),T}return null}function y3(g,y,T){if(jt.isString(g))try{return(y||JSON.parse)(g),jt.trim(g)}catch(k){if(k.name!=="SyntaxError")throw k}return(T||JSON.stringify)(g)}const fb={transitional:cD,adapter:["xhr","http","fetch"],transformRequest:[function(y,T){const k=T.getContentType()||"",L=k.indexOf("application/json")>-1,$=jt.isObject(y);if($&&jt.isHTMLForm(y)&&(y=new FormData(y)),jt.isFormData(y))return L?JSON.stringify(uD(y)):y;if(jt.isArrayBuffer(y)||jt.isBuffer(y)||jt.isStream(y)||jt.isFile(y)||jt.isBlob(y)||jt.isReadableStream(y))return y;if(jt.isArrayBufferView(y))return y.buffer;if(jt.isURLSearchParams(y))return T.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),y.toString();let a;if($){if(k.indexOf("application/x-www-form-urlencoded")>-1)return m3(y,this.formSerializer).toString();if((a=jt.isFileList(y))||k.indexOf("multipart/form-data")>-1){const ee=this.env&&this.env.FormData;return Gw(a?{"files[]":y}:y,ee&&new ee,this.formSerializer)}}return $||L?(T.setContentType("application/json",!1),y3(y)):y}],transformResponse:[function(y){const T=this.transitional||fb.transitional,k=T&&T.forcedJSONParsing,L=this.responseType==="json";if(jt.isResponse(y)||jt.isReadableStream(y))return y;if(y&&jt.isString(y)&&(k&&!this.responseType||L)){const X=!(T&&T.silentJSONParsing)&&L;try{return JSON.parse(y)}catch(a){if(X)throw a.name==="SyntaxError"?Zr.from(a,Zr.ERR_BAD_RESPONSE,this,null,this.response):a}}return y}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:La.classes.FormData,Blob:La.classes.Blob},validateStatus:function(y){return y>=200&&y<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};jt.forEach(["delete","get","head","post","put","patch"],g=>{fb.headers[g]={}});const v3=jt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),x3=g=>{const y={};let T,k,L;return g&&g.split(`
`).forEach(function(X){L=X.indexOf(":"),T=X.substring(0,L).trim().toLowerCase(),k=X.substring(L+1).trim(),!(!T||y[T]&&v3[T])&&(T==="set-cookie"?y[T]?y[T].push(k):y[T]=[k]:y[T]=y[T]?y[T]+", "+k:k)}),y},KE=Symbol("internals");function Gx(g){return g&&String(g).trim().toLowerCase()}function aw(g){return g===!1||g==null?g:jt.isArray(g)?g.map(aw):String(g)}function b3(g){const y=Object.create(null),T=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let k;for(;k=T.exec(g);)y[k[1]]=k[2];return y}const w3=g=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(g.trim());function HS(g,y,T,k,L){if(jt.isFunction(k))return k.call(this,y,T);if(L&&(y=T),!!jt.isString(y)){if(jt.isString(k))return y.indexOf(k)!==-1;if(jt.isRegExp(k))return k.test(y)}}function S3(g){return g.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(y,T,k)=>T.toUpperCase()+k)}function T3(g,y){const T=jt.toCamelCase(" "+y);["get","set","has"].forEach(k=>{Object.defineProperty(g,k+T,{value:function(L,$,X){return this[k].call(this,y,L,$,X)},configurable:!0})})}let ac=class{constructor(y){y&&this.set(y)}set(y,T,k){const L=this;function $(a,ee,se){const fe=Gx(ee);if(!fe)throw new Error("header name must be a non-empty string");const ge=jt.findKey(L,fe);(!ge||L[ge]===void 0||se===!0||se===void 0&&L[ge]!==!1)&&(L[ge||ee]=aw(a))}const X=(a,ee)=>jt.forEach(a,(se,fe)=>$(se,fe,ee));if(jt.isPlainObject(y)||y instanceof this.constructor)X(y,T);else if(jt.isString(y)&&(y=y.trim())&&!w3(y))X(x3(y),T);else if(jt.isObject(y)&&jt.isIterable(y)){let a={},ee,se;for(const fe of y){if(!jt.isArray(fe))throw TypeError("Object iterator must return a key-value pair");a[se=fe[0]]=(ee=a[se])?jt.isArray(ee)?[...ee,fe[1]]:[ee,fe[1]]:fe[1]}X(a,T)}else y!=null&&$(T,y,k);return this}get(y,T){if(y=Gx(y),y){const k=jt.findKey(this,y);if(k){const L=this[k];if(!T)return L;if(T===!0)return b3(L);if(jt.isFunction(T))return T.call(this,L,k);if(jt.isRegExp(T))return T.exec(L);throw new TypeError("parser must be boolean|regexp|function")}}}has(y,T){if(y=Gx(y),y){const k=jt.findKey(this,y);return!!(k&&this[k]!==void 0&&(!T||HS(this,this[k],k,T)))}return!1}delete(y,T){const k=this;let L=!1;function $(X){if(X=Gx(X),X){const a=jt.findKey(k,X);a&&(!T||HS(k,k[a],a,T))&&(delete k[a],L=!0)}}return jt.isArray(y)?y.forEach($):$(y),L}clear(y){const T=Object.keys(this);let k=T.length,L=!1;for(;k--;){const $=T[k];(!y||HS(this,this[$],$,y,!0))&&(delete this[$],L=!0)}return L}normalize(y){const T=this,k={};return jt.forEach(this,(L,$)=>{const X=jt.findKey(k,$);if(X){T[X]=aw(L),delete T[$];return}const a=y?S3($):String($).trim();a!==$&&delete T[$],T[a]=aw(L),k[a]=!0}),this}concat(...y){return this.constructor.concat(this,...y)}toJSON(y){const T=Object.create(null);return jt.forEach(this,(k,L)=>{k!=null&&k!==!1&&(T[L]=y&&jt.isArray(k)?k.join(", "):k)}),T}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([y,T])=>y+": "+T).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(y){return y instanceof this?y:new this(y)}static concat(y,...T){const k=new this(y);return T.forEach(L=>k.set(L)),k}static accessor(y){const k=(this[KE]=this[KE]={accessors:{}}).accessors,L=this.prototype;function $(X){const a=Gx(X);k[a]||(T3(L,X),k[a]=!0)}return jt.isArray(y)?y.forEach($):$(y),this}};ac.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);jt.reduceDescriptors(ac.prototype,({value:g},y)=>{let T=y[0].toUpperCase()+y.slice(1);return{get:()=>g,set(k){this[T]=k}}});jt.freezeMethods(ac);function GS(g,y){const T=this||fb,k=y||T,L=ac.from(k.headers);let $=k.data;return jt.forEach(g,function(a){$=a.call(T,$,L.normalize(),y?y.status:void 0)}),L.normalize(),$}function dD(g){return!!(g&&g.__CANCEL__)}function t0(g,y,T){Zr.call(this,g??"canceled",Zr.ERR_CANCELED,y,T),this.name="CanceledError"}jt.inherits(t0,Zr,{__CANCEL__:!0});function hD(g,y,T){const k=T.config.validateStatus;!T.status||!k||k(T.status)?g(T):y(new Zr("Request failed with status code "+T.status,[Zr.ERR_BAD_REQUEST,Zr.ERR_BAD_RESPONSE][Math.floor(T.status/100)-4],T.config,T.request,T))}function E3(g){const y=/^([-+\w]{1,25})(:?\/\/|:)/.exec(g);return y&&y[1]||""}function A3(g,y){g=g||10;const T=new Array(g),k=new Array(g);let L=0,$=0,X;return y=y!==void 0?y:1e3,function(ee){const se=Date.now(),fe=k[$];X||(X=se),T[L]=ee,k[L]=se;let ge=$,le=0;for(;ge!==L;)le+=T[ge++],ge=ge%g;if(L=(L+1)%g,L===$&&($=($+1)%g),se-X<y)return;const ke=fe&&se-fe;return ke?Math.round(le*1e3/ke):void 0}}function C3(g,y){let T=0,k=1e3/y,L,$;const X=(se,fe=Date.now())=>{T=fe,L=null,$&&(clearTimeout($),$=null),g.apply(null,se)};return[(...se)=>{const fe=Date.now(),ge=fe-T;ge>=k?X(se,fe):(L=se,$||($=setTimeout(()=>{$=null,X(L)},k-ge)))},()=>L&&X(L)]}const Dw=(g,y,T=3)=>{let k=0;const L=A3(50,250);return C3($=>{const X=$.loaded,a=$.lengthComputable?$.total:void 0,ee=X-k,se=L(ee),fe=X<=a;k=X;const ge={loaded:X,total:a,progress:a?X/a:void 0,bytes:ee,rate:se||void 0,estimated:se&&a&&fe?(a-X)/se:void 0,event:$,lengthComputable:a!=null,[y?"download":"upload"]:!0};g(ge)},T)},JE=(g,y)=>{const T=g!=null;return[k=>y[0]({lengthComputable:T,total:g,loaded:k}),y[1]]},QE=g=>(...y)=>jt.asap(()=>g(...y)),D3=La.hasStandardBrowserEnv?((g,y)=>T=>(T=new URL(T,La.origin),g.protocol===T.protocol&&g.host===T.host&&(y||g.port===T.port)))(new URL(La.origin),La.navigator&&/(msie|trident)/i.test(La.navigator.userAgent)):()=>!0,M3=La.hasStandardBrowserEnv?{write(g,y,T,k,L,$){const X=[g+"="+encodeURIComponent(y)];jt.isNumber(T)&&X.push("expires="+new Date(T).toGMTString()),jt.isString(k)&&X.push("path="+k),jt.isString(L)&&X.push("domain="+L),$===!0&&X.push("secure"),document.cookie=X.join("; ")},read(g){const y=document.cookie.match(new RegExp("(^|;\\s*)("+g+")=([^;]*)"));return y?decodeURIComponent(y[3]):null},remove(g){this.write(g,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function R3(g){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(g)}function k3(g,y){return y?g.replace(/\/?\/$/,"")+"/"+y.replace(/^\/+/,""):g}function fD(g,y,T){let k=!R3(y);return g&&(k||T==!1)?k3(g,y):y}const eA=g=>g instanceof ac?{...g}:g;function gy(g,y){y=y||{};const T={};function k(se,fe,ge,le){return jt.isPlainObject(se)&&jt.isPlainObject(fe)?jt.merge.call({caseless:le},se,fe):jt.isPlainObject(fe)?jt.merge({},fe):jt.isArray(fe)?fe.slice():fe}function L(se,fe,ge,le){if(jt.isUndefined(fe)){if(!jt.isUndefined(se))return k(void 0,se,ge,le)}else return k(se,fe,ge,le)}function $(se,fe){if(!jt.isUndefined(fe))return k(void 0,fe)}function X(se,fe){if(jt.isUndefined(fe)){if(!jt.isUndefined(se))return k(void 0,se)}else return k(void 0,fe)}function a(se,fe,ge){if(ge in y)return k(se,fe);if(ge in g)return k(void 0,se)}const ee={url:$,method:$,data:$,baseURL:X,transformRequest:X,transformResponse:X,paramsSerializer:X,timeout:X,timeoutMessage:X,withCredentials:X,withXSRFToken:X,adapter:X,responseType:X,xsrfCookieName:X,xsrfHeaderName:X,onUploadProgress:X,onDownloadProgress:X,decompress:X,maxContentLength:X,maxBodyLength:X,beforeRedirect:X,transport:X,httpAgent:X,httpsAgent:X,cancelToken:X,socketPath:X,responseEncoding:X,validateStatus:a,headers:(se,fe,ge)=>L(eA(se),eA(fe),ge,!0)};return jt.forEach(Object.keys(Object.assign({},g,y)),function(fe){const ge=ee[fe]||L,le=ge(g[fe],y[fe],fe);jt.isUndefined(le)&&ge!==a||(T[fe]=le)}),T}const pD=g=>{const y=gy({},g);let{data:T,withXSRFToken:k,xsrfHeaderName:L,xsrfCookieName:$,headers:X,auth:a}=y;y.headers=X=ac.from(X),y.url=lD(fD(y.baseURL,y.url,y.allowAbsoluteUrls),g.params,g.paramsSerializer),a&&X.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):"")));let ee;if(jt.isFormData(T)){if(La.hasStandardBrowserEnv||La.hasStandardBrowserWebWorkerEnv)X.setContentType(void 0);else if((ee=X.getContentType())!==!1){const[se,...fe]=ee?ee.split(";").map(ge=>ge.trim()).filter(Boolean):[];X.setContentType([se||"multipart/form-data",...fe].join("; "))}}if(La.hasStandardBrowserEnv&&(k&&jt.isFunction(k)&&(k=k(y)),k||k!==!1&&D3(y.url))){const se=L&&$&&M3.read($);se&&X.set(L,se)}return y},O3=typeof XMLHttpRequest<"u",I3=O3&&function(g){return new Promise(function(T,k){const L=pD(g);let $=L.data;const X=ac.from(L.headers).normalize();let{responseType:a,onUploadProgress:ee,onDownloadProgress:se}=L,fe,ge,le,ke,Re;function Ue(){ke&&ke(),Re&&Re(),L.cancelToken&&L.cancelToken.unsubscribe(fe),L.signal&&L.signal.removeEventListener("abort",fe)}let Pe=new XMLHttpRequest;Pe.open(L.method.toUpperCase(),L.url,!0),Pe.timeout=L.timeout;function We(){if(!Pe)return;const wt=ac.from("getAllResponseHeaders"in Pe&&Pe.getAllResponseHeaders()),Xt={data:!a||a==="text"||a==="json"?Pe.responseText:Pe.response,status:Pe.status,statusText:Pe.statusText,headers:wt,config:g,request:Pe};hD(function(xt){T(xt),Ue()},function(xt){k(xt),Ue()},Xt),Pe=null}"onloadend"in Pe?Pe.onloadend=We:Pe.onreadystatechange=function(){!Pe||Pe.readyState!==4||Pe.status===0&&!(Pe.responseURL&&Pe.responseURL.indexOf("file:")===0)||setTimeout(We)},Pe.onabort=function(){Pe&&(k(new Zr("Request aborted",Zr.ECONNABORTED,g,Pe)),Pe=null)},Pe.onerror=function(){k(new Zr("Network Error",Zr.ERR_NETWORK,g,Pe)),Pe=null},Pe.ontimeout=function(){let St=L.timeout?"timeout of "+L.timeout+"ms exceeded":"timeout exceeded";const Xt=L.transitional||cD;L.timeoutErrorMessage&&(St=L.timeoutErrorMessage),k(new Zr(St,Xt.clarifyTimeoutError?Zr.ETIMEDOUT:Zr.ECONNABORTED,g,Pe)),Pe=null},$===void 0&&X.setContentType(null),"setRequestHeader"in Pe&&jt.forEach(X.toJSON(),function(St,Xt){Pe.setRequestHeader(Xt,St)}),jt.isUndefined(L.withCredentials)||(Pe.withCredentials=!!L.withCredentials),a&&a!=="json"&&(Pe.responseType=L.responseType),se&&([le,Re]=Dw(se,!0),Pe.addEventListener("progress",le)),ee&&Pe.upload&&([ge,ke]=Dw(ee),Pe.upload.addEventListener("progress",ge),Pe.upload.addEventListener("loadend",ke)),(L.cancelToken||L.signal)&&(fe=wt=>{Pe&&(k(!wt||wt.type?new t0(null,g,Pe):wt),Pe.abort(),Pe=null)},L.cancelToken&&L.cancelToken.subscribe(fe),L.signal&&(L.signal.aborted?fe():L.signal.addEventListener("abort",fe)));const Tt=E3(L.url);if(Tt&&La.protocols.indexOf(Tt)===-1){k(new Zr("Unsupported protocol "+Tt+":",Zr.ERR_BAD_REQUEST,g));return}Pe.send($||null)})},N3=(g,y)=>{const{length:T}=g=g?g.filter(Boolean):[];if(y||T){let k=new AbortController,L;const $=function(se){if(!L){L=!0,a();const fe=se instanceof Error?se:this.reason;k.abort(fe instanceof Zr?fe:new t0(fe instanceof Error?fe.message:fe))}};let X=y&&setTimeout(()=>{X=null,$(new Zr(`timeout ${y} of ms exceeded`,Zr.ETIMEDOUT))},y);const a=()=>{g&&(X&&clearTimeout(X),X=null,g.forEach(se=>{se.unsubscribe?se.unsubscribe($):se.removeEventListener("abort",$)}),g=null)};g.forEach(se=>se.addEventListener("abort",$));const{signal:ee}=k;return ee.unsubscribe=()=>jt.asap(a),ee}},z3=function*(g,y){let T=g.byteLength;if(T<y){yield g;return}let k=0,L;for(;k<T;)L=k+y,yield g.slice(k,L),k=L},P3=async function*(g,y){for await(const T of L3(g))yield*z3(T,y)},L3=async function*(g){if(g[Symbol.asyncIterator]){yield*g;return}const y=g.getReader();try{for(;;){const{done:T,value:k}=await y.read();if(T)break;yield k}}finally{await y.cancel()}},tA=(g,y,T,k)=>{const L=P3(g,y);let $=0,X,a=ee=>{X||(X=!0,k&&k(ee))};return new ReadableStream({async pull(ee){try{const{done:se,value:fe}=await L.next();if(se){a(),ee.close();return}let ge=fe.byteLength;if(T){let le=$+=ge;T(le)}ee.enqueue(new Uint8Array(fe))}catch(se){throw a(se),se}},cancel(ee){return a(ee),L.return()}},{highWaterMark:2})},$w=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",mD=$w&&typeof ReadableStream=="function",B3=$w&&(typeof TextEncoder=="function"?(g=>y=>g.encode(y))(new TextEncoder):async g=>new Uint8Array(await new Response(g).arrayBuffer())),gD=(g,...y)=>{try{return!!g(...y)}catch{return!1}},F3=mD&&gD(()=>{let g=!1;const y=new Request(La.origin,{body:new ReadableStream,method:"POST",get duplex(){return g=!0,"half"}}).headers.has("Content-Type");return g&&!y}),nA=64*1024,yT=mD&&gD(()=>jt.isReadableStream(new Response("").body)),Mw={stream:yT&&(g=>g.body)};$w&&(g=>{["text","arrayBuffer","blob","formData","stream"].forEach(y=>{!Mw[y]&&(Mw[y]=jt.isFunction(g[y])?T=>T[y]():(T,k)=>{throw new Zr(`Response type '${y}' is not supported`,Zr.ERR_NOT_SUPPORT,k)})})})(new Response);const U3=async g=>{if(g==null)return 0;if(jt.isBlob(g))return g.size;if(jt.isSpecCompliantForm(g))return(await new Request(La.origin,{method:"POST",body:g}).arrayBuffer()).byteLength;if(jt.isArrayBufferView(g)||jt.isArrayBuffer(g))return g.byteLength;if(jt.isURLSearchParams(g)&&(g=g+""),jt.isString(g))return(await B3(g)).byteLength},j3=async(g,y)=>{const T=jt.toFiniteNumber(g.getContentLength());return T??U3(y)},V3=$w&&(async g=>{let{url:y,method:T,data:k,signal:L,cancelToken:$,timeout:X,onDownloadProgress:a,onUploadProgress:ee,responseType:se,headers:fe,withCredentials:ge="same-origin",fetchOptions:le}=pD(g);se=se?(se+"").toLowerCase():"text";let ke=N3([L,$&&$.toAbortSignal()],X),Re;const Ue=ke&&ke.unsubscribe&&(()=>{ke.unsubscribe()});let Pe;try{if(ee&&F3&&T!=="get"&&T!=="head"&&(Pe=await j3(fe,k))!==0){let Xt=new Request(y,{method:"POST",body:k,duplex:"half"}),cn;if(jt.isFormData(k)&&(cn=Xt.headers.get("content-type"))&&fe.setContentType(cn),Xt.body){const[xt,rn]=JE(Pe,Dw(QE(ee)));k=tA(Xt.body,nA,xt,rn)}}jt.isString(ge)||(ge=ge?"include":"omit");const We="credentials"in Request.prototype;Re=new Request(y,{...le,signal:ke,method:T.toUpperCase(),headers:fe.normalize().toJSON(),body:k,duplex:"half",credentials:We?ge:void 0});let Tt=await fetch(Re);const wt=yT&&(se==="stream"||se==="response");if(yT&&(a||wt&&Ue)){const Xt={};["status","statusText","headers"].forEach(Ut=>{Xt[Ut]=Tt[Ut]});const cn=jt.toFiniteNumber(Tt.headers.get("content-length")),[xt,rn]=a&&JE(cn,Dw(QE(a),!0))||[];Tt=new Response(tA(Tt.body,nA,xt,()=>{rn&&rn(),Ue&&Ue()}),Xt)}se=se||"text";let St=await Mw[jt.findKey(Mw,se)||"text"](Tt,g);return!wt&&Ue&&Ue(),await new Promise((Xt,cn)=>{hD(Xt,cn,{data:St,headers:ac.from(Tt.headers),status:Tt.status,statusText:Tt.statusText,config:g,request:Re})})}catch(We){throw Ue&&Ue(),We&&We.name==="TypeError"&&/Load failed|fetch/i.test(We.message)?Object.assign(new Zr("Network Error",Zr.ERR_NETWORK,g,Re),{cause:We.cause||We}):Zr.from(We,We&&We.code,g,Re)}}),vT={http:r3,xhr:I3,fetch:V3};jt.forEach(vT,(g,y)=>{if(g){try{Object.defineProperty(g,"name",{value:y})}catch{}Object.defineProperty(g,"adapterName",{value:y})}});const rA=g=>`- ${g}`,q3=g=>jt.isFunction(g)||g===null||g===!1,_D={getAdapter:g=>{g=jt.isArray(g)?g:[g];const{length:y}=g;let T,k;const L={};for(let $=0;$<y;$++){T=g[$];let X;if(k=T,!q3(T)&&(k=vT[(X=String(T)).toLowerCase()],k===void 0))throw new Zr(`Unknown adapter '${X}'`);if(k)break;L[X||"#"+$]=k}if(!k){const $=Object.entries(L).map(([a,ee])=>`adapter ${a} `+(ee===!1?"is not supported by the environment":"is not available in the build"));let X=y?$.length>1?`since :
`+$.map(rA).join(`
`):" "+rA($[0]):"as no adapter specified";throw new Zr("There is no suitable adapter to dispatch the request "+X,"ERR_NOT_SUPPORT")}return k},adapters:vT};function $S(g){if(g.cancelToken&&g.cancelToken.throwIfRequested(),g.signal&&g.signal.aborted)throw new t0(null,g)}function iA(g){return $S(g),g.headers=ac.from(g.headers),g.data=GS.call(g,g.transformRequest),["post","put","patch"].indexOf(g.method)!==-1&&g.headers.setContentType("application/x-www-form-urlencoded",!1),_D.getAdapter(g.adapter||fb.adapter)(g).then(function(k){return $S(g),k.data=GS.call(g,g.transformResponse,k),k.headers=ac.from(k.headers),k},function(k){return dD(k)||($S(g),k&&k.response&&(k.response.data=GS.call(g,g.transformResponse,k.response),k.response.headers=ac.from(k.response.headers))),Promise.reject(k)})}const yD="1.9.0",Zw={};["object","boolean","number","function","string","symbol"].forEach((g,y)=>{Zw[g]=function(k){return typeof k===g||"a"+(y<1?"n ":" ")+g}});const oA={};Zw.transitional=function(y,T,k){function L($,X){return"[Axios v"+yD+"] Transitional option '"+$+"'"+X+(k?". "+k:"")}return($,X,a)=>{if(y===!1)throw new Zr(L(X," has been removed"+(T?" in "+T:"")),Zr.ERR_DEPRECATED);return T&&!oA[X]&&(oA[X]=!0,console.warn(L(X," has been deprecated since v"+T+" and will be removed in the near future"))),y?y($,X,a):!0}};Zw.spelling=function(y){return(T,k)=>(console.warn(`${k} is likely a misspelling of ${y}`),!0)};function H3(g,y,T){if(typeof g!="object")throw new Zr("options must be an object",Zr.ERR_BAD_OPTION_VALUE);const k=Object.keys(g);let L=k.length;for(;L-- >0;){const $=k[L],X=y[$];if(X){const a=g[$],ee=a===void 0||X(a,$,g);if(ee!==!0)throw new Zr("option "+$+" must be "+ee,Zr.ERR_BAD_OPTION_VALUE);continue}if(T!==!0)throw new Zr("Unknown option "+$,Zr.ERR_BAD_OPTION)}}const lw={assertOptions:H3,validators:Zw},sf=lw.validators;let dy=class{constructor(y){this.defaults=y||{},this.interceptors={request:new XE,response:new XE}}async request(y,T){try{return await this._request(y,T)}catch(k){if(k instanceof Error){let L={};Error.captureStackTrace?Error.captureStackTrace(L):L=new Error;const $=L.stack?L.stack.replace(/^.+\n/,""):"";try{k.stack?$&&!String(k.stack).endsWith($.replace(/^.+\n.+\n/,""))&&(k.stack+=`
`+$):k.stack=$}catch{}}throw k}}_request(y,T){typeof y=="string"?(T=T||{},T.url=y):T=y||{},T=gy(this.defaults,T);const{transitional:k,paramsSerializer:L,headers:$}=T;k!==void 0&&lw.assertOptions(k,{silentJSONParsing:sf.transitional(sf.boolean),forcedJSONParsing:sf.transitional(sf.boolean),clarifyTimeoutError:sf.transitional(sf.boolean)},!1),L!=null&&(jt.isFunction(L)?T.paramsSerializer={serialize:L}:lw.assertOptions(L,{encode:sf.function,serialize:sf.function},!0)),T.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?T.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:T.allowAbsoluteUrls=!0),lw.assertOptions(T,{baseUrl:sf.spelling("baseURL"),withXsrfToken:sf.spelling("withXSRFToken")},!0),T.method=(T.method||this.defaults.method||"get").toLowerCase();let X=$&&jt.merge($.common,$[T.method]);$&&jt.forEach(["delete","get","head","post","put","patch","common"],Re=>{delete $[Re]}),T.headers=ac.concat(X,$);const a=[];let ee=!0;this.interceptors.request.forEach(function(Ue){typeof Ue.runWhen=="function"&&Ue.runWhen(T)===!1||(ee=ee&&Ue.synchronous,a.unshift(Ue.fulfilled,Ue.rejected))});const se=[];this.interceptors.response.forEach(function(Ue){se.push(Ue.fulfilled,Ue.rejected)});let fe,ge=0,le;if(!ee){const Re=[iA.bind(this),void 0];for(Re.unshift.apply(Re,a),Re.push.apply(Re,se),le=Re.length,fe=Promise.resolve(T);ge<le;)fe=fe.then(Re[ge++],Re[ge++]);return fe}le=a.length;let ke=T;for(ge=0;ge<le;){const Re=a[ge++],Ue=a[ge++];try{ke=Re(ke)}catch(Pe){Ue.call(this,Pe);break}}try{fe=iA.call(this,ke)}catch(Re){return Promise.reject(Re)}for(ge=0,le=se.length;ge<le;)fe=fe.then(se[ge++],se[ge++]);return fe}getUri(y){y=gy(this.defaults,y);const T=fD(y.baseURL,y.url,y.allowAbsoluteUrls);return lD(T,y.params,y.paramsSerializer)}};jt.forEach(["delete","get","head","options"],function(y){dy.prototype[y]=function(T,k){return this.request(gy(k||{},{method:y,url:T,data:(k||{}).data}))}});jt.forEach(["post","put","patch"],function(y){function T(k){return function($,X,a){return this.request(gy(a||{},{method:y,headers:k?{"Content-Type":"multipart/form-data"}:{},url:$,data:X}))}}dy.prototype[y]=T(),dy.prototype[y+"Form"]=T(!0)});let G3=class vD{constructor(y){if(typeof y!="function")throw new TypeError("executor must be a function.");let T;this.promise=new Promise(function($){T=$});const k=this;this.promise.then(L=>{if(!k._listeners)return;let $=k._listeners.length;for(;$-- >0;)k._listeners[$](L);k._listeners=null}),this.promise.then=L=>{let $;const X=new Promise(a=>{k.subscribe(a),$=a}).then(L);return X.cancel=function(){k.unsubscribe($)},X},y(function($,X,a){k.reason||(k.reason=new t0($,X,a),T(k.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(y){if(this.reason){y(this.reason);return}this._listeners?this._listeners.push(y):this._listeners=[y]}unsubscribe(y){if(!this._listeners)return;const T=this._listeners.indexOf(y);T!==-1&&this._listeners.splice(T,1)}toAbortSignal(){const y=new AbortController,T=k=>{y.abort(k)};return this.subscribe(T),y.signal.unsubscribe=()=>this.unsubscribe(T),y.signal}static source(){let y;return{token:new vD(function(L){y=L}),cancel:y}}};function $3(g){return function(T){return g.apply(null,T)}}function Z3(g){return jt.isObject(g)&&g.isAxiosError===!0}const xT={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(xT).forEach(([g,y])=>{xT[y]=g});function xD(g){const y=new dy(g),T=XC(dy.prototype.request,y);return jt.extend(T,dy.prototype,y,{allOwnKeys:!0}),jt.extend(T,y,null,{allOwnKeys:!0}),T.create=function(L){return xD(gy(g,L))},T}const bi=xD(fb);bi.Axios=dy;bi.CanceledError=t0;bi.CancelToken=G3;bi.isCancel=dD;bi.VERSION=yD;bi.toFormData=Gw;bi.AxiosError=Zr;bi.Cancel=bi.CanceledError;bi.all=function(y){return Promise.all(y)};bi.spread=$3;bi.isAxiosError=Z3;bi.mergeConfig=gy;bi.AxiosHeaders=ac;bi.formToJSON=g=>uD(jt.isHTMLForm(g)?new FormData(g):g);bi.getAdapter=_D.getAdapter;bi.HttpStatusCode=xT;bi.default=bi;const{Axios:bz,AxiosError:wz,CanceledError:Sz,isCancel:Tz,CancelToken:Ez,VERSION:Az,all:Cz,Cancel:Dz,isAxiosError:Mz,spread:Rz,toFormData:kz,AxiosHeaders:Oz,HttpStatusCode:Iz,formToJSON:Nz,getAdapter:zz,mergeConfig:Pz}=bi,Yw="http://localhost:3000/api",Ww=()=>({headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),cw=xl("user/getCurrentUser",async(g,{rejectWithValue:y})=>{var T,k;try{return(await bi.get(`${Yw}/users/me`,Ww())).data.data}catch(L){return y(((k=(T=L.response)==null?void 0:T.data)==null?void 0:k.message)||"Failed to fetch user profile")}}),uw=xl("user/updateUserProfile",async(g,{rejectWithValue:y})=>{var T,k;try{return(await bi.put(`${Yw}/users/me`,g,Ww())).data.data}catch(L){return y(((k=(T=L.response)==null?void 0:T.data)==null?void 0:k.message)||"Failed to update profile")}}),Qx=xl("user/updateUserLocation",async({longitude:g,latitude:y},{rejectWithValue:T,dispatch:k})=>{var L,$;try{return isNaN(g)||isNaN(y)||g<-180||g>180||y<-90||y>90?T("Invalid coordinates provided"):(k(W3([g,y])),(await bi.patch(`${Yw}/users/me/location`,{longitude:parseFloat(g),latitude:parseFloat(y)},Ww())).data.data)}catch(X){return console.error("Location update error:",X),T((($=(L=X.response)==null?void 0:L.data)==null?void 0:$.message)||"Failed to update location")}}),bD=xl("user/updateAvailability",async(g,{rejectWithValue:y})=>{var T,k;try{return(await bi.patch(`${Yw}/users/me/availability`,{availabilityStatus:g},Ww())).data.data}catch(L){return y(((k=(T=L.response)==null?void 0:T.data)==null?void 0:k.message)||"Failed to update availability")}}),Y3={profile:null,currentLocation:null,loading:!1,error:null},wD=Uw({name:"user",initialState:Y3,reducers:{resetUserError:g=>{g.error=null},setCurrentLocation:(g,y)=>{if(Array.isArray(y.payload)&&y.payload.length===2){const[T,k]=y.payload;!isNaN(T)&&!isNaN(k)&&T>=-180&&T<=180&&k>=-90&&k<=90?(g.currentLocation=[parseFloat(T),parseFloat(k)],console.log(`Location set in Redux: [${T}, ${k}]`)):console.error("Invalid coordinates:",y.payload)}else console.error("Invalid location format:",y.payload)}},extraReducers:g=>{g.addCase(cw.pending,y=>{y.loading=!0,y.error=null}).addCase(cw.fulfilled,(y,T)=>{y.loading=!1,y.profile=T.payload,T.payload.currentLocation&&(y.currentLocation=T.payload.currentLocation.coordinates)}).addCase(cw.rejected,(y,T)=>{y.loading=!1,y.error=T.payload}).addCase(uw.pending,y=>{y.loading=!0,y.error=null}).addCase(uw.fulfilled,(y,T)=>{y.loading=!1,y.profile=T.payload}).addCase(uw.rejected,(y,T)=>{y.loading=!1,y.error=T.payload}).addCase(Qx.pending,y=>{y.loading=!0,y.error=null}).addCase(Qx.fulfilled,(y,T)=>{y.loading=!1,y.profile=T.payload,T.payload.currentLocation&&T.payload.currentLocation.coordinates&&T.payload.currentLocation.coordinates.length===2&&(y.currentLocation=T.payload.currentLocation.coordinates,console.log("Location updated from server response:",y.currentLocation))}).addCase(Qx.rejected,(y,T)=>{y.loading=!1,y.error=T.payload,console.error("Location update rejected:",T.payload)}).addCase(bD.fulfilled,(y,T)=>{y.profile=T.payload})}}),{resetUserError:Lz,setCurrentLocation:W3}=wD.actions,X3=wD.reducer,lf=Object.create(null);lf.open="0";lf.close="1";lf.ping="2";lf.pong="3";lf.message="4";lf.upgrade="5";lf.noop="6";const dw=Object.create(null);Object.keys(lf).forEach(g=>{dw[lf[g]]=g});const bT={type:"error",data:"parser error"},SD=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",TD=typeof ArrayBuffer=="function",ED=g=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(g):g&&g.buffer instanceof ArrayBuffer,ZT=({type:g,data:y},T,k)=>SD&&y instanceof Blob?T?k(y):sA(y,k):TD&&(y instanceof ArrayBuffer||ED(y))?T?k(y):sA(new Blob([y]),k):k(lf[g]+(y||"")),sA=(g,y)=>{const T=new FileReader;return T.onload=function(){const k=T.result.split(",")[1];y("b"+(k||""))},T.readAsDataURL(g)};function aA(g){return g instanceof Uint8Array?g:g instanceof ArrayBuffer?new Uint8Array(g):new Uint8Array(g.buffer,g.byteOffset,g.byteLength)}let ZS;function K3(g,y){if(SD&&g.data instanceof Blob)return g.data.arrayBuffer().then(aA).then(y);if(TD&&(g.data instanceof ArrayBuffer||ED(g.data)))return y(aA(g.data));ZT(g,!1,T=>{ZS||(ZS=new TextEncoder),y(ZS.encode(T))})}const lA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Wx=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let g=0;g<lA.length;g++)Wx[lA.charCodeAt(g)]=g;const J3=g=>{let y=g.length*.75,T=g.length,k,L=0,$,X,a,ee;g[g.length-1]==="="&&(y--,g[g.length-2]==="="&&y--);const se=new ArrayBuffer(y),fe=new Uint8Array(se);for(k=0;k<T;k+=4)$=Wx[g.charCodeAt(k)],X=Wx[g.charCodeAt(k+1)],a=Wx[g.charCodeAt(k+2)],ee=Wx[g.charCodeAt(k+3)],fe[L++]=$<<2|X>>4,fe[L++]=(X&15)<<4|a>>2,fe[L++]=(a&3)<<6|ee&63;return se},Q3=typeof ArrayBuffer=="function",YT=(g,y)=>{if(typeof g!="string")return{type:"message",data:AD(g,y)};const T=g.charAt(0);return T==="b"?{type:"message",data:eN(g.substring(1),y)}:dw[T]?g.length>1?{type:dw[T],data:g.substring(1)}:{type:dw[T]}:bT},eN=(g,y)=>{if(Q3){const T=J3(g);return AD(T,y)}else return{base64:!0,data:g}},AD=(g,y)=>{switch(y){case"blob":return g instanceof Blob?g:new Blob([g]);case"arraybuffer":default:return g instanceof ArrayBuffer?g:g.buffer}},CD="",tN=(g,y)=>{const T=g.length,k=new Array(T);let L=0;g.forEach(($,X)=>{ZT($,!1,a=>{k[X]=a,++L===T&&y(k.join(CD))})})},nN=(g,y)=>{const T=g.split(CD),k=[];for(let L=0;L<T.length;L++){const $=YT(T[L],y);if(k.push($),$.type==="error")break}return k};function rN(){return new TransformStream({transform(g,y){K3(g,T=>{const k=T.length;let L;if(k<126)L=new Uint8Array(1),new DataView(L.buffer).setUint8(0,k);else if(k<65536){L=new Uint8Array(3);const $=new DataView(L.buffer);$.setUint8(0,126),$.setUint16(1,k)}else{L=new Uint8Array(9);const $=new DataView(L.buffer);$.setUint8(0,127),$.setBigUint64(1,BigInt(k))}g.data&&typeof g.data!="string"&&(L[0]|=128),y.enqueue(L),y.enqueue(T)})}})}let YS;function ew(g){return g.reduce((y,T)=>y+T.length,0)}function tw(g,y){if(g[0].length===y)return g.shift();const T=new Uint8Array(y);let k=0;for(let L=0;L<y;L++)T[L]=g[0][k++],k===g[0].length&&(g.shift(),k=0);return g.length&&k<g[0].length&&(g[0]=g[0].slice(k)),T}function iN(g,y){YS||(YS=new TextDecoder);const T=[];let k=0,L=-1,$=!1;return new TransformStream({transform(X,a){for(T.push(X);;){if(k===0){if(ew(T)<1)break;const ee=tw(T,1);$=(ee[0]&128)===128,L=ee[0]&127,L<126?k=3:L===126?k=1:k=2}else if(k===1){if(ew(T)<2)break;const ee=tw(T,2);L=new DataView(ee.buffer,ee.byteOffset,ee.length).getUint16(0),k=3}else if(k===2){if(ew(T)<8)break;const ee=tw(T,8),se=new DataView(ee.buffer,ee.byteOffset,ee.length),fe=se.getUint32(0);if(fe>Math.pow(2,21)-1){a.enqueue(bT);break}L=fe*Math.pow(2,32)+se.getUint32(4),k=3}else{if(ew(T)<L)break;const ee=tw(T,L);a.enqueue(YT($?ee:YS.decode(ee),y)),k=0}if(L===0||L>g){a.enqueue(bT);break}}}})}const DD=4;function as(g){if(g)return oN(g)}function oN(g){for(var y in as.prototype)g[y]=as.prototype[y];return g}as.prototype.on=as.prototype.addEventListener=function(g,y){return this._callbacks=this._callbacks||{},(this._callbacks["$"+g]=this._callbacks["$"+g]||[]).push(y),this};as.prototype.once=function(g,y){function T(){this.off(g,T),y.apply(this,arguments)}return T.fn=y,this.on(g,T),this};as.prototype.off=as.prototype.removeListener=as.prototype.removeAllListeners=as.prototype.removeEventListener=function(g,y){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var T=this._callbacks["$"+g];if(!T)return this;if(arguments.length==1)return delete this._callbacks["$"+g],this;for(var k,L=0;L<T.length;L++)if(k=T[L],k===y||k.fn===y){T.splice(L,1);break}return T.length===0&&delete this._callbacks["$"+g],this};as.prototype.emit=function(g){this._callbacks=this._callbacks||{};for(var y=new Array(arguments.length-1),T=this._callbacks["$"+g],k=1;k<arguments.length;k++)y[k-1]=arguments[k];if(T){T=T.slice(0);for(var k=0,L=T.length;k<L;++k)T[k].apply(this,y)}return this};as.prototype.emitReserved=as.prototype.emit;as.prototype.listeners=function(g){return this._callbacks=this._callbacks||{},this._callbacks["$"+g]||[]};as.prototype.hasListeners=function(g){return!!this.listeners(g).length};const Xw=typeof Promise=="function"&&typeof Promise.resolve=="function"?y=>Promise.resolve().then(y):(y,T)=>T(y,0),Su=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),sN="arraybuffer";function MD(g,...y){return y.reduce((T,k)=>(g.hasOwnProperty(k)&&(T[k]=g[k]),T),{})}const aN=Su.setTimeout,lN=Su.clearTimeout;function Kw(g,y){y.useNativeTimers?(g.setTimeoutFn=aN.bind(Su),g.clearTimeoutFn=lN.bind(Su)):(g.setTimeoutFn=Su.setTimeout.bind(Su),g.clearTimeoutFn=Su.clearTimeout.bind(Su))}const cN=1.33;function uN(g){return typeof g=="string"?dN(g):Math.ceil((g.byteLength||g.size)*cN)}function dN(g){let y=0,T=0;for(let k=0,L=g.length;k<L;k++)y=g.charCodeAt(k),y<128?T+=1:y<2048?T+=2:y<55296||y>=57344?T+=3:(k++,T+=4);return T}function RD(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function hN(g){let y="";for(let T in g)g.hasOwnProperty(T)&&(y.length&&(y+="&"),y+=encodeURIComponent(T)+"="+encodeURIComponent(g[T]));return y}function fN(g){let y={},T=g.split("&");for(let k=0,L=T.length;k<L;k++){let $=T[k].split("=");y[decodeURIComponent($[0])]=decodeURIComponent($[1])}return y}class pN extends Error{constructor(y,T,k){super(y),this.description=T,this.context=k,this.type="TransportError"}}class WT extends as{constructor(y){super(),this.writable=!1,Kw(this,y),this.opts=y,this.query=y.query,this.socket=y.socket,this.supportsBinary=!y.forceBase64}onError(y,T,k){return super.emitReserved("error",new pN(y,T,k)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(y){this.readyState==="open"&&this.write(y)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(y){const T=YT(y,this.socket.binaryType);this.onPacket(T)}onPacket(y){super.emitReserved("packet",y)}onClose(y){this.readyState="closed",super.emitReserved("close",y)}pause(y){}createUri(y,T={}){return y+"://"+this._hostname()+this._port()+this.opts.path+this._query(T)}_hostname(){const y=this.opts.hostname;return y.indexOf(":")===-1?y:"["+y+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(y){const T=hN(y);return T.length?"?"+T:""}}class mN extends WT{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(y){this.readyState="pausing";const T=()=>{this.readyState="paused",y()};if(this._polling||!this.writable){let k=0;this._polling&&(k++,this.once("pollComplete",function(){--k||T()})),this.writable||(k++,this.once("drain",function(){--k||T()}))}else T()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(y){const T=k=>{if(this.readyState==="opening"&&k.type==="open"&&this.onOpen(),k.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(k)};nN(y,this.socket.binaryType).forEach(T),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const y=()=>{this.write([{type:"close"}])};this.readyState==="open"?y():this.once("open",y)}write(y){this.writable=!1,tN(y,T=>{this.doWrite(T,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const y=this.opts.secure?"https":"http",T=this.query||{};return this.opts.timestampRequests!==!1&&(T[this.opts.timestampParam]=RD()),!this.supportsBinary&&!T.sid&&(T.b64=1),this.createUri(y,T)}}let kD=!1;try{kD=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const gN=kD;function _N(){}class yN extends mN{constructor(y){if(super(y),typeof location<"u"){const T=location.protocol==="https:";let k=location.port;k||(k=T?"443":"80"),this.xd=typeof location<"u"&&y.hostname!==location.hostname||k!==y.port}}doWrite(y,T){const k=this.request({method:"POST",data:y});k.on("success",T),k.on("error",(L,$)=>{this.onError("xhr post error",L,$)})}doPoll(){const y=this.request();y.on("data",this.onData.bind(this)),y.on("error",(T,k)=>{this.onError("xhr poll error",T,k)}),this.pollXhr=y}}let Gv=class hw extends as{constructor(y,T,k){super(),this.createRequest=y,Kw(this,k),this._opts=k,this._method=k.method||"GET",this._uri=T,this._data=k.data!==void 0?k.data:null,this._create()}_create(){var y;const T=MD(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");T.xdomain=!!this._opts.xd;const k=this._xhr=this.createRequest(T);try{k.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){k.setDisableHeaderCheck&&k.setDisableHeaderCheck(!0);for(let L in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(L)&&k.setRequestHeader(L,this._opts.extraHeaders[L])}}catch{}if(this._method==="POST")try{k.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{k.setRequestHeader("Accept","*/*")}catch{}(y=this._opts.cookieJar)===null||y===void 0||y.addCookies(k),"withCredentials"in k&&(k.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(k.timeout=this._opts.requestTimeout),k.onreadystatechange=()=>{var L;k.readyState===3&&((L=this._opts.cookieJar)===null||L===void 0||L.parseCookies(k.getResponseHeader("set-cookie"))),k.readyState===4&&(k.status===200||k.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof k.status=="number"?k.status:0)},0))},k.send(this._data)}catch(L){this.setTimeoutFn(()=>{this._onError(L)},0);return}typeof document<"u"&&(this._index=hw.requestsCount++,hw.requests[this._index]=this)}_onError(y){this.emitReserved("error",y,this._xhr),this._cleanup(!0)}_cleanup(y){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=_N,y)try{this._xhr.abort()}catch{}typeof document<"u"&&delete hw.requests[this._index],this._xhr=null}}_onLoad(){const y=this._xhr.responseText;y!==null&&(this.emitReserved("data",y),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};Gv.requestsCount=0;Gv.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",cA);else if(typeof addEventListener=="function"){const g="onpagehide"in Su?"pagehide":"unload";addEventListener(g,cA,!1)}}function cA(){for(let g in Gv.requests)Gv.requests.hasOwnProperty(g)&&Gv.requests[g].abort()}const vN=function(){const g=OD({xdomain:!1});return g&&g.responseType!==null}();class xN extends yN{constructor(y){super(y);const T=y&&y.forceBase64;this.supportsBinary=vN&&!T}request(y={}){return Object.assign(y,{xd:this.xd},this.opts),new Gv(OD,this.uri(),y)}}function OD(g){const y=g.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!y||gN))return new XMLHttpRequest}catch{}if(!y)try{return new Su[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const ID=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class bN extends WT{get name(){return"websocket"}doOpen(){const y=this.uri(),T=this.opts.protocols,k=ID?{}:MD(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(k.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(y,T,k)}catch(L){return this.emitReserved("error",L)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=y=>this.onClose({description:"websocket connection closed",context:y}),this.ws.onmessage=y=>this.onData(y.data),this.ws.onerror=y=>this.onError("websocket error",y)}write(y){this.writable=!1;for(let T=0;T<y.length;T++){const k=y[T],L=T===y.length-1;ZT(k,this.supportsBinary,$=>{try{this.doWrite(k,$)}catch{}L&&Xw(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const y=this.opts.secure?"wss":"ws",T=this.query||{};return this.opts.timestampRequests&&(T[this.opts.timestampParam]=RD()),this.supportsBinary||(T.b64=1),this.createUri(y,T)}}const WS=Su.WebSocket||Su.MozWebSocket;class wN extends bN{createSocket(y,T,k){return ID?new WS(y,T,k):T?new WS(y,T):new WS(y)}doWrite(y,T){this.ws.send(T)}}class SN extends WT{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(y){return this.emitReserved("error",y)}this._transport.closed.then(()=>{this.onClose()}).catch(y=>{this.onError("webtransport error",y)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(y=>{const T=iN(Number.MAX_SAFE_INTEGER,this.socket.binaryType),k=y.readable.pipeThrough(T).getReader(),L=rN();L.readable.pipeTo(y.writable),this._writer=L.writable.getWriter();const $=()=>{k.read().then(({done:a,value:ee})=>{a||(this.onPacket(ee),$())}).catch(a=>{})};$();const X={type:"open"};this.query.sid&&(X.data=`{"sid":"${this.query.sid}"}`),this._writer.write(X).then(()=>this.onOpen())})})}write(y){this.writable=!1;for(let T=0;T<y.length;T++){const k=y[T],L=T===y.length-1;this._writer.write(k).then(()=>{L&&Xw(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var y;(y=this._transport)===null||y===void 0||y.close()}}const TN={websocket:wN,webtransport:SN,polling:xN},EN=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,AN=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function wT(g){if(g.length>8e3)throw"URI too long";const y=g,T=g.indexOf("["),k=g.indexOf("]");T!=-1&&k!=-1&&(g=g.substring(0,T)+g.substring(T,k).replace(/:/g,";")+g.substring(k,g.length));let L=EN.exec(g||""),$={},X=14;for(;X--;)$[AN[X]]=L[X]||"";return T!=-1&&k!=-1&&($.source=y,$.host=$.host.substring(1,$.host.length-1).replace(/;/g,":"),$.authority=$.authority.replace("[","").replace("]","").replace(/;/g,":"),$.ipv6uri=!0),$.pathNames=CN($,$.path),$.queryKey=DN($,$.query),$}function CN(g,y){const T=/\/{2,9}/g,k=y.replace(T,"/").split("/");return(y.slice(0,1)=="/"||y.length===0)&&k.splice(0,1),y.slice(-1)=="/"&&k.splice(k.length-1,1),k}function DN(g,y){const T={};return y.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(k,L,$){L&&(T[L]=$)}),T}const ST=typeof addEventListener=="function"&&typeof removeEventListener=="function",fw=[];ST&&addEventListener("offline",()=>{fw.forEach(g=>g())},!1);class Eg extends as{constructor(y,T){if(super(),this.binaryType=sN,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,y&&typeof y=="object"&&(T=y,y=null),y){const k=wT(y);T.hostname=k.host,T.secure=k.protocol==="https"||k.protocol==="wss",T.port=k.port,k.query&&(T.query=k.query)}else T.host&&(T.hostname=wT(T.host).host);Kw(this,T),this.secure=T.secure!=null?T.secure:typeof location<"u"&&location.protocol==="https:",T.hostname&&!T.port&&(T.port=this.secure?"443":"80"),this.hostname=T.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=T.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},T.transports.forEach(k=>{const L=k.prototype.name;this.transports.push(L),this._transportsByName[L]=k}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},T),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=fN(this.opts.query)),ST&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},fw.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(y){const T=Object.assign({},this.opts.query);T.EIO=DD,T.transport=y,this.id&&(T.sid=this.id);const k=Object.assign({},this.opts,{query:T,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[y]);return new this._transportsByName[y](k)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const y=this.opts.rememberUpgrade&&Eg.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const T=this.createTransport(y);T.open(),this.setTransport(T)}setTransport(y){this.transport&&this.transport.removeAllListeners(),this.transport=y,y.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",T=>this._onClose("transport close",T))}onOpen(){this.readyState="open",Eg.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(y){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",y),this.emitReserved("heartbeat"),y.type){case"open":this.onHandshake(JSON.parse(y.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const T=new Error("server error");T.code=y.data,this._onError(T);break;case"message":this.emitReserved("data",y.data),this.emitReserved("message",y.data);break}}onHandshake(y){this.emitReserved("handshake",y),this.id=y.sid,this.transport.query.sid=y.sid,this._pingInterval=y.pingInterval,this._pingTimeout=y.pingTimeout,this._maxPayload=y.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const y=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+y,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},y),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const y=this._getWritablePackets();this.transport.send(y),this._prevBufferLen=y.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let T=1;for(let k=0;k<this.writeBuffer.length;k++){const L=this.writeBuffer[k].data;if(L&&(T+=uN(L)),k>0&&T>this._maxPayload)return this.writeBuffer.slice(0,k);T+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const y=Date.now()>this._pingTimeoutTime;return y&&(this._pingTimeoutTime=0,Xw(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),y}write(y,T,k){return this._sendPacket("message",y,T,k),this}send(y,T,k){return this._sendPacket("message",y,T,k),this}_sendPacket(y,T,k,L){if(typeof T=="function"&&(L=T,T=void 0),typeof k=="function"&&(L=k,k=null),this.readyState==="closing"||this.readyState==="closed")return;k=k||{},k.compress=k.compress!==!1;const $={type:y,data:T,options:k};this.emitReserved("packetCreate",$),this.writeBuffer.push($),L&&this.once("flush",L),this.flush()}close(){const y=()=>{this._onClose("forced close"),this.transport.close()},T=()=>{this.off("upgrade",T),this.off("upgradeError",T),y()},k=()=>{this.once("upgrade",T),this.once("upgradeError",T)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?k():y()}):this.upgrading?k():y()),this}_onError(y){if(Eg.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",y),this._onClose("transport error",y)}_onClose(y,T){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),ST&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const k=fw.indexOf(this._offlineEventListener);k!==-1&&fw.splice(k,1)}this.readyState="closed",this.id=null,this.emitReserved("close",y,T),this.writeBuffer=[],this._prevBufferLen=0}}}Eg.protocol=DD;class MN extends Eg{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let y=0;y<this._upgrades.length;y++)this._probe(this._upgrades[y])}_probe(y){let T=this.createTransport(y),k=!1;Eg.priorWebsocketSuccess=!1;const L=()=>{k||(T.send([{type:"ping",data:"probe"}]),T.once("packet",ge=>{if(!k)if(ge.type==="pong"&&ge.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",T),!T)return;Eg.priorWebsocketSuccess=T.name==="websocket",this.transport.pause(()=>{k||this.readyState!=="closed"&&(fe(),this.setTransport(T),T.send([{type:"upgrade"}]),this.emitReserved("upgrade",T),T=null,this.upgrading=!1,this.flush())})}else{const le=new Error("probe error");le.transport=T.name,this.emitReserved("upgradeError",le)}}))};function $(){k||(k=!0,fe(),T.close(),T=null)}const X=ge=>{const le=new Error("probe error: "+ge);le.transport=T.name,$(),this.emitReserved("upgradeError",le)};function a(){X("transport closed")}function ee(){X("socket closed")}function se(ge){T&&ge.name!==T.name&&$()}const fe=()=>{T.removeListener("open",L),T.removeListener("error",X),T.removeListener("close",a),this.off("close",ee),this.off("upgrading",se)};T.once("open",L),T.once("error",X),T.once("close",a),this.once("close",ee),this.once("upgrading",se),this._upgrades.indexOf("webtransport")!==-1&&y!=="webtransport"?this.setTimeoutFn(()=>{k||T.open()},200):T.open()}onHandshake(y){this._upgrades=this._filterUpgrades(y.upgrades),super.onHandshake(y)}_filterUpgrades(y){const T=[];for(let k=0;k<y.length;k++)~this.transports.indexOf(y[k])&&T.push(y[k]);return T}}let RN=class extends MN{constructor(y,T={}){const k=typeof y=="object"?y:T;(!k.transports||k.transports&&typeof k.transports[0]=="string")&&(k.transports=(k.transports||["polling","websocket","webtransport"]).map(L=>TN[L]).filter(L=>!!L)),super(y,k)}};function kN(g,y="",T){let k=g;T=T||typeof location<"u"&&location,g==null&&(g=T.protocol+"//"+T.host),typeof g=="string"&&(g.charAt(0)==="/"&&(g.charAt(1)==="/"?g=T.protocol+g:g=T.host+g),/^(https?|wss?):\/\//.test(g)||(typeof T<"u"?g=T.protocol+"//"+g:g="https://"+g),k=wT(g)),k.port||(/^(http|ws)$/.test(k.protocol)?k.port="80":/^(http|ws)s$/.test(k.protocol)&&(k.port="443")),k.path=k.path||"/";const $=k.host.indexOf(":")!==-1?"["+k.host+"]":k.host;return k.id=k.protocol+"://"+$+":"+k.port+y,k.href=k.protocol+"://"+$+(T&&T.port===k.port?"":":"+k.port),k}const ON=typeof ArrayBuffer=="function",IN=g=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(g):g.buffer instanceof ArrayBuffer,ND=Object.prototype.toString,NN=typeof Blob=="function"||typeof Blob<"u"&&ND.call(Blob)==="[object BlobConstructor]",zN=typeof File=="function"||typeof File<"u"&&ND.call(File)==="[object FileConstructor]";function XT(g){return ON&&(g instanceof ArrayBuffer||IN(g))||NN&&g instanceof Blob||zN&&g instanceof File}function pw(g,y){if(!g||typeof g!="object")return!1;if(Array.isArray(g)){for(let T=0,k=g.length;T<k;T++)if(pw(g[T]))return!0;return!1}if(XT(g))return!0;if(g.toJSON&&typeof g.toJSON=="function"&&arguments.length===1)return pw(g.toJSON(),!0);for(const T in g)if(Object.prototype.hasOwnProperty.call(g,T)&&pw(g[T]))return!0;return!1}function PN(g){const y=[],T=g.data,k=g;return k.data=TT(T,y),k.attachments=y.length,{packet:k,buffers:y}}function TT(g,y){if(!g)return g;if(XT(g)){const T={_placeholder:!0,num:y.length};return y.push(g),T}else if(Array.isArray(g)){const T=new Array(g.length);for(let k=0;k<g.length;k++)T[k]=TT(g[k],y);return T}else if(typeof g=="object"&&!(g instanceof Date)){const T={};for(const k in g)Object.prototype.hasOwnProperty.call(g,k)&&(T[k]=TT(g[k],y));return T}return g}function LN(g,y){return g.data=ET(g.data,y),delete g.attachments,g}function ET(g,y){if(!g)return g;if(g&&g._placeholder===!0){if(typeof g.num=="number"&&g.num>=0&&g.num<y.length)return y[g.num];throw new Error("illegal attachments")}else if(Array.isArray(g))for(let T=0;T<g.length;T++)g[T]=ET(g[T],y);else if(typeof g=="object")for(const T in g)Object.prototype.hasOwnProperty.call(g,T)&&(g[T]=ET(g[T],y));return g}const BN=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],FN=5;var _i;(function(g){g[g.CONNECT=0]="CONNECT",g[g.DISCONNECT=1]="DISCONNECT",g[g.EVENT=2]="EVENT",g[g.ACK=3]="ACK",g[g.CONNECT_ERROR=4]="CONNECT_ERROR",g[g.BINARY_EVENT=5]="BINARY_EVENT",g[g.BINARY_ACK=6]="BINARY_ACK"})(_i||(_i={}));class UN{constructor(y){this.replacer=y}encode(y){return(y.type===_i.EVENT||y.type===_i.ACK)&&pw(y)?this.encodeAsBinary({type:y.type===_i.EVENT?_i.BINARY_EVENT:_i.BINARY_ACK,nsp:y.nsp,data:y.data,id:y.id}):[this.encodeAsString(y)]}encodeAsString(y){let T=""+y.type;return(y.type===_i.BINARY_EVENT||y.type===_i.BINARY_ACK)&&(T+=y.attachments+"-"),y.nsp&&y.nsp!=="/"&&(T+=y.nsp+","),y.id!=null&&(T+=y.id),y.data!=null&&(T+=JSON.stringify(y.data,this.replacer)),T}encodeAsBinary(y){const T=PN(y),k=this.encodeAsString(T.packet),L=T.buffers;return L.unshift(k),L}}function uA(g){return Object.prototype.toString.call(g)==="[object Object]"}class KT extends as{constructor(y){super(),this.reviver=y}add(y){let T;if(typeof y=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");T=this.decodeString(y);const k=T.type===_i.BINARY_EVENT;k||T.type===_i.BINARY_ACK?(T.type=k?_i.EVENT:_i.ACK,this.reconstructor=new jN(T),T.attachments===0&&super.emitReserved("decoded",T)):super.emitReserved("decoded",T)}else if(XT(y)||y.base64)if(this.reconstructor)T=this.reconstructor.takeBinaryData(y),T&&(this.reconstructor=null,super.emitReserved("decoded",T));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+y)}decodeString(y){let T=0;const k={type:Number(y.charAt(0))};if(_i[k.type]===void 0)throw new Error("unknown packet type "+k.type);if(k.type===_i.BINARY_EVENT||k.type===_i.BINARY_ACK){const $=T+1;for(;y.charAt(++T)!=="-"&&T!=y.length;);const X=y.substring($,T);if(X!=Number(X)||y.charAt(T)!=="-")throw new Error("Illegal attachments");k.attachments=Number(X)}if(y.charAt(T+1)==="/"){const $=T+1;for(;++T&&!(y.charAt(T)===","||T===y.length););k.nsp=y.substring($,T)}else k.nsp="/";const L=y.charAt(T+1);if(L!==""&&Number(L)==L){const $=T+1;for(;++T;){const X=y.charAt(T);if(X==null||Number(X)!=X){--T;break}if(T===y.length)break}k.id=Number(y.substring($,T+1))}if(y.charAt(++T)){const $=this.tryParse(y.substr(T));if(KT.isPayloadValid(k.type,$))k.data=$;else throw new Error("invalid payload")}return k}tryParse(y){try{return JSON.parse(y,this.reviver)}catch{return!1}}static isPayloadValid(y,T){switch(y){case _i.CONNECT:return uA(T);case _i.DISCONNECT:return T===void 0;case _i.CONNECT_ERROR:return typeof T=="string"||uA(T);case _i.EVENT:case _i.BINARY_EVENT:return Array.isArray(T)&&(typeof T[0]=="number"||typeof T[0]=="string"&&BN.indexOf(T[0])===-1);case _i.ACK:case _i.BINARY_ACK:return Array.isArray(T)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class jN{constructor(y){this.packet=y,this.buffers=[],this.reconPack=y}takeBinaryData(y){if(this.buffers.push(y),this.buffers.length===this.reconPack.attachments){const T=LN(this.reconPack,this.buffers);return this.finishedReconstruction(),T}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const VN=Object.freeze(Object.defineProperty({__proto__:null,Decoder:KT,Encoder:UN,get PacketType(){return _i},protocol:FN},Symbol.toStringTag,{value:"Module"}));function Bd(g,y,T){return g.on(y,T),function(){g.off(y,T)}}const qN=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class zD extends as{constructor(y,T,k){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=y,this.nsp=T,k&&k.auth&&(this.auth=k.auth),this._opts=Object.assign({},k),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const y=this.io;this.subs=[Bd(y,"open",this.onopen.bind(this)),Bd(y,"packet",this.onpacket.bind(this)),Bd(y,"error",this.onerror.bind(this)),Bd(y,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...y){return y.unshift("message"),this.emit.apply(this,y),this}emit(y,...T){var k,L,$;if(qN.hasOwnProperty(y))throw new Error('"'+y.toString()+'" is a reserved event name');if(T.unshift(y),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(T),this;const X={type:_i.EVENT,data:T};if(X.options={},X.options.compress=this.flags.compress!==!1,typeof T[T.length-1]=="function"){const fe=this.ids++,ge=T.pop();this._registerAckCallback(fe,ge),X.id=fe}const a=(L=(k=this.io.engine)===null||k===void 0?void 0:k.transport)===null||L===void 0?void 0:L.writable,ee=this.connected&&!(!(($=this.io.engine)===null||$===void 0)&&$._hasPingExpired());return this.flags.volatile&&!a||(ee?(this.notifyOutgoingListeners(X),this.packet(X)):this.sendBuffer.push(X)),this.flags={},this}_registerAckCallback(y,T){var k;const L=(k=this.flags.timeout)!==null&&k!==void 0?k:this._opts.ackTimeout;if(L===void 0){this.acks[y]=T;return}const $=this.io.setTimeoutFn(()=>{delete this.acks[y];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===y&&this.sendBuffer.splice(a,1);T.call(this,new Error("operation has timed out"))},L),X=(...a)=>{this.io.clearTimeoutFn($),T.apply(this,a)};X.withError=!0,this.acks[y]=X}emitWithAck(y,...T){return new Promise((k,L)=>{const $=(X,a)=>X?L(X):k(a);$.withError=!0,T.push($),this.emit(y,...T)})}_addToQueue(y){let T;typeof y[y.length-1]=="function"&&(T=y.pop());const k={id:this._queueSeq++,tryCount:0,pending:!1,args:y,flags:Object.assign({fromQueue:!0},this.flags)};y.push((L,...$)=>k!==this._queue[0]?void 0:(L!==null?k.tryCount>this._opts.retries&&(this._queue.shift(),T&&T(L)):(this._queue.shift(),T&&T(null,...$)),k.pending=!1,this._drainQueue())),this._queue.push(k),this._drainQueue()}_drainQueue(y=!1){if(!this.connected||this._queue.length===0)return;const T=this._queue[0];T.pending&&!y||(T.pending=!0,T.tryCount++,this.flags=T.flags,this.emit.apply(this,T.args))}packet(y){y.nsp=this.nsp,this.io._packet(y)}onopen(){typeof this.auth=="function"?this.auth(y=>{this._sendConnectPacket(y)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(y){this.packet({type:_i.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},y):y})}onerror(y){this.connected||this.emitReserved("connect_error",y)}onclose(y,T){this.connected=!1,delete this.id,this.emitReserved("disconnect",y,T),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(y=>{if(!this.sendBuffer.some(k=>String(k.id)===y)){const k=this.acks[y];delete this.acks[y],k.withError&&k.call(this,new Error("socket has been disconnected"))}})}onpacket(y){if(y.nsp===this.nsp)switch(y.type){case _i.CONNECT:y.data&&y.data.sid?this.onconnect(y.data.sid,y.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case _i.EVENT:case _i.BINARY_EVENT:this.onevent(y);break;case _i.ACK:case _i.BINARY_ACK:this.onack(y);break;case _i.DISCONNECT:this.ondisconnect();break;case _i.CONNECT_ERROR:this.destroy();const k=new Error(y.data.message);k.data=y.data.data,this.emitReserved("connect_error",k);break}}onevent(y){const T=y.data||[];y.id!=null&&T.push(this.ack(y.id)),this.connected?this.emitEvent(T):this.receiveBuffer.push(Object.freeze(T))}emitEvent(y){if(this._anyListeners&&this._anyListeners.length){const T=this._anyListeners.slice();for(const k of T)k.apply(this,y)}super.emit.apply(this,y),this._pid&&y.length&&typeof y[y.length-1]=="string"&&(this._lastOffset=y[y.length-1])}ack(y){const T=this;let k=!1;return function(...L){k||(k=!0,T.packet({type:_i.ACK,id:y,data:L}))}}onack(y){const T=this.acks[y.id];typeof T=="function"&&(delete this.acks[y.id],T.withError&&y.data.unshift(null),T.apply(this,y.data))}onconnect(y,T){this.id=y,this.recovered=T&&this._pid===T,this._pid=T,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(y=>this.emitEvent(y)),this.receiveBuffer=[],this.sendBuffer.forEach(y=>{this.notifyOutgoingListeners(y),this.packet(y)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(y=>y()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:_i.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(y){return this.flags.compress=y,this}get volatile(){return this.flags.volatile=!0,this}timeout(y){return this.flags.timeout=y,this}onAny(y){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(y),this}prependAny(y){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(y),this}offAny(y){if(!this._anyListeners)return this;if(y){const T=this._anyListeners;for(let k=0;k<T.length;k++)if(y===T[k])return T.splice(k,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(y){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(y),this}prependAnyOutgoing(y){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(y),this}offAnyOutgoing(y){if(!this._anyOutgoingListeners)return this;if(y){const T=this._anyOutgoingListeners;for(let k=0;k<T.length;k++)if(y===T[k])return T.splice(k,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(y){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const T=this._anyOutgoingListeners.slice();for(const k of T)k.apply(this,y.data)}}}function n0(g){g=g||{},this.ms=g.min||100,this.max=g.max||1e4,this.factor=g.factor||2,this.jitter=g.jitter>0&&g.jitter<=1?g.jitter:0,this.attempts=0}n0.prototype.duration=function(){var g=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var y=Math.random(),T=Math.floor(y*this.jitter*g);g=(Math.floor(y*10)&1)==0?g-T:g+T}return Math.min(g,this.max)|0};n0.prototype.reset=function(){this.attempts=0};n0.prototype.setMin=function(g){this.ms=g};n0.prototype.setMax=function(g){this.max=g};n0.prototype.setJitter=function(g){this.jitter=g};class AT extends as{constructor(y,T){var k;super(),this.nsps={},this.subs=[],y&&typeof y=="object"&&(T=y,y=void 0),T=T||{},T.path=T.path||"/socket.io",this.opts=T,Kw(this,T),this.reconnection(T.reconnection!==!1),this.reconnectionAttempts(T.reconnectionAttempts||1/0),this.reconnectionDelay(T.reconnectionDelay||1e3),this.reconnectionDelayMax(T.reconnectionDelayMax||5e3),this.randomizationFactor((k=T.randomizationFactor)!==null&&k!==void 0?k:.5),this.backoff=new n0({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(T.timeout==null?2e4:T.timeout),this._readyState="closed",this.uri=y;const L=T.parser||VN;this.encoder=new L.Encoder,this.decoder=new L.Decoder,this._autoConnect=T.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(y){return arguments.length?(this._reconnection=!!y,y||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(y){return y===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=y,this)}reconnectionDelay(y){var T;return y===void 0?this._reconnectionDelay:(this._reconnectionDelay=y,(T=this.backoff)===null||T===void 0||T.setMin(y),this)}randomizationFactor(y){var T;return y===void 0?this._randomizationFactor:(this._randomizationFactor=y,(T=this.backoff)===null||T===void 0||T.setJitter(y),this)}reconnectionDelayMax(y){var T;return y===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=y,(T=this.backoff)===null||T===void 0||T.setMax(y),this)}timeout(y){return arguments.length?(this._timeout=y,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(y){if(~this._readyState.indexOf("open"))return this;this.engine=new RN(this.uri,this.opts);const T=this.engine,k=this;this._readyState="opening",this.skipReconnect=!1;const L=Bd(T,"open",function(){k.onopen(),y&&y()}),$=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),y?y(a):this.maybeReconnectOnOpen()},X=Bd(T,"error",$);if(this._timeout!==!1){const a=this._timeout,ee=this.setTimeoutFn(()=>{L(),$(new Error("timeout")),T.close()},a);this.opts.autoUnref&&ee.unref(),this.subs.push(()=>{this.clearTimeoutFn(ee)})}return this.subs.push(L),this.subs.push(X),this}connect(y){return this.open(y)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const y=this.engine;this.subs.push(Bd(y,"ping",this.onping.bind(this)),Bd(y,"data",this.ondata.bind(this)),Bd(y,"error",this.onerror.bind(this)),Bd(y,"close",this.onclose.bind(this)),Bd(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(y){try{this.decoder.add(y)}catch(T){this.onclose("parse error",T)}}ondecoded(y){Xw(()=>{this.emitReserved("packet",y)},this.setTimeoutFn)}onerror(y){this.emitReserved("error",y)}socket(y,T){let k=this.nsps[y];return k?this._autoConnect&&!k.active&&k.connect():(k=new zD(this,y,T),this.nsps[y]=k),k}_destroy(y){const T=Object.keys(this.nsps);for(const k of T)if(this.nsps[k].active)return;this._close()}_packet(y){const T=this.encoder.encode(y);for(let k=0;k<T.length;k++)this.engine.write(T[k],y.options)}cleanup(){this.subs.forEach(y=>y()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(y,T){var k;this.cleanup(),(k=this.engine)===null||k===void 0||k.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",y,T),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const y=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const T=this.backoff.duration();this._reconnecting=!0;const k=this.setTimeoutFn(()=>{y.skipReconnect||(this.emitReserved("reconnect_attempt",y.backoff.attempts),!y.skipReconnect&&y.open(L=>{L?(y._reconnecting=!1,y.reconnect(),this.emitReserved("reconnect_error",L)):y.onreconnect()}))},T);this.opts.autoUnref&&k.unref(),this.subs.push(()=>{this.clearTimeoutFn(k)})}}onreconnect(){const y=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",y)}}const $x={};function mw(g,y){typeof g=="object"&&(y=g,g=void 0),y=y||{};const T=kN(g,y.path||"/socket.io"),k=T.source,L=T.id,$=T.path,X=$x[L]&&$ in $x[L].nsps,a=y.forceNew||y["force new connection"]||y.multiplex===!1||X;let ee;return a?ee=new AT(k,y):($x[L]||($x[L]=new AT(k,y)),ee=$x[L]),T.query&&!y.query&&(y.query=T.queryKey),ee.socket(T.path,y)}Object.assign(mw,{Manager:AT,Socket:zD,io:mw,connect:mw});const PD="http://localhost:3000/api",gw=xl("auth/login",async({email:g,password:y},{rejectWithValue:T})=>{var k,L;try{const $=await bi.post(`${PD}/auth/login`,{email:g,password:y});return localStorage.setItem("token",$.data.data.token),$.data.data}catch($){return T(((L=(k=$.response)==null?void 0:k.data)==null?void 0:L.message)||"Failed to login")}}),_w=xl("auth/register",async({name:g,email:y,password:T,phone:k,skills:L},{rejectWithValue:$})=>{var X,a;try{const ee=await bi.post(`${PD}/auth/register`,{name:g,email:y,password:T,phone:k,skills:L});return localStorage.setItem("token",ee.data.data.token),ee.data.data}catch(ee){return $(((a=(X=ee.response)==null?void 0:X.data)==null?void 0:a.message)||"Failed to register")}}),LD=xl("auth/logout",async(g,{rejectWithValue:y})=>{try{return localStorage.removeItem("token"),null}catch{return y("Failed to logout")}}),dA=localStorage.getItem("token"),HN={user:null,token:dA||null,isAuthenticated:!!dA,loading:!1,error:null},BD=Uw({name:"auth",initialState:HN,reducers:{resetAuthError:g=>{g.error=null}},extraReducers:g=>{g.addCase(gw.pending,y=>{y.loading=!0,y.error=null}).addCase(gw.fulfilled,(y,T)=>{y.loading=!1,y.isAuthenticated=!0,y.user=T.payload.user,y.token=T.payload.token}).addCase(gw.rejected,(y,T)=>{y.loading=!1,y.error=T.payload}).addCase(_w.pending,y=>{y.loading=!0,y.error=null}).addCase(_w.fulfilled,(y,T)=>{y.loading=!1,y.isAuthenticated=!0,y.user=T.payload.user,y.token=T.payload.token}).addCase(_w.rejected,(y,T)=>{y.loading=!1,y.error=T.payload}).addCase(LD.fulfilled,y=>{y.user=null,y.token=null,y.isAuthenticated=!1})}}),{resetAuthError:FD}=BD.actions,GN=BD.reducer,pb="http://localhost:3000/api",mb=()=>({headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),yw=xl("emergency/createEmergency",async({emergencyType:g,description:y,longitude:T,latitude:k},{rejectWithValue:L})=>{var $,X;try{return(await bi.post(`${pb}/emergencies`,{emergencyType:g,description:y,longitude:T,latitude:k},mb())).data.data}catch(a){return L(((X=($=a.response)==null?void 0:$.data)==null?void 0:X.message)||"Failed to create emergency")}}),eb=xl("emergency/getNearbyEmergencies",async({longitude:g,latitude:y,maxDistance:T=5e3},{rejectWithValue:k})=>{var L,$;try{return(await bi.get(`${pb}/emergencies/nearby?longitude=${g}&latitude=${y}&maxDistance=${T}`,mb())).data.data}catch(X){return k((($=(L=X.response)==null?void 0:L.data)==null?void 0:$.message)||"Failed to fetch nearby emergencies")}}),vw=xl("emergency/getEmergencyDetails",async(g,{rejectWithValue:y})=>{var T,k;try{return(await bi.get(`${pb}/emergencies/${g}`,mb())).data.data}catch(L){return y(((k=(T=L.response)==null?void 0:T.data)==null?void 0:k.message)||"Failed to fetch emergency details")}}),UD=xl("emergency/respondToEmergency",async(g,{rejectWithValue:y})=>{var T,k;try{return(await bi.post(`${pb}/emergencies/${g}/respond`,{},mb())).data.data}catch(L){return y(((k=(T=L.response)==null?void 0:T.data)==null?void 0:k.message)||"Failed to respond to emergency")}}),jD=xl("emergency/updateEmergencyStatus",async({emergencyId:g,status:y},{rejectWithValue:T})=>{var k,L;try{return(await bi.patch(`${pb}/emergencies/${g}/status`,{status:y},mb())).data.data}catch($){return T(((L=(k=$.response)==null?void 0:k.data)==null?void 0:L.message)||"Failed to update emergency status")}}),$N={emergencies:[],currentEmergency:null,loading:!1,error:null},VD=Uw({name:"emergency",initialState:$N,reducers:{resetEmergencyError:g=>{g.error=null},updateEmergencyInRealtime:(g,y)=>{var k;const T=y.payload;if(T.responderUpdated||T.responderAdded){if(g.currentEmergency&&g.currentEmergency._id===T._id){const $=g.currentEmergency.responders.findIndex(X=>X.userId===T.responder._id||X.userId&&X.userId._id===T.responder._id);$!==-1?g.currentEmergency.responders[$].status=T.responder.status:T.responderAdded&&g.currentEmergency.responders.push({userId:T.responder._id,status:T.responder.status}),g.currentEmergency.status==="active"&&g.currentEmergency.responders.length>0&&(g.currentEmergency.status="responding")}const L=g.emergencies.findIndex($=>$._id===T._id);if(L!==-1&&g.emergencies[L].responders){const $=g.emergencies[L].responders.findIndex(X=>X.userId===T.responder._id||X.userId&&X.userId._id===T.responder._id);$!==-1?g.emergencies[L].responders[$].status=T.responder.status:T.responderAdded&&g.emergencies[L].responders.push({userId:T.responder._id,status:T.responder.status}),g.emergencies[L].status==="active"&&g.emergencies[L].responders.length>0&&(g.emergencies[L].status="responding")}}else{const L=g.emergencies.findIndex($=>$._id===T._id);L!==-1&&(g.emergencies[L]={...g.emergencies[L],...T}),((k=g.currentEmergency)==null?void 0:k._id)===T._id&&(g.currentEmergency={...g.currentEmergency,...T})}}},extraReducers:g=>{g.addCase(yw.pending,y=>{y.loading=!0,y.error=null}).addCase(yw.fulfilled,(y,T)=>{y.loading=!1,y.emergencies.unshift(T.payload.emergency),y.currentEmergency=T.payload.emergency}).addCase(yw.rejected,(y,T)=>{y.loading=!1,y.error=T.payload}).addCase(eb.pending,y=>{y.loading=!0,y.error=null}).addCase(eb.fulfilled,(y,T)=>{y.loading=!1,y.emergencies=T.payload}).addCase(eb.rejected,(y,T)=>{y.loading=!1,y.error=T.payload}).addCase(vw.pending,y=>{y.loading=!0,y.error=null}).addCase(vw.fulfilled,(y,T)=>{y.loading=!1,y.currentEmergency=T.payload}).addCase(vw.rejected,(y,T)=>{y.loading=!1,y.error=T.payload}).addCase(UD.fulfilled,(y,T)=>{y.currentEmergency=T.payload.emergency;const k=y.emergencies.findIndex(L=>L._id===T.payload.emergency._id);k!==-1&&(y.emergencies[k]=T.payload.emergency)}).addCase(jD.fulfilled,(y,T)=>{y.currentEmergency=T.payload.emergency;const k=y.emergencies.findIndex(L=>L._id===T.payload.emergency._id);k!==-1&&(y.emergencies[k]=T.payload.emergency)})}}),{resetEmergencyError:Fz,updateEmergencyInRealtime:XS}=VD.actions,ZN=VD.reducer,JT="http://localhost:3000/api",QT=()=>({headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),xw=xl("notification/getNotifications",async(g,{rejectWithValue:y})=>{var T,k;try{return(await bi.get(`${JT}/notifications`,QT())).data.data}catch(L){return y(((k=(T=L.response)==null?void 0:T.data)==null?void 0:k.message)||"Failed to fetch notifications")}}),qD=xl("notification/markNotificationAsRead",async(g,{rejectWithValue:y})=>{var T,k;try{return(await bi.patch(`${JT}/notifications/${g}/read`,{},QT())).data.data}catch(L){return y(((k=(T=L.response)==null?void 0:T.data)==null?void 0:k.message)||"Failed to mark notification as read")}}),HD=xl("notification/markAllNotificationsAsRead",async(g,{rejectWithValue:y})=>{var T,k;try{return(await bi.patch(`${JT}/notifications/read-all`,{},QT())).data.data}catch(L){return y(((k=(T=L.response)==null?void 0:T.data)==null?void 0:k.message)||"Failed to mark all notifications as read")}}),YN={notifications:[],unreadCount:0,loading:!1,error:null},GD=Uw({name:"notification",initialState:YN,reducers:{resetNotificationError:g=>{g.error=null},addNotification:(g,y)=>{g.notifications.unshift(y.payload),g.unreadCount+=1}},extraReducers:g=>{g.addCase(xw.pending,y=>{y.loading=!0,y.error=null}).addCase(xw.fulfilled,(y,T)=>{y.loading=!1,y.notifications=T.payload,y.unreadCount=T.payload.filter(k=>k.status!=="read").length}).addCase(xw.rejected,(y,T)=>{y.loading=!1,y.error=T.payload}).addCase(qD.fulfilled,(y,T)=>{const k=y.notifications.findIndex(L=>L._id===T.payload._id);k!==-1&&(y.notifications[k]=T.payload,y.unreadCount>0&&(y.unreadCount-=1))}).addCase(HD.fulfilled,y=>{y.notifications=y.notifications.map(T=>({...T,status:"read",readAt:new Date().toISOString()})),y.unreadCount=0})}}),{resetNotificationError:Uz,addNotification:hA}=GD.actions,WN=GD.reducer,Sg=JO({reducer:{auth:GN,emergency:ZN,user:X3,notification:WN},middleware:g=>g({serializableCheck:!1})});let Ni=null;const Ld={CONNECT:"connect",DISCONNECT:"disconnect",UPDATE_LOCATION:"update_location",LOCATION_UPDATED:"location_updated",UPDATE_AVAILABILITY:"update_availability",AVAILABILITY_UPDATED:"availability_updated",NEW_EMERGENCY:"new_emergency",EMERGENCY_CREATED:"emergency_created",EMERGENCY_STATUS_UPDATED:"emergency_status_updated",EMERGENCY_RESOLVED:"emergency_resolved",SEND_SOS_ALERT:"send_sos_alert",SOS_ALERT_RECEIVED:"sos_alert_received",JOIN_EMERGENCY:"join_emergency",LEAVE_EMERGENCY:"leave_emergency",RESPONDER_ADDED:"responder_added",RESPONDER_UPDATED:"responder_updated",UPDATE_RESPONSE_STATUS:"update_response_status",RESPONDER_STATUS_UPDATED:"responder_status_updated",NEW_NOTIFICATION:"new_notification",VOICE_ASSISTANT_AUDIO:"voice_assistant_audio",VOICE_ASSISTANT_RESULT:"voice_assistant_result"},Rw=()=>{const g=localStorage.getItem("token");if(!g)return console.warn("[SOCKET] Cannot initialize socket: No authentication token found"),null;console.log("[SOCKET] Initializing socket connection..."),Ni&&(console.log("[SOCKET] Closing existing connection"),Ni.disconnect());try{Ni=mw("http://localhost:3000",{auth:{token:g},reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3,timeout:1e4}),Ni.on(Ld.CONNECT,()=>{console.log("[SOCKET] Connected successfully with ID:",Ni.id)}),Ni.on(Ld.DISCONNECT,T=>{console.log("[SOCKET] Disconnected. Reason:",T)}),Ni.on("connect_error",T=>{console.error("[SOCKET] Connection error:",T.message)}),Ni.on("reconnect_attempt",T=>{console.log("[SOCKET] Reconnection attempt:",T)}),Ni.on("reconnect",T=>{console.log("[SOCKET] Reconnected after",T,"attempts")}),Ni.on("reconnect_error",T=>{console.error("[SOCKET] Reconnection error:",T.message)}),Ni.on("reconnect_failed",()=>{console.error("[SOCKET] Failed to reconnect after maximum attempts")}),Ni.on("error",T=>{console.error("[SOCKET] General error:",T)});const y=setTimeout(()=>{Ni.connected||console.error("[SOCKET] Connection timeout - socket not connected after 5 seconds")},5e3);return Ni.on(Ld.CONNECT,()=>{clearTimeout(y)}),Ni.on(Ld.NEW_EMERGENCY,T=>{console.log("[SOCKET] New emergency received:",T),Sg.dispatch(hA({_id:Date.now().toString(),type:"emergency_alert",title:`${T.emergency.emergencyType.toUpperCase()} EMERGENCY NEARBY`,message:T.emergency.description,status:"sent",createdAt:new Date().toISOString(),emergencyId:T.emergency._id}))}),Ni.on(Ld.SOS_ALERT_RECEIVED,T=>{console.log("[SOCKET] SOS alert received:",T),Sg.dispatch(hA({_id:Date.now().toString(),type:"sos_alert",title:"URGENT SOS ALERT",message:`${T.emergency.createdBy.name} has sent an SOS alert and needs immediate assistance!`,status:"sent",priority:"high",createdAt:new Date().toISOString(),emergencyId:T.emergency._id}));try{const k=new Audio("/alert-sound.mp3");k.volume=1,k.addEventListener("error",L=>{console.warn("[SOCKET] Alert sound file not found or cannot be played:",L),window.Notification&&Notification.permission==="granted"&&new Notification("URGENT SOS ALERT",{body:`${T.emergency.createdBy.name} has sent an SOS alert and needs immediate assistance!`,icon:"/vite.svg"})}),k.play().catch(L=>{console.error("[SOCKET] Error playing alert sound:",L),window.Notification&&Notification.permission==="granted"&&new Notification("URGENT SOS ALERT",{body:`${T.emergency.createdBy.name} has sent an SOS alert and needs immediate assistance!`,icon:"/vite.svg"})})}catch(k){console.error("[SOCKET] Error setting up alert sound:",k)}}),Ni.on(Ld.EMERGENCY_STATUS_UPDATED,T=>{console.log("[SOCKET] Emergency status updated:",T),Sg.dispatch(XS({_id:T.emergencyId,status:T.status}))}),Ni.on(Ld.RESPONDER_UPDATED,T=>{console.log("[SOCKET] Responder updated:",T);const L=Sg.getState().emergency.currentEmergency;L&&L._id===T.emergencyId&&Sg.dispatch(XS({_id:T.emergencyId,responderUpdated:!0,responder:T.responder}))}),Ni.on(Ld.RESPONDER_ADDED,T=>{console.log("[SOCKET] Responder added:",T);const L=Sg.getState().emergency.currentEmergency;L&&L._id===T.emergencyId&&Sg.dispatch(XS({_id:T.emergencyId,responderAdded:!0,responder:T.responder}))}),Ni}catch(y){return console.error("[SOCKET] Error creating socket:",y),null}},CT=()=>{Ni&&(Ni.disconnect(),Ni=null,console.log("[SOCKET] Socket disconnected manually"))},Xx=(g,y)=>{if(console.log("[SOCKET] Preparing to send audio data..."),!Ni)return console.error("[SOCKET] Cannot send audio: Socket not initialized"),!1;if(!Ni.connected)return console.error("[SOCKET] Cannot send audio: Socket not connected"),!1;try{const T=new FileReader;return T.readAsDataURL(g),T.onloadend=()=>{try{console.log("[SOCKET] Audio converted to base64, size:",Math.round(T.result.length/1024),"KB");const k=T.result.split(",")[1];return window.location.hostname==="localhost"&&!Ni.connected?(console.log("[SOCKET] DEV MODE: Creating mock response"),setTimeout(()=>{window.socket&&window.socket.emit("voice_assistant_result",{success:!0,text:"This is a mock response for testing. Fire emergency detected at your location.",emergencyId:"mock-emergency-123",message:"Fire emergency detected"})},2e3),!0):(console.log("[SOCKET] Emitting audio data to server..."),Ni.emit(Ld.VOICE_ASSISTANT_AUDIO,{audio:k,location:y}),console.log("[SOCKET] Audio data sent successfully"),!0)}catch(k){return console.error("[SOCKET] Error sending audio data:",k),!1}},T.onerror=k=>(console.error("[SOCKET] Error reading audio file:",k),!1),!0}catch(T){return console.error("[SOCKET] Error in sendVoiceAssistantAudio:",T),!1}},Tg=()=>{console.log("[SOCKET] Creating mock socket for testing");const g={id:"mock-socket-id",connected:!0,on:(y,T)=>{console.log("[MOCK SOCKET] Added listener for event:",y),y==="voice_assistant_result"&&(g._callbacks=g._callbacks||{},g._callbacks[y]=T)},off:y=>{console.log("[MOCK SOCKET] Removed listener for event:",y),g._callbacks&&g._callbacks[y]&&delete g._callbacks[y]},emit:y=>{console.log("[MOCK SOCKET] Emitted event:",y),y===Ld.VOICE_ASSISTANT_AUDIO&&setTimeout(()=>{g._callbacks&&g._callbacks.voice_assistant_result&&(console.log("[MOCK SOCKET] Creating mock response"),g._callbacks.voice_assistant_result({success:!0,text:"This is a mock response for testing. Fire emergency detected at your location.",emergencyId:"mock-emergency-123",message:"Fire emergency detected"}))},2e3)},disconnect:()=>{console.log("[MOCK SOCKET] Disconnected"),g.connected=!1}};return g},XN=g=>{if(console.log("[SOCKET] Sending SOS alert with location:",g),!Ni)return console.error("[SOCKET] Cannot send SOS alert: Socket not initialized"),!1;if(!Ni.connected)return console.error("[SOCKET] Cannot send SOS alert: Socket not connected"),!1;try{return Ni.emit(Ld.SEND_SOS_ALERT,{location:g,timestamp:new Date().toISOString()}),console.log("[SOCKET] SOS alert sent successfully"),!0}catch(y){return console.error("[SOCKET] Error sending SOS alert:",y),!1}},KN=Object.freeze(Object.defineProperty({__proto__:null,createMockSocket:Tg,disconnectSocket:CT,initializeSocket:Rw,sendSOSAlert:XN,sendVoiceAssistantAudio:Xx},Symbol.toStringTag,{value:"Module"})),JN=()=>{const g=Up(),{loading:y,error:T}=Ba(a=>a.auth),[k,L]=Fe.useState({email:"",password:""}),$=a=>{T&&g(FD()),L({...k,[a.target.name]:a.target.value})},X=a=>{a.preventDefault(),g(gw(k))};return he.jsxDEV("div",{children:[he.jsxDEV("h2",{className:"text-2xl font-bold text-center mb-6",children:"Login"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Login.jsx",lineNumber:28,columnNumber:7},void 0),T&&he.jsxDEV("div",{className:"bg-destructive/10 text-destructive px-4 py-3 rounded-md mb-4 text-sm",children:T},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Login.jsx",lineNumber:31,columnNumber:9},void 0),he.jsxDEV("form",{onSubmit:X,children:[he.jsxDEV("div",{className:"mb-4",children:[he.jsxDEV("label",{className:"block text-sm font-medium mb-1",htmlFor:"email",children:"Email"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Login.jsx",lineNumber:38,columnNumber:11},void 0),he.jsxDEV("input",{type:"email",id:"email",name:"email",value:k.email,onChange:$,className:"w-full px-3 py-2 border border-input rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50",required:!0},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Login.jsx",lineNumber:41,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Login.jsx",lineNumber:37,columnNumber:9},void 0),he.jsxDEV("div",{className:"mb-6",children:[he.jsxDEV("label",{className:"block text-sm font-medium mb-1",htmlFor:"password",children:"Password"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Login.jsx",lineNumber:53,columnNumber:11},void 0),he.jsxDEV("input",{type:"password",id:"password",name:"password",value:k.password,onChange:$,className:"w-full px-3 py-2 border border-input rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50",required:!0},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Login.jsx",lineNumber:56,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Login.jsx",lineNumber:52,columnNumber:9},void 0),he.jsxDEV("button",{type:"submit",disabled:y,className:"w-full bg-primary text-primary-foreground py-2 rounded-md hover:bg-primary/90 transition-colors disabled:opacity-70",children:y?"Logging in...":"Login"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Login.jsx",lineNumber:67,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Login.jsx",lineNumber:36,columnNumber:7},void 0),he.jsxDEV("div",{className:"mt-4 text-center text-sm",children:[he.jsxDEV("span",{className:"text-muted-foreground",children:"Don't have an account?"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Login.jsx",lineNumber:77,columnNumber:9},void 0)," ",he.jsxDEV(cb,{to:"/register",className:"text-primary hover:underline",children:"Register"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Login.jsx",lineNumber:78,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Login.jsx",lineNumber:76,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Login.jsx",lineNumber:27,columnNumber:5},void 0)},QN=[{id:"first_aid",label:"First Aid"},{id:"cpr",label:"CPR"},{id:"fire_safety",label:"Fire Safety"},{id:"search_rescue",label:"Search & Rescue"},{id:"medical",label:"Medical Professional"},{id:"emergency_response",label:"Emergency Response"}],ez=()=>{const g=Up(),{loading:y,error:T}=Ba(se=>se.auth),[k,L]=Fe.useState({name:"",email:"",password:"",confirmPassword:"",phone:"",skills:[]}),[$,X]=Fe.useState(""),a=se=>{T&&g(FD());const{name:fe,value:ge,type:le,checked:ke}=se.target;if(le==="checkbox"){const Re=ke?[...k.skills,fe]:k.skills.filter(Ue=>Ue!==fe);L({...k,skills:Re})}else L({...k,[fe]:ge});(fe==="password"||fe==="confirmPassword")&&X("")},ee=se=>{if(se.preventDefault(),k.password!==k.confirmPassword){X("Passwords do not match");return}if(k.password.length<6){X("Password must be at least 6 characters");return}const{confirmPassword:fe,...ge}=k;g(_w(ge))};return he.jsxDEV("div",{children:[he.jsxDEV("h2",{className:"text-2xl font-bold text-center mb-6",children:"Register"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Register.jsx",lineNumber:72,columnNumber:7},void 0),T&&he.jsxDEV("div",{className:"bg-destructive/10 text-destructive px-4 py-3 rounded-md mb-4 text-sm",children:T},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Register.jsx",lineNumber:75,columnNumber:9},void 0),he.jsxDEV("form",{onSubmit:ee,children:[he.jsxDEV("div",{className:"mb-4",children:[he.jsxDEV("label",{className:"block text-sm font-medium mb-1",htmlFor:"name",children:"Name"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Register.jsx",lineNumber:82,columnNumber:11},void 0),he.jsxDEV("input",{type:"text",id:"name",name:"name",value:k.name,onChange:a,className:"w-full px-3 py-2 border border-input rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50",required:!0},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Register.jsx",lineNumber:85,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Register.jsx",lineNumber:81,columnNumber:9},void 0),he.jsxDEV("div",{className:"mb-4",children:[he.jsxDEV("label",{className:"block text-sm font-medium mb-1",htmlFor:"email",children:"Email"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Register.jsx",lineNumber:97,columnNumber:11},void 0),he.jsxDEV("input",{type:"email",id:"email",name:"email",value:k.email,onChange:a,className:"w-full px-3 py-2 border border-input rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50",required:!0},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Register.jsx",lineNumber:100,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Register.jsx",lineNumber:96,columnNumber:9},void 0),he.jsxDEV("div",{className:"mb-4",children:[he.jsxDEV("label",{className:"block text-sm font-medium mb-1",htmlFor:"phone",children:"Phone Number"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Register.jsx",lineNumber:112,columnNumber:11},void 0),he.jsxDEV("input",{type:"tel",id:"phone",name:"phone",value:k.phone,onChange:a,className:"w-full px-3 py-2 border border-input rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50",required:!0},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Register.jsx",lineNumber:115,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Register.jsx",lineNumber:111,columnNumber:9},void 0),he.jsxDEV("div",{className:"mb-4",children:[he.jsxDEV("label",{className:"block text-sm font-medium mb-1",htmlFor:"password",children:"Password"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Register.jsx",lineNumber:127,columnNumber:11},void 0),he.jsxDEV("input",{type:"password",id:"password",name:"password",value:k.password,onChange:a,className:"w-full px-3 py-2 border border-input rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50",required:!0},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Register.jsx",lineNumber:130,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Register.jsx",lineNumber:126,columnNumber:9},void 0),he.jsxDEV("div",{className:"mb-4",children:[he.jsxDEV("label",{className:"block text-sm font-medium mb-1",htmlFor:"confirmPassword",children:"Confirm Password"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Register.jsx",lineNumber:142,columnNumber:11},void 0),he.jsxDEV("input",{type:"password",id:"confirmPassword",name:"confirmPassword",value:k.confirmPassword,onChange:a,className:"w-full px-3 py-2 border border-input rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50",required:!0},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Register.jsx",lineNumber:145,columnNumber:11},void 0),$&&he.jsxDEV("p",{className:"text-destructive text-xs mt-1",children:$},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Register.jsx",lineNumber:155,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Register.jsx",lineNumber:141,columnNumber:9},void 0),he.jsxDEV("div",{className:"mb-6",children:[he.jsxDEV("label",{className:"block text-sm font-medium mb-2",children:"Emergency Skills (Select all that apply)"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Register.jsx",lineNumber:160,columnNumber:11},void 0),he.jsxDEV("div",{className:"grid grid-cols-2 gap-2",children:QN.map(se=>he.jsxDEV("div",{className:"flex items-center space-x-2",children:[he.jsxDEV("input",{type:"checkbox",id:se.id,name:se.id,checked:k.skills.includes(se.id),onChange:a,className:"rounded text-primary focus:ring-primary"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Register.jsx",lineNumber:166,columnNumber:17},void 0),he.jsxDEV("label",{htmlFor:se.id,className:"text-sm",children:se.label},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Register.jsx",lineNumber:174,columnNumber:17},void 0)]},se.id,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Register.jsx",lineNumber:165,columnNumber:15},void 0))},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Register.jsx",lineNumber:163,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Register.jsx",lineNumber:159,columnNumber:9},void 0),he.jsxDEV("button",{type:"submit",disabled:y,className:"w-full bg-primary text-primary-foreground py-2 rounded-md hover:bg-primary/90 transition-colors disabled:opacity-70",children:y?"Registering...":"Register"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Register.jsx",lineNumber:182,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Register.jsx",lineNumber:80,columnNumber:7},void 0),he.jsxDEV("div",{className:"mt-4 text-center text-sm",children:[he.jsxDEV("span",{className:"text-muted-foreground",children:"Already have an account?"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Register.jsx",lineNumber:192,columnNumber:9},void 0)," ",he.jsxDEV(cb,{to:"/login",className:"text-primary hover:underline",children:"Login"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Register.jsx",lineNumber:193,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Register.jsx",lineNumber:191,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Register.jsx",lineNumber:71,columnNumber:5},void 0)},tz="modulepreload",nz=function(g){return"/"+g},fA={},rz=function(y,T,k){let L=Promise.resolve();if(T&&T.length>0){let X=function(se){return Promise.all(se.map(fe=>Promise.resolve(fe).then(ge=>({status:"fulfilled",value:ge}),ge=>({status:"rejected",reason:ge}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),ee=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));L=X(T.map(se=>{if(se=nz(se),se in fA)return;fA[se]=!0;const fe=se.endsWith(".css"),ge=fe?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${se}"]${ge}`))return;const le=document.createElement("link");if(le.rel=fe?"stylesheet":tz,fe||(le.as="script"),le.crossOrigin="",le.href=se,ee&&le.setAttribute("nonce",ee),document.head.appendChild(le),fe)return new Promise((ke,Re)=>{le.addEventListener("load",ke),le.addEventListener("error",()=>Re(new Error(`Unable to preload CSS for ${se}`)))})}))}function $(X){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=X,window.dispatchEvent(a),!a.defaultPrevented)throw X}return L.then(X=>{for(const a of X||[])a.status==="rejected"&&$(a.reason);return y().catch($)})};var bw={exports:{}},iz=bw.exports,pA;function oz(){return pA||(pA=1,function(g,y){(function(T,k){g.exports=k()})(iz,function(){var T,k,L;function $(a,ee){if(!T)T=ee;else if(!k)k=ee;else{var se="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+T+")(sharedChunk); ("+k+")(sharedChunk); self.onerror = null;",fe={};T(fe),L=ee(fe),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(L.workerUrl=window.URL.createObjectURL(new Blob([se],{type:"text/javascript"})))}}$(["exports"],function(a){function ee(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var se,fe={},ge={};function le(){if(se)return ge;se=1,Object.defineProperty(ge,"__esModule",{value:!0}),ge.setMatrixArrayType=function(u){ge.ARRAY_TYPE=e=u},ge.toRadian=function(u){return u*l},ge.equals=function(u,c){return Math.abs(u-c)<=s*Math.max(1,Math.abs(u),Math.abs(c))},ge.RANDOM=ge.ARRAY_TYPE=ge.EPSILON=void 0;var s=1e-6;ge.EPSILON=s;var e=typeof Float32Array<"u"?Float32Array:Array;ge.ARRAY_TYPE=e;var r=Math.random;ge.RANDOM=r;var l=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var u=0,c=arguments.length;c--;)u+=arguments[c]*arguments[c];return Math.sqrt(u)}),ge}var ke,Re={};function Ue(){if(ke)return Re;function s(c){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},s(c)}ke=1,Object.defineProperty(Re,"__esModule",{value:!0}),Re.create=function(){var c=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(c[1]=0,c[2]=0),c[0]=1,c[3]=1,c},Re.clone=function(c){var f=new e.ARRAY_TYPE(4);return f[0]=c[0],f[1]=c[1],f[2]=c[2],f[3]=c[3],f},Re.copy=function(c,f){return c[0]=f[0],c[1]=f[1],c[2]=f[2],c[3]=f[3],c},Re.identity=function(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=1,c},Re.fromValues=function(c,f,x,S){var C=new e.ARRAY_TYPE(4);return C[0]=c,C[1]=f,C[2]=x,C[3]=S,C},Re.set=function(c,f,x,S,C){return c[0]=f,c[1]=x,c[2]=S,c[3]=C,c},Re.transpose=function(c,f){if(c===f){var x=f[1];c[1]=f[2],c[2]=x}else c[0]=f[0],c[1]=f[2],c[2]=f[1],c[3]=f[3];return c},Re.invert=function(c,f){var x=f[0],S=f[1],C=f[2],_=f[3],E=x*_-C*S;return E?(c[0]=_*(E=1/E),c[1]=-S*E,c[2]=-C*E,c[3]=x*E,c):null},Re.adjoint=function(c,f){var x=f[0];return c[0]=f[3],c[1]=-f[1],c[2]=-f[2],c[3]=x,c},Re.determinant=function(c){return c[0]*c[3]-c[2]*c[1]},Re.multiply=l,Re.rotate=function(c,f,x){var S=f[0],C=f[1],_=f[2],E=f[3],M=Math.sin(x),A=Math.cos(x);return c[0]=S*A+_*M,c[1]=C*A+E*M,c[2]=S*-M+_*A,c[3]=C*-M+E*A,c},Re.scale=function(c,f,x){var S=f[1],C=f[2],_=f[3],E=x[0],M=x[1];return c[0]=f[0]*E,c[1]=S*E,c[2]=C*M,c[3]=_*M,c},Re.fromRotation=function(c,f){var x=Math.sin(f),S=Math.cos(f);return c[0]=S,c[1]=x,c[2]=-x,c[3]=S,c},Re.fromScaling=function(c,f){return c[0]=f[0],c[1]=0,c[2]=0,c[3]=f[1],c},Re.str=function(c){return"mat2("+c[0]+", "+c[1]+", "+c[2]+", "+c[3]+")"},Re.frob=function(c){return Math.hypot(c[0],c[1],c[2],c[3])},Re.LDU=function(c,f,x,S){return c[2]=S[2]/S[0],x[0]=S[0],x[1]=S[1],x[3]=S[3]-c[2]*x[1],[c,f,x]},Re.add=function(c,f,x){return c[0]=f[0]+x[0],c[1]=f[1]+x[1],c[2]=f[2]+x[2],c[3]=f[3]+x[3],c},Re.subtract=u,Re.exactEquals=function(c,f){return c[0]===f[0]&&c[1]===f[1]&&c[2]===f[2]&&c[3]===f[3]},Re.equals=function(c,f){var x=c[0],S=c[1],C=c[2],_=c[3],E=f[0],M=f[1],A=f[2],D=f[3];return Math.abs(x-E)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs(E))&&Math.abs(S-M)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(M))&&Math.abs(C-A)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(A))&&Math.abs(_-D)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(D))},Re.multiplyScalar=function(c,f,x){return c[0]=f[0]*x,c[1]=f[1]*x,c[2]=f[2]*x,c[3]=f[3]*x,c},Re.multiplyScalarAndAdd=function(c,f,x,S){return c[0]=f[0]+x[0]*S,c[1]=f[1]+x[1]*S,c[2]=f[2]+x[2]*S,c[3]=f[3]+x[3]*S,c},Re.sub=Re.mul=void 0;var e=function(c,f){if(c&&c.__esModule)return c;if(c===null||s(c)!=="object"&&typeof c!="function")return{default:c};var x=r(void 0);if(x&&x.has(c))return x.get(c);var S={},C=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in c)if(_!=="default"&&Object.prototype.hasOwnProperty.call(c,_)){var E=C?Object.getOwnPropertyDescriptor(c,_):null;E&&(E.get||E.set)?Object.defineProperty(S,_,E):S[_]=c[_]}return S.default=c,x&&x.set(c,S),S}(le());function r(c){if(typeof WeakMap!="function")return null;var f=new WeakMap,x=new WeakMap;return(r=function(S){return S?x:f})(c)}function l(c,f,x){var S=f[0],C=f[1],_=f[2],E=f[3],M=x[0],A=x[1],D=x[2],I=x[3];return c[0]=S*M+_*A,c[1]=C*M+E*A,c[2]=S*D+_*I,c[3]=C*D+E*I,c}function u(c,f,x){return c[0]=f[0]-x[0],c[1]=f[1]-x[1],c[2]=f[2]-x[2],c[3]=f[3]-x[3],c}return Re.mul=l,Re.sub=u,Re}var Pe,We={};function Tt(){if(Pe)return We;function s(c){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},s(c)}Pe=1,Object.defineProperty(We,"__esModule",{value:!0}),We.create=function(){var c=new e.ARRAY_TYPE(6);return e.ARRAY_TYPE!=Float32Array&&(c[1]=0,c[2]=0,c[4]=0,c[5]=0),c[0]=1,c[3]=1,c},We.clone=function(c){var f=new e.ARRAY_TYPE(6);return f[0]=c[0],f[1]=c[1],f[2]=c[2],f[3]=c[3],f[4]=c[4],f[5]=c[5],f},We.copy=function(c,f){return c[0]=f[0],c[1]=f[1],c[2]=f[2],c[3]=f[3],c[4]=f[4],c[5]=f[5],c},We.identity=function(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=1,c[4]=0,c[5]=0,c},We.fromValues=function(c,f,x,S,C,_){var E=new e.ARRAY_TYPE(6);return E[0]=c,E[1]=f,E[2]=x,E[3]=S,E[4]=C,E[5]=_,E},We.set=function(c,f,x,S,C,_,E){return c[0]=f,c[1]=x,c[2]=S,c[3]=C,c[4]=_,c[5]=E,c},We.invert=function(c,f){var x=f[0],S=f[1],C=f[2],_=f[3],E=f[4],M=f[5],A=x*_-S*C;return A?(c[0]=_*(A=1/A),c[1]=-S*A,c[2]=-C*A,c[3]=x*A,c[4]=(C*M-_*E)*A,c[5]=(S*E-x*M)*A,c):null},We.determinant=function(c){return c[0]*c[3]-c[1]*c[2]},We.multiply=l,We.rotate=function(c,f,x){var S=f[0],C=f[1],_=f[2],E=f[3],M=f[4],A=f[5],D=Math.sin(x),I=Math.cos(x);return c[0]=S*I+_*D,c[1]=C*I+E*D,c[2]=S*-D+_*I,c[3]=C*-D+E*I,c[4]=M,c[5]=A,c},We.scale=function(c,f,x){var S=f[1],C=f[2],_=f[3],E=f[4],M=f[5],A=x[0],D=x[1];return c[0]=f[0]*A,c[1]=S*A,c[2]=C*D,c[3]=_*D,c[4]=E,c[5]=M,c},We.translate=function(c,f,x){var S=f[0],C=f[1],_=f[2],E=f[3],M=f[4],A=f[5],D=x[0],I=x[1];return c[0]=S,c[1]=C,c[2]=_,c[3]=E,c[4]=S*D+_*I+M,c[5]=C*D+E*I+A,c},We.fromRotation=function(c,f){var x=Math.sin(f),S=Math.cos(f);return c[0]=S,c[1]=x,c[2]=-x,c[3]=S,c[4]=0,c[5]=0,c},We.fromScaling=function(c,f){return c[0]=f[0],c[1]=0,c[2]=0,c[3]=f[1],c[4]=0,c[5]=0,c},We.fromTranslation=function(c,f){return c[0]=1,c[1]=0,c[2]=0,c[3]=1,c[4]=f[0],c[5]=f[1],c},We.str=function(c){return"mat2d("+c[0]+", "+c[1]+", "+c[2]+", "+c[3]+", "+c[4]+", "+c[5]+")"},We.frob=function(c){return Math.hypot(c[0],c[1],c[2],c[3],c[4],c[5],1)},We.add=function(c,f,x){return c[0]=f[0]+x[0],c[1]=f[1]+x[1],c[2]=f[2]+x[2],c[3]=f[3]+x[3],c[4]=f[4]+x[4],c[5]=f[5]+x[5],c},We.subtract=u,We.multiplyScalar=function(c,f,x){return c[0]=f[0]*x,c[1]=f[1]*x,c[2]=f[2]*x,c[3]=f[3]*x,c[4]=f[4]*x,c[5]=f[5]*x,c},We.multiplyScalarAndAdd=function(c,f,x,S){return c[0]=f[0]+x[0]*S,c[1]=f[1]+x[1]*S,c[2]=f[2]+x[2]*S,c[3]=f[3]+x[3]*S,c[4]=f[4]+x[4]*S,c[5]=f[5]+x[5]*S,c},We.exactEquals=function(c,f){return c[0]===f[0]&&c[1]===f[1]&&c[2]===f[2]&&c[3]===f[3]&&c[4]===f[4]&&c[5]===f[5]},We.equals=function(c,f){var x=c[0],S=c[1],C=c[2],_=c[3],E=c[4],M=c[5],A=f[0],D=f[1],I=f[2],B=f[3],U=f[4],G=f[5];return Math.abs(x-A)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs(A))&&Math.abs(S-D)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(D))&&Math.abs(C-I)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(I))&&Math.abs(_-B)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(B))&&Math.abs(E-U)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(U))&&Math.abs(M-G)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(G))},We.sub=We.mul=void 0;var e=function(c,f){if(c&&c.__esModule)return c;if(c===null||s(c)!=="object"&&typeof c!="function")return{default:c};var x=r(void 0);if(x&&x.has(c))return x.get(c);var S={},C=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in c)if(_!=="default"&&Object.prototype.hasOwnProperty.call(c,_)){var E=C?Object.getOwnPropertyDescriptor(c,_):null;E&&(E.get||E.set)?Object.defineProperty(S,_,E):S[_]=c[_]}return S.default=c,x&&x.set(c,S),S}(le());function r(c){if(typeof WeakMap!="function")return null;var f=new WeakMap,x=new WeakMap;return(r=function(S){return S?x:f})(c)}function l(c,f,x){var S=f[0],C=f[1],_=f[2],E=f[3],M=f[4],A=f[5],D=x[0],I=x[1],B=x[2],U=x[3],G=x[4],H=x[5];return c[0]=S*D+_*I,c[1]=C*D+E*I,c[2]=S*B+_*U,c[3]=C*B+E*U,c[4]=S*G+_*H+M,c[5]=C*G+E*H+A,c}function u(c,f,x){return c[0]=f[0]-x[0],c[1]=f[1]-x[1],c[2]=f[2]-x[2],c[3]=f[3]-x[3],c[4]=f[4]-x[4],c[5]=f[5]-x[5],c}return We.mul=l,We.sub=u,We}var wt,St={};function Xt(){if(wt)return St;function s(c){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},s(c)}wt=1,Object.defineProperty(St,"__esModule",{value:!0}),St.create=function(){var c=new e.ARRAY_TYPE(9);return e.ARRAY_TYPE!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[5]=0,c[6]=0,c[7]=0),c[0]=1,c[4]=1,c[8]=1,c},St.fromMat4=function(c,f){return c[0]=f[0],c[1]=f[1],c[2]=f[2],c[3]=f[4],c[4]=f[5],c[5]=f[6],c[6]=f[8],c[7]=f[9],c[8]=f[10],c},St.clone=function(c){var f=new e.ARRAY_TYPE(9);return f[0]=c[0],f[1]=c[1],f[2]=c[2],f[3]=c[3],f[4]=c[4],f[5]=c[5],f[6]=c[6],f[7]=c[7],f[8]=c[8],f},St.copy=function(c,f){return c[0]=f[0],c[1]=f[1],c[2]=f[2],c[3]=f[3],c[4]=f[4],c[5]=f[5],c[6]=f[6],c[7]=f[7],c[8]=f[8],c},St.fromValues=function(c,f,x,S,C,_,E,M,A){var D=new e.ARRAY_TYPE(9);return D[0]=c,D[1]=f,D[2]=x,D[3]=S,D[4]=C,D[5]=_,D[6]=E,D[7]=M,D[8]=A,D},St.set=function(c,f,x,S,C,_,E,M,A,D){return c[0]=f,c[1]=x,c[2]=S,c[3]=C,c[4]=_,c[5]=E,c[6]=M,c[7]=A,c[8]=D,c},St.identity=function(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=1,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},St.transpose=function(c,f){if(c===f){var x=f[1],S=f[2],C=f[5];c[1]=f[3],c[2]=f[6],c[3]=x,c[5]=f[7],c[6]=S,c[7]=C}else c[0]=f[0],c[1]=f[3],c[2]=f[6],c[3]=f[1],c[4]=f[4],c[5]=f[7],c[6]=f[2],c[7]=f[5],c[8]=f[8];return c},St.invert=function(c,f){var x=f[0],S=f[1],C=f[2],_=f[3],E=f[4],M=f[5],A=f[6],D=f[7],I=f[8],B=I*E-M*D,U=-I*_+M*A,G=D*_-E*A,H=x*B+S*U+C*G;return H?(c[0]=B*(H=1/H),c[1]=(-I*S+C*D)*H,c[2]=(M*S-C*E)*H,c[3]=U*H,c[4]=(I*x-C*A)*H,c[5]=(-M*x+C*_)*H,c[6]=G*H,c[7]=(-D*x+S*A)*H,c[8]=(E*x-S*_)*H,c):null},St.adjoint=function(c,f){var x=f[0],S=f[1],C=f[2],_=f[3],E=f[4],M=f[5],A=f[6],D=f[7],I=f[8];return c[0]=E*I-M*D,c[1]=C*D-S*I,c[2]=S*M-C*E,c[3]=M*A-_*I,c[4]=x*I-C*A,c[5]=C*_-x*M,c[6]=_*D-E*A,c[7]=S*A-x*D,c[8]=x*E-S*_,c},St.determinant=function(c){var f=c[3],x=c[4],S=c[5],C=c[6],_=c[7],E=c[8];return c[0]*(E*x-S*_)+c[1]*(-E*f+S*C)+c[2]*(_*f-x*C)},St.multiply=l,St.translate=function(c,f,x){var S=f[0],C=f[1],_=f[2],E=f[3],M=f[4],A=f[5],D=f[6],I=f[7],B=f[8],U=x[0],G=x[1];return c[0]=S,c[1]=C,c[2]=_,c[3]=E,c[4]=M,c[5]=A,c[6]=U*S+G*E+D,c[7]=U*C+G*M+I,c[8]=U*_+G*A+B,c},St.rotate=function(c,f,x){var S=f[0],C=f[1],_=f[2],E=f[3],M=f[4],A=f[5],D=f[6],I=f[7],B=f[8],U=Math.sin(x),G=Math.cos(x);return c[0]=G*S+U*E,c[1]=G*C+U*M,c[2]=G*_+U*A,c[3]=G*E-U*S,c[4]=G*M-U*C,c[5]=G*A-U*_,c[6]=D,c[7]=I,c[8]=B,c},St.scale=function(c,f,x){var S=x[0],C=x[1];return c[0]=S*f[0],c[1]=S*f[1],c[2]=S*f[2],c[3]=C*f[3],c[4]=C*f[4],c[5]=C*f[5],c[6]=f[6],c[7]=f[7],c[8]=f[8],c},St.fromTranslation=function(c,f){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=1,c[5]=0,c[6]=f[0],c[7]=f[1],c[8]=1,c},St.fromRotation=function(c,f){var x=Math.sin(f),S=Math.cos(f);return c[0]=S,c[1]=x,c[2]=0,c[3]=-x,c[4]=S,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},St.fromScaling=function(c,f){return c[0]=f[0],c[1]=0,c[2]=0,c[3]=0,c[4]=f[1],c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},St.fromMat2d=function(c,f){return c[0]=f[0],c[1]=f[1],c[2]=0,c[3]=f[2],c[4]=f[3],c[5]=0,c[6]=f[4],c[7]=f[5],c[8]=1,c},St.fromQuat=function(c,f){var x=f[0],S=f[1],C=f[2],_=f[3],E=x+x,M=S+S,A=C+C,D=x*E,I=S*E,B=S*M,U=C*E,G=C*M,H=C*A,q=_*E,Y=_*M,J=_*A;return c[0]=1-B-H,c[3]=I-J,c[6]=U+Y,c[1]=I+J,c[4]=1-D-H,c[7]=G-q,c[2]=U-Y,c[5]=G+q,c[8]=1-D-B,c},St.normalFromMat4=function(c,f){var x=f[0],S=f[1],C=f[2],_=f[3],E=f[4],M=f[5],A=f[6],D=f[7],I=f[8],B=f[9],U=f[10],G=f[11],H=f[12],q=f[13],Y=f[14],J=f[15],ne=x*M-S*E,me=x*A-C*E,ce=x*D-_*E,ue=S*A-C*M,Ee=S*D-_*M,_e=C*D-_*A,De=I*q-B*H,Le=I*Y-U*H,Ne=I*J-G*H,Ge=B*Y-U*q,Ve=B*J-G*q,Ke=U*J-G*Y,Ze=ne*Ke-me*Ve+ce*Ge+ue*Ne-Ee*Le+_e*De;return Ze?(c[0]=(M*Ke-A*Ve+D*Ge)*(Ze=1/Ze),c[1]=(A*Ne-E*Ke-D*Le)*Ze,c[2]=(E*Ve-M*Ne+D*De)*Ze,c[3]=(C*Ve-S*Ke-_*Ge)*Ze,c[4]=(x*Ke-C*Ne+_*Le)*Ze,c[5]=(S*Ne-x*Ve-_*De)*Ze,c[6]=(q*_e-Y*Ee+J*ue)*Ze,c[7]=(Y*ce-H*_e-J*me)*Ze,c[8]=(H*Ee-q*ce+J*ne)*Ze,c):null},St.projection=function(c,f,x){return c[0]=2/f,c[1]=0,c[2]=0,c[3]=0,c[4]=-2/x,c[5]=0,c[6]=-1,c[7]=1,c[8]=1,c},St.str=function(c){return"mat3("+c[0]+", "+c[1]+", "+c[2]+", "+c[3]+", "+c[4]+", "+c[5]+", "+c[6]+", "+c[7]+", "+c[8]+")"},St.frob=function(c){return Math.hypot(c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8])},St.add=function(c,f,x){return c[0]=f[0]+x[0],c[1]=f[1]+x[1],c[2]=f[2]+x[2],c[3]=f[3]+x[3],c[4]=f[4]+x[4],c[5]=f[5]+x[5],c[6]=f[6]+x[6],c[7]=f[7]+x[7],c[8]=f[8]+x[8],c},St.subtract=u,St.multiplyScalar=function(c,f,x){return c[0]=f[0]*x,c[1]=f[1]*x,c[2]=f[2]*x,c[3]=f[3]*x,c[4]=f[4]*x,c[5]=f[5]*x,c[6]=f[6]*x,c[7]=f[7]*x,c[8]=f[8]*x,c},St.multiplyScalarAndAdd=function(c,f,x,S){return c[0]=f[0]+x[0]*S,c[1]=f[1]+x[1]*S,c[2]=f[2]+x[2]*S,c[3]=f[3]+x[3]*S,c[4]=f[4]+x[4]*S,c[5]=f[5]+x[5]*S,c[6]=f[6]+x[6]*S,c[7]=f[7]+x[7]*S,c[8]=f[8]+x[8]*S,c},St.exactEquals=function(c,f){return c[0]===f[0]&&c[1]===f[1]&&c[2]===f[2]&&c[3]===f[3]&&c[4]===f[4]&&c[5]===f[5]&&c[6]===f[6]&&c[7]===f[7]&&c[8]===f[8]},St.equals=function(c,f){var x=c[0],S=c[1],C=c[2],_=c[3],E=c[4],M=c[5],A=c[6],D=c[7],I=c[8],B=f[0],U=f[1],G=f[2],H=f[3],q=f[4],Y=f[5],J=f[6],ne=f[7],me=f[8];return Math.abs(x-B)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs(B))&&Math.abs(S-U)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(U))&&Math.abs(C-G)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(G))&&Math.abs(_-H)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(H))&&Math.abs(E-q)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(q))&&Math.abs(M-Y)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(Y))&&Math.abs(A-J)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(J))&&Math.abs(D-ne)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(ne))&&Math.abs(I-me)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(me))},St.sub=St.mul=void 0;var e=function(c,f){if(c&&c.__esModule)return c;if(c===null||s(c)!=="object"&&typeof c!="function")return{default:c};var x=r(void 0);if(x&&x.has(c))return x.get(c);var S={},C=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in c)if(_!=="default"&&Object.prototype.hasOwnProperty.call(c,_)){var E=C?Object.getOwnPropertyDescriptor(c,_):null;E&&(E.get||E.set)?Object.defineProperty(S,_,E):S[_]=c[_]}return S.default=c,x&&x.set(c,S),S}(le());function r(c){if(typeof WeakMap!="function")return null;var f=new WeakMap,x=new WeakMap;return(r=function(S){return S?x:f})(c)}function l(c,f,x){var S=f[0],C=f[1],_=f[2],E=f[3],M=f[4],A=f[5],D=f[6],I=f[7],B=f[8],U=x[0],G=x[1],H=x[2],q=x[3],Y=x[4],J=x[5],ne=x[6],me=x[7],ce=x[8];return c[0]=U*S+G*E+H*D,c[1]=U*C+G*M+H*I,c[2]=U*_+G*A+H*B,c[3]=q*S+Y*E+J*D,c[4]=q*C+Y*M+J*I,c[5]=q*_+Y*A+J*B,c[6]=ne*S+me*E+ce*D,c[7]=ne*C+me*M+ce*I,c[8]=ne*_+me*A+ce*B,c}function u(c,f,x){return c[0]=f[0]-x[0],c[1]=f[1]-x[1],c[2]=f[2]-x[2],c[3]=f[3]-x[3],c[4]=f[4]-x[4],c[5]=f[5]-x[5],c[6]=f[6]-x[6],c[7]=f[7]-x[7],c[8]=f[8]-x[8],c}return St.mul=l,St.sub=u,St}var cn,xt={};function rn(){if(cn)return xt;function s(_){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},s(_)}cn=1,Object.defineProperty(xt,"__esModule",{value:!0}),xt.create=function(){var _=new e.ARRAY_TYPE(16);return e.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=0,_[12]=0,_[13]=0,_[14]=0),_[0]=1,_[5]=1,_[10]=1,_[15]=1,_},xt.clone=function(_){var E=new e.ARRAY_TYPE(16);return E[0]=_[0],E[1]=_[1],E[2]=_[2],E[3]=_[3],E[4]=_[4],E[5]=_[5],E[6]=_[6],E[7]=_[7],E[8]=_[8],E[9]=_[9],E[10]=_[10],E[11]=_[11],E[12]=_[12],E[13]=_[13],E[14]=_[14],E[15]=_[15],E},xt.copy=function(_,E){return _[0]=E[0],_[1]=E[1],_[2]=E[2],_[3]=E[3],_[4]=E[4],_[5]=E[5],_[6]=E[6],_[7]=E[7],_[8]=E[8],_[9]=E[9],_[10]=E[10],_[11]=E[11],_[12]=E[12],_[13]=E[13],_[14]=E[14],_[15]=E[15],_},xt.fromValues=function(_,E,M,A,D,I,B,U,G,H,q,Y,J,ne,me,ce){var ue=new e.ARRAY_TYPE(16);return ue[0]=_,ue[1]=E,ue[2]=M,ue[3]=A,ue[4]=D,ue[5]=I,ue[6]=B,ue[7]=U,ue[8]=G,ue[9]=H,ue[10]=q,ue[11]=Y,ue[12]=J,ue[13]=ne,ue[14]=me,ue[15]=ce,ue},xt.set=function(_,E,M,A,D,I,B,U,G,H,q,Y,J,ne,me,ce,ue){return _[0]=E,_[1]=M,_[2]=A,_[3]=D,_[4]=I,_[5]=B,_[6]=U,_[7]=G,_[8]=H,_[9]=q,_[10]=Y,_[11]=J,_[12]=ne,_[13]=me,_[14]=ce,_[15]=ue,_},xt.identity=l,xt.transpose=function(_,E){if(_===E){var M=E[1],A=E[2],D=E[3],I=E[6],B=E[7],U=E[11];_[1]=E[4],_[2]=E[8],_[3]=E[12],_[4]=M,_[6]=E[9],_[7]=E[13],_[8]=A,_[9]=I,_[11]=E[14],_[12]=D,_[13]=B,_[14]=U}else _[0]=E[0],_[1]=E[4],_[2]=E[8],_[3]=E[12],_[4]=E[1],_[5]=E[5],_[6]=E[9],_[7]=E[13],_[8]=E[2],_[9]=E[6],_[10]=E[10],_[11]=E[14],_[12]=E[3],_[13]=E[7],_[14]=E[11],_[15]=E[15];return _},xt.invert=function(_,E){var M=E[0],A=E[1],D=E[2],I=E[3],B=E[4],U=E[5],G=E[6],H=E[7],q=E[8],Y=E[9],J=E[10],ne=E[11],me=E[12],ce=E[13],ue=E[14],Ee=E[15],_e=M*U-A*B,De=M*G-D*B,Le=M*H-I*B,Ne=A*G-D*U,Ge=A*H-I*U,Ve=D*H-I*G,Ke=q*ce-Y*me,Ze=q*ue-J*me,Je=q*Ee-ne*me,vt=Y*ue-J*ce,_t=Y*Ee-ne*ce,tn=J*Ee-ne*ue,Ct=_e*tn-De*_t+Le*vt+Ne*Je-Ge*Ze+Ve*Ke;return Ct?(_[0]=(U*tn-G*_t+H*vt)*(Ct=1/Ct),_[1]=(D*_t-A*tn-I*vt)*Ct,_[2]=(ce*Ve-ue*Ge+Ee*Ne)*Ct,_[3]=(J*Ge-Y*Ve-ne*Ne)*Ct,_[4]=(G*Je-B*tn-H*Ze)*Ct,_[5]=(M*tn-D*Je+I*Ze)*Ct,_[6]=(ue*Le-me*Ve-Ee*De)*Ct,_[7]=(q*Ve-J*Le+ne*De)*Ct,_[8]=(B*_t-U*Je+H*Ke)*Ct,_[9]=(A*Je-M*_t-I*Ke)*Ct,_[10]=(me*Ge-ce*Le+Ee*_e)*Ct,_[11]=(Y*Le-q*Ge-ne*_e)*Ct,_[12]=(U*Ze-B*vt-G*Ke)*Ct,_[13]=(M*vt-A*Ze+D*Ke)*Ct,_[14]=(ce*De-me*Ne-ue*_e)*Ct,_[15]=(q*Ne-Y*De+J*_e)*Ct,_):null},xt.adjoint=function(_,E){var M=E[0],A=E[1],D=E[2],I=E[3],B=E[4],U=E[5],G=E[6],H=E[7],q=E[8],Y=E[9],J=E[10],ne=E[11],me=E[12],ce=E[13],ue=E[14],Ee=E[15];return _[0]=U*(J*Ee-ne*ue)-Y*(G*Ee-H*ue)+ce*(G*ne-H*J),_[1]=-(A*(J*Ee-ne*ue)-Y*(D*Ee-I*ue)+ce*(D*ne-I*J)),_[2]=A*(G*Ee-H*ue)-U*(D*Ee-I*ue)+ce*(D*H-I*G),_[3]=-(A*(G*ne-H*J)-U*(D*ne-I*J)+Y*(D*H-I*G)),_[4]=-(B*(J*Ee-ne*ue)-q*(G*Ee-H*ue)+me*(G*ne-H*J)),_[5]=M*(J*Ee-ne*ue)-q*(D*Ee-I*ue)+me*(D*ne-I*J),_[6]=-(M*(G*Ee-H*ue)-B*(D*Ee-I*ue)+me*(D*H-I*G)),_[7]=M*(G*ne-H*J)-B*(D*ne-I*J)+q*(D*H-I*G),_[8]=B*(Y*Ee-ne*ce)-q*(U*Ee-H*ce)+me*(U*ne-H*Y),_[9]=-(M*(Y*Ee-ne*ce)-q*(A*Ee-I*ce)+me*(A*ne-I*Y)),_[10]=M*(U*Ee-H*ce)-B*(A*Ee-I*ce)+me*(A*H-I*U),_[11]=-(M*(U*ne-H*Y)-B*(A*ne-I*Y)+q*(A*H-I*U)),_[12]=-(B*(Y*ue-J*ce)-q*(U*ue-G*ce)+me*(U*J-G*Y)),_[13]=M*(Y*ue-J*ce)-q*(A*ue-D*ce)+me*(A*J-D*Y),_[14]=-(M*(U*ue-G*ce)-B*(A*ue-D*ce)+me*(A*G-D*U)),_[15]=M*(U*J-G*Y)-B*(A*J-D*Y)+q*(A*G-D*U),_},xt.determinant=function(_){var E=_[0],M=_[1],A=_[2],D=_[3],I=_[4],B=_[5],U=_[6],G=_[7],H=_[8],q=_[9],Y=_[10],J=_[11],ne=_[12],me=_[13],ce=_[14],ue=_[15];return(E*B-M*I)*(Y*ue-J*ce)-(E*U-A*I)*(q*ue-J*me)+(E*G-D*I)*(q*ce-Y*me)+(M*U-A*B)*(H*ue-J*ne)-(M*G-D*B)*(H*ce-Y*ne)+(A*G-D*U)*(H*me-q*ne)},xt.multiply=u,xt.translate=function(_,E,M){var A,D,I,B,U,G,H,q,Y,J,ne,me,ce=M[0],ue=M[1],Ee=M[2];return E===_?(_[12]=E[0]*ce+E[4]*ue+E[8]*Ee+E[12],_[13]=E[1]*ce+E[5]*ue+E[9]*Ee+E[13],_[14]=E[2]*ce+E[6]*ue+E[10]*Ee+E[14],_[15]=E[3]*ce+E[7]*ue+E[11]*Ee+E[15]):(D=E[1],I=E[2],B=E[3],U=E[4],G=E[5],H=E[6],q=E[7],Y=E[8],J=E[9],ne=E[10],me=E[11],_[0]=A=E[0],_[1]=D,_[2]=I,_[3]=B,_[4]=U,_[5]=G,_[6]=H,_[7]=q,_[8]=Y,_[9]=J,_[10]=ne,_[11]=me,_[12]=A*ce+U*ue+Y*Ee+E[12],_[13]=D*ce+G*ue+J*Ee+E[13],_[14]=I*ce+H*ue+ne*Ee+E[14],_[15]=B*ce+q*ue+me*Ee+E[15]),_},xt.scale=function(_,E,M){var A=M[0],D=M[1],I=M[2];return _[0]=E[0]*A,_[1]=E[1]*A,_[2]=E[2]*A,_[3]=E[3]*A,_[4]=E[4]*D,_[5]=E[5]*D,_[6]=E[6]*D,_[7]=E[7]*D,_[8]=E[8]*I,_[9]=E[9]*I,_[10]=E[10]*I,_[11]=E[11]*I,_[12]=E[12],_[13]=E[13],_[14]=E[14],_[15]=E[15],_},xt.rotate=function(_,E,M,A){var D,I,B,U,G,H,q,Y,J,ne,me,ce,ue,Ee,_e,De,Le,Ne,Ge,Ve,Ke,Ze,Je,vt,_t=A[0],tn=A[1],Ct=A[2],Bt=Math.hypot(_t,tn,Ct);return Bt<e.EPSILON?null:(_t*=Bt=1/Bt,tn*=Bt,Ct*=Bt,D=Math.sin(M),I=Math.cos(M),G=E[1],H=E[2],q=E[3],J=E[5],ne=E[6],me=E[7],ue=E[9],Ee=E[10],_e=E[11],De=_t*_t*(B=1-I)+I,Ge=_t*tn*B-Ct*D,Ve=tn*tn*B+I,Ke=Ct*tn*B+_t*D,Ze=_t*Ct*B+tn*D,Je=tn*Ct*B-_t*D,vt=Ct*Ct*B+I,_[0]=(U=E[0])*De+(Y=E[4])*(Le=tn*_t*B+Ct*D)+(ce=E[8])*(Ne=Ct*_t*B-tn*D),_[1]=G*De+J*Le+ue*Ne,_[2]=H*De+ne*Le+Ee*Ne,_[3]=q*De+me*Le+_e*Ne,_[4]=U*Ge+Y*Ve+ce*Ke,_[5]=G*Ge+J*Ve+ue*Ke,_[6]=H*Ge+ne*Ve+Ee*Ke,_[7]=q*Ge+me*Ve+_e*Ke,_[8]=U*Ze+Y*Je+ce*vt,_[9]=G*Ze+J*Je+ue*vt,_[10]=H*Ze+ne*Je+Ee*vt,_[11]=q*Ze+me*Je+_e*vt,E!==_&&(_[12]=E[12],_[13]=E[13],_[14]=E[14],_[15]=E[15]),_)},xt.rotateX=function(_,E,M){var A=Math.sin(M),D=Math.cos(M),I=E[4],B=E[5],U=E[6],G=E[7],H=E[8],q=E[9],Y=E[10],J=E[11];return E!==_&&(_[0]=E[0],_[1]=E[1],_[2]=E[2],_[3]=E[3],_[12]=E[12],_[13]=E[13],_[14]=E[14],_[15]=E[15]),_[4]=I*D+H*A,_[5]=B*D+q*A,_[6]=U*D+Y*A,_[7]=G*D+J*A,_[8]=H*D-I*A,_[9]=q*D-B*A,_[10]=Y*D-U*A,_[11]=J*D-G*A,_},xt.rotateY=function(_,E,M){var A=Math.sin(M),D=Math.cos(M),I=E[0],B=E[1],U=E[2],G=E[3],H=E[8],q=E[9],Y=E[10],J=E[11];return E!==_&&(_[4]=E[4],_[5]=E[5],_[6]=E[6],_[7]=E[7],_[12]=E[12],_[13]=E[13],_[14]=E[14],_[15]=E[15]),_[0]=I*D-H*A,_[1]=B*D-q*A,_[2]=U*D-Y*A,_[3]=G*D-J*A,_[8]=I*A+H*D,_[9]=B*A+q*D,_[10]=U*A+Y*D,_[11]=G*A+J*D,_},xt.rotateZ=function(_,E,M){var A=Math.sin(M),D=Math.cos(M),I=E[0],B=E[1],U=E[2],G=E[3],H=E[4],q=E[5],Y=E[6],J=E[7];return E!==_&&(_[8]=E[8],_[9]=E[9],_[10]=E[10],_[11]=E[11],_[12]=E[12],_[13]=E[13],_[14]=E[14],_[15]=E[15]),_[0]=I*D+H*A,_[1]=B*D+q*A,_[2]=U*D+Y*A,_[3]=G*D+J*A,_[4]=H*D-I*A,_[5]=q*D-B*A,_[6]=Y*D-U*A,_[7]=J*D-G*A,_},xt.fromTranslation=function(_,E){return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=E[0],_[13]=E[1],_[14]=E[2],_[15]=1,_},xt.fromScaling=function(_,E){return _[0]=E[0],_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=E[1],_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=E[2],_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},xt.fromRotation=function(_,E,M){var A,D,I,B=M[0],U=M[1],G=M[2],H=Math.hypot(B,U,G);return H<e.EPSILON?null:(B*=H=1/H,U*=H,G*=H,A=Math.sin(E),D=Math.cos(E),_[0]=B*B*(I=1-D)+D,_[1]=U*B*I+G*A,_[2]=G*B*I-U*A,_[3]=0,_[4]=B*U*I-G*A,_[5]=U*U*I+D,_[6]=G*U*I+B*A,_[7]=0,_[8]=B*G*I+U*A,_[9]=U*G*I-B*A,_[10]=G*G*I+D,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_)},xt.fromXRotation=function(_,E){var M=Math.sin(E),A=Math.cos(E);return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=A,_[6]=M,_[7]=0,_[8]=0,_[9]=-M,_[10]=A,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},xt.fromYRotation=function(_,E){var M=Math.sin(E),A=Math.cos(E);return _[0]=A,_[1]=0,_[2]=-M,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=M,_[9]=0,_[10]=A,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},xt.fromZRotation=function(_,E){var M=Math.sin(E),A=Math.cos(E);return _[0]=A,_[1]=M,_[2]=0,_[3]=0,_[4]=-M,_[5]=A,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},xt.fromRotationTranslation=c,xt.fromQuat2=function(_,E){var M=new e.ARRAY_TYPE(3),A=-E[0],D=-E[1],I=-E[2],B=E[3],U=E[4],G=E[5],H=E[6],q=E[7],Y=A*A+D*D+I*I+B*B;return Y>0?(M[0]=2*(U*B+q*A+G*I-H*D)/Y,M[1]=2*(G*B+q*D+H*A-U*I)/Y,M[2]=2*(H*B+q*I+U*D-G*A)/Y):(M[0]=2*(U*B+q*A+G*I-H*D),M[1]=2*(G*B+q*D+H*A-U*I),M[2]=2*(H*B+q*I+U*D-G*A)),c(_,E,M),_},xt.getTranslation=function(_,E){return _[0]=E[12],_[1]=E[13],_[2]=E[14],_},xt.getScaling=f,xt.getRotation=function(_,E){var M=new e.ARRAY_TYPE(3);f(M,E);var A=1/M[0],D=1/M[1],I=1/M[2],B=E[0]*A,U=E[1]*D,G=E[2]*I,H=E[4]*A,q=E[5]*D,Y=E[6]*I,J=E[8]*A,ne=E[9]*D,me=E[10]*I,ce=B+q+me,ue=0;return ce>0?(ue=2*Math.sqrt(ce+1),_[3]=.25*ue,_[0]=(Y-ne)/ue,_[1]=(J-G)/ue,_[2]=(U-H)/ue):B>q&&B>me?(ue=2*Math.sqrt(1+B-q-me),_[3]=(Y-ne)/ue,_[0]=.25*ue,_[1]=(U+H)/ue,_[2]=(J+G)/ue):q>me?(ue=2*Math.sqrt(1+q-B-me),_[3]=(J-G)/ue,_[0]=(U+H)/ue,_[1]=.25*ue,_[2]=(Y+ne)/ue):(ue=2*Math.sqrt(1+me-B-q),_[3]=(U-H)/ue,_[0]=(J+G)/ue,_[1]=(Y+ne)/ue,_[2]=.25*ue),_},xt.fromRotationTranslationScale=function(_,E,M,A){var D=E[0],I=E[1],B=E[2],U=E[3],G=D+D,H=I+I,q=B+B,Y=D*G,J=D*H,ne=D*q,me=I*H,ce=I*q,ue=B*q,Ee=U*G,_e=U*H,De=U*q,Le=A[0],Ne=A[1],Ge=A[2];return _[0]=(1-(me+ue))*Le,_[1]=(J+De)*Le,_[2]=(ne-_e)*Le,_[3]=0,_[4]=(J-De)*Ne,_[5]=(1-(Y+ue))*Ne,_[6]=(ce+Ee)*Ne,_[7]=0,_[8]=(ne+_e)*Ge,_[9]=(ce-Ee)*Ge,_[10]=(1-(Y+me))*Ge,_[11]=0,_[12]=M[0],_[13]=M[1],_[14]=M[2],_[15]=1,_},xt.fromRotationTranslationScaleOrigin=function(_,E,M,A,D){var I=E[0],B=E[1],U=E[2],G=E[3],H=I+I,q=B+B,Y=U+U,J=I*H,ne=I*q,me=I*Y,ce=B*q,ue=B*Y,Ee=U*Y,_e=G*H,De=G*q,Le=G*Y,Ne=A[0],Ge=A[1],Ve=A[2],Ke=D[0],Ze=D[1],Je=D[2],vt=(1-(ce+Ee))*Ne,_t=(ne+Le)*Ne,tn=(me-De)*Ne,Ct=(ne-Le)*Ge,Bt=(1-(J+Ee))*Ge,bt=(ue+_e)*Ge,xn=(me+De)*Ve,Jt=(ue-_e)*Ve,an=(1-(J+ce))*Ve;return _[0]=vt,_[1]=_t,_[2]=tn,_[3]=0,_[4]=Ct,_[5]=Bt,_[6]=bt,_[7]=0,_[8]=xn,_[9]=Jt,_[10]=an,_[11]=0,_[12]=M[0]+Ke-(vt*Ke+Ct*Ze+xn*Je),_[13]=M[1]+Ze-(_t*Ke+Bt*Ze+Jt*Je),_[14]=M[2]+Je-(tn*Ke+bt*Ze+an*Je),_[15]=1,_},xt.fromQuat=function(_,E){var M=E[0],A=E[1],D=E[2],I=E[3],B=M+M,U=A+A,G=D+D,H=M*B,q=A*B,Y=A*U,J=D*B,ne=D*U,me=D*G,ce=I*B,ue=I*U,Ee=I*G;return _[0]=1-Y-me,_[1]=q+Ee,_[2]=J-ue,_[3]=0,_[4]=q-Ee,_[5]=1-H-me,_[6]=ne+ce,_[7]=0,_[8]=J+ue,_[9]=ne-ce,_[10]=1-H-Y,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},xt.frustum=function(_,E,M,A,D,I,B){var U=1/(M-E),G=1/(D-A),H=1/(I-B);return _[0]=2*I*U,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=2*I*G,_[6]=0,_[7]=0,_[8]=(M+E)*U,_[9]=(D+A)*G,_[10]=(B+I)*H,_[11]=-1,_[12]=0,_[13]=0,_[14]=B*I*2*H,_[15]=0,_},xt.perspectiveNO=x,xt.perspectiveZO=function(_,E,M,A,D){var I,B=1/Math.tan(E/2);return _[0]=B/M,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=B,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,D!=null&&D!==1/0?(_[10]=D*(I=1/(A-D)),_[14]=D*A*I):(_[10]=-1,_[14]=-A),_},xt.perspectiveFromFieldOfView=function(_,E,M,A){var D=Math.tan(E.upDegrees*Math.PI/180),I=Math.tan(E.downDegrees*Math.PI/180),B=Math.tan(E.leftDegrees*Math.PI/180),U=Math.tan(E.rightDegrees*Math.PI/180),G=2/(B+U),H=2/(D+I);return _[0]=G,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=H,_[6]=0,_[7]=0,_[8]=-(B-U)*G*.5,_[9]=(D-I)*H*.5,_[10]=A/(M-A),_[11]=-1,_[12]=0,_[13]=0,_[14]=A*M/(M-A),_[15]=0,_},xt.orthoNO=S,xt.orthoZO=function(_,E,M,A,D,I,B){var U=1/(E-M),G=1/(A-D),H=1/(I-B);return _[0]=-2*U,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=-2*G,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=H,_[11]=0,_[12]=(E+M)*U,_[13]=(D+A)*G,_[14]=I*H,_[15]=1,_},xt.lookAt=function(_,E,M,A){var D,I,B,U,G,H,q,Y,J,ne,me=E[0],ce=E[1],ue=E[2],Ee=A[0],_e=A[1],De=A[2],Le=M[0],Ne=M[1],Ge=M[2];return Math.abs(me-Le)<e.EPSILON&&Math.abs(ce-Ne)<e.EPSILON&&Math.abs(ue-Ge)<e.EPSILON?l(_):(q=me-Le,Y=ce-Ne,J=ue-Ge,D=_e*(J*=ne=1/Math.hypot(q,Y,J))-De*(Y*=ne),I=De*(q*=ne)-Ee*J,B=Ee*Y-_e*q,(ne=Math.hypot(D,I,B))?(D*=ne=1/ne,I*=ne,B*=ne):(D=0,I=0,B=0),U=Y*B-J*I,G=J*D-q*B,H=q*I-Y*D,(ne=Math.hypot(U,G,H))?(U*=ne=1/ne,G*=ne,H*=ne):(U=0,G=0,H=0),_[0]=D,_[1]=U,_[2]=q,_[3]=0,_[4]=I,_[5]=G,_[6]=Y,_[7]=0,_[8]=B,_[9]=H,_[10]=J,_[11]=0,_[12]=-(D*me+I*ce+B*ue),_[13]=-(U*me+G*ce+H*ue),_[14]=-(q*me+Y*ce+J*ue),_[15]=1,_)},xt.targetTo=function(_,E,M,A){var D=E[0],I=E[1],B=E[2],U=A[0],G=A[1],H=A[2],q=D-M[0],Y=I-M[1],J=B-M[2],ne=q*q+Y*Y+J*J;ne>0&&(q*=ne=1/Math.sqrt(ne),Y*=ne,J*=ne);var me=G*J-H*Y,ce=H*q-U*J,ue=U*Y-G*q;return(ne=me*me+ce*ce+ue*ue)>0&&(me*=ne=1/Math.sqrt(ne),ce*=ne,ue*=ne),_[0]=me,_[1]=ce,_[2]=ue,_[3]=0,_[4]=Y*ue-J*ce,_[5]=J*me-q*ue,_[6]=q*ce-Y*me,_[7]=0,_[8]=q,_[9]=Y,_[10]=J,_[11]=0,_[12]=D,_[13]=I,_[14]=B,_[15]=1,_},xt.str=function(_){return"mat4("+_[0]+", "+_[1]+", "+_[2]+", "+_[3]+", "+_[4]+", "+_[5]+", "+_[6]+", "+_[7]+", "+_[8]+", "+_[9]+", "+_[10]+", "+_[11]+", "+_[12]+", "+_[13]+", "+_[14]+", "+_[15]+")"},xt.frob=function(_){return Math.hypot(_[0],_[1],_[2],_[3],_[4],_[5],_[6],_[7],_[8],_[9],_[10],_[11],_[12],_[13],_[14],_[15])},xt.add=function(_,E,M){return _[0]=E[0]+M[0],_[1]=E[1]+M[1],_[2]=E[2]+M[2],_[3]=E[3]+M[3],_[4]=E[4]+M[4],_[5]=E[5]+M[5],_[6]=E[6]+M[6],_[7]=E[7]+M[7],_[8]=E[8]+M[8],_[9]=E[9]+M[9],_[10]=E[10]+M[10],_[11]=E[11]+M[11],_[12]=E[12]+M[12],_[13]=E[13]+M[13],_[14]=E[14]+M[14],_[15]=E[15]+M[15],_},xt.subtract=C,xt.multiplyScalar=function(_,E,M){return _[0]=E[0]*M,_[1]=E[1]*M,_[2]=E[2]*M,_[3]=E[3]*M,_[4]=E[4]*M,_[5]=E[5]*M,_[6]=E[6]*M,_[7]=E[7]*M,_[8]=E[8]*M,_[9]=E[9]*M,_[10]=E[10]*M,_[11]=E[11]*M,_[12]=E[12]*M,_[13]=E[13]*M,_[14]=E[14]*M,_[15]=E[15]*M,_},xt.multiplyScalarAndAdd=function(_,E,M,A){return _[0]=E[0]+M[0]*A,_[1]=E[1]+M[1]*A,_[2]=E[2]+M[2]*A,_[3]=E[3]+M[3]*A,_[4]=E[4]+M[4]*A,_[5]=E[5]+M[5]*A,_[6]=E[6]+M[6]*A,_[7]=E[7]+M[7]*A,_[8]=E[8]+M[8]*A,_[9]=E[9]+M[9]*A,_[10]=E[10]+M[10]*A,_[11]=E[11]+M[11]*A,_[12]=E[12]+M[12]*A,_[13]=E[13]+M[13]*A,_[14]=E[14]+M[14]*A,_[15]=E[15]+M[15]*A,_},xt.exactEquals=function(_,E){return _[0]===E[0]&&_[1]===E[1]&&_[2]===E[2]&&_[3]===E[3]&&_[4]===E[4]&&_[5]===E[5]&&_[6]===E[6]&&_[7]===E[7]&&_[8]===E[8]&&_[9]===E[9]&&_[10]===E[10]&&_[11]===E[11]&&_[12]===E[12]&&_[13]===E[13]&&_[14]===E[14]&&_[15]===E[15]},xt.equals=function(_,E){var M=_[0],A=_[1],D=_[2],I=_[3],B=_[4],U=_[5],G=_[6],H=_[7],q=_[8],Y=_[9],J=_[10],ne=_[11],me=_[12],ce=_[13],ue=_[14],Ee=_[15],_e=E[0],De=E[1],Le=E[2],Ne=E[3],Ge=E[4],Ve=E[5],Ke=E[6],Ze=E[7],Je=E[8],vt=E[9],_t=E[10],tn=E[11],Ct=E[12],Bt=E[13],bt=E[14],xn=E[15];return Math.abs(M-_e)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(_e))&&Math.abs(A-De)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(De))&&Math.abs(D-Le)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(Le))&&Math.abs(I-Ne)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(Ne))&&Math.abs(B-Ge)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(Ge))&&Math.abs(U-Ve)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs(Ve))&&Math.abs(G-Ke)<=e.EPSILON*Math.max(1,Math.abs(G),Math.abs(Ke))&&Math.abs(H-Ze)<=e.EPSILON*Math.max(1,Math.abs(H),Math.abs(Ze))&&Math.abs(q-Je)<=e.EPSILON*Math.max(1,Math.abs(q),Math.abs(Je))&&Math.abs(Y-vt)<=e.EPSILON*Math.max(1,Math.abs(Y),Math.abs(vt))&&Math.abs(J-_t)<=e.EPSILON*Math.max(1,Math.abs(J),Math.abs(_t))&&Math.abs(ne-tn)<=e.EPSILON*Math.max(1,Math.abs(ne),Math.abs(tn))&&Math.abs(me-Ct)<=e.EPSILON*Math.max(1,Math.abs(me),Math.abs(Ct))&&Math.abs(ce-Bt)<=e.EPSILON*Math.max(1,Math.abs(ce),Math.abs(Bt))&&Math.abs(ue-bt)<=e.EPSILON*Math.max(1,Math.abs(ue),Math.abs(bt))&&Math.abs(Ee-xn)<=e.EPSILON*Math.max(1,Math.abs(Ee),Math.abs(xn))},xt.sub=xt.mul=xt.ortho=xt.perspective=void 0;var e=function(_,E){if(_&&_.__esModule)return _;if(_===null||s(_)!=="object"&&typeof _!="function")return{default:_};var M=r(void 0);if(M&&M.has(_))return M.get(_);var A={},D=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var I in _)if(I!=="default"&&Object.prototype.hasOwnProperty.call(_,I)){var B=D?Object.getOwnPropertyDescriptor(_,I):null;B&&(B.get||B.set)?Object.defineProperty(A,I,B):A[I]=_[I]}return A.default=_,M&&M.set(_,A),A}(le());function r(_){if(typeof WeakMap!="function")return null;var E=new WeakMap,M=new WeakMap;return(r=function(A){return A?M:E})(_)}function l(_){return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_}function u(_,E,M){var A=E[0],D=E[1],I=E[2],B=E[3],U=E[4],G=E[5],H=E[6],q=E[7],Y=E[8],J=E[9],ne=E[10],me=E[11],ce=E[12],ue=E[13],Ee=E[14],_e=E[15],De=M[0],Le=M[1],Ne=M[2],Ge=M[3];return _[0]=De*A+Le*U+Ne*Y+Ge*ce,_[1]=De*D+Le*G+Ne*J+Ge*ue,_[2]=De*I+Le*H+Ne*ne+Ge*Ee,_[3]=De*B+Le*q+Ne*me+Ge*_e,_[4]=(De=M[4])*A+(Le=M[5])*U+(Ne=M[6])*Y+(Ge=M[7])*ce,_[5]=De*D+Le*G+Ne*J+Ge*ue,_[6]=De*I+Le*H+Ne*ne+Ge*Ee,_[7]=De*B+Le*q+Ne*me+Ge*_e,_[8]=(De=M[8])*A+(Le=M[9])*U+(Ne=M[10])*Y+(Ge=M[11])*ce,_[9]=De*D+Le*G+Ne*J+Ge*ue,_[10]=De*I+Le*H+Ne*ne+Ge*Ee,_[11]=De*B+Le*q+Ne*me+Ge*_e,_[12]=(De=M[12])*A+(Le=M[13])*U+(Ne=M[14])*Y+(Ge=M[15])*ce,_[13]=De*D+Le*G+Ne*J+Ge*ue,_[14]=De*I+Le*H+Ne*ne+Ge*Ee,_[15]=De*B+Le*q+Ne*me+Ge*_e,_}function c(_,E,M){var A=E[0],D=E[1],I=E[2],B=E[3],U=A+A,G=D+D,H=I+I,q=A*U,Y=A*G,J=A*H,ne=D*G,me=D*H,ce=I*H,ue=B*U,Ee=B*G,_e=B*H;return _[0]=1-(ne+ce),_[1]=Y+_e,_[2]=J-Ee,_[3]=0,_[4]=Y-_e,_[5]=1-(q+ce),_[6]=me+ue,_[7]=0,_[8]=J+Ee,_[9]=me-ue,_[10]=1-(q+ne),_[11]=0,_[12]=M[0],_[13]=M[1],_[14]=M[2],_[15]=1,_}function f(_,E){var M=E[4],A=E[5],D=E[6],I=E[8],B=E[9],U=E[10];return _[0]=Math.hypot(E[0],E[1],E[2]),_[1]=Math.hypot(M,A,D),_[2]=Math.hypot(I,B,U),_}function x(_,E,M,A,D){var I,B=1/Math.tan(E/2);return _[0]=B/M,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=B,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,D!=null&&D!==1/0?(_[10]=(D+A)*(I=1/(A-D)),_[14]=2*D*A*I):(_[10]=-1,_[14]=-2*A),_}function S(_,E,M,A,D,I,B){var U=1/(E-M),G=1/(A-D),H=1/(I-B);return _[0]=-2*U,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=-2*G,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=2*H,_[11]=0,_[12]=(E+M)*U,_[13]=(D+A)*G,_[14]=(B+I)*H,_[15]=1,_}function C(_,E,M){return _[0]=E[0]-M[0],_[1]=E[1]-M[1],_[2]=E[2]-M[2],_[3]=E[3]-M[3],_[4]=E[4]-M[4],_[5]=E[5]-M[5],_[6]=E[6]-M[6],_[7]=E[7]-M[7],_[8]=E[8]-M[8],_[9]=E[9]-M[9],_[10]=E[10]-M[10],_[11]=E[11]-M[11],_[12]=E[12]-M[12],_[13]=E[13]-M[13],_[14]=E[14]-M[14],_[15]=E[15]-M[15],_}return xt.perspective=x,xt.ortho=S,xt.mul=u,xt.sub=C,xt}var Ut,Yt={},Rt={};function ln(){if(Ut)return Rt;function s(D){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},s(D)}Ut=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.create=l,Rt.clone=function(D){var I=new e.ARRAY_TYPE(3);return I[0]=D[0],I[1]=D[1],I[2]=D[2],I},Rt.length=u,Rt.fromValues=function(D,I,B){var U=new e.ARRAY_TYPE(3);return U[0]=D,U[1]=I,U[2]=B,U},Rt.copy=function(D,I){return D[0]=I[0],D[1]=I[1],D[2]=I[2],D},Rt.set=function(D,I,B,U){return D[0]=I,D[1]=B,D[2]=U,D},Rt.add=function(D,I,B){return D[0]=I[0]+B[0],D[1]=I[1]+B[1],D[2]=I[2]+B[2],D},Rt.subtract=c,Rt.multiply=f,Rt.divide=x,Rt.ceil=function(D,I){return D[0]=Math.ceil(I[0]),D[1]=Math.ceil(I[1]),D[2]=Math.ceil(I[2]),D},Rt.floor=function(D,I){return D[0]=Math.floor(I[0]),D[1]=Math.floor(I[1]),D[2]=Math.floor(I[2]),D},Rt.min=function(D,I,B){return D[0]=Math.min(I[0],B[0]),D[1]=Math.min(I[1],B[1]),D[2]=Math.min(I[2],B[2]),D},Rt.max=function(D,I,B){return D[0]=Math.max(I[0],B[0]),D[1]=Math.max(I[1],B[1]),D[2]=Math.max(I[2],B[2]),D},Rt.round=function(D,I){return D[0]=Math.round(I[0]),D[1]=Math.round(I[1]),D[2]=Math.round(I[2]),D},Rt.scale=function(D,I,B){return D[0]=I[0]*B,D[1]=I[1]*B,D[2]=I[2]*B,D},Rt.scaleAndAdd=function(D,I,B,U){return D[0]=I[0]+B[0]*U,D[1]=I[1]+B[1]*U,D[2]=I[2]+B[2]*U,D},Rt.distance=S,Rt.squaredDistance=C,Rt.squaredLength=_,Rt.negate=function(D,I){return D[0]=-I[0],D[1]=-I[1],D[2]=-I[2],D},Rt.inverse=function(D,I){return D[0]=1/I[0],D[1]=1/I[1],D[2]=1/I[2],D},Rt.normalize=function(D,I){var B=I[0],U=I[1],G=I[2],H=B*B+U*U+G*G;return H>0&&(H=1/Math.sqrt(H)),D[0]=I[0]*H,D[1]=I[1]*H,D[2]=I[2]*H,D},Rt.dot=E,Rt.cross=function(D,I,B){var U=I[0],G=I[1],H=I[2],q=B[0],Y=B[1],J=B[2];return D[0]=G*J-H*Y,D[1]=H*q-U*J,D[2]=U*Y-G*q,D},Rt.lerp=function(D,I,B,U){var G=I[0],H=I[1],q=I[2];return D[0]=G+U*(B[0]-G),D[1]=H+U*(B[1]-H),D[2]=q+U*(B[2]-q),D},Rt.hermite=function(D,I,B,U,G,H){var q=H*H,Y=q*(2*H-3)+1,J=q*(H-2)+H,ne=q*(H-1),me=q*(3-2*H);return D[0]=I[0]*Y+B[0]*J+U[0]*ne+G[0]*me,D[1]=I[1]*Y+B[1]*J+U[1]*ne+G[1]*me,D[2]=I[2]*Y+B[2]*J+U[2]*ne+G[2]*me,D},Rt.bezier=function(D,I,B,U,G,H){var q=1-H,Y=q*q,J=H*H,ne=Y*q,me=3*H*Y,ce=3*J*q,ue=J*H;return D[0]=I[0]*ne+B[0]*me+U[0]*ce+G[0]*ue,D[1]=I[1]*ne+B[1]*me+U[1]*ce+G[1]*ue,D[2]=I[2]*ne+B[2]*me+U[2]*ce+G[2]*ue,D},Rt.random=function(D,I){I=I||1;var B=2*e.RANDOM()*Math.PI,U=2*e.RANDOM()-1,G=Math.sqrt(1-U*U)*I;return D[0]=Math.cos(B)*G,D[1]=Math.sin(B)*G,D[2]=U*I,D},Rt.transformMat4=function(D,I,B){var U=I[0],G=I[1],H=I[2],q=B[3]*U+B[7]*G+B[11]*H+B[15];return D[0]=(B[0]*U+B[4]*G+B[8]*H+B[12])/(q=q||1),D[1]=(B[1]*U+B[5]*G+B[9]*H+B[13])/q,D[2]=(B[2]*U+B[6]*G+B[10]*H+B[14])/q,D},Rt.transformMat3=function(D,I,B){var U=I[0],G=I[1],H=I[2];return D[0]=U*B[0]+G*B[3]+H*B[6],D[1]=U*B[1]+G*B[4]+H*B[7],D[2]=U*B[2]+G*B[5]+H*B[8],D},Rt.transformQuat=function(D,I,B){var U=B[0],G=B[1],H=B[2],q=I[0],Y=I[1],J=I[2],ne=G*J-H*Y,me=H*q-U*J,ce=U*Y-G*q,ue=G*ce-H*me,Ee=H*ne-U*ce,_e=U*me-G*ne,De=2*B[3];return me*=De,ce*=De,Ee*=2,_e*=2,D[0]=q+(ne*=De)+(ue*=2),D[1]=Y+me+Ee,D[2]=J+ce+_e,D},Rt.rotateX=function(D,I,B,U){var G=[],H=[];return G[0]=I[0]-B[0],G[1]=I[1]-B[1],G[2]=I[2]-B[2],H[0]=G[0],H[1]=G[1]*Math.cos(U)-G[2]*Math.sin(U),H[2]=G[1]*Math.sin(U)+G[2]*Math.cos(U),D[0]=H[0]+B[0],D[1]=H[1]+B[1],D[2]=H[2]+B[2],D},Rt.rotateY=function(D,I,B,U){var G=[],H=[];return G[0]=I[0]-B[0],G[1]=I[1]-B[1],G[2]=I[2]-B[2],H[0]=G[2]*Math.sin(U)+G[0]*Math.cos(U),H[1]=G[1],H[2]=G[2]*Math.cos(U)-G[0]*Math.sin(U),D[0]=H[0]+B[0],D[1]=H[1]+B[1],D[2]=H[2]+B[2],D},Rt.rotateZ=function(D,I,B,U){var G=[],H=[];return G[0]=I[0]-B[0],G[1]=I[1]-B[1],G[2]=I[2]-B[2],H[0]=G[0]*Math.cos(U)-G[1]*Math.sin(U),H[1]=G[0]*Math.sin(U)+G[1]*Math.cos(U),H[2]=G[2],D[0]=H[0]+B[0],D[1]=H[1]+B[1],D[2]=H[2]+B[2],D},Rt.angle=function(D,I){var B=D[0],U=D[1],G=D[2],H=I[0],q=I[1],Y=I[2],J=Math.sqrt(B*B+U*U+G*G)*Math.sqrt(H*H+q*q+Y*Y),ne=J&&E(D,I)/J;return Math.acos(Math.min(Math.max(ne,-1),1))},Rt.zero=function(D){return D[0]=0,D[1]=0,D[2]=0,D},Rt.str=function(D){return"vec3("+D[0]+", "+D[1]+", "+D[2]+")"},Rt.exactEquals=function(D,I){return D[0]===I[0]&&D[1]===I[1]&&D[2]===I[2]},Rt.equals=function(D,I){var B=D[0],U=D[1],G=D[2],H=I[0],q=I[1],Y=I[2];return Math.abs(B-H)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(H))&&Math.abs(U-q)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs(q))&&Math.abs(G-Y)<=e.EPSILON*Math.max(1,Math.abs(G),Math.abs(Y))},Rt.forEach=Rt.sqrLen=Rt.len=Rt.sqrDist=Rt.dist=Rt.div=Rt.mul=Rt.sub=void 0;var e=function(D,I){if(D&&D.__esModule)return D;if(D===null||s(D)!=="object"&&typeof D!="function")return{default:D};var B=r(void 0);if(B&&B.has(D))return B.get(D);var U={},G=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var H in D)if(H!=="default"&&Object.prototype.hasOwnProperty.call(D,H)){var q=G?Object.getOwnPropertyDescriptor(D,H):null;q&&(q.get||q.set)?Object.defineProperty(U,H,q):U[H]=D[H]}return U.default=D,B&&B.set(D,U),U}(le());function r(D){if(typeof WeakMap!="function")return null;var I=new WeakMap,B=new WeakMap;return(r=function(U){return U?B:I})(D)}function l(){var D=new e.ARRAY_TYPE(3);return e.ARRAY_TYPE!=Float32Array&&(D[0]=0,D[1]=0,D[2]=0),D}function u(D){return Math.hypot(D[0],D[1],D[2])}function c(D,I,B){return D[0]=I[0]-B[0],D[1]=I[1]-B[1],D[2]=I[2]-B[2],D}function f(D,I,B){return D[0]=I[0]*B[0],D[1]=I[1]*B[1],D[2]=I[2]*B[2],D}function x(D,I,B){return D[0]=I[0]/B[0],D[1]=I[1]/B[1],D[2]=I[2]/B[2],D}function S(D,I){return Math.hypot(I[0]-D[0],I[1]-D[1],I[2]-D[2])}function C(D,I){var B=I[0]-D[0],U=I[1]-D[1],G=I[2]-D[2];return B*B+U*U+G*G}function _(D){var I=D[0],B=D[1],U=D[2];return I*I+B*B+U*U}function E(D,I){return D[0]*I[0]+D[1]*I[1]+D[2]*I[2]}Rt.sub=c,Rt.mul=f,Rt.div=x,Rt.dist=S,Rt.sqrDist=C,Rt.len=u,Rt.sqrLen=_;var M,A=(M=l(),function(D,I,B,U,G,H){var q,Y;for(I||(I=3),B||(B=0),Y=U?Math.min(U*I+B,D.length):D.length,q=B;q<Y;q+=I)M[0]=D[q],M[1]=D[q+1],M[2]=D[q+2],G(M,M,H),D[q]=M[0],D[q+1]=M[1],D[q+2]=M[2];return D});return Rt.forEach=A,Rt}var An,mn,$t={};function Nt(){if(An)return $t;function s(A){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},s(A)}An=1,Object.defineProperty($t,"__esModule",{value:!0}),$t.create=l,$t.clone=function(A){var D=new e.ARRAY_TYPE(4);return D[0]=A[0],D[1]=A[1],D[2]=A[2],D[3]=A[3],D},$t.fromValues=function(A,D,I,B){var U=new e.ARRAY_TYPE(4);return U[0]=A,U[1]=D,U[2]=I,U[3]=B,U},$t.copy=function(A,D){return A[0]=D[0],A[1]=D[1],A[2]=D[2],A[3]=D[3],A},$t.set=function(A,D,I,B,U){return A[0]=D,A[1]=I,A[2]=B,A[3]=U,A},$t.add=function(A,D,I){return A[0]=D[0]+I[0],A[1]=D[1]+I[1],A[2]=D[2]+I[2],A[3]=D[3]+I[3],A},$t.subtract=u,$t.multiply=c,$t.divide=f,$t.ceil=function(A,D){return A[0]=Math.ceil(D[0]),A[1]=Math.ceil(D[1]),A[2]=Math.ceil(D[2]),A[3]=Math.ceil(D[3]),A},$t.floor=function(A,D){return A[0]=Math.floor(D[0]),A[1]=Math.floor(D[1]),A[2]=Math.floor(D[2]),A[3]=Math.floor(D[3]),A},$t.min=function(A,D,I){return A[0]=Math.min(D[0],I[0]),A[1]=Math.min(D[1],I[1]),A[2]=Math.min(D[2],I[2]),A[3]=Math.min(D[3],I[3]),A},$t.max=function(A,D,I){return A[0]=Math.max(D[0],I[0]),A[1]=Math.max(D[1],I[1]),A[2]=Math.max(D[2],I[2]),A[3]=Math.max(D[3],I[3]),A},$t.round=function(A,D){return A[0]=Math.round(D[0]),A[1]=Math.round(D[1]),A[2]=Math.round(D[2]),A[3]=Math.round(D[3]),A},$t.scale=function(A,D,I){return A[0]=D[0]*I,A[1]=D[1]*I,A[2]=D[2]*I,A[3]=D[3]*I,A},$t.scaleAndAdd=function(A,D,I,B){return A[0]=D[0]+I[0]*B,A[1]=D[1]+I[1]*B,A[2]=D[2]+I[2]*B,A[3]=D[3]+I[3]*B,A},$t.distance=x,$t.squaredDistance=S,$t.length=C,$t.squaredLength=_,$t.negate=function(A,D){return A[0]=-D[0],A[1]=-D[1],A[2]=-D[2],A[3]=-D[3],A},$t.inverse=function(A,D){return A[0]=1/D[0],A[1]=1/D[1],A[2]=1/D[2],A[3]=1/D[3],A},$t.normalize=function(A,D){var I=D[0],B=D[1],U=D[2],G=D[3],H=I*I+B*B+U*U+G*G;return H>0&&(H=1/Math.sqrt(H)),A[0]=I*H,A[1]=B*H,A[2]=U*H,A[3]=G*H,A},$t.dot=function(A,D){return A[0]*D[0]+A[1]*D[1]+A[2]*D[2]+A[3]*D[3]},$t.cross=function(A,D,I,B){var U=I[0]*B[1]-I[1]*B[0],G=I[0]*B[2]-I[2]*B[0],H=I[0]*B[3]-I[3]*B[0],q=I[1]*B[2]-I[2]*B[1],Y=I[1]*B[3]-I[3]*B[1],J=I[2]*B[3]-I[3]*B[2],ne=D[0],me=D[1],ce=D[2],ue=D[3];return A[0]=me*J-ce*Y+ue*q,A[1]=-ne*J+ce*H-ue*G,A[2]=ne*Y-me*H+ue*U,A[3]=-ne*q+me*G-ce*U,A},$t.lerp=function(A,D,I,B){var U=D[0],G=D[1],H=D[2],q=D[3];return A[0]=U+B*(I[0]-U),A[1]=G+B*(I[1]-G),A[2]=H+B*(I[2]-H),A[3]=q+B*(I[3]-q),A},$t.random=function(A,D){var I,B,U,G,H,q;D=D||1;do H=(I=2*e.RANDOM()-1)*I+(B=2*e.RANDOM()-1)*B;while(H>=1);do q=(U=2*e.RANDOM()-1)*U+(G=2*e.RANDOM()-1)*G;while(q>=1);var Y=Math.sqrt((1-H)/q);return A[0]=D*I,A[1]=D*B,A[2]=D*U*Y,A[3]=D*G*Y,A},$t.transformMat4=function(A,D,I){var B=D[0],U=D[1],G=D[2],H=D[3];return A[0]=I[0]*B+I[4]*U+I[8]*G+I[12]*H,A[1]=I[1]*B+I[5]*U+I[9]*G+I[13]*H,A[2]=I[2]*B+I[6]*U+I[10]*G+I[14]*H,A[3]=I[3]*B+I[7]*U+I[11]*G+I[15]*H,A},$t.transformQuat=function(A,D,I){var B=D[0],U=D[1],G=D[2],H=I[0],q=I[1],Y=I[2],J=I[3],ne=J*B+q*G-Y*U,me=J*U+Y*B-H*G,ce=J*G+H*U-q*B,ue=-H*B-q*U-Y*G;return A[0]=ne*J+ue*-H+me*-Y-ce*-q,A[1]=me*J+ue*-q+ce*-H-ne*-Y,A[2]=ce*J+ue*-Y+ne*-q-me*-H,A[3]=D[3],A},$t.zero=function(A){return A[0]=0,A[1]=0,A[2]=0,A[3]=0,A},$t.str=function(A){return"vec4("+A[0]+", "+A[1]+", "+A[2]+", "+A[3]+")"},$t.exactEquals=function(A,D){return A[0]===D[0]&&A[1]===D[1]&&A[2]===D[2]&&A[3]===D[3]},$t.equals=function(A,D){var I=A[0],B=A[1],U=A[2],G=A[3],H=D[0],q=D[1],Y=D[2],J=D[3];return Math.abs(I-H)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(H))&&Math.abs(B-q)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(q))&&Math.abs(U-Y)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs(Y))&&Math.abs(G-J)<=e.EPSILON*Math.max(1,Math.abs(G),Math.abs(J))},$t.forEach=$t.sqrLen=$t.len=$t.sqrDist=$t.dist=$t.div=$t.mul=$t.sub=void 0;var e=function(A,D){if(A&&A.__esModule)return A;if(A===null||s(A)!=="object"&&typeof A!="function")return{default:A};var I=r(void 0);if(I&&I.has(A))return I.get(A);var B={},U=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var G in A)if(G!=="default"&&Object.prototype.hasOwnProperty.call(A,G)){var H=U?Object.getOwnPropertyDescriptor(A,G):null;H&&(H.get||H.set)?Object.defineProperty(B,G,H):B[G]=A[G]}return B.default=A,I&&I.set(A,B),B}(le());function r(A){if(typeof WeakMap!="function")return null;var D=new WeakMap,I=new WeakMap;return(r=function(B){return B?I:D})(A)}function l(){var A=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0,A[3]=0),A}function u(A,D,I){return A[0]=D[0]-I[0],A[1]=D[1]-I[1],A[2]=D[2]-I[2],A[3]=D[3]-I[3],A}function c(A,D,I){return A[0]=D[0]*I[0],A[1]=D[1]*I[1],A[2]=D[2]*I[2],A[3]=D[3]*I[3],A}function f(A,D,I){return A[0]=D[0]/I[0],A[1]=D[1]/I[1],A[2]=D[2]/I[2],A[3]=D[3]/I[3],A}function x(A,D){return Math.hypot(D[0]-A[0],D[1]-A[1],D[2]-A[2],D[3]-A[3])}function S(A,D){var I=D[0]-A[0],B=D[1]-A[1],U=D[2]-A[2],G=D[3]-A[3];return I*I+B*B+U*U+G*G}function C(A){return Math.hypot(A[0],A[1],A[2],A[3])}function _(A){var D=A[0],I=A[1],B=A[2],U=A[3];return D*D+I*I+B*B+U*U}$t.sub=u,$t.mul=c,$t.div=f,$t.dist=x,$t.sqrDist=S,$t.len=C,$t.sqrLen=_;var E,M=(E=l(),function(A,D,I,B,U,G){var H,q;for(D||(D=4),I||(I=0),q=B?Math.min(B*D+I,A.length):A.length,H=I;H<q;H+=D)E[0]=A[H],E[1]=A[H+1],E[2]=A[H+2],E[3]=A[H+3],U(E,E,G),A[H]=E[0],A[H+1]=E[1],A[H+2]=E[2],A[H+3]=E[3];return A});return $t.forEach=M,$t}function Kt(){if(mn)return Yt;function s(_e){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(De){return typeof De}:function(De){return De&&typeof Symbol=="function"&&De.constructor===Symbol&&De!==Symbol.prototype?"symbol":typeof De},s(_e)}mn=1,Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.create=x,Yt.identity=function(_e){return _e[0]=0,_e[1]=0,_e[2]=0,_e[3]=1,_e},Yt.setAxisAngle=S,Yt.getAxisAngle=function(_e,De){var Le=2*Math.acos(De[3]),Ne=Math.sin(Le/2);return Ne>e.EPSILON?(_e[0]=De[0]/Ne,_e[1]=De[1]/Ne,_e[2]=De[2]/Ne):(_e[0]=1,_e[1]=0,_e[2]=0),Le},Yt.getAngle=function(_e,De){var Le=I(_e,De);return Math.acos(2*Le*Le-1)},Yt.multiply=C,Yt.rotateX=function(_e,De,Le){Le*=.5;var Ne=De[0],Ge=De[1],Ve=De[2],Ke=De[3],Ze=Math.sin(Le),Je=Math.cos(Le);return _e[0]=Ne*Je+Ke*Ze,_e[1]=Ge*Je+Ve*Ze,_e[2]=Ve*Je-Ge*Ze,_e[3]=Ke*Je-Ne*Ze,_e},Yt.rotateY=function(_e,De,Le){Le*=.5;var Ne=De[0],Ge=De[1],Ve=De[2],Ke=De[3],Ze=Math.sin(Le),Je=Math.cos(Le);return _e[0]=Ne*Je-Ve*Ze,_e[1]=Ge*Je+Ke*Ze,_e[2]=Ve*Je+Ne*Ze,_e[3]=Ke*Je-Ge*Ze,_e},Yt.rotateZ=function(_e,De,Le){Le*=.5;var Ne=De[0],Ge=De[1],Ve=De[2],Ke=De[3],Ze=Math.sin(Le),Je=Math.cos(Le);return _e[0]=Ne*Je+Ge*Ze,_e[1]=Ge*Je-Ne*Ze,_e[2]=Ve*Je+Ke*Ze,_e[3]=Ke*Je-Ve*Ze,_e},Yt.calculateW=function(_e,De){var Le=De[0],Ne=De[1],Ge=De[2];return _e[0]=Le,_e[1]=Ne,_e[2]=Ge,_e[3]=Math.sqrt(Math.abs(1-Le*Le-Ne*Ne-Ge*Ge)),_e},Yt.exp=_,Yt.ln=E,Yt.pow=function(_e,De,Le){return E(_e,De),D(_e,_e,Le),_(_e,_e),_e},Yt.slerp=M,Yt.random=function(_e){var De=e.RANDOM(),Le=e.RANDOM(),Ne=e.RANDOM(),Ge=Math.sqrt(1-De),Ve=Math.sqrt(De);return _e[0]=Ge*Math.sin(2*Math.PI*Le),_e[1]=Ge*Math.cos(2*Math.PI*Le),_e[2]=Ve*Math.sin(2*Math.PI*Ne),_e[3]=Ve*Math.cos(2*Math.PI*Ne),_e},Yt.invert=function(_e,De){var Le=De[0],Ne=De[1],Ge=De[2],Ve=De[3],Ke=Le*Le+Ne*Ne+Ge*Ge+Ve*Ve,Ze=Ke?1/Ke:0;return _e[0]=-Le*Ze,_e[1]=-Ne*Ze,_e[2]=-Ge*Ze,_e[3]=Ve*Ze,_e},Yt.conjugate=function(_e,De){return _e[0]=-De[0],_e[1]=-De[1],_e[2]=-De[2],_e[3]=De[3],_e},Yt.fromMat3=A,Yt.fromEuler=function(_e,De,Le,Ne){var Ge=.5*Math.PI/180;De*=Ge,Le*=Ge,Ne*=Ge;var Ve=Math.sin(De),Ke=Math.cos(De),Ze=Math.sin(Le),Je=Math.cos(Le),vt=Math.sin(Ne),_t=Math.cos(Ne);return _e[0]=Ve*Je*_t-Ke*Ze*vt,_e[1]=Ke*Ze*_t+Ve*Je*vt,_e[2]=Ke*Je*vt-Ve*Ze*_t,_e[3]=Ke*Je*_t+Ve*Ze*vt,_e},Yt.str=function(_e){return"quat("+_e[0]+", "+_e[1]+", "+_e[2]+", "+_e[3]+")"},Yt.setAxes=Yt.sqlerp=Yt.rotationTo=Yt.equals=Yt.exactEquals=Yt.normalize=Yt.sqrLen=Yt.squaredLength=Yt.len=Yt.length=Yt.lerp=Yt.dot=Yt.scale=Yt.mul=Yt.add=Yt.set=Yt.copy=Yt.fromValues=Yt.clone=void 0;var e=f(le()),r=f(Xt()),l=f(ln()),u=f(Nt());function c(_e){if(typeof WeakMap!="function")return null;var De=new WeakMap,Le=new WeakMap;return(c=function(Ne){return Ne?Le:De})(_e)}function f(_e,De){if(_e&&_e.__esModule)return _e;if(_e===null||s(_e)!=="object"&&typeof _e!="function")return{default:_e};var Le=c(De);if(Le&&Le.has(_e))return Le.get(_e);var Ne={},Ge=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Ve in _e)if(Ve!=="default"&&Object.prototype.hasOwnProperty.call(_e,Ve)){var Ke=Ge?Object.getOwnPropertyDescriptor(_e,Ve):null;Ke&&(Ke.get||Ke.set)?Object.defineProperty(Ne,Ve,Ke):Ne[Ve]=_e[Ve]}return Ne.default=_e,Le&&Le.set(_e,Ne),Ne}function x(){var _e=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(_e[0]=0,_e[1]=0,_e[2]=0),_e[3]=1,_e}function S(_e,De,Le){Le*=.5;var Ne=Math.sin(Le);return _e[0]=Ne*De[0],_e[1]=Ne*De[1],_e[2]=Ne*De[2],_e[3]=Math.cos(Le),_e}function C(_e,De,Le){var Ne=De[0],Ge=De[1],Ve=De[2],Ke=De[3],Ze=Le[0],Je=Le[1],vt=Le[2],_t=Le[3];return _e[0]=Ne*_t+Ke*Ze+Ge*vt-Ve*Je,_e[1]=Ge*_t+Ke*Je+Ve*Ze-Ne*vt,_e[2]=Ve*_t+Ke*vt+Ne*Je-Ge*Ze,_e[3]=Ke*_t-Ne*Ze-Ge*Je-Ve*vt,_e}function _(_e,De){var Le=De[0],Ne=De[1],Ge=De[2],Ve=De[3],Ke=Math.sqrt(Le*Le+Ne*Ne+Ge*Ge),Ze=Math.exp(Ve),Je=Ke>0?Ze*Math.sin(Ke)/Ke:0;return _e[0]=Le*Je,_e[1]=Ne*Je,_e[2]=Ge*Je,_e[3]=Ze*Math.cos(Ke),_e}function E(_e,De){var Le=De[0],Ne=De[1],Ge=De[2],Ve=De[3],Ke=Math.sqrt(Le*Le+Ne*Ne+Ge*Ge),Ze=Ke>0?Math.atan2(Ke,Ve)/Ke:0;return _e[0]=Le*Ze,_e[1]=Ne*Ze,_e[2]=Ge*Ze,_e[3]=.5*Math.log(Le*Le+Ne*Ne+Ge*Ge+Ve*Ve),_e}function M(_e,De,Le,Ne){var Ge,Ve,Ke,Ze,Je,vt=De[0],_t=De[1],tn=De[2],Ct=De[3],Bt=Le[0],bt=Le[1],xn=Le[2],Jt=Le[3];return(Ve=vt*Bt+_t*bt+tn*xn+Ct*Jt)<0&&(Ve=-Ve,Bt=-Bt,bt=-bt,xn=-xn,Jt=-Jt),1-Ve>e.EPSILON?(Ge=Math.acos(Ve),Ke=Math.sin(Ge),Ze=Math.sin((1-Ne)*Ge)/Ke,Je=Math.sin(Ne*Ge)/Ke):(Ze=1-Ne,Je=Ne),_e[0]=Ze*vt+Je*Bt,_e[1]=Ze*_t+Je*bt,_e[2]=Ze*tn+Je*xn,_e[3]=Ze*Ct+Je*Jt,_e}function A(_e,De){var Le,Ne=De[0]+De[4]+De[8];if(Ne>0)Le=Math.sqrt(Ne+1),_e[3]=.5*Le,_e[0]=(De[5]-De[7])*(Le=.5/Le),_e[1]=(De[6]-De[2])*Le,_e[2]=(De[1]-De[3])*Le;else{var Ge=0;De[4]>De[0]&&(Ge=1),De[8]>De[3*Ge+Ge]&&(Ge=2);var Ve=(Ge+1)%3,Ke=(Ge+2)%3;Le=Math.sqrt(De[3*Ge+Ge]-De[3*Ve+Ve]-De[3*Ke+Ke]+1),_e[Ge]=.5*Le,_e[3]=(De[3*Ve+Ke]-De[3*Ke+Ve])*(Le=.5/Le),_e[Ve]=(De[3*Ve+Ge]+De[3*Ge+Ve])*Le,_e[Ke]=(De[3*Ke+Ge]+De[3*Ge+Ke])*Le}return _e}Yt.clone=u.clone,Yt.fromValues=u.fromValues,Yt.copy=u.copy,Yt.set=u.set,Yt.add=u.add,Yt.mul=C;var D=u.scale;Yt.scale=D;var I=u.dot;Yt.dot=I,Yt.lerp=u.lerp;var B=u.length;Yt.length=B,Yt.len=B;var U=u.squaredLength;Yt.squaredLength=U,Yt.sqrLen=U;var G=u.normalize;Yt.normalize=G,Yt.exactEquals=u.exactEquals,Yt.equals=u.equals;var H,q,Y,J=(H=l.create(),q=l.fromValues(1,0,0),Y=l.fromValues(0,1,0),function(_e,De,Le){var Ne=l.dot(De,Le);return Ne<-.999999?(l.cross(H,q,De),l.len(H)<1e-6&&l.cross(H,Y,De),l.normalize(H,H),S(_e,H,Math.PI),_e):Ne>.999999?(_e[0]=0,_e[1]=0,_e[2]=0,_e[3]=1,_e):(l.cross(H,De,Le),_e[0]=H[0],_e[1]=H[1],_e[2]=H[2],_e[3]=1+Ne,G(_e,_e))});Yt.rotationTo=J;var ne,me,ce=(ne=x(),me=x(),function(_e,De,Le,Ne,Ge,Ve){return M(ne,De,Ge,Ve),M(me,Le,Ne,Ve),M(_e,ne,me,2*Ve*(1-Ve)),_e});Yt.sqlerp=ce;var ue,Ee=(ue=r.create(),function(_e,De,Le,Ne){return ue[0]=Le[0],ue[3]=Le[1],ue[6]=Le[2],ue[1]=Ne[0],ue[4]=Ne[1],ue[7]=Ne[2],ue[2]=-De[0],ue[5]=-De[1],ue[8]=-De[2],G(_e,A(_e,ue))});return Yt.setAxes=Ee,Yt}var It,sn={};function tt(){if(It)return sn;function s(M){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},s(M)}It=1,Object.defineProperty(sn,"__esModule",{value:!0}),sn.create=function(){var M=new e.ARRAY_TYPE(8);return e.ARRAY_TYPE!=Float32Array&&(M[0]=0,M[1]=0,M[2]=0,M[4]=0,M[5]=0,M[6]=0,M[7]=0),M[3]=1,M},sn.clone=function(M){var A=new e.ARRAY_TYPE(8);return A[0]=M[0],A[1]=M[1],A[2]=M[2],A[3]=M[3],A[4]=M[4],A[5]=M[5],A[6]=M[6],A[7]=M[7],A},sn.fromValues=function(M,A,D,I,B,U,G,H){var q=new e.ARRAY_TYPE(8);return q[0]=M,q[1]=A,q[2]=D,q[3]=I,q[4]=B,q[5]=U,q[6]=G,q[7]=H,q},sn.fromRotationTranslationValues=function(M,A,D,I,B,U,G){var H=new e.ARRAY_TYPE(8);H[0]=M,H[1]=A,H[2]=D,H[3]=I;var q=.5*B,Y=.5*U,J=.5*G;return H[4]=q*I+Y*D-J*A,H[5]=Y*I+J*M-q*D,H[6]=J*I+q*A-Y*M,H[7]=-q*M-Y*A-J*D,H},sn.fromRotationTranslation=f,sn.fromTranslation=function(M,A){return M[0]=0,M[1]=0,M[2]=0,M[3]=1,M[4]=.5*A[0],M[5]=.5*A[1],M[6]=.5*A[2],M[7]=0,M},sn.fromRotation=function(M,A){return M[0]=A[0],M[1]=A[1],M[2]=A[2],M[3]=A[3],M[4]=0,M[5]=0,M[6]=0,M[7]=0,M},sn.fromMat4=function(M,A){var D=r.create();l.getRotation(D,A);var I=new e.ARRAY_TYPE(3);return l.getTranslation(I,A),f(M,D,I),M},sn.copy=x,sn.identity=function(M){return M[0]=0,M[1]=0,M[2]=0,M[3]=1,M[4]=0,M[5]=0,M[6]=0,M[7]=0,M},sn.set=function(M,A,D,I,B,U,G,H,q){return M[0]=A,M[1]=D,M[2]=I,M[3]=B,M[4]=U,M[5]=G,M[6]=H,M[7]=q,M},sn.getDual=function(M,A){return M[0]=A[4],M[1]=A[5],M[2]=A[6],M[3]=A[7],M},sn.setDual=function(M,A){return M[4]=A[0],M[5]=A[1],M[6]=A[2],M[7]=A[3],M},sn.getTranslation=function(M,A){var D=A[4],I=A[5],B=A[6],U=A[7],G=-A[0],H=-A[1],q=-A[2],Y=A[3];return M[0]=2*(D*Y+U*G+I*q-B*H),M[1]=2*(I*Y+U*H+B*G-D*q),M[2]=2*(B*Y+U*q+D*H-I*G),M},sn.translate=function(M,A,D){var I=A[0],B=A[1],U=A[2],G=A[3],H=.5*D[0],q=.5*D[1],Y=.5*D[2],J=A[4],ne=A[5],me=A[6],ce=A[7];return M[0]=I,M[1]=B,M[2]=U,M[3]=G,M[4]=G*H+B*Y-U*q+J,M[5]=G*q+U*H-I*Y+ne,M[6]=G*Y+I*q-B*H+me,M[7]=-I*H-B*q-U*Y+ce,M},sn.rotateX=function(M,A,D){var I=-A[0],B=-A[1],U=-A[2],G=A[3],H=A[4],q=A[5],Y=A[6],J=A[7],ne=H*G+J*I+q*U-Y*B,me=q*G+J*B+Y*I-H*U,ce=Y*G+J*U+H*B-q*I,ue=J*G-H*I-q*B-Y*U;return r.rotateX(M,A,D),M[4]=ne*(G=M[3])+ue*(I=M[0])+me*(U=M[2])-ce*(B=M[1]),M[5]=me*G+ue*B+ce*I-ne*U,M[6]=ce*G+ue*U+ne*B-me*I,M[7]=ue*G-ne*I-me*B-ce*U,M},sn.rotateY=function(M,A,D){var I=-A[0],B=-A[1],U=-A[2],G=A[3],H=A[4],q=A[5],Y=A[6],J=A[7],ne=H*G+J*I+q*U-Y*B,me=q*G+J*B+Y*I-H*U,ce=Y*G+J*U+H*B-q*I,ue=J*G-H*I-q*B-Y*U;return r.rotateY(M,A,D),M[4]=ne*(G=M[3])+ue*(I=M[0])+me*(U=M[2])-ce*(B=M[1]),M[5]=me*G+ue*B+ce*I-ne*U,M[6]=ce*G+ue*U+ne*B-me*I,M[7]=ue*G-ne*I-me*B-ce*U,M},sn.rotateZ=function(M,A,D){var I=-A[0],B=-A[1],U=-A[2],G=A[3],H=A[4],q=A[5],Y=A[6],J=A[7],ne=H*G+J*I+q*U-Y*B,me=q*G+J*B+Y*I-H*U,ce=Y*G+J*U+H*B-q*I,ue=J*G-H*I-q*B-Y*U;return r.rotateZ(M,A,D),M[4]=ne*(G=M[3])+ue*(I=M[0])+me*(U=M[2])-ce*(B=M[1]),M[5]=me*G+ue*B+ce*I-ne*U,M[6]=ce*G+ue*U+ne*B-me*I,M[7]=ue*G-ne*I-me*B-ce*U,M},sn.rotateByQuatAppend=function(M,A,D){var I=D[0],B=D[1],U=D[2],G=D[3],H=A[0],q=A[1],Y=A[2],J=A[3];return M[0]=H*G+J*I+q*U-Y*B,M[1]=q*G+J*B+Y*I-H*U,M[2]=Y*G+J*U+H*B-q*I,M[3]=J*G-H*I-q*B-Y*U,M[4]=(H=A[4])*G+(J=A[7])*I+(q=A[5])*U-(Y=A[6])*B,M[5]=q*G+J*B+Y*I-H*U,M[6]=Y*G+J*U+H*B-q*I,M[7]=J*G-H*I-q*B-Y*U,M},sn.rotateByQuatPrepend=function(M,A,D){var I=A[0],B=A[1],U=A[2],G=A[3],H=D[0],q=D[1],Y=D[2],J=D[3];return M[0]=I*J+G*H+B*Y-U*q,M[1]=B*J+G*q+U*H-I*Y,M[2]=U*J+G*Y+I*q-B*H,M[3]=G*J-I*H-B*q-U*Y,M[4]=I*(J=D[7])+G*(H=D[4])+B*(Y=D[6])-U*(q=D[5]),M[5]=B*J+G*q+U*H-I*Y,M[6]=U*J+G*Y+I*q-B*H,M[7]=G*J-I*H-B*q-U*Y,M},sn.rotateAroundAxis=function(M,A,D,I){if(Math.abs(I)<e.EPSILON)return x(M,A);var B=Math.hypot(D[0],D[1],D[2]);I*=.5;var U=Math.sin(I),G=U*D[0]/B,H=U*D[1]/B,q=U*D[2]/B,Y=Math.cos(I),J=A[0],ne=A[1],me=A[2],ce=A[3];M[0]=J*Y+ce*G+ne*q-me*H,M[1]=ne*Y+ce*H+me*G-J*q,M[2]=me*Y+ce*q+J*H-ne*G,M[3]=ce*Y-J*G-ne*H-me*q;var ue=A[4],Ee=A[5],_e=A[6],De=A[7];return M[4]=ue*Y+De*G+Ee*q-_e*H,M[5]=Ee*Y+De*H+_e*G-ue*q,M[6]=_e*Y+De*q+ue*H-Ee*G,M[7]=De*Y-ue*G-Ee*H-_e*q,M},sn.add=function(M,A,D){return M[0]=A[0]+D[0],M[1]=A[1]+D[1],M[2]=A[2]+D[2],M[3]=A[3]+D[3],M[4]=A[4]+D[4],M[5]=A[5]+D[5],M[6]=A[6]+D[6],M[7]=A[7]+D[7],M},sn.multiply=S,sn.scale=function(M,A,D){return M[0]=A[0]*D,M[1]=A[1]*D,M[2]=A[2]*D,M[3]=A[3]*D,M[4]=A[4]*D,M[5]=A[5]*D,M[6]=A[6]*D,M[7]=A[7]*D,M},sn.lerp=function(M,A,D,I){var B=1-I;return C(A,D)<0&&(I=-I),M[0]=A[0]*B+D[0]*I,M[1]=A[1]*B+D[1]*I,M[2]=A[2]*B+D[2]*I,M[3]=A[3]*B+D[3]*I,M[4]=A[4]*B+D[4]*I,M[5]=A[5]*B+D[5]*I,M[6]=A[6]*B+D[6]*I,M[7]=A[7]*B+D[7]*I,M},sn.invert=function(M,A){var D=E(A);return M[0]=-A[0]/D,M[1]=-A[1]/D,M[2]=-A[2]/D,M[3]=A[3]/D,M[4]=-A[4]/D,M[5]=-A[5]/D,M[6]=-A[6]/D,M[7]=A[7]/D,M},sn.conjugate=function(M,A){return M[0]=-A[0],M[1]=-A[1],M[2]=-A[2],M[3]=A[3],M[4]=-A[4],M[5]=-A[5],M[6]=-A[6],M[7]=A[7],M},sn.normalize=function(M,A){var D=E(A);if(D>0){D=Math.sqrt(D);var I=A[0]/D,B=A[1]/D,U=A[2]/D,G=A[3]/D,H=A[4],q=A[5],Y=A[6],J=A[7],ne=I*H+B*q+U*Y+G*J;M[0]=I,M[1]=B,M[2]=U,M[3]=G,M[4]=(H-I*ne)/D,M[5]=(q-B*ne)/D,M[6]=(Y-U*ne)/D,M[7]=(J-G*ne)/D}return M},sn.str=function(M){return"quat2("+M[0]+", "+M[1]+", "+M[2]+", "+M[3]+", "+M[4]+", "+M[5]+", "+M[6]+", "+M[7]+")"},sn.exactEquals=function(M,A){return M[0]===A[0]&&M[1]===A[1]&&M[2]===A[2]&&M[3]===A[3]&&M[4]===A[4]&&M[5]===A[5]&&M[6]===A[6]&&M[7]===A[7]},sn.equals=function(M,A){var D=M[0],I=M[1],B=M[2],U=M[3],G=M[4],H=M[5],q=M[6],Y=M[7],J=A[0],ne=A[1],me=A[2],ce=A[3],ue=A[4],Ee=A[5],_e=A[6],De=A[7];return Math.abs(D-J)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(J))&&Math.abs(I-ne)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(ne))&&Math.abs(B-me)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(me))&&Math.abs(U-ce)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs(ce))&&Math.abs(G-ue)<=e.EPSILON*Math.max(1,Math.abs(G),Math.abs(ue))&&Math.abs(H-Ee)<=e.EPSILON*Math.max(1,Math.abs(H),Math.abs(Ee))&&Math.abs(q-_e)<=e.EPSILON*Math.max(1,Math.abs(q),Math.abs(_e))&&Math.abs(Y-De)<=e.EPSILON*Math.max(1,Math.abs(Y),Math.abs(De))},sn.sqrLen=sn.squaredLength=sn.len=sn.length=sn.dot=sn.mul=sn.setReal=sn.getReal=void 0;var e=c(le()),r=c(Kt()),l=c(rn());function u(M){if(typeof WeakMap!="function")return null;var A=new WeakMap,D=new WeakMap;return(u=function(I){return I?D:A})(M)}function c(M,A){if(M&&M.__esModule)return M;if(M===null||s(M)!=="object"&&typeof M!="function")return{default:M};var D=u(A);if(D&&D.has(M))return D.get(M);var I={},B=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var U in M)if(U!=="default"&&Object.prototype.hasOwnProperty.call(M,U)){var G=B?Object.getOwnPropertyDescriptor(M,U):null;G&&(G.get||G.set)?Object.defineProperty(I,U,G):I[U]=M[U]}return I.default=M,D&&D.set(M,I),I}function f(M,A,D){var I=.5*D[0],B=.5*D[1],U=.5*D[2],G=A[0],H=A[1],q=A[2],Y=A[3];return M[0]=G,M[1]=H,M[2]=q,M[3]=Y,M[4]=I*Y+B*q-U*H,M[5]=B*Y+U*G-I*q,M[6]=U*Y+I*H-B*G,M[7]=-I*G-B*H-U*q,M}function x(M,A){return M[0]=A[0],M[1]=A[1],M[2]=A[2],M[3]=A[3],M[4]=A[4],M[5]=A[5],M[6]=A[6],M[7]=A[7],M}function S(M,A,D){var I=A[0],B=A[1],U=A[2],G=A[3],H=D[4],q=D[5],Y=D[6],J=D[7],ne=A[4],me=A[5],ce=A[6],ue=A[7],Ee=D[0],_e=D[1],De=D[2],Le=D[3];return M[0]=I*Le+G*Ee+B*De-U*_e,M[1]=B*Le+G*_e+U*Ee-I*De,M[2]=U*Le+G*De+I*_e-B*Ee,M[3]=G*Le-I*Ee-B*_e-U*De,M[4]=I*J+G*H+B*Y-U*q+ne*Le+ue*Ee+me*De-ce*_e,M[5]=B*J+G*q+U*H-I*Y+me*Le+ue*_e+ce*Ee-ne*De,M[6]=U*J+G*Y+I*q-B*H+ce*Le+ue*De+ne*_e-me*Ee,M[7]=G*J-I*H-B*q-U*Y+ue*Le-ne*Ee-me*_e-ce*De,M}sn.getReal=r.copy,sn.setReal=r.copy,sn.mul=S;var C=r.dot;sn.dot=C;var _=r.length;sn.length=_,sn.len=_;var E=r.squaredLength;return sn.squaredLength=E,sn.sqrLen=E,sn}var un,pn,Vt={};function ir(){if(un)return Vt;function s(A){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},s(A)}un=1,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.create=l,Vt.clone=function(A){var D=new e.ARRAY_TYPE(2);return D[0]=A[0],D[1]=A[1],D},Vt.fromValues=function(A,D){var I=new e.ARRAY_TYPE(2);return I[0]=A,I[1]=D,I},Vt.copy=function(A,D){return A[0]=D[0],A[1]=D[1],A},Vt.set=function(A,D,I){return A[0]=D,A[1]=I,A},Vt.add=function(A,D,I){return A[0]=D[0]+I[0],A[1]=D[1]+I[1],A},Vt.subtract=u,Vt.multiply=c,Vt.divide=f,Vt.ceil=function(A,D){return A[0]=Math.ceil(D[0]),A[1]=Math.ceil(D[1]),A},Vt.floor=function(A,D){return A[0]=Math.floor(D[0]),A[1]=Math.floor(D[1]),A},Vt.min=function(A,D,I){return A[0]=Math.min(D[0],I[0]),A[1]=Math.min(D[1],I[1]),A},Vt.max=function(A,D,I){return A[0]=Math.max(D[0],I[0]),A[1]=Math.max(D[1],I[1]),A},Vt.round=function(A,D){return A[0]=Math.round(D[0]),A[1]=Math.round(D[1]),A},Vt.scale=function(A,D,I){return A[0]=D[0]*I,A[1]=D[1]*I,A},Vt.scaleAndAdd=function(A,D,I,B){return A[0]=D[0]+I[0]*B,A[1]=D[1]+I[1]*B,A},Vt.distance=x,Vt.squaredDistance=S,Vt.length=C,Vt.squaredLength=_,Vt.negate=function(A,D){return A[0]=-D[0],A[1]=-D[1],A},Vt.inverse=function(A,D){return A[0]=1/D[0],A[1]=1/D[1],A},Vt.normalize=function(A,D){var I=D[0],B=D[1],U=I*I+B*B;return U>0&&(U=1/Math.sqrt(U)),A[0]=D[0]*U,A[1]=D[1]*U,A},Vt.dot=function(A,D){return A[0]*D[0]+A[1]*D[1]},Vt.cross=function(A,D,I){var B=D[0]*I[1]-D[1]*I[0];return A[0]=A[1]=0,A[2]=B,A},Vt.lerp=function(A,D,I,B){var U=D[0],G=D[1];return A[0]=U+B*(I[0]-U),A[1]=G+B*(I[1]-G),A},Vt.random=function(A,D){D=D||1;var I=2*e.RANDOM()*Math.PI;return A[0]=Math.cos(I)*D,A[1]=Math.sin(I)*D,A},Vt.transformMat2=function(A,D,I){var B=D[0],U=D[1];return A[0]=I[0]*B+I[2]*U,A[1]=I[1]*B+I[3]*U,A},Vt.transformMat2d=function(A,D,I){var B=D[0],U=D[1];return A[0]=I[0]*B+I[2]*U+I[4],A[1]=I[1]*B+I[3]*U+I[5],A},Vt.transformMat3=function(A,D,I){var B=D[0],U=D[1];return A[0]=I[0]*B+I[3]*U+I[6],A[1]=I[1]*B+I[4]*U+I[7],A},Vt.transformMat4=function(A,D,I){var B=D[0],U=D[1];return A[0]=I[0]*B+I[4]*U+I[12],A[1]=I[1]*B+I[5]*U+I[13],A},Vt.rotate=function(A,D,I,B){var U=D[0]-I[0],G=D[1]-I[1],H=Math.sin(B),q=Math.cos(B);return A[0]=U*q-G*H+I[0],A[1]=U*H+G*q+I[1],A},Vt.angle=function(A,D){var I=A[0],B=A[1],U=D[0],G=D[1],H=Math.sqrt(I*I+B*B)*Math.sqrt(U*U+G*G);return Math.acos(Math.min(Math.max(H&&(I*U+B*G)/H,-1),1))},Vt.zero=function(A){return A[0]=0,A[1]=0,A},Vt.str=function(A){return"vec2("+A[0]+", "+A[1]+")"},Vt.exactEquals=function(A,D){return A[0]===D[0]&&A[1]===D[1]},Vt.equals=function(A,D){var I=A[0],B=A[1],U=D[0],G=D[1];return Math.abs(I-U)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(U))&&Math.abs(B-G)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(G))},Vt.forEach=Vt.sqrLen=Vt.sqrDist=Vt.dist=Vt.div=Vt.mul=Vt.sub=Vt.len=void 0;var e=function(A,D){if(A&&A.__esModule)return A;if(A===null||s(A)!=="object"&&typeof A!="function")return{default:A};var I=r(void 0);if(I&&I.has(A))return I.get(A);var B={},U=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var G in A)if(G!=="default"&&Object.prototype.hasOwnProperty.call(A,G)){var H=U?Object.getOwnPropertyDescriptor(A,G):null;H&&(H.get||H.set)?Object.defineProperty(B,G,H):B[G]=A[G]}return B.default=A,I&&I.set(A,B),B}(le());function r(A){if(typeof WeakMap!="function")return null;var D=new WeakMap,I=new WeakMap;return(r=function(B){return B?I:D})(A)}function l(){var A=new e.ARRAY_TYPE(2);return e.ARRAY_TYPE!=Float32Array&&(A[0]=0,A[1]=0),A}function u(A,D,I){return A[0]=D[0]-I[0],A[1]=D[1]-I[1],A}function c(A,D,I){return A[0]=D[0]*I[0],A[1]=D[1]*I[1],A}function f(A,D,I){return A[0]=D[0]/I[0],A[1]=D[1]/I[1],A}function x(A,D){return Math.hypot(D[0]-A[0],D[1]-A[1])}function S(A,D){var I=D[0]-A[0],B=D[1]-A[1];return I*I+B*B}function C(A){return Math.hypot(A[0],A[1])}function _(A){var D=A[0],I=A[1];return D*D+I*I}Vt.len=C,Vt.sub=u,Vt.mul=c,Vt.div=f,Vt.dist=x,Vt.sqrDist=S,Vt.sqrLen=_;var E,M=(E=l(),function(A,D,I,B,U,G){var H,q;for(D||(D=2),I||(I=0),q=B?Math.min(B*D+I,A.length):A.length,H=I;H<q;H+=D)E[0]=A[H],E[1]=A[H+1],U(E,E,G),A[H]=E[0],A[H+1]=E[1];return A});return Vt.forEach=M,Vt}function Nr(){if(pn)return fe;function s(A){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},s(A)}pn=1,Object.defineProperty(fe,"__esModule",{value:!0}),fe.vec4=fe.vec3=fe.vec2=fe.quat2=fe.quat=fe.mat4=fe.mat3=fe.mat2d=fe.mat2=fe.glMatrix=void 0;var e=M(le());fe.glMatrix=e;var r=M(Ue());fe.mat2=r;var l=M(Tt());fe.mat2d=l;var u=M(Xt());fe.mat3=u;var c=M(rn());fe.mat4=c;var f=M(Kt());fe.quat=f;var x=M(tt());fe.quat2=x;var S=M(ir());fe.vec2=S;var C=M(ln());fe.vec3=C;var _=M(Nt());function E(A){if(typeof WeakMap!="function")return null;var D=new WeakMap,I=new WeakMap;return(E=function(B){return B?I:D})(A)}function M(A,D){if(A&&A.__esModule)return A;if(A===null||s(A)!=="object"&&typeof A!="function")return{default:A};var I=E(D);if(I&&I.has(A))return I.get(A);var B={},U=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var G in A)if(G!=="default"&&Object.prototype.hasOwnProperty.call(A,G)){var H=U?Object.getOwnPropertyDescriptor(A,G):null;H&&(H.get||H.set)?Object.defineProperty(B,G,H):B[G]=A[G]}return B.default=A,I&&I.set(A,B),B}return fe.vec4=_,fe}var rr,kr,sr,Yr,de=Nr(),po=function(){if(kr)return rr;function s(e,r,l,u){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(u-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=l,this.p2y=u}return kr=1,rr=s,s.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,u=0;u<8;u++){var c=this.sampleCurveX(l)-e;if(Math.abs(c)<r)return l;var f=this.sampleCurveDerivativeX(l);if(Math.abs(f)<1e-6)break;l-=c/f}var x=0,S=1;for(l=e,u=0;u<20&&(c=this.sampleCurveX(l),!(Math.abs(c-e)<r));u++)e>c?x=l:S=l,l=.5*(S-x)+x;return l},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},rr}(),Uo=ee(po);function ls(){if(Yr)return sr;function s(e,r){this.x=e,this.y=r}return Yr=1,sr=s,s.prototype={clone:function(){return new s(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,r){return this.clone()._rotateAround(e,r)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var r=e.x-this.x,l=e.y-this.y;return r*r+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,r){return Math.atan2(this.x*r-this.y*e,this.x*e+this.y*r)},_matMult:function(e){var r=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=r,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var r=Math.cos(e),l=Math.sin(e),u=l*this.x+r*this.y;return this.x=r*this.x-l*this.y,this.y=u,this},_rotateAround:function(e,r){var l=Math.cos(e),u=Math.sin(e),c=r.y+u*(this.x-r.x)+l*(this.y-r.y);return this.x=r.x+l*(this.x-r.x)-u*(this.y-r.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},s.convert=function(e){return e instanceof s?e:Array.isArray(e)?new s(e[0],e[1]):e},sr}var qt=ee(ls());function cs(s,e){if(Array.isArray(s)){if(!Array.isArray(e)||s.length!==e.length)return!1;for(let r=0;r<s.length;r++)if(!cs(s[r],e[r]))return!1;return!0}if(typeof s=="object"&&s!==null&&e!==null){if(typeof e!="object"||Object.keys(s).length!==Object.keys(e).length)return!1;for(const r in s)if(!cs(s[r],e[r]))return!1;return!0}return s===e}const ti=Math.PI/180,Do=180/Math.PI;function Jn(s){return s*ti}function Wi(s){return s*Do}const dr=[[0,0],[1,0],[1,1],[0,1]];function ea(s){if(s<=0)return 0;if(s>=1)return 1;const e=s*s,r=e*s;return 4*(s<.5?r:3*(s-e)+r-.75)}function Rs(s,e,r,l){const u=new Uo(s,e,r,l);return function(c){return u.solve(c)}}const ta=Rs(.25,.1,.25,1);function $n(s,e,r){return Math.min(r,Math.max(e,s))}function mo(s,e,r){return(r=$n((r-s)/(e-s),0,1))*r*(3-2*r)}function Fa(s,e,r){const l=r-e,u=((s-e)%l+l)%l+e;return u===e?r:u}function Ua(s,e,r){if(!s.length)return r(null,[]);let l=s.length;const u=new Array(s.length);let c=null;s.forEach((f,x)=>{e(f,(S,C)=>{S&&(c=S),u[x]=C,--l==0&&r(c,u)})})}function ao(s,...e){for(const r of e)for(const l in r)s[l]=r[l];return s}let na=1;function us(){return na++}function lc(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function bl(s,e){s.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function ks(s,e,r){const l={};for(const u in s)l[u]=e.call(this,s[u],u,s);return l}function jo(s,e,r){const l={};for(const u in s)e.call(this,s[u],u,s)&&(l[u]=s[u]);return l}function qi(s){return Array.isArray(s)?s.map(qi):typeof s=="object"&&s?ks(s,qi):s}const ra={};function xe(s){ra[s]||(typeof console<"u"&&console.warn(s),ra[s]=!0)}function it(s,e,r){return(r.y-s.y)*(e.x-s.x)>(e.y-s.y)*(r.x-s.x)}function yn(s){let e=0;for(let r,l,u=0,c=s.length,f=c-1;u<c;f=u++)r=s[u],l=s[f],e+=(l.x-r.x)*(r.y+l.y);return e}function Sn([s,e,r]){const l=Jn(e+90),u=Jn(r);return{x:s*Math.cos(l)*Math.sin(u),y:s*Math.sin(l)*Math.sin(u),z:s*Math.cos(u),azimuthal:e,polar:r}}function kn(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function br(s){const e={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,l,u,c)=>{const f=u||c;return e[l]=!f||f.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let wr=null;function Br(s,e){return[s[4*e],s[4*e+1],s[4*e+2],s[4*e+3]]}function Er(s,e,r,l){for(;e<r;){const u=e+r>>1;s[u]<l?e=u+1:r=u}return e}function no(s,e,r,l){for(;e<r;){const u=e+r>>1;s[u]<=l?e=u+1:r=u}return e}function ia(s){return s>0?1/(1.001-s):1+s}function ut(s){return s>0?1-1/(1.001-s):-s}const ie={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!ie.API_URL)return null;try{const s=new URL(ie.API_URL);return s.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":s.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function ae(s){return ie.API_URL_REGEX.test(s)}function we(s){return ie.API_SPRITE_REGEX.test(s)}let Oe,Ie,je,rt,$e,at;function Ye(){return Oe==null&&(Oe=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Oe}const ct={now:()=>rt!==void 0?rt:performance.now(),setNow(s){rt=s},restoreNow(){rt=void 0},frame(s){const e=requestAnimationFrame(s);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(s,e=0){const{width:r,height:l}=s;$e||($e=document.createElement("canvas"));const u=$e.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(r>$e.width||l>$e.height)&&($e.width=r,$e.height=l),u.clearRect(-e,-e,r+2*e,l+2*e),u.drawImage(s,0,0,r,l),u.getImageData(-e,-e,r+2*e,l+2*e)},resolveURL:s=>(Ie||(Ie=document.createElement("a")),Ie.href=s,Ie.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(je==null&&(je=window.matchMedia("(prefers-reduced-motion: reduce)")),je.matches)},hasCanvasFingerprintNoise(){if(at!==void 0)return at;if(!Ye())return at=!1,!1;const s=new OffscreenCanvas(85,1),e=s.getContext("2d",{willReadFrequently:!0});let r=0;for(let u=0;u<s.width;++u)e.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,e.fillRect(u,0,1,1);const l=e.getImageData(0,0,s.width,s.height);r=0;for(let u=0;u<l.data.length;++u)if(u%4!=3&&r++!==l.data[u])return at=!0,!0;return at=!1,!1}};function At(s,e){const r=s.indexOf("?");if(r<0)return`${s}?${new URLSearchParams(e).toString()}`;const l=new URLSearchParams(s.slice(r));for(const u in e)l.set(u,e[u]);return`${s.slice(0,r)}?${l.toString()}`}function Qt(s,e={persistentParams:[]}){const r=s.indexOf("?");if(r<0)return s;const l=new URLSearchParams,u=new URLSearchParams(s.slice(r));for(const f of e.persistentParams){const x=u.get(f);x&&l.set(f,x)}const c=l.toString();return`${s.slice(0,r)}${c.length>0?`?${c}`:""}`}const on="mapbox-tiles";let Nn=500,jn=50;const Un=["language","worldview","jobid"];let zn,Wr;function si(){try{return caches}catch{}}function Qn(){const s=si();s&&zn==null&&(zn=s.open(on))}let Ar=1/0;const Rr={supported:!1,testSupport:function(s){!ro&&fi&&(Mo?Vo(s):Or=s)}};let Or,fi,ro=!1,Mo=!1;const oa=typeof self<"u"?self:{};function Vo(s){const e=s.createTexture();s.bindTexture(s.TEXTURE_2D,e);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,fi),s.isContextLost())return;Rr.supported=!0}catch{}s.deleteTexture(e),ro=!0}oa.document&&(fi=oa.document.createElement("img"),fi.onload=function(){Or&&Vo(Or),Or=null,Mo=!0},fi.onerror=function(){ro=!0,Or=null},fi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const io={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(io);class pi extends Error{constructor(e,r,l){r===401&&ae(l)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ja=kn()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Ro=function(s,e){if(!(/^file:/.test(r=s.url)||/^file:/.test(ja())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(l,u){const c=new AbortController,f=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:ja(),referrerPolicy:l.referrerPolicy,signal:c.signal});let x=!1,S=!1;const C=(_=f.url).indexOf("sku=")>0&&ae(_);var _;l.type==="json"&&f.headers.set("Accept","application/json");const E=(A,D,I)=>{if(S)return;if(A&&A.message!=="SecurityError"&&xe(A.toString()),D&&I)return M(D);const B=Date.now();fetch(f).then(U=>{if(U.ok){const G=C?U.clone():null;return M(U,G,B)}return u(new pi(U.statusText,U.status,l.url))}).catch(U=>{U.name!=="AbortError"&&u(new Error(`${U.message} ${l.url}`))})},M=(A,D,I)=>{(l.type==="arrayBuffer"?A.arrayBuffer():l.type==="json"?A.json():A.text()).then(B=>{S||(D&&I&&function(U,G,H){if(Qn(),zn==null)return;const q=br(G.headers.get("Cache-Control")||"");if(q["no-store"])return;const Y={status:G.status,statusText:G.statusText,headers:new Headers};G.headers.forEach((me,ce)=>Y.headers.set(ce,me)),q["max-age"]&&Y.headers.set("Expires",new Date(H+1e3*q["max-age"]).toUTCString());const J=Y.headers.get("Expires");if(!J||new Date(J).getTime()-H<42e4)return;let ne=Qt(U.url,{persistentParams:Un});if(G.status===206){const me=U.headers.get("Range");if(!me)return;Y.status=200,ne=At(ne,{range:me})}(function(me,ce){if(Wr===void 0)try{new Response(new ReadableStream),Wr=!0}catch{Wr=!1}Wr?ce(me.body):me.blob().then(ce)})(G,me=>{const ce=new Response((ue=G.status)!==200&&ue!==404&&[101,103,204,205,304].includes(ue)?null:me,Y);var ue;Qn(),zn!=null&&zn.then(Ee=>Ee.put(ne,ce)).catch(Ee=>xe(Ee.message))})}(f,D,I),x=!0,u(null,B,A.headers.get("Cache-Control"),A.headers.get("Expires")))}).catch(B=>{S||u(new Error(B.message))})};return C?function(A,D){if(Qn(),zn==null)return D(null);zn.then(I=>{let B=Qt(A.url,{persistentParams:Un});const U=A.headers.get("Range");U&&(B=At(B,{range:U})),I.match(B).then(G=>{const H=function(q){if(!q)return!1;const Y=new Date(q.headers.get("Expires")||0),J=br(q.headers.get("Cache-Control")||"");return Y>Date.now()&&!J["no-cache"]}(G);I.delete(B),H&&I.put(B,G.clone()),D(null,G,H)}).catch(D)}).catch(D)}(f,E):E(null,null),{cancel:()=>{S=!0,x||c.abort()}}}(s,e);if(kn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,e,void 0,!0)}var r;return function(l,u){const c=new XMLHttpRequest;c.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(c.responseType="arraybuffer");for(const f in l.headers)c.setRequestHeader(f,l.headers[f]);return l.type==="json"&&(c.responseType="text",c.setRequestHeader("Accept","application/json")),c.withCredentials=l.credentials==="include",c.onerror=()=>{u(new Error(c.statusText))},c.onload=()=>{if((c.status>=200&&c.status<300||c.status===0)&&c.response!==null){let f=c.response;if(l.type==="json")try{f=JSON.parse(c.response)}catch(x){return u(x)}u(null,f,c.getResponseHeader("Cache-Control"),c.getResponseHeader("Expires"))}else u(new pi(c.statusText,c.status,l.url))},c.send(l.body),{cancel:()=>c.abort()}}(s,e)},Va=function(s,e){return Ro(ao(s,{type:"arrayBuffer"}),e)};function Eu(s){const e=document.createElement("a");return e.href=s,e.protocol===location.protocol&&e.host===location.host}const Au="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Cu,wl;Cu=[],wl=0;const jc=function(s,e){if(Rr.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),wl>=ie.MAX_PARALLEL_IMAGE_REQUESTS){const c={requestParameters:s,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Cu.push(c),c}wl++;let r=!1;const l=()=>{if(!r)for(r=!0,wl--;Cu.length&&wl<ie.MAX_PARALLEL_IMAGE_REQUESTS;){const c=Cu.shift(),{requestParameters:f,callback:x,cancelled:S}=c;S||(c.cancel=jc(f,x).cancel)}},u=Va(s,(c,f,x,S)=>{l(),c?e(c):f&&(self.createImageBitmap?function(C,_){const E=new Blob([new Uint8Array(C)],{type:"image/png"});createImageBitmap(E).then(M=>{_(null,M)}).catch(M=>{_(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(f,(C,_)=>e(C,_,x,S)):function(C,_){const E=new Image;E.onload=()=>{_(null,E),URL.revokeObjectURL(E.src),E.onload=null,requestAnimationFrame(()=>{E.src=Au})},E.onerror=()=>_(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const M=new Blob([new Uint8Array(C)],{type:"image/png"});E.src=C.byteLength?URL.createObjectURL(M):Au}(f,(C,_)=>e(C,_,x,S)))});return{cancel:()=>{u.cancel(),l()}}};var jp,_y,Dg,Du={exports:{}},ds={exports:{}},sa={exports:{}},cc=function(){if(Dg)return Du.exports;Dg=1;var s=(jp||(jp=1,ds.exports=function(r,l){var u,c,f,x,S,C,_,E;for(c=r.length-(u=3&r.length),f=l,S=3432918353,C=461845907,E=0;E<c;)_=255&r.charCodeAt(E)|(255&r.charCodeAt(++E))<<8|(255&r.charCodeAt(++E))<<16|(255&r.charCodeAt(++E))<<24,++E,f=27492+(65535&(x=5*(65535&(f=(f^=_=(65535&(_=(_=(65535&_)*S+(((_>>>16)*S&65535)<<16)&4294967295)<<15|_>>>17))*C+(((_>>>16)*C&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(_=0,u){case 3:_^=(255&r.charCodeAt(E+2))<<16;case 2:_^=(255&r.charCodeAt(E+1))<<8;case 1:f^=_=(65535&(_=(_=(65535&(_^=255&r.charCodeAt(E)))*S+(((_>>>16)*S&65535)<<16)&4294967295)<<15|_>>>17))*C+(((_>>>16)*C&65535)<<16)&4294967295}return f^=r.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}),ds.exports),e=(_y||(_y=1,sa.exports=function(r,l){for(var u,c=r.length,f=l^c,x=0;c>=4;)u=1540483477*(65535&(u=255&r.charCodeAt(x)|(255&r.charCodeAt(++x))<<8|(255&r.charCodeAt(++x))<<16|(255&r.charCodeAt(++x))<<24))+((1540483477*(u>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),c-=4,++x;switch(c){case 3:f^=(255&r.charCodeAt(x+2))<<16;case 2:f^=(255&r.charCodeAt(x+1))<<8;case 1:f=1540483477*(65535&(f^=255&r.charCodeAt(x)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}),sa.exports);return Du.exports=s,Du.exports.murmur3=s,Du.exports.murmur2=e,Du.exports}(),Os=ee(cc);class hs{constructor(e,...r){ao(this,r[0]||{}),this.type=e}}class qd extends hs{constructor(e,r={}){super("error",ao({error:e},r))}}function Vp(s,e,r){r[s]&&r[s].indexOf(e)!==-1||(r[s]=r[s]||[],r[s].push(e))}function Hd(s,e,r){if(r&&r[s]){const l=r[s].indexOf(e);l!==-1&&r[s].splice(l,1)}}class Is{on(e,r){return this._listeners=this._listeners||{},Vp(e,r,this._listeners),this}off(e,r){return Hd(e,r,this._listeners),Hd(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Vp(e,r,this._oneTimeListeners),this):new Promise(l=>{this.once(e,l)})}fire(e,r){const l=typeof e=="string"?new hs(e,r):e,u=l.type;if(this.listens(u)){l.target=this;const c=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const S of c)S.call(this,l);const f=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const S of f)Hd(u,S,this._oneTimeListeners),S.call(this,l);const x=this._eventedParent;x&&(ao(l,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(l))}else l instanceof qd&&console.error(l.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}class go{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new go(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[r,l]=e.split("");return new go({name:r,iconsetId:l})}static isEqual(e,r){return e.name===r.name&&e.iconsetId===r.iconsetId}toString(){return go.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var yy,qp={},aa=function(){if(yy)return qp;yy=1;var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(c){return(c=Math.round(c))<0?0:c>255?255:c}function r(c){return e(c[c.length-1]==="%"?parseFloat(c)/100*255:parseInt(c))}function l(c){return(f=c[c.length-1]==="%"?parseFloat(c)/100:parseFloat(c))<0?0:f>1?1:f;var f}function u(c,f,x){return x<0?x+=1:x>1&&(x-=1),6*x<1?c+(f-c)*x*6:2*x<1?f:3*x<2?c+(f-c)*(2/3-x)*6:c}try{qp.parseCSSColor=function(c){var f,x=c.replace(/ /g,"").toLowerCase();if(x in s)return s[x].slice();if(x[0]==="#")return x.length===4?(f=parseInt(x.substr(1),16))>=0&&f<=4095?[(3840&f)>>4|(3840&f)>>8,240&f|(240&f)>>4,15&f|(15&f)<<4,1]:null:x.length===7&&(f=parseInt(x.substr(1),16))>=0&&f<=16777215?[(16711680&f)>>16,(65280&f)>>8,255&f,1]:null;var S=x.indexOf("("),C=x.indexOf(")");if(S!==-1&&C+1===x.length){var _=x.substr(0,S),E=x.substr(S+1,C-(S+1)).split(","),M=1;switch(_){case"rgba":if(E.length!==4)return null;M=l(E.pop());case"rgb":return E.length!==3?null:[r(E[0]),r(E[1]),r(E[2]),M];case"hsla":if(E.length!==4)return null;M=l(E.pop());case"hsl":if(E.length!==3)return null;var A=(parseFloat(E[0])%360+360)%360/360,D=l(E[1]),I=l(E[2]),B=I<=.5?I*(D+1):I+D-I*D,U=2*I-B;return[e(255*u(U,B,A+1/3)),e(255*u(U,B,A)),e(255*u(U,B,A-1/3)),M];default:return null}}return null}}catch{}return qp}();class gr{constructor(e,r,l,u=1){this.r=e,this.g=r,this.b=l,this.a=u}static parse(e){if(!e)return;if(e instanceof gr)return e;if(typeof e!="string")return;const r=aa.parseCSSColor(e);return r?new gr(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toStringPremultipliedAlpha(){const[e,r,l,u]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(l)},${u})`}toString(){const[e,r,l,u]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*r)},${Math.round(255*l)},${u})`}toRenderColor(e){const{r,g:l,b:u,a:c}=this;return new Hp(e,r,l,u,c)}clone(){return new gr(this.r,this.g,this.b,this.a)}}class Hp{constructor(e,r,l,u,c){if(e){const f=e.image.height,x=f*f;r=c===0?0:r/c*(f-1),l=c===0?0:l/c*(f-1),u=c===0?0:u/c*(f-1);const S=Math.floor(r),C=Math.floor(l),_=Math.floor(u),E=Math.ceil(r),M=Math.ceil(l),A=Math.ceil(u),D=r-S,I=l-C,B=u-_,U=e.image.data,G=4*(S+C*x+_*f),H=4*(S+C*x+A*f),q=4*(S+M*x+_*f),Y=4*(S+M*x+A*f),J=4*(E+C*x+_*f),ne=4*(E+C*x+A*f),me=4*(E+M*x+_*f),ce=4*(E+M*x+A*f);if(G<0||ce>=U.length)throw new Error("out of range");this.r=En(En(En(U[G],U[H],B),En(U[q],U[Y],B),I),En(En(U[J],U[ne],B),En(U[me],U[ce],B),I),D)/255*c,this.g=En(En(En(U[G+1],U[H+1],B),En(U[q+1],U[Y+1],B),I),En(En(U[J+1],U[ne+1],B),En(U[me+1],U[ce+1],B),I),D)/255*c,this.b=En(En(En(U[G+2],U[H+2],B),En(U[q+2],U[Y+2],B),I),En(En(U[J+2],U[ne+2],B),En(U[me+2],U[ce+2],B),I),D)/255*c,this.a=c}else this.r=r,this.g=l,this.b=u,this.a=c}toArray(){const{r:e,g:r,b:l,a:u}=this;return u===0?[0,0,0,0]:[255*e/u,255*r/u,255*l/u,u]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:e,g:r,b:l,a:u}=this,c=Math.min(Math.max(e/u,0),1),f=Math.min(Math.max(r/u,0),1),x=Math.min(Math.max(l/u,0),1),S=Math.min(c,f,x),C=Math.max(c,f,x),_=(S+C)/2;if(S===C)return[0,0,100*_,u];const E=C-S,M=_>.5?E/(2-C-S):E/(C+S);let A=0;return C===c?A=(f-x)/E+(f<x?6:0):C===f?A=(x-c)/E+2:C===x&&(A=(c-f)/E+4),A*=60,[Math.min(Math.max(A,0),360),Math.min(Math.max(100*M,0),100),Math.min(Math.max(100*_,0),100),u]}toArray01(){const{r:e,g:r,b:l,a:u}=this;return u===0?[0,0,0,0]:[e/u,r/u,l/u,u]}toArray01Scaled(e){const{r,g:l,b:u,a:c}=this;return c===0?[0,0,0]:[r/c*e,l/c*e,u/c*e]}toArray01PremultipliedAlpha(){const{r:e,g:r,b:l,a:u}=this;return[e,r,l,u]}toArray01Linear(){const{r:e,g:r,b:l,a:u}=this;return u===0?[0,0,0,0]:[Math.pow(e/u,2.2),Math.pow(r/u,2.2),Math.pow(l/u,2.2),u]}}function En(s,e,r){return s*(1-r)+e*r}function vy(s,e,r){return s.map((l,u)=>En(l,e[u],r))}function xy(s){return s*s*s*s*s}gr.black=new gr(0,0,0,1),gr.white=new gr(1,1,1,1),gr.transparent=new gr(0,0,0,0),gr.red=new gr(1,0,0,1),gr.blue=new gr(0,0,1,1);var uf=Object.freeze({__proto__:null,array:vy,color:function(s,e,r){return new gr(En(s.r,e.r,r),En(s.g,e.g,r),En(s.b,e.b,r),En(s.a,e.a,r))},easeIn:xy,number:En});function or(s,...e){for(const r of e)for(const l in r)s[l]=r[l];return s}class Ns extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class df{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[l,u]of r)this.bindings[l]=u}concat(e){return new df(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Mu={kind:"null"},dn={kind:"number"},Cr={kind:"string"},cr={kind:"boolean"},lo={kind:"color"},Ru={kind:"object"},Wn={kind:"value"},uc={kind:"collator"},ku={kind:"formatted"},Sl={kind:"resolvedImage"};function _o(s,e){return{kind:"array",itemType:s,N:e}}function Ii(s){if(s.kind==="array"){const e=Ii(s.itemType);return typeof s.N=="number"?`array<${e}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${e}>`}return s.kind}const qa=[Mu,dn,Cr,cr,lo,ku,Ru,_o(Wn),Sl];function Ou(s,e){if(e.kind==="error")return null;if(s.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Ou(s.itemType,e.itemType))&&(typeof s.N!="number"||s.N===e.N))return null}else{if(s.kind===e.kind)return null;if(s.kind==="value"){for(const r of qa)if(!Ou(r,e))return null}}return`Expected ${Ii(s)} but found ${Ii(e)} instead.`}function Mg(s,e){return e.some(r=>r.kind===s.kind)}function Iu(s,e){return e.some(r=>r==="null"?s===null:r==="array"?Array.isArray(s):r==="object"?s&&!Array.isArray(s)&&typeof s=="object":r===typeof s)}class Gp{constructor(e,r,l){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Vc{constructor(e,r,l,u,c){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=l,this.fontStack=u,this.textColor=c}}class ko{constructor(e){this.sections=e}static fromString(e){return new ko([new Vc(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof ko?e:ko.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){const u=r.image.getPrimary().id.toString();e.push(["image",u]);continue}e.push(r.text);const l={};r.fontStack&&(l["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(l["font-scale"]=r.scale),r.textColor&&(l["text-color"]=["rgba"].concat(r.textColor.toRenderColor(null).toArray())),e.push(l)}return e}}class Ha{constructor(e,r={}){if(this.id=go.from(e),this.options=Object.assign({},r),r.transform){const{a:l,b:u,c,d:f,e:x,f:S}=r.transform;this.options.transform=new DOMMatrix([l,u,c,f,x,S])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:r,c:l,d:u,e:c,f}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:r,c:l,d:u,e:c,f}})}static parse(e){let r,l,u,c;try{({name:r,iconsetId:l,params:u,transform:c}=JSON.parse(e)||{})}catch{return null}if(!r)return null;const{a:f,b:x,c:S,d:C,e:_,f:E}=c||{};return new Ha({name:r,iconsetId:l},{params:u,transform:new DOMMatrix([f,x,S,C,_,E])})}scaleSelf(e){return this.options.transform.scaleSelf(e),this}}class Oo{constructor(e,r,l,u,c=!1){this.primaryId=go.from(e),this.primaryOptions=r,l&&(this.secondaryId=go.from(l)),this.secondaryOptions=u,this.available=c}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Ha(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Ha(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?Oo.build({name:e}):e}static build(e,r,l,u){return!e||typeof e=="object"&&!("name"in e)?null:new Oo(e,l,r,u)}}function hf(s,e,r,l){return typeof s=="number"&&s>=0&&s<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[s,e,r,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[s,e,r,l]:[s,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ga(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof gr||s instanceof Gp||s instanceof ko||s instanceof Oo)return!0;if(Array.isArray(s)){for(const e of s)if(!Ga(e))return!1;return!0}if(typeof s=="object"){for(const e in s)if(!Ga(s[e]))return!1;return!0}return!1}function Hi(s){if(s===null)return Mu;if(typeof s=="string")return Cr;if(typeof s=="boolean")return cr;if(typeof s=="number")return dn;if(s instanceof gr)return lo;if(s instanceof Gp)return uc;if(s instanceof ko)return ku;if(s instanceof Oo)return Sl;if(Array.isArray(s)){const e=s.length;let r;for(const l of s){const u=Hi(l);if(r){if(r===u)continue;r=Wn;break}r=u}return _o(r||Wn,e)}return Ru}function co(s){const e=typeof s;return s===null?"":e==="string"||e==="number"||e==="boolean"?String(s):s instanceof gr?s.toStringPremultipliedAlpha():s instanceof ko||s instanceof Oo?s.toString():JSON.stringify(s)}class dc{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ga(e[1]))return r.error("invalid value");const l=e[1];let u=Hi(l);const c=r.expectedType;return u.kind!=="array"||u.N!==0||!c||c.kind!=="array"||typeof c.N=="number"&&c.N!==0||(u=c),new dc(u,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof gr?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof ko?this.value.serialize():this.value}}class wi{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const $p={string:Cr,number:dn,boolean:cr,object:Ru};class zs{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let l,u=1;const c=e[0];if(c==="array"){let x,S;if(e.length>2){const C=e[1];if(typeof C!="string"||!(C in $p)||C==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);x=$p[C],u++}else x=Wn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);S=e[2],u++}l=_o(x,S)}else l=$p[c];const f=[];for(;u<e.length;u++){const x=r.parse(e[u],u,Wn);if(!x)return null;f.push(x)}return new zs(l,f)}evaluate(e){for(let r=0;r<this.args.length;r++){const l=this.args[r].evaluate(e);if(!Ou(this.type,Hi(l)))return l;if(r===this.args.length-1)throw new wi(`The expression ${JSON.stringify(this.args[r].serialize())} evaluated to ${Ii(Hi(l))} but was expected to be of type ${Ii(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const l=e.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){r.push(l.kind);const u=e.N;(typeof u=="number"||this.args.length>1)&&r.push(u)}}return r.concat(this.args.map(l=>l.serialize()))}}class Nu{constructor(e){this.type=ku,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return r.error("First argument must be an image or text section.");const u=[];let c=!1;for(let f=1;f<=e.length-1;++f){const x=e[f];if(c&&typeof x=="object"&&!Array.isArray(x)){c=!1;let S=null;if(x["font-scale"]&&(S=r.parseObjectValue(x["font-scale"],f,"font-scale",dn),!S))return null;let C=null;if(x["text-font"]&&(C=r.parseObjectValue(x["text-font"],f,"text-font",_o(Cr)),!C))return null;let _=null;if(x["text-color"]&&(_=r.parseObjectValue(x["text-color"],f,"text-color",lo),!_))return null;const E=u[u.length-1];E.scale=S,E.font=C,E.textColor=_}else{const S=r.parse(e[f],f,Wn);if(!S)return null;const C=S.type.kind;if(C!=="string"&&C!=="value"&&C!=="null"&&C!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");c=!0,u.push({content:S,scale:null,font:null,textColor:null})}}return new Nu(u)}evaluate(e){return new ko(this.sections.map(r=>{const l=r.content.evaluate(e);return Hi(l)===Sl?new Vc("",l,null,null,null):new Vc(co(l),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const l={};r.scale&&(l["font-scale"]=r.scale.serialize()),r.font&&(l["text-font"]=r.font.serialize()),r.textColor&&(l["text-color"]=r.textColor.serialize()),e.push(l)}return e}}class hc{constructor(e,r,l,u){this._imageWarnHistory={},this.type=Sl,this.namePrimary=e,this.nameSecondary=r,l&&(this.paramsPrimary=l.params,this.iconsetIdPrimary=l.iconset?l.iconset.id:void 0),u&&(this.paramsSecondary=u.params,this.iconsetIdSecondary=u.iconset?u.iconset.id:void 0)}static parse(e,r){if(e.length<2)return r.error("Expected two or more arguments.");let l=1;const u=[];function c(){if(l<e.length){const x=r.parse(e[l],l++,Cr);return x?(u.push({image:x,options:{}}),!0):(r.error(u.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function f(){if(l<e.length){const S=e[l];if((x=S)===null||typeof x!="object"||Array.isArray(x))return!0;const C=S.params,_=S.iconset,E=r.concat(l);if(!C&&!_)return l++,!0;if(C){if(typeof C!="object"||C.constructor!==Object)return E.error('Image options "params" should be an object'),!1;const M={},A=E.concat(void 0,"params");for(const D in C){if(!D)return A.error("Image parameter name should be non-empty"),!1;const I=A.concat(void 0,D).parse(C[D],void 0,lo,void 0,{typeAnnotation:"coerce"});if(!I)return!1;M[D]=I}u[u.length-1].options.params=M}if(_){if(typeof _!="object"||_.constructor!==Object)return E.error('Image options "iconset" should be an object'),!1;if(!_.id)return E.error('Image options "iconset" should have an "id" property'),!1;u[u.length-1].options.iconset=_}return l++,!0}var x;return!0}for(let x=0;x<2;x++)if(!c()||!f())return;return new hc(u[0].image,u[1]?u[1].image:void 0,u[0].options,u[1]?u[1].options:void 0)}evaluateParams(e,r){const l={};if(r){for(const u in r)if(r[u])try{l[u]=r[u].evaluate(e)}catch{continue}if(Object.keys(l).length!==0)return{params:l}}}evaluate(e){const r={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},l=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,u=Oo.build(r,l,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(u&&e.availableImages){const c=u.getPrimary().id;if(u.available=e.availableImages.some(f=>go.isEqual(f,c)),u.available){const f=u.getSecondary()?u.getSecondary().id:null;f&&(u.available=e.availableImages.some(x=>go.isEqual(x,f)))}}return u}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const r in this.paramsPrimary)this.paramsPrimary[r]&&e(this.paramsPrimary[r]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const r in this.paramsSecondary)this.paramsSecondary[r]&&e(this.paramsSecondary[r])}outputDefined(){return!1}serializeOptions(e,r){const l={};if(r&&(l.iconset={id:r}),e){l.params={};for(const u in e)e[u]&&(l.params[u]=e[u].serialize())}return Object.keys(l).length>0?l:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const r=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);r&&e.push(r)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const r=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);r&&e.push(r)}return e}}function $a(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}const by={"to-boolean":cr,"to-color":lo,"to-number":dn,"to-string":Cr};class fs{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const l=e[0],u=[];let c=Mu;if(l==="to-array"){if(!Array.isArray(e[1]))return null;const f=e[1].length;if(r.expectedType){if(r.expectedType.kind!=="array")return r.error(`Expected ${r.expectedType.kind} but found array.`);c=_o(r.expectedType.itemType,f)}else{if(!(f>0&&Ga(e[1][0])))return null;c=_o(Hi(e[1][0]),f)}for(let x=0;x<f;x++){const S=e[1][x];let C;if($a(S)==="array")C=r.parse(S,void 0,c.itemType);else{const _=$a(S);if(_!==c.itemType.kind)return r.error(`Expected ${c.itemType.kind} but found ${_}.`);C=r.registry.literal.parse(["literal",S===void 0?null:S],r)}if(!C)return null;u.push(C)}}else{if((l==="to-boolean"||l==="to-string")&&e.length!==2)return r.error("Expected one argument.");c=by[l];for(let f=1;f<e.length;f++){const x=r.parse(e[f],f,Wn);if(!x)return null;u.push(x)}}return new fs(c,u)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,l;for(const u of this.args){if(r=u.evaluate(e),l=null,r instanceof gr)return r;if(typeof r=="string"){const c=e.parseColor(r);if(c)return c}else if(Array.isArray(r)&&(l=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:hf(r[0],r[1],r[2],r[3]),!l))return new gr(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new wi(l||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const l of this.args){if(r=l.evaluate(e),r===null)return 0;const u=Number(r);if(!isNaN(u))return u}throw new wi(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?ko.fromString(co(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Oo.build(co(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(r=>r.evaluate(e)):co(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Nu([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new hc(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}const zu=["Unknown","Point","LineString","Polygon"];class Ps{constructor(e,r){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=r}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?zu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:l,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*r-e[0])+this.featureDistanceData.bearing[1]*(u*r-e[1])}return 0}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=gr.parse(e)),r}getConfig(e){return this.options?this.options.get(e):null}}class Ci{constructor(e,r,l,u,c){this.name=e,this.type=r,this._evaluate=l,this.args=u,this._overloadIndex=c}evaluate(e){if(!this._evaluate){const r=Ci.definitions[this.name];this._evaluate=Array.isArray(r)?r[2]:r.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const l=e[0],u=Ci.definitions[l];if(!u)return r.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const c=Array.isArray(u)?u[0]:u.type,f=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,x=[];let S=null,C=-1;for(const[_,E]of f){if(Array.isArray(_)&&_.length!==e.length-1)continue;x.push(_),C++,S=new Ol(r.registry,r.path,null,r.scope,void 0,r._scope,r.options);const M=[];let A=!1;for(let D=1;D<e.length;D++){const I=e[D],B=Array.isArray(_)?_[D-1]:_.type,U=S.parse(I,1+M.length,B);if(!U){A=!0;break}M.push(U)}if(!A)if(Array.isArray(_)&&_.length!==M.length)S.error(`Expected ${_.length} arguments, but found ${M.length} instead.`);else{for(let D=0;D<M.length;D++){const I=Array.isArray(_)?_[D]:_.type,B=M[D];S.concat(D+1).checkSubtype(I,B.type)}if(S.errors.length===0)return new Ci(l,c,E,M,C)}}if(x.length===1)r.errors.push(...S.errors);else{const _=(x.length?x:f.map(([M])=>M)).map(Zp).join(" | "),E=[];for(let M=1;M<e.length;M++){const A=r.parse(e[M],1+E.length);if(!A)return null;E.push(Ii(A.type))}r.error(`Expected arguments of type ${_}, but found (${E.join(", ")}) instead.`)}return null}static register(e,r){Ci.definitions=r;for(const l in r)e[l]=Ci}}function Zp(s){return Array.isArray(s)?`(${s.map(Ii).join(", ")})`:`(${Ii(s.type)}...)`}class Tl{constructor(e,r,l){this.type=uc,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return r.error("Collator options argument must be an object.");const u=l["case-sensitive"]===void 0?r.parse(!1,1,cr):r.parseObjectValue(l["case-sensitive"],1,"case-sensitive",cr);if(!u)return null;const c=l["diacritic-sensitive"]===void 0?r.parse(!1,1,cr):r.parseObjectValue(l["diacritic-sensitive"],1,"diacritic-sensitive",cr);if(!c)return null;let f=null;return l.locale&&(f=r.parseObjectValue(l.locale,1,"locale",Cr),!f)?null:new Tl(u,c,f)}evaluate(e){return new Gp(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Yp(s,e,r=0,l=s.length-1,u=wy){for(;l>r;){if(l-r>600){const S=l-r+1,C=e-r+1,_=Math.log(S),E=.5*Math.exp(2*_/3),M=.5*Math.sqrt(_*E*(S-E)/S)*(C-S/2<0?-1:1);Yp(s,e,Math.max(r,Math.floor(e-C*E/S+M)),Math.min(l,Math.floor(e+(S-C)*E/S+M)),u)}const c=s[e];let f=r,x=l;for(Io(s,r,e),u(s[l],c)>0&&Io(s,r,l);f<x;){for(Io(s,f,x),f++,x--;u(s[f],c)<0;)f++;for(;u(s[x],c)>0;)x--}u(s[r],c)===0?Io(s,r,x):(x++,Io(s,x,l)),x<=e&&(r=x+1),e<=x&&(l=x-1)}}function Io(s,e,r){const l=s[e];s[e]=s[r],s[r]=l}function wy(s,e){return s<e?-1:s>e?1:0}function Wp(s){let e=0;for(let r,l,u=0,c=s.length,f=c-1;u<c;f=u++)r=s[u],l=s[f],e+=(l.x-r.x)*(r.y+l.y);return e}function Za(s,e){s[0]=Math.min(s[0],e[0]),s[1]=Math.min(s[1],e[1]),s[2]=Math.max(s[2],e[0]),s[3]=Math.max(s[3],e[1])}function Pu(s,e){return!(s[0]<=e[0]||s[2]>=e[2]||s[1]<=e[1]||s[3]>=e[3])}function Sy(s,e,r){const l=s[0]-e[0],u=s[1]-e[1],c=s[0]-r[0],f=s[1]-r[1];return l*f-c*u==0&&l*c<=0&&u*f<=0}function qc(s,e,r=!1){let l=!1;for(let x=0,S=e.length;x<S;x++){const C=e[x];for(let _=0,E=C.length,M=E-1;_<E;M=_++){const A=C[M],D=C[_];if(Sy(s,A,D))return r;(c=A)[1]>(u=s)[1]!=(f=D)[1]>u[1]&&u[0]<(f[0]-c[0])*(u[1]-c[1])/(f[1]-c[1])+c[0]&&(l=!l)}}var u,c,f;return l}function fc(s,e,r,l){const u=l[0]-r[0],c=l[1]-r[1],f=(s[0]-r[0])*c-u*(s[1]-r[1]),x=(e[0]-r[0])*c-u*(e[1]-r[1]);return f>0&&x<0||f<0&&x>0}function Xp(s,e,r,l){return(u=[l[0]-r[0],l[1]-r[1]])[0]*(c=[e[0]-s[0],e[1]-s[1]])[1]-u[1]*c[0]!=0&&!(!fc(s,e,r,l)||!fc(r,l,s,e));var u,c}const El=8192;function Ya(s,e){const r=(180+s[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(r*u*El),Math.round(l*u*El)]}function Ty(s,e){for(let r=0;r<e.length;r++)if(qc(s,e[r]))return!0;return!1}function Rg(s,e,r){for(const l of r)for(let u=0,c=l.length,f=c-1;u<c;f=u++)if(Xp(s,e,l[f],l[u]))return!0;return!1}function ff(s,e){for(let r=0;r<s.length;++r)if(!qc(s[r],e))return!1;for(let r=0;r<s.length-1;++r)if(Rg(s[r],s[r+1],e))return!1;return!0}function Lu(s,e){for(let r=0;r<e.length;r++)if(ff(s,e[r]))return!0;return!1}function Al(s,e,r){const l=[];for(let u=0;u<s.length;u++){const c=[];for(let f=0;f<s[u].length;f++){const x=Ya(s[u][f],r);Za(e,x),c.push(x)}l.push(c)}return l}function Xn(s,e,r){const l=[];for(let u=0;u<s.length;u++){const c=Al(s[u],e,r);l.push(c)}return l}function _n(s,e,r,l){if(s[0]<r[0]||s[0]>r[2]){const u=.5*l;let c=s[0]-r[0]>u?-l:r[0]-s[0]>u?l:0;c===0&&(c=s[0]-r[2]>u?-l:r[2]-s[0]>u?l:0),s[0]+=c}Za(e,s)}function pf(s,e,r,l){const u=Math.pow(2,l.z)*El,c=[l.x*El,l.y*El],f=[];if(!s)return f;for(const x of s)for(const S of x){const C=[S.x+c[0],S.y+c[1]];_n(C,e,r,u),f.push(C)}return f}function Bn(s,e,r,l){const u=Math.pow(2,l.z)*El,c=[l.x*El,l.y*El],f=[];if(!s)return f;for(const S of s){const C=[];for(const _ of S){const E=[_.x+c[0],_.y+c[1]];Za(e,E),C.push(E)}f.push(C)}if(e[2]-e[0]<=u/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const S of f)for(const C of S)_n(C,e,r,u)}var x;return f}class Wa{constructor(e,r){this.type=cr,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ga(e[1])){const l=e[1];if(l.type==="FeatureCollection")for(let u=0;u<l.features.length;++u){const c=l.features[u].geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Wa(l,l.features[u].geometry)}else if(l.type==="Feature"){const u=l.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Wa(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new Wa(l,l)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,l){const u=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(!f)return!1;if(l.type==="Polygon"){const x=Al(l.coordinates,c,f),S=pf(r.geometry(),u,c,f);if(!Pu(u,c))return!1;for(const C of S)if(!qc(C,x))return!1}if(l.type==="MultiPolygon"){const x=Xn(l.coordinates,c,f),S=pf(r.geometry(),u,c,f);if(!Pu(u,c))return!1;for(const C of S)if(!Ty(C,x))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,l){const u=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(!f)return!1;if(l.type==="Polygon"){const x=Al(l.coordinates,c,f),S=Bn(r.geometry(),u,c,f);if(!Pu(u,c))return!1;for(const C of S)if(!ff(C,x))return!1}if(l.type==="MultiPolygon"){const x=Xn(l.coordinates,c,f),S=Bn(r.geometry(),u,c,f);if(!Pu(u,c))return!1;for(const C of S)if(!Lu(C,x))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const ba={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Dn=1/298.257223563,mf=Dn*(2-Dn),la=Math.PI/180;class Bu{static fromTile(e,r,l){const u=Math.PI*(1-2*(e+.5)/Math.pow(2,r)),c=Math.atan(.5*(Math.exp(u)-Math.exp(-u)))/la;return new Bu(c,l)}static get units(){return ba}constructor(e,r){if(e===void 0)throw new Error("No latitude given.");if(r&&!ba[r])throw new Error(`Unknown unit ${r}. Use one of: ${Object.keys(ba).join(", ")}`);const l=6378.137*la*(r?ba[r]:1),u=Math.cos(e*la),c=1/(1-mf*(1-u*u)),f=Math.sqrt(c);this.kx=l*f*u,this.ky=l*f*c*(1-mf)}distance(e,r){const l=mi(e[0]-r[0])*this.kx,u=(e[1]-r[1])*this.ky;return Math.sqrt(l*l+u*u)}bearing(e,r){const l=mi(r[0]-e[0])*this.kx;return Math.atan2(l,(r[1]-e[1])*this.ky)/la}destination(e,r,l){const u=l*la;return this.offset(e,Math.sin(u)*r,Math.cos(u)*r)}offset(e,r,l){return[e[0]+r/this.kx,e[1]+l/this.ky]}lineDistance(e){let r=0;for(let l=0;l<e.length-1;l++)r+=this.distance(e[l],e[l+1]);return r}area(e){let r=0;for(let l=0;l<e.length;l++){const u=e[l];for(let c=0,f=u.length,x=f-1;c<f;x=c++)r+=mi(u[c][0]-u[x][0])*(u[c][1]+u[x][1])*(l?-1:1)}return Math.abs(r)/2*this.kx*this.ky}along(e,r){let l=0;if(r<=0)return e[0];for(let u=0;u<e.length-1;u++){const c=e[u],f=e[u+1],x=this.distance(c,f);if(l+=x,l>r)return Cl(c,f,(r-(l-x))/x)}return e[e.length-1]}pointToSegmentDistance(e,r,l){let[u,c]=r,f=mi(l[0]-u)*this.kx,x=(l[1]-c)*this.ky;if(f!==0||x!==0){const S=(mi(e[0]-u)*this.kx*f+(e[1]-c)*this.ky*x)/(f*f+x*x);S>1?(u=l[0],c=l[1]):S>0&&(u+=f/this.kx*S,c+=x/this.ky*S)}return f=mi(e[0]-u)*this.kx,x=(e[1]-c)*this.ky,Math.sqrt(f*f+x*x)}pointOnLine(e,r){let l=1/0,u=e[0][0],c=e[0][1],f=0,x=0;for(let S=0;S<e.length-1;S++){let C=e[S][0],_=e[S][1],E=mi(e[S+1][0]-C)*this.kx,M=(e[S+1][1]-_)*this.ky,A=0;E===0&&M===0||(A=(mi(r[0]-C)*this.kx*E+(r[1]-_)*this.ky*M)/(E*E+M*M),A>1?(C=e[S+1][0],_=e[S+1][1]):A>0&&(C+=E/this.kx*A,_+=M/this.ky*A)),E=mi(r[0]-C)*this.kx,M=(r[1]-_)*this.ky;const D=E*E+M*M;D<l&&(l=D,u=C,c=_,f=S,x=A)}return{point:[u,c],index:f,t:Math.max(0,Math.min(1,x))}}lineSlice(e,r,l){let u=this.pointOnLine(l,e),c=this.pointOnLine(l,r);if(u.index>c.index||u.index===c.index&&u.t>c.t){const C=u;u=c,c=C}const f=[u.point],x=u.index+1,S=c.index;!Kp(l[x],f[0])&&x<=S&&f.push(l[x]);for(let C=x+1;C<=S;C++)f.push(l[C]);return Kp(l[S],c.point)||f.push(c.point),f}lineSliceAlong(e,r,l){let u=0;const c=[];for(let f=0;f<l.length-1;f++){const x=l[f],S=l[f+1],C=this.distance(x,S);if(u+=C,u>e&&c.length===0&&c.push(Cl(x,S,(e-(u-C))/C)),u>=r)return c.push(Cl(x,S,(r-(u-C))/C)),c;u>e&&c.push(S)}return c}bufferPoint(e,r){const l=r/this.ky,u=r/this.kx;return[e[0]-u,e[1]-l,e[0]+u,e[1]+l]}bufferBBox(e,r){const l=r/this.ky,u=r/this.kx;return[e[0]-u,e[1]-l,e[2]+u,e[3]+l]}insideBBox(e,r){return mi(e[0]-r[0])>=0&&mi(e[0]-r[2])<=0&&e[1]>=r[1]&&e[1]<=r[3]}}function Kp(s,e){return s[0]===e[0]&&s[1]===e[1]}function Cl(s,e,r){const l=mi(e[0]-s[0]);return[s[0]+l*r,s[1]+(e[1]-s[1])*r]}function mi(s){for(;s<-180;)s+=360;for(;s>180;)s-=360;return s}class Gd{constructor(e=[],r=(l,u)=>l<u?-1:l>u?1:0){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:l}=this,u=r[e];for(;e>0;){const c=e-1>>1,f=r[c];if(l(u,f)>=0)break;r[e]=f,e=c}r[e]=u}_down(e){const{data:r,compare:l}=this,u=this.length>>1,c=r[e];for(;e<u;){let f=1+(e<<1);const x=f+1;if(x<this.length&&l(r[x],r[f])<0&&(f=x),l(r[f],c)>=0)break;r[e]=r[f],e=f}r[e]=c}}var zt=8192;function gf(s,e){return e.dist-s.dist}const wa=100,zi=50;function Dl(s){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==s.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==s[r])return!1;return!0}function $d(s){return s[1]-s[0]+1}function Xa(s,e){const r=s[1]>=s[0]&&s[1]<e;return r||console.warn("Distance Expression: Index is out of range"),r}function Ml(s,e){if(s[0]>s[1])return[null,null];const r=$d(s);if(e){if(r===2)return[s,null];const l=Math.floor(r/2);return[[s[0],s[0]+l],[s[0]+l,s[1]]]}{if(r===1)return[s,null];const l=Math.floor(r/2)-1;return[[s[0],s[0]+l],[s[0]+l+1,s[1]]]}}function Ka(s,e){const r=[1/0,1/0,-1/0,-1/0];if(!Xa(e,s.length))return r;for(let l=e[0];l<=e[1];++l)Za(r,s[l]);return r}function Sa(s){const e=[1/0,1/0,-1/0,-1/0];for(let r=0;r<s.length;++r)for(let l=0;l<s[r].length;++l)Za(e,s[r][l]);return e}function Si(s,e,r){if(Dl(s)||Dl(e))return NaN;let l=0,u=0;return s[2]<e[0]&&(l=e[0]-s[2]),s[0]>e[2]&&(l=s[0]-e[2]),s[1]>e[3]&&(u=s[1]-e[3]),s[3]<e[1]&&(u=e[1]-s[3]),r.distance([0,0],[l,u])}function Jp(s){return 360*s-180}function Ey(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function _f(s,e){const r=Math.pow(2,e.z),l=(s.y/zt+e.y)/r;return[Jp((s.x/zt+e.x)/r),Ey(l)]}function Hc(s,e){const r=[];for(let l=0;l<s.length;++l)r.push(_f(s[l],e));return r}function Zd(s,e,r){const l=r.pointOnLine(e,s).point;return r.distance(s,l)}function Rl(s,e,r,l,u){const c=r.slice(l[0],l[1]+1);let f=1/0;for(let x=e[0];x<=e[1];++x)if((f=Math.min(f,Zd(s[x],c,u)))===0)return 0;return f}function Fu(s,e,r,l,u){const c=Math.min(u.pointToSegmentDistance(s,r,l),u.pointToSegmentDistance(e,r,l)),f=Math.min(u.pointToSegmentDistance(r,s,e),u.pointToSegmentDistance(l,s,e));return Math.min(c,f)}function yf(s,e,r,l,u){if(!Xa(e,s.length)||!Xa(l,r.length))return NaN;let c=1/0;for(let f=e[0];f<e[1];++f)for(let x=l[0];x<l[1];++x){if(Xp(s[f],s[f+1],r[x],r[x+1]))return 0;c=Math.min(c,Fu(s[f],s[f+1],r[x],r[x+1],u))}return c}function pc(s,e,r,l,u){if(!Xa(e,s.length)||!Xa(l,r.length))return NaN;let c=1/0;for(let f=e[0];f<=e[1];++f)for(let x=l[0];x<=l[1];++x)if((c=Math.min(c,u.distance(s[f],r[x])))===0)return c;return c}function kg(s,e,r){if(qc(s,e,!0))return 0;let l=1/0;for(const u of e){const c=u.length;if(c<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(u[0]!==u[c-1]&&(l=Math.min(l,r.pointToSegmentDistance(s,u[c-1],u[0])))===0||(l=Math.min(l,Zd(s,u,r)))===0)return l}return l}function Ay(s,e,r,l){if(!Xa(e,s.length))return NaN;for(let c=e[0];c<=e[1];++c)if(qc(s[c],r,!0))return 0;let u=1/0;for(let c=e[0];c<e[1];++c)for(const f of r)for(let x=0,S=f.length,C=S-1;x<S;C=x++){if(Xp(s[c],s[c+1],f[C],f[x]))return 0;u=Math.min(u,Fu(s[c],s[c+1],f[C],f[x],l))}return u}function ca(s,e){for(const r of s)for(let l=0;l<=r.length-1;++l)if(qc(r[l],e,!0))return!0;return!1}function Ja(s,e,r,l=1/0){const u=Sa(s),c=Sa(e);if(l!==1/0&&Si(u,c,r)>=l)return l;if(Pu(u,c)){if(ca(s,e))return 0}else if(ca(e,s))return 0;let f=l;for(const x of s)for(let S=0,C=x.length,_=C-1;S<C;_=S++)for(const E of e)for(let M=0,A=E.length,D=A-1;M<A;D=M++){if(Xp(x[_],x[S],E[D],E[M]))return 0;f=Math.min(f,Fu(x[_],x[S],E[D],E[M],r))}return f}function Gc(s,e,r,l,u,c,f){if(c===null||f===null)return;const x=Si(Ka(l,c),Ka(u,f),r);x<e&&s.push({dist:x,range1:c,range2:f})}function Qa(s,e,r,l,u=1/0){let c=Math.min(l.distance(s[0],r[0][0]),u);if(c===0)return c;const f=new Gd([{dist:0,range1:[0,s.length-1],range2:[0,0]}],gf),x=e?zi:wa,S=Sa(r);for(;f.length;){const C=f.pop();if(C.dist>=c)continue;const _=C.range1;if($d(_)<=x){if(!Xa(_,s.length))return NaN;if(e){const E=Ay(s,_,r,l);if((c=Math.min(c,E))===0)return c}else for(let E=_[0];E<=_[1];++E){const M=kg(s[E],r,l);if((c=Math.min(c,M))===0)return c}}else{const E=Ml(_,e);if(E[0]!==null){const M=Si(Ka(s,E[0]),S,l);M<c&&f.push({dist:M,range1:E[0],range2:[0,0]})}if(E[1]!==null){const M=Si(Ka(s,E[1]),S,l);M<c&&f.push({dist:M,range1:E[1],range2:[0,0]})}}}return c}function Qp(s,e,r,l,u,c=1/0){let f=Math.min(c,u.distance(s[0],r[0]));if(f===0)return f;const x=new Gd([{dist:0,range1:[0,s.length-1],range2:[0,r.length-1]}],gf),S=e?zi:wa,C=l?zi:wa;for(;x.length;){const _=x.pop();if(_.dist>=f)continue;const E=_.range1,M=_.range2;if($d(E)<=S&&$d(M)<=C){if(!Xa(E,s.length)||!Xa(M,r.length))return NaN;if(e&&l?f=Math.min(f,yf(s,E,r,M,u)):e||l?e&&!l?f=Math.min(f,Rl(r,M,s,E,u)):!e&&l&&(f=Math.min(f,Rl(s,E,r,M,u))):f=Math.min(f,pc(s,E,r,M,u)),f===0)return f}else{const A=Ml(E,e),D=Ml(M,l);Gc(x,f,u,s,r,A[0],D[0]),Gc(x,f,u,s,r,A[0],D[1]),Gc(x,f,u,s,r,A[1],D[0]),Gc(x,f,u,s,r,A[1],D[1])}}return f}function em(s,e,r,l,u=1/0){let c=u;const f=Ka(s,[0,s.length-1]);for(const x of r)if(!(c!==1/0&&Si(f,Ka(x,[0,x.length-1]),l)>=c)&&(c=Math.min(c,Qp(s,e,x,!0,l,c)),c===0))return c;return c}function Uu(s,e,r,l,u=1/0){let c=u;const f=Ka(s,[0,s.length-1]);for(const x of r){if(c!==1/0&&Si(f,Sa(x),l)>=c)continue;const S=Qa(s,e,x,l,c);if(isNaN(S))return S;if((c=Math.min(c,S))===0)return c}return c}function ju(s){return s==="Point"||s==="MultiPoint"||s==="LineString"||s==="MultiLineString"||s==="Polygon"||s==="MultiPolygon"}class mc{constructor(e,r){this.type=dn,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Ga(e[1])){const l=e[1];if(l.type==="FeatureCollection"){for(let u=0;u<l.features.length;++u)if(ju(l.features[u].geometry.type))return new mc(l,l.features[u].geometry)}else if(l.type==="Feature"){if(ju(l.geometry.type))return new mc(l,l.geometry)}else if(ju(l.type))return new mc(l,l)}return r.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const r=e.geometry(),l=e.canonicalID();if(r!=null&&l!=null){if(e.geometryType()==="Point")return function(u,c,f){const x=[];for(const C of u)for(const _ of C)x.push(_f(_,c));const S=new Bu(x[0][1],"meters");return f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString"?Qp(x,!1,f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",S):f.type==="MultiLineString"?em(x,!1,f.coordinates,S):f.type==="Polygon"||f.type==="MultiPolygon"?Uu(x,!1,f.type==="Polygon"?[f.coordinates]:f.coordinates,S):null}(r,l,this.geometries);if(e.geometryType()==="LineString")return function(u,c,f){const x=[];for(const C of u){const _=[];for(const E of C)_.push(_f(E,c));x.push(_)}const S=new Bu(x[0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return em(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",x,S);if(f.type==="MultiLineString"){let C=1/0;for(let _=0;_<f.coordinates.length;_++){const E=em(f.coordinates[_],!0,x,S,C);if(isNaN(E))return E;if((C=Math.min(C,E))===0)return C}return C}if(f.type==="Polygon"||f.type==="MultiPolygon"){let C=1/0;for(let _=0;_<x.length;_++){const E=Uu(x[_],!0,f.type==="Polygon"?[f.coordinates]:f.coordinates,S,C);if(isNaN(E))return E;if((C=Math.min(C,E))===0)return C}return C}return null}(r,l,this.geometries);if(e.geometryType()==="Polygon")return function(u,c,f){const x=[];for(const C of function(_,E){const M=_.length;if(M<=1)return[_];const A=[];let D,I;for(let B=0;B<M;B++){const U=Wp(_[B]);U!==0&&(_[B].area=Math.abs(U),I===void 0&&(I=U<0),I===U<0?(D&&A.push(D),D=[_[B]]):D.push(_[B]))}return D&&A.push(D),A}(u)){const _=[];for(let E=0;E<C.length;++E)_.push(Hc(C[E],c));x.push(_)}const S=new Bu(x[0][0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return Uu(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",x,S);if(f.type==="MultiLineString"){let C=1/0;for(let _=0;_<f.coordinates.length;_++){const E=Uu(f.coordinates[_],!0,x,S,C);if(isNaN(E))return E;if((C=Math.min(C,E))===0)return C}return C}return f.type==="Polygon"||f.type==="MultiPolygon"?function(C,_,E){let M=1/0;for(const A of C)for(const D of _){const I=Ja(A,D,E,M);if(isNaN(I))return I;if((M=Math.min(M,I))===0)return M}return M}(f.type==="Polygon"?[f.coordinates]:f.coordinates,x,S):null}(r,l,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function vf(s,e){switch(s){case"string":return co(e);case"number":return+e;case"boolean":return!!e;case"color":return gr.parse(e);case"formatted":return ko.fromString(co(e));case"resolvedImage":return Oo.build(co(e))}return e}function tm(s,e,r,l){return l!==void 0&&(s=l*Math.round(s/l)),e!==void 0&&s<e&&(s=e),r!==void 0&&s>r&&(s=r),s}class kl{constructor(e,r,l){this.type=e,this.key=r,this.scope=l}static parse(e,r){let l=r.expectedType;if(l==null&&(l=Wn),e.length<2||e.length>3)return r.error("Invalid number of arguments for 'config' expression.");const u=r.parse(e[1],1);if(!(u instanceof dc))return r.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const c=r.parse(e[2],2);return c instanceof dc?new kl(l,co(u.value),co(c.value)):r.error("Scope of 'config' expression must be a string literal.")}return new kl(l,co(u.value))}evaluate(e){const r=[this.key,this.scope,e.scope].filter(Boolean).join(""),l=e.getConfig(r);if(!l)return null;const{type:u,value:c,values:f,minValue:x,maxValue:S,stepValue:C}=l,_=l.default.evaluate(e);let E=_;if(c){const M=e.scope;e.scope=(M||"").split("").slice(1).join(""),E=c.evaluate(e),e.scope=M}return u&&(E=vf(u,E)),E===void 0||x===void 0&&S===void 0&&C===void 0||(typeof E=="number"?E=tm(E,x,S,C):Array.isArray(E)&&(E=E.map(M=>typeof M=="number"?tm(M,x,S,C):M))),c!==void 0&&E!==void 0&&f&&!f.includes(E)&&(E=_,u&&(E=vf(u,E))),(u&&u!==this.type||E!==void 0&&Hi(E)!==this.type)&&(E=vf(this.type.kind,E)),E}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function Vu(s){if(s instanceof Ci&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof Wa||s instanceof mc)return!1;let e=!0;return s.eachChild(r=>{e&&!Vu(r)&&(e=!1)}),e}function Yd(s){if(s instanceof Ci&&s.name==="feature-state")return!1;let e=!0;return s.eachChild(r=>{e&&!Yd(r)&&(e=!1)}),e}function Wd(s){if(s instanceof kl)return new Set([s.key]);let e=new Set;return s.eachChild(r=>{e=new Set([...e,...Wd(r)])}),e}function el(s,e){if(s instanceof Ci&&e.indexOf(s.name)>=0)return!1;let r=!0;return s.eachChild(l=>{r&&!el(l,e)&&(r=!1)}),r}class gc{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const l=e[1];return r.scope.has(l)?new gc(l,r.scope.get(l)):r.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class ua{constructor(e,r=[],l,u=new df,c=[],f,x){this.registry=e,this.path=r,this.key=r.map(S=>typeof S=="string"?`['${S}']`:`[${S}]`).join(""),this.scope=u,this.errors=c,this.expectedType=l,this._scope=f,this.options=x}parse(e,r,l,u,c={}){return r||l?this.concat(r,null,l,u)._parse(e,c):this._parse(e,c)}parseObjectValue(e,r,l,u,c,f={}){return this.concat(r,l,u,c)._parse(e,f)}_parse(e,r){function l(u,c,f){return f==="assert"?new zs(c,[u]):f==="coerce"?new fs(c,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(u){let c=u.parse(e,this);if(!c)return null;if(this.expectedType){const f=this.expectedType,x=c.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||x.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(f,x))return null}else c=l(c,f,r.typeAnnotation||"coerce");else c=l(c,f,r.typeAnnotation||"assert")}if(!(c instanceof dc)&&c.type.kind!=="resolvedImage"&&$c(c)){const f=new Ps(this._scope,this.options);try{c=new dc(c.type,c.evaluate(f))}catch(x){return this.error(x.message),null}}return c}return fs.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,l,u){let c=typeof e=="number"?this.path.concat(e):this.path;c=typeof r=="string"?c.concat(r):c;const f=u?this.scope.concat(u):this.scope;return new ua(this.registry,c,l||null,f,this.errors,this._scope,this.options)}error(e,...r){const l=`${this.key}${r.map(u=>`[${u}]`).join("")}`;this.errors.push(new Ns(l,e))}checkSubtype(e,r){const l=Ou(e,r);return l&&this.error(l),l}}var Ol=ua;function $c(s){if(s instanceof gc)return $c(s.boundExpression);if(s instanceof Ci&&s.name==="error"||s instanceof Tl||s instanceof Wa||s instanceof mc||s instanceof kl)return!1;const e=s instanceof fs||s instanceof zs;let r=!0;return s.eachChild(l=>{r=e?r&&$c(l):r&&l instanceof dc}),!!r&&Vu(s)&&el(s,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Zc(s,e){const r=s.length-1;let l,u,c=0,f=r,x=0;for(;c<=f;)if(x=Math.floor((c+f)/2),l=s[x],u=s[x+1],l<=e){if(x===r||e<u)return x;c=x+1}else{if(!(l>e))throw new wi("Input is not a number.");f=x-1}return 0}class Ls{constructor(e,r,l){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[u,c]of l)this.labels.push(u),this.outputs.push(c)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const l=r.parse(e[1],1,dn);if(!l)return null;const u=[];let c=null;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);for(let f=1;f<e.length;f+=2){const x=f===1?-1/0:e[f],S=e[f+1],C=f,_=f+1;if(typeof x!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(u.length&&u[u.length-1][0]>=x)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const E=r.parse(S,_,c);if(!E)return null;c=c||E.type,u.push([x,E])}return new Ls(c,l,u)}evaluate(e){const r=this.labels,l=this.outputs;if(r.length===1)return l[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return l[0].evaluate(e);const c=r.length;return u>=r[c-1]?l[c-1].evaluate(e):l[Zc(r,u)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}const er=.95047,Og=1.08883,Cy=4/29,qu=6/29,nm=3*qu*qu,Ig=qu*qu*qu,ni=Math.PI/180,qr=180/Math.PI;function gn(s){return s>Ig?Math.pow(s,1/3):s/nm+Cy}function Yc(s){return s>qu?s*s*s:nm*(s-Cy)}function Xd(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function Gi(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function rm(s){const e=Gi(s.r),r=Gi(s.g),l=Gi(s.b),u=gn((.4124564*e+.3575761*r+.1804375*l)/er),c=gn((.2126729*e+.7151522*r+.072175*l)/1);return{l:116*c-16,a:500*(u-c),b:200*(c-gn((.0193339*e+.119192*r+.9503041*l)/Og)),alpha:s.a}}function im(s){let e=(s.l+16)/116,r=isNaN(s.a)?e:e+s.a/500,l=isNaN(s.b)?e:e-s.b/200;return e=1*Yc(e),r=er*Yc(r),l=Og*Yc(l),new gr(Xd(3.2404542*r-1.5371385*e-.4985314*l),Xd(-.969266*r+1.8760108*e+.041556*l),Xd(.0556434*r-.2040259*e+1.0572252*l),s.alpha)}function Dy(s,e,r){const l=e-s;return s+r*(l>180||l<-180?l-360*Math.round(l/360):l)}const Hu={forward:rm,reverse:im,interpolate:function(s,e,r){return{l:En(s.l,e.l,r),a:En(s.a,e.a,r),b:En(s.b,e.b,r),alpha:En(s.alpha,e.alpha,r)}}},xf={forward:function(s){const{l:e,a:r,b:l}=rm(s),u=Math.atan2(l,r)*qr;return{h:u<0?u+360:u,c:Math.sqrt(r*r+l*l),l:e,alpha:s.a}},reverse:function(s){const e=s.h*ni,r=s.c;return im({l:s.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:s.alpha})},interpolate:function(s,e,r){return{h:Dy(s.h,e.h,r),c:En(s.c,e.c,r),l:En(s.l,e.l,r),alpha:En(s.alpha,e.alpha,r)}}};var om=Object.freeze({__proto__:null,hcl:xf,lab:Hu});class ps{constructor(e,r,l,u,c){this.type=e,this.operator=r,this.interpolation=l,this.input=u,this.labels=[],this.outputs=[];for(const[f,x]of c)this.labels.push(f),this.outputs.push(x)}static interpolationFactor(e,r,l,u){let c=0;if(e.name==="exponential")c=bf(r,e.base,l,u);else if(e.name==="linear")c=bf(r,1,l,u);else if(e.name==="cubic-bezier"){const f=e.controlPoints;c=new Uo(f[0],f[1],f[2],f[3]).solve(bf(r,1,l,u))}return c}static parse(e,r){let[l,u,c,...f]=e;if(!Array.isArray(u)||u.length===0)return r.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const C=u[1];if(typeof C!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:C}}else{if(u[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const C=u.slice(1);if(C.length!==4||C.some(_=>typeof _!="number"||_<0||_>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:C}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(c=r.parse(c,2,dn),!c)return null;const x=[];let S=null;l==="interpolate-hcl"||l==="interpolate-lab"?S=lo:r.expectedType&&r.expectedType.kind!=="value"&&(S=r.expectedType);for(let C=0;C<f.length;C+=2){const _=f[C],E=f[C+1],M=C+3,A=C+4;if(typeof _!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(x.length&&x[x.length-1][0]>=_)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const D=r.parse(E,A,S);if(!D)return null;S=S||D.type,x.push([_,D])}return S.kind==="number"||S.kind==="color"||S.kind==="array"&&S.itemType.kind==="number"&&typeof S.N=="number"?new ps(S,l,u,c,x):r.error(`Type ${Ii(S)} is not interpolatable.`)}evaluate(e){const r=this.labels,l=this.outputs;if(r.length===1)return l[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return l[0].evaluate(e);const c=r.length;if(u>=r[c-1])return l[c-1].evaluate(e);const f=Zc(r,u),x=ps.interpolationFactor(this.interpolation,u,r[f],r[f+1]),S=l[f].evaluate(e),C=l[f+1].evaluate(e);return this.operator==="interpolate"?uf[this.type.kind.toLowerCase()](S,C,x):this.operator==="interpolate-hcl"?xf.reverse(xf.interpolate(xf.forward(S),xf.forward(C),x)):Hu.reverse(Hu.interpolate(Hu.forward(S),Hu.forward(C),x))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const r=[this.operator,e,this.input.serialize()];for(let l=0;l<this.labels.length;l++)r.push(this.labels[l],this.outputs[l].serialize());return r}}function bf(s,e,r,l){const u=l-r,c=s-r;return u===0?0:e===1?c/u:(Math.pow(e,c)-1)/(Math.pow(e,u)-1)}class qo{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let l=null;const u=r.expectedType;u&&u.kind!=="value"&&(l=u);const c=[];for(const x of e.slice(1)){const S=r.parse(x,1+c.length,l,void 0,{typeAnnotation:"omit"});if(!S)return null;l=l||S.type,c.push(S)}const f=u&&c.some(x=>Ou(u,x.type));return new qo(f?Wn:l,c)}evaluate(e){let r,l=null,u=0;for(const c of this.args){if(u++,l=c.evaluate(e),l&&l instanceof Oo&&!l.available&&(r||(r=l),l=null,u===this.args.length))return r;if(l!==null)break}return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class ai{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let c=1;c<e.length-1;c+=2){const f=e[c];if(typeof f!="string")return r.error(`Expected string, but found ${typeof f} instead.`,c);if(/[^a-zA-Z0-9_]/.test(f))return r.error("Variable names must contain only alphanumeric characters or '_'.",c);const x=r.parse(e[c+1],c+1);if(!x)return null;l.push([f,x])}const u=r.parse(e[e.length-1],e.length-1,r.expectedType,l);return u?new ai(l,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,l]of this.bindings)e.push(r,l.serialize());return e.push(this.result.serialize()),e}}class wf{constructor(e,r,l){this.type=e,this.index=r,this.input=l}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,dn),u=r.parse(e[2],2,_o(r.expectedType||Wn));return l&&u?new wf(u.type.itemType,l,u):null}evaluate(e){const r=this.index.evaluate(e),l=this.input.evaluate(e);if(r<0)throw new wi(`Array index out of bounds: ${r} < 0.`);if(r>=l.length)throw new wi(`Array index out of bounds: ${r} > ${l.length-1}.`);if(r!==Math.floor(r))throw new wi(`Array index must be an integer, but found ${r} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return l[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Gu{constructor(e,r,l){this.type=e,this.index=r,this.input=l}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,dn),u=r.parse(e[2],2,_o(r.expectedType||Wn));return l&&u?new Gu(u.type.itemType,l,u):null}evaluate(e){const r=this.index.evaluate(e),l=this.input.evaluate(e);if(r<0)throw new wi(`Array index out of bounds: ${r} < 0.`);if(r>l.length-1)throw new wi(`Array index out of bounds: ${r} > ${l.length-1}.`);if(r===Math.floor(r))return l[r];const u=Math.floor(r),c=Math.ceil(r),f=l[u],x=l[c];if(typeof f!="number"||typeof x!="number")throw new wi(`Cannot interpolate between non-number values at index ${r}.`);const S=r-u;return f*(1-S)+x*S}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Il{constructor(e,r){this.type=cr,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,Wn),u=r.parse(e[2],2,Wn);return l&&u?Mg(l.type,[cr,Cr,dn,Mu,Wn])?new Il(l,u):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ii(l.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(l==null)return!1;if(!Iu(r,["boolean","string","number","null"]))throw new wi(`Expected first argument to be of type boolean, string, number or null, but found ${Ii(Hi(r))} instead.`);if(!Iu(l,["string","array"]))throw new wi(`Expected second argument to be of type array or string, but found ${Ii(Hi(l))} instead.`);return l.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Nl{constructor(e,r,l){this.type=dn,this.needle=e,this.haystack=r,this.fromIndex=l}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,Wn),u=r.parse(e[2],2,Wn);if(!l||!u)return null;if(!Mg(l.type,[cr,Cr,dn,Mu,Wn]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ii(l.type)} instead`);if(e.length===4){const c=r.parse(e[3],3,dn);return c?new Nl(l,u,c):null}return new Nl(l,u)}evaluate(e){const r=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!Iu(r,["boolean","string","number","null"]))throw new wi(`Expected first argument to be of type boolean, string, number or null, but found ${Ii(Hi(r))} instead.`);if(!Iu(l,["string","array"]))throw new wi(`Expected second argument to be of type array or string, but found ${Ii(Hi(l))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return l.indexOf(r,u)}return l.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class da{constructor(e,r,l,u,c,f){this.inputType=e,this.type=r,this.input=l,this.cases=u,this.outputs=c,this.otherwise=f}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let l,u;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);const c={},f=[];for(let C=2;C<e.length-1;C+=2){let _=e[C];const E=e[C+1];Array.isArray(_)||(_=[_]);const M=r.concat(C);if(_.length===0)return M.error("Expected at least one branch label.");for(const D of _){if(typeof D!="number"&&typeof D!="string")return M.error("Branch labels must be numbers or strings.");if(typeof D=="number"&&Math.abs(D)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof D=="number"&&Math.floor(D)!==D)return M.error("Numeric branch labels must be integer values.");if(l){if(M.checkSubtype(l,Hi(D)))return null}else l=Hi(D);if(c[String(D)]!==void 0)return M.error("Branch labels must be unique.");c[String(D)]=f.length}const A=r.parse(E,C,u);if(!A)return null;u=u||A.type,f.push(A)}const x=r.parse(e[1],1,Wn);if(!x)return null;const S=r.parse(e[e.length-1],e.length-1,u);return S?x.type.kind!=="value"&&r.concat(1).checkSubtype(l,x.type)?null:new da(l,u,x,c,f,S):null}evaluate(e){const r=this.input.evaluate(e);return(Hi(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),l=[],u={};for(const f of r){const x=u[this.cases[f]];x===void 0?(u[this.cases[f]]=l.length,l.push([this.cases[f],[f]])):l[x][1].push(f)}const c=f=>this.inputType.kind==="number"?Number(f):f;for(const[f,x]of l)e.push(x.length===1?c(x[0]):x.map(c)),e.push(this.outputs[f].serialize());return e.push(this.otherwise.serialize()),e}}class Sf{constructor(e,r,l){this.type=e,this.branches=r,this.otherwise=l}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const u=[];for(let f=1;f<e.length-1;f+=2){const x=r.parse(e[f],f,cr);if(!x)return null;const S=r.parse(e[f+1],f+1,l);if(!S)return null;u.push([x,S]),l=l||S.type}const c=r.parse(e[e.length-1],e.length-1,l);return c?new Sf(l,u,c):null}evaluate(e){for(const[r,l]of this.branches)if(r.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,l]of this.branches)e(r),e(l);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class _c{constructor(e,r,l,u){this.type=e,this.input=r,this.beginIndex=l,this.endIndex=u}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,Wn),u=r.parse(e[2],2,dn);if(!l||!u)return null;if(!Mg(l.type,[_o(Wn),Cr,Wn]))return r.error(`Expected first argument to be of type array or string, but found ${Ii(l.type)} instead`);if(e.length===4){const c=r.parse(e[3],3,dn);return c?new _c(l.type,l,u,c):null}return new _c(l.type,l,u)}evaluate(e){const r=this.input.evaluate(e),l=this.beginIndex.evaluate(e);if(!Iu(r,["string","array"]))throw new wi(`Expected first argument to be of type array or string, but found ${Ii(Hi(r))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return r.slice(l,u)}return r.slice(l)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function sm(s,e){return s==="=="||s==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Kd(s,e,r,l){return l.compare(e,r)===0}function Wc(s,e,r){const l=s!=="=="&&s!=="!=";return class $D{constructor(c,f,x){this.type=cr,this.lhs=c,this.rhs=f,this.collator=x,this.hasUntypedArgument=c.type.kind==="value"||f.type.kind==="value"}static parse(c,f){if(c.length!==3&&c.length!==4)return f.error("Expected two or three arguments.");const x=c[0];let S=f.parse(c[1],1,Wn);if(!S)return null;if(!sm(x,S.type))return f.concat(1).error(`"${x}" comparisons are not supported for type '${Ii(S.type)}'.`);let C=f.parse(c[2],2,Wn);if(!C)return null;if(!sm(x,C.type))return f.concat(2).error(`"${x}" comparisons are not supported for type '${Ii(C.type)}'.`);if(S.type.kind!==C.type.kind&&S.type.kind!=="value"&&C.type.kind!=="value")return f.error(`Cannot compare types '${Ii(S.type)}' and '${Ii(C.type)}'.`);l&&(S.type.kind==="value"&&C.type.kind!=="value"?S=new zs(C.type,[S]):S.type.kind!=="value"&&C.type.kind==="value"&&(C=new zs(S.type,[C])));let _=null;if(c.length===4){if(S.type.kind!=="string"&&C.type.kind!=="string"&&S.type.kind!=="value"&&C.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(_=f.parse(c[3],3,uc),!_)return null}return new $D(S,C,_)}evaluate(c){const f=this.lhs.evaluate(c),x=this.rhs.evaluate(c);if(l&&this.hasUntypedArgument){const S=Hi(f),C=Hi(x);if(S.kind!==C.kind||S.kind!=="string"&&S.kind!=="number")throw new wi(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${S.kind}, ${C.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const S=Hi(f),C=Hi(x);if(S.kind!=="string"||C.kind!=="string")return e(c,f,x)}return this.collator?r(c,f,x,this.collator.evaluate(c)):e(c,f,x)}eachChild(c){c(this.lhs),c(this.rhs),this.collator&&c(this.collator)}outputDefined(){return!0}serialize(){const c=[s];return this.eachChild(f=>{c.push(f.serialize())}),c}}}const am=Wc("==",function(s,e,r){return e===r},Kd),My=Wc("!=",function(s,e,r){return e!==r},function(s,e,r,l){return!Kd(0,e,r,l)}),Ry=Wc("<",function(s,e,r){return e<r},function(s,e,r,l){return l.compare(e,r)<0}),ky=Wc(">",function(s,e,r){return e>r},function(s,e,r,l){return l.compare(e,r)>0}),Oy=Wc("<=",function(s,e,r){return e<=r},function(s,e,r,l){return l.compare(e,r)<=0}),Iy=Wc(">=",function(s,e,r){return e>=r},function(s,e,r,l){return l.compare(e,r)>=0});class $u{constructor(e,r,l,u,c,f){this.type=Cr,this.number=e,this.locale=r,this.currency=l,this.unit=u,this.minFractionDigits=c,this.maxFractionDigits=f}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const l=r.parse(e[1],1,dn);if(!l)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return r.error("NumberFormat options argument must be an object.");let c=null;if(u.locale&&(c=r.parseObjectValue(u.locale,2,"locale",Cr),!c))return null;let f=null;if(u.currency&&(f=r.parseObjectValue(u.currency,2,"currency",Cr),!f))return null;let x=null;if(u.unit&&(x=r.parseObjectValue(u.unit,2,"unit",Cr),!x))return null;let S=null;if(u["min-fraction-digits"]&&(S=r.parseObjectValue(u["min-fraction-digits"],2,"min-fraction-digits",dn),!S))return null;let C=null;return u["max-fraction-digits"]&&(C=r.parseObjectValue(u["max-fraction-digits"],2,"max-fraction-digits",dn),!C)?null:new $u(l,c,f,x,S,C)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Tf{constructor(e){this.type=dn,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=r.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Ii(l.type)} instead.`):new Tf(l):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new wi(`Expected value to be of type string or array, but found ${Ii(Hi(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}function Ef(s){return function(){s=1831565813+(s|=0)|0;let e=Math.imul(s^s>>>15,1|s);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Zu={"==":am,"!=":My,">":ky,"<":Ry,">=":Iy,"<=":Oy,array:zs,at:wf,"at-interpolated":Gu,boolean:zs,case:Sf,coalesce:qo,collator:Tl,format:Nu,image:hc,in:Il,"index-of":Nl,interpolate:ps,"interpolate-hcl":ps,"interpolate-lab":ps,length:Tf,let:ai,literal:dc,match:da,number:zs,"number-format":$u,object:zs,slice:_c,step:Ls,string:zs,"to-boolean":fs,"to-color":fs,"to-number":fs,"to-string":fs,var:gc,within:Wa,distance:mc,config:kl};function Ng(s,[e,r,l,u]){e=e.evaluate(s),r=r.evaluate(s),l=l.evaluate(s);const c=u?u.evaluate(s):1,f=hf(e,r,l,c);if(f)throw new wi(f);return new gr(e/255*c,r/255*c,l/255*c,c)}function zg(s,[e,r,l,u]){e=e.evaluate(s),r=r.evaluate(s),l=l.evaluate(s);const c=u?u.evaluate(s):1,f=function(C,_,E,M){return typeof C=="number"&&C>=0&&C<=360?typeof _=="number"&&_>=0&&_<=100&&typeof E=="number"&&E>=0&&E<=100?M===void 0||typeof M=="number"&&M>=0&&M<=1?null:`Invalid hsla value [${[C,_,E,M].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof M=="number"?[C,_,E,M]:[C,_,E]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof M=="number"?[C,_,E,M]:[C,_,E]).join(", ")}]: 'h' must be between 0 and 360.`}(e,r,l,c);if(f)throw new wi(f);const x=`hsla(${e}, ${r}%, ${l}%, ${c})`,S=gr.parse(x);if(!S)throw new wi(`Failed to parse HSLA color: ${x}`);return S}function Pg(s,e){return s in e}function Af(s,e){const r=e[s];return r===void 0?null:r}function ha(s){return{type:s}}function lm(s){return{result:"success",value:s}}function tl(s){return{result:"error",value:s}}function cm(s,e){return!!s&&!!s.parameters&&s.parameters.indexOf(e)>-1}function Yu(s){return s["property-type"]==="data-driven"}function yc(s){return cm(s.expression,"measure-light")}function Cf(s){return cm(s.expression,"zoom")}function um(s){return!!s.expression&&s.expression.interpolated}function dm(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function Df(s){return s}function Wu(s,e){const r=e.type==="color",l=s.stops&&typeof s.stops[0][0]=="object",u=l||!(l||s.property!==void 0),c=s.type||(um(e)?"exponential":"interval");if(r&&((s=or({},s)).stops&&(s.stops=s.stops.map(C=>[C[0],gr.parse(C[1])])),s.default=gr.parse(s.default?s.default:e.default)),s.colorSpace&&s.colorSpace!=="rgb"&&!om[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let f,x,S;if(c==="exponential")f=Jo;else if(c==="interval")f=Kc;else if(c==="categorical"){f=Lg,x=Object.create(null);for(const C of s.stops)x[C[0]]=C[1];S=typeof s.stops[0][0]}else{if(c!=="identity")throw new Error(`Unknown function type "${c}"`);f=Xu}if(l){const C={},_=[];for(let A=0;A<s.stops.length;A++){const D=s.stops[A],I=D[0].zoom;C[I]===void 0&&(C[I]={zoom:I,type:s.type,property:s.property,default:s.default,stops:[]},_.push(I)),C[I].stops.push([D[0].value,D[1]])}const E=[];for(const A of _)E.push([C[A].zoom,Wu(C[A],e)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:ps.interpolationFactor.bind(void 0,M),zoomStops:E.map(A=>A[0]),evaluate:({zoom:A},D)=>Jo({stops:E,base:s.base},e,A).evaluate(A,D)}}if(u){const C=c==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:ps.interpolationFactor.bind(void 0,C),zoomStops:s.stops.map(_=>_[0]),evaluate:({zoom:_})=>f(s,e,_,x,S)}}return{kind:"source",evaluate(C,_){const E=_&&_.properties?_.properties[s.property]:void 0;return E===void 0?Xc(s.default,e.default):f(s,e,E,x,S)}}}function Xc(s,e,r){return s!==void 0?s:e!==void 0?e:r!==void 0?r:void 0}function Lg(s,e,r,l,u){return Xc(typeof r===u?l[r]:void 0,s.default,e.default)}function Kc(s,e,r){if($a(r)!=="number")return Xc(s.default,e.default);const l=s.stops.length;if(l===1||r<=s.stops[0][0])return s.stops[0][1];if(r>=s.stops[l-1][0])return s.stops[l-1][1];const u=Zc(s.stops.map(c=>c[0]),r);return s.stops[u][1]}function Jo(s,e,r){const l=s.base!==void 0?s.base:1;if($a(r)!=="number")return Xc(s.default,e.default);const u=s.stops.length;if(u===1||r<=s.stops[0][0])return s.stops[0][1];if(r>=s.stops[u-1][0])return s.stops[u-1][1];const c=Zc(s.stops.map(_=>_[0]),r),f=function(_,E,M,A){const D=A-M,I=_-M;return D===0?0:E===1?I/D:(Math.pow(E,I)-1)/(Math.pow(E,D)-1)}(r,l,s.stops[c][0],s.stops[c+1][0]),x=s.stops[c][1],S=s.stops[c+1][1];let C=uf[e.type]||Df;if(s.colorSpace&&s.colorSpace!=="rgb"){const _=om[s.colorSpace];C=(E,M)=>_.reverse(_.interpolate(_.forward(E),_.forward(M),f))}return typeof x.evaluate=="function"?{evaluate(..._){const E=x.evaluate.apply(void 0,_),M=S.evaluate.apply(void 0,_);if(E!==void 0&&M!==void 0)return C(E,M,f)}}:C(x,S,f)}function Xu(s,e,r){return e.type==="color"?r=gr.parse(r):e.type==="formatted"?r=ko.fromString(r.toString()):e.type==="resolvedImage"?r=Oo.build(r.toString()):$a(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),Xc(r,s.default,e.default)}Ci.register(Zu,{error:[{kind:"error"},[Cr],(s,[e])=>{throw new wi(e.evaluate(s))}],typeof:[Cr,[Wn],(s,[e])=>Ii(Hi(e.evaluate(s)))],"to-rgba":[_o(dn,4),[lo],(s,[e])=>e.evaluate(s).toRenderColor(null).toArray()],"to-hsla":[_o(dn,4),[lo],(s,[e])=>e.evaluate(s).toRenderColor(null).toHslaArray()],rgb:[lo,[dn,dn,dn],Ng],rgba:[lo,[dn,dn,dn,dn],Ng],hsl:[lo,[dn,dn,dn],zg],hsla:[lo,[dn,dn,dn,dn],zg],has:{type:cr,overloads:[[[Cr],(s,[e])=>Pg(e.evaluate(s),s.properties())],[[Cr,Ru],(s,[e,r])=>Pg(e.evaluate(s),r.evaluate(s))]]},get:{type:Wn,overloads:[[[Cr],(s,[e])=>Af(e.evaluate(s),s.properties())],[[Cr,Ru],(s,[e,r])=>Af(e.evaluate(s),r.evaluate(s))]]},"feature-state":[Wn,[Cr],(s,[e])=>Af(e.evaluate(s),s.featureState||{})],properties:[Ru,[],s=>s.properties()],"geometry-type":[Cr,[],s=>s.geometryType()],id:[Wn,[],s=>s.id()],zoom:[dn,[],s=>s.globals.zoom],pitch:[dn,[],s=>s.globals.pitch||0],"distance-from-center":[dn,[],s=>s.distanceFromCenter()],"measure-light":[dn,[Cr],(s,[e])=>s.measureLight(e.evaluate(s))],"heatmap-density":[dn,[],s=>s.globals.heatmapDensity||0],"line-progress":[dn,[],s=>s.globals.lineProgress||0],"raster-value":[dn,[],s=>s.globals.rasterValue||0],"raster-particle-speed":[dn,[],s=>s.globals.rasterParticleSpeed||0],"sky-radial-progress":[dn,[],s=>s.globals.skyRadialProgress||0],accumulated:[Wn,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[dn,ha(dn),(s,e)=>{let r=0;for(const l of e)r+=l.evaluate(s);return r}],"*":[dn,ha(dn),(s,e)=>{let r=1;for(const l of e)r*=l.evaluate(s);return r}],"-":{type:dn,overloads:[[[dn,dn],(s,[e,r])=>e.evaluate(s)-r.evaluate(s)],[[dn],(s,[e])=>-e.evaluate(s)]]},"/":[dn,[dn,dn],(s,[e,r])=>e.evaluate(s)/r.evaluate(s)],"%":[dn,[dn,dn],(s,[e,r])=>e.evaluate(s)%r.evaluate(s)],ln2:[dn,[],()=>Math.LN2],pi:[dn,[],()=>Math.PI],e:[dn,[],()=>Math.E],"^":[dn,[dn,dn],(s,[e,r])=>Math.pow(e.evaluate(s),r.evaluate(s))],sqrt:[dn,[dn],(s,[e])=>Math.sqrt(e.evaluate(s))],log10:[dn,[dn],(s,[e])=>Math.log(e.evaluate(s))/Math.LN10],ln:[dn,[dn],(s,[e])=>Math.log(e.evaluate(s))],log2:[dn,[dn],(s,[e])=>Math.log(e.evaluate(s))/Math.LN2],sin:[dn,[dn],(s,[e])=>Math.sin(e.evaluate(s))],cos:[dn,[dn],(s,[e])=>Math.cos(e.evaluate(s))],tan:[dn,[dn],(s,[e])=>Math.tan(e.evaluate(s))],asin:[dn,[dn],(s,[e])=>Math.asin(e.evaluate(s))],acos:[dn,[dn],(s,[e])=>Math.acos(e.evaluate(s))],atan:[dn,[dn],(s,[e])=>Math.atan(e.evaluate(s))],min:[dn,ha(dn),(s,e)=>Math.min(...e.map(r=>r.evaluate(s)))],max:[dn,ha(dn),(s,e)=>Math.max(...e.map(r=>r.evaluate(s)))],abs:[dn,[dn],(s,[e])=>Math.abs(e.evaluate(s))],round:[dn,[dn],(s,[e])=>{const r=e.evaluate(s);return r<0?-Math.round(-r):Math.round(r)}],floor:[dn,[dn],(s,[e])=>Math.floor(e.evaluate(s))],ceil:[dn,[dn],(s,[e])=>Math.ceil(e.evaluate(s))],"filter-==":[cr,[Cr,Wn],(s,[e,r])=>s.properties()[e.value]===r.value],"filter-id-==":[cr,[Wn],(s,[e])=>s.id()===e.value],"filter-type-==":[cr,[Cr],(s,[e])=>s.geometryType()===e.value],"filter-<":[cr,[Cr,Wn],(s,[e,r])=>{const l=s.properties()[e.value],u=r.value;return typeof l==typeof u&&l<u}],"filter-id-<":[cr,[Wn],(s,[e])=>{const r=s.id(),l=e.value;return typeof r==typeof l&&r<l}],"filter->":[cr,[Cr,Wn],(s,[e,r])=>{const l=s.properties()[e.value],u=r.value;return typeof l==typeof u&&l>u}],"filter-id->":[cr,[Wn],(s,[e])=>{const r=s.id(),l=e.value;return typeof r==typeof l&&r>l}],"filter-<=":[cr,[Cr,Wn],(s,[e,r])=>{const l=s.properties()[e.value],u=r.value;return typeof l==typeof u&&l<=u}],"filter-id-<=":[cr,[Wn],(s,[e])=>{const r=s.id(),l=e.value;return typeof r==typeof l&&r<=l}],"filter->=":[cr,[Cr,Wn],(s,[e,r])=>{const l=s.properties()[e.value],u=r.value;return typeof l==typeof u&&l>=u}],"filter-id->=":[cr,[Wn],(s,[e])=>{const r=s.id(),l=e.value;return typeof r==typeof l&&r>=l}],"filter-has":[cr,[Wn],(s,[e])=>e.value in s.properties()],"filter-has-id":[cr,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[cr,[_o(Cr)],(s,[e])=>e.value.indexOf(s.geometryType())>=0],"filter-id-in":[cr,[_o(Wn)],(s,[e])=>e.value.indexOf(s.id())>=0],"filter-in-small":[cr,[Cr,_o(Wn)],(s,[e,r])=>r.value.indexOf(s.properties()[e.value])>=0],"filter-in-large":[cr,[Cr,_o(Wn)],(s,[e,r])=>function(l,u,c,f){for(;c<=f;){const x=c+f>>1;if(u[x]===l)return!0;u[x]>l?f=x-1:c=x+1}return!1}(s.properties()[e.value],r.value,0,r.value.length-1)],all:{type:cr,overloads:[[[cr,cr],(s,[e,r])=>e.evaluate(s)&&r.evaluate(s)],[ha(cr),(s,e)=>{for(const r of e)if(!r.evaluate(s))return!1;return!0}]]},any:{type:cr,overloads:[[[cr,cr],(s,[e,r])=>e.evaluate(s)||r.evaluate(s)],[ha(cr),(s,e)=>{for(const r of e)if(r.evaluate(s))return!0;return!1}]]},"!":[cr,[cr],(s,[e])=>!e.evaluate(s)],"is-supported-script":[cr,[Cr],(s,[e])=>{const r=s.globals&&s.globals.isSupportedScript;return!r||r(e.evaluate(s))}],upcase:[Cr,[Cr],(s,[e])=>e.evaluate(s).toUpperCase()],downcase:[Cr,[Cr],(s,[e])=>e.evaluate(s).toLowerCase()],concat:[Cr,ha(Wn),(s,e)=>e.map(r=>co(r.evaluate(s))).join("")],"resolved-locale":[Cr,[uc],(s,[e])=>e.evaluate(s).resolvedLocale()],random:[dn,[dn,dn,Wn],(s,e)=>{const[r,l,u]=e.map(f=>f.evaluate(s));if(r>l||r===l)return r;let c;if(typeof u=="string")c=function(f){let x=0;if(f.length===0)return x;for(let S=0;S<f.length;S++)x=(x<<5)-x+f.charCodeAt(S),x|=0;return x}(u);else{if(typeof u!="number")throw new wi(`Invalid seed input: ${u}`);c=u}return r+Ef(c)()*(l-r)}]});class Mf{constructor(e,r,l,u){this.expression=e,this._warningHistory={},this._evaluator=new Ps(l,u),this._defaultValue=r?function(c){return c.type==="color"&&(dm(c.default)||Array.isArray(c.default))?new gr(0,0,0,0):c.type==="color"?gr.parse(c.default)||null:c.default===void 0?null:c.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null,this.configDependencies=Wd(e)}evaluateWithoutErrorHandling(e,r,l,u,c,f,x,S){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=l,this._evaluator.canonical=u||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=S||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,l,u,c,f,x,S){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=l||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=S||null;try{const C=this.expression.evaluate(this._evaluator);if(C==null||typeof C=="number"&&C!=C)return this._defaultValue;if(this._enumValues&&!(C in this._enumValues))throw new wi(`Expected value to be one of ${Object.keys(this._enumValues).map(_=>JSON.stringify(_)).join(", ")}, but found ${JSON.stringify(C)} instead.`);return C}catch(C){return this._warningHistory[C.message]||(this._warningHistory[C.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${C.message}`)),this._defaultValue}}}function Rf(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in Zu}function Jc(s,e,r,l){const u=new Ol(Zu,[],e?function(f){const x={color:lo,string:Cr,number:dn,enum:Cr,boolean:cr,formatted:ku,resolvedImage:Sl};return f.type==="array"?_o(x[f.value]||Wn,f.length):x[f.type]}(e):void 0,void 0,void 0,r,l),c=u.parse(s,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?lm(new Mf(c,e,r,l)):tl(u.errors)}class Jd{constructor(e,r,l,u){this.kind=e,this._styleExpression=r,this.isLightConstant=l,this.isLineProgressConstant=u,this.isStateDependent=e!=="constant"&&!Yd(r.expression),this.configDependencies=Wd(r.expression)}evaluateWithoutErrorHandling(e,r,l,u,c,f){return this._styleExpression.evaluateWithoutErrorHandling(e,r,l,u,c,f)}evaluate(e,r,l,u,c,f){return this._styleExpression.evaluate(e,r,l,u,c,f)}}class Qc{constructor(e,r,l,u,c,f){this.kind=e,this.zoomStops=l,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Yd(r.expression),this.isLightConstant=c,this.isLineProgressConstant=f,this.configDependencies=Wd(r.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,r,l,u,c,f){return this._styleExpression.evaluateWithoutErrorHandling(e,r,l,u,c,f)}evaluate(e,r,l,u,c,f){return this._styleExpression.evaluate(e,r,l,u,c,f)}interpolationFactor(e,r,l){return this.interpolationType?ps.interpolationFactor(this.interpolationType,e,r,l):0}}function Qd(s,e,r,l){if((s=Jc(s,e,r,l)).result==="error")return s;const u=s.value.expression,c=Vu(u);if(!c&&!Yu(e))return tl([new Ns("","data expressions not supported")]);const f=el(u,["zoom","pitch","distance-from-center"]);if(!f&&!Cf(e))return tl([new Ns("","zoom expressions not supported")]);const x=el(u,["measure-light"]);if(!x&&!yc(e))return tl([new Ns("","measure-light expression not supported")]);const S=el(u,["line-progress"]);if(!S&&!function(E){return cm(E.expression,"line-progress")}(e))return tl([new Ns("","line-progress expression not supported")]);const C=e.expression&&e.expression.relaxZoomRestriction,_=Ku(u);return _||f||C?_ instanceof Ns?tl([_]):_ instanceof ps&&!um(e)?tl([new Ns("",'"interpolate" expressions cannot be used with this property')]):lm(_?new Qc(c&&S?"camera":"composite",s.value,_.labels,_ instanceof ps?_.interpolation:void 0,x,S):new Jd(c&&S?"constant":"source",s.value,x,S)):tl([new Ns("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class eh{constructor(e,r){this._parameters=e,this._specification=r,or(this,Wu(this._parameters,this._specification))}static deserialize(e){return new eh(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ku(s){let e=null;if(s instanceof ai)e=Ku(s.result);else if(s instanceof qo){for(const r of s.args)if(e=Ku(r),e)break}else(s instanceof Ls||s instanceof ps)&&s.input instanceof Ci&&s.input.name==="zoom"&&(e=s);return e instanceof Ns||s.eachChild(r=>{const l=Ku(r);l instanceof Ns?e=l:e&&l&&e!==l&&(e=new Ns("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Ju,Bg,Fg=function(){if(Bg)return Ju;Bg=1,Ju=e;var s=3;function e(r,l,u){var c=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var f=new Int32Array(this.arrayBuffer);r=f[0],this.d=(l=f[1])+2*(u=f[2]);for(var x=0;x<this.d*this.d;x++){var S=f[s+x],C=f[s+x+1];c.push(S===C?null:f.subarray(S,C))}var _=f[s+c.length+1];this.keys=f.subarray(f[s+c.length],_),this.bboxes=f.subarray(_),this.insert=this._insertReadonly}else{this.d=l+2*u;for(var E=0;E<this.d*this.d;E++)c.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=r,this.padding=u,this.scale=l/r,this.uid=0;var M=u/l*r;this.min=-M,this.max=r+M}return e.prototype.insert=function(r,l,u,c,f){this._forEachCell(l,u,c,f,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(c),this.bboxes.push(f)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(r,l,u,c,f,x){this.cells[f].push(x)},e.prototype.query=function(r,l,u,c,f){var x=this.min,S=this.max;if(r<=x&&l<=x&&S<=u&&S<=c&&!f)return Array.prototype.slice.call(this.keys);var C=[];return this._forEachCell(r,l,u,c,this._queryCell,C,{},f),C},e.prototype._queryCell=function(r,l,u,c,f,x,S,C){var _=this.cells[f];if(_!==null)for(var E=this.keys,M=this.bboxes,A=0;A<_.length;A++){var D=_[A];if(S[D]===void 0){var I=4*D;(C?C(M[I+0],M[I+1],M[I+2],M[I+3]):r<=M[I+2]&&l<=M[I+3]&&u>=M[I+0]&&c>=M[I+1])?(S[D]=!0,x.push(E[D])):S[D]=!1}}},e.prototype._forEachCell=function(r,l,u,c,f,x,S,C){for(var _=this._convertToCellCoord(r),E=this._convertToCellCoord(l),M=this._convertToCellCoord(u),A=this._convertToCellCoord(c),D=_;D<=M;D++)for(var I=E;I<=A;I++){var B=this.d*I+D;if((!C||C(this._convertFromCellCoord(D),this._convertFromCellCoord(I),this._convertFromCellCoord(D+1),this._convertFromCellCoord(I+1)))&&f.call(this,r,l,u,c,B,x,S,C))return}},e.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},e.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,l=s+this.cells.length+1+1,u=0,c=0;c<this.cells.length;c++)u+=this.cells[c].length;var f=new Int32Array(l+u+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var x=l,S=0;S<r.length;S++){var C=r[S];f[s+S]=x,f.set(C,x),x+=C.length}return f[s+r.length]=x,f.set(this.keys,x),f[s+r.length+1]=x+=this.keys.length,f.set(this.bboxes,x),x+=this.bboxes.length,f.buffer},Ju}(),eu=ee(Fg);const kf={};function nn(s,e,r={}){Object.defineProperty(s,"_classRegistryKey",{value:e,writable:!1}),kf[e]={klass:s,omit:r.omit||[]}}nn(Object,"Object"),eu.serialize=function(s,e){const r=s.toArrayBuffer();return e&&e.add(r),{buffer:r}},eu.deserialize=function(s){return new eu(s.buffer)},Object.defineProperty(eu,"name",{value:"Grid"}),nn(eu,"Grid"),typeof DOMMatrix<"u"&&nn(DOMMatrix,"DOMMatrix"),nn(gr,"Color"),nn(Error,"Error"),nn(ko,"Formatted"),nn(Vc,"FormattedSection"),nn(pi,"AJAXError"),nn(Oo,"ResolvedImage"),nn(eh,"StylePropertyFunction"),nn(Mf,"StyleExpression",{omit:["_evaluator"]}),nn(go,"ImageId"),nn(Ha,"ImageVariant"),nn(Qc,"ZoomDependentExpression"),nn(Jd,"ZoomConstantExpression"),nn(Ci,"CompoundExpression",{omit:["_evaluate"]});for(const s in Zu)kf[Zu[s]._classRegistryKey]||nn(Zu[s],`Expression${s}`);function Of(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function hm(s){return self.ImageBitmap&&s instanceof ImageBitmap}function vc(s,e){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(Of(s)||hm(s))return e&&e.add(s),s;if(ArrayBuffer.isView(s))return e&&e.add(s.buffer),s;if(s instanceof ImageData)return e&&e.add(s.data.buffer),s;if(Array.isArray(s)){const r=[];for(const l of s)r.push(vc(l,e));return r}if(s instanceof Map){const r={$name:"Map",entries:[]};for(const[l,u]of s.entries())r.entries.push(vc(l),vc(u));return r}if(s instanceof Set){const r={$name:"Set"};let l=0;for(const u of s.values())r[++l]=vc(u);return r}if(s instanceof DOMMatrix){const r={$name:"DOMMatrix"},l=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const u of l)r[u]=s[u];return r}if(typeof s=="bigint")return{$name:"BigInt",value:s.toString()};if(typeof s=="object"){const r=s.constructor,l=r._classRegistryKey;if(!l)throw new Error(`Can't serialize object of unregistered class "${r.name}".`);const u=r.serialize?r.serialize(s,e):{};if(!r.serialize){for(const c in s)s.hasOwnProperty(c)&&(kf[l].omit.indexOf(c)>=0||(u[c]=vc(s[c],e)));s instanceof Error&&(u.message=s.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(u.$name=l),u}throw new Error("can't serialize object of type "+typeof s)}function ms(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||Of(s)||hm(s)||ArrayBuffer.isView(s)||s instanceof ImageData)return s;if(Array.isArray(s))return s.map(ms);if(typeof s=="object"){const e=s.$name||"Object";if(e==="Map"){const u=s.entries||[],c=new Map;for(let f=0;f<u.length;f+=2)c.set(ms(u[f]),ms(u[f+1]));return c}if(e==="Set"){const u=new Set;for(const c of Object.keys(s))c!=="$name"&&u.add(ms(s[c]));return u}if(e==="DOMMatrix"){let u;return u=s.is2D?[s.a,s.b,s.c,s.d,s.e,s.f]:[s.m11,s.m12,s.m13,s.m14,s.m21,s.m22,s.m23,s.m24,s.m31,s.m32,s.m33,s.m34,s.m41,s.m42,s.m43,s.m44],new DOMMatrix(u)}if(e==="BigInt")return BigInt(s.value);const{klass:r}=kf[e];if(!r)throw new Error(`Can't deserialize unregistered class "${e}".`);if(r.deserialize)return r.deserialize(s);const l=Object.create(r.prototype);for(const u of Object.keys(s))u!=="$name"&&(l[u]=ms(s[u]));return l}throw new Error("can't deserialize object of type "+typeof s)}const vn={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519,Osage:s=>s>=66736&&s<=66815,"CJK Unified Ideographs Extension B":s=>s>=131072&&s<=173791};function fm(s){for(const e of s)if(th(e.charCodeAt(0)))return!0;return!1}function Qu(s){for(const e of s)if(!pm(e.charCodeAt(0)))return!1;return!0}function pm(s){return!(vn.Arabic(s)||vn["Arabic Supplement"](s)||vn["Arabic Extended-A"](s)||vn["Arabic Presentation Forms-A"](s)||vn["Arabic Presentation Forms-B"](s))}function th(s){return!(s!==746&&s!==747&&(s<4352||!(vn["Bopomofo Extended"](s)||vn.Bopomofo(s)||vn["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||vn["CJK Compatibility Ideographs"](s)||vn["CJK Compatibility"](s)||vn["CJK Radicals Supplement"](s)||vn["CJK Strokes"](s)||!(!vn["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||vn["CJK Unified Ideographs Extension A"](s)||vn["CJK Unified Ideographs"](s)||vn["Enclosed CJK Letters and Months"](s)||vn["Hangul Compatibility Jamo"](s)||vn["Hangul Jamo Extended-A"](s)||vn["Hangul Jamo Extended-B"](s)||vn["Hangul Jamo"](s)||vn["Hangul Syllables"](s)||vn.Hiragana(s)||vn["Ideographic Description Characters"](s)||vn.Kanbun(s)||vn["Kangxi Radicals"](s)||vn["Katakana Phonetic Extensions"](s)||vn.Katakana(s)&&s!==12540||!(!vn["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!vn["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||vn["Unified Canadian Aboriginal Syllabics"](s)||vn["Unified Canadian Aboriginal Syllabics Extended"](s)||vn["Vertical Forms"](s)||vn["Yijing Hexagram Symbols"](s)||vn["Yi Syllables"](s)||vn["Yi Radicals"](s))))}function Ug(s){return!(th(s)||function(e){return!!(vn["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||vn["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||vn["Letterlike Symbols"](e)||vn["Number Forms"](e)||vn["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||vn["Control Pictures"](e)&&e!==9251||vn["Optical Character Recognition"](e)||vn["Enclosed Alphanumerics"](e)||vn["Geometric Shapes"](e)||vn["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||vn["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||vn["CJK Symbols and Punctuation"](e)||vn.Katakana(e)||vn["Private Use Area"](e)||vn["CJK Compatibility Forms"](e)||vn["Small Form Variants"](e)||vn["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(s))}function Ny(s){return vn.Arabic(s)||vn["Arabic Supplement"](s)||vn["Arabic Extended-A"](s)||vn["Arabic Presentation Forms-A"](s)||vn["Arabic Presentation Forms-B"](s)}function If(s){return s>=1424&&s<=2303||vn["Arabic Presentation Forms-A"](s)||vn["Arabic Presentation Forms-B"](s)}function ed(s,e){return!(!e&&If(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||vn.Khmer(s))}function mm(s){for(const e of s)if(If(e.charCodeAt(0)))return!0;return!1}const nh="deferred",nl="loading",gm="loaded";let yo=null,No="unavailable",rl=null;const xc=function(s){s&&typeof s=="string"&&s.indexOf("NetworkError")>-1&&(No="error"),yo&&yo(s)};function td(){bc.fire(new hs("pluginStateChange",{pluginStatus:No,pluginURL:rl}))}const bc=new Is,nd=function(){return No},jg=function(){if(No!==nh||!rl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");No=nl,td(),rl&&Va({url:rl},s=>{s?xc(s):(No=gm,td())})},vo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>No===gm||vo.applyArabicShaping!=null,isLoading:()=>No===nl,setState(s){No=s.pluginStatus,rl=s.pluginURL},isParsed:()=>vo.applyArabicShaping!=null&&vo.processBidirectionalText!=null&&vo.processStyledBidirectionalText!=null,getPluginURL:()=>rl};class Hr{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch,this.brightness=r.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(r,l){for(const u of r)if(!ed(u.charCodeAt(0),l))return!1;return!0}(e,vo.isLoaded())}}class fa{constructor(e,r,l,u){this.property=e,this.value=r,this.expression=function(c,f,x,S){if(dm(c))return new eh(c,f);if(Rf(c)||Array.isArray(c)&&c.length>0){const C=Qd(c,f,x,S);if(C.result==="error")throw new Error(C.value.map(_=>`${_.key}: ${_.message}`).join(", "));return C.value}{let C=c;return typeof c=="string"&&f.type==="color"&&(C=gr.parse(c)),{kind:"constant",configDependencies:new Set,evaluate:()=>C}}}(r===void 0?e.specification.default:r,e.specification,l,u)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,l){return this.property.possiblyEvaluate(this,e,r,l)}}class il{constructor(e,r,l){this.property=e,this.value=new fa(e,void 0,r,l)}transitioned(e,r){return new ih(this.property,this.value,r,ao({},e.transition,this.transition),e.now)}untransitioned(){return new ih(this.property,this.value,null,{},0)}}class rh{constructor(e,r,l){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=r,this._options=l,this.configDependencies=new Set}getValue(e){return qi(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new il(this._values[e].property,this._scope,this._options)),this._values[e].value=new fa(this._values[e].property,r===null?void 0:qi(r),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,r){r&&(this._options=r);const l=this._properties.properties;if(e)for(const u in e){const c=e[u];if(u.endsWith("-transition")){const f=u.slice(0,-11);l[f]&&this.setTransition(f,c)}else l.hasOwnProperty(u)&&this.setValue(u,c)}}getTransition(e){return qi(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new il(this._values[e].property)),this._values[e].transition=qi(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const l=this.getValue(r);l!==void 0&&(e[r]=l);const u=this.getTransition(r);u!==void 0&&(e[`${r}-transition`]=u)}return e}transitioned(e,r){const l=new rd(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].transitioned(e,r._values[u]);return l}untransitioned(){const e=new rd(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class ih{constructor(e,r,l,u,c){const f=u.delay||0,x=u.duration||0;c=c||0,this.property=e,this.value=r,this.begin=c+f,this.end=this.begin+x,e.specification.transition&&(u.delay||u.duration)&&(this.prior=l)}possiblyEvaluate(e,r,l){const u=e.now||0,c=this.value.possiblyEvaluate(e,r,l),f=this.prior;if(f){if(u>this.end)return this.prior=null,c;if(this.value.isDataDriven())return this.prior=null,c;if(u<this.begin)return f.possiblyEvaluate(e,r,l);{const x=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,r,l),c,ea(x))}}return c}}class rd{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,l){const u=new Ta(this._properties);for(const c of Object.keys(this._values))u._values[c]=this._values[c].possiblyEvaluate(e,r,l);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class id{constructor(e,r,l){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=r,this._options=l,this.configDependencies=new Set}getValue(e){return qi(this._values[e].value)}setValue(e,r){this._values[e]=new fa(this._values[e].property,r===null?void 0:qi(r),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const r of Object.keys(this._values)){const l=this.getValue(r);l!==void 0&&(e[r]=l)}return e}possiblyEvaluate(e,r,l){const u=new Ta(this._properties);for(const c of Object.keys(this._values))u._values[c]=this._values[c].possiblyEvaluate(e,r,l);return u}}class od{constructor(e,r,l){this.property=e,this.value=r,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,l,u){return this.property.evaluate(this.value,this.parameters,e,r,l,u)}}class Ta{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ot{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,l){const u=uf[this.specification.type];return u?u(e,r,l):e}}class en{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,l,u){return new od(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},l,u)}:e.expression,r)}interpolate(e,r,l){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new od(this,{kind:"constant",value:void 0},e.parameters);const u=uf[this.specification.type];return u?new od(this,{kind:"constant",value:u(e.value.value,r.value.value,l)},e.parameters):e}evaluate(e,r,l,u,c,f){return e.kind==="constant"?e.value:e.evaluate(r,l,u,c,f)}}class sd{constructor(e){this.specification=e}possiblyEvaluate(e,r,l,u){return!!e.expression.evaluate(r,null,{},l,u)}interpolate(){return!1}}class li{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new Hr(0,{});for(const l in e){const u=e[l];u.specification.overridable&&this.overridableProperties.push(l);const c=this.defaultPropertyValues[l]=new fa(u,void 0),f=this.defaultTransitionablePropertyValues[l]=new il(u);this.defaultTransitioningPropertyValues[l]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=c.possiblyEvaluate(r)}}}nn(en,"DataDrivenProperty"),nn(Ot,"DataConstantProperty"),nn(sd,"ColorRampProperty");var Qe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"iconsets":{"experimental":true,"type":"iconsets"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"experimental":true,"type":"*"},"selectors":{"experimental":true,"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"experimental":true,"type":"string","required":true},"properties":{"experimental":true,"type":"selectorProperty","required":false},"featureNamespace":{"experimental":true,"type":"string","required":false},"_uniqueFeatureID":{"experimental":true,"type":"boolean","private":true,"required":false}},"selectorProperty":{"experimental":true,"*":{"experimental":true,"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"required":true,"type":"enum","values":{"sprite":1}},"url":{"required":true,"type":"string"}},"iconset_source":{"type":{"required":true,"type":"enum","values":{"source":1}},"source":{"required":true,"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","experimental":true,"private":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","experimental":true,"private":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"experimental":true,"private":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"*"}}}');function _m(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function oh(s){if(Array.isArray(s))return s.map(oh);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const e={};for(const r in s)e[r]=oh(s[r]);return e}return _m(s)}function Nf(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const e of s.slice(1))if(!Nf(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Vg(s,e="",r=null,l="fill"){if(s==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Nf(s)||(s=ld(s));const u=s;let c=!0;try{c=function(_){if(!ad(_))return _;let E=oh(_);return qg(E),E=zo(E),E}(u)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(u,null,2)}
        `)}let f=null,x=null;if(l!=="background"&&l!=="sky"&&l!=="slot"){x=Qe[`filter_${l}`];const _=Jc(c,x,e,r);if(_.result==="error")throw new Error(_.value.map(E=>`${E.key}: ${E.message}`).join(", "));f=(E,M,A)=>_.value.evaluate(E,M,{},A)}let S=null,C=null;if(c!==u){const _=Jc(u,x,e,r);if(_.result==="error")throw new Error(_.value.map(E=>`${E.key}: ${E.message}`).join(", "));S=(E,M,A,D,I)=>_.value.evaluate(E,M,{},A,void 0,void 0,D,I),C=!Vu(_.value.expression)}return{filter:f,dynamicFilter:S||void 0,needGeometry:Hg(c),needFeature:!!C}}function zo(s){if(!Array.isArray(s))return s;const e=function(r){if(zy.has(r[0])){for(let l=1;l<r.length;l++)if(ad(r[l]))return!0}return r}(s);return e===!0?e:e.map(r=>zo(r))}function qg(s){let e=!1;const r=[];if(s[0]==="case"){for(let l=1;l<s.length-1;l+=2)e=e||ad(s[l]),r.push(s[l+1]);r.push(s[s.length-1])}else if(s[0]==="match"){e=e||ad(s[1]);for(let l=2;l<s.length-1;l+=2)r.push(s[l+1]);r.push(s[s.length-1])}else if(s[0]==="step"){e=e||ad(s[1]);for(let l=1;l<s.length-1;l+=2)r.push(s[l+1])}e&&(s.length=0,s.push("any",...r));for(let l=1;l<s.length;l++)qg(s[l])}function ad(s){if(!Array.isArray(s))return!1;if((e=s[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<s.length;r++)if(ad(s[r]))return!0;return!1}const zy=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Py(s,e){return s<e?-1:s>e?1:0}function Hg(s){if(!Array.isArray(s))return!1;if(s[0]==="within"||s[0]==="distance")return!0;for(let e=1;e<s.length;e++)if(Hg(s[e]))return!0;return!1}function ld(s){if(!s)return!0;const e=s[0];return s.length<=1?e!=="any":e==="=="?zl(s[1],s[2],"=="):e==="!="?tu(zl(s[1],s[2],"==")):e==="<"||e===">"||e==="<="||e===">="?zl(s[1],s[2],e):e==="any"?(r=s.slice(1),["any"].concat(r.map(ld))):e==="all"?["all"].concat(s.slice(1).map(ld)):e==="none"?["all"].concat(s.slice(1).map(ld).map(tu)):e==="in"?ym(s[1],s.slice(2)):e==="!in"?tu(ym(s[1],s.slice(2))):e==="has"?vm(s[1]):e!=="!has"||tu(vm(s[1]));var r}function zl(s,e,r){switch(s){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,s,e]}}function ym(s,e){if(e.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",s,["literal",e.sort(Py)]]:["filter-in-small",s,["literal",e]]}}function vm(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function tu(s){return["!",s]}const sh="";function nu(s,e){return e?`${s}${sh}${e}`:s}const ol="-transition",Gg=new Set(["fill","line","background","hillshade","raster"]);class Xi extends Is{constructor(e,r,l,u,c){if(super(),this.id=e.id,this.fqid=nu(this.id,l),this.type=e.type,this.scope=l,this.lut=u,this.options=c,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const f=Jc(this.filter,Qe[`filter_${e.type}`]);f.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...f.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),r.layout&&(this._unevaluatedLayout=new id(r.layout,this.scope,c),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),r.paint){this._transitionablePaint=new rh(r.paint,this.scope,c);for(const f in e.paint)this.setPaintProperty(f,e.paint[f]);for(const f in e.layout)this.setLayoutProperty(f,e.layout[f]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ta(r.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&Gg.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r){if(this.type==="custom"&&e==="visibility")return void(this.visibility=r);const l=this._unevaluatedLayout;l._properties.properties[e]&&(l.setValue(e,r),this.configDependencies=new Set([...this.configDependencies,...l.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(ol)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r){const l=this._transitionablePaint,u=l._properties.properties;if(e.endsWith(ol)){const E=e.slice(0,-11);return u[E]&&l.setTransition(E,r||void 0),!1}if(!u[e])return!1;const c=l._values[e],f=c.value.isDataDriven(),x=c.value;l.setValue(e,r),this.configDependencies=new Set([...this.configDependencies,...l.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const S=l._values[e].value,C=S.isDataDriven(),_=e.endsWith("pattern")||e==="line-dasharray";return C||f||_||this._handleOverridablePaintPropertyUpdate(e,x,S)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,r,l){return null}_handleOverridablePaintPropertyUpdate(e,r,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){return jo({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,r)=>!(e===void 0||r==="layout"&&!Object.keys(e).length||r==="paint"&&!Object.keys(e).length))}is3D(e){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof od&&Yu(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Vg(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,r,l,u,c,f,x,S,C){}}const xm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class cd{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Xr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function _r(s,e=1){let r=0,l=0;return{members:s.map(u=>{const c=xm[u.type].BYTES_PER_ELEMENT,f=r=bm(r,Math.max(e,c)),x=u.components||1;return l=Math.max(l,c),r+=c*x,{name:u.name,type:u.type,components:x,offset:f}}),size:bm(r,Math.max(l,e)),alignment:e}}function bm(s,e){return Math.ceil(s/e)*e}class Pl extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,r)}emplace(e,r,l){const u=2*e;return this.int16[u+0]=r,this.int16[u+1]=l,e}}Pl.prototype.bytesPerElement=4,nn(Pl,"StructArrayLayout2i4");class Bs extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,l)}emplace(e,r,l,u){const c=3*e;return this.int16[c+0]=r,this.int16[c+1]=l,this.int16[c+2]=u,e}}Bs.prototype.bytesPerElement=6,nn(Bs,"StructArrayLayout3i6");class sl extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,u){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,l,u)}emplace(e,r,l,u,c){const f=4*e;return this.int16[f+0]=r,this.int16[f+1]=l,this.int16[f+2]=u,this.int16[f+3]=c,e}}sl.prototype.bytesPerElement=8,nn(sl,"StructArrayLayout4i8");class ud extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}ud.prototype.bytesPerElement=4,nn(ud,"StructArrayLayout1f4");class dd extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,l)}emplace(e,r,l,u){const c=4*e,f=2*e;return this.int16[c+0]=r,this.int16[c+1]=l,this.float32[f+1]=u,e}}dd.prototype.bytesPerElement=8,nn(dd,"StructArrayLayout2i1f8");class al extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,l)}emplace(e,r,l,u){const c=4*e;return this.int16[c+0]=r,this.int16[c+1]=l,this.int16[c+2]=u,e}}al.prototype.bytesPerElement=8,nn(al,"StructArrayLayout3i8");class pa extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,u,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,l,u,c)}emplace(e,r,l,u,c,f){const x=5*e;return this.int16[x+0]=r,this.int16[x+1]=l,this.int16[x+2]=u,this.int16[x+3]=c,this.int16[x+4]=f,e}}pa.prototype.bytesPerElement=10,nn(pa,"StructArrayLayout5i10");class ah extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,c,f,x){const S=this.length;return this.resize(S+1),this.emplace(S,e,r,l,u,c,f,x)}emplace(e,r,l,u,c,f,x,S){const C=6*e,_=12*e,E=3*e;return this.int16[C+0]=r,this.int16[C+1]=l,this.uint8[_+4]=u,this.uint8[_+5]=c,this.uint8[_+6]=f,this.uint8[_+7]=x,this.float32[E+2]=S,e}}ah.prototype.bytesPerElement=12,nn(ah,"StructArrayLayout2i4ub1f12");class gs extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,l)}emplace(e,r,l,u){const c=3*e;return this.float32[c+0]=r,this.float32[c+1]=l,this.float32[c+2]=u,e}}gs.prototype.bytesPerElement=12,nn(gs,"StructArrayLayout3f12");class gi extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,l,u,c)}emplace(e,r,l,u,c,f){const x=6*e,S=3*e;return this.uint16[x+0]=r,this.uint16[x+1]=l,this.uint16[x+2]=u,this.uint16[x+3]=c,this.float32[S+2]=f,e}}gi.prototype.bytesPerElement=12,nn(gi,"StructArrayLayout4ui1f12");class wm extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,u){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,l,u)}emplace(e,r,l,u,c){const f=4*e;return this.uint16[f+0]=r,this.uint16[f+1]=l,this.uint16[f+2]=u,this.uint16[f+3]=c,e}}wm.prototype.bytesPerElement=8,nn(wm,"StructArrayLayout4ui8");class Sm extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,u,c,f){const x=this.length;return this.resize(x+1),this.emplace(x,e,r,l,u,c,f)}emplace(e,r,l,u,c,f,x){const S=6*e;return this.int16[S+0]=r,this.int16[S+1]=l,this.int16[S+2]=u,this.int16[S+3]=c,this.int16[S+4]=f,this.int16[S+5]=x,e}}Sm.prototype.bytesPerElement=12,nn(Sm,"StructArrayLayout6i12");class Tm extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,u,c,f,x,S,C,_,E,M){const A=this.length;return this.resize(A+1),this.emplace(A,e,r,l,u,c,f,x,S,C,_,E,M)}emplace(e,r,l,u,c,f,x,S,C,_,E,M,A){const D=12*e;return this.int16[D+0]=r,this.int16[D+1]=l,this.int16[D+2]=u,this.int16[D+3]=c,this.uint16[D+4]=f,this.uint16[D+5]=x,this.uint16[D+6]=S,this.uint16[D+7]=C,this.int16[D+8]=_,this.int16[D+9]=E,this.int16[D+10]=M,this.int16[D+11]=A,e}}Tm.prototype.bytesPerElement=24,nn(Tm,"StructArrayLayout4i4ui4i24");class Ea extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,c,f){const x=this.length;return this.resize(x+1),this.emplace(x,e,r,l,u,c,f)}emplace(e,r,l,u,c,f,x){const S=10*e,C=5*e;return this.int16[S+0]=r,this.int16[S+1]=l,this.int16[S+2]=u,this.float32[C+2]=c,this.float32[C+3]=f,this.float32[C+4]=x,e}}Ea.prototype.bytesPerElement=20,nn(Ea,"StructArrayLayout3i3f20");class ru extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,l,u)}emplace(e,r,l,u,c){const f=4*e;return this.float32[f+0]=r,this.float32[f+1]=l,this.float32[f+2]=u,this.float32[f+3]=c,e}}ru.prototype.bytesPerElement=16,nn(ru,"StructArrayLayout4f16");class zf extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}zf.prototype.bytesPerElement=4,nn(zf,"StructArrayLayout1ul4");class Aa extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,r)}emplace(e,r,l){const u=2*e;return this.uint16[u+0]=r,this.uint16[u+1]=l,e}}Aa.prototype.bytesPerElement=4,nn(Aa,"StructArrayLayout2ui4");class iu extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,u,c,f,x,S,C,_,E,M,A){const D=this.length;return this.resize(D+1),this.emplace(D,e,r,l,u,c,f,x,S,C,_,E,M,A)}emplace(e,r,l,u,c,f,x,S,C,_,E,M,A,D){const I=20*e,B=10*e;return this.int16[I+0]=r,this.int16[I+1]=l,this.int16[I+2]=u,this.int16[I+3]=c,this.int16[I+4]=f,this.float32[B+3]=x,this.float32[B+4]=S,this.float32[B+5]=C,this.float32[B+6]=_,this.int16[I+14]=E,this.uint32[B+8]=M,this.uint16[I+18]=A,this.uint16[I+19]=D,e}}iu.prototype.bytesPerElement=40,nn(iu,"StructArrayLayout5i4f1i1ul2ui40");class lh extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,u,c,f,x){const S=this.length;return this.resize(S+1),this.emplace(S,e,r,l,u,c,f,x)}emplace(e,r,l,u,c,f,x,S){const C=8*e;return this.int16[C+0]=r,this.int16[C+1]=l,this.int16[C+2]=u,this.int16[C+4]=c,this.int16[C+5]=f,this.int16[C+6]=x,this.int16[C+7]=S,e}}lh.prototype.bytesPerElement=16,nn(lh,"StructArrayLayout3i2i2i16");class Pf extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,u,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,l,u,c)}emplace(e,r,l,u,c,f){const x=4*e,S=8*e;return this.float32[x+0]=r,this.float32[x+1]=l,this.float32[x+2]=u,this.int16[S+6]=c,this.int16[S+7]=f,e}}Pf.prototype.bytesPerElement=16,nn(Pf,"StructArrayLayout2f1f2i16");class Em extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,c,f){const x=this.length;return this.resize(x+1),this.emplace(x,e,r,l,u,c,f)}emplace(e,r,l,u,c,f,x){const S=20*e,C=5*e;return this.uint8[S+0]=r,this.uint8[S+1]=l,this.float32[C+1]=u,this.float32[C+2]=c,this.float32[C+3]=f,this.float32[C+4]=x,e}}Em.prototype.bytesPerElement=20,nn(Em,"StructArrayLayout2ub4f20");class xo extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,l)}emplace(e,r,l,u){const c=3*e;return this.uint16[c+0]=r,this.uint16[c+1]=l,this.uint16[c+2]=u,e}}xo.prototype.bytesPerElement=6,nn(xo,"StructArrayLayout3ui6");class Am extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,c,f,x,S,C,_,E,M,A,D,I,B,U,G,H,q,Y){const J=this.length;return this.resize(J+1),this.emplace(J,e,r,l,u,c,f,x,S,C,_,E,M,A,D,I,B,U,G,H,q,Y)}emplace(e,r,l,u,c,f,x,S,C,_,E,M,A,D,I,B,U,G,H,q,Y,J){const ne=30*e,me=15*e,ce=60*e;return this.int16[ne+0]=r,this.int16[ne+1]=l,this.int16[ne+2]=u,this.float32[me+2]=c,this.float32[me+3]=f,this.uint16[ne+8]=x,this.uint16[ne+9]=S,this.uint32[me+5]=C,this.uint32[me+6]=_,this.uint32[me+7]=E,this.uint16[ne+16]=M,this.uint16[ne+17]=A,this.uint16[ne+18]=D,this.float32[me+10]=I,this.float32[me+11]=B,this.uint8[ce+48]=U,this.uint8[ce+49]=G,this.uint8[ce+50]=H,this.uint32[me+13]=q,this.int16[ne+28]=Y,this.uint8[ce+58]=J,e}}Am.prototype.bytesPerElement=60,nn(Am,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Lf extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,c,f,x,S,C,_,E,M,A,D,I,B,U,G,H,q,Y,J,ne,me,ce,ue,Ee,_e,De,Le,Ne,Ge,Ve){const Ke=this.length;return this.resize(Ke+1),this.emplace(Ke,e,r,l,u,c,f,x,S,C,_,E,M,A,D,I,B,U,G,H,q,Y,J,ne,me,ce,ue,Ee,_e,De,Le,Ne,Ge,Ve)}emplace(e,r,l,u,c,f,x,S,C,_,E,M,A,D,I,B,U,G,H,q,Y,J,ne,me,ce,ue,Ee,_e,De,Le,Ne,Ge,Ve,Ke){const Ze=20*e,Je=40*e,vt=80*e;return this.float32[Ze+0]=r,this.float32[Ze+1]=l,this.int16[Je+4]=u,this.int16[Je+5]=c,this.int16[Je+6]=f,this.int16[Je+7]=x,this.int16[Je+8]=S,this.int16[Je+9]=C,this.int16[Je+10]=_,this.int16[Je+11]=E,this.int16[Je+12]=M,this.uint16[Je+13]=A,this.uint16[Je+14]=D,this.uint16[Je+15]=I,this.uint16[Je+16]=B,this.uint16[Je+17]=U,this.uint16[Je+18]=G,this.uint16[Je+19]=H,this.uint16[Je+20]=q,this.uint16[Je+21]=Y,this.uint16[Je+22]=J,this.uint16[Je+23]=ne,this.uint16[Je+24]=me,this.uint16[Je+25]=ce,this.uint16[Je+26]=ue,this.uint16[Je+27]=Ee,this.uint32[Ze+14]=_e,this.float32[Ze+15]=De,this.float32[Ze+16]=Le,this.float32[Ze+17]=Ne,this.float32[Ze+18]=Ge,this.uint8[vt+76]=Ve,this.uint16[Je+39]=Ke,e}}Lf.prototype.bytesPerElement=80,nn(Lf,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Fs extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,l,u,c)}emplace(e,r,l,u,c,f){const x=5*e;return this.float32[x+0]=r,this.float32[x+1]=l,this.float32[x+2]=u,this.float32[x+3]=c,this.float32[x+4]=f,e}}Fs.prototype.bytesPerElement=20,nn(Fs,"StructArrayLayout5f20");class ou extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,c,f,x){const S=this.length;return this.resize(S+1),this.emplace(S,e,r,l,u,c,f,x)}emplace(e,r,l,u,c,f,x,S){const C=7*e;return this.float32[C+0]=r,this.float32[C+1]=l,this.float32[C+2]=u,this.float32[C+3]=c,this.float32[C+4]=f,this.float32[C+5]=x,this.float32[C+6]=S,e}}ou.prototype.bytesPerElement=28,nn(ou,"StructArrayLayout7f28");class Ca extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,c,f,x,S,C,_,E){const M=this.length;return this.resize(M+1),this.emplace(M,e,r,l,u,c,f,x,S,C,_,E)}emplace(e,r,l,u,c,f,x,S,C,_,E,M){const A=11*e;return this.float32[A+0]=r,this.float32[A+1]=l,this.float32[A+2]=u,this.float32[A+3]=c,this.float32[A+4]=f,this.float32[A+5]=x,this.float32[A+6]=S,this.float32[A+7]=C,this.float32[A+8]=_,this.float32[A+9]=E,this.float32[A+10]=M,e}}Ca.prototype.bytesPerElement=44,nn(Ca,"StructArrayLayout11f44");class Cm extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,c,f,x,S,C){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,l,u,c,f,x,S,C)}emplace(e,r,l,u,c,f,x,S,C,_){const E=9*e;return this.float32[E+0]=r,this.float32[E+1]=l,this.float32[E+2]=u,this.float32[E+3]=c,this.float32[E+4]=f,this.float32[E+5]=x,this.float32[E+6]=S,this.float32[E+7]=C,this.float32[E+8]=_,e}}Cm.prototype.bytesPerElement=36,nn(Cm,"StructArrayLayout9f36");class ch extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,r)}emplace(e,r,l){const u=2*e;return this.float32[u+0]=r,this.float32[u+1]=l,e}}ch.prototype.bytesPerElement=8,nn(ch,"StructArrayLayout2f8");class uh extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,u){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,l,u)}emplace(e,r,l,u,c){const f=6*e;return this.uint32[3*e+0]=r,this.uint16[f+2]=l,this.uint16[f+3]=u,this.uint16[f+4]=c,e}}uh.prototype.bytesPerElement=12,nn(uh,"StructArrayLayout1ul3ui12");class dh extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}dh.prototype.bytesPerElement=2,nn(dh,"StructArrayLayout1ui2");class Bf extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,c,f,x,S,C,_,E,M,A,D,I,B){const U=this.length;return this.resize(U+1),this.emplace(U,e,r,l,u,c,f,x,S,C,_,E,M,A,D,I,B)}emplace(e,r,l,u,c,f,x,S,C,_,E,M,A,D,I,B,U){const G=16*e;return this.float32[G+0]=r,this.float32[G+1]=l,this.float32[G+2]=u,this.float32[G+3]=c,this.float32[G+4]=f,this.float32[G+5]=x,this.float32[G+6]=S,this.float32[G+7]=C,this.float32[G+8]=_,this.float32[G+9]=E,this.float32[G+10]=M,this.float32[G+11]=A,this.float32[G+12]=D,this.float32[G+13]=I,this.float32[G+14]=B,this.float32[G+15]=U,e}}Bf.prototype.bytesPerElement=64,nn(Bf,"StructArrayLayout16f64");class hh extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,c,f,x){const S=this.length;return this.resize(S+1),this.emplace(S,e,r,l,u,c,f,x)}emplace(e,r,l,u,c,f,x,S){const C=10*e,_=5*e;return this.uint16[C+0]=r,this.uint16[C+1]=l,this.uint16[C+2]=u,this.uint16[C+3]=c,this.float32[_+2]=f,this.float32[_+3]=x,this.float32[_+4]=S,e}}hh.prototype.bytesPerElement=20,nn(hh,"StructArrayLayout4ui3f20");class fh extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.int16[1*e+0]=r,e}}fh.prototype.bytesPerElement=2,nn(fh,"StructArrayLayout1i2");class ph extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint8[1*e+0]=r,e}}ph.prototype.bytesPerElement=1,nn(ph,"StructArrayLayout1ub1");class $g extends cd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}$g.prototype.size=40;class mh extends iu{get(e){return new $g(this,e)}}nn(mh,"CollisionBoxArray");class Ly extends cd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Ly.prototype.size=60;class Zg extends Am{get(e){return new Ly(this,e)}}nn(Zg,"PlacedSymbolArray");class Yg extends cd{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Yg.prototype.size=80;class Ll extends Lf{get(e){return new Yg(this,e)}}nn(Ll,"SymbolInstanceArray");class Wg extends ud{getoffsetX(e){return this.float32[1*e+0]}}nn(Wg,"GlyphOffsetArray");class gh extends Pl{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}nn(gh,"SymbolLineVertexArray");class Ff extends cd{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Ff.prototype.size=12;class Qo extends uh{get(e){return new Ff(this,e)}}nn(Qo,"FeatureIndexArray");class Ho extends Aa{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}nn(Ho,"FillExtrusionCentroidArray");class Xg extends cd{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Xg.prototype.size=6;class Us extends Bs{get(e){return new Xg(this,e)}}nn(Us,"FillExtrusionWallArray");const By=_r([{name:"a_pos",components:2,type:"Int16"}],4),wc=_r([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ri{constructor(e=[]){this.segments=e}_prepareSegment(e,r,l,u){let c=this.segments[this.segments.length-1];return e>ri.MAX_VERTEX_ARRAY_LENGTH&&xe(`Max vertices per segment is ${ri.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!c||c.vertexLength+e>ri.MAX_VERTEX_ARRAY_LENGTH||c.sortKey!==u)&&(c={vertexOffset:r,primitiveOffset:l,vertexLength:0,primitiveLength:0},u!==void 0&&(c.sortKey=u),this.segments.push(c)),c}prepareSegment(e,r,l,u){return this._prepareSegment(e,r.length,l.length,u)}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,l,u){return new ri([{vertexOffset:e,primitiveOffset:r,vertexLength:l,primitiveLength:u,vaos:{},sortKey:0}])}}function su(s,e){return 256*(s=$n(Math.floor(s),0,255))+$n(Math.floor(e),0,255)}ri.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,nn(ri,"SegmentVector");const Dm=_r([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Sc=_r([{name:"a_dash",components:4,type:"Uint16"}]);class hd{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,r,l,u){this.ids.push(Uf(e)),this.positions.push(r,l,u)}eachPosition(e,r){const l=Uf(e);let u=0,c=this.ids.length-1;for(;u<c;){const f=u+c>>1;this.ids[f]>=l?c=f:u=f+1}for(;this.ids[u]===l;)r(this.positions[3*u],this.positions[3*u+1],this.positions[3*u+2]),u++}static serialize(e,r){const l=new Float64Array(e.ids),u=new Uint32Array(e.positions);return js(l,u,0,l.length-1),r&&(r.add(l.buffer),r.add(u.buffer)),{ids:l,positions:u}}static deserialize(e){const r=new hd;let l;r.ids=e.ids,r.positions=e.positions;for(const u of r.ids)u!==l&&r.uniqueIds.push(u),l=u;return r.indexed=!0,r}}function Uf(s){const e=+s;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Os(String(s))}function js(s,e,r,l){for(;r<l;){const u=s[r+l>>1];let c=r-1,f=l+1;for(;;){do c++;while(s[c]<u);do f--;while(s[f]>u);if(c>=f)break;jf(s,c,f),jf(e,3*c,3*f),jf(e,3*c+1,3*f+1),jf(e,3*c+2,3*f+2)}f-r<l-f?(js(s,e,r,f),r=f+1):(js(s,e,f+1,l),l=f)}}function jf(s,e,r){const l=s[e];s[e]=s[r],s[r]=l}nn(hd,"FeaturePositionMap");class _s{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}set(e,r,l){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class _h extends _s{constructor(e){super(e),this.current=0}set(e,r,l){this.fetchUniformLocation(e,r)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}}class Ti extends _s{constructor(e){super(e),this.current=0}set(e,r,l){this.fetchUniformLocation(e,r)&&this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class Go extends _s{constructor(e){super(e),this.current=[0,0]}set(e,r,l){this.fetchUniformLocation(e,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}}class fd extends _s{constructor(e){super(e),this.current=[0,0,0]}set(e,r,l){this.fetchUniformLocation(e,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}}class yh extends _s{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,l){this.fetchUniformLocation(e,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3])))}}class vh extends _s{constructor(e){super(e),this.current=gr.transparent.toRenderColor(null)}set(e,r,l){this.fetchUniformLocation(e,r)&&(l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a)))}}const Kg=new Float32Array(16);class au extends _s{constructor(e){super(e),this.current=Kg}set(e,r,l){if(this.fetchUniformLocation(e,r)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let u=1;u<16;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}}const Mm=new Float32Array(9),Fy=new Float32Array(4);class Jg extends _s{constructor(e){super(e),this.current=Fy}set(e,r,l){if(this.fetchUniformLocation(e,r)){for(let u=0;u<4;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}}}function Rm(s){return[su(255*s.r,255*s.g),su(255*s.b,255*s.a)]}class $o{constructor(e,r,l,u){this.value=e,this.uniformNames=r.map(c=>`u_${c}`),this.type=l,this.context=u}setUniform(e,r,l,u,c){const f=u.constantOr(this.value);r.set(e,c,f instanceof gr?f.toRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):f)}getBinding(e,r){return this.type==="color"?new vh(e):new Ti(e)}}class lu{constructor(e,r){this.uniformNames=r.map(l=>`u_${l}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,r,l,u,c){const f=c==="u_pattern"||c==="u_dash"?this.pattern:c==="u_pixel_ratio"?this.pixelRatio:null;f&&r.set(e,c,f)}getBinding(e,r){return r==="u_pattern"||r==="u_dash"?new yh(e):new Ti(e)}}class Ei{constructor(e,r,l,u){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=r.map(c=>({name:`a_${c}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,r,l,u,c,f,x){const S=this.paintVertexArray.length,C=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Hr(0,{brightness:f}),r,{},c,u,x):this.expression.kind==="constant"&&this.expression.value,_=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Hr(0,{brightness:f}),r,{},c,u,x):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(S,e,C,_?null:this.context.lut)}updatePaintArray(e,r,l,u,c,f,x){const S=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:x},l,u,void 0,c):this.expression.kind==="constant"&&this.expression.value,C=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Hr(0,{brightness:x}),l,u,void 0,c):this.lutExpression.value)==="none";this._setPaintValue(e,r,S,C?null:this.context.lut)}_setPaintValue(e,r,l,u){if(this.type==="color"){const c=Rm(l.toRenderColor(u));for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,c[0],c[1])}else{for(let c=e;c<r;c++)this.paintVertexArray.emplace(c,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Da{constructor(e,r,l,u,c,f){this.expression=e,this.uniformNames=r.map(x=>`u_${x}_t`),this.type=l,this.useIntegerZoom=u,this.context=c,this.maxValue=0,this.paintVertexAttributes=r.map(x=>({name:`a_${x}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,r,l,u,c,f,x){const S=this.expression.evaluate(new Hr(this.context.zoom,{brightness:f}),r,{},c,u,x),C=this.expression.evaluate(new Hr(this.context.zoom+1,{brightness:f}),r,{},c,u,x),_=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Hr(0,{brightness:f}),r,{},c,u,x):this.lutExpression.value)==="none",E=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(E,e,S,C,_?null:this.context.lut)}updatePaintArray(e,r,l,u,c,f,x){const S=this.expression.evaluate({zoom:this.context.zoom,brightness:x},l,u,void 0,c),C=this.expression.evaluate({zoom:this.context.zoom+1,brightness:x},l,u,void 0,c),_=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Hr(0,{brightness:x}),l,u,void 0,c):this.lutExpression.value)==="none";this._setPaintValue(e,r,S,C,_?null:this.context.lut)}_setPaintValue(e,r,l,u,c){if(this.type==="color"){const f=Rm(l.toRenderColor(c)),x=Rm(l.toRenderColor(c));for(let S=e;S<r;S++)this.paintVertexArray.emplace(S,f[0],f[1],x[0],x[1])}else{for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,l,u);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,l,u,c){const f=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,x=$n(this.expression.interpolationFactor(f,this.context.zoom,this.context.zoom+1),0,1);r.set(e,c,x)}getBinding(e,r){return new Ti(e)}}class Tc{constructor(e,r,l,u,c){this.expression=e,this.layerId=c,this.paintVertexAttributes=(l==="array"?Sc:Dm).members;for(let f=0;f<r.length;++f);this.paintVertexArray=new u}populatePaintArray(e,r,l,u){const c=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(c,e,r.patterns&&r.patterns[this.layerId],l)}updatePaintArray(e,r,l,u,c,f,x){this._setPaintValues(e,r,l.patterns&&l.patterns[this.layerId],f)}_setPaintValues(e,r,l,u){if(!u||!l)return;const c=u[l];if(!c)return;const{tl:f,br:x,pixelRatio:S}=c;for(let C=e;C<r;C++)this.paintVertexArray.emplace(C,f[0],f[1],x[0],x[1],S)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class pd{constructor(e,r,l=()=>!0){this.binders={},this._buffers=[],this.context=r;const u=[];for(const c in e.paint._values){const f=e.paint.get(c);if(c.endsWith("-use-theme")||!l(c)||!(f instanceof od&&Yu(f.property.specification)))continue;const x=Qg(c,e.type),S=f.value,C=f.property.specification.type,_=!!f.property.useIntegerZoom,E=c==="line-dasharray"||c.endsWith("pattern"),M=e.paint.get(`${c}-use-theme`),A=c==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||M&&M.value.kind!=="constant";if(S.kind!=="constant"||A)if(S.kind==="source"||A||E){const D=e_(c,C,"source");this.binders[c]=E?new Tc(S,x,C,D,e.id):new Ei(S,x,C,D),u.push(`/a_${c}`)}else{const D=e_(c,C,"composite");this.binders[c]=new Da(S,x,C,_,r,D),u.push(`/z_${c}`)}else this.binders[c]=E?new lu(S.value,x):new $o(S.value,x,C,r),u.push(`/u_${c}`);M&&(this.binders[c].lutExpression=M.value)}this.cacheKey=u.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof Ei||r instanceof Da?r.maxValue:0}populatePaintArrays(e,r,l,u,c,f,x){for(const S in this.binders){const C=this.binders[S];C.context=this.context,(C instanceof Ei||C instanceof Da||C instanceof Tc)&&C.populatePaintArray(e,r,l,u,c,f,x)}}setConstantPatternPositions(e){for(const r in this.binders){const l=this.binders[r];l instanceof lu&&l.setConstantPatternPositions(e)}}updatePaintArrays(e,r,l,u,c,f,x,S,C){let _=!1;const E=Object.keys(e),M=E.length!==0&&!S,A=M?E:r.uniqueIds;this.context.lut=c.lut;for(const D in this.binders){const I=this.binders[D];if(I.context=this.context,(I instanceof Ei||I instanceof Da||I instanceof Tc)&&I.expression&&I.expression.kind&&I.expression.kind!=="constant"&&(I.expression.isStateDependent===!0||I.expression.isLightConstant===!1)){const B=c.paint.get(D);I.expression=B.value;for(const U of A){const G=e[U.toString()];r.eachPosition(U,(H,q,Y)=>{const J=u.feature(H);I.updatePaintArray(q,Y,J,G,f,x,C)})}if(!M)for(const U of l.uniqueIds){const G=e[U.toString()];l.eachPosition(U,(H,q,Y)=>{const J=u.feature(H);I.updatePaintArray(q,Y,J,G,f,x,C)})}_=!0}}return _}defines(){const e=[];for(const r in this.binders){const l=this.binders[r];(l instanceof $o||l instanceof lu)&&e.push(...l.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const l=this.binders[r];if(l instanceof Ei||l instanceof Da||l instanceof Tc)for(let u=0;u<l.paintVertexAttributes.length;u++)e.push(l.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const l=this.binders[r];if(l instanceof $o||l instanceof lu||l instanceof Da)for(const u of l.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const r=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof $o||u instanceof lu||u instanceof Da)for(const c of u.uniformNames)r.push({name:c,property:l,binding:u.getBinding(e,c)})}return r}setUniforms(e,r,l,u,c){for(const{name:f,property:x,binding:S}of l)this.binders[x].setUniform(e,S,c,u.get(x),f)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const r=this.binders[e];(r instanceof Ei||r instanceof Da||r instanceof Tc)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(const r in this.binders){const l=this.binders[r];(l instanceof Ei||l instanceof Da||l instanceof Tc)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof Ei||r instanceof Da||r instanceof Tc)&&r.destroy()}}}class ys{constructor(e,r,l=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new pd(u,r,l);this.needsUpload=!1,this._featureMap=new hd,this._featureMapWithoutIds=new hd,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,r,l,u,c,f,x,S){for(const C in this.programConfigurations)this.programConfigurations[C].populatePaintArrays(e,r,u,c,f,x,S);r.id!==void 0?this._featureMap.add(r.id,l,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,l,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,l,u,c,f,x){for(const S of l)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,r,S,u,c,f,x||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const xh={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Qg(s,e){return xh[s]||[s.replace(`${e}-`,"").replace(/-/g,"_")]}const bh={"line-pattern":{source:gi,composite:gi},"fill-pattern":{source:gi,composite:gi},"fill-extrusion-pattern":{source:gi,composite:gi},"line-dasharray":{source:wm,composite:wm}},Vf={color:{source:ch,composite:ru},number:{source:ud,composite:ch}};function e_(s,e,r){const l=bh[s];return l&&l[r]||Vf[e][r]}nn($o,"ConstantBinder"),nn(lu,"PatternConstantBinder"),nn(Ei,"SourceExpressionBinder"),nn(Tc,"PatternCompositeBinder"),nn(Da,"CompositeExpressionBinder"),nn(pd,"ProgramConfiguration",{omit:["_buffers"]}),nn(ys,"ProgramConfigurationSet");const Zo=zt/Math.PI/2,cu=5,km=6,t_=16383,wh=64,Om=[wh,32,16],Vs=-Zo,qs=Zo;function Sh(s,e,r,l=Zo){return r=Jn(r),[s*Math.sin(r)*l,-e*l,s*Math.cos(r)*l]}function Ma(s,e,r){return Sh(Math.cos(Jn(s)),Math.sin(Jn(s)),e,r)}const Bl=63710088e-1,Im=2*Math.PI*Bl;class hr{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new hr(Fa(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,l=this.lat*r,u=e.lat*r,c=Math.sin(l)*Math.sin(u)+Math.cos(l)*Math.cos(u)*Math.cos((e.lng-this.lng)*r);return Bl*Math.acos(Math.min(c,1))}toBounds(e=0){const r=360*e/40075017,l=r/Math.cos(Math.PI/180*this.lat);return new Ec({lng:this.lng-l,lat:this.lat-r},{lng:this.lng+l,lat:this.lat+r})}toEcef(e){return Ma(this.lat,this.lng,Zo+e*Zo/Bl)}static convert(e){if(e instanceof hr)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new hr(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new hr(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Ec{constructor(e,r){if(e)if(r)this.setSouthWest(e).setNorthEast(r);else if(e.length===4){const l=e;this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]])}else{const l=e;this.setSouthWest(l[0]).setNorthEast(l[1])}}setNorthEast(e){return this._ne=e instanceof hr?new hr(e.lng,e.lat):hr.convert(e),this}setSouthWest(e){return this._sw=e instanceof hr?new hr(e.lng,e.lat):hr.convert(e),this}extend(e){const r=this._sw,l=this._ne;let u,c;if(e instanceof hr)u=e,c=e;else{if(!(e instanceof Ec))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ec.convert(e)):this.extend(hr.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(hr.convert(e)):this;if(u=e._sw,c=e._ne,!u||!c)return this}return r||l?(r.lng=Math.min(u.lng,r.lng),r.lat=Math.min(u.lat,r.lat),l.lng=Math.max(c.lng,l.lng),l.lat=Math.max(c.lat,l.lat)):(this._sw=new hr(u.lng,u.lat),this._ne=new hr(c.lng,c.lat)),this}getCenter(){return new hr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new hr(this.getWest(),this.getNorth())}getSouthEast(){return new hr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:l}=hr.convert(e);let u=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(e){if(e)return e instanceof Ec?e:new Ec(e)}}const Uy=0,jy=25.5;function Nm(s){return Im*Math.cos(s*Math.PI/180)}function ll(s){return(180+s)/360}function Ki(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function bo(s,e){return s/Nm(e)}function vs(s){return 360*s-180}function Sr(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function qf(s,e){return s*Nm(Sr(e))}const xs=85.051129;function n_(s){return Math.cos(Jn($n(s,-85.051129,xs)))}function uu(s,e){const r=$n(e,Uy,jy),l=Math.pow(2,r);return n_(s)*Im/(512*l)}function r0(s){return 1/Math.cos(s*Math.PI/180)}function h(s,e=0){const r=Math.exp(Math.PI*(1-(s.y+e/zt)/(1<<s.z)*2));return 80150034*r/(r*r+1)/zt/(1<<s.z)}class t{constructor(e,r,l=0){this.x=+e,this.y=+r,this.z=+l}static fromLngLat(e,r=0){const l=hr.convert(e);return new t(ll(l.lng),Ki(l.lat),bo(r,l.lat))}toLngLat(){return new hr(vs(this.x),Sr(this.y))}toAltitude(){return qf(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Im*r0(Sr(this.y))}}function i(s,e,r,l,u,c,f,x,S){const C=(e+l)/2,_=(r+u)/2,E=new qt(C,_);x(E),function(M,A,D,I,B,U){const G=D-B,H=I-U;return Math.abs((I-A)*G-(D-M)*H)/Math.hypot(G,H)}(E.x,E.y,c.x,c.y,f.x,f.y)>=S?(i(s,e,r,C,_,c,E,x,S),i(s,C,_,l,u,E,f,x,S)):s.push(f)}function d(s,e,r){let l=s[0],u=l.x,c=l.y;e(l);const f=[l];for(let x=1;x<s.length;x++){const S=s[x],{x:C,y:_}=S;e(S),i(f,u,c,C,_,l,S,e,r),u=C,c=_,l=S}return f}function m(s,e,r,l){if(l(e,r)){const u=e.add(r)._mult(.5);m(s,e,u,l),m(s,u,r,l)}else s.push(r)}function v(s,e){let r=s[0];const l=[r];for(let u=1;u<s.length;u++){const c=s[u];m(l,r,c,e),r=c}return l}const w=Math.pow(2,14)-1,R=-w-1;function N(s,e){const r=Math.round(s.x*e),l=Math.round(s.y*e);return s.x=$n(r,R,w),s.y=$n(l,R,w),(r<s.x||r>s.x+1||l<s.y||l>s.y+1)&&xe("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function P(s,e,r){const l=s.loadGeometry(),u=s.extent,c=zt/u;if(e&&r&&r.projection.isReprojectedInTileSpace){const f=1<<e.z,{scale:x,x:S,y:C,projection:_}=r,E=M=>{const A=vs((e.x+M.x/u)/f),D=Sr((e.y+M.y/u)/f),I=_.project(A,D);M.x=(I.x*x-S)*u,M.y=(I.y*x-C)*u};for(let M=0;M<l.length;M++)if(s.type!==1)l[M]=d(l[M],E,1);else{const A=[];for(const D of l[M])D.x<0||D.x>=u||D.y<0||D.y>=u||(E(D),A.push(D));l[M]=A}}for(const f of l)for(const x of f)N(x,c);return l}function F(s,e){return{type:s.type,id:s.id,properties:s.properties,geometry:e?P(s):[]}}function V(s,e,r,l,u){s.emplaceBack(2*e+(l+1)/2,2*r+(u+1)/2)}function j(s,e,r){s.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class Z{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Pl,this.indexArray=new xo,this.segments=new ri,this.programConfigurations=new ys(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}updateFootprints(e,r){}populate(e,r,l,u){const c=this.layers[0],f=[];let x=null;c.type==="circle"&&(x=c.layout.get("circle-sort-key"));for(const{feature:C,id:_,index:E,sourceLayerIndex:M}of e){const A=this.layers[0]._featureFilter.needGeometry,D=F(C,A);if(!this.layers[0]._featureFilter.filter(new Hr(this.zoom),D,l))continue;const I=x?x.evaluate(D,{},l):void 0,B={id:_,properties:C.properties,type:C.type,sourceLayerIndex:M,index:E,geometry:A?D.geometry:P(C,l,u),patterns:{},sortKey:I};f.push(B)}x&&f.sort((C,_)=>C.sortKey-_.sortKey);let S=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new Sm,S=u.projection);for(const C of f){const{geometry:_,index:E,sourceLayerIndex:M}=C,A=e[E].feature;this.addFeature(C,_,E,r.availableImages,l,S,r.brightness),r.featureIndex.insert(A,_,E,M,this.index)}}update(e,r,l,u,c,f,x){this.programConfigurations.updatePaintArrays(e,r,c,l,u,f,x)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,By.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,wc.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,l,u,c,f,x){for(const S of r)for(const C of S){const _=C.x,E=C.y;if(_<0||_>=zt||E<0||E>=zt)continue;if(f){const D=f.projectTilePoint(_,E,c),I=f.upVector(c,_,E),B=this.globeExtVertexArray;j(B,D,I),j(B,D,I),j(B,D,I),j(B,D,I)}const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),A=M.vertexLength;V(this.layoutVertexArray,_,E,-1,-1),V(this.layoutVertexArray,_,E,1,-1),V(this.layoutVertexArray,_,E,1,1),V(this.layoutVertexArray,_,E,-1,1),this.indexArray.emplaceBack(A,A+1,A+2),this.indexArray.emplaceBack(A,A+2,A+3),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},u,c,x)}}function Q(s,e){for(let r=0;r<s.length;r++)if(Se(e,s[r]))return!0;for(let r=0;r<e.length;r++)if(Se(s,e[r]))return!0;return!!pe(s,e)}function K(s,e,r){return!!Se(s,e)||!!ye(e,s,r)}function te(s,e){if(s.length===1)return ve(e,s[0]);for(let r=0;r<e.length;r++){const l=e[r];for(let u=0;u<l.length;u++)if(Se(s,l[u]))return!0}for(let r=0;r<s.length;r++)if(ve(e,s[r]))return!0;for(let r=0;r<e.length;r++)if(pe(s,e[r]))return!0;return!1}function re(s,e,r){if(s.length>1){if(pe(s,e))return!0;for(let l=0;l<e.length;l++)if(ye(e[l],s,r))return!0}for(let l=0;l<s.length;l++)if(ye(s[l],e,r))return!0;return!1}function pe(s,e){if(s.length===0||e.length===0)return!1;for(let r=0;r<s.length-1;r++){const l=s[r],u=s[r+1];for(let c=0;c<e.length-1;c++)if(be(l,u,e[c],e[c+1]))return!0}return!1}function be(s,e,r,l){return it(s,r,l)!==it(e,r,l)&&it(s,e,r)!==it(s,e,l)}function ye(s,e,r){const l=r*r;if(e.length===1)return s.distSqr(e[0])<l;for(let u=1;u<e.length;u++)if(Ae(s,e[u-1],e[u])<l)return!0;return!1}function Ae(s,e,r){const l=e.distSqr(r);if(l===0)return s.distSqr(e);const u=((s.x-e.x)*(r.x-e.x)+(s.y-e.y)*(r.y-e.y))/l;return s.distSqr(u<0?e:u>1?r:r.sub(e)._mult(u)._add(e))}function ve(s,e){let r,l,u,c=!1;for(let f=0;f<s.length;f++){r=s[f];for(let x=0,S=r.length-1;x<r.length;S=x++)l=r[x],u=r[S],l.y>e.y!=u.y>e.y&&e.x<(u.x-l.x)*(e.y-l.y)/(u.y-l.y)+l.x&&(c=!c)}return c}function Se(s,e){let r=!1;for(let l=0,u=s.length-1;l<s.length;u=l++){const c=s[l],f=s[u];c.y>e.y!=f.y>e.y&&e.x<(f.x-c.x)*(e.y-c.y)/(f.y-c.y)+c.x&&(r=!r)}return r}function Te(s,e,r,l,u){for(const f of s)if(e<=f.x&&r<=f.y&&l>=f.x&&u>=f.y)return!0;const c=[new qt(e,r),new qt(e,u),new qt(l,u),new qt(l,r)];if(s.length>2){for(const f of c)if(Se(s,f))return!0}for(let f=0;f<s.length-1;f++)if(Me(s[f],s[f+1],c))return!0;return!1}function Me(s,e,r){const l=r[0],u=r[2];if(s.x<l.x&&e.x<l.x||s.x>u.x&&e.x>u.x||s.y<l.y&&e.y<l.y||s.y>u.y&&e.y>u.y)return!1;const c=it(s,e,r[0]);return c!==it(s,e,r[1])||c!==it(s,e,r[2])||c!==it(s,e,r[3])}function ze(s,e,r,l,u,c){let f=e.y-s.y,x=s.x-e.x;if(c=c||0){const S=f*f+x*x;if(S===0)return!0;const C=Math.sqrt(S);f/=C,x/=C}return!((r.x-s.x)*f+(r.y-s.y)*x-c<0||(l.x-s.x)*f+(l.y-s.y)*x-c<0||(u.x-s.x)*f+(u.y-s.y)*x-c<0)}function ot(s,e,r,l,u,c,f){return!(ze(s,e,l,u,c,f)||ze(e,r,l,u,c,f)||ze(r,s,l,u,c,f)||ze(l,u,s,e,r,f)||ze(u,c,s,e,r,f)||ze(c,l,s,e,r,f))}function Xe(s,e,r){const l=e.paint.get(s).value;return l.kind==="constant"?l.value:r.programConfigurations.get(e.id).getMaxValue(s)}function ft(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function gt(s,e,r,l,u){if(!e[0]&&!e[1])return s;const c=qt.convert(e)._mult(u);r==="viewport"&&c._rotate(-l);const f=[];for(let x=0;x<s.length;x++)f.push(s[x].sub(c));return f}function Mt(s,e,r,l){const u=qt.convert(s)._mult(l);return e==="viewport"&&u._rotate(-r),u}let He,mt;nn(Z,"CircleBucket",{omit:["layers"]});var qe,pt={exports:{}},lt=(qe||(qe=1,function(s,e){(function(r){function l(c,f,x){var S=u(256*c,256*(f=Math.pow(2,x)-f-1),x),C=u(256*(c+1),256*(f+1),x);return S[0]+","+S[1]+","+C[0]+","+C[1]}function u(c,f,x){var S=2*Math.PI*6378137/256/Math.pow(2,x);return[c*S-2*Math.PI*6378137/2,f*S-2*Math.PI*6378137/2]}r.getURL=function(c,f,x,S,C,_){return _=_||{},c+"?"+["bbox="+l(x,S,C),"format="+(_.format||"image/png"),"service="+(_.service||"WMS"),"version="+(_.version||"1.1.1"),"request="+(_.request||"GetMap"),"srs="+(_.srs||"EPSG:3857"),"width="+(_.width||256),"height="+(_.height||256),"layers="+f].join("&")},r.getTileBBox=l,r.getMercCoords=u,Object.defineProperty(r,"__esModule",{value:!0})})(e)}(0,pt.exports)),pt.exports);class yt{constructor(e,r,l){this.z=e,this.x=r,this.y=l,this.key=Ht(0,e,e,r,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const l=lt.getTileBBox(this.x,this.y,this.z),u=function(c,f,x){let S,C="";for(let _=c;_>0;_--)S=1<<_-1,C+=(f&S?1:0)+(x&S?2:0);return C}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class st{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Ht(e,r.z,r.z,r.x,r.y)}}class dt{constructor(e,r,l,u,c){this.overscaledZ=e,this.wrap=r,this.canonical=new yt(l,+u,+c),this.key=r===0&&e===l?this.canonical.key:Ht(r,e,l,u,c)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new dt(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new dt(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return Ht(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-e;return Ht(this.wrap*+r,e,e,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new dt(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,l=2*this.canonical.x,u=2*this.canonical.y;return[new dt(r,this.wrap,r,l,u),new dt(r,this.wrap,r,l+1,u),new dt(r,this.wrap,r,l,u+1),new dt(r,this.wrap,r,l+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new dt(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new dt(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new st(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ht(s,e,r,l,u){const c=1<<Math.min(r,22);let f=c*(u%c)+l%c;return s&&r<22&&(f+=c*c*((s<0?-2*s-1:2*s)%(1<<2*(22-r)))),16*(32*f+r)+(e-r)}const kt=[s=>{let e=s.canonical.x-1,r=s.wrap;return e<0&&(e=(1<<s.canonical.z)-1,r--),new dt(s.overscaledZ,r,s.canonical.z,e,s.canonical.y)},s=>{let e=s.canonical.x+1,r=s.wrap;return e===1<<s.canonical.z&&(e=0,r++),new dt(s.overscaledZ,r,s.canonical.z,e,s.canonical.y)},s=>new dt(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,(s.canonical.y===0?1<<s.canonical.z:s.canonical.y)-1),s=>new dt(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y===(1<<s.canonical.z)-1?0:s.canonical.y+1)];nn(yt,"CanonicalTileID"),nn(dt,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Wt=_r([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:hn}=Wt,In=_r([{name:"a_pos_3",components:3,type:"Int16"}]);var bn=_r([{name:"a_pos",type:"Int16",components:2}]);class Tn{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,l){const u=de.vec2.dot(r,this.dir);if(Math.abs(u)<1e-6)return!1;const c=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1])/u;return l[0]=this.pos[0]+this.dir[0]*c,l[1]=this.pos[1]+this.dir[1]*c,!0}}class Mn{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,l){const u=de.vec3.dot(r,this.dir);if(Math.abs(u)<1e-6)return!1;const c=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/u;return l[0]=this.pos[0]+this.dir[0]*c,l[1]=this.pos[1]+this.dir[1]*c,l[2]=this.pos[2]+this.dir[2]*c,!0}closestPointOnSphere(e,r,l){if(de.vec3.equals(this.pos,e)||r===0)return l[0]=l[1]=l[2]=0,!1;const[u,c,f]=this.dir,x=this.pos[0]-e[0],S=this.pos[1]-e[1],C=this.pos[2]-e[2],_=u*u+c*c+f*f,E=2*(x*u+S*c+C*f),M=E*E-4*_*(x*x+S*S+C*C-r*r);if(M<0){const A=Math.max(-E/2,0),D=x+u*A,I=S+c*A,B=C+f*A,U=Math.hypot(D,I,B);return l[0]=D*r/U,l[1]=I*r/U,l[2]=B*r/U,!1}{const A=(-E-Math.sqrt(M))/(2*_);if(A<0){const D=Math.hypot(x,S,C);return l[0]=x*r/D,l[1]=S*r/D,l[2]=C*r/D,!1}return l[0]=x+u*A,l[1]=S+c*A,l[2]=C+f*A,!0}}}class tr{constructor(e,r,l,u,c){this.TL=e,this.TR=r,this.BR=l,this.BL=u,this.horizon=c}static fromInvProjectionMatrix(e,r,l){const u=[-1,1,1],c=[1,1,1],f=[1,-1,1],x=[-1,-1,1],S=de.vec3.transformMat4(u,u,e),C=de.vec3.transformMat4(c,c,e),_=de.vec3.transformMat4(f,f,e),E=de.vec3.transformMat4(x,x,e);return new tr(S,C,_,E,r/l)}}function yr(s,e,r){let l=1/0,u=-1/0;const c=[];for(const f of s){de.vec3.sub(c,f,e);const x=de.vec3.dot(c,r);l=Math.min(l,x),u=Math.max(u,x)}return[l,u]}function Gr(s,e){let r=!0;for(let l=0;l<s.planes.length;l++){const u=s.planes[l];let c=0;for(let f=0;f<e.length;f++)c+=de.vec3.dot(u,e[f])+u[3]>=0;if(c===0)return 0;c!==e.length&&(r=!1)}return r?2:1}function Kn(s,e){for(const r of s.projections){const l=yr(e,s.points[0],r.axis);if(r.projection[1]<l[0]||r.projection[0]>l[1])return 0}return 1}function ci(s,e){let r=0;const l=[0,0,0,0];for(let u=0;u<s.length;u++)l[0]=s[u][0],l[1]=s[u][1],l[2]=s[u][2],l[3]=1,de.vec4.dot(l,e)>=0&&r++;return r}class Pn{constructor(e,r){this.points=e||new Array(8).fill([0,0,0]),this.planes=r||new Array(6).fill([0,0,0,0]),this.bounds=fn.fromPoints(this.points),this.projections=[],this.frustumEdges=[de.vec3.sub([],this.points[2],this.points[3]),de.vec3.sub([],this.points[0],this.points[3]),de.vec3.sub([],this.points[4],this.points[0]),de.vec3.sub([],this.points[5],this.points[1]),de.vec3.sub([],this.points[6],this.points[2]),de.vec3.sub([],this.points[7],this.points[3])];for(const l of this.frustumEdges){const u=[0,-l[2],l[1]],c=[l[2],0,-l[0]];this.projections.push({axis:u,projection:yr(this.points,this.points[0],u)}),this.projections.push({axis:c,projection:yr(this.points,this.points[0],c)})}}static fromInvProjectionMatrix(e,r,l,u){const c=Math.pow(2,l),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{const _=de.vec4.transformMat4([],C,e),E=1/_[3]/r*c;return de.vec4.mul(_,_,[E,E,u?1/_[3]:E,E])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{const _=de.vec3.sub([],f[C[0]],f[C[1]]),E=de.vec3.sub([],f[C[2]],f[C[1]]),M=de.vec3.normalize([],de.vec3.cross([],_,E)),A=-de.vec3.dot(M,f[C[1]]);return M.concat(A)}),S=[];for(let C=0;C<f.length;C++)S.push([f[C][0],f[C][1],f[C][2]]);return new Pn(S,x)}intersectsPrecise(e,r,l){for(let u=0;u<r.length;u++)if(!ci(e,r[u]))return 0;for(let u=0;u<this.planes.length;u++)if(!ci(e,this.planes[u]))return 0;for(const u of l)for(const c of this.frustumEdges){const f=de.vec3.cross([],u,c),x=de.vec3.length(f);if(x===0)continue;de.vec3.scale(f,f,1/x);const S=yr(this.points,this.points[0],f),C=yr(e,this.points[0],f);if(S[0]>C[1]||C[0]>S[1])return 0}return 1}containsPoint(e){for(const r of this.planes){const l=r[3];if(de.vec3.dot([r[0],r[1],r[2]],e)+l<0)return!1}return!0}}class fn{static fromPoints(e){const r=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];for(const u of e)de.vec3.min(r,r,u),de.vec3.max(l,l,u);return new fn(r,l)}static fromTileIdAndHeight(e,r,l){const u=1<<e.canonical.z,c=e.canonical.x,f=e.canonical.y;return new fn([c/u,f/u,r],[(c+1)/u,(f+1)/u,l])}static applyTransform(e,r){const l=e.getCorners();for(let u=0;u<l.length;++u)de.vec3.transformMat4(l[u],l[u],r);return fn.fromPoints(l)}static applyTransformFast(e,r){const l=[r[12],r[13],r[14]],u=[...l];for(let c=0;c<3;c++)for(let f=0;f<3;f++){const x=r[4*f+c],S=x*e.min[f],C=x*e.max[f];l[c]+=Math.min(S,C),u[c]+=Math.max(S,C)}return new fn(l,u)}static projectAabbCorners(e,r){const l=e.getCorners();for(let u=0;u<l.length;++u)de.vec3.transformMat4(l[u],l[u],r);return l}constructor(e,r){this.min=e,this.max=r,this.center=de.vec3.scale([],de.vec3.add([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],l=de.vec3.clone(this.min),u=de.vec3.clone(this.max);for(let c=0;c<r.length;c++)l[c]=r[c]?this.min[c]:this.center[c],u[c]=r[c]?this.center[c]:this.max[c];return u[2]=this.max[2],new fn(l,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Gr(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Gr(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,r){return r||this.intersects(e)?Kn(e,this.getCorners()):0}intersectsPreciseFlat(e,r){return r||this.intersectsFlat(e)?Kn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let r=0;r<3;++r)if(this.min[r]>e.max[r]||e.min[r]>this.max[r])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e.min[r]),this.max[r]=Math.max(this.max[r],e.max[r])}encapsulatePoint(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e[r]),this.max[r]=Math.max(this.max[r],e[r])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}function ar(s){return s*Zo/Bl}nn(fn,"Aabb");const Dr=[new fn([Vs,Vs,Vs],[qs,qs,qs]),new fn([Vs,Vs,Vs],[0,0,qs]),new fn([0,Vs,Vs],[qs,0,qs]),new fn([Vs,0,Vs],[0,qs,qs]),new fn([0,0,Vs],[qs,qs,qs])];function vr(s,e,r,l=!0){const u=de.vec3.scale([],s._camera.position,s.worldSize),c=[e,r,1,1];de.vec4.transformMat4(c,c,s.pixelMatrixInverse),de.vec4.scale(c,c,1/c[3]);const f=de.vec3.sub([],c,u),x=de.vec3.normalize([],f),S=s.globeMatrix,C=[S[12],S[13],S[14]],_=de.vec3.sub([],C,u),E=de.vec3.length(_),M=de.vec3.normalize([],_),A=s.worldSize/(2*Math.PI),D=de.vec3.dot(M,x),I=Math.asin(A/E);if(I<Math.acos(D)){if(!l)return null;const Ee=[],_e=[];de.vec3.scale(Ee,x,E/D),de.vec3.normalize(_e,de.vec3.sub(_e,Ee,_)),de.vec3.normalize(x,de.vec3.add(x,_,de.vec3.scale(x,_e,Math.tan(I)*E)))}const B=[];new Mn(u,x).closestPointOnSphere(C,A,B);const U=de.vec3.normalize([],Br(S,0)),G=de.vec3.normalize([],Br(S,1)),H=de.vec3.normalize([],Br(S,2)),q=de.vec3.dot(U,B),Y=de.vec3.dot(G,B),J=de.vec3.dot(H,B),ne=Wi(Math.asin(-Y/A));let me=Wi(Math.atan2(q,J));me=s.center.lng+function(Ee,_e){const De=(_e-Ee+180)%360-180;return De<-180?De+360:De}(s.center.lng,me);const ce=ll(me),ue=$n(Ki(ne),0,1);return new t(ce,ue)}class Di{constructor(e,r,l){this.a=de.vec3.sub([],e,l),this.b=de.vec3.sub([],r,l),this.center=l;const u=de.vec3.normalize([],this.a),c=de.vec3.normalize([],this.b);this.angle=Math.acos(de.vec3.dot(u,c))}}function Bi(s,e){if(s.angle===0)return null;let r;return r=s.a[e]===0?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[e]/s.a[e]/Math.sin(s.angle)-1/Math.tan(s.angle)),r<0||r>1?null:function(l,u,c,f){const x=Math.sin(c);return l*(Math.sin((1-f)*c)/x)+u*(Math.sin(f*c)/x)}(s.a[e],s.b[e],s.angle,$n(r,0,1))+s.center[e]}function Ji(s){if(s.z<=1)return Dr[s.z+2*s.y+s.x];const e=ui(fr(s));return fn.fromPoints(e)}function Qi(s,e,r){return de.vec3.scale(s,s,1-r),de.vec3.scaleAndAdd(s,s,e,r)}function ma(s,e,r){for(const l of s)de.vec3.transformMat4(l,l,e),de.vec3.scale(l,l,r)}function Fi(s,e,r,l){const u=e/s.worldSize,c=s.globeMatrix;if(r.z<=1){const ce=Ji(r).getCorners();return ma(ce,c,u),fn.fromPoints(ce)}const f=fr(r,l),x=ui(f,Zo+ar(s._tileCoverLift));ma(x,c,u);const S=Number.MAX_VALUE,C=[-S,-S,-S],_=[S,S,S];if(f.contains(s.center)){for(const Ee of x)de.vec3.min(_,_,Ee),de.vec3.max(C,C,Ee);C[2]=0;const ce=s.point,ue=[ce.x*u,ce.y*u,0];return de.vec3.min(_,_,ue),de.vec3.max(C,C,ue),new fn(_,C)}if(s._tileCoverLift>0){for(const ce of x)de.vec3.min(_,_,ce),de.vec3.max(C,C,ce);return new fn(_,C)}const E=[c[12]*u,c[13]*u,c[14]*u],M=f.getCenter(),A=$n(s.center.lat,-85.051129,xs),D=$n(M.lat,-85.051129,xs),I=ll(s.center.lng),B=Ki(A);let U=I-ll(M.lng);const G=B-Ki(D);U>.5?U-=1:U<-.5&&(U+=1);let H=0;if(Math.abs(U)>Math.abs(G))H=U>=0?1:3;else{H=G>=0?0:2;const ce=[c[4]*u,c[5]*u,c[6]*u],ue=-Math.sin(Jn(G>=0?f.getSouth():f.getNorth()))*Zo;de.vec3.scaleAndAdd(E,E,ce,ue)}const q=x[H],Y=x[(H+1)%4],J=new Di(q,Y,E),ne=[Bi(J,0)||q[0],Bi(J,1)||q[1],Bi(J,2)||q[2]],me=Yo(s.zoom);if(me>0){const ce=function({x:Ee,y:_e,z:De},Le,Ne,Ge,Ve){const Ke=1/(1<<De);let Ze=Ee*Ke,Je=Ze+Ke,vt=_e*Ke,_t=vt+Ke,tn=0;const Ct=(Ze+Je)/2-Ge;return Ct>.5?tn=-1:Ct<-.5&&(tn=1),Ze=((Ze+tn)*Le-(Ge*=Le))*Ne+Ge,Je=((Je+tn)*Le-Ge)*Ne+Ge,vt=(vt*Le-(Ve*=Le))*Ne+Ve,_t=(_t*Le-Ve)*Ne+Ve,[[Ze,_t,0],[Je,_t,0],[Je,vt,0],[Ze,vt,0]]}(r,e,s._pixelsPerMercatorPixel,I,B);for(let Ee=0;Ee<x.length;Ee++)Qi(x[Ee],ce[Ee],me);const ue=de.vec3.add([],ce[H],ce[(H+1)%4]);de.vec3.scale(ue,ue,.5),Qi(ne,ue,me)}for(const ce of x)de.vec3.min(_,_,ce),de.vec3.max(C,C,ce);return _[2]=Math.min(q[2],Y[2]),de.vec3.min(_,_,ne),de.vec3.max(C,C,ne),new fn(_,C)}function fr({x:s,y:e,z:r},l=!1){const u=1/(1<<r),c=new hr(vs(s*u),e===(1<<r)-1&&l?-90:Sr((e+1)*u)),f=new hr(vs((s+1)*u),e===0&&l?90:Sr(e*u));return new Ec(c,f)}function ui(s,e=Zo){const r=Jn(s.getNorth()),l=Jn(s.getSouth()),u=Math.cos(r),c=Math.cos(l),f=Math.sin(r),x=Math.sin(l),S=s.getWest(),C=s.getEast();return[Sh(c,x,S,e),Sh(c,x,C,e),Sh(u,f,C,e),Sh(u,f,S,e)]}function xr(s,e,r,l){const u=1<<r.z,c=(s/zt+r.x)/u;return Ma(Sr((e/zt+r.y)/u),vs(c),l)}function $r({min:s,max:e}){return t_/Math.max(e[0]-s[0],e[1]-s[1],e[2]-s[2])}const wo=new Float64Array(16);function ii(s){const e=$r(s),r=de.mat4.fromScaling(wo,[e,e,e]);return de.mat4.translate(r,r,de.vec3.negate([],s.min))}function eo(s){const e=de.mat4.fromTranslation(wo,s.min),r=1/$r(s);return de.mat4.scale(e,e,[r,r,r])}function Ra(s){const e=zt/(2*Math.PI);return s/(2*Math.PI)/e}function Hs(s,e){return zt/(512*Math.pow(2,s))*$r(Ji(e))}function ka(s,e,r,l,u){const c=Ra(r),f=[s,e,-r/(2*Math.PI)],x=de.mat4.identity(new Float64Array(16));return de.mat4.translate(x,x,f),de.mat4.scale(x,x,[c,c,c]),de.mat4.rotateX(x,x,Jn(-u)),de.mat4.rotateY(x,x,Jn(-l)),x}function Yo(s){return mo(cu,km,s)}function Oa(s,e){const r=Ma(e.lat,e.lng),l=function(c){const f=Ma(c._center.lat,c._center.lng),x=de.vec3.fromValues(0,1,0);let S=de.vec3.cross([],x,f);const C=de.mat4.fromRotation([],-c.angle,f);S=de.vec3.transformMat4(S,S,C),de.mat4.fromRotation(C,-c._pitch,S);const _=de.vec3.normalize([],f);return de.vec3.scale(_,_,ar(c.cameraToCenterDistance/c.pixelsPerMeter)),de.vec3.transformMat4(_,_,C),de.vec3.add([],f,_)}(s),u=de.vec3.subtract([],l,r);return de.vec3.angle(u,r)}function Pi(s,e){return Oa(s,e)>Math.PI/2*1.01}const Fl=Jn(85),cl=Math.cos(Fl),Ul=Math.sin(Fl),zm=de.mat4.create(),Th=s=>{const e=[];return s.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),s.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function Pm(s,e,r,l,u,c,f,x,S){if(c&&s.queryGeometry.isAboveHorizon)return!1;c&&(S*=s.pixelToTileUnitsFactor);const C=s.tileID.canonical,_=r.projection.upVectorScale(C,r.center.lat,r.worldSize).metersToTile;for(const E of e)for(const M of E){const A=M.add(x),D=u&&r.elevation?r.elevation.exaggeration()*u.getElevationAt(A.x,A.y,!0):0,I=r.projection.projectTilePoint(A.x,A.y,C);if(D>0){const H=r.projection.upVector(C,A.x,A.y);I.x+=H[0]*_*D,I.y+=H[1]*_*D,I.z+=H[2]*_*D}const B=c?A:Lm(I.x,I.y,I.z,l),U=c?s.tilespaceRays.map(H=>Vy(H,D)):s.queryGeometry.screenGeometry,G=de.vec4.transformMat4([],[I.x,I.y,I.z,1],l);if(!f&&c?S*=G[3]/r.cameraToCenterDistance:f&&!c&&(S*=r.cameraToCenterDistance/G[3]),c){const H=Sr((M.y/zt+C.y)/(1<<C.z));S/=r.projection.pixelsPerMeter(H,1)/bo(1,H)}if(K(U,B,S))return!0}return!1}function Lm(s,e,r,l){const u=de.vec4.transformMat4([],[s,e,r,1],l);return new qt(u[0]/u[3],u[1]/u[3])}const gb=de.vec3.fromValues(0,0,0),r_=de.vec3.fromValues(0,0,1);function Vy(s,e){const r=de.vec3.create();return gb[2]=e,s.intersectsPlane(gb,r_,r),new qt(r[0],r[1])}class i0 extends Z{}let o0,i_,Hf,Bm;function s0(s,{width:e,height:r},l,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*r*l)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*r*l);return s.width=e,s.height=r,s.data=u,s}function _b(s,e,r){const{width:l,height:u}=e;l===s.width&&u===s.height||(Eh(s,e,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,l),height:Math.min(s.height,u)},r,null),s.width=l,s.height=u,s.data=e.data)}function Eh(s,e,r,l,u,c,f,x){if(u.width===0||u.height===0)return e;if(u.width>s.width||u.height>s.height||r.x>s.width-u.width||r.y>s.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||l.x>e.width-u.width||l.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const S=s.data,C=e.data,_=c===4&&x;for(let E=0;E<u.height;E++){const M=((r.y+E)*s.width+r.x)*c,A=((l.y+E)*e.width+l.x)*c;if(_)for(let D=0;D<u.width;D++){const I=M+D*c+3,B=A+D*c;C[B+0]=255,C[B+1]=255,C[B+2]=255,C[B+3]=S[I]}else if(f)for(let D=0;D<u.width;D++){const I=M+D*c,B=A+D*c,U=S[I+3],G=new gr(S[I+0]/255*U,S[I+1]/255*U,S[I+2]/255*U,U).toRenderColor(f).toArray();C[B+0]=G[0],C[B+1]=G[1],C[B+2]=G[2],C[B+3]=G[3]}else for(let D=0;D<u.width*c;D++)C[A+D]=S[M+D]}return e}nn(i0,"HeatmapBucket",{omit:["layers"]});class jl{constructor(e,r){s0(this,e,1,r)}resize(e){_b(this,new jl(e),1)}clone(){return new jl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,l,u,c){Eh(e,r,l,u,c,1,null)}}class So{constructor(e,r){s0(this,e,4,r)}resize(e){_b(this,new So(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new So({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,l,u,c,f,x){Eh(e,r,l,u,c,4,f,x)}}class o_{constructor(e,r){this.width=e.width,this.height=e.height,this.data=r instanceof Uint8Array?new Float32Array(r.buffer):r}}function Gf(s){const e={},r=s.resolution||256,l=s.clips?s.clips.length:1,u=s.image||new So({width:r,height:l}),c=(f,x,S)=>{e[s.evaluationKey]=S;const C=s.expression.evaluate(e);C&&(u.data[f+x+0]=Math.floor(255*C.r/C.a),u.data[f+x+1]=Math.floor(255*C.g/C.a),u.data[f+x+2]=Math.floor(255*C.b/C.a),u.data[f+x+3]=Math.floor(255*C.a))};if(s.clips)for(let f=0,x=0;f<l;++f,x+=4*r)for(let S=0,C=0;S<r;S++,C+=4){const _=S/(r-1),{start:E,end:M}=s.clips[f];c(x,C,E*(1-_)+M*_)}else for(let f=0,x=0;f<r;f++,x+=4)c(0,x,f/(r-1));return u}nn(jl,"AlphaImage"),nn(So,"RGBAImage");const a0=_r([{name:"a_pos",components:2,type:"Int16"}],4),yb=_r([{name:"a_road_z_offset",components:1,type:"Float32"}],4),vb=_r([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),Jw=_r([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Fm(s,e,r=2){const l=e&&e.length,u=l?e[0]*r:s.length;let c=xb(s,0,u,r,!0);const f=[];if(!c||c.next===c.prev)return f;let x,S,C;if(l&&(c=function(_,E,M,A){const D=[];for(let I=0,B=E.length;I<B;I++){const U=xb(_,E[I]*A,I<B-1?E[I+1]*A:_.length,A,!1);U===U.next&&(U.steiner=!0),D.push(u0(U))}D.sort(bb);for(let I=0;I<D.length;I++)M=wb(D[I],M);return M}(s,e,c,r)),s.length>80*r){x=1/0,S=1/0;let _=-1/0,E=-1/0;for(let M=r;M<u;M+=r){const A=s[M],D=s[M+1];A<x&&(x=A),D<S&&(S=D),A>_&&(_=A),D>E&&(E=D)}C=Math.max(_-x,E-S),C=C!==0?32767/C:0}return s_(c,f,r,x,S,C,0),f}function xb(s,e,r,l,u){let c;if(u===function(f,x,S,C){let _=0;for(let E=x,M=S-C;E<S;E+=C)_+=(f[M]-f[E])*(f[E+1]+f[M+1]),M=E;return _}(s,e,r,l)>0)for(let f=e;f<r;f+=l)c=h0(f/l|0,s[f],s[f+1],c);else for(let f=r-l;f>=e;f-=l)c=h0(f/l|0,s[f],s[f+1],c);return c&&Gy(c,c.next)&&(md(c),c=c.next),c}function $f(s,e){if(!s)return s;e||(e=s);let r,l=s;do if(r=!1,l.steiner||!Gy(l,l.next)&&oo(l.prev,l,l.next)!==0)l=l.next;else{if(md(l),l=e=l.prev,l===l.next)break;r=!0}while(r||l!==e);return e}function s_(s,e,r,l,u,c,f){if(!s)return;!f&&c&&function(S,C,_,E){let M=S;do M.z===0&&(M.z=Hy(M.x,M.y,C,_,E)),M.prevZ=M.prev,M.nextZ=M.next,M=M.next;while(M!==S);M.prevZ.nextZ=null,M.prevZ=null,function(A){let D,I=1;do{let B,U=A;A=null;let G=null;for(D=0;U;){D++;let H=U,q=0;for(let J=0;J<I&&(q++,H=H.nextZ,H);J++);let Y=I;for(;q>0||Y>0&&H;)q!==0&&(Y===0||!H||U.z<=H.z)?(B=U,U=U.nextZ,q--):(B=H,H=H.nextZ,Y--),G?G.nextZ=B:A=B,B.prevZ=G,G=B;U=H}G.nextZ=null,I*=2}while(D>1)}(M)}(s,l,u,c);let x=s;for(;s.prev!==s.next;){const S=s.prev,C=s.next;if(c?l0(s,l,u,c):qy(s))e.push(S.i,s.i,C.i),md(s),s=C.next,x=C.next;else if((s=C)===x){f?f===1?s_(s=Qw($f(s),e),e,r,l,u,c,2):f===2&&eS(s,e,r,l,u,c):s_($f(s),e,r,l,u,c,1);break}}}function qy(s){const e=s.prev,r=s,l=s.next;if(oo(e,r,l)>=0)return!1;const u=e.x,c=r.x,f=l.x,x=e.y,S=r.y,C=l.y,_=u<c?u<f?u:f:c<f?c:f,E=x<S?x<C?x:C:S<C?S:C,M=u>c?u>f?u:f:c>f?c:f,A=x>S?x>C?x:C:S>C?S:C;let D=l.next;for(;D!==e;){if(D.x>=_&&D.x<=M&&D.y>=E&&D.y<=A&&Zf(u,x,c,S,f,C,D.x,D.y)&&oo(D.prev,D,D.next)>=0)return!1;D=D.next}return!0}function l0(s,e,r,l){const u=s.prev,c=s,f=s.next;if(oo(u,c,f)>=0)return!1;const x=u.x,S=c.x,C=f.x,_=u.y,E=c.y,M=f.y,A=x<S?x<C?x:C:S<C?S:C,D=_<E?_<M?_:M:E<M?E:M,I=x>S?x>C?x:C:S>C?S:C,B=_>E?_>M?_:M:E>M?E:M,U=Hy(A,D,e,r,l),G=Hy(I,B,e,r,l);let H=s.prevZ,q=s.nextZ;for(;H&&H.z>=U&&q&&q.z<=G;){if(H.x>=A&&H.x<=I&&H.y>=D&&H.y<=B&&H!==u&&H!==f&&Zf(x,_,S,E,C,M,H.x,H.y)&&oo(H.prev,H,H.next)>=0||(H=H.prevZ,q.x>=A&&q.x<=I&&q.y>=D&&q.y<=B&&q!==u&&q!==f&&Zf(x,_,S,E,C,M,q.x,q.y)&&oo(q.prev,q,q.next)>=0))return!1;q=q.nextZ}for(;H&&H.z>=U;){if(H.x>=A&&H.x<=I&&H.y>=D&&H.y<=B&&H!==u&&H!==f&&Zf(x,_,S,E,C,M,H.x,H.y)&&oo(H.prev,H,H.next)>=0)return!1;H=H.prevZ}for(;q&&q.z<=G;){if(q.x>=A&&q.x<=I&&q.y>=D&&q.y<=B&&q!==u&&q!==f&&Zf(x,_,S,E,C,M,q.x,q.y)&&oo(q.prev,q,q.next)>=0)return!1;q=q.nextZ}return!0}function Qw(s,e){let r=s;do{const l=r.prev,u=r.next.next;!Gy(l,u)&&Sb(l,r,r.next,u)&&Yf(l,u)&&Yf(u,l)&&(e.push(l.i,r.i,u.i),md(r),md(r.next),r=s=u),r=r.next}while(r!==s);return $f(r)}function eS(s,e,r,l,u,c){let f=s;do{let x=f.next.next;for(;x!==f.prev;){if(f.i!==x.i&&tS(f,x)){let S=d0(f,x);return f=$f(f,f.next),S=$f(S,S.next),s_(f,e,r,l,u,c,0),void s_(S,e,r,l,u,c,0)}x=x.next}f=f.next}while(f!==s)}function bb(s,e){return s.x-e.x}function wb(s,e){const r=function(u,c){let f=c;const x=u.x,S=u.y;let C,_=-1/0;do{if(S<=f.y&&S>=f.next.y&&f.next.y!==f.y){const I=f.x+(S-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(I<=x&&I>_&&(_=I,C=f.x<f.next.x?f:f.next,I===x))return C}f=f.next}while(f!==c);if(!C)return null;const E=C,M=C.x,A=C.y;let D=1/0;f=C;do{if(x>=f.x&&f.x>=M&&x!==f.x&&Zf(S<A?x:_,S,M,A,S<A?_:x,S,f.x,f.y)){const I=Math.abs(S-f.y)/(x-f.x);Yf(f,u)&&(I<D||I===D&&(f.x>C.x||f.x===C.x&&c0(C,f)))&&(C=f,D=I)}f=f.next}while(f!==E);return C}(s,e);if(!r)return e;const l=d0(r,s);return $f(l,l.next),$f(r,r.next)}function c0(s,e){return oo(s.prev,s,e.prev)<0&&oo(e.next,s,s.next)<0}function Hy(s,e,r,l,u){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-r)*u|0)|s<<8))|s<<4))|s<<2))|s<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function u0(s){let e=s,r=s;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==s);return r}function Zf(s,e,r,l,u,c,f,x){return(u-f)*(e-x)>=(s-f)*(c-x)&&(s-f)*(l-x)>=(r-f)*(e-x)&&(r-f)*(c-x)>=(u-f)*(l-x)}function tS(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!function(r,l){let u=r;do{if(u.i!==r.i&&u.next.i!==r.i&&u.i!==l.i&&u.next.i!==l.i&&Sb(u,u.next,r,l))return!0;u=u.next}while(u!==r);return!1}(s,e)&&(Yf(s,e)&&Yf(e,s)&&function(r,l){let u=r,c=!1;const f=(r.x+l.x)/2,x=(r.y+l.y)/2;do u.y>x!=u.next.y>x&&u.next.y!==u.y&&f<(u.next.x-u.x)*(x-u.y)/(u.next.y-u.y)+u.x&&(c=!c),u=u.next;while(u!==r);return c}(s,e)&&(oo(s.prev,s,e.prev)||oo(s,e.prev,e))||Gy(s,e)&&oo(s.prev,s,s.next)>0&&oo(e.prev,e,e.next)>0)}function oo(s,e,r){return(e.y-s.y)*(r.x-e.x)-(e.x-s.x)*(r.y-e.y)}function Gy(s,e){return s.x===e.x&&s.y===e.y}function Sb(s,e,r,l){const u=jm(oo(s,e,r)),c=jm(oo(s,e,l)),f=jm(oo(r,l,s)),x=jm(oo(r,l,e));return u!==c&&f!==x||!(u!==0||!Um(s,r,e))||!(c!==0||!Um(s,l,e))||!(f!==0||!Um(r,s,l))||!(x!==0||!Um(r,e,l))}function Um(s,e,r){return e.x<=Math.max(s.x,r.x)&&e.x>=Math.min(s.x,r.x)&&e.y<=Math.max(s.y,r.y)&&e.y>=Math.min(s.y,r.y)}function jm(s){return s>0?1:s<0?-1:0}function Yf(s,e){return oo(s.prev,s,s.next)<0?oo(s,e,s.next)>=0&&oo(s,s.prev,e)>=0:oo(s,e,s.prev)<0||oo(s,s.next,e)<0}function d0(s,e){const r=f0(s.i,s.x,s.y),l=f0(e.i,e.x,e.y),u=s.next,c=e.prev;return s.next=e,e.prev=s,r.next=u,u.prev=r,l.next=r,r.prev=l,c.next=l,l.prev=c,l}function h0(s,e,r,l){const u=f0(s,e,r);return l?(u.next=l.next,u.prev=l,l.next.prev=u,l.next=u):(u.prev=u,u.next=u),u}function md(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function f0(s,e,r){return{i:s,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function a_(s,e){const r=s.length;if(r<=1)return[s];const l=[];let u,c;for(let f=0;f<r;f++){const x=yn(s[f]);x!==0&&(s[f].area=Math.abs(x),c===void 0&&(c=x<0),c===x<0?(u&&l.push(u),u=[s[f]]):u.push(s[f]))}if(u&&l.push(u),e>1)for(let f=0;f<l.length;f++)l[f].length<=e||(Yp(l[f],e,1,l[f].length-1,$y),l[f]=l[f].slice(0,e));return l}function $y(s,e){return e.area-s.area}function p0(s,e,r=1){if(!s)return null;const l=typeof s=="string"?Oo.from(s).getPrimary():s.getPrimary(),u=l.id.toString();return e.has(u)||e.set(u,[]),l.scaleSelf(r),e.get(u).push(l),l.toString()}function m0(s,e,r,l){const u=l.patternDependencies;let c=!1;for(const f of e){const x=f.paint.get(`${s}-pattern`);x.isConstant()||(c=!0),p0(x.constantOr(null),u,r)&&(c=!0)}return c}function Vm(s,e,r,l,u,c){const f=c.patternDependencies;for(const x of e){const S=x.paint.get(`${s}-pattern`).value;if(S.kind!=="constant"){let C=S.evaluate({zoom:l},r,{},c.availableImages);C=C&&C.name?C.name:C;const _=p0(C,f,u);_&&(r.patterns[x.id]=_)}}return r}var Zy,qm,l_,c_,Yy,To,Wy,Xy={};function Fr(){if(qm)return Zy;qm=1;var s=ls();function e(u,c,f,x,S){this.properties={},this.extent=f,this.type=0,this._pbf=u,this._geometry=-1,this._keys=x,this._values=S,u.readFields(r,this,c)}function r(u,c,f){u==1?c.id=f.readVarint():u==2?function(x,S){for(var C=x.readVarint()+x.pos;x.pos<C;){var _=S._keys[x.readVarint()],E=S._values[x.readVarint()];S.properties[_]=E}}(f,c):u==3?c.type=f.readVarint():u==4&&(c._geometry=f.pos)}function l(u){for(var c,f,x=0,S=0,C=u.length,_=C-1;S<C;_=S++)x+=((f=u[_]).x-(c=u[S]).x)*(c.y+f.y);return x}return Zy=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var u=this._pbf;u.pos=this._geometry;for(var c,f=u.readVarint()+u.pos,x=1,S=0,C=0,_=0,E=[];u.pos<f;){if(S<=0){var M=u.readVarint();x=7&M,S=M>>3}if(S--,x===1||x===2)C+=u.readSVarint(),_+=u.readSVarint(),x===1&&(c&&E.push(c),c=[]),c.push(new s(C,_));else{if(x!==7)throw new Error("unknown command "+x);c&&c.push(c[0].clone())}}return c&&E.push(c),E},e.prototype.bbox=function(){var u=this._pbf;u.pos=this._geometry;for(var c=u.readVarint()+u.pos,f=1,x=0,S=0,C=0,_=1/0,E=-1/0,M=1/0,A=-1/0;u.pos<c;){if(x<=0){var D=u.readVarint();f=7&D,x=D>>3}if(x--,f===1||f===2)(S+=u.readSVarint())<_&&(_=S),S>E&&(E=S),(C+=u.readSVarint())<M&&(M=C),C>A&&(A=C);else if(f!==7)throw new Error("unknown command "+f)}return[_,M,E,A]},e.prototype.toGeoJSON=function(u,c,f){var x,S,C=this.extent*Math.pow(2,f),_=this.extent*u,E=this.extent*c,M=this.loadGeometry(),A=e.types[this.type];function D(U){for(var G=0;G<U.length;G++){var H=U[G];U[G]=[360*(H.x+_)/C-180,360/Math.PI*Math.atan(Math.exp((180-360*(H.y+E)/C)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(x=0;x<M.length;x++)I[x]=M[x][0];D(M=I);break;case 2:for(x=0;x<M.length;x++)D(M[x]);break;case 3:for(M=function(U){var G=U.length;if(G<=1)return[U];for(var H,q,Y=[],J=0;J<G;J++){var ne=l(U[J]);ne!==0&&(q===void 0&&(q=ne<0),q===ne<0?(H&&Y.push(H),H=[U[J]]):H.push(U[J]))}return H&&Y.push(H),Y}(M),x=0;x<M.length;x++)for(S=0;S<M[x].length;S++)D(M[x][S])}M.length===1?M=M[0]:A="Multi"+A;var B={type:"Feature",geometry:{type:A,coordinates:M},properties:this.properties};return"id"in this&&(B.id=this.id),B},Zy}function Tb(){if(c_)return l_;c_=1;var s=Fr();function e(l,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=l,this._keys=[],this._values=[],this._features=[],l.readFields(r,this,u),this.length=this._features.length}function r(l,u,c){l===15?u.version=c.readVarint():l===1?u.name=c.readString():l===5?u.extent=c.readVarint():l===2?u._features.push(c.pos):l===3?u._keys.push(c.readString()):l===4&&u._values.push(function(f){for(var x=null,S=f.readVarint()+f.pos;f.pos<S;){var C=f.readVarint()>>3;x=C===1?f.readString():C===2?f.readFloat():C===3?f.readDouble():C===4?f.readVarint64():C===5?f.readVarint():C===6?f.readSVarint():C===7?f.readBoolean():null}return x}(c))}return l_=e,e.prototype.feature=function(l){if(l<0||l>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[l];var u=this._pbf.readVarint()+this._pbf.pos;return new s(this._pbf,u,this.extent,this._keys,this._values)},l_}function gd(){return Wy||(Wy=1,Xy.VectorTile=function(){if(To)return Yy;To=1;var s=Tb();function e(r,l,u){if(r===3){var c=new s(u,u.readVarint()+u.pos);c.length&&(l[c.name]=c)}}return Yy=function(r,l){this.layers=r.readFields(e,{},l)},Yy}(),Xy.VectorTileFeature=Fr(),Xy.VectorTileLayer=Tb()),Xy}var ul=gd();const Vl="3d_elevation_id",u_="level";class g0{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,r){return this._valid&&e(r(this._geometry)),this}require(e,r,l){return this.get(e,!0,r,l)}optional(e,r,l){return this.get(e,!1,r,l)}success(){return this._valid}get(e,r,l,u){const c=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&c!==void 0?l(u?u(c):c):r&&(this._valid=!1),this}}class Eb{constructor(e,r){this.featureFunc=e,this.vertexFunc=r}parseFeature(e,r,l){return this.featureFunc(e,r,l)}parseVertex(e,r,l){return this.vertexFunc(e,r,l)}}const _0=new Eb((s,e,r)=>s.reset(e).require(Vl,l=>{r.id=l}).optional("fixed_height_relative",l=>{r.constantHeight=l},dl.decodeRelativeHeight).geometry(l=>{r.bounds=l},dl.computeBounds).success(),(s,e,r)=>s.reset(e).require(Vl,l=>{r.id=l}).require("elevation_idx",l=>{r.idx=l}).require("extent",l=>{r.extent=l}).require("height_relative",l=>{r.height=l},dl.decodeRelativeHeight).geometry(l=>{r.position=l},dl.getPoint).success()),du=new Eb((s,e,r)=>s.reset(e).require(Vl,l=>{r.id=l}).optional("fixed_height",l=>{r.constantHeight=l},dl.decodeMetricHeight).geometry(l=>{r.bounds=l},dl.computeBounds).success(),(s,e,r)=>s.reset(e).require(Vl,l=>{r.id=l}).require("elevation_idx",l=>{r.idx=l}).require("extent",l=>{r.extent=l}).require("height",l=>{r.height=l},dl.decodeMetricHeight).geometry(l=>{r.position=l},dl.getPoint).success());class dl{static computeBounds(e){const r=new qt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),l=new qt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const u of e[0])r.x>u.x&&(r.x=u.x),r.y>u.y&&(r.y=u.y),l.x<u.x&&(l.x=u.x),l.y<u.y&&(l.y=u.y);return{min:r,max:l}}static getPoint(e){return de.vec2.fromValues(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static parse(e){const r=[],l=[],u=e.length,c=new g0;for(let x=0;x<u;x++){const S=e.feature(x),C=S.properties.hasOwnProperty("version")?String(S.properties.version):void 0,_=(f=C)?f==="1.0.1"?du:void 0:_0;if(_===void 0){xe(`Unknown elevation feature version number ${C||"(unknown)"}`);continue}const E=S.properties.hasOwnProperty("type")?S.properties.type:void 0;if(E){if(ul.VectorTileFeature.types[S.type]==="Point"&&E==="curve_point"){const M={};_.parseVertex(c,S,M)&&r.push(M)}else if(ul.VectorTileFeature.types[S.type]==="Polygon"&&E==="curve_meta"){const M={};_.parseFeature(c,S,M)&&l.push(M)}}}var f;return{vertices:r,features:l}}}class d_{constructor(e,r,l,u,c,f){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=e,this.heightRange={min:l,max:l},this.safeArea=r,this.constantHeight=l,this.constantHeight==null&&(this.constantHeight!=null||u.length!==0)){this.vertices=u,this.edges=c,this.edges=this.edges.filter(x=>x.a<this.vertices.length&&x.b<this.vertices.length&&!de.vec2.exactEquals(this.vertices[x.a].position,this.vertices[x.b].position)),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const x of this.vertices)this.vertexProps.push({dir:de.vec2.fromValues(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,x.height),this.heightRange.max=Math.max(this.heightRange.max,x.height);for(const x of this.edges){const S=this.vertices[x.a].position,C=this.vertices[x.b].position,_=de.vec2.subtract(de.vec2.create(),C,S),E=de.vec2.length(_),M=de.vec2.scale(de.vec2.create(),_,1/E);this.edgeProps.push({vec:_,dir:M,len:E});const A=this.vertexProps[x.a].dir,D=this.vertexProps[x.b].dir;de.vec2.add(A,A,M),de.vec2.add(D,D,M)}for(const x of this.vertexProps)x.dir[0]===0&&x.dir[1]===0||de.vec2.normalize(x.dir,x.dir);this.tessellate(f)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const r=this.getClosestEdge(e);if(r==null)return 0;const[l,u]=r;return((c,f,x)=>(1-x)*c+x*f)(this.vertices[this.edges[l].a].height,this.vertices[this.edges[l].b].height,u)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let r=0,l=Number.POSITIVE_INFINITY,u=0;const c=de.vec2.fromValues(e.x,e.y);for(let f=0;f<this.edges.length;f++){const x=this.edges[f],S=this.edgeProps[f].dir,C=new Tn(c,this.edgeProps[f].dir),_=this.vertices[x.a].position,E=this.vertices[x.b].position,M=de.vec2.create(),A=de.vec2.create(),D=C.intersectsPlane(_,this.vertexProps[x.a].dir,M),I=C.intersectsPlane(E,this.vertexProps[x.b].dir,A);if(!D||!I)continue;const B=de.vec2.subtract(de.vec2.create(),A,M),U=de.vec2.subtract(de.vec2.create(),c,M),G=de.vec2.dot(B,B),H=G>0?de.vec2.dot(U,B)/G:0,q=$n(H,0,1),Y=Math.abs((H-q)*this.edgeProps[f].len),J=de.vec2.subtract(de.vec2.create(),c,_),ne=Y+Math.abs(de.vec2.dot(J,de.vec2.fromValues(S[1],-S[0])));ne<l&&(r=f,l=ne,u=q)}return[r,u]}tessellate(e){for(let r=this.edges.length-1;r>=0;--r){const l=this.edges[r].a,u=this.edges[r].b,{position:c,height:f,extent:x}=this.vertices[l],{position:S,height:C,extent:_}=this.vertices[u],E=this.vertexProps[l].dir,M=this.vertexProps[u].dir,A=de.vec3.fromValues(c[0]/e,c[1]/e,f),D=de.vec3.fromValues(S[0]/e,S[1]/e,C),I=de.vec3.fromValues(E[1],-E[0],0);de.vec3.scale(I,I,x);const B=de.vec3.fromValues(M[1],-M[0],0);if(de.vec3.scale(B,B,_),this.distSqLines(de.vec3.fromValues(A[0]+.5*I[0],A[1]+.5*I[1],A[2]+.5*I[2]),de.vec3.fromValues(D[0]-.5*B[0],D[1]-.5*B[1],D[2]-.5*B[2]),de.vec3.fromValues(A[0]-.5*I[0],A[1]-.5*I[1],A[2]-.5*I[2]),de.vec3.fromValues(D[0]+.5*B[0],D[1]+.5*B[1],D[2]+.5*B[2]))<=.05*.05)continue;const U=this.vertices.length,G=de.vec2.add(de.vec2.create(),c,S);this.vertices.push({position:de.vec2.scale(G,G,.5),height:.5*(f+C),extent:.5*(x+_)});const H=de.vec2.add(de.vec2.create(),E,M);this.vertexProps.push({dir:de.vec2.normalize(H,H)}),this.edges.splice(r,1),this.edgeProps.splice(r,1),this.edges.push({a:l,b:U}),this.edges.push({a:U,b:u});const q=de.vec2.subtract(de.vec2.create(),this.vertices[U].position,c),Y=de.vec2.length(q),J={vec:q,dir:de.vec2.scale(de.vec2.create(),q,1/Y),len:Y};this.edgeProps.push(J),this.edgeProps.push(J)}}distSqLines(e,r,l,u){const c=de.vec3.subtract(de.vec3.create(),r,e),f=de.vec3.subtract(de.vec3.create(),u,l),x=de.vec3.subtract(de.vec3.create(),e,l),S=de.vec3.dot(c,c),C=de.vec3.dot(c,f),_=de.vec3.dot(c,x),E=de.vec3.dot(f,f),M=de.vec3.dot(f,x),A=S*E-C*C;if(A===0){const G=de.vec3.dot(x,f)/de.vec3.dot(f,f),H=de.vec3.lerp(de.vec3.create(),l,u,G);return de.vec3.squaredDistance(H,e)}const D=(C*M-_*E)/A,I=(S*M-C*_)/A,B=de.vec3.lerp(de.vec3.create(),e,r,D),U=de.vec3.lerp(de.vec3.create(),l,u,I);return de.vec3.squaredDistance(B,U)}}class y0{constructor(e,r){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(r)||(this.zScale=Math.pow(2,r.z-e.z),this.xOffset=(e.x*this.zScale-r.x)*zt,this.yOffset=(e.y*this.zScale-r.y)*zt)}constantElevation(e,r){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,r)}pointElevation(e,r,l){const u=this.constantElevation(r,l);return u??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(r.pointElevation(e),l))}computeBiasedHeight(e,r){return r<=0?e:e+r*mo(0,r,e>=0?e:Math.abs(.5*e))}}nn(d_,"ElevationFeature");class h_{constructor(){this.polygons=new Map}add(e,...r){this.polygons.has(e)?this.polygons.get(e).push(...r):this.polygons.set(e,r)}merge(e){for(const[r,l]of e.polygons)this.add(r,...l)}}class Wo{constructor(){this.portals=[]}static evaluate(e){if(e.length===0)return new Wo;let r=[];for(const C of e)r.push(...C.portals);if(r.length===0)return new Wo;const l=(C,_)=>C<=0&&_<=0||C>=zt&&_>=zt;for(const C of r){const _=C.va,E=C.vb;(l(_.x,E.x)||l(_.y,E.y))&&(C.type="border")}const u=r.filter(C=>C.type!=="unevaluated"),c=r.filter(C=>C.type==="unevaluated");if(c.length===0)return new Wo;c.sort((C,_)=>C.hash===_.hash?C.isTunnel===_.isTunnel?0:C.isTunnel?-1:1:C.hash<_.hash?1:-1),r=u.concat(c);let f=u.length,x=f,S=f;do if(x++,x===r.length||r[f].hash!==r[x].hash){if(x-f==2){S<f&&(r[S]=r[f],r[f]=null);const C=r[S],_=r[x-1];C.type=C.isTunnel!==_.isTunnel?"tunnel":"polygon",C.connection={a:C.connection.a,b:_.connection.a},S++}f=x}while(f!==r.length);return r.splice(S),r.sort((C,_)=>C.hash<_.hash?1:-1),{portals:r}}}nn(Wo,"ElevationPortalGraph"),nn(h_,"ElevationPolygons");class v0{constructor(e,r,l){this.outPositions=e,this.outNormals=r,this.outIndices=l,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(e,r,l){let u=e[2];l!=null&&(u*=l);const c=this.getVec3Bits(e)<<96n|this.getVec3Bits(r),f=this.vertexLookup.get(c);if(f!=null)return f;const x=this.outPositions.length;this.vertexLookup.set(c,x);const S=Math.trunc(16384*r[0]),C=Math.trunc(16384*r[1]),_=Math.trunc(16384*r[2]);return this.outPositions.emplaceBack(e[0],e[1],u),this.outNormals.emplaceBack(S,C,_),x}addVertices(e,r,...l){const u=[];for(const c of l){const f=this.addVertex(c,e,r);u.push(f)}return u}addTriangles(e,r,l){if(r&&l){const u=l.length===1,c=de.vec3.fromValues(0,0,0);for(let f=0;f<e.length;f+=3){const x=r[e[f+0]],S=r[e[f+1]],C=r[e[f+2]],_=u?l[0]:l[e[f+1]],E=u?l[0]:l[e[f+2]],M=this.addVertex(de.vec3.fromValues(x.x,x.y,u?l[0]:l[e[f+0]]),c),A=this.addVertex(de.vec3.fromValues(S.x,S.y,_),c),D=this.addVertex(de.vec3.fromValues(C.x,C.y,E),c);this.outIndices.emplaceBack(M,A,D)}}else for(let u=0;u<e.length;u+=3)this.outIndices.emplaceBack(e[u+0],e[u+1],e[u+2])}addQuad(e,r){const l=this.addVertices(r,void 0,...e.map(S=>de.vec3.fromValues(S.coord.x,S.coord.y,S.height))),[u,c,f,x]=l;this.addTriangles([u,c,f,f,x,u])}getBits(e){return this.view.setFloat32(0,e),BigInt(this.view.getUint32(0))}getVec3Bits(e){return this.getBits(e[0])<<64n|this.getBits(e[1])<<32n|this.getBits(e[2])}}class Ac{constructor(e){this.unevaluatedPortals=new Wo,this.portalPolygons=new h_,this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new dd,this.vertexNormals=new al,this.indexArray=new xo,this.tileToMeters=h(e)}addVertices(e,r){const l=this.unevalVertices.length;for(let u=0;u<e.length;u++)this.unevalVertices.push(e[u]),this.unevalHeights.push(r[u]);return l}addTriangles(e,r,l){const u=l?this.unevalTunnelTriangles:this.unevalTriangles;for(const c of e)u.push(c+r)}addRenderableRing(e,r,l,u,c){const f=[new qt(c.min.x,c.min.y),new qt(c.max.x,c.min.y),new qt(c.max.x,c.max.y),new qt(c.min.x,c.max.y)];for(let x=0;x<l-1;x++){const S=r+x,C=S+1,_=this.unevalVertices[S],E=this.unevalVertices[C];if(!(_.x>=c.min.x&&_.x<=c.max.x&&_.y>=c.min.y&&_.y<=c.max.y||E.x>=c.min.x&&E.x<=c.max.x&&E.y>=c.min.y&&E.y<=c.max.y||Me(_,E,f))||this.isOnBorder(_.x,E.x)||this.isOnBorder(_.y,E.y))continue;const M=Ac.computeEdgeHash(this.unevalVertices[S],this.unevalVertices[C]);let A,D=this.vertexHashLookup.get(Ac.computePosHash(_));D!=null?A=D.next:(D=this.vertexHashLookup.get(Ac.computePosHash(E)),A=D!=null?D.prev:M),this.unevalEdges.push({polygonIdx:e,a:S,b:C,hash:M,portalHash:A,isTunnel:u,type:"unevaluated"})}}addPortalCandidates(e,r,l,u,c){if(r.length===0)return;this.portalPolygons.add(e,{geometry:r,zLevel:c});const f=r[0];this.vertexHashLookup.clear();let x=Ac.computeEdgeHash(f[f.length-2],f[f.length-1]);for(let S=0;S<f.length-1;S++){const C=f[S+0],_=f[S+1],E=de.vec2.fromValues(_.x-C.x,_.y-C.y),M=de.vec2.length(E);if(M===0)continue;let A="unevaluated";const D=u.pointElevation(C),I=u.pointElevation(_);Math.abs(D)<.01&&Math.abs(I)<.01?A="entrance":(this.isOnBorder(C.x,_.x)||this.isOnBorder(C.y,_.y))&&(A="border");const B=Ac.computeEdgeHash(C,_);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:C,vb:_,vab:E,length:M,hash:B,isTunnel:l,type:A});const U=Ac.computePosHash(C);this.vertexHashLookup.set(U,{prev:x,next:B}),x=B}}construct(e){if(this.unevalVertices.length===0)return;const r=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),l=E=>{E.primitiveLength=this.indexArray.length-E.primitiveOffset},u=new v0(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const c=r(),f=r(),x=r(),S=(E,M)=>{E.sort((D,I)=>D.type===M&&I.type!==M?-1:D.type!==M&&I.type===M?1:0);const A=E.findIndex(D=>D.type!==M);return A>=0?A:E.length};let C=0;this.unevalEdges.length>0&&(C=S(this.unevalEdges,"none"),this.constructBridgeStructures(u,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:C},this.tileToMeters));const _=r();if(this.unevalEdges.length>0){const E=this.unevalEdges.splice(C),M=S(E,"tunnel")+C;this.unevalEdges.push(...E),this.constructTunnelStructures(u,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:C},{min:C,max:M})}l(x),u.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),l(_),u.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),l(f),u.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),l(c),this.maskSegments=ri.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength),this.depthSegments=ri.simpleSegment(0,f.primitiveOffset,0,f.primitiveLength),this.renderableSegments=ri.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength),this.shadowCasterSegments=ri.simpleSegment(0,c.primitiveOffset,0,c.primitiveLength)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,vb.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,Jw.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableSegments.destroy(),this.shadowCasterSegments.destroy())}computeVertexConnections(e,r,l,u){const c=new Map;for(let f=l;f<u;f++){const x=r[f],S=x.a,C=x.b;c.has(S)||c.set(S,{}),c.has(C)||c.set(C,{});const _=c.get(S),E=c.get(C);e[C]>0&&(_.to=C),e[S]>0&&(E.from=S)}return c}constructBridgeStructures(e,r,l,u,c,f){const x=this.computeVertexConnections(l,u,c.min,c.max),S=1/f,C=.5*S,_=M=>de.vec3.fromValues(r[M].x,r[M].y,l[M]*S),E=M=>{const A=x.get(M),D=A.from,I=A.to;if(!D||!I)return;const B=_(D),U=_(M),G=_(I),H=de.vec3.fromValues(0,0,0);if(!de.vec3.exactEquals(B,U)){const Y=de.vec3.sub(de.vec3.create(),U,B);de.vec3.add(H,H,de.vec3.normalize(Y,Y))}if(!de.vec3.exactEquals(G,U)){const Y=de.vec3.sub(de.vec3.create(),G,U);de.vec3.add(H,H,de.vec3.normalize(Y,Y))}const q=de.vec3.len(H);return q>0?de.vec3.scale(H,H,1/q):void 0};for(let M=c.min;M<c.max;M++){const A=u[M],D=this.prepareEdgePoints(r,l,A,(bt,xn)=>bt>=xn);if(D==null)continue;const I=D[0],B=D[1],U=de.vec3.fromValues(I.coord.x,I.coord.y,S*I.height),G=de.vec3.fromValues(B.coord.x,B.coord.y,S*B.height);if(de.vec3.exactEquals(U,G))continue;const H=de.vec3.sub(de.vec3.create(),G,U);de.vec3.normalize(H,H);const q=bt=>de.vec3.normalize(bt,bt),Y=E(A.a)||H,J=E(A.b)||H,ne=q(de.vec3.fromValues(Y[1],-Y[0],0)),me=q(de.vec3.fromValues(J[1],-J[0],0)),ce=q(de.vec3.cross(de.vec3.create(),ne,Y)),ue=q(de.vec3.cross(de.vec3.create(),me,J)),Ee=de.vec3.create(),_e=[de.vec3.add(de.vec3.create(),U,de.vec3.scale(Ee,de.vec3.sub(Ee,ne,ce),C)),de.vec3.add(de.vec3.create(),U,de.vec3.scale(Ee,de.vec3.add(Ee,ne,ce),C)),de.vec3.add(de.vec3.create(),U,de.vec3.scale(Ee,ce,C)),U],De=[de.vec3.add(de.vec3.create(),G,de.vec3.scale(Ee,de.vec3.sub(Ee,me,ue),C)),de.vec3.add(de.vec3.create(),G,de.vec3.scale(Ee,de.vec3.add(Ee,me,ue),C)),de.vec3.add(de.vec3.create(),G,de.vec3.scale(Ee,ue,C)),G],[Le,Ne]=e.addVertices(ne,f,_e[0],_e[1]),[Ge,Ve]=e.addVertices(me,f,De[0],De[1]);e.addTriangles([Le,Ne,Ge,Ne,Ve,Ge]);const[Ke,Ze]=e.addVertices(ce,f,_e[1],_e[2]),[Je,vt]=e.addVertices(ue,f,De[1],De[2]);e.addTriangles([Ke,Ze,Je,Ze,vt,Je]);const[_t,tn]=e.addVertices(de.vec3.negate(ne,ne),f,_e[2],_e[3]),[Ct,Bt]=e.addVertices(de.vec3.negate(me,me),f,De[2],De[3]);e.addTriangles([_t,tn,Ct,tn,Bt,Ct])}}constructTunnelStructures(e,r,l,u,c,f){const x=S=>de.vec3.normalize(S,S);for(let S=c.min;S<c.max;S++){const C=this.prepareEdgePoints(r,l,u[S],(A,D)=>A<=D);if(C==null)continue;const[_,E]=C,M=x(de.vec3.fromValues(E.coord.y-_.coord.y,-(E.coord.x-_.coord.x),0));e.addQuad([_,E,{coord:E.coord,height:u[S].isTunnel?-.1:0},{coord:_.coord,height:u[S].isTunnel?-.1:0}],M)}for(let S=f.min;S<f.max;S++){const C=u[S],_=r[C.a],E=r[C.b],M=x(de.vec3.fromValues(E.y-_.y,-(E.x-_.x),0));e.addQuad([{coord:E,height:0},{coord:_,height:0},{coord:_,height:l[C.a]+4},{coord:E,height:l[C.b]+4}],M),e.addQuad([{coord:_,height:0},{coord:E,height:0},{coord:E,height:l[C.b]+4},{coord:_,height:l[C.a]+4}],M)}}prepareEdgePoints(e,r,l,u){const c=e[l.a],f=e[l.b];let x=r[l.a],S=r[l.b];if(!(x!==0&&u(x,0)||S!==0&&u(S,0)))return;const C=c.clone(),_=f.clone();if(u(x,0)){if(!u(S,0)){const E=S/(S-x);_.x=En(_.x,C.x,E),_.y=En(_.y,C.y,E),S=En(S,x,E)}}else{const E=x/(x-S);C.x=En(C.x,_.x,E),C.y=En(C.y,_.y,E),x=En(x,S,E)}return[{coord:C,height:x},{coord:_,height:S}]}prepareEdges(e,r){if(r.length===0)return;r.sort((x,S)=>x.hash===S.hash?S.polygonIdx-x.polygonIdx:S.hash>x.hash?1:-1);let l=0,u=0,c=0,f=r[l].polygonIdx;do u++,(u===r.length||r[l].hash!==r[u].hash)&&((u-l==1||r[u-1].polygonIdx!==f)&&(c<l&&(r[c]=r[l],r[l]=null),r[c].type="none",c++),l=u,l!==r.length&&(f=r[l].polygonIdx));while(l!==r.length);if(r.splice(c),r.length!==0&&e.length!==0){r.sort((C,_)=>C.hash<_.hash?1:-1);let x=0,S=0;for(;x!==r.length&&S!==e.length;){const C=r[x],_=e[S];C.portalHash>_.hash?x++:_.hash>C.portalHash?S++:(C.type=_.type,x++)}}}isOnBorder(e,r){return e<=0&&r<=0||e>=zt&&r>=zt}static computeEdgeHash(e,r){return(e.y===r.y&&e.x>r.x||e.y>r.y)&&([e,r]=[r,e]),BigInt(Ac.computePosHash(e))<<32n|BigInt(Ac.computePosHash(r))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}class Ky{constructor(e,r){this.layoutVertexArray=new Pl,this.indexArray=new xo,this.lineIndexArray=new Aa,this.triangleSegments=new ri,this.lineSegments=new ri,this.programConfigurations=new ys(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,r&&(this.elevatedLayoutVertexArray=new ud)}update(e,r,l,u,c,f,x){this.programConfigurations.updatePaintArrays(e,r,c,l,u,f,x)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,a0.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,yb.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,r,l,u,c,f){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,l,u,c,f)}}class x0{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.bufferData=new Ky(e,!1),this.elevationBufferData=new Ky(e,!0),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference")}updateFootprints(e,r){}populate(e,r,l,u){this.hasPattern=m0("fill",this.layers,this.pixelRatio,r);const c=this.layers[0].layout.get("fill-sort-key"),f=[];for(const{feature:x,id:S,index:C,sourceLayerIndex:_}of e){const E=this.layers[0]._featureFilter.needGeometry,M=F(x,E);if(!this.layers[0]._featureFilter.filter(new Hr(this.zoom),M,l))continue;const A=c?c.evaluate(M,{},l,r.availableImages):void 0,D={id:S,properties:x.properties,type:x.type,sourceLayerIndex:_,index:C,geometry:E?M.geometry:P(x,l,u),patterns:{},sortKey:A};f.push(D)}c&&f.sort((x,S)=>x.sortKey-S.sortKey);for(const x of f){const{geometry:S,index:C,sourceLayerIndex:_}=x;if(this.hasPattern){const E=Vm("fill",this.layers,x,this.zoom,this.pixelRatio,r);this.patternFeatures.push(E)}else this.addFeature(x,S,C,l,{},r.availableImages,r.brightness,r.elevationFeatures);r.featureIndex.insert(e[C].feature,S,C,_,this.index)}}update(e,r,l,u,c,f,x){this.bufferData.update(e,r,l,u,c,f,x),this.elevationBufferData.update(e,r,l,u,c,f,x)}addFeatures(e,r,l,u,c,f){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,r,l,u,f,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,r,l,u,c,f=[],x,S){const C=a_(r,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,C,u,l,S):this.addGeometry(C,this.bufferData),this.bufferData.populatePaintArrays(e,l,c,f,u,x),this.elevationBufferData.populatePaintArrays(e,l,c,f,u,x)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e){this.elevatedStructures&&this.elevatedStructures.construct(e)}addElevatedRoadFeature(e,r,l,u,c){const f=new Array,x=this.getElevationFeature(e,c);if(x){f.push({polygons:r,elevationFeature:x,elevationTileID:l});for(const S of f)if(S.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Ac(S.elevationTileID));const _=S.elevationFeature.isTunnel();let E=0;e.properties.hasOwnProperty(u_)&&(E=+e.properties[u_]);for(const M of S.polygons)this.elevatedStructures.addPortalCandidates(S.elevationFeature.id,M,_,S.elevationFeature,E)}const C=new y0(l,S.elevationTileID);this.addElevatedGeometry(S.polygons,C,S.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,u)}}else this.addGeometry(r,this.bufferData)}addElevatedGeometry(e,r,l,u,c){const f={elevation:l,elevationSampler:r,bias:u,index:c},[x,S]=this.addGeometry(e,this.elevationBufferData,f);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:x,max:S}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,x),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,S))}addGeometry(e,r,l){let u=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,f=null;l&&(f=l.elevationSampler.constantElevation(l.elevation,l.bias),f!=null&&(u=f,c=f));const x=(S,C,_)=>{if(l!=null)if(C.push(S),f!=null)r.elevatedLayoutVertexArray.emplaceBack(f),_.push(f);else{const E=l.elevationSampler.pointElevation(S,l.elevation,l.bias);r.elevatedLayoutVertexArray.emplaceBack(E),_.push(E),u=Math.min(u,E),c=Math.max(c,E)}};for(const S of e){let C=0;for(const H of S)C+=H.length;const _=r.triangleSegments.prepareSegment(C,r.layoutVertexArray,r.indexArray),E=_.vertexLength,M=[],A=[],D=[],I=[],B=[],U=r.layoutVertexArray.length;for(const H of S){if(H.length===0)continue;H!==S[0]&&A.push(M.length/2);const q=r.lineSegments.prepareSegment(H.length,r.layoutVertexArray,r.lineIndexArray),Y=q.vertexLength;l&&B.push(r.layoutVertexArray.length-U),x(H[0],D,I),r.layoutVertexArray.emplaceBack(H[0].x,H[0].y),r.lineIndexArray.emplaceBack(Y+H.length-1,Y),M.push(H[0].x),M.push(H[0].y);for(let J=1;J<H.length;J++)x(H[J],D,I),r.layoutVertexArray.emplaceBack(H[J].x,H[J].y),r.lineIndexArray.emplaceBack(Y+J-1,Y+J),M.push(H[J].x),M.push(H[J].y);q.vertexLength+=H.length,q.primitiveLength+=H.length}const G=Fm(M,A);for(let H=0;H<G.length;H+=3)r.indexArray.emplaceBack(E+G[H],E+G[H+1],E+G[H+2]);if(l&&this.elevationMode==="hd-road-base"){const H=l.elevation.isTunnel(),q=l.elevation.safeArea,Y=this.elevatedStructures.addVertices(D,I);this.elevatedStructures.addTriangles(G,Y,H);const J=B.length;if(J>0){for(let ne=0;ne<J-1;ne++)this.elevatedStructures.addRenderableRing(l.index,B[ne]+Y,B[ne+1]-B[ne],H,q);this.elevatedStructures.addRenderableRing(l.index,B[J-1]+Y,D.length-B[J-1],H,q)}}_.vertexLength+=C,_.primitiveLength+=G.length/3}return[u,c]}getElevationFeature(e,r){if(!r)return;const l=+e.properties[Vl];return l!=null?r.find(u=>u.id===l):void 0}}let es,Pt,yi,Ab;nn(x0,"FillBucket",{omit:["layers","patternFeatures"]}),nn(Ky,"FillBufferData"),nn(Ac,"ElevatedStructures");class f_{constructor(e,r,l,u){if(this.triangleCount=r.length/3,this.min=new qt(0,0),this.max=new qt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[c,f]=[e[0].clone(),e[0].clone()];for(let E=1;E<e.length;++E){const M=e[E];c.x=Math.min(c.x,M.x),c.y=Math.min(c.y,M.y),f.x=Math.max(f.x,M.x),f.y=Math.max(f.y,M.y)}if(u){const E=Math.ceil(Math.max(f.x-c.x,f.y-c.y)/u);l=Math.max(l,E)}if(l===0)return;this.min=c,this.max=f;const x=this.max.sub(this.min);x.x=Math.max(x.x,1),x.y=Math.max(x.y,1);const S=Math.max(x.x,x.y)/l;this.cellsX=Math.max(1,Math.ceil(x.x/S)),this.cellsY=Math.max(1,Math.ceil(x.y/S)),this.xScale=1/S,this.yScale=1/S;const C=[];for(let E=0;E<this.triangleCount;E++){const M=e[r[3*E+0]].sub(this.min),A=e[r[3*E+1]].sub(this.min),D=e[r[3*E+2]].sub(this.min),I=ql(Math.floor(Math.min(M.x,A.x,D.x)),this.xScale,this.cellsX),B=ql(Math.floor(Math.max(M.x,A.x,D.x)),this.xScale,this.cellsX),U=ql(Math.floor(Math.min(M.y,A.y,D.y)),this.yScale,this.cellsY),G=ql(Math.floor(Math.max(M.y,A.y,D.y)),this.yScale,this.cellsY),H=new qt(0,0),q=new qt(0,0),Y=new qt(0,0),J=new qt(0,0);for(let ne=U;ne<=G;++ne){H.y=q.y=ne*S,Y.y=J.y=(ne+1)*S;for(let me=I;me<=B;++me)H.x=Y.x=me*S,q.x=J.x=(me+1)*S,(ot(M,A,D,H,q,J)||ot(M,A,D,H,J,Y))&&C.push({cellIdx:ne*this.cellsX+me,triIdx:E})}}if(C.length===0)return;C.sort((E,M)=>E.cellIdx-M.cellIdx||E.triIdx-M.triIdx);let _=0;for(;_<C.length;){const E=C[_].cellIdx,M={start:this.payload.length,len:0};for(;_<C.length&&C[_].cellIdx===E;)++M.len,this.payload.push(C[_++].triIdx);this.cells[E]=M}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,r){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const l=ql(e.x-this.min.x,this.xScale,this.cellsX),u=ql(e.y-this.min.y,this.yScale,this.cellsY),c=this.cells[u*this.cellsX+l];if(c){this._lazyInitLookup();for(let f=0;f<c.len;f++){const x=this.payload[c.start+f],S=Math.floor(x/8),C=1<<x%8;if(!(this.lookup[S]&C)&&(this.lookup[S]|=C,r.push(x),r.length===this.triangleCount))return}}}query(e,r,l){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>r.x||e.y>this.max.y||this.min.y>r.y)return;this._lazyInitLookup();const u=ql(e.x-this.min.x,this.xScale,this.cellsX),c=ql(r.x-this.min.x,this.xScale,this.cellsX),f=ql(e.y-this.min.y,this.yScale,this.cellsY),x=ql(r.y-this.min.y,this.yScale,this.cellsY);for(let S=f;S<=x;S++)for(let C=u;C<=c;C++){const _=this.cells[S*this.cellsX+C];if(_)for(let E=0;E<_.len;E++){const M=this.payload[_.start+E],A=Math.floor(M/8),D=1<<M%8;if(!(this.lookup[A]&D)&&(this.lookup[A]|=D,l.push(M),l.length===this.triangleCount))return}}}}function ql(s,e,r){return Math.max(0,Math.min(r-1,Math.floor(s*e)))}nn(f_,"TriangleGridIndex");class hu{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.footprints=[]}updateFootprints(e,r){for(const l of this.footprints)r.push({footprint:l,id:e})}populate(e,r,l,u){const c=[];for(const{feature:f,id:x,index:S,sourceLayerIndex:C}of e){const _=this.layers[0]._featureFilter.needGeometry,E=F(f,_);if(!this.layers[0]._featureFilter.filter(new Hr(this.zoom),E,l))continue;const M={id:x,properties:f.properties,type:f.type,sourceLayerIndex:C,index:S,geometry:_?E.geometry:P(f,l,u),patterns:{}};c.push(M)}for(const f of c){const{geometry:x,index:S,sourceLayerIndex:C}=f;this.addFeature(f,x,S,l,{},r.availableImages,r.brightness),r.featureIndex.insert(e[S].feature,x,S,C,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,r,l,u,c,f,x){}destroy(){}addFeature(e,r,l,u,c,f=[],x){for(const S of a_(r,2)){const C=[],_=[],E=[],M=new qt(1/0,1/0),A=new qt(-1/0,-1/0);for(const B of S)if(B.length!==0){B!==S[0]&&E.push(_.length/2);for(let U=0;U<B.length;U++)_.push(B[U].x),_.push(B[U].y),C.push(B[U]),M.x=Math.min(M.x,B[U].x),M.y=Math.min(M.y,B[U].y),A.x=Math.max(A.x,B[U].x),A.y=Math.max(A.y,B[U].y)}const D=Fm(_,E),I=new f_(C,D,8,256);this.footprints.push({vertices:C,indices:D,grid:I,min:M,max:A})}}}nn(hu,"ClipBucket",{omit:["layers"]});const Ah=_r([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),p_=_r([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Ch=_r([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Jy=_r([{name:"a_join_normal_inside",components:3,type:"Int16"}]),_d=_r([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),b0=_r([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:nS}=Ah;class Wf extends qt{constructor(e,r,l){super(e,r),this.z=l}}class Cb extends Wf{constructor(e,r,l,u){super(e,r,l),this.w=u}}function hl(s,e,r,l){const u=[],c=l===0?(f,x,S,C,_,E)=>{f.push(new qt(E,S+(E-x)/(C-x)*(_-S)))}:(f,x,S,C,_,E)=>{f.push(new qt(x+(E-S)/(_-S)*(C-x),E))};for(const f of s){const x=[];for(const S of f){if(S.length<=2)continue;const C=[];for(let M=0;M<S.length-1;M++){const A=S[M].x,D=S[M].y,I=S[M+1].x,B=S[M+1].y,U=l===0?A:D,G=l===0?I:B;U<e?G>e&&c(C,A,D,I,B,e):U>r?G<r&&c(C,A,D,I,B,r):C.push(S[M]),G<e&&U>=e&&c(C,A,D,I,B,e),G>r&&U<=r&&c(C,A,D,I,B,r)}let _=S[S.length-1];const E=l===0?_.x:_.y;E>=e&&E<=r&&C.push(_),C.length&&(_=C[C.length-1],C[0].x===_.x&&C[0].y===_.y||C.push(C[0]),x.push(C))}x.length&&u.push(x)}return u}function Db(s,e,r,l){const u=r==="x"?"y":"x",c=(l-s[r])/(e[r]-s[r]);s[u]=s[u]+(e[u]-s[u])*c,s[r]=l,s.hasOwnProperty("z")&&(s.z=En(s.z,e.z,c)),s.hasOwnProperty("w")&&(s.w=En(s.w,e.w,c))}function Qy(s,e,r,l){const u=r,c=l;for(const f of["x","y"]){let x=s,S=e;x[f]>=S[f]&&(x=e,S=s),x[f]<u&&S[f]>u&&Db(x,S,f,u),x[f]<c&&S[f]>c&&Db(S,x,f,c)}}const Hm=Number.MAX_SAFE_INTEGER;function Xf(s,e,r,l){return s.order<e||s.order===Hm||!(s.clipMask&r)||function(u,c){return c.length!==0&&c.find(f=>f===u)===void 0}(l,s.clipScope)}function ev(s,e){return s.x-e.x||s.y-e.y}function tv(s,e){return ev(s.min,e.min)===0&&ev(s.max,e.max)===0}function w0(s,e){return!(s.min.x>e.max.x||s.max.x<e.min.x||s.min.y>e.max.y||s.max.y<e.min.y)}function S0(s,e){if(s.length!==e.length)return!1;for(let r=0;r<s.length;r++)if(s[r].sourceId!==e[r].sourceId||!tv(s[r],e[r])||s[r].order!==e[r].order||s[r].clipMask!==e[r].clipMask||!cs(s[r].clipScope,e[r].clipScope))return!1;return!0}function Kf(s,e,r){const l=1/zt,u=1/(1<<r.canonical.z),c=(e.x*l+r.canonical.x)*u+r.wrap,f=(e.y*l+r.canonical.y)*u;return{min:new qt((s.x*l+r.canonical.x)*u+r.wrap,(s.y*l+r.canonical.y)*u),max:new qt(c,f)}}function Gs(s,e,r){const l=1<<r.canonical.z,u=((e.x-r.wrap)*l-r.canonical.x)*zt,c=(e.y*l-r.canonical.y)*zt;return{min:new qt(((s.x-r.wrap)*l-r.canonical.x)*zt,(s.y*l-r.canonical.y)*zt),max:new qt(u,c)}}function Ln(s,e,r,l,u,c,f){const x=s.indices,S=s.vertices,C=[];for(let _=l;_<l+u;_+=3){const E=e[r[_+0]+c],M=e[r[_+1]+c],A=e[r[_+2]+c],D=Math.min(E.x,M.x,A.x),I=Math.max(E.x,M.x,A.x),B=Math.min(E.y,M.y,A.y),U=Math.max(E.y,M.y,A.y);C.length=0,s.grid.query(new qt(D,B),new qt(I,U),C);for(let G=0;G<C.length;G++){const H=C[G];if(ot(S[x[3*H+0]],S[x[3*H+1]],S[x[3*H+2]],E,M,A,f))return!0}}return!1}function Cc(s,e,r,l){if(!s||!r)return!1;let u=s.vertices;if(!e.canonical.equals(l.canonical)||e.wrap!==l.wrap){if(r.vertices.length<s.vertices.length)return Cc(r,l,s,e);const c=e.canonical,f=l.canonical,x=Math.pow(2,f.z-c.z);u=s.vertices.map(S=>new qt((S.x+c.x*zt)*x-f.x*zt,(S.y+c.y*zt)*x-f.y*zt))}return Ln(r,u,s.indices,0,s.indices.length,0,0)}function Hl(s,e,r,l){const u=Math.pow(2,l.z-r.z);return new qt((s+r.x*zt)*u-l.x*zt,(e+r.y*zt)*u-l.y*zt)}function $s(s,e){const r=[];e.grid.queryPoint(s,r);const l=e.indices,u=e.vertices;for(let c=0;c<r.length;c++){const f=r[c];if(Se([u[l[3*f+0]],u[l[3*f+1]],u[l[3*f+2]]],s))return!0}return!1}const T0=[new qt(0,0),new qt(zt,0),new qt(zt,zt),new qt(0,zt)];function Mb(s,e){const r=[];let l=[];if(!e||s.length<2)return[s];if(s.length===2)return Me(s[0],s[1],T0)?[s]:[];for(let u=0;u<s.length+2;u++){const c=s[u%s.length],f=s[(u+1)%s.length],x=Me(u===0?s[s.length-1]:s[(u-1)%s.length],c,T0),S=Me(c,f,T0),C=x||S;C&&l.push(c),C&&S||l.length>0&&(l.length>1&&r.push(l),l=[])}return l.length>1&&r.push(l),r}const Gm=ul.VectorTileFeature.types,nv=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],Gl=["fill-extrusion-flood-light-ground-radius"],fu=Math.pow(2,13),yd=Math.pow(2,15)-1,m_=new qt(0,1),ga=2147483648;function Po(s,e,r,l,u,c,f,x){s.emplaceBack((e<<1)+f,(r<<1)+c,(Math.floor(l*fu)<<1)+u,Math.round(x))}function ts(s,e,r){s.emplaceBack(e.x*zt,e.y*zt,r?1:0)}function Dc(s,e,r,l,u,c){s.emplaceBack(e.x,e.y,(r.x<<1)+l,(r.y<<1)+u,c)}function Jf(s,e,r){s.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class Rb{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class kb{constructor(){this.centroidXY=new qt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new qt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new qt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new qt(this.max.x-this.min.x,this.max.y-this.min.y)}}class E0{constructor(){this.acc=new qt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,r){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=r.x,e.min.y=e.max.y=r.y)}appendEdge(e,r,l){this.accCount++,this.acc._add(r);let u=!!this.borders;r.x<e.min.x?(e.min.x=r.x,u=!0):r.x>e.max.x&&(e.max.x=r.x,u=!0),r.y<e.min.y?(e.min.y=r.y,u=!0):r.y>e.max.y&&(e.max.y=r.y,u=!0),((r.x===0||r.x===zt)&&r.x===l.x)!=((r.y===0||r.y===zt)&&r.y===l.y)&&this.processBorderOverlap(r,l),u&&this.checkBorderIntersection(r,l)}checkBorderIntersection(e,r){r.x<0!=e.x<0&&this.addBorderIntersection(0,En(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>zt!=e.x>zt&&this.addBorderIntersection(1,En(r.y,e.y,(zt-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,En(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>zt!=e.y>zt&&this.addBorderIntersection(3,En(r.x,e.x,(zt-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[e];r<l[0]&&(l[0]=r),r>l[1]&&(l[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const l=e.x===0?0:1;this.addBorderIntersection(l,r.y),this.addBorderIntersection(l,e.y)}else{const l=e.y===0?2:3;this.addBorderIntersection(l,r.x),this.addBorderIntersection(l,e.x)}}centroid(){return this.accCount===0?new qt(0,0):new qt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0):0}}function $m(s,e){const r=s.add(e)._unit(),l=$n(s.x*r.x+s.y*r.y,-1,1);var u,c,f;return f=Math.acos(l),Math.min(4,Math.max(-4,Math.tan(f)))/4*yd*((u=s).x*(c=e).y-u.y*c.x<0?-1:1)}const Ob=[s=>s.x<0,s=>s.x>zt,s=>s.y<0,s=>s.y>zt];function Qf(s,e,r,l){const u=[4];if(l===0)return u;r._mult(l);const c=s.sub(r),f=e.sub(r),x=[s,e,c,f];for(let S=0;S<4;S++)for(const C of x)if(Ob[S](C)){u.push(S);break}return u}class rv{constructor(e){this.vertexArray=new pa,this.indexArray=new xo,this.programConfigurations=new ys(e.layers,{zoom:e.zoom,lut:e.lut},r=>Gl.includes(r)),this._segments=new ri,this.hiddenByLandmarkVertexArray=new ph,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ri}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,r,l,u=!1){const c=e.length;if(c>2){let f=Math.max(0,this._segments.get().length-1);const x=this._segments._prepareSegment(4*c,this.vertexArray.length,2*this._segmentToGroundQuads[f].length);let S;f!==this._segments.get().length-1&&(f++,this._segmentToGroundQuads[f]=[],this._segmentToRegionTriCounts[f]=[0,0,0,0,0]);{const C=e[0],_=e[1];S=$m(C.sub(e[c-1])._perp()._unit(),_.sub(C)._perp()._unit())}for(let C=0;C<c;C++){const _=C===c-1?0:C+1,E=e[C],M=e[_],A=e[_===c-1?0:_+1],D=M.sub(E)._perp()._unit(),I=$m(D,A.sub(M)._perp()._unit()),B=S,U=I;if(ep(E,M,r)||u&&C0(E,r)&&C0(M,r)){S=I;continue}const G=x.vertexLength;Dc(this.vertexArray,E,M,1,1,B),Dc(this.vertexArray,E,M,1,0,B),Dc(this.vertexArray,E,M,0,1,U),Dc(this.vertexArray,E,M,0,0,U),x.vertexLength+=4;const H=Qf(E,M,D,l);for(const q of H)this._segmentToGroundQuads[f].push({id:G,region:q}),this._segmentToRegionTriCounts[f][q]+=2,x.primitiveLength+=2;S=I}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),r=e.length;for(let l=0;l<r;l++)this._segmentToGroundQuads[l].sort((u,c)=>u.region-c.region);for(let l=0;l<r;l++){const u=this._segmentToGroundQuads[l],c=e[l],f=this._segmentToRegionTriCounts[l];f.reduce((S,C)=>S+C,0);let x=0;for(let S=0;S<=4;S++){const C=f[S];if(C!==0){let _=this.regionSegments[S];_||(_=this.regionSegments[S]=new ri);const E={vertexOffset:c.vertexOffset,primitiveOffset:c.primitiveOffset+x,vertexLength:c.vertexLength,primitiveLength:C};_.get().push(E)}x+=C}for(let S=0;S<u.length;S++){const C=u[S].id;this.indexArray.emplaceBack(C,C+1,C+3),this.indexArray.emplaceBack(C,C+3,C+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,r,l,u,c,f){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,r,l,u,c,f)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,p_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,r,l,u,c,f,x){this.hasData()&&this.programConfigurations.updatePaintArrays(e,r,l,u,c,f,x)}updateHiddenByLandmark(e){if(!this.hasData())return;const r=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const l=e.flags&ga?1:0;for(let u=e.groundVertexArrayOffset;u<r;++u)this.hiddenByLandmarkVertexArray.emplace(u,l);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,_d.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const r=this.regionSegments[e];r&&r.destroy()}}}}class iv{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new xo,this.footprintVertices=new Pl,this.footprintSegments=[],this.layoutVertexArray=new sl,this.centroidVertexArray=new Ho,this.wallVertexArray=new Us,this.indexArray=new xo,this.programConfigurations=new ys(e.layers,{zoom:e.zoom,lut:e.lut},r=>nv.includes(r)),this.segments=new ri,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.groundEffect=new rv(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,r){}populate(e,r,l,u){this.features=[],this.hasPattern=m0("fill-extrusion",this.layers,this.pixelRatio,r),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=h(l),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:c,id:f,index:x,sourceLayerIndex:S}of e){const C=this.layers[0]._featureFilter.needGeometry,_=F(c,C);if(!this.layers[0]._featureFilter.filter(new Hr(this.zoom),_,l))continue;const E={id:f,sourceLayerIndex:S,index:x,geometry:C?_.geometry:P(c,l,u),properties:c.properties,type:c.type,patterns:{}},M=this.layoutVertexArray.length,A=Gm[E.type]==="Polygon";if(this.hasPattern)this.features.push(Vm("fill-extrusion",this.layers,E,this.zoom,this.pixelRatio,r));else if(this.wallMode)for(const D of E.geometry)for(const I of Mb(D,A))this.addFeature(E,[I],x,l,{},r.availableImages,u,r.brightness);else this.addFeature(E,E.geometry,x,l,{},r.availableImages,u,r.brightness);r.featureIndex.insert(c,E.geometry,x,S,this.index,M)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,r,l,u,c,f){for(const x of this.features){const S=Gm[x.type]==="Polygon",{geometry:C}=x;if(this.wallMode)for(const _ of C)for(const E of Mb(_,S))this.addFeature(x,[E],x.index,r,l,u,c,f);else this.addFeature(x,C,x.index,r,l,u,c,f)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,r,l,u,c,f,x){this.programConfigurations.updatePaintArrays(e,r,c,l,u,f,x),this.groundEffect.update(e,r,c,l,u,f,x)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nS),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,Jy.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,b0.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Ch.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,l,u,c,f,x,S){const C=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,_=[new qt(0,0),new qt(zt,zt)],E=x.projection,M=E.name==="globe",A=this.wallMode||Gm[e.type]==="Polygon",D=new E0;D.centroidDataIndex=this.centroidData.length;const I=new kb,B=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},u)<=0,U=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},u);let G;if(I.height=U,I.vertexArrayOffset=this.layoutVertexArray.length,I.groundVertexArrayOffset=this.groundEffect.vertexArray.length,M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Sm),this.wallMode){if(M)return void xe("Non zero fill-extrusion-line-width is not yet supported on globe.");if(r.length!==1)return;G=function(ue){const Ee=ue[0].x===ue[ue.length-1].x&&ue[0].y===ue[ue.length-1].y;(function(Bt){let bt=0;const xn=Bt.length;for(let Jt=0;Jt<xn;Jt++)bt+=(Bt[(Jt+1)%xn].x-Bt[Jt].x)*(Bt[(Jt+1)%xn].y+Bt[Jt].y);return bt>=0})(ue)||(ue=ue.reverse());const De={geometry:[],joinNormals:[],indices:[]},Le=[],Ne=[],Ge=[];let Ve=ue.length;for(;Ve>=2&&ue[Ve-1].equals(ue[Ve-2]);)Ve--;if(Ve<(Ee?3:2))return De;let Ke,Ze,Je,vt,_t,tn=0;for(;tn<Ve-1&&ue[tn].equals(ue[tn+1]);)tn++;Ee&&(Ke=ue[Ve-2],_t=ue[tn].sub(Ke)._unit()._perp());for(let Bt=tn;Bt<Ve;Bt++){if(Je=Bt===Ve-1?Ee?ue[tn+1]:void 0:ue[Bt+1],Je&&ue[Bt].equals(Je))continue;_t&&(vt=_t),Ke&&(Ze=Ke),Ke=ue[Bt],_t=Je?Je.sub(Ke)._unit()._perp():vt,vt=vt||_t;let bt=vt.add(_t);bt.x===0&&bt.y===0||bt._unit();const xn=bt.x*_t.x+bt.y*_t.y,Jt=xn!==0?1/xn:1/0,an=vt.x*_t.y-vt.y*_t.x>0;let Rn="miter";const qn=2;Rn==="miter"&&Jt>qn&&(Rn="bevel"),Rn==="bevel"&&(Jt>100&&(Rn="flipbevel"),Jt<qn&&(Rn="miter"));const On=(Vn,Fn,nr,pr)=>{const mr=new qt(Vn.x,Vn.y),wn=new qt(Vn.x,Vn.y);mr.x+=Fn.x*pr,mr.y+=Fn.y*pr,wn.x-=Fn.x*Math.max(nr,1),wn.y-=Fn.y*Math.max(nr,1),Ge.push(Fn),Le.push(mr),Ne.push(wn)};if(Rn==="miter")bt._mult(Jt),On(Ke,bt,0,0);else if(Rn==="flipbevel")bt=_t.mult(-1),On(Ke,bt,0,0),On(Ke,bt.mult(-1),0,0);else{const Vn=-Math.sqrt(Jt*Jt-1),Fn=an?Vn:0,nr=an?0:Vn;Ze&&On(Ke,vt,Fn,nr),Je&&On(Ke,_t,Fn,nr)}}De.geometry=[...Le,...Ne.reverse(),Le[0]],De.joinNormals=[...Ge,...Ge.reverse(),Ge[Ge.length-1]];const Ct=De.geometry.length-1;for(let Bt=0;Bt<Ct/2;Bt++)if(Bt+1<Ct/2){let bt=Bt,xn=Bt+1,Jt=Ct-1-Bt,an=Ct-2-Bt;bt=bt===0?Ct-1:bt-1,xn=xn===0?Ct-1:xn-1,Jt=Jt===0?Ct-1:Jt-1,an=an===0?Ct-1:an-1,De.indices.push(Jt),De.indices.push(xn),De.indices.push(bt),De.indices.push(Jt),De.indices.push(an),De.indices.push(xn)}return De}(r[0]),r=[G.geometry]}const H=(ue,Ee)=>ue<(Ee.length-1)/2||ue===Ee.length-1,q=this.wallMode?[r]:a_(r,500);for(let ue=q.length-1;ue>=0;ue--){const Ee=q[ue];(Ee.length===0||(Y=Ee[0]).every(_e=>_e.x<=0)||Y.every(_e=>_e.x>=zt)||Y.every(_e=>_e.y<=0)||Y.every(_e=>_e.y>=zt))&&q.splice(ue,1)}var Y;let J;if(M)J=k0(q,_,u);else{J=[];for(const ue of q)J.push({polygon:ue,bounds:_})}const ne=A?this.edgeRadius:0,me=ne>0&&this.zoom<17,ce=(ue,Ee)=>{if(ue.length===0)return!1;const _e=ue[ue.length-1];return Ee.x===_e.x&&Ee.y===_e.y};for(const{polygon:ue,bounds:Ee}of J){let _e=0,De=0;for(const Ve of ue)A&&!Ve[0].equals(Ve[Ve.length-1])&&Ve.push(Ve[0]),De+=A?Ve.length-1:Ve.length;const Le=this.segments.prepareSegment((A?5:4)*De,this.layoutVertexArray,this.indexArray);I.footprintSegIdx<0&&(I.footprintSegIdx=this.footprintSegments.length),I.polygonSegIdx<0&&(I.polygonSegIdx=this.polygonSegments.length);const Ne={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ge=new Rb;if(Ge.vertexOffset=this.footprintVertices.length,Ge.indexOffset=3*this.footprintIndices.length,Ge.ringIndices=[],A){const Ve=[],Ke=[];_e=Le.vertexLength;for(let Je=0;Je<ue.length;Je++){const vt=ue[Je];vt.length&&Je!==0&&Ke.push(Ve.length/2);const _t=[];let tn,Ct;tn=vt[1].sub(vt[0])._perp()._unit(),Ge.ringIndices.push(vt.length-1);for(let Bt=1;Bt<vt.length;Bt++){const bt=vt[Bt],xn=vt[Bt===vt.length-1?1:Bt+1],Jt=bt.clone();if(ne){Ct=xn.sub(bt)._perp()._unit();const an=tn.add(Ct)._unit(),Rn=ne*Math.min(4,1/(tn.x*an.x+tn.y*an.y));Jt.x+=Rn*an.x,Jt.y+=Rn*an.y,Jt.x=Math.round(Jt.x),Jt.y=Math.round(Jt.y),tn=Ct}if(!B||ne!==0&&!me||ce(_t,Jt)||_t.push(Jt),Po(this.layoutVertexArray,Jt.x,Jt.y,0,0,1,1,0),this.wallMode){const an=H(Bt,vt);ts(this.wallVertexArray,G.joinNormals[Bt],!an)}Le.vertexLength++,this.footprintVertices.emplaceBack(bt.x,bt.y),Ve.push(bt.x,bt.y),M&&Jf(this.layoutVertexExtArray,E.projectTilePoint(Jt.x,Jt.y,u),E.upVector(u,Jt.x,Jt.y))}B&&(ne===0||me)&&(_t.length!==0&&ce(_t,_t[0])&&_t.pop(),this.groundEffect.addData(_t,Ee,C))}const Ze=this.wallMode?G.indices:Fm(Ve,Ke);for(let Je=0;Je<Ze.length;Je+=3)this.footprintIndices.emplaceBack(Ge.vertexOffset+Ze[Je+0],Ge.vertexOffset+Ze[Je+1],Ge.vertexOffset+Ze[Je+2]),this.indexArray.emplaceBack(_e+Ze[Je],_e+Ze[Je+2],_e+Ze[Je+1]),Le.primitiveLength++;Ge.indexCount+=Ze.length,Ge.vertexCount+=this.footprintVertices.length-Ge.vertexOffset}for(let Ve=0;Ve<ue.length;Ve++){const Ke=ue[Ve];D.startRing(I,Ke[0]);let Ze=Ke.length>4&&D0(Ke[Ke.length-2],Ke[0],Ke[1]),Je=ne?Nb(Ke[Ke.length-2],Ke[0],Ke[1],ne):0;const vt=[];let _t,tn,Ct;tn=Ke[1].sub(Ke[0])._perp()._unit();let Bt=!0;for(let bt=1,xn=0;bt<Ke.length;bt++){let Jt=Ke[bt-1],an=Ke[bt];const Rn=Ke[bt===Ke.length-1?1:bt+1];if(D.appendEdge(I,an,Jt),ep(an,Jt,Ee)){ne&&(tn=Rn.sub(an)._perp()._unit(),Bt=!Bt);continue}const qn=an.sub(Jt)._perp(),On=qn.x/(Math.abs(qn.x)+Math.abs(qn.y)),Vn=qn.y>0?1:0,Fn=Jt.dist(an);if(xn+Fn>32768&&(xn=0),ne){Ct=Rn.sub(an)._perp()._unit();let wn=A0(Jt,an,Rn,Ib(tn,Ct),ne);isNaN(wn)&&(wn=0);const lr=an.sub(Jt)._unit();Jt=Jt.add(lr.mult(Je))._round(),an=an.add(lr.mult(-wn))._round(),Je=wn,tn=Ct,B&&this.zoom>=17&&(ce(vt,Jt)||vt.push(Jt),ce(vt,an)||vt.push(an))}const nr=Le.vertexLength,pr=Ke.length>4&&D0(Jt,an,Rn);let mr=M0(xn,Ze,Bt);if(Po(this.layoutVertexArray,Jt.x,Jt.y,On,Vn,0,0,mr),Po(this.layoutVertexArray,Jt.x,Jt.y,On,Vn,0,1,mr),this.wallMode){const wn=H(bt-1,Ke),lr=G.joinNormals[bt-1];ts(this.wallVertexArray,lr,wn),ts(this.wallVertexArray,lr,wn)}if(xn+=Fn,mr=M0(xn,pr,!Bt),Ze=pr,Po(this.layoutVertexArray,an.x,an.y,On,Vn,0,0,mr),Po(this.layoutVertexArray,an.x,an.y,On,Vn,0,1,mr),this.wallMode){const wn=H(bt,Ke),lr=G.joinNormals[bt];ts(this.wallVertexArray,lr,wn),ts(this.wallVertexArray,lr,wn)}if(Le.vertexLength+=4,this.indexArray.emplaceBack(nr+0,nr+1,nr+2),this.indexArray.emplaceBack(nr+1,nr+3,nr+2),Le.primitiveLength+=2,ne){const wn=_e+(bt===1?Ke.length-2:bt-2),lr=bt===1?_e:wn+1;if(this.indexArray.emplaceBack(nr+1,wn,nr+3),this.indexArray.emplaceBack(wn,lr,nr+3),Le.primitiveLength+=2,_t===void 0&&(_t=nr),!ep(Rn,Ke[bt],Ee)){const Ir=bt===Ke.length-1?_t:Le.vertexLength;this.indexArray.emplaceBack(nr+2,nr+3,Ir),this.indexArray.emplaceBack(nr+3,Ir+1,Ir),this.indexArray.emplaceBack(nr+3,lr,Ir+1),Le.primitiveLength+=3}Bt=!Bt}if(M){const wn=this.layoutVertexExtArray,lr=E.projectTilePoint(Jt.x,Jt.y,u),Ir=E.projectTilePoint(an.x,an.y,u),Kr=E.upVector(u,Jt.x,Jt.y),di=E.upVector(u,an.x,an.y);Jf(wn,lr,Kr),Jf(wn,lr,Kr),Jf(wn,Ir,di),Jf(wn,Ir,di)}}A&&(_e+=Ke.length-1),B&&ne&&this.zoom>=17&&(vt.length!==0&&ce(vt,vt[0])&&vt.pop(),this.groundEffect.addData(vt,Ee,C,ne>0))}this.footprintSegments.push(Ge),Ne.triangleCount=this.indexArray.length-Ne.triangleArrayOffset,this.polygonSegments.push(Ne),++I.footprintSegLen,++I.polygonSegLen}if(I.vertexCount=this.layoutVertexArray.length-I.vertexArrayOffset,I.groundVertexCount=this.groundEffect.vertexArray.length-I.groundVertexArrayOffset,I.vertexCount!==0){if(I.centroidXY=D.borders?m_:this.encodeCentroid(D,I),this.centroidData.push(I),D.borders){this.featuresOnBorder.push(D);const ue=this.featuresOnBorder.length-1;for(let Ee=0;Ee<D.borders.length;Ee++)D.borders[Ee][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ee].push(ue)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,c,f,u,S),this.groundEffect.addPaintPropertiesData(e,l,c,f,u,S),this.maxHeight=Math.max(this.maxHeight,U)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((r,l)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[l].borders[e][0])}splitToSubtiles(){const e=[];for(let x=0;x<this.centroidData.length;x++){const S=this.centroidData[x],C=+(S.min.y+S.max.y>zt),_=2*C+(+(S.min.x+S.max.x>zt)^C);for(let E=0;E<S.polygonSegLen;E++){const M=S.polygonSegIdx+E;e.push({centroidIdx:x,subtile:_,polygonSegmentIdx:M,triangleSegmentIdx:this.polygonSegments[M].triangleSegIdx})}}const r=new xo;e.sort((x,S)=>x.triangleSegmentIdx===S.triangleSegmentIdx?x.subtile-S.subtile:x.triangleSegmentIdx-S.triangleSegmentIdx);let l=0,u=0,c=0;for(const x of e){if(x.triangleSegmentIdx!==l)break;c++}const f=e.length;for(;u!==e.length;){l=e[u].triangleSegmentIdx;let x=0,S=u,C=u;for(let _=S;_<c&&e[_].subtile===x;_++)C++;for(;S!==c;){const _=e[S];x=_.subtile;const E=this.centroidData[_.centroidIdx].min.clone(),M=this.centroidData[_.centroidIdx].max.clone(),A={vertexOffset:this.segments.segments[l].vertexOffset,primitiveOffset:r.length,vertexLength:this.segments.segments[l].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let D=S;D<C;D++){const I=e[D],B=this.polygonSegments[I.polygonSegmentIdx],U=this.centroidData[I.centroidIdx].min,G=this.centroidData[I.centroidIdx].max,H=this.indexArray.uint16;for(let q=B.triangleArrayOffset;q<B.triangleArrayOffset+B.triangleCount;q++)r.emplaceBack(H[3*q],H[3*q+1],H[3*q+2]);A.primitiveLength+=B.triangleCount,E.x=Math.min(E.x,U.x),E.y=Math.min(E.y,U.y),M.x=Math.max(M.x,G.x),M.y=Math.max(M.y,G.y)}A.primitiveLength>0&&this.triangleSubSegments.push({segment:A,min:E,max:M}),S=C;for(let D=S;D<c&&e[D].subtile===e[S].subtile;D++)C++}u=c;for(let _=u;_<f&&e[_].triangleSegmentIdx===e[u].triangleSegmentIdx;_++)c++}r._trim(),this.indexArray=r}getVisibleSegments(e,r,l){const u=new ri;if(this.wallMode){for(const I of this.triangleSubSegments)u.segments.push(I.segment);return u}let c=0,f=0;const x=1<<e.canonical.z;if(r){const I=r.getMinMaxForTile(e);I&&(c=I.min,f=I.max)}f+=this.maxHeight;const S=e.toUnwrapped();let C;const _=[S.canonical.x/x+S.wrap,S.canonical.y/x],E=[(S.canonical.x+1)/x+S.wrap,(S.canonical.y+1)/x],M=(I,B,U)=>[I[0]*(1-U[0])+B[0]*U[0],I[1]*(1-U[1])+B[1]*U[1]],A=[],D=[];for(const I of this.triangleSubSegments){A[0]=I.min.x/zt,A[1]=I.min.y/zt,D[0]=I.max.x/zt,D[1]=I.max.y/zt;const B=M(_,E,A),U=M(_,E,D);if(new fn([B[0],B[1],c],[U[0],U[1],f]).intersectsPrecise(l)===0){C&&(u.segments.push(C),C=void 0);continue}const G=I.segment;C&&C.vertexOffset!==G.vertexOffset&&(u.segments.push(C),C=void 0),C?(C.vertexLength+=G.vertexLength,C.primitiveLength+=G.primitiveLength):C={vertexOffset:G.vertexOffset,primitiveLength:G.primitiveLength,vertexLength:G.vertexLength,primitiveOffset:G.primitiveOffset,sortKey:void 0,vaos:{}}}return C&&u.segments.push(C),u}encodeCentroid(e,r){const l=e.centroid(),u=r.span(),c=Math.min(7,Math.round(u.x*this.tileToMeter/10)),f=Math.min(7,Math.round(u.y*this.tileToMeter/10));return new qt($n(l.x,1,zt-1)<<3|c,$n(l.y,1,zt-1)<<3|f)}encodeBorderCentroid(e){if(!e.borders)return new qt(0,0);const r=e.borders,l=Number.MAX_VALUE;if(r[0][0]!==l||r[1][0]!==l){const u=r[0][0]!==l?0:1;return new qt(6|(r[0][0]!==l?0:65528),(r[u][0]+r[u][1])/2<<3|6)}{const u=r[2][0]!==l?2:3;return new qt((r[u][0]+r[u][1])/2<<3|6,6|(r[2][0]!==l?0:65528))}}showCentroid(e){const r=this.centroidData[e.centroidDataIndex];r.flags&=ga,r.centroidXY.x=0,r.centroidXY.y=0,this.writeCentroidToBuffer(r)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const r=e.vertexArrayOffset,l=e.vertexCount+e.vertexArrayOffset,u=e.flags&ga?m_:e.centroidXY,c=this.centroidVertexArray.geta_centroid_pos0(r);if(this.centroidVertexArray.geta_centroid_pos1(r)!==u.y||c!==u.x){for(let f=r;f<l;++f)this.centroidVertexArray.emplace(f,u.x,u.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,r,l){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const u=r.getReplacementRegionsForTile(e.toUnwrapped());if(S0(this.activeReplacements,u))return;if(this.activeReplacements=u,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const f of this.centroidData)f.flags&=2147483647;const c=[];for(const f of this.activeReplacements){if(f.order<l)continue;const x=Math.max(1,Math.pow(2,f.footprintTileId.canonical.z-e.canonical.z));for(const S of this.centroidData)if(!(S.flags&ga||f.min.x>S.max.x||S.min.x>f.max.x||f.min.y>S.max.y||S.min.y>f.max.y))for(let C=0;C<S.footprintSegLen;C++){const _=this.footprintSegments[S.footprintSegIdx+C];if(c.length=0,zb(this.footprintVertices,_.vertexOffset,_.vertexCount,f.footprintTileId.canonical,e.canonical,c),Ln(f.footprint,c,this.footprintIndices.uint16,_.indexOffset,_.indexCount,-_.vertexOffset,-x)){S.flags|=ga;break}}}for(const f of this.centroidData)this.writeCentroidToBuffer(f);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,r,l){let u=!1;for(let c=0;c<l.footprintSegLen;c++){const f=this.footprintSegments[l.footprintSegIdx+c];let x=0;for(const S of f.ringIndices){for(let C=x,_=S+x-1;C<S+x;_=C++){const E=this.footprintVertices.int16[2*(C+f.vertexOffset)+0],M=this.footprintVertices.int16[2*(C+f.vertexOffset)+1],A=this.footprintVertices.int16[2*(_+f.vertexOffset)+1];M>r!=A>r&&e<(this.footprintVertices.int16[2*(_+f.vertexOffset)+0]-E)*(r-M)/(A-M)+E&&(u=!u)}x=S}}return u}getHeightAtTileCoord(e,r){let l=Number.NEGATIVE_INFINITY,u=!0;const c=4*(e+zt)*zt+(r+zt);if(this.partLookup.hasOwnProperty(c)){const f=this.partLookup[c];return f?{height:f.height,hidden:!!(f.flags&ga)}:void 0}for(const f of this.centroidData)e>f.max.x||f.min.x>e||r>f.max.y||f.min.y>r||this.footprintContainsPoint(e,r,f)&&f&&f.height>l&&(l=f.height,this.partLookup[c]=f,u=!!(f.flags&ga));if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:u};this.partLookup[c]=void 0}}function Ib(s,e){const r=s.add(e)._unit();return s.x*r.x+s.y*r.y}function Nb(s,e,r,l){const u=e.sub(s)._perp()._unit(),c=r.sub(e)._perp()._unit();return A0(s,e,r,Ib(u,c),l)}function A0(s,e,r,l,u){const c=Math.sqrt(1-l*l);return Math.min(s.dist(e)/3,e.dist(r)/3,u*c/l)}function ep(s,e,r){return s.x<r[0].x&&e.x<r[0].x||s.x>r[1].x&&e.x>r[1].x||s.y<r[0].y&&e.y<r[0].y||s.y>r[1].y&&e.y>r[1].y}function C0(s,e){return s.x<e[0].x||s.x>e[1].x||s.y<e[0].y||s.y>e[1].y}function D0(s,e,r){if(s.x<0||s.x>=zt||e.x<0||e.x>=zt||r.x<0||r.x>=zt)return!1;const l=r.sub(e),u=l.perp(),c=s.sub(e);return(l.x*c.x+l.y*c.y)/Math.sqrt((l.x*l.x+l.y*l.y)*(c.x*c.x+c.y*c.y))>-.866&&u.x*c.x+u.y*c.y<0}function M0(s,e,r){const l=e?2|s:-3&s;return r?1|l:-2&l}function R0(){const s=Math.PI/32,e=Math.tan(s),r=Bl;return r*Math.sqrt(1+2*e*e)-r}function k0(s,e,r){const l=1<<r.z,u=vs(r.x/l),c=vs((r.x+1)/l),f=Sr(r.y/l),x=Sr((r.y+1)/l);return function(S,C,_,E,M=0,A){const D=[];if(!S.length||!_||!E)return D;const I=(J,ne)=>{for(const me of J)D.push({polygon:me,bounds:ne})},B=Math.ceil(Math.log2(_)),U=Math.ceil(Math.log2(E)),G=B-U,H=[];for(let J=0;J<Math.abs(G);J++)H.push(G>0?0:1);for(let J=0;J<Math.min(B,U);J++)H.push(0),H.push(1);let q=S;if(q=hl(q,C[0].y-M,C[1].y+M,1),q=hl(q,C[0].x-M,C[1].x+M,0),!q.length)return D;const Y=[];for(H.length?Y.push({polygons:q,bounds:C,depth:0}):I(q,C);Y.length;){const J=Y.pop(),ne=J.depth,me=H[ne],ce=J.bounds[0],ue=J.bounds[1],Ee=me===0?ce.x:ce.y,_e=me===0?ue.x:ue.y,De=A?A(me,Ee,_e):.5*(Ee+_e),Le=hl(J.polygons,Ee-M,De+M,me),Ne=hl(J.polygons,De-M,_e+M,me);if(Le.length){const Ge=[ce,new qt(me===0?De:ue.x,me===1?De:ue.y)];H.length>ne+1?Y.push({polygons:Le,bounds:Ge,depth:ne+1}):I(Le,Ge)}if(Ne.length){const Ge=[new qt(me===0?De:ce.x,me===1?De:ce.y),ue];H.length>ne+1?Y.push({polygons:Ne,bounds:Ge,depth:ne+1}):I(Ne,Ge)}}return D}(s,e,Math.ceil((c-u)/11.25),Math.ceil((f-x)/11.25),1,(S,C,_)=>{if(S===0)return .5*(C+_);{const E=Sr((r.y+C/zt)/l);return(Ki(.5*(Sr((r.y+_/zt)/l)+E))*l-r.y)*zt}})}function zb(s,e,r,l,u,c){const f=Math.pow(2,l.z-u.z);for(let x=0;x<r;x++){let S=s.int16[2*(x+e)+0],C=s.int16[2*(x+e)+1];S=(S+u.x*zt)*f-l.x*zt,C=(C+u.y*zt)*f-l.y*zt,c.push(new qt(S,C))}}let O0,ov;function Zm(s,e){return s.x*e.x+s.y*e.y}function sv(s,e){if(s.length===1){let r=0;const l=e[r++];let u;for(;!u||l.equals(u);)if(u=e[r++],!u)return 1/0;for(;r<e.length;r++){const c=e[r],f=s[0],x=u.sub(l),S=c.sub(l),C=f.sub(l),_=Zm(x,x),E=Zm(x,S),M=Zm(S,S),A=Zm(C,x),D=Zm(C,S),I=_*M-E*E,B=(M*A-E*D)/I,U=(_*D-E*A)/I,G=l.z*(1-B-U)+u.z*B+c.z*U;if(isFinite(G))return G}return 1/0}{let r=1/0;for(const l of e)r=Math.min(r,l.z);return r}}function av(s,e,r,l,u,c,f,x){const S=f*u.getElevationAt(s,e,!0,!0),C=c[0]!==0,_=C?c[1]===0?f*(c[0]/7-450):f*function(E,M,A){const D=Math.floor(M[0]/8),I=Math.floor(M[1]/8),B=10*(M[0]-8*D),U=10*(M[1]-8*I),G=E.getElevationAt(D,I,!0,!0),H=E.getMeterToDEM(A),q=Math.floor(.5*(B*H-1)),Y=Math.floor(.5*(U*H-1)),J=E.tileCoordToPixel(D,I),ne=2*q+1,me=2*Y+1,ce=function(Ne,Ge,Ve,Ke,Ze){return[Ne.getElevationAtPixel(Ge,Ve,!0),Ne.getElevationAtPixel(Ge+Ze,Ve,!0),Ne.getElevationAtPixel(Ge,Ve+Ze,!0),Ne.getElevationAtPixel(Ge+Ke,Ve+Ze,!0)]}(E,J.x-q,J.y-Y,ne,me),ue=Math.abs(ce[0]-ce[1]),Ee=Math.abs(ce[2]-ce[3]),_e=Math.abs(ce[0]-ce[2])+Math.abs(ce[1]-ce[3]),De=Math.min(.25,.5*H*(ue+Ee)/ne),Le=Math.min(.25,.5*H*_e/me);return G+Math.max(De*B,Le*U)}(u,c,x):S;return{base:S+(r===0?-1:r),top:C?Math.max(_+l,S+r+2):S+l}}nn(iv,"FillExtrusionBucket",{omit:["layers","features"]}),nn(kb,"PartData"),nn(Rb,"FootprintSegment"),nn(E0,"BorderCentroidData"),nn(rv,"GroundEffect");const fl=_r([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),pu=_r([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:rS}=fl,Pb=_r([{name:"a_packed",components:3,type:"Float32"}]),{members:Lb}=Pb,Bb=_r([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Fb}=Bb;class I0{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new jl({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const l=this.getKey(e,r);return this.positions[l]}trim(){const e=this.width,r=this.height=lc(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,l){const u=[];let c=e.length%2==1?-e[e.length-1]*l:0,f=e[0]*l,x=!0;u.push({left:c,right:f,isDash:x,zeroLength:e[0]===0});let S=e[0];for(let C=1;C<e.length;C++){x=!x;const _=e[C];c=S*l,S+=_,f=S*l,u.push({left:c,right:f,isDash:x,zeroLength:_===0})}return u}addRoundDash(e,r,l){const u=r/2;for(let c=-l;c<=l;c++){const f=this.width*(this.nextRow+l+c);let x=0,S=e[x];for(let C=0;C<this.width;C++){C/S.right>1&&(S=e[++x]);const _=Math.abs(C-S.left),E=Math.abs(C-S.right),M=Math.min(_,E);let A;const D=c/l*(u+1);if(S.isDash){const I=u-Math.abs(D);A=Math.sqrt(M*M+I*I)}else A=u-Math.sqrt(M*M+D*D);this.image.data[f+C]=Math.max(0,Math.min(255,A+128))}}}addRegularDash(e,r){for(let S=e.length-1;S>=0;--S){const C=e[S],_=e[S+1];C.zeroLength?e.splice(S,1):_&&_.isDash===C.isDash&&(_.left=C.left,e.splice(S,1))}const l=e[0],u=e[e.length-1];l.isDash===u.isDash&&(l.left=u.left-this.width,u.right=l.right+this.width);const c=this.width*this.nextRow;let f=0,x=e[f];for(let S=0;S<this.width;S++){S/x.right>1&&(x=e[++f]);const C=Math.abs(S-x.left),_=Math.abs(S-x.right),E=Math.min(C,_);this.image.data[c+S]=Math.max(0,Math.min(255,(x.isDash?E:-E)+r+128))}}addDash(e,r){const l=this.getKey(e,r);if(this.positions[l])return this.positions[l];const u=r==="round",c=u?7:0,f=2*c+1;if(this.nextRow+f>this.height)return xe("LineAtlas out of space"),null;e.length===0&&e.push(1);let x=0;for(let _=0;_<e.length;_++)e[_]<0&&(xe("Negative value is found in line dasharray, replacing values with 0"),e[_]=0),x+=e[_];if(x!==0){const _=this.width/x,E=this.getDashRanges(e,this.width,_);u?this.addRoundDash(E,_,c):this.addRegularDash(E,r==="square"?.5*_:0)}const S=this.nextRow+c;this.nextRow+=f;const C={tl:[S,c],br:[x,0]};return this.positions[l]=C,C}}nn(I0,"LineAtlas");const Ub=ul.VectorTileFeature.types,jb=Math.cos(Math.PI/180*37.5),Vb=Math.cos(Math.PI/180*5);class lv{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new ah,this.layoutVertexArray2=new gs,this.patternVertexArray=new gs,this.indexArray=new xo,this.programConfigurations=new ys(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new ri,this.maxLineLength=0,this.zOffsetVertexArray=new gs,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:zt/64}updateFootprints(e,r){}populate(e,r,l,u){this.hasPattern=m0("line",this.layers,this.pixelRatio,r);const c=this.layers[0].layout.get("line-sort-key");this.tileToMeter=h(l);const f=this.layers[0].layout.get("line-z-offset"),x=f.isConstant()&&!f.constantOr(0),S=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset=S==="sea"||S==="ground"||!x&&S==="none",this.hasZOffset&&S==="none"&&xe(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const C=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&C!==void 0;const _=[];for(const{feature:D,id:I,index:B,sourceLayerIndex:U}of e){const G=this.layers[0]._featureFilter.needGeometry,H=F(D,G);if(!this.layers[0]._featureFilter.filter(new Hr(this.zoom),H,l))continue;const q=c?c.evaluate(H,{},l):void 0,Y={id:I,properties:D.properties,type:D.type,sourceLayerIndex:U,index:B,geometry:G?H.geometry:P(D,l,u),patterns:{},sortKey:q};_.push(Y)}c&&_.sort((D,I)=>D.sortKey-I.sortKey);const{lineAtlas:E,featureIndex:M}=r,A=this.addConstantDashes(E);for(const D of _){const{geometry:I,index:B,sourceLayerIndex:U}=D;if(A&&this.addFeatureDashes(D,E),this.hasPattern){const G=Vm("line",this.layers,D,this.zoom,this.pixelRatio,r);this.patternFeatures.push(G)}else this.addFeature(D,I,B,l,E.positions,r.availableImages,r.brightness);M.insert(e[B].feature,I,B,U,this.index)}}addConstantDashes(e){let r=!1;for(const l of this.layers){const u=l.paint.get("line-dasharray").value,c=l.layout.get("line-cap").value;if(u.kind!=="constant"||c.kind!=="constant")r=!0;else{const f=c.value,x=u.value;if(!x)continue;e.addDash(x,f)}}return r}addFeatureDashes(e,r){const l=this.zoom;for(const u of this.layers){const c=u.paint.get("line-dasharray").value,f=u.layout.get("line-cap").value;if(c.kind==="constant"&&f.kind==="constant")continue;let x,S;if(c.kind==="constant"){if(x=c.value,!x)continue}else x=c.evaluate({zoom:l},e);S=f.kind==="constant"?f.value:f.evaluate({zoom:l},e),r.addDash(x,S),e.patterns[u.id]=r.getKey(x,S)}}update(e,r,l,u,c,f,x){this.programConfigurations.updatePaintArrays(e,r,c,l,u,f,x)}addFeatures(e,r,l,u,c,f){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,r,l,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Lb)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,Fb)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,pu.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,rS),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,l,u,c,f,x){const S=this.layers[0].layout,C=S.get("line-join").evaluate(e,{}),_=S.get("line-cap").evaluate(e,{}),E=S.get("line-miter-limit"),M=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=S.get("line-z-offset").value;const A=this.layers[0].paint.get("line-width").value;A.kind!=="constant"&&A.isLineProgressConstant===!1&&(this.variableWidthValue=A);for(const D of r)this.addLine(D,e,u,C,_,E,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,c,f,u,x)}addLine(e,r,l,u,c,f,x){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const S=u==="none";if(this.patternJoinNone=this.hasPattern&&S,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let H=0;H<e.length-1;H++)this.totalDistance+=e[H].dist(e[H+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const C=Ub[r.type]==="Polygon";let _=e.length;for(;_>=2&&e[_-1].equals(e[_-2]);)_--;let E=0;for(;E<_-1&&e[E].equals(e[E+1]);)E++;if(_<(C?3:2))return;u==="bevel"&&(f=1.05);const M=this.segments.prepareSegment(10*_,this.layoutVertexArray,this.indexArray);let A,D,I,B,U,G;this.e1=this.e2=-1,C&&(A=e[_-2],U=e[E].sub(A)._unit()._perp());for(let H=E;H<_;H++){if(I=H===_-1?C?e[E+1]:void 0:e[H+1],I&&e[H].equals(I))continue;U&&(B=U),A&&(D=A),A=e[H],G=this.evaluateLineProgressFeatures(D?D.dist(A):0),U=I?I.sub(A)._unit()._perp():B,B=B||U;const q=D&&I;let Y=q?u:C||S?"butt":c;const J=B.x*U.x+B.y*U.y;if(S){const Le=function(Ne){if(Ne.patternJoinNone){const Ge=Ne.segmentPoints.length/2,Ve=Ne.lineSoFar-Ne.segmentStart;for(let Ke=0;Ke<Ge;++Ke){const Ze=Ne.segmentPoints[2*Ke+1],Je=Math.round(Ne.segmentPoints[2*Ke])+.5+.25*Ze;Ne.patternVertexArray.emplaceBack(Je,Ve,Ne.segmentStart),Ne.patternVertexArray.emplaceBack(Je,Ve,Ne.segmentStart)}Ne.segmentPoints.length=0}Ne.e1=Ne.e2=-1};if(q&&J<Vb){this.updateDistance(D,A),this.addCurrentVertex(A,B,1,1,M,G),Le(this),this.addCurrentVertex(A,U,-1,-1,M,G);continue}if(D){if(!I){this.updateDistance(D,A),this.addCurrentVertex(A,B,1,1,M,G),Le(this);continue}Y="miter"}}let ne=B.add(U);ne.x===0&&ne.y===0||ne._unit();const me=ne.x*U.x+ne.y*U.y,ce=me!==0?1/me:1/0,ue=2*Math.sqrt(2-2*me),Ee=me<jb&&D&&I,_e=B.x*U.y-B.y*U.x>0,De=this.overscaling<=16?15*zt/(512*this.overscaling):0;if(q&&Y==="round"){if(ce<x)Y="miter";else if(ce<=2){const Le=N0(A,-10,zt+10);Y=this.hasZOffset&&(Le||this.hasCrossSlope)?"miter":"fakeround"}}if(Y==="miter"&&ce>f&&(Y="bevel"),Y==="bevel"&&(ce>2&&(Y="flipbevel"),ce<f&&(Y="miter")),D&&!(Y==="miter"&&Ee)&&this.updateDistance(D,A),Y==="miter")if(Ee){const Le=A.dist(D);if(Le>2*De){const Ge=A.sub(A.sub(D)._mult(De/Le)._round());this.updateDistance(D,Ge),this.addCurrentVertex(Ge,B,0,0,M,G),D=Ge}this.updateDistance(D,A),ne._mult(ce),this.addCurrentVertex(A,ne,0,0,M,G);const Ne=A.dist(I);if(Ne>2*De){const Ge=A.add(I.sub(A)._mult(De/Ne)._round());this.updateDistance(A,Ge),this.addCurrentVertex(Ge,U,0,0,M,G),A=Ge}}else ne._mult(ce),this.addCurrentVertex(A,ne,0,0,M,G);else if(Y==="flipbevel"){if(ce>100)ne=U.mult(-1);else{const Le=ce*B.add(U).mag()/B.sub(U).mag();ne._perp()._mult(Le*(_e?-1:1))}this.addCurrentVertex(A,ne,0,0,M,G),this.addCurrentVertex(A,ne.mult(-1),0,0,M,G)}else if(Y==="bevel"||Y==="fakeround"){G!=null&&D&&this.addCurrentVertex(A,B,-1,-1,M,G);const Le=A.dist(D)<=2*De&&Y!=="bevel",Ne=ne.mult(_e?1:-1);Ne._mult(ce);const Ge=U.mult(_e?-1:1),Ve=B.mult(_e?-1:1),Ke=this.evaluateLineProgressFeatures(this.distance);if(G==null&&(this.addHalfVertex(A,Ne.x,Ne.y,!1,!_e,0,M,Ke),Le||this.addHalfVertex(A,Ne.x+2*Ve.x,Ne.y+2*Ve.y,!1,_e,0,M,Ke)),Y==="fakeround"){const Ze=Math.round(180*ue/Math.PI/20);this.addHalfVertex(A,Ve.x,Ve.y,!1,_e,0,M,Ke);for(let Je=0;Je<Ze;Je++){let vt=Je/Ze;if(vt!==.5){const tn=vt-.5;vt+=vt*tn*(vt-1)*((1.0904+J*(J*(3.55645-1.43519*J)-3.2452))*tn*tn+(.848013+J*(.215638*J-1.06021)))}const _t=Ge.sub(Ve)._mult(vt)._add(Ve)._unit();this.addHalfVertex(A,_t.x,_t.y,!1,_e,0,M,Ke)}this.addHalfVertex(A,Ge.x,Ge.y,!1,_e,0,M,Ke)}Le||G!=null||this.addHalfVertex(A,Ne.x+2*Ge.x,Ne.y+2*Ge.y,!1,_e,0,M,Ke),G!=null&&I&&this.addCurrentVertex(A,U,1,1,M,G)}else Y==="butt"?this.addCurrentVertex(A,ne,0,0,M,G):Y==="square"?(D||this.addCurrentVertex(A,ne,-1,-1,M,G),this.addCurrentVertex(A,ne,0,0,M,G),D&&this.addCurrentVertex(A,ne,1,1,M,G)):Y==="round"&&(D&&(this.addCurrentVertex(A,B,0,0,M,G),this.addCurrentVertex(A,B,1,1,M,G,!0)),I&&(this.addCurrentVertex(A,U,-1,-1,M,G,!0),this.addCurrentVertex(A,U,0,0,M,G)))}}addVerticesTo(e,r,l,u,c,f,x,S,C,_){const E=(r.w-e.w)/this.tessellationStep|0;let M=0;const A=this.scaledDistance;if(E>1){this.lineSoFar=e.w;const I=(r.x-e.x)/E,B=(r.y-e.y)/E,U=(r.z-e.z)/E,G=(r.w-e.w)/E;for(let H=1;H<E;++H){e.x+=I,e.y+=B,e.z+=U,this.lineSoFar+=G,M+=G;const q=this.evaluateLineProgressFeatures(this.prevDistance+M);this.scaledDistance=(this.prevDistance+M)/this.totalDistance,this.addHalfVertex(e,l,u,_,!1,x,C,q),this.addHalfVertex(e,c,f,_,!0,-S,C,q)}}this.lineSoFar=r.w,this.scaledDistance=A;const D=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(r,l,u,_,!1,x,C,D),this.addHalfVertex(r,c,f,_,!0,-S,C,D)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):xe(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let r=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(r=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:r}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:r}:{zOffset:0,variableWidth:r}}addCurrentVertex(e,r,l,u,c,f,x=!1){const S=r.x+r.y*l,C=r.y-r.x*l,_=r.y*u-r.x,E=-r.y-r.x*u;if(f!=null){const M=this.hasZOffset,A=-10,D=zt+10,I=f.zOffset,B=new Cb(e.x,e.y,I,this.lineSoFar),U=!!M&&N0(e,A,D),G=this.lineSoFar,H=this.distance;if(this.currentVertex)if(U){const q=this.currentVertexIsOutside,Y=this.currentVertex,J=new Cb(e.x,e.y,I,this.lineSoFar);if(Qy(Y,J,A,D),!N0(J,A,D)){if(q){this.e1=this.e2=-1,this.distance-=Y.dist(B),this.lineSoFar=Y.w;const ne=this.evaluateLineProgressFeatures(Y.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Y,S,C,x,!1,l,c,ne),this.addHalfVertex(Y,_,E,x,!0,-u,c,ne),this.prevDistance=this.distance}this.distance=this.prevDistance+Y.dist(J),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Y,J,S,C,_,E,l,u,c,x),this.distance=H,this.scaledDistance=this.distance/this.totalDistance}}else{const q=this.currentVertex;if(this.currentVertexIsOutside){Qy(q,B,A,D),this.e1=this.e2=-1,this.distance-=q.dist(B),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=q.w;const Y=this.evaluateLineProgressFeatures(q.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(q,S,C,x,!1,l,c,Y),this.addHalfVertex(q,_,E,x,!0,-u,c,Y),this.prevDistance=this.distance,this.distance=H,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(q,B,S,C,_,E,l,u,c,x)}else U||(this.addHalfVertex(e,S,C,x,!1,l,c,f),this.addHalfVertex(e,_,E,x,!0,-u,c,f));this.currentVertex=B,this.currentVertexIsOutside=U,this.lineSoFar=G}else this.addHalfVertex(e,S,C,x,!1,l,c,f),this.addHalfVertex(e,_,E,x,!0,-u,c,f)}addHalfVertex({x:e,y:r},l,u,c,f,x,S,C){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),f||this.segmentPoints.push(this.lineSoFar-this.segmentStart,x)),this.layoutVertexArray.emplaceBack((e<<1)+(c?1:0),(r<<1)+(f?1:0),Math.round(63*l)+128,Math.round(63*u)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const E=En(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,E)}const _=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,_),S.primitiveLength++),f?this.e2=_:this.e1=_,C!=null&&this.zOffsetVertexArray.emplaceBack(C.zOffset,C.variableWidth,C.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,r){this.prevDistance=this.distance,this.distance+=e.dist(r),this.updateScaledDistance()}}function N0(s,e,r){return s.x<e||s.x>r||s.y<e||s.y>r}let z0,qb;function Hb(s,e,r){return e*(zt/(s.tileSize*Math.pow(2,r-s.tileID.overscaledZ)))}nn(lv,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const P0=(s,e,r)=>(1-r)*s+r*e;function g_(s,e){return 1/Hb(s,1,e.tileZoom)}function cv(s,e,r,l){return s.translatePosMatrix(l||e.tileID.projMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const L0=s=>{const e=[];B0(s)&&e.push("RENDER_LINE_DASH"),s.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const r=s.paint.get("line-trim-offset");r[0]===0&&r[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),s.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const l=s.layout.get("line-join").constantOr("miter")==="none",u=!!s.paint.get("line-pattern").constantOr(1);return l&&u&&e.push("LINE_JOIN_NONE"),e};function B0(s){const e=s.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let F0;const Gb=()=>F0||(F0={layout:z0||(z0=new li({"line-cap":new en(Qe.layout_line["line-cap"]),"line-join":new en(Qe.layout_line["line-join"]),"line-miter-limit":new Ot(Qe.layout_line["line-miter-limit"]),"line-round-limit":new Ot(Qe.layout_line["line-round-limit"]),"line-sort-key":new en(Qe.layout_line["line-sort-key"]),"line-z-offset":new en(Qe.layout_line["line-z-offset"]),"line-elevation-reference":new Ot(Qe.layout_line["line-elevation-reference"]),"line-cross-slope":new Ot(Qe.layout_line["line-cross-slope"]),visibility:new Ot(Qe.layout_line.visibility),"line-width-unit":new Ot(Qe.layout_line["line-width-unit"])})),paint:qb||(qb=new li({"line-opacity":new en(Qe.paint_line["line-opacity"]),"line-color":new en(Qe.paint_line["line-color"]),"line-translate":new Ot(Qe.paint_line["line-translate"]),"line-translate-anchor":new Ot(Qe.paint_line["line-translate-anchor"]),"line-width":new en(Qe.paint_line["line-width"]),"line-gap-width":new en(Qe.paint_line["line-gap-width"]),"line-offset":new en(Qe.paint_line["line-offset"]),"line-blur":new en(Qe.paint_line["line-blur"]),"line-dasharray":new en(Qe.paint_line["line-dasharray"]),"line-pattern":new en(Qe.paint_line["line-pattern"]),"line-gradient":new sd(Qe.paint_line["line-gradient"]),"line-trim-offset":new Ot(Qe.paint_line["line-trim-offset"]),"line-trim-fade-range":new Ot(Qe.paint_line["line-trim-fade-range"]),"line-trim-color":new Ot(Qe.paint_line["line-trim-color"]),"line-emissive-strength":new Ot(Qe.paint_line["line-emissive-strength"]),"line-border-width":new en(Qe.paint_line["line-border-width"]),"line-border-color":new en(Qe.paint_line["line-border-color"]),"line-occlusion-opacity":new Ot(Qe.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new en({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new en({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new en({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new en({type:"string",default:"default","property-type":"data-driven"})}))},F0);class iS extends en{possiblyEvaluate(e,r){return r=new Hr(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,l,u){return r=ao({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,l,u)}}let Ym;function tp(s,e){return e>0?e+2*s:s}const U0=_r([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),$b=_r([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Zb=_r([{name:"a_projected_pos",components:4,type:"Float32"}],4);_r([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Yb=_r([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),uv=_r([{name:"a_texb",components:2,type:"Uint16"}]),Wm=_r([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),oS=_r([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);_r([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const __=_r([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Wb=_r([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);_r([{name:"triangle",components:3,type:"Uint16"}]),_r([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),_r([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),_r([{type:"Float32",name:"offsetX"}]),_r([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var $i=24;const Mc=128;function Xb(s,e,r,l,u){if(s.kind==="camera")return s.maxSize;if(s.kind==="composite"){const c=e.possiblyEvaluate(new Hr(s.maxZoom),r).evaluate(u,{},r),f=e.possiblyEvaluate(new Hr(s.minZoom),r).evaluate(u,{},r);return Math.max(c,f)}return e.possiblyEvaluate(new Hr(l)).evaluate(u,{},r)}function dv(s,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Hr(s+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:u}=r;let c=0;for(;c<l.length&&l[c]<=s;)c++;c=Math.max(0,c-1);let f=c;for(;f<l.length&&l[f]<s+1;)f++;f=Math.min(l.length-1,f);const x=l[c],S=l[f];return r.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:S,interpolationType:u}:{kind:"camera",minZoom:x,maxZoom:S,minSize:r.evaluate(new Hr(x)),maxSize:r.evaluate(new Hr(S)),interpolationType:u}}}function ns(s,{uSize:e,uSizeT:r},{lowerSize:l,upperSize:u}){return s.kind==="source"?l/Mc:s.kind==="composite"?En(l/Mc,u/Mc,r):e}function np(s,e,r=1){let l=0,u=0;if(s.kind==="constant")u=s.layoutSize*r;else if(s.kind!=="source"){const{interpolationType:c,minZoom:f,maxZoom:x}=s,S=c?$n(ps.interpolationFactor(c,e,f,x),0,1):0;s.kind==="camera"?u=En(s.minSize,s.maxSize,S)*r:l=S*r}return{uSizeT:l,uSize:u}}var sS=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Mc,evaluateSizeForFeature:ns,evaluateSizeForZoom:np,getRasterizedIconSize:Xb,getSizeData:dv});function aS(s,e,r){return s.sections.forEach(l=>{l.text=function(u,c,f){const x=c.layout.get("text-transform").evaluate(f,{});return x==="uppercase"?u=u.toLocaleUpperCase():x==="lowercase"&&(u=u.toLocaleLowerCase()),vo.applyArabicShaping&&(u=vo.applyArabicShaping(u)),u}(l.text,e,r)}),s}const y_={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function lS(s){return s==="︶"||s==="﹈"||s==="︸"||s==="﹄"||s==="﹂"||s==="︾"||s==="︼"||s==="︺"||s==="︘"||s==="﹀"||s==="︐"||s==="︓"||s==="︔"||s==="｀"||s==="￣"||s==="︑"||s==="︒"}function v_(s){return s==="︵"||s==="﹇"||s==="︷"||s==="﹃"||s==="﹁"||s==="︽"||s==="︻"||s==="︹"||s==="︗"||s==="︿"}var rp,Dh,hv,$l={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function j0(){return rp||(rp=1,$l.read=function(s,e,r,l,u){var c,f,x=8*u-l-1,S=(1<<x)-1,C=S>>1,_=-7,E=r?u-1:0,M=r?-1:1,A=s[e+E];for(E+=M,c=A&(1<<-_)-1,A>>=-_,_+=x;_>0;c=256*c+s[e+E],E+=M,_-=8);for(f=c&(1<<-_)-1,c>>=-_,_+=l;_>0;f=256*f+s[e+E],E+=M,_-=8);if(c===0)c=1-C;else{if(c===S)return f?NaN:1/0*(A?-1:1);f+=Math.pow(2,l),c-=C}return(A?-1:1)*f*Math.pow(2,c-l)},$l.write=function(s,e,r,l,u,c){var f,x,S,C=8*c-u-1,_=(1<<C)-1,E=_>>1,M=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,A=l?0:c-1,D=l?1:-1,I=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(x=isNaN(e)?1:0,f=_):(f=Math.floor(Math.log(e)/Math.LN2),e*(S=Math.pow(2,-f))<1&&(f--,S*=2),(e+=f+E>=1?M/S:M*Math.pow(2,1-E))*S>=2&&(f++,S/=2),f+E>=_?(x=0,f=_):f+E>=1?(x=(e*S-1)*Math.pow(2,u),f+=E):(x=e*Math.pow(2,E-1)*Math.pow(2,u),f=0));u>=8;s[r+A]=255&x,A+=D,x/=256,u-=8);for(f=f<<u|x,C+=u;C>0;s[r+A]=255&f,A+=D,f/=256,C-=8);s[r+A-D]|=128*I}),$l}function Xm(){if(hv)return Dh;hv=1,Dh=e;var s=j0();function e(q){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(q)?q:new Uint8Array(q||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var r=4294967296,l=1/r,u=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function c(q){return q.type===e.Bytes?q.readVarint()+q.pos:q.pos+1}function f(q,Y,J){return J?4294967296*Y+(q>>>0):4294967296*(Y>>>0)+(q>>>0)}function x(q,Y,J){var ne=Y<=16383?1:Y<=2097151?2:Y<=268435455?3:Math.floor(Math.log(Y)/(7*Math.LN2));J.realloc(ne);for(var me=J.pos-1;me>=q;me--)J.buf[me+ne]=J.buf[me]}function S(q,Y){for(var J=0;J<q.length;J++)Y.writeVarint(q[J])}function C(q,Y){for(var J=0;J<q.length;J++)Y.writeSVarint(q[J])}function _(q,Y){for(var J=0;J<q.length;J++)Y.writeFloat(q[J])}function E(q,Y){for(var J=0;J<q.length;J++)Y.writeDouble(q[J])}function M(q,Y){for(var J=0;J<q.length;J++)Y.writeBoolean(q[J])}function A(q,Y){for(var J=0;J<q.length;J++)Y.writeFixed32(q[J])}function D(q,Y){for(var J=0;J<q.length;J++)Y.writeSFixed32(q[J])}function I(q,Y){for(var J=0;J<q.length;J++)Y.writeFixed64(q[J])}function B(q,Y){for(var J=0;J<q.length;J++)Y.writeSFixed64(q[J])}function U(q,Y){return(q[Y]|q[Y+1]<<8|q[Y+2]<<16)+16777216*q[Y+3]}function G(q,Y,J){q[J]=Y,q[J+1]=Y>>>8,q[J+2]=Y>>>16,q[J+3]=Y>>>24}function H(q,Y){return(q[Y]|q[Y+1]<<8|q[Y+2]<<16)+(q[Y+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(q,Y,J){for(J=J||this.length;this.pos<J;){var ne=this.readVarint(),me=ne>>3,ce=this.pos;this.type=7&ne,q(me,Y,this),this.pos===ce&&this.skip(ne)}return Y},readMessage:function(q,Y){return this.readFields(q,Y,this.readVarint()+this.pos)},readFixed32:function(){var q=U(this.buf,this.pos);return this.pos+=4,q},readSFixed32:function(){var q=H(this.buf,this.pos);return this.pos+=4,q},readFixed64:function(){var q=U(this.buf,this.pos)+U(this.buf,this.pos+4)*r;return this.pos+=8,q},readSFixed64:function(){var q=U(this.buf,this.pos)+H(this.buf,this.pos+4)*r;return this.pos+=8,q},readFloat:function(){var q=s.read(this.buf,this.pos,!0,23,4);return this.pos+=4,q},readDouble:function(){var q=s.read(this.buf,this.pos,!0,52,8);return this.pos+=8,q},readVarint:function(q){var Y,J,ne=this.buf;return Y=127&(J=ne[this.pos++]),J<128?Y:(Y|=(127&(J=ne[this.pos++]))<<7,J<128?Y:(Y|=(127&(J=ne[this.pos++]))<<14,J<128?Y:(Y|=(127&(J=ne[this.pos++]))<<21,J<128?Y:function(me,ce,ue){var Ee,_e,De=ue.buf;if(Ee=(112&(_e=De[ue.pos++]))>>4,_e<128||(Ee|=(127&(_e=De[ue.pos++]))<<3,_e<128)||(Ee|=(127&(_e=De[ue.pos++]))<<10,_e<128)||(Ee|=(127&(_e=De[ue.pos++]))<<17,_e<128)||(Ee|=(127&(_e=De[ue.pos++]))<<24,_e<128)||(Ee|=(1&(_e=De[ue.pos++]))<<31,_e<128))return f(me,Ee,ce);throw new Error("Expected varint not more than 10 bytes")}(Y|=(15&(J=ne[this.pos]))<<28,q,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var q=this.readVarint();return q%2==1?(q+1)/-2:q/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var q=this.readVarint()+this.pos,Y=this.pos;return this.pos=q,q-Y>=12&&u?function(J,ne,me){return u.decode(J.subarray(ne,me))}(this.buf,Y,q):function(J,ne,me){for(var ce="",ue=ne;ue<me;){var Ee,_e,De,Le=J[ue],Ne=null,Ge=Le>239?4:Le>223?3:Le>191?2:1;if(ue+Ge>me)break;Ge===1?Le<128&&(Ne=Le):Ge===2?(192&(Ee=J[ue+1]))==128&&(Ne=(31&Le)<<6|63&Ee)<=127&&(Ne=null):Ge===3?(_e=J[ue+2],(192&(Ee=J[ue+1]))==128&&(192&_e)==128&&((Ne=(15&Le)<<12|(63&Ee)<<6|63&_e)<=2047||Ne>=55296&&Ne<=57343)&&(Ne=null)):Ge===4&&(_e=J[ue+2],De=J[ue+3],(192&(Ee=J[ue+1]))==128&&(192&_e)==128&&(192&De)==128&&((Ne=(15&Le)<<18|(63&Ee)<<12|(63&_e)<<6|63&De)<=65535||Ne>=1114112)&&(Ne=null)),Ne===null?(Ne=65533,Ge=1):Ne>65535&&(Ne-=65536,ce+=String.fromCharCode(Ne>>>10&1023|55296),Ne=56320|1023&Ne),ce+=String.fromCharCode(Ne),ue+=Ge}return ce}(this.buf,Y,q)},readBytes:function(){var q=this.readVarint()+this.pos,Y=this.buf.subarray(this.pos,q);return this.pos=q,Y},readPackedVarint:function(q,Y){if(this.type!==e.Bytes)return q.push(this.readVarint(Y));var J=c(this);for(q=q||[];this.pos<J;)q.push(this.readVarint(Y));return q},readPackedSVarint:function(q){if(this.type!==e.Bytes)return q.push(this.readSVarint());var Y=c(this);for(q=q||[];this.pos<Y;)q.push(this.readSVarint());return q},readPackedBoolean:function(q){if(this.type!==e.Bytes)return q.push(this.readBoolean());var Y=c(this);for(q=q||[];this.pos<Y;)q.push(this.readBoolean());return q},readPackedFloat:function(q){if(this.type!==e.Bytes)return q.push(this.readFloat());var Y=c(this);for(q=q||[];this.pos<Y;)q.push(this.readFloat());return q},readPackedDouble:function(q){if(this.type!==e.Bytes)return q.push(this.readDouble());var Y=c(this);for(q=q||[];this.pos<Y;)q.push(this.readDouble());return q},readPackedFixed32:function(q){if(this.type!==e.Bytes)return q.push(this.readFixed32());var Y=c(this);for(q=q||[];this.pos<Y;)q.push(this.readFixed32());return q},readPackedSFixed32:function(q){if(this.type!==e.Bytes)return q.push(this.readSFixed32());var Y=c(this);for(q=q||[];this.pos<Y;)q.push(this.readSFixed32());return q},readPackedFixed64:function(q){if(this.type!==e.Bytes)return q.push(this.readFixed64());var Y=c(this);for(q=q||[];this.pos<Y;)q.push(this.readFixed64());return q},readPackedSFixed64:function(q){if(this.type!==e.Bytes)return q.push(this.readSFixed64());var Y=c(this);for(q=q||[];this.pos<Y;)q.push(this.readSFixed64());return q},skip:function(q){var Y=7&q;if(Y===e.Varint)for(;this.buf[this.pos++]>127;);else if(Y===e.Bytes)this.pos=this.readVarint()+this.pos;else if(Y===e.Fixed32)this.pos+=4;else{if(Y!==e.Fixed64)throw new Error("Unimplemented type: "+Y);this.pos+=8}},writeTag:function(q,Y){this.writeVarint(q<<3|Y)},realloc:function(q){for(var Y=this.length||16;Y<this.pos+q;)Y*=2;if(Y!==this.length){var J=new Uint8Array(Y);J.set(this.buf),this.buf=J,this.length=Y}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(q){this.realloc(4),G(this.buf,q,this.pos),this.pos+=4},writeSFixed32:function(q){this.realloc(4),G(this.buf,q,this.pos),this.pos+=4},writeFixed64:function(q){this.realloc(8),G(this.buf,-1&q,this.pos),G(this.buf,Math.floor(q*l),this.pos+4),this.pos+=8},writeSFixed64:function(q){this.realloc(8),G(this.buf,-1&q,this.pos),G(this.buf,Math.floor(q*l),this.pos+4),this.pos+=8},writeVarint:function(q){(q=+q||0)>268435455||q<0?function(Y,J){var ne,me;if(Y>=0?(ne=Y%4294967296|0,me=Y/4294967296|0):(me=~(-Y/4294967296),4294967295^(ne=~(-Y%4294967296))?ne=ne+1|0:(ne=0,me=me+1|0)),Y>=18446744073709552e3||Y<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");J.realloc(10),function(ce,ue,Ee){Ee.buf[Ee.pos++]=127&ce|128,ce>>>=7,Ee.buf[Ee.pos++]=127&ce|128,ce>>>=7,Ee.buf[Ee.pos++]=127&ce|128,ce>>>=7,Ee.buf[Ee.pos++]=127&ce|128,Ee.buf[Ee.pos]=127&(ce>>>=7)}(ne,0,J),function(ce,ue){var Ee=(7&ce)<<4;ue.buf[ue.pos++]|=Ee|((ce>>>=3)?128:0),ce&&(ue.buf[ue.pos++]=127&ce|((ce>>>=7)?128:0),ce&&(ue.buf[ue.pos++]=127&ce|((ce>>>=7)?128:0),ce&&(ue.buf[ue.pos++]=127&ce|((ce>>>=7)?128:0),ce&&(ue.buf[ue.pos++]=127&ce|((ce>>>=7)?128:0),ce&&(ue.buf[ue.pos++]=127&ce)))))}(me,J)}(q,this):(this.realloc(4),this.buf[this.pos++]=127&q|(q>127?128:0),q<=127||(this.buf[this.pos++]=127&(q>>>=7)|(q>127?128:0),q<=127||(this.buf[this.pos++]=127&(q>>>=7)|(q>127?128:0),q<=127||(this.buf[this.pos++]=q>>>7&127))))},writeSVarint:function(q){this.writeVarint(q<0?2*-q-1:2*q)},writeBoolean:function(q){this.writeVarint(!!q)},writeString:function(q){q=String(q),this.realloc(4*q.length),this.pos++;var Y=this.pos;this.pos=function(ne,me,ce){for(var ue,Ee,_e=0;_e<me.length;_e++){if((ue=me.charCodeAt(_e))>55295&&ue<57344){if(!Ee){ue>56319||_e+1===me.length?(ne[ce++]=239,ne[ce++]=191,ne[ce++]=189):Ee=ue;continue}if(ue<56320){ne[ce++]=239,ne[ce++]=191,ne[ce++]=189,Ee=ue;continue}ue=Ee-55296<<10|ue-56320|65536,Ee=null}else Ee&&(ne[ce++]=239,ne[ce++]=191,ne[ce++]=189,Ee=null);ue<128?ne[ce++]=ue:(ue<2048?ne[ce++]=ue>>6|192:(ue<65536?ne[ce++]=ue>>12|224:(ne[ce++]=ue>>18|240,ne[ce++]=ue>>12&63|128),ne[ce++]=ue>>6&63|128),ne[ce++]=63&ue|128)}return ce}(this.buf,q,this.pos);var J=this.pos-Y;J>=128&&x(Y,J,this),this.pos=Y-1,this.writeVarint(J),this.pos+=J},writeFloat:function(q){this.realloc(4),s.write(this.buf,q,this.pos,!0,23,4),this.pos+=4},writeDouble:function(q){this.realloc(8),s.write(this.buf,q,this.pos,!0,52,8),this.pos+=8},writeBytes:function(q){var Y=q.length;this.writeVarint(Y),this.realloc(Y);for(var J=0;J<Y;J++)this.buf[this.pos++]=q[J]},writeRawMessage:function(q,Y){this.pos++;var J=this.pos;q(Y,this);var ne=this.pos-J;ne>=128&&x(J,ne,this),this.pos=J-1,this.writeVarint(ne),this.pos+=ne},writeMessage:function(q,Y,J){this.writeTag(q,e.Bytes),this.writeRawMessage(Y,J)},writePackedVarint:function(q,Y){Y.length&&this.writeMessage(q,S,Y)},writePackedSVarint:function(q,Y){Y.length&&this.writeMessage(q,C,Y)},writePackedBoolean:function(q,Y){Y.length&&this.writeMessage(q,M,Y)},writePackedFloat:function(q,Y){Y.length&&this.writeMessage(q,_,Y)},writePackedDouble:function(q,Y){Y.length&&this.writeMessage(q,E,Y)},writePackedFixed32:function(q,Y){Y.length&&this.writeMessage(q,A,Y)},writePackedSFixed32:function(q,Y){Y.length&&this.writeMessage(q,D,Y)},writePackedFixed64:function(q,Y){Y.length&&this.writeMessage(q,I,Y)},writePackedSFixed64:function(q,Y){Y.length&&this.writeMessage(q,B,Y)},writeBytesField:function(q,Y){this.writeTag(q,e.Bytes),this.writeBytes(Y)},writeFixed32Field:function(q,Y){this.writeTag(q,e.Fixed32),this.writeFixed32(Y)},writeSFixed32Field:function(q,Y){this.writeTag(q,e.Fixed32),this.writeSFixed32(Y)},writeFixed64Field:function(q,Y){this.writeTag(q,e.Fixed64),this.writeFixed64(Y)},writeSFixed64Field:function(q,Y){this.writeTag(q,e.Fixed64),this.writeSFixed64(Y)},writeVarintField:function(q,Y){this.writeTag(q,e.Varint),this.writeVarint(Y)},writeSVarintField:function(q,Y){this.writeTag(q,e.Varint),this.writeSVarint(Y)},writeStringField:function(q,Y){this.writeTag(q,e.Bytes),this.writeString(Y)},writeFloatField:function(q,Y){this.writeTag(q,e.Fixed32),this.writeFloat(Y)},writeDoubleField:function(q,Y){this.writeTag(q,e.Fixed64),this.writeDouble(Y)},writeBooleanField:function(q,Y){this.writeVarintField(q,!!Y)}},Dh}var Rc=ee(Xm());const x_=3;function fv(s,e,r){e.glyphs=[],s===1&&r.readMessage(ip,e)}function ip(s,e,r){if(s===3){const{id:l,bitmap:u,width:c,height:f,left:x,top:S,advance:C}=r.readMessage(pv,{});e.glyphs.push({id:l,bitmap:new jl({width:c+2*x_,height:f+2*x_},u),metrics:{width:c,height:f,left:x,top:S,advance:C}})}else s===4?e.ascender=r.readSVarint():s===5&&(e.descender=r.readSVarint())}function pv(s,e,r){s===1?e.id=r.readVarint():s===2?e.bitmap=r.readBytes():s===3?e.width=r.readVarint():s===4?e.height=r.readVarint():s===5?e.left=r.readSVarint():s===6?e.top=r.readSVarint():s===7&&(e.advance=r.readVarint())}const b_=x_,_a={horizontal:1,vertical:2,horizontalOnly:3};class op{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,r){const l=new op;return l.scale=e||1,l.fontStack=r,l}static forImage(e){const r=new op;return r.image=e,r}}class Mh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r,l){const u=new Mh;for(let c=0;c<e.sections.length;c++){const f=e.sections[c];f.image?u.addImageSection(f,l):u.addTextSection(f,r)}return u}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(r,l){let u="";for(let c=0;c<r.length;c++){const f=r.charCodeAt(c+1)||null,x=r.charCodeAt(c-1)||null;u+=!l&&(f&&Ug(f)&&!y_[r[c+1]]||x&&Ug(x)&&!y_[r[c-1]])||!y_[r[c]]?r[c]:y_[r[c]]}return u}(this.text,e)}trim(){let e=0;for(let l=0;l<this.text.length&&ap[this.text.charCodeAt(l)];l++)e++;let r=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&ap[this.text.charCodeAt(l)];l--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const l=new Mh;return l.text=this.text.substring(e,r),l.sectionIndex=this.sectionIndex.slice(e,r),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(op.forText(e.scale,e.fontStack||r));const l=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(l)}addImageSection(e,r){const l=e.image?e.image.getPrimary():null;if(!l)return void xe("Can't add FormattedSection with an empty image.");l.scaleSelf(r);const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCodePoint(u),this.sections.push(op.forImage(l)),this.sectionIndex.push(this.sections.length-1)):xe("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function sp(s,e,r,l,u,c,f,x,S,C,_,E,M,A,D,I=1){const B=Mh.fromFeature(s,u,I);E===_a.vertical&&B.verticalizePunctuation(M);let U=[];const G=function(ne,me,ce,ue,Ee,_e){if(!ne)return[];const De=[],Le=function(Ke,Ze,Je,vt,_t,tn){let Ct=0;for(let Bt=0;Bt<Ke.length();Bt++){const bt=Ke.getSection(Bt);Ct+=Jb(Ke.getCodePoint(Bt),bt,vt,_t,Ze,tn)}return Ct/Math.max(1,Math.ceil(Ct/Je))}(ne,me,ce,ue,Ee,_e),Ne=ne.text.indexOf("​")>=0;let Ge=0;for(let Ke=0;Ke<ne.length();Ke++){const Ze=ne.getSection(Ke),Je=ne.getCodePoint(Ke);if(ap[Je]||(Ge+=Jb(Je,Ze,ue,Ee,me,_e)),Ke<ne.length()-1){const vt=!((Ve=Je)<11904||!(vn["Bopomofo Extended"](Ve)||vn.Bopomofo(Ve)||vn["CJK Compatibility Forms"](Ve)||vn["CJK Compatibility Ideographs"](Ve)||vn["CJK Compatibility"](Ve)||vn["CJK Radicals Supplement"](Ve)||vn["CJK Strokes"](Ve)||vn["CJK Symbols and Punctuation"](Ve)||vn["CJK Unified Ideographs Extension A"](Ve)||vn["CJK Unified Ideographs"](Ve)||vn["Enclosed CJK Letters and Months"](Ve)||vn["Halfwidth and Fullwidth Forms"](Ve)||vn.Hiragana(Ve)||vn["Ideographic Description Characters"](Ve)||vn["Kangxi Radicals"](Ve)||vn["Katakana Phonetic Extensions"](Ve)||vn.Katakana(Ve)||vn["Vertical Forms"](Ve)||vn["Yi Radicals"](Ve)||vn["Yi Syllables"](Ve)));(Kb[Je]||vt||Ze.image)&&De.push(mv(Ke+1,Ge,Le,De,cS(Je,ne.getCodePoint(Ke+1),vt&&Ne),!1))}}var Ve;return e1(mv(ne.length(),Ge,Le,De,0,!0))}(B,C,c,e,l,A),{processBidirectionalText:H,processStyledBidirectionalText:q}=vo;if(H&&B.sections.length===1){const ne=H(B.toString(),G);for(const me of ne){const ce=new Mh;ce.text=me,ce.sections=B.sections;for(let ue=0;ue<me.length;ue++)ce.sectionIndex.push(0);U.push(ce)}}else if(q){const ne=q(B.text,B.sectionIndex,G);for(const me of ne){const ce=new Mh;ce.text=me[0],ce.sectionIndex=me[1],ce.sections=B.sections,U.push(ce)}}else U=function(ne,me){const ce=[],ue=ne.text;let Ee=0;for(const _e of me)ce.push(ne.substring(Ee,_e)),Ee=_e;return Ee<ue.length&&ce.push(ne.substring(Ee,ue.length)),ce}(B,G);const Y=[],J={positionedLines:Y,text:B.toString(),top:_[1],bottom:_[1],left:_[0],right:_[0],writingMode:E,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(ne,me,ce,ue,Ee,_e,De,Le,Ne,Ge,Ve,Ke){let Ze=0,Je=0,vt=0;const _t=Le==="right"?1:Le==="left"?0:.5;let tn=!1;for(const an of Ee){const Rn=an.getSections();for(const qn of Rn){if(qn.image)continue;const On=me[qn.fontStack];if(On&&(tn=On.ascender!==void 0&&On.descender!==void 0,!tn))break}if(!tn)break}let Ct=0;for(const an of Ee){an.trim();const Rn=an.getMaxScale(),qn=(Rn-1)*$i,On={positionedGlyphs:[],lineOffset:0};ne.positionedLines[Ct]=On;const Vn=On.positionedGlyphs;let Fn=0;if(!an.length()){Je+=_e,++Ct;continue}let nr=0,pr=0;for(let wn=0;wn<an.length();wn++){const lr=an.getSection(wn),Ir=an.getSectionIndex(wn),Kr=an.getCodePoint(wn);let di=lr.scale,hi=null,zr=null,ji=null,so=$i,ki=0;Ne===_a.vertical&&((Bt=Kr)===12312||Bt===12313||Bt===12316||Bt===12540||Bt===12448)&&(Ne=_a.horizontal);const Vi=!(Ne===_a.horizontal||!Ve&&!th(Kr)||Ve&&(ap[Kr]||Ny(Kr)));if(lr.image){const Fo=ue.get(lr.image.toString());if(!Fo)continue;ji=lr.image,ne.iconsInText=ne.iconsInText||!0,zr=Fo.paddedRect;const ho=Fo.displaySize;di=di*$i/Ke,hi={width:ho[0],height:ho[1],left:0,top:-3,advance:Vi?ho[1]:ho[0],localGlyph:!1},ki=tn?-hi.height*di:Rn*$i-17-ho[1]*di,so=hi.advance;const Qs=(Vi?ho[0]:ho[1])*di-$i*Rn;Qs>0&&Qs>Fn&&(Fn=Qs)}else{const Fo=ce[lr.fontStack];if(!Fo)continue;Fo[Kr]&&(zr=Fo[Kr]);const ho=me[lr.fontStack];if(!ho)continue;const Qs=ho.glyphs[Kr];if(!Qs)continue;if(hi=Qs.metrics,so=Kr!==8203?$i:0,tn){const rf=ho.ascender!==void 0?Math.abs(ho.ascender):0,vl=ho.descender!==void 0?Math.abs(ho.descender):0,ic=(rf+vl)*di;nr<ic&&(nr=ic,pr=(rf-vl)/2*di),ki=-rf*di}else ki=(Rn-di)*$i-17}Vi?(ne.verticalizable=!0,Vn.push({glyph:Kr,image:ji,x:Ze,y:Je+ki,vertical:Vi,scale:di,localGlyph:hi.localGlyph,fontStack:lr.fontStack,sectionIndex:Ir,metrics:hi,rect:zr}),Ze+=so*di+Ge):(Vn.push({glyph:Kr,image:ji,x:Ze,y:Je+ki,vertical:Vi,scale:di,localGlyph:hi.localGlyph,fontStack:lr.fontStack,sectionIndex:Ir,metrics:hi,rect:zr}),Ze+=hi.advance*di+Ge)}Vn.length!==0&&(vt=Math.max(Ze-Ge,vt),tn?t1(Vn,_t,Fn,pr,_e*Rn/2):t1(Vn,_t,Fn,0,_e/2)),Ze=0;const mr=_e*Rn+Fn;On.lineOffset=Math.max(Fn,qn),Je+=mr,++Ct}var Bt;const bt=Je,{horizontalAlign:xn,verticalAlign:Jt}=V0(De);(function(an,Rn,qn,On,Vn,Fn){const nr=(Rn-qn)*Vn,pr=-Fn*On;for(const mr of an)for(const wn of mr.positionedGlyphs)wn.x+=nr,wn.y+=pr})(ne.positionedLines,_t,xn,Jt,vt,bt),ne.top+=-Jt*bt,ne.bottom=ne.top+bt,ne.left+=-xn*vt,ne.right=ne.left+vt,ne.hasBaseline=tn}(J,e,r,l,U,f,x,S,E,C,M,D),!function(ne){for(const me of ne)if(me.positionedGlyphs.length!==0)return!1;return!0}(Y))return J}const ap={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Kb={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Jb(s,e,r,l,u,c){if(e.image){const f=l.get(e.image.toString());return f?f.displaySize[0]*e.scale*$i/c+u:0}{const f=r[e.fontStack],x=f&&f.glyphs[s];return x?x.metrics.advance*e.scale+u:0}}function Qb(s,e,r,l){const u=Math.pow(s-e,2);return l?s<e?u/2:2*u:u+Math.abs(r)*r}function cS(s,e,r){let l=0;return s===10&&(l-=1e4),r&&(l+=150),s!==40&&s!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function mv(s,e,r,l,u,c){let f=null,x=Qb(e,r,u,c);for(const S of l){const C=Qb(e-S.x,r,u,c)+S.badness;C<=x&&(f=S,x=C)}return{index:s,x:e,priorBreak:f,badness:x}}function e1(s){return s?e1(s.priorBreak).concat(s.index):[]}function V0(s){let e=.5,r=.5;switch(s){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function t1(s,e,r,l,u){if(!(e||r||l||u))return;const c=s.length-1,f=s[c],x=(f.x+f.metrics.advance*f.scale)*e;for(let S=0;S<=c;S++)s[S].x-=x,s[S].y+=r+l+u}function uS(s,e,r,l){const{horizontalAlign:u,verticalAlign:c}=V0(l),f=r[0]-s.displaySize[0]*u,x=r[1]-s.displaySize[1]*c;return{imagePrimary:s,imageSecondary:e,top:x,bottom:x+s.displaySize[1],left:f,right:f+s.displaySize[0]}}function n1(s,e,r,l,u,c){const f=s.imagePrimary;let x;if(f.content){const B=f.content,U=f.pixelRatio||1;x=[B[0]/U,B[1]/U,f.displaySize[0]-B[2]/U,f.displaySize[1]-B[3]/U]}const S=e.left*c,C=e.right*c;let _,E,M,A;r==="width"||r==="both"?(A=u[0]+S-l[3],E=u[0]+C+l[1]):(A=u[0]+(S+C-f.displaySize[0])/2,E=A+f.displaySize[0]);const D=e.top*c,I=e.bottom*c;return r==="height"||r==="both"?(_=u[1]+D-l[0],M=u[1]+I+l[2]):(_=u[1]+(D+I-f.displaySize[1])/2,M=_+f.displaySize[1]),{imagePrimary:f,imageSecondary:void 0,top:_,right:E,bottom:M,left:A,collisionPadding:x}}class mu extends qt{constructor(e,r,l,u,c){super(e,r),this.angle=u,this.z=l,c!==void 0&&(this.segment=c)}clone(){return new mu(this.x,this.y,this.z,this.angle,this.segment)}}function r1(s,e,r,l,u){if(e.segment===void 0)return!0;let c=e,f=e.segment+1,x=0;for(;x>-r/2;){if(f--,f<0)return!1;x-=s[f].dist(c),c=s[f]}x+=s[f].dist(s[f+1]),f++;const S=[];let C=0;for(;x<r/2;){const _=s[f],E=s[f+1];if(!E)return!1;let M=s[f-1].angleTo(_)-_.angleTo(E);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:x,angleDelta:M}),C+=M;x-S[0].distance>l;)C-=S.shift().angleDelta;if(C>u)return!1;f++,x+=_.dist(E)}return!0}function i1(s){let e=0;for(let r=0;r<s.length-1;r++)e+=s[r].dist(s[r+1]);return e}function o1(s,e,r){return s?.6*e*r:0}function s1(s,e){return Math.max(s?s.right-s.left:0,e?e.right-e.left:0)}function dS(s,e,r,l,u,c){const f=o1(r,u,c),x=s1(r,l)*c;let S=0;const C=i1(s)/2;for(let _=0;_<s.length-1;_++){const E=s[_],M=s[_+1],A=E.dist(M);if(S+A>C){const D=(C-S)/A,I=En(E.x,M.x,D),B=En(E.y,M.y,D),U=new mu(I,B,0,M.angleTo(E),_);return!f||r1(s,U,x,f,e)?U:void 0}S+=A}}function hS(s,e,r,l,u,c,f,x,S){const C=o1(l,c,f),_=s1(l,u),E=_*f,M=s[0].x===0||s[0].x===S||s[0].y===0||s[0].y===S;return e-E<e/4&&(e=E+e/4),a1(s,M?e/2*x%e:(_/2+2*c)*f*x%e,e,C,r,E,M,!1,S)}function a1(s,e,r,l,u,c,f,x,S){const C=c/2,_=i1(s);let E=0,M=e-r,A=[];for(let D=0;D<s.length-1;D++){const I=s[D],B=s[D+1],U=I.dist(B),G=B.angleTo(I);for(;M+r<E+U;){M+=r;const H=(M-E)/U,q=En(I.x,B.x,H),Y=En(I.y,B.y,H);if(q>=0&&q<S&&Y>=0&&Y<S&&M-C>=0&&M+C<=_){const J=new mu(q,Y,0,G,D);l&&!r1(s,J,c,l,u)||A.push(J)}}E+=U}return x||A.length||f||(A=a1(s,E/2,r,l,u,c,f,!0,S)),A}function q0(s,e,r,l,u){const c=[];for(let f=0;f<s.length;f++){const x=s[f];let S;for(let C=0;C<x.length-1;C++){let _=x[C],E=x[C+1];_.x<e&&E.x<e||(_.x<e?_=new qt(e,_.y+(e-_.x)/(E.x-_.x)*(E.y-_.y))._round():E.x<e&&(E=new qt(e,_.y+(e-_.x)/(E.x-_.x)*(E.y-_.y))._round()),_.y<r&&E.y<r||(_.y<r?_=new qt(_.x+(r-_.y)/(E.y-_.y)*(E.x-_.x),r)._round():E.y<r&&(E=new qt(_.x+(r-_.y)/(E.y-_.y)*(E.x-_.x),r)._round()),_.x>=l&&E.x>=l||(_.x>=l?_=new qt(l,_.y+(l-_.x)/(E.x-_.x)*(E.y-_.y))._round():E.x>=l&&(E=new qt(l,_.y+(l-_.x)/(E.x-_.x)*(E.y-_.y))._round()),_.y>=u&&E.y>=u||(_.y>=u?_=new qt(_.x+(u-_.y)/(E.y-_.y)*(E.x-_.x),u)._round():E.y>=u&&(E=new qt(_.x+(u-_.y)/(E.y-_.y)*(E.x-_.x),u)._round()),S&&_.equals(S[S.length-1])||(S=[_],c.push(S)),S.push(E)))))}}return c}function l1(s){let e=0,r=0;for(const f of s)e+=f.w*f.h,r=Math.max(r,f.w);s.sort((f,x)=>x.h-f.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let u=0,c=0;for(const f of s)for(let x=l.length-1;x>=0;x--){const S=l[x];if(!(f.w>S.w||f.h>S.h)){if(f.x=S.x,f.y=S.y,c=Math.max(c,f.y+f.h),u=Math.max(u,f.x+f.w),f.w===S.w&&f.h===S.h){const C=l.pop();x<l.length&&(l[x]=C)}else f.h===S.h?(S.x+=f.w,S.w-=f.w):f.w===S.w?(S.y+=f.h,S.h-=f.h):(l.push({x:S.x+f.w,y:S.y,w:S.w-f.w,h:f.h}),S.y+=f.h,S.h-=f.h);break}}return{w:u,h:c,fill:e/(u*c)||0}}nn(mu,"Anchor");const Km=1;class w_{static getImagePositionScale(e,r,l){if(r&&e&&e.options&&e.options.transform){const u=e.options.transform;return{x:u.a,y:u.d}}return{x:l,y:l}}constructor(e,r,l,u){this.paddedRect=e;const{pixelRatio:c,version:f,stretchX:x,stretchY:S,content:C,sdf:_,usvg:E}=r;this.pixelRatio=c,this.stretchX=x,this.stretchY=S,this.content=C,this.version=f,this.padding=l,this.sdf=_,this.scale=w_.getImagePositionScale(u,E,c)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function c1(s,e,r){const l=Ha.parse(s),u=function(c,f,x=[1,1]){return{x:0,y:0,w:(c.data?c.data.width:c.width*x[0])+2*f,h:(c.data?c.data.height:c.height*x[1])+2*f}}(e,r,[l.options.transform.a,l.options.transform.d]);return{bin:u,imagePosition:new w_(u,e,r,l),imageVariant:l}}class u1{constructor(e,r,l){const u=new Map,c=new Map;this.haveRenderCallbacks=[];const f=[];this.addImages(e,u,Km,f),this.addImages(r,c,2,f);const{w:x,h:S}=l1(f),C=new So({width:x||1,height:S||1});for(const[_,E]of e.entries()){const M=u.get(_).paddedRect;So.copy(E.data,C,{x:0,y:0},{x:M.x+Km,y:M.y+Km},E.data,l,E.sdf)}for(const[_,E]of r.entries()){const M=c.get(_),A=M.paddedRect;let D=M.padding;const I=A.x+D,B=A.y+D,U=E.data.width,G=E.data.height;D=D>1?D-1:D,So.copy(E.data,C,{x:0,y:0},{x:I,y:B},E.data,l),So.copy(E.data,C,{x:0,y:G-D},{x:I,y:B-D},{width:U,height:D},l),So.copy(E.data,C,{x:0,y:0},{x:I,y:B+G},{width:U,height:D},l),So.copy(E.data,C,{x:U-D,y:0},{x:I-D,y:B},{width:D,height:G},l),So.copy(E.data,C,{x:0,y:0},{x:I+U,y:B},{width:D,height:G},l),So.copy(E.data,C,{x:U-D,y:G-D},{x:I-D,y:B-D},{width:D,height:D},l),So.copy(E.data,C,{x:0,y:G-D},{x:I+U,y:B-D},{width:D,height:D},l),So.copy(E.data,C,{x:0,y:0},{x:I+U,y:B+G},{width:D,height:D},l),So.copy(E.data,C,{x:U-D,y:0},{x:I-D,y:B+G},{width:D,height:D},l)}this.lut=l,this.image=C,this.iconPositions=u,this.patternPositions=c}addImages(e,r,l,u){for(const[c,f]of e.entries()){const{bin:x,imagePosition:S,imageVariant:C}=c1(c,f,l);r.set(c,S),u.push(x),f.hasRenderCallback&&this.haveRenderCallbacks.push(C.id)}}patchUpdatedImages(e,r,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>e.hasImage(u,l)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,l);for(const u of e.getUpdatedImages(l)){for(const c of this.iconPositions.keys()){const f=Ha.parse(c);if(go.isEqual(f.id,u)){const x=e.getImage(u,l);this.patchUpdatedImage(this.iconPositions.get(c),x,r)}}for(const c of this.patternPositions.keys()){const f=Ha.parse(c);if(go.isEqual(f.id,u)){const x=e.getImage(u,l);this.patchUpdatedImage(this.patternPositions.get(c),x,r)}}}}patchUpdatedImage(e,r,l){if(!e||!r||e.version===r.version)return;e.version=r.version;const[u,c]=e.tl,f=e.sdf;if(this.lut||f){const x={width:r.data.width,height:r.data.height},S=new So(x);So.copy(r.data,S,{x:0,y:0},{x:0,y:0},x,this.lut,f),l.update(S,{position:{x:u,y:c}})}else l.update(r.data,{position:{x:u,y:c}})}}nn(w_,"ImagePosition"),nn(u1,"ImageAtlas");const gv=1e20;function d1(s,e,r,l,u,c,f,x,S){for(let C=e;C<e+l;C++)h1(s,r*c+C,c,u,f,x,S);for(let C=r;C<r+u;C++)h1(s,C*c+e,1,l,f,x,S)}function h1(s,e,r,l,u,c,f){c[0]=0,f[0]=-1e20,f[1]=gv,u[0]=s[e];for(let x=1,S=0,C=0;x<l;x++){u[x]=s[e+x*r];const _=x*x;do{const E=c[S];C=(u[x]-u[E]+_-E*E)/(x-E)/2}while(C<=f[S]&&--S>-1);S++,c[S]=x,f[S]=C,f[S+1]=gv}for(let x=0,S=0;x<l;x++){for(;f[S+1]<x;)S++;const C=c[S],_=x-C;s[e+x*r]=u[C]+_*_}}const kc=2,_v={none:0,ideographs:1,all:2};class Rh{constructor(e,r,l){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=l,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,r){this.urls[r]=e}getGlyphs(e,r,l){const u=[],c=this.urls[r]||ie.GLYPHS_URL;for(const f in e)for(const x of e[f])u.push({stack:f,id:x});Ua(u,({stack:f,id:x},S)=>{let C=this.entries[f];C||(C=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let _=C.glyphs[x];if(_!==void 0)return void S(null,{stack:f,id:x,glyph:_});if(_=this._tinySDF(C,f,x),_)return C.glyphs[x]=_,void S(null,{stack:f,id:x,glyph:_});const E=Math.floor(x/256);if(256*E>65535)return xe("glyphs > 65535 not supported"),void S(null,{stack:f,id:x,glyph:_});if(C.ranges[E])return void S(null,{stack:f,id:x,glyph:_});let M=C.requests[E];M||(M=C.requests[E]=[],Rh.loadGlyphRange(f,E,c,this.requestManager,(A,D)=>{if(D){C.ascender=D.ascender,C.descender=D.descender;for(const I in D.glyphs)this._doesCharSupportLocalGlyph(+I)||(C.glyphs[+I]=D.glyphs[+I]);C.ranges[E]=!0}for(const I of M)I(A,D);delete C.requests[E]})),M.push((A,D)=>{A?S(A):D&&S(null,{stack:f,id:x,glyph:D.glyphs[x]||null})})},(f,x)=>{if(f)l(f);else if(x){const S={};for(const{stack:C,id:_,glyph:E}of x)S[C]===void 0&&(S[C]={}),S[C].glyphs===void 0&&(S[C].glyphs={}),S[C].glyphs[_]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},S[C].ascender=this.entries[C].ascender,S[C].descender=this.entries[C].descender;l(null,S)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==_v.none&&(this.localGlyphMode===_v.all?!!this.localFontFamily:!!this.localFontFamily&&(vn["CJK Unified Ideographs"](e)||vn["Hangul Syllables"](e)||vn.Hiragana(e)||vn.Katakana(e)||vn["CJK Symbols and Punctuation"](e)||vn["CJK Unified Ideographs Extension A"](e)||vn["CJK Unified Ideographs Extension B"](e)||vn.Osage(e)))}_tinySDF(e,r,l){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let c=e.tinySDF;if(!c){let I="400";/bold/i.test(r)?I="900":/medium/i.test(r)?I="500":/light/i.test(r)&&(I="200"),c=e.tinySDF=new Rh.TinySDF({fontFamily:u,fontWeight:I,fontSize:24*kc,buffer:3*kc,radius:8*kc}),c.fontWeight=I}if(this.localGlyphs[c.fontWeight][l])return this.localGlyphs[c.fontWeight][l];const f=String.fromCodePoint(l),{data:x,width:S,height:C,glyphWidth:_,glyphHeight:E,glyphLeft:M,glyphTop:A,glyphAdvance:D}=c.draw(f);return this.localGlyphs[c.fontWeight][l]={id:l,bitmap:new jl({width:S,height:C},x),metrics:{width:_/kc,height:E/kc,left:M/kc,top:A/kc-27,advance:D/kc,localGlyph:!0}}}}Rh.loadGlyphRange=function(s,e,r,l,u){const c=256*e,f=c+255,x=l.transformRequest(l.normalizeGlyphsURL(r).replace("{fontstack}",s).replace("{range}",`${c}-${f}`),io.Glyphs);Va(x,(S,C)=>{if(S)u(S);else if(C){const _={},E=function(M){return new Rc(M).readFields(fv,{})}(C);for(const M of E.glyphs)_[M.id]=M;u(null,{glyphs:_,ascender:E.ascender,descender:E.descender})}})},Rh.TinySDF=class{constructor({fontSize:s=24,buffer:e=3,radius:r=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:c="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=r;const x=this.size=s+4*e,S=this._createCanvas(x),C=this.ctx=S.getContext("2d",{willReadFrequently:!0});C.font=`${f} ${c} ${s}px ${u}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(s){const e=document.createElement("canvas");return e.width=e.height=s,e}draw(s){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:c}=this.ctx.measureText(s),f=Math.ceil(r),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(c-u))),S=Math.min(this.size-this.buffer,f+Math.ceil(l)),C=x+2*this.buffer,_=S+2*this.buffer,E=Math.max(C*_,0),M=new Uint8ClampedArray(E),A={data:M,width:C,height:_,glyphWidth:x,glyphHeight:S,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(x===0||S===0)return A;const{ctx:D,buffer:I,gridInner:B,gridOuter:U}=this;D.clearRect(I,I,x,S),D.fillText(s,I,I+f);const G=D.getImageData(I,I,x,S);U.fill(gv,0,E),B.fill(0,0,E);for(let H=0;H<S;H++)for(let q=0;q<x;q++){const Y=G.data[4*(H*x+q)+3]/255;if(Y===0)continue;const J=(H+I)*C+q+I;if(Y===1)U[J]=0,B[J]=gv;else{const ne=.5-Y;U[J]=ne>0?ne*ne:0,B[J]=ne<0?ne*ne:0}}d1(U,0,0,C,_,C,this.f,this.v,this.z),d1(B,I,I,x,S,C,this.f,this.v,this.z);for(let H=0;H<E;H++){const q=Math.sqrt(U[H])-Math.sqrt(B[H]);M[H]=Math.round(255-255*(q/this.radius+this.cutoff))}return A}};const Oc=Km;function f1(s,e){return s+e[1]-e[0]}function H0(s,e,r,l,u=1){const c=[],f=s.imagePrimary,x=f.pixelRatio,S=f.paddedRect.w-2*Oc,C=f.paddedRect.h-2*Oc,_=(s.right-s.left)*u,E=(s.bottom-s.top)*u,M=f.stretchX||[[0,S]],A=f.stretchY||[[0,C]],D=M.reduce(f1,0),I=A.reduce(f1,0),B=S-D,U=C-I;let G=0,H=D,q=0,Y=I,J=0,ne=B,me=0,ce=U;if(f.content&&l){const Ee=f.content;G=S_(M,0,Ee[0]),q=S_(A,0,Ee[1]),H=S_(M,Ee[0],Ee[2]),Y=S_(A,Ee[1],Ee[3]),J=Ee[0]-G,me=Ee[1]-q,ne=Ee[2]-Ee[0]-H,ce=Ee[3]-Ee[1]-Y}const ue=(Ee,_e,De,Le)=>{const Ne=T_(Ee.stretch-G,H,_,s.left*u),Ge=vd(Ee.fixed-J,ne,Ee.stretch,D),Ve=T_(_e.stretch-q,Y,E,s.top*u),Ke=vd(_e.fixed-me,ce,_e.stretch,I),Ze=T_(De.stretch-G,H,_,s.left*u),Je=vd(De.fixed-J,ne,De.stretch,D),vt=T_(Le.stretch-q,Y,E,s.top*u),_t=vd(Le.fixed-me,ce,Le.stretch,I),tn=new qt(Ne,Ve),Ct=new qt(Ze,Ve),Bt=new qt(Ze,vt),bt=new qt(Ne,vt),xn=new qt(Ge/x,Ke/x),Jt=new qt(Je/x,_t/x),an=e*Math.PI/180;if(an){const nr=Math.sin(an),pr=Math.cos(an),mr=[pr,-nr,nr,pr];tn._matMult(mr),Ct._matMult(mr),bt._matMult(mr),Bt._matMult(mr)}const Rn=Ee.stretch+Ee.fixed,qn=De.stretch+De.fixed,On=_e.stretch+_e.fixed,Vn=Le.stretch+Le.fixed,Fn=s.imageSecondary;return{tl:tn,tr:Ct,bl:bt,br:Bt,texPrimary:{x:f.paddedRect.x+Oc+Rn,y:f.paddedRect.y+Oc+On,w:qn-Rn,h:Vn-On},texSecondary:Fn?{x:Fn.paddedRect.x+Oc+Rn,y:Fn.paddedRect.y+Oc+On,w:qn-Rn,h:Vn-On}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:xn,pixelOffsetBR:Jt,minFontScaleX:ne/x/_,minFontScaleY:ce/x/E,isSDF:r}};if(l&&(f.stretchX||f.stretchY)){const Ee=G0(M,B,D),_e=G0(A,U,I);for(let De=0;De<Ee.length-1;De++){const Le=Ee[De],Ne=Ee[De+1];for(let Ge=0;Ge<_e.length-1;Ge++)c.push(ue(Le,_e[Ge],Ne,_e[Ge+1]))}}else c.push(ue({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:C+1}));return c}function S_(s,e,r){let l=0;for(const u of s)l+=Math.max(e,Math.min(r,u[1]))-Math.max(e,Math.min(r,u[0]));return l}function G0(s,e,r){const l=[{fixed:-1,stretch:0}];for(const[u,c]of s){const f=l[l.length-1];l.push({fixed:u-f.stretch,stretch:f.stretch}),l.push({fixed:u-f.stretch,stretch:f.stretch+(c-u)})}return l.push({fixed:e+Oc,stretch:r}),l}function T_(s,e,r,l){return s/e*r+l}function vd(s,e,r,l){return s-e*r/l}function fS(s,e,r,l){const u=e+s.positionedLines[l].lineOffset;return l===0?r+u/2:r+(u+(e+s.positionedLines[l-1].lineOffset))/2}function E_(s,e=1,r=!1){let l=1/0,u=1/0,c=-1/0,f=-1/0;const x=s[0];for(let A=0;A<x.length;A++){const D=x[A];(!A||D.x<l)&&(l=D.x),(!A||D.y<u)&&(u=D.y),(!A||D.x>c)&&(c=D.x),(!A||D.y>f)&&(f=D.y)}const S=Math.min(c-l,f-u);let C=S/2;const _=new Gd([],A_);if(S===0)return new qt(l,u);for(let A=l;A<c;A+=S)for(let D=u;D<f;D+=S)_.push(new lp(A+C,D+C,C,s));let E=function(A){let D=0,I=0,B=0;const U=A[0];for(let G=0,H=U.length,q=H-1;G<H;q=G++){const Y=U[G],J=U[q],ne=Y.x*J.y-J.x*Y.y;I+=(Y.x+J.x)*ne,B+=(Y.y+J.y)*ne,D+=3*ne}return new lp(I/D,B/D,0,A)}(s),M=_.length;for(;_.length;){const A=_.pop();(A.d>E.d||!E.d)&&(E=A,r&&console.log("found best %d after %d probes",Math.round(1e4*A.d)/1e4,M)),A.max-E.d<=e||(C=A.h/2,_.push(new lp(A.p.x-C,A.p.y-C,C,s)),_.push(new lp(A.p.x+C,A.p.y-C,C,s)),_.push(new lp(A.p.x-C,A.p.y+C,C,s)),_.push(new lp(A.p.x+C,A.p.y+C,C,s)),M+=4)}return r&&(console.log(`num probes: ${M}`),console.log(`best distance: ${E.d}`)),E.p}function A_(s,e){return e.max-s.max}class lp{constructor(e,r,l,u){this.p=new qt(e,r),this.h=l,this.d=function(c,f){let x=!1,S=1/0;for(let C=0;C<f.length;C++){const _=f[C];for(let E=0,M=_.length,A=M-1;E<M;A=E++){const D=_[E],I=_[A];D.y>c.y!=I.y>c.y&&c.x<(I.x-D.x)*(c.y-D.y)/(I.y-D.y)+D.x&&(x=!x),S=Math.min(S,Ae(c,D,I))}}return(x?1:-1)*Math.sqrt(S)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}}const bs=Number.POSITIVE_INFINITY,pS=Math.sqrt(2);function cp(s,[e,r]){let l=0,u=0;if(r===bs){e<0&&(e=0);const c=e/pS;switch(s){case"top-right":case"top-left":u=c-7;break;case"bottom-right":case"bottom-left":u=7-c;break;case"bottom":u=7-e;break;case"top":u=e-7}switch(s){case"top-right":case"bottom-right":l=-c;break;case"top-left":case"bottom-left":l=c;break;case"left":l=e;break;case"right":l=-e}}else{switch(e=Math.abs(e),r=Math.abs(r),s){case"top-right":case"top-left":case"top":u=r-7;break;case"bottom-right":case"bottom-left":case"bottom":u=7-r}switch(s){case"top-right":case"bottom-right":case"right":l=-e;break;case"top-left":case"bottom-left":case"left":l=e}}return[l,u]}function yv(s,e,r,l,u,c,f,x){if(!s)return;const S=Xb(e,r,l,u,c);return s.scaleSelf(S*x*f)}function Jm(s,e,r,l,u,c,f,x){return{iconPrimary:yv(s.getPrimary(),e,r,l,u,c,f,x),iconSecondary:yv(s.getSecondary(),e,r,l,u,c,f,x)}}function vv(s,e,r,l){if(!s)return;const u=e.get(r.toString());if(s.imagePrimary=u,l){const c=e.get(l.toString());s.imageSecondary=c}}function Qm(s,e){for(const r in s.horizontal)xv(s.horizontal[r],e);xv(s.vertical,e)}function xv(s,e){if(s){for(const r of s.positionedLines)for(const l of r.positionedGlyphs)if(l.image!==null){const u=l.image.toString();l.rect=e.get(u).paddedRect}}}function bv(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function p1(s,e,r,l,u,c,f,x,S){const C=$0(c.horizontal)||c.vertical,_=r.get("icon-text-fit-padding").evaluate(l,{},u);let E,M=e;return e&&S!=="none"&&(s.allowVerticalPlacement&&c.vertical&&(E=n1(e,c.vertical,S,_,x,f)),C&&(M=n1(e,C,S,_,x,f))),{defaultShapedIcon:M,verticallyShapedIcon:E}}function m1(s,e,r,l,u,c,f,x,S,C,_,E,M,A,D,I,B,U,G,H){let q=f.textMaxSize.evaluate(e,{},M);q===void 0?q=x*f.textScaleFactor:q*=f.textScaleFactor;const Y=s.layers[0].layout,J=$0(r.horizontal)||r.vertical,ne=A.name==="globe",me=$i,ce=s.tilePixelRatio*q/me,ue=(Ge=s.overscaling,s.zoom>18&&Ge>2&&(Ge>>=1),Math.max(zt/(512*Ge),1)*Y.get("symbol-spacing")),Ee=Y.get("text-padding")*s.tilePixelRatio,_e=Y.get("icon-padding")*s.tilePixelRatio,De=Jn(Y.get("text-max-angle")),Le=Y.get("icon-rotation-alignment")==="map"&&H!=="point",Ne=ue/2;var Ge;s.hasAnyIconTextFit===!1&&B!=="none"&&(s.hasAnyIconTextFit=!0);const Ve=e.properties?+e.properties[Vl]:null,Ke=Ve&&s.elevationFeatureIdToIndex?s.elevationFeatureIdToIndex.get(Ve):65535,Ze=(Je,vt,_t)=>{if(vt.x<0||vt.x>=zt||vt.y<0||vt.y>=zt)return;let tn=null;if(ne){const{x:Ct,y:Bt,z:bt}=A.projectTilePoint(vt.x,vt.y,_t);tn={anchor:new mu(Ct,Bt,bt,0,void 0),up:A.upVector(_t,vt.x,vt.y)}}(function(Ct,Bt,bt,xn,Jt,an,Rn,qn,On,Vn,Fn,nr,pr,mr,wn,lr,Ir,Kr,di,hi,zr,ji,so,ki,Vi,Fo,ho,Qs,rf){const vl=Ct.addToLineVertexArray(Bt,xn);let ic,Nd,zd,of,Nx,zx,Px,Lx=0,Bx=0,ry=0,iy=0,oy=-1,bu=-1;const Cs={};let Pd=Os("");const Pc=bt?bt.anchor:Bt,kp=Qs!=="none";let wu=0,Fx=0;if(On._unevaluatedLayout.getValue("text-radial-offset")===void 0?[wu,Fx]=On.layout.get("text-offset").evaluate(zr,{},Vi).map(o=>o*$i):(wu=On.layout.get("text-radial-offset").evaluate(zr,{},Vi)*$i,Fx=bs),Ct.allowVerticalPlacement&&Jt.vertical){const o=Jt.vertical;if(wn)zx=wv(o),qn&&(Px=wv(qn));else{const p=On.layout.get("text-rotate").evaluate(zr,{},Vi)+90;zd=C_(Vn,Pc,Bt,Fn,nr,pr,o,mr,p,lr),qn&&(of=C_(Vn,Pc,Bt,Fn,nr,pr,qn,Kr,p))}}if(an){const o=Ct.iconSizeData,p=On.layout.get("icon-rotate").evaluate(zr,{},Vi),b=H0(an,p,so,kp,ji.iconScaleFactor),O=qn?H0(qn,p,so,kp,ji.iconScaleFactor):void 0;Nd=C_(Vn,Pc,Bt,Fn,nr,pr,an,Kr,p,null),Lx=4*b.length;let z=null;o.kind==="source"?(z=[Mc*On.layout.get("icon-size").evaluate(zr,{},Vi)*ji.iconScaleFactor],z[0]>kh&&xe(`${Ct.layerIds[0]}: Value for "icon-size" is >= ${eg}. Reduce your "icon-size".`)):o.kind==="composite"&&(z=[Mc*ji.compositeIconSizes[0].evaluate(zr,{},Vi)*ji.iconScaleFactor,Mc*ji.compositeIconSizes[1].evaluate(zr,{},Vi)*ji.iconScaleFactor],(z[0]>kh||z[1]>kh)&&xe(`${Ct.layerIds[0]}: Value for "icon-size" is >= ${eg}. Reduce your "icon-size".`)),Ct.addSymbols(Ct.icon,b,z,hi,di,zr,!1,bt,Bt,vl.lineStartIndex,vl.lineLength,-1,ki,Vi,Fo,ho),oy=Ct.icon.placedSymbolArray.length-1,O&&(Bx=4*O.length,Ct.addSymbols(Ct.icon,O,z,hi,di,zr,_a.vertical,bt,Bt,vl.lineStartIndex,vl.lineLength,-1,ki,Vi,Fo,ho),bu=Ct.icon.placedSymbolArray.length-1)}for(const o in Jt.horizontal){const p=Jt.horizontal[o];ic||(Pd=Os(p.text),wn?Nx=wv(p):ic=C_(Vn,Pc,Bt,Fn,nr,pr,p,mr,On.layout.get("text-rotate").evaluate(zr,{},Vi),lr));const b=p.positionedLines.length===1;if(ry+=g1(Ct,bt,Bt,p,Rn,On,wn,zr,lr,vl,Jt.vertical?_a.horizontal:_a.horizontalOnly,b?Object.keys(Jt.horizontal):[o],Cs,oy,ji,ki,Vi,Fo),b)break}Jt.vertical&&(iy+=g1(Ct,bt,Bt,Jt.vertical,Rn,On,wn,zr,lr,vl,_a.vertical,["vertical"],Cs,bu,ji,ki,Vi,Fo));let Lc=-1;const qv=(o,p)=>o?Math.max(o,p):p;Lc=qv(Nx,Lc),Lc=qv(zx,Lc),Lc=qv(Px,Lc);const n=Lc>-1?1:0;Ct.glyphOffsetArray.length>=65535&&xe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),zr.sortKey!==void 0&&Ct.addToSortKeyRanges(Ct.symbolInstances.length,zr.sortKey),Ct.symbolInstances.emplaceBack(Bt.x,Bt.y,Pc.x,Pc.y,Pc.z,Cs.right>=0?Cs.right:-1,Cs.center>=0?Cs.center:-1,Cs.left>=0?Cs.left:-1,Cs.vertical>=0?Cs.vertical:-1,oy,bu,Pd,ic!==void 0?ic:Ct.collisionBoxArray.length,ic!==void 0?ic+1:Ct.collisionBoxArray.length,zd!==void 0?zd:Ct.collisionBoxArray.length,zd!==void 0?zd+1:Ct.collisionBoxArray.length,Nd!==void 0?Nd:Ct.collisionBoxArray.length,Nd!==void 0?Nd+1:Ct.collisionBoxArray.length,of||Ct.collisionBoxArray.length,of?of+1:Ct.collisionBoxArray.length,Fn,ry,iy,Lx,Bx,n,0,wu,Fx,Lc,0,kp?1:0,rf)})(s,vt,tn,Je,r,l,c,u,s.layers[0],s.collisionBoxArray,e.index,e.sourceLayerIndex,s.index,Ee,G,C,0,_e,Le,U,e,f,_,E,M,D,I,B,Ke)};if(H==="line")for(const Je of q0(e.geometry,0,0,zt,zt)){const vt=hS(Je,ue,De,r.vertical||J,l,me,ce,s.overscaling,zt);for(const _t of vt)J&&Z0(s,J.text,Ne,_t)||Ze(Je,_t,M)}else if(H==="line-center"){for(const Je of e.geometry)if(Je.length>1){const vt=dS(Je,De,r.vertical||J,l,me,ce);vt&&Ze(Je,vt,M)}}else if(e.type==="Polygon")for(const Je of a_(e.geometry,0)){const vt=E_(Je,16);Ze(Je[0],new mu(vt.x,vt.y,0,0,void 0),M)}else if(e.type==="LineString")for(const Je of e.geometry)Ze(Je,new mu(Je[0].x,Je[0].y,0,0,void 0),M);else if(e.type==="Point")for(const Je of e.geometry)for(const vt of Je)Ze([vt],new mu(vt.x,vt.y,0,0,void 0),M)}const eg=255,kh=eg*Mc;function g1(s,e,r,l,u,c,f,x,S,C,_,E,M,A,D,I,B,U){const G=function(Y,J,ne,me,ce,ue,Ee,_e){const De=[];if(J.positionedLines.length===0)return De;const Le=me.layout.get("text-rotate").evaluate(ue,{})*Math.PI/180,Ne=function(Je){const vt=Je[0],_t=Je[1],tn=vt*_t;return tn>0?[vt,-_t]:tn<0?[-vt,_t]:vt===0?[_t,vt]:[_t,-vt]}(ne);let Ge=Math.abs(J.top-J.bottom);for(const Je of J.positionedLines)Ge-=Je.lineOffset;const Ve=J.positionedLines.length,Ke=Ge/Ve;let Ze=J.top-ne[1];for(let Je=0;Je<Ve;++Je){const vt=J.positionedLines[Je];Ze=fS(J,Ke,Ze,Je);for(const _t of vt.positionedGlyphs){if(!_t.rect)continue;const tn=_t.rect||{};let Ct=b_+1,Bt=!0,bt=1,xn=0;if(_t.image){const zr=Ee.get(_t.image.toString());if(!zr)continue;if(zr.sdf){xe("SDF images are not supported in formatted text and will be ignored.");continue}Bt=!1,bt=zr.pixelRatio,Ct=Km/bt}const Jt=(ce||_e)&&_t.vertical,an=_t.metrics.advance*_t.scale/2,Rn=_t.metrics,qn=_t.rect;if(qn===null)continue;_e&&J.verticalizable&&(xn=_t.image?an-_t.metrics.width*_t.scale/2:0);const On=ce?[_t.x+an,_t.y]:[0,0];let Vn=[0,0],Fn=[0,0],nr=!1;ce||(Jt?(Fn=[_t.x+an+Ne[0],_t.y+Ne[1]-xn],nr=!0):Vn=[_t.x+an+ne[0],_t.y+ne[1]-xn]);const pr=qn.w*_t.scale/(bt*(_t.localGlyph?kc:1)),mr=qn.h*_t.scale/(bt*(_t.localGlyph?kc:1));let wn,lr,Ir,Kr;if(Jt){const zr=_t.y-Ze,ji=new qt(-an,an-zr),so=-Math.PI/2,ki=new qt(...Fn);wn=new qt(-an+Vn[0],Vn[1]),wn._rotateAround(so,ji)._add(ki),wn.x+=-zr+an,wn.y-=(Rn.left-Ct)*_t.scale;const Vi=_t.image?Rn.advance*_t.scale:$i*_t.scale,Fo=String.fromCodePoint(_t.glyph);lS(Fo)?wn.x+=(1-Ct)*_t.scale:v_(Fo)?wn.x+=Vi-Rn.height*_t.scale+(-Ct-1)*_t.scale:wn.x+=_t.image||Rn.width+2*Ct===qn.w&&Rn.height+2*Ct===qn.h?(Vi-mr)/2:(Vi-(Rn.height+2*Ct)*_t.scale)/2,lr=new qt(wn.x,wn.y-pr),Ir=new qt(wn.x+mr,wn.y),Kr=new qt(wn.x+mr,wn.y-pr)}else{const zr=(Rn.left-Ct)*_t.scale-an+Vn[0],ji=(-Rn.top-Ct)*_t.scale+Vn[1],so=zr+pr,ki=ji+mr;wn=new qt(zr,ji),lr=new qt(so,ji),Ir=new qt(zr,ki),Kr=new qt(so,ki)}if(Le){let zr;zr=ce?new qt(0,0):nr?new qt(Ne[0],Ne[1]):new qt(ne[0],ne[1]),wn._rotateAround(Le,zr),lr._rotateAround(Le,zr),Ir._rotateAround(Le,zr),Kr._rotateAround(Le,zr)}const di=new qt(0,0),hi=new qt(0,0);De.push({tl:wn,tr:lr,bl:Ir,br:Kr,texPrimary:tn,texSecondary:void 0,writingMode:J.writingMode,glyphOffset:On,sectionIndex:_t.sectionIndex,isSDF:Bt,pixelOffsetTL:di,pixelOffsetBR:hi,minFontScaleX:0,minFontScaleY:0})}}return De}(0,l,S,c,f,x,u,s.allowVerticalPlacement),H=s.textSizeData;let q=null;H.kind==="source"?(q=[Mc*c.layout.get("text-size").evaluate(x,{},B)*D.textScaleFactor],q[0]>kh&&xe(`${s.layerIds[0]}: Value for "text-size" is >= ${eg}. Reduce your "text-size".`)):H.kind==="composite"&&(q=[Mc*D.compositeTextSizes[0].evaluate(x,{},B)*D.textScaleFactor,Mc*D.compositeTextSizes[1].evaluate(x,{},B)*D.textScaleFactor],(q[0]>kh||q[1]>kh)&&xe(`${s.layerIds[0]}: Value for "text-size" is >= ${eg}. Reduce your "text-size".`)),s.addSymbols(s.text,G,q,S,f,x,_,e,r,C.lineStartIndex,C.lineLength,A,I,B,U,!1);for(const Y of E)M[Y]=s.text.placedSymbolArray.length-1;return 4*G.length}function $0(s){for(const e in s)return s[e];return null}function C_(s,e,r,l,u,c,f,x,S,C){let _=f.top,E=f.bottom,M=f.left,A=f.right;const D=f.collisionPadding;if(D&&(M-=D[0],_-=D[1],A+=D[2],E+=D[3]),S){const I=new qt(M,_),B=new qt(A,_),U=new qt(M,E),G=new qt(A,E),H=Jn(S);let q=new qt(0,0);C&&(q=new qt(C[0],C[1])),I._rotateAround(H,q),B._rotateAround(H,q),U._rotateAround(H,q),G._rotateAround(H,q),M=Math.min(I.x,B.x,U.x,G.x),A=Math.max(I.x,B.x,U.x,G.x),_=Math.min(I.y,B.y,U.y,G.y),E=Math.max(I.y,B.y,U.y,G.y)}return s.emplaceBack(e.x,e.y,e.z,r.x,r.y,M,_,A,E,x,l,u,c),s.length-1}function wv(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const e=s.bottom-s.top;return e>0?Math.max(10,e):null}function Z0(s,e,r,l){const u=s.compareText;if(e in u){const c=u[e];for(let f=c.length-1;f>=0;f--)if(l.dist(c[f])<r)return!0}else u[e]=[];return u[e].push(l),!1}function Sv(s,e){const r=s.fovAboveCenter,l=s.elevation?s.elevation.getMinElevationBelowMSL()*e:0,u=(s._camera.position[2]*s.worldSize-l)/Math.cos(s._pitch),c=Math.sin(r)*u/Math.sin(Math.max(Math.PI/2-s._pitch-r,.01));let f=Math.sin(s._pitch)*c+u;const x=u*(1/s._horizonShift);if(!s.elevation||s.elevation.exaggeration()===0){let S=Math.max(s.zoom-17,0);s.isOrthographic&&(S/=10),f*=1+S}return Math.min(1.01*f,x)}function up(s,e){if(!e.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:e};const r=Math.pow(2,-s.z),l=s.x*r,u=(s.x+1)*r,c=s.y*r,f=(s.y+1)*r,x=vs(l),S=vs(u),C=Sr(c),_=Sr(f),E=e.project(x,C),M=e.project(S,C),A=e.project(S,_),D=e.project(x,_);let I=Math.min(E.x,M.x,A.x,D.x),B=Math.min(E.y,M.y,A.y,D.y),U=Math.max(E.x,M.x,A.x,D.x),G=Math.max(E.y,M.y,A.y,D.y);const H=r/16;function q(J,ne,me,ce,ue,Ee){const _e=(me+ue)/2,De=(ce+Ee)/2,Le=e.project(vs(_e),Sr(De)),Ne=Math.max(0,I-Le.x,B-Le.y,Le.x-U,Le.y-G);I=Math.min(I,Le.x),U=Math.max(U,Le.x),B=Math.min(B,Le.y),G=Math.max(G,Le.y),Ne>H&&(q(J,Le,me,ce,_e,De),q(Le,ne,_e,De,ue,Ee))}q(E,M,l,c,u,c),q(M,A,u,c,u,f),q(A,D,u,f,l,f),q(D,E,l,f,l,c),I-=H,B-=H,U+=H,G+=H;const Y=1/Math.max(U-I,G-B);return{scale:Y,x:I*Y,y:B*Y,x2:U*Y,y2:G*Y,projection:e}}function Oh(s,{x:e,y:r},l=0){return new qt(((e-l)*s.scale-s.x)*zt,(r*s.scale-s.y)*zt)}const Zl=de.mat4.identity(new Float32Array(16));class pl{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new hr(0,0)}projectTilePoint(e,r,l){return{x:e,y:r,z:0}}locationPoint(e,r,l,u=!0){return e._coordinatePoint(e.locationCoordinate(r,l),u)}pixelsPerMeter(e,r){return bo(1,e)*r}pixelSpaceConversion(e,r,l){return 1}farthestPixelDistance(e){return Sv(e,e.pixelsPerMeter)}pointCoordinate(e,r,l,u){const c=e.horizonLineFromTop(!1),f=new qt(r,Math.max(c,l));return e.rayIntersectionCoordinate(e.pointRayIntersection(f,u))}pointCoordinate3D(e,r,l){const u=new qt(r,l);if(e.elevation)return e.elevation.pointCoordinate(u);{const c=this.pointCoordinate(e,u.x,u.y,0);return[c.x,c.y,c.z]}}isPointAboveHorizon(e,r){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,r.x,r.y);const l=e.horizonLineFromTop();return r.y<l}createInversionMatrix(e,r){return Zl}createTileMatrix(e,r,l){let u,c,f;const x=l.canonical,S=de.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const C=up(x,this);u=1,c=C.x+l.wrap*C.scale,f=C.y,de.mat4.scale(S,S,[u/C.scale,u/C.scale,e.pixelsPerMeter/r])}else u=r/e.zoomScale(x.z),c=(x.x+Math.pow(2,x.z)*l.wrap)*u,f=x.y*u;return de.mat4.translate(S,S,[c,f,0]),de.mat4.scale(S,S,[u/zt,u/zt,1]),S}upVector(e,r,l){return[0,0,1]}upVectorScale(e,r,l){return{metersToTile:1}}}class Y0 extends pl{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[r,l]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(Jn(r));this.n=(u+Math.sin(Jn(l)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,r){const{n:l,c:u,r0:c}=this,f=Jn(e-this.center[0]),x=Jn(r),S=Math.sqrt(u-2*l*Math.sin(x))/l;return{x:S*Math.sin(f*l),y:S*Math.cos(f*l)-c,z:0}}unproject(e,r){const{n:l,c:u,r0:c}=this,f=c+r;let x=Math.atan2(e,Math.abs(f))*Math.sign(f);f*l<0&&(x-=Math.PI*Math.sign(e)*Math.sign(f));const S=Jn(this.center[0])*l;x=Fa(x,-Math.PI-S,Math.PI-S);const C=$n(Wi(x/l)+this.center[0],-180,180),_=Math.asin($n((u-(e*e+f*f)*l*l)/(2*l),-1,1)),E=$n(Wi(_),-85.051129,xs);return new hr(C,E)}}const Yl=1.340264,Zs=-.081106,gu=893e-6,Mi=.003796,Tv=Math.sqrt(3)/2;class ws extends pl{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;const l=Math.asin(Tv*Math.sin(r)),u=l*l,c=u*u*u;return{x:.5*(e*Math.cos(l)/(Tv*(Yl+3*Zs*u+c*(7*gu+9*Mi*u)))/Math.PI+.5),y:1-.5*(l*(Yl+Zs*u+c*(gu+Mi*u))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let l=r=(2*(1-r)-1)*Math.PI,u=l*l,c=u*u*u;for(let _,E,M,A=0;A<12&&(E=l*(Yl+Zs*u+c*(gu+Mi*u))-r,M=Yl+3*Zs*u+c*(7*gu+9*Mi*u),_=E/M,l=$n(l-_,-Math.PI/3,Math.PI/3),u=l*l,c=u*u*u,!(Math.abs(_)<1e-12));++A);const f=Tv*e*(Yl+3*Zs*u+c*(7*gu+9*Mi*u))/Math.cos(l),x=Math.asin(Math.sin(l)/Tv),S=$n(180*f/Math.PI,-180,180),C=$n(180*x/Math.PI,-85.051129,xs);return new hr(S,C)}}class Ys extends pl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){const l=360*(e-.5),u=$n(360*(.5-r),-85.051129,xs);return new hr(l,u)}}const Ws=Math.PI/2;function D_(s){return Math.tan((Ws+s)/2)}class _1 extends pl{constructor(e){super(e),this.center=e.center||[0,30];const[r,l]=this.parallels=e.parallels||[30,30];let u=Jn(r),c=Jn(l);this.southernCenter=u+c<0,this.southernCenter&&(u=-u,c=-c);const f=Math.cos(u),x=D_(u);this.n=u===c?Math.sin(u):Math.log(f/Math.cos(c))/Math.log(D_(c)/x),this.f=f*Math.pow(D_(u),this.n)/this.n}project(e,r){r=Jn(r),this.southernCenter&&(r=-r),e=Jn(e-this.center[0]);const l=1e-6,{n:u,f:c}=this;c>0?r<-Ws+l&&(r=-Ws+l):r>Ws-l&&(r=Ws-l);const f=c/Math.pow(D_(r),u);let x=f*Math.sin(u*e),S=c-f*Math.cos(u*e);return x=.5*(x/Math.PI+.5),S=.5*(S/Math.PI+.5),{x,y:this.southernCenter?S:1-S,z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:l,f:u}=this,c=u-r,f=Math.sign(c),x=Math.sign(l)*Math.sqrt(e*e+c*c);let S=Math.atan2(e,Math.abs(c))*f;c*l<0&&(S-=Math.PI*Math.sign(e)*f);const C=$n(Wi(S/l)+this.center[0],-180,180),_=$n(Wi(2*Math.atan(Math.pow(u/x,1/l))-Ws),-85.051129,xs);return new hr(C,this.southernCenter?-_:_)}}class W0 extends pl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:ll(e),y:Ki(r),z:0}}unproject(e,r){const l=vs(e),u=Sr(r);return new hr(l,u)}}const dp=Jn(xs);class tg extends pl{project(e,r){const l=(r=Jn(r))*r,u=l*l;return{x:.5*((e=Jn(e))*(.8707-.131979*l+u*(u*(.003971*l-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+l*(.015085+u*(.028874*l-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let l=r=(2*(1-r)-1)*Math.PI,u=25,c=0,f=l*l;do{f=l*l;const C=f*f;c=(l*(1.007226+f*(.015085+C*(.028874*f-.044475-.005916*C)))-r)/(1.007226+f*(.045255+C*(.259866*f-.311325-.005916*11*C))),l=$n(l-c,-dp,dp)}while(Math.abs(c)>1e-6&&--u>0);f=l*l;const x=$n(Wi(e/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),S=Wi(l);return new hr(x,S)}}const M_=Jn(xs);class Ev extends pl{project(e,r){r=Jn(r),e=Jn(e);const l=Math.cos(r),u=2/Math.PI,c=Math.acos(l*Math.cos(e/2)),f=Math.sin(c)/c,x=.5*(e*u+2*l*Math.sin(e/2)/f)||0,S=.5*(r+Math.sin(r)/f)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(S/Math.PI+1),z:0}}unproject(e,r){let l=e=(2*e-.5)*Math.PI,u=r=(2*(1-r)-1)*Math.PI,c=25;const f=1e-6;let x=0,S=0;do{const C=Math.cos(u),_=Math.sin(u),E=2*_*C,M=_*_,A=C*C,D=Math.cos(l/2),I=Math.sin(l/2),B=2*D*I,U=I*I,G=1-A*D*D,H=G?1/G:0,q=G?Math.acos(C*D)*Math.sqrt(1/G):0,Y=.5*(2*q*C*I+2*l/Math.PI)-e,J=.5*(q*_+u)-r,ne=.5*H*(A*U+q*C*D*M)+1/Math.PI,me=H*(B*E/4-q*_*I),ce=.125*H*(E*I-q*_*A*B),ue=.5*H*(M*D+q*U*C)+.5,Ee=me*ce-ue*ne;x=(J*me-Y*ue)/Ee,S=(Y*ce-J*ne)/Ee,l=$n(l-x,-Math.PI,Math.PI),u=$n(u-S,-M_,M_)}while((Math.abs(x)>f||Math.abs(S)>f)&&--c>0);return new hr(Wi(l),Wi(u))}}class ml extends pl{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Jn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){const{scale:l,cosPhi:u}=this;return{x:Jn(e)*u*l+.5,y:-Math.sin(Jn(r))/u*l+.5,z:0}}unproject(e,r){const{scale:l,cosPhi:u}=this,c=-(r-.5)/l,f=$n(Wi((e-.5)/l)/u,-180,180),x=Math.asin($n(c*u,-1,1)),S=$n(Wi(x),-85.051129,xs);return new hr(f,S)}}class Wl extends W0{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,r,l){const u=xr(e,r,l),c=ii(Ji(l));return de.vec3.transformMat4(u,u,c),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,r,l){const u=Ma(r.lat,r.lng),c=de.vec3.normalize([],u),f=l?e._centerAltitude+l:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude,x=bo(1,0)*zt*f;de.vec3.scaleAndAdd(u,u,c,x);const S=de.mat4.identity(new Float64Array(16));return de.mat4.multiply(S,e.pixelMatrix,e.globeMatrix),de.vec3.transformMat4(u,u,S),new qt(u[0],u[1])}pixelsPerMeter(e,r){return bo(1,0)*r}pixelSpaceConversion(e,r,l){const u=bo(1,e)*r,c=En(bo(1,45)*r,u,l);return this.pixelsPerMeter(e,r)/c}createTileMatrix(e,r,l){const u=eo(Ji(l.canonical));return de.mat4.multiply(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,r){const{center:l}=e,u=ii(Ji(r));return de.mat4.rotateY(u,u,Jn(l.lng)),de.mat4.rotateX(u,u,Jn(l.lat)),de.mat4.scale(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,r,l,u){return vr(e,r,l,!0)||new t(0,0)}pointCoordinate3D(e,r,l){const u=this.pointCoordinate(e,r,l,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,r){return!vr(e,r.x,r.y,!1)}farthestPixelDistance(e){const r=function(u,c){const f=u.cameraToCenterDistance,x=u._centerAltitude*c,S=u._camera,C=u._camera.forward(),_=de.vec3.add([],de.vec3.scale([],C,-f),[0,0,x]),E=u.worldSize/(2*Math.PI),M=[0,0,-E],A=u.width/u.height,D=Math.tan(u.fovAboveCenter),I=de.vec3.scale([],S.up(),D),B=de.vec3.scale([],S.right(),D*A),U=de.vec3.normalize([],de.vec3.add([],de.vec3.add([],C,I),B)),G=[];let H;if(new Mn(_,U).closestPointOnSphere(M,E,G)){const q=de.vec3.add([],G,M),Y=de.vec3.sub([],q,_);H=Math.cos(u.fovAboveCenter)*de.vec3.length(Y)}else{const q=de.vec3.sub([],_,M),Y=de.vec3.sub([],M,_);de.vec3.normalize(Y,Y);const J=de.vec3.length(q)-E;H=Math.sqrt(J*(J+2*E));const ne=Math.acos(H/(E+J))-Math.acos(de.vec3.dot(C,Y));H*=Math.cos(ne)}return 1.01*H}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),l=Yo(e.zoom);if(l>0){const u=Sv(e,bo(1,e.center.lat)*e.worldSize),c=e.worldSize/(2*Math.PI),f=Math.max(e.width,e.height)/e.worldSize*Math.PI;return En(r,u+c*(1-Math.cos(f)),Math.pow(l,10))}return r}upVector(e,r,l){return xr(r,l,e,1)}upVectorScale(e){return{metersToTile:ar($r(Ji(e)))}}}function Ih(s){const e=s.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(s.name){case"mercator":return new W0(s);case"equirectangular":return new Ys(s);case"naturalEarth":return new tg(s);case"equalEarth":return new ws(s);case"winkelTripel":return new Ev(s);case"albers":return r?new ml(s):new Y0(s);case"lambertConformalConic":return r?new ml(s):new _1(s);case"globe":return new Wl(s)}throw new Error(`Invalid projection name: ${s.name}`)}const xd=ul.VectorTileFeature.types,bd=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function rs(s,e,r,l,u,c,f,x,S,C,_,E,M){const A=x?Math.min(kh,Math.round(x[0])):0,D=x?Math.min(kh,Math.round(x[1])):0;s.emplaceBack(e,r,Math.round(32*l),Math.round(32*u),c,f,(A<<1)+(S?1:0),D,16*C,16*_,256*E,256*M)}function Zi(s,e,r){s.emplaceBack(e,r)}function Jr(s,e,r,l,u,c,f){s.emplaceBack(e,r,l,u,c,f)}function Xl(s,e,r,l,u){s.emplaceBack(e,r,l,u),s.emplaceBack(e,r,l,u),s.emplaceBack(e,r,l,u),s.emplaceBack(e,r,l,u)}function Kl(s){for(const e of s.sections)if(mm(e.text))return!0;return!1}class wd{constructor(e){this.layoutVertexArray=new Tm,this.indexArray=new xo,this.programConfigurations=e,this.segments=new ri,this.dynamicLayoutVertexArray=new ru,this.opacityVertexArray=new zf,this.placedSymbolArray=new Zg,this.iconTransitioningVertexArray=new Aa,this.globeExtVertexArray=new Ea,this.zOffsetVertexArray=new ud}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,r,l,u,c){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,U0.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Zb.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,bd,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,uv.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,$b.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||c)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Yb.members,!0)),this.opacityVertexBuffer.itemSize=1),(l||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}nn(wd,"SymbolBuffers");class Jl{constructor(e,r,l){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new l,this.segments=new ri,this.collisionVertexArray=new Em,this.collisionVertexArrayExt=new ru}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Wm.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,oS.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}nn(Jl,"CollisionBuffers");class ng{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=de.mat4.identity([]),this.placementViewportMatrix=de.mat4.identity([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=dv(this.zoom,r["text-size"]),this.iconSizeData=dv(this.zoom,r["icon-size"]);const l=this.layers[0].layout,u=l.get("symbol-sort-key"),c=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=c!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(c==="viewport-y"||c==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(f=>_a[f]),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new wd(new ys(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new wd(new ys(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new Wg,this.lineVertexArray=new gh,this.symbolInstances=new Ll}calculateGlyphDependencies(e,r,l,u,c){for(const f of e){const x=f.codePointAt(0);if(x===void 0)break;if(r[x]=!0,u&&c&&x<=65535){const S=y_[f];S&&(r[S.charCodeAt(0)]=!0)}}}updateFootprints(e,r){}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;const l=r.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!S0(this.activeReplacements,l)&&(this.activeReplacements=l,!0)}populate(e,r,l,u){const c=this.layers[0],f=c.layout,x=this.projection.name==="globe",S=f.get("text-font"),C=f.get("text-field"),_=f.get("icon-image"),[E,M]=f.get("icon-size-scale-range"),A=$n(r.scaleFactor||1,E,M),D=(C.value.kind!=="constant"||C.value.value instanceof ko&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),I=_.value.kind!=="constant"||!!_.value.value||Object.keys(_.parameters).length>0,B=f.get("symbol-sort-key");if(this.features=[],!D&&!I)return;const U=r.iconDependencies,G=r.glyphDependencies,H=r.availableImages,q=new Hr(this.zoom);for(const{feature:Y,id:J,index:ne,sourceLayerIndex:me}of e){const ce=c._featureFilter.needGeometry,ue=F(Y,ce);if(!c._featureFilter.filter(q,ue,l))continue;if(ce||(ue.geometry=P(Y,l,u)),x&&Y.type!==1&&l.z<=5){const Ne=ue.geometry,Ge=.98078528056,Ve=(Ke,Ze)=>{const Je=xr(Ke.x,Ke.y,l,1),vt=xr(Ze.x,Ze.y,l,1);return de.vec3.dot(Je,vt)<Ge};for(let Ke=0;Ke<Ne.length;Ke++)Ne[Ke]=v(Ne[Ke],Ve)}let Ee,_e;if(D){const Ne=c.getValueAndResolveTokens("text-field",ue,l,H),Ge=ko.factory(Ne);Kl(Ge)&&(this.hasRTLText=!0),(!this.hasRTLText||nd()==="unavailable"||this.hasRTLText&&vo.isParsed())&&(Ee=aS(Ge,c,ue))}if(I){const Ne=c.getValueAndResolveTokens("icon-image",ue,l,H);_e=Ne instanceof Oo?Ne:Oo.build(Ne)}if(!Ee&&!_e)continue;const De=this.sortFeaturesByKey?B.evaluate(ue,{},l):void 0,Le={id:J,text:Ee,icon:_e,index:ne,sourceLayerIndex:me,geometry:ue.geometry,properties:Y.properties,type:xd[Y.type],sortKey:De};if(this.features.push(Le),_e){const Ne=this.layers[0]._unevaluatedLayout._values,{iconPrimary:Ge,iconSecondary:Ve}=Jm(_e,this.iconSizeData,Ne["icon-size"],l,this.zoom,Le,this.pixelRatio,A),Ke=Ge.id.toString();if(U.has(Ke)?U.get(Ke).push(Ge):U.set(Ke,[Ge]),Ve){const Ze=Ve.id.toString();U.has(Ze)?U.get(Ze).push(Ve):U.set(Ze,[Ve])}}if(Ee){const Ne=S.evaluate(ue,{},l).join(","),Ge=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(_a.vertical)>=0;for(const Ve of Ee.sections)if(Ve.image){const Ke=Ve.image.getPrimary().scaleSelf(this.pixelRatio),Ze=Ke.id.toString(),Je=U.get(Ze)||[];Je.push(Ke),U.set(Ze,Je)}else{const Ke=fm(Ee.toString()),Ze=Ve.fontStack||Ne,Je=G[Ze]=G[Ze]||{};this.calculateGlyphDependencies(Ve.text,Je,Ge,this.allowVerticalPlacement,Ke)}}}if(f.get("symbol-placement")==="line"&&(this.features=function(Y){const J={},ne={},me=[];let ce=0;function ue(Le){me.push(Y[Le]),ce++}function Ee(Le,Ne,Ge){const Ve=ne[Le];return delete ne[Le],ne[Ne]=Ve,me[Ve].geometry[0].pop(),me[Ve].geometry[0]=me[Ve].geometry[0].concat(Ge[0]),Ve}function _e(Le,Ne,Ge){const Ve=J[Ne];return delete J[Ne],J[Le]=Ve,me[Ve].geometry[0].shift(),me[Ve].geometry[0]=Ge[0].concat(me[Ve].geometry[0]),Ve}function De(Le,Ne,Ge){const Ve=Ge?Ne[0][Ne[0].length-1]:Ne[0][0];return`${Le}:${Ve.x}:${Ve.y}`}for(let Le=0;Le<Y.length;Le++){const Ne=Y[Le],Ge=Ne.geometry,Ve=Ne.text?Ne.text.toString():null;if(!Ve){ue(Le);continue}const Ke=De(Ve,Ge),Ze=De(Ve,Ge,!0);if(Ke in ne&&Ze in J&&ne[Ke]!==J[Ze]){const Je=_e(Ke,Ze,Ge),vt=Ee(Ke,Ze,me[Je].geometry);delete J[Ke],delete ne[Ze],ne[De(Ve,me[vt].geometry,!0)]=vt,me[Je].geometry=null}else Ke in ne?Ee(Ke,Ze,Ge):Ze in J?_e(Ke,Ze,Ge):(ue(Le),J[Ke]=ce-1,ne[Ze]=ce-1)}return me.filter(Le=>Le.geometry)}(this.features)),f.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",r.elevationFeatures){!this.elevationFeatures&&r.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Y of r.elevationFeatures)this.elevationFeatureIdToIndex.set(Y.id,this.elevationFeatures.length),this.elevationFeatures.push(Y)}}else f.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Y,J)=>Y.sortKey-J.sortKey)}update(e,r,l,u,c,f,x){this.text.programConfigurations.updatePaintArrays(e,r,c,l,u,f,x),this.icon.programConfigurations.updatePaintArrays(e,r,c,l,u,f,x)}updateRoadElevation(){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let e=!1;for(let r=0;r<this.symbolInstances.length;r++){const l=this.symbolInstances.get(r);if(l.elevationFeatureIndex===65535)continue;const u=this.elevationFeatures[l.elevationFeatureIndex];if(u){const c=.05+u.pointElevation(new qt(l.tileAnchorX,l.tileAnchorY));l.zOffset!==c&&(e=!0,l.zOffset=c)}}e&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(c,f,x)=>{l+=f,l>c.length&&c.resize(l);for(let S=-f;S<0;S++)c.emplace(S+l,x)},r=(c,f,x)=>{u+=f,u>c.length&&c.resize(u);for(let S=-f;S<0;S++)c.emplace(S+u,x)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let l=0,u=0;for(let c=0;c<this.symbolInstances.length;c++){const f=this.symbolInstances.get(c),{numHorizontalGlyphVertices:x,numVerticalGlyphVertices:S,numIconVertices:C}=f,_=f.zOffset,E=C>0;if((x>0||S>0)&&(e(this.text.zOffsetVertexArray,x,_),e(this.text.zOffsetVertexArray,S,_)),E){const{placedIconSymbolIndex:M,verticalPlacedIconSymbolIndex:A}=f;M>=0&&r(this.icon.zOffsetVertexArray,C,_),A>=0&&r(this.icon.zOffsetVertexArray,f.numVerticalIconVertices,_)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Ih(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const l=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:u,y:c}of r)this.lineVertexArray.emplaceBack(u,c);return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,r,l,u,c,f,x,S,C,_,E,M,A,D,I,B){const U=e.indexArray,G=e.layoutVertexArray,H=e.globeExtVertexArray,q=e.segments.prepareSegment(4*r.length,G,U,this.canOverlap?f.sortKey:void 0),Y=this.glyphOffsetArray.length,J=q.vertexLength,ne=this.allowVerticalPlacement&&x===_a.vertical?Math.PI/2:0,me=f.text&&f.text.sections;for(let ue=0;ue<r.length;ue++){const{tl:Ee,tr:_e,bl:De,br:Le,texPrimary:Ne,texSecondary:Ge,pixelOffsetTL:Ve,pixelOffsetBR:Ke,minFontScaleX:Ze,minFontScaleY:Je,glyphOffset:vt,isSDF:_t,sectionIndex:tn}=r[ue],Ct=q.vertexLength,Bt=vt[1];if(rs(G,C.x,C.y,Ee.x,Bt+Ee.y,Ne.x,Ne.y,l,_t,Ve.x,Ve.y,Ze,Je),rs(G,C.x,C.y,_e.x,Bt+_e.y,Ne.x+Ne.w,Ne.y,l,_t,Ke.x,Ve.y,Ze,Je),rs(G,C.x,C.y,De.x,Bt+De.y,Ne.x,Ne.y+Ne.h,l,_t,Ve.x,Ke.y,Ze,Je),rs(G,C.x,C.y,Le.x,Bt+Le.y,Ne.x+Ne.w,Ne.y+Ne.h,l,_t,Ke.x,Ke.y,Ze,Je),S){const{x:bt,y:xn,z:Jt}=S.anchor,[an,Rn,qn]=S.up;Jr(H,bt,xn,Jt,an,Rn,qn),Jr(H,bt,xn,Jt,an,Rn,qn),Jr(H,bt,xn,Jt,an,Rn,qn),Jr(H,bt,xn,Jt,an,Rn,qn),Xl(e.dynamicLayoutVertexArray,bt,xn,Jt,ne)}else Xl(e.dynamicLayoutVertexArray,C.x,C.y,C.z,ne);if(B){const bt=Ge||Ne;Zi(e.iconTransitioningVertexArray,bt.x,bt.y),Zi(e.iconTransitioningVertexArray,bt.x+bt.w,bt.y),Zi(e.iconTransitioningVertexArray,bt.x,bt.y+bt.h),Zi(e.iconTransitioningVertexArray,bt.x+bt.w,bt.y+bt.h)}U.emplaceBack(Ct,Ct+1,Ct+2),U.emplaceBack(Ct+1,Ct+2,Ct+3),q.vertexLength+=4,q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(vt[0]),ue!==r.length-1&&tn===r[ue+1].sectionIndex||e.programConfigurations.populatePaintArrays(G.length,f,f.index,{},A,D,I,me&&me[tn])}const ce=S?S.anchor:C;e.placedSymbolArray.emplaceBack(ce.x,ce.y,ce.z,C.x,C.y,Y,this.glyphOffsetArray.length-Y,J,_,E,C.segment,l?l[0]:0,l?l[1]:0,u[0],u[1],x,0,!1,0,M,0)}_commitLayoutVertex(e,r,l,u,c,f,x){e.emplaceBack(r,l,u,c,f,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(e,r,l,u,c,f,x){const S=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),C=S.vertexLength,_=x.tileAnchorX,E=x.tileAnchorY;for(let A=0;A<4;A++)l.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(l.collisionVertexArrayExt,r,e.padding,x.zOffset),this._commitLayoutVertex(l.layoutVertexArray,u,c,f,_,E,new qt(e.x1,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,u,c,f,_,E,new qt(e.x2,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,u,c,f,_,E,new qt(e.x2,e.y2)),this._commitLayoutVertex(l.layoutVertexArray,u,c,f,_,E,new qt(e.x1,e.y2)),S.vertexLength+=4;const M=l.indexArray;M.emplaceBack(C,C+1),M.emplaceBack(C+1,C+2),M.emplaceBack(C+2,C+3),M.emplaceBack(C+3,C),S.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,l,u,c,f){for(let x=u;x<c;x++){const S=l.get(x),C=this.getSymbolInstanceTextSize(e,f,r,x);this._addCollisionDebugVertices(S,C,this.textCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,f)}}_addIconDebugCollisionBoxes(e,r,l,u,c,f){for(let x=u;x<c;x++){const S=l.get(x),C=this.getSymbolInstanceIconSize(e,r,f.placedIconSymbolIndex);this._addCollisionDebugVertices(S,C,this.iconCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,f)}}generateCollisionDebugBuffers(e,r,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Jl(lh,__.members,Aa),this.iconCollisionBox=new Jl(lh,__.members,Aa);const u=np(this.iconSizeData,e),c=np(this.textSizeData,e,l);for(let f=0;f<this.symbolInstances.length;f++){const x=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(c,e,r,x.textBoxStartIndex,x.textBoxEndIndex,x),this._addTextDebugCollisionBoxes(c,e,r,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._addIconDebugCollisionBoxes(u,e,r,x.iconBoxStartIndex,x.iconBoxEndIndex,x),this._addIconDebugCollisionBoxes(u,e,r,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x)}}getSymbolInstanceTextSize(e,r,l,u){const c=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:u),f=ns(this.textSizeData,e,c)/$i;return this.tilePixelRatio*f}getSymbolInstanceIconSize(e,r,l){const u=this.icon.placedSymbolArray.get(l),c=ns(this.iconSizeData,e,u);return this.tilePixelRatio*c}_commitDebugCollisionVertexUpdate(e,r,l,u){e.emplaceBack(r,-l,-l,u),e.emplaceBack(r,l,-l,u),e.emplaceBack(r,l,l,u),e.emplaceBack(r,-l,l,u)}_updateTextDebugCollisionBoxes(e,r,l,u,c,f,x){for(let S=u;S<c;S++){const C=l.get(S),_=this.getSymbolInstanceTextSize(e,f,r,S);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,_,C.padding,f.zOffset)}}_updateIconDebugCollisionBoxes(e,r,l,u,c,f,x){for(let S=u;S<c;S++){const C=l.get(S),_=this.getSymbolInstanceIconSize(e,r,f.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,_,C.padding,f.zOffset)}}updateCollisionDebugBuffers(e,r,l,u){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=np(this.iconSizeData,e,u),f=np(this.textSizeData,e,l);for(let x=0;x<this.symbolInstances.length;x++){const S=this.symbolInstances.get(x);this._updateTextDebugCollisionBoxes(f,e,r,S.textBoxStartIndex,S.textBoxEndIndex,S,l),this._updateTextDebugCollisionBoxes(f,e,r,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S,l),this._updateIconDebugCollisionBoxes(c,e,r,S.iconBoxStartIndex,S.iconBoxEndIndex,S,u),this._updateIconDebugCollisionBoxes(c,e,r,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S,u)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,l,u,c,f,x,S,C){const _={};if(r<l){const{x1:E,y1:M,x2:A,y2:D,padding:I,projectedAnchorX:B,projectedAnchorY:U,projectedAnchorZ:G,tileAnchorX:H,tileAnchorY:q,featureIndex:Y}=e.get(r);_.textBox={x1:E,y1:M,x2:A,y2:D,padding:I,projectedAnchorX:B,projectedAnchorY:U,projectedAnchorZ:G,tileAnchorX:H,tileAnchorY:q},_.textFeatureIndex=Y}if(u<c){const{x1:E,y1:M,x2:A,y2:D,padding:I,projectedAnchorX:B,projectedAnchorY:U,projectedAnchorZ:G,tileAnchorX:H,tileAnchorY:q,featureIndex:Y}=e.get(u);_.verticalTextBox={x1:E,y1:M,x2:A,y2:D,padding:I,projectedAnchorX:B,projectedAnchorY:U,projectedAnchorZ:G,tileAnchorX:H,tileAnchorY:q},_.verticalTextFeatureIndex=Y}if(f<x){const{x1:E,y1:M,x2:A,y2:D,padding:I,projectedAnchorX:B,projectedAnchorY:U,projectedAnchorZ:G,tileAnchorX:H,tileAnchorY:q,featureIndex:Y}=e.get(f);_.iconBox={x1:E,y1:M,x2:A,y2:D,padding:I,projectedAnchorX:B,projectedAnchorY:U,projectedAnchorZ:G,tileAnchorX:H,tileAnchorY:q},_.iconFeatureIndex=Y}if(S<C){const{x1:E,y1:M,x2:A,y2:D,padding:I,projectedAnchorX:B,projectedAnchorY:U,projectedAnchorZ:G,tileAnchorX:H,tileAnchorY:q,featureIndex:Y}=e.get(S);_.verticalIconBox={x1:E,y1:M,x2:A,y2:D,padding:I,projectedAnchorX:B,projectedAnchorY:U,projectedAnchorZ:G,tileAnchorX:H,tileAnchorY:q},_.verticalIconFeatureIndex=Y}return _}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const l=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,r){const l=e.placedSymbolArray.get(r),u=l.vertexStartIndex+4*l.numGlyphs;for(let c=l.vertexStartIndex;c<u;c+=4)e.indexArray.emplaceBack(c,c+1,c+2),e.indexArray.emplaceBack(c+1,c+2,c+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),l=Math.cos(e),u=[],c=[],f=[];for(let x=0;x<this.symbolInstances.length;++x){f.push(x);const S=this.symbolInstances.get(x);u.push(0|Math.round(r*S.tileAnchorX+l*S.tileAnchorY)),c.push(S.featureIndex)}return f.sort((x,S)=>u[x]-u[S]||c[S]-c[x]),f}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,r)=>this.symbolInstances.get(r).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,r){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===r?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const l=this.symbolInstances.get(r);this.featureSortOrder.push(l.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:c,leftJustifiedTextSymbolIndex:f,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:S,verticalPlacedIconSymbolIndex:C}=l;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),c>=0&&c!==u&&this.addIndicesForPlacedSymbol(this.text,c),f>=0&&f!==c&&f!==u&&this.addIndicesForPlacedSymbol(this.text,f),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S),C>=0&&this.addIndicesForPlacedSymbol(this.icon,C)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let X0,y1,Av;nn(ng,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),ng.addDynamicAttributes=Xl;class v1{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Mu,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}nn(v1,"FormatSectionOverride",{omit:["defaultValue"]});const R_=()=>Av||(Av={layout:X0||(X0=new li({"symbol-placement":new Ot(Qe.layout_symbol["symbol-placement"]),"symbol-spacing":new Ot(Qe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ot(Qe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new en(Qe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ot(Qe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Ot(Qe.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Ot(Qe.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Ot(Qe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ot(Qe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ot(Qe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ot(Qe.layout_symbol["icon-rotation-alignment"]),"icon-size":new en(Qe.layout_symbol["icon-size"]),"icon-size-scale-range":new Ot(Qe.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new en(Qe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new en(Qe.layout_symbol["icon-text-fit-padding"]),"icon-image":new en(Qe.layout_symbol["icon-image"]),"icon-rotate":new en(Qe.layout_symbol["icon-rotate"]),"icon-padding":new Ot(Qe.layout_symbol["icon-padding"]),"icon-keep-upright":new Ot(Qe.layout_symbol["icon-keep-upright"]),"icon-offset":new en(Qe.layout_symbol["icon-offset"]),"icon-anchor":new en(Qe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ot(Qe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ot(Qe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ot(Qe.layout_symbol["text-rotation-alignment"]),"text-field":new en(Qe.layout_symbol["text-field"]),"text-font":new en(Qe.layout_symbol["text-font"]),"text-size":new en(Qe.layout_symbol["text-size"]),"text-size-scale-range":new Ot(Qe.layout_symbol["text-size-scale-range"]),"text-max-width":new en(Qe.layout_symbol["text-max-width"]),"text-line-height":new en(Qe.layout_symbol["text-line-height"]),"text-letter-spacing":new en(Qe.layout_symbol["text-letter-spacing"]),"text-justify":new en(Qe.layout_symbol["text-justify"]),"text-radial-offset":new en(Qe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ot(Qe.layout_symbol["text-variable-anchor"]),"text-anchor":new en(Qe.layout_symbol["text-anchor"]),"text-max-angle":new Ot(Qe.layout_symbol["text-max-angle"]),"text-writing-mode":new Ot(Qe.layout_symbol["text-writing-mode"]),"text-rotate":new en(Qe.layout_symbol["text-rotate"]),"text-padding":new Ot(Qe.layout_symbol["text-padding"]),"text-keep-upright":new Ot(Qe.layout_symbol["text-keep-upright"]),"text-transform":new en(Qe.layout_symbol["text-transform"]),"text-offset":new en(Qe.layout_symbol["text-offset"]),"text-allow-overlap":new Ot(Qe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ot(Qe.layout_symbol["text-ignore-placement"]),"text-optional":new Ot(Qe.layout_symbol["text-optional"]),visibility:new Ot(Qe.layout_symbol.visibility)})),paint:y1||(y1=new li({"icon-opacity":new en(Qe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new en(Qe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new en(Qe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new en(Qe.paint_symbol["text-emissive-strength"]),"icon-color":new en(Qe.paint_symbol["icon-color"]),"icon-halo-color":new en(Qe.paint_symbol["icon-halo-color"]),"icon-halo-width":new en(Qe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new en(Qe.paint_symbol["icon-halo-blur"]),"icon-translate":new Ot(Qe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ot(Qe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new en(Qe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new en(Qe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new en(Qe.paint_symbol["text-occlusion-opacity"]),"text-color":new en(Qe.paint_symbol["text-color"],{runtimeType:lo,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new en(Qe.paint_symbol["text-halo-color"]),"text-halo-width":new en(Qe.paint_symbol["text-halo-width"]),"text-halo-blur":new en(Qe.paint_symbol["text-halo-blur"]),"text-translate":new Ot(Qe.paint_symbol["text-translate"]),"text-translate-anchor":new Ot(Qe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Ot(Qe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Ot(Qe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Ot(Qe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Ot(Qe.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new en(Qe.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new en({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new en({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new en({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new en({type:"string",default:"default","property-type":"data-driven"})}))},Av);class rg extends Xi{constructor(e,r,l,u){super(e,R_(),r,l,u),this._colorAdjustmentMatrix=de.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const u=[];for(const c of l)u.indexOf(c)<0&&u.push(c);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,r,l,u){return this._saturation===e&&this._contrast===r&&this._brightnessMin===l&&this._brightnessMax===u||(this._colorAdjustmentMatrix=function(c,f,x,S){c=ut(c),f=ia(f);const C=de.mat4.create(),_=c/3,E=1-2*_,M=[E,_,_,0,_,E,_,0,_,_,E,0,0,0,0,1],A=.5-.5*f,D=S-x;return de.mat4.multiply(C,[D,0,0,0,0,D,0,0,0,0,D,0,x,x,x,1],[f,0,0,0,0,f,0,0,0,0,f,0,A,A,A,1]),de.mat4.multiply(C,C,M),C}(e,r,l,u),this._saturation=e,this._contrast=r,this._brightnessMin=l,this._brightnessMax=u),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,r,l,u){const c=this.layout.get(e).evaluate(r,{},l,u),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||Rf(f.value)||!c?c:function(x,S){return S.replace(/{([^{}]+)}/g,(C,_)=>_ in x?String(x[_]):"")}(r.properties,c)}createBucket(e){return new ng(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of R_().paint.overridableProperties){if(!rg.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),l=new v1(r),u=new Mf(l,r.property.specification,this.scope,this.options);let c=null;c=r.value.kind==="constant"||r.value.kind==="source"?new Jd("source",u):new Qc("composite",u,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new od(r.property,c,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,l){return!(!this.layout||r.isDataDriven()||l.isDataDriven())&&rg.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const l=e.get("text-field"),u=R_().paint.properties[r];let c=!1;const f=x=>{for(const S of x)if(u.overrides&&u.overrides.hasOverride(S))return void(c=!0)};if(l.value.kind==="constant"&&l.value.value instanceof ko)f(l.value.value.sections);else if(l.value.kind==="source"){const x=C=>{c||(C instanceof dc&&Hi(C.value)===ku?f(C.value.sections):C instanceof Nu?f(C.sections):C.eachChild(x))},S=l.value;S._styleExpression&&x(S._styleExpression.expression)}return c}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,r,l){return{config:new pd(this,{zoom:r,lut:l}),overrideFog:!1}}}let K0,k_,hp,fp;var J0=_r([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Q0(s){switch(s){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function ex(s){switch(s){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Eo{constructor(e,r,l,u){this.context=e,this.format=l,this.useMipmap=u&&u.useMipmap,this.texture=e.gl.createTexture(),this.update(r,{premultiply:u&&u.premultiply})}update(e,r){const l=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,u=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:c}=this,{gl:f}=c,{x,y:S}=r&&r.position?r.position:{x:0,y:0},C=x+l,_=S+u;!this.size||this.size[0]===C&&this.size[1]===_||(f.bindTexture(f.TEXTURE_2D,null),f.deleteTexture(this.texture),this.texture=f.createTexture(),this.size=null),f.bindTexture(f.TEXTURE_2D,this.texture),c.pixelStoreUnpackFlipY.set(!1),c.pixelStoreUnpack.set(1),c.pixelStoreUnpackPremultiplyAlpha.set(this.format===f.RGBA8&&(!r||r.premultiply!==!1));const E=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&C>0&&_>0){const M=this.useMipmap?Math.floor(Math.log2(Math.max(C,_)))+1:1;f.texStorage2D(f.TEXTURE_2D,M,this.format,C,_),this.size=[C,_]}if(this.size)if(E)f.texSubImage2D(f.TEXTURE_2D,0,x,S,Q0(this.format),ex(this.format),e);else{const M=e.data;M&&f.texSubImage2D(f.TEXTURE_2D,0,x,S,l,u,Q0(this.format),ex(this.format),M)}this.useMipmap&&f.generateMipmap(f.TEXTURE_2D)}bind(e,r,l=!1){const{context:u}=this,{gl:c}=u;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap&&!l?e===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),r!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,r),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,r),this.wrapS=r)}bindExtraParam(e,r,l,u){const{context:c}=this,{gl:f}=c;f.bindTexture(f.TEXTURE_2D,this.texture),r!==this.magFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,r),this.magFilter=r),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),l!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,l),this.wrapS=l),u!==this.wrapT&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,u),this.wrapT=u)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Sd{constructor(e,r){this.context=e,this.texture=r}bind(e,r){const{context:l}=this,{gl:u}=l;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,e),this.minFilter=e),r!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,r),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,r),this.wrapS=r)}}function O_(s,e,r,l,u,c,f,x){const S=[s,e,1,r,l,1,u,c,1],C=[f,x,1],_=de.mat3.adjoint([],S),[E,M,A]=de.vec3.transformMat3(C,C,_);return de.mat3.multiply(S,S,[E,0,0,0,M,0,0,0,A])}function I_(s,e,r,l,u,c,f,x){const S=function(C,_,E,M,A,D,I,B){const U=O_(0,0,1,0,1,1,0,1),G=O_(C,_,E,M,A,D,I,B),H=de.mat3.adjoint([],U);return de.mat3.multiply(G,G,H)}(s,e,r,l,u,c,f,x);return[S[2]/S[8]/zt,S[5]/S[8]/zt]}function Ss(s){return[s[0],Math.min(Math.max(s[1],-85.051129),xs)]}class Nh extends Is{constructor(e,r,l,u){super(),this.id=e,this.dispatcher=l,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(u),this.options=r,this._dirty=!1}load(e,r){if(this._loaded=r||!1,this.fire(new hs("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=jc(this.map._requestManager.transformRequest(this.url,io.Image),(l,u)=>{this._imageRequest=null,this._loaded=!0,l?this.fire(new qd(l)):u&&(this.image=u instanceof HTMLImageElement?ct.getImageData(u):u,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Sd(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new hs("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Sd||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let r=e[0][1],l=e[0][1];for(const c of e)c[1]>l&&(l=c[1]),c[1]<r&&(r=c[1]);const u=(l+r)/2;if(u>xs?this.onNorthPole=!0:u<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const c=e.map(t.fromLngLat);this.tileID=function(f){let x=1/0,S=1/0,C=-1/0,_=-1/0;for(const I of f)x=Math.min(x,I.x),S=Math.min(S,I.y),C=Math.max(C,I.x),_=Math.max(_,I.y);const E=Math.max(C-x,_-S),M=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),A=Math.pow(2,M);let D=Math.floor((x+C)/2*A);return D>1&&(D-=1),new yt(M,D,Math.floor((S+_)/2*A))}(c),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new hs("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const U in this.tiles){const G=this.tiles[U];G.state!=="loaded"&&(G.state="loaded",G.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const r=up(new yt(0,0,0),this.map.transform.projection),l=[r.projection.project(this.coordinates[0][0],this.coordinates[0][1]),r.projection.project(this.coordinates[1][0],this.coordinates[1][1]),r.projection.project(this.coordinates[2][0],this.coordinates[2][1]),r.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(U){const G=U[1].x-U[0].x,H=U[1].y-U[0].y,q=U[2].x-U[1].x,Y=U[2].y-U[1].y,J=U[3].x-U[2].x,ne=U[3].y-U[2].y,me=U[0].x-U[3].x,ce=U[0].y-U[3].y,ue=G*Y-q*H,Ee=q*ne-J*Y,_e=J*ce-me*ne,De=me*H-G*ce;return ue>0&&Ee>0&&_e>0&&De>0||ue<0&&Ee<0&&_e<0&&De<0}(l))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const u=up(this.tileID,this.map.transform.projection),[c,f,x,S]=this.coordinates.map(U=>{const G=u.projection.project(U[0],U[1]);return Oh(u,G)._round()});this.perspectiveTransform=I_(c.x,c.y,f.x,f.y,x.x,x.y,S.x,S.y);const C=this._boundsArray=new sl;C.emplaceBack(c.x,c.y,0,0),C.emplaceBack(f.x,f.y,zt,0),C.emplaceBack(S.x,S.y,0,zt),C.emplaceBack(x.x,x.y,zt,zt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(C,J0.members),this.boundsSegments=ri.simpleSegment(0,0,4,2);const _=[],E=[Ss((M=this.coordinates)[0]),Ss(M[1]),Ss(M[2]),Ss(M[3])];var M;const[A,D,I,B]=function(U){let G=U[0][0],H=G,q=U[0][1],Y=q;for(let J=1;J<U.length;J++)U[J][0]<G?G=U[J][0]:U[J][0]>H&&(H=U[J][0]),U[J][1]<q?q=U[J][1]:U[J][1]>Y&&(Y=U[J][1]);return[G,q,H-G,Y-q]}(E);{const U=new sl,[G,H,q,Y]=function(Ve){let Ke=Ve[0].x,Ze=Ke,Je=Ve[0].y,vt=Je;for(let _t=1;_t<Ve.length;_t++)Ve[_t].x<Ke?Ke=Ve[_t].x:Ve[_t].x>Ze&&(Ze=Ve[_t].x),Ve[_t].y<Je?Je=Ve[_t].y:Ve[_t].y>vt&&(vt=Ve[_t].y);return[Ke,Je,Ze-Ke,vt-Je]}(l),J=Ve=>[(Ve.x-G)/q,(Ve.y-H)/Y],[ne,me,ce,ue]=l.map(J),Ee=function(Ve,Ke,Ze,Je,vt,_t,tn,Ct){const Bt=O_(0,0,1,0,1,1,0,1),bt=O_(Ve,Ke,Ze,Je,vt,_t,tn,Ct),xn=de.mat3.adjoint([],bt);return de.mat3.multiply(Bt,Bt,xn)}(ne[0],ne[1],me[0],me[1],ce[0],ce[1],ue[0],ue[1]);this.elevatedGlobePerspectiveTransform=I_(ne[0],ne[1],me[0],me[1],ce[0],ce[1],ue[0],ue[1]);const _e=(Ve,Ke)=>{_.push(Ve.lng);const Ze=Math.round((Ve.lng-A)/I*zt),Je=Math.round((Ve.lat-D)/B*zt),vt=J(Ke),_t=de.vec3.transformMat3([],[vt[0],vt[1],1],Ee),tn=Math.round(_t[0]/_t[2]*zt),Ct=Math.round(_t[1]/_t[2]*zt);U.emplaceBack(Ze,Je,tn,Ct)},De=l[3].x-l[0].x,Le=l[3].y-l[0].y,Ne=l[2].x-l[1].x,Ge=l[2].y-l[1].y;for(let Ve=0;Ve<65;Ve++){const Ke=Ve/64,Ze=[l[0].x+Ke*De,l[0].y+Ke*Le],Je=[l[1].x+Ke*Ne,l[1].y+Ke*Ge],vt=Je[0]-Ze[0],_t=Je[1]-Ze[1];for(let tn=0;tn<65;tn++){const Ct=tn/64,Bt={x:Ze[0]+vt*Ct,y:Ze[1]+_t*Ct};_e(r.projection.unproject(Bt.x,Bt.y),Bt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(U,J0.members)}{this.maxLongitudeTriangleSize=0;let U=[],G=new xo;const H=(q,Y,J)=>{G.emplaceBack(q,Y,J);const ne=_[q],me=_[Y],ce=_[J],ue=Math.min(Math.min(ne,me),ce),Ee=Math.max(Math.max(ne,me),ce)-ue;Ee>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ee),U.push(ue+Ee/2)};for(let q=0;q<64;q++)for(let Y=0;Y<64;Y++){const J=65*q+Y,ne=J+1,me=J+65,ce=me+1;H(J,me,ne),H(ne,me,ce)}[U,G]=function(q,Y){const J=Array.from({length:q.length},(ce,ue)=>ue);J.sort((ce,ue)=>q[ce]-q[ue]);const ne=[],me=new xo;for(let ce=0;ce<J.length;ce++){const ue=J[ce];ne.push(q[ue]);const Ee=3*ue,_e=Ee+1;me.emplaceBack(Y.uint16[Ee],Y.uint16[_e],Y.uint16[_e+1])}return[ne,me]}(U,G),this.elevatedGlobeTrianglesCenterLongitudes=U,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(G)}this.elevatedGlobeSegments=ri.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,I/zt,0,B/zt,0,0,D,A,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const r=this.map.painter.context,l=r.gl;!this._dirty||this.texture instanceof Sd||(this.texture?this.texture.update(this.image):(this.texture=new Eo(r,this.image,l.RGBA8),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(r)}loadTile(e,r){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},r(null)):(e.state="errored",r(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const r=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!r)return null;const l=this.elevatedGlobeTrianglesCenterLongitudes;let u=(c=e+180)+360*Math.round((l[0]-c)/360);var c;const f=new ri,x=(E,M)=>{f.segments.push({vertexOffset:0,primitiveOffset:E,vertexLength:r.segments[0].vertexLength,primitiveLength:M,sortKey:void 0,vaos:{}})},S=.51*this.maxLongitudeTriangleSize;if(Math.abs(l[0]-u)<=S){const E=no(l,0,l.length,u+S);return E===l.length||x(E,Er(l,E+1,l.length,u+360-S)-E),f}u<l[0]&&(u+=360);const C=Er(l,0,l.length,u-S);if(C===l.length)return x(0,l.length),f;x(0,C-0);const _=no(l,C+1,l.length,u+S);return _!==l.length&&x(_,l.length-_),f}}const Cv=(Math.pow(256,2)-1)/16907520;class N_ extends Xi{constructor(e,r,l,u){super(e,{layout:hp||(hp=new li({visibility:new Ot(Qe.layout_raster.visibility)})),paint:fp||(fp=new li({"raster-opacity":new Ot(Qe.paint_raster["raster-opacity"]),"raster-color":new sd(Qe.paint_raster["raster-color"]),"raster-color-mix":new Ot(Qe.paint_raster["raster-color-mix"]),"raster-color-range":new Ot(Qe.paint_raster["raster-color-range"]),"raster-hue-rotate":new Ot(Qe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ot(Qe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ot(Qe.paint_raster["raster-brightness-max"]),"raster-saturation":new Ot(Qe.paint_raster["raster-saturation"]),"raster-contrast":new Ot(Qe.paint_raster["raster-contrast"]),"raster-resampling":new Ot(Qe.paint_raster["raster-resampling"]),"raster-fade-duration":new Ot(Qe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Ot(Qe.paint_raster["raster-emissive-strength"]),"raster-array-band":new Ot(Qe.paint_raster["raster-array-band"]),"raster-elevation":new Ot(Qe.paint_raster["raster-elevation"]),"raster-color-use-theme":new en({type:"string",default:"default","property-type":"data-driven"})}))},r,l,u),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof Nh&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const r=this._transitionablePaint._values["raster-color"].value.expression,[l,u]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(l)&&isNaN(u)||l===this._curRampRange[0]&&u===this._curRampRange[1]||(this.colorRamp=Gf({expression:r,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:l,end:u}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[l,u])}}let ig,Dv,zh,pp,tx;class Ph extends Xi{constructor(e,r,l,u){super(e,{layout:ig||(ig=new li({visibility:new Ot(Qe["layout_raster-particle"].visibility)})),paint:Dv||(Dv=new li({"raster-particle-array-band":new Ot(Qe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Ot(Qe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new sd(Qe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Ot(Qe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Ot(Qe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Ot(Qe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Ot(Qe["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Ot(Qe["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new en({type:"string",default:"default","property-type":"data-driven"})}))},r,l,u),this._updateColorRamp(),this.lastInvalidatedAt=ct.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,r=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Gf({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:r}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ct.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class Ic extends Xi{constructor(e,r){super(e,{},r,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function mp(s,e,r){const l=[0,0,1],u=de.quat.identity([]);return de.quat.rotateY(u,u,r?-Jn(s)+Math.PI:Jn(s)),de.quat.rotateX(u,u,-Jn(e)),de.vec3.transformQuat(l,l,u),de.vec3.normalize(l,l)}function og(s,e){const r=Lh(s.projection,s.zoom,s.width,s.height),l=function(c,f,x,S,C){const _=new hr(x.lng-180*Ql,x.lat),E=new hr(x.lng+180*Ql,x.lat),M=c.project(_.lng,_.lat),A=c.project(E.lng,E.lat),D=-Math.atan2(A.y-M.y,A.x-M.x),I=t.fromLngLat(x);I.y=$n(I.y,-1+Ql,1-Ql);const B=I.toLngLat(),U=c.project(B.lng,B.lat),G=t.fromLngLat(B);G.x+=Ql;const H=G.toLngLat(),q=c.project(H.lng,H.lat),Y=Bh(q.x-U.x,q.y-U.y,D),J=t.fromLngLat(B);J.y+=Ql;const ne=J.toLngLat(),me=c.project(ne.lng,ne.lat),ce=Bh(me.x-U.x,me.y-U.y,D),ue=Math.abs(Y.x)/Math.abs(ce.y),Ee=de.mat4.identity([]);de.mat4.rotateZ(Ee,Ee,-D*(1-(C?0:S)));const _e=de.mat4.identity([]);return de.mat4.scale(_e,_e,[1,1-(1-ue)*S,1]),_e[4]=-ce.x/ce.y*S,de.mat4.rotateZ(_e,_e,D),de.mat4.multiply(_e,Ee,_e),_e}(s.projection,0,s.center,r,e),u=sg(s);return de.mat4.scale(l,l,[u,u,1]),l}function sg(s){const e=s.projection,r=Lh(s.projection,s.zoom,s.width,s.height),l=gp(e,s.center),u=gp(e,hr.convert(e.center));return Math.pow(2,l*r+(1-r)*u)}function Lh(s,e,r,l,u=1/0){const c=s.range;if(!c)return 0;const f=Math.min(u,Math.max(r,l)),x=Math.log(f/1024)/Math.LN2;return mo(c[0]+x,c[1]+x,e)}const Ql=1/4e4;function gp(s,e){const r=$n(e.lat,-85.051129,xs),l=new hr(e.lng-180*Ql,r),u=new hr(e.lng+180*Ql,r),c=s.project(l.lng,r),f=s.project(u.lng,r),x=t.fromLngLat(l),S=t.fromLngLat(u),C=f.x-c.x,_=f.y-c.y,E=S.x-x.x,M=S.y-x.y,A=Math.sqrt((E*E+M*M)/(C*C+_*_));return Math.log(A)/Math.LN2}function Bh(s,e,r){const l=Math.cos(r),u=Math.sin(r);return{x:s*l-e*u,y:s*u+e*l}}function z_(s,e,r){de.mat4.identity(s),de.mat4.rotateZ(s,s,Jn(e[2])),de.mat4.rotateX(s,s,Jn(e[0])),de.mat4.rotateY(s,s,Jn(e[1])),de.mat4.scale(s,s,r),de.mat4.multiply(s,s,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function P_(s,e,r,l,u,c,f,x){const S=[r[0]-e[0],r[1]-e[1],0],C=[l[0]-e[0],l[1]-e[1],0];if(de.vec3.length(S)<1e-12||de.vec3.length(C)<1e-12)return de.quat.identity(s);const _=de.vec3.cross([],S,C);de.vec3.normalize(_,_),de.vec3.subtract(C,l,e),S[2]=(c-u)*x,C[2]=(f-u)*x;const E=S;return de.vec3.cross(E,S,C),de.vec3.normalize(E,E),de.quat.rotationTo(s,_,E)}function _p(s,e,r=!1){const l=Yo(e.zoom),u=function(c,f,x){const S=f.worldSize,C=[c[12],c[13],c[14]],_=Sr(C[1]/S),E=vs(C[0]/S),M=de.mat4.identity([]),A=bo(1,_)*S,D=bo(1,0)*S*uu(_,f.zoom),I=1/Ra(S);let B=D*I;if(x){const q=Lh(f.projection,f.zoom,f.width,f.height,1024);B=I*f.projection.pixelSpaceConversion(f.center.lat,S,q)}const U=Ma(_,E);de.vec3.add(U,U,de.vec3.scale([],de.vec3.normalize([],U),A*B*C[2]));const G=function(q){const Y=[q[0],q[1],q[2]];let J=[0,1,0];const ne=de.vec3.cross([],J,Y);return de.vec3.cross(J,Y,ne),de.vec3.squaredLength(J)===0&&(J=[0,1,0],de.vec3.cross(ne,Y,J)),de.vec3.normalize(ne,ne),de.vec3.normalize(J,J),de.vec3.normalize(Y,Y),[ne[0],ne[1],ne[2],0,J[0],J[1],J[2],0,Y[0],Y[1],Y[2],0,q[0],q[1],q[2],1]}(U);de.mat4.scale(M,M,[B,B,B*A]),de.mat4.translate(M,M,[-C[0],-C[1],-C[2]]);const H=de.mat4.multiply([],f.globeMatrix,G);return de.mat4.multiply(H,H,M),de.mat4.multiply(H,H,c),H}(s,e,r);if(l>0){const c=function(f,x){const S=x.worldSize,C=bo(1,0)*S*uu(x.center.lat,x.zoom)/Ra(S),_=bo(1,x.center.lat)*S,E=de.mat4.identity([]);return de.mat4.rotateY(E,E,Jn(x.center.lng)),de.mat4.rotateX(E,E,Jn(x.center.lat)),de.mat4.translate(E,E,[0,0,Zo]),de.mat4.scale(E,E,[C,C,C*_]),de.mat4.translate(E,E,[x.point.x-.5*S,x.point.y-.5*S,0]),de.mat4.multiply(E,E,f),de.mat4.multiply(E,x.globeMatrix,E)}(s,e);return function(f,x,S){const C=(D,I,B)=>{const U=de.vec3.length(D),G=de.vec3.length(I),H=Qi(D,I,B);return de.vec3.scale(H,H,1/de.vec3.length(H)*En(U,G,B))},_=C([f[0],f[1],f[2]],[x[0],x[1],x[2]],S),E=C([f[4],f[5],f[6]],[x[4],x[5],x[6]],S),M=C([f[8],f[9],f[10]],[x[8],x[9],x[10]],S),A=Qi([f[12],f[13],f[14]],[x[12],x[13],x[14]],S);return[_[0],_[1],_[2],0,E[0],E[1],E[2],0,M[0],M[1],M[2],0,A[0],A[1],A[2],1]}(u,c,l)}return u}function nx(s,e,r,l){const u=fn.projectAabbCorners(l,r);let c=Number.MAX_VALUE,f=-1;for(let C=0;C<u.length;++C){const _=u[C];_[0]=(.5*_[0]+.5)*e.width,_[1]=(.5-.5*_[1])*e.height,_[2]<c&&(f=C,c=_[2])}const x=C=>new qt(u[C][0],u[C][1]);let S;switch(f){case 0:case 6:S=[x(1),x(5),x(4),x(7),x(3),x(2),x(1)];break;case 1:case 7:S=[x(0),x(4),x(5),x(6),x(2),x(3),x(0)];break;case 3:case 5:S=[x(1),x(0),x(4),x(7),x(6),x(2),x(1)];break;default:S=[x(1),x(5),x(6),x(7),x(3),x(0),x(1)]}if(Q(s,S))return c}const Mv=_r([{name:"a_pos_3f",components:3,type:"Float32"}]),rx=_r([{name:"a_color_3f",components:3,type:"Float32"}]),L_=_r([{name:"a_color_4f",components:4,type:"Float32"}]),Rv=_r([{name:"a_uv_2f",components:2,type:"Float32"}]),ec=_r([{name:"a_normal_3f",components:3,type:"Float32"}]),tc=_r([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),ya=_r([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),is={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class uo{constructor(e,r,l,u){this.message=(e?`${e}: `:"")+l,u&&(this.identifier=u),r!=null&&r.__line__&&(this.line=r.__line__)}}function ix(s,e){const r=s.indexOf("://")===-1;try{return new URL(s,r&&e?"http://example.com":void 0),!0}catch{return!1}}class ox{constructor(e,r){this.feature=e,this.instancedDataOffset=r,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class sx{constructor(){this.instancedDataArray=new Bf,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class B_{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,r){}populate(e,r,l,u){this.tileToMeter=h(l);const c=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:f,id:x,index:S,sourceLayerIndex:C}of e){const _=x??(f.properties&&f.properties.hasOwnProperty("id")?f.properties.id:void 0),E=F(f,c);if(!this.layers[0]._featureFilter.filter(new Hr(this.zoom),E,l))continue;const M={id:_,sourceLayerIndex:C,index:S,geometry:c?E.geometry:P(f,l,u),properties:f.properties,type:f.type,patterns:{}},A=this.addFeature(M,M.geometry,E);A&&r.featureIndex.insert(f,M.geometry,S,C,this.index,this.instancesPerModel[A].instancedDataArray.length,zt/32)}this.lookup=null}update(e,r,l,u){for(const c in this.instancesPerModel){const f=this.instancesPerModel[c];for(const x in e)f.idToFeaturesIndex.hasOwnProperty(x)&&(this.evaluate(f.features[f.idToFeaturesIndex[x]],e[x],f,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const r in this.instancesPerModel){const l=this.instancesPerModel[r];for(const u of l.features){const c=this.layers[0],f=u.feature,x=this.canonical,S=c.paint.get("model-rotation").evaluate(f,{},x),C=c.paint.get("model-scale").evaluate(f,{},x),_=c.paint.get("model-translation").evaluate(f,{},x);de.vec3.exactEquals(u.rotation,S)&&de.vec3.exactEquals(u.scale,C)&&de.vec3.exactEquals(u.translation,_)||(this.evaluate(u,u.featureStates,l,!0),e=!0)}}return e}updateReplacement(e,r,l,u){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;const c=r.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(S0(this.activeReplacements,c))return!1;this.activeReplacements=c;let f=!1;for(const x in this.instancesPerModel){const S=this.instancesPerModel[x],C=S.instancedDataArray;for(const _ of S.features){const E=_.instancedDataOffset,M=_.instancedDataCount;for(let A=0;A<M;A++){const D=16*(A+E);let I=C.float32[D+0];const B=I>zt;I=B?I-zt:I;const U=Math.floor(I),G=C.float32[D+1];let H=!1;for(const q of this.activeReplacements)if(!Xf(q,l,is.Model,u)&&!(q.min.x>U||U>q.max.x||q.min.y>G||G>q.max.y)&&(H=$s(Hl(U,G,e.canonical,q.footprintTileId.canonical),q.footprint),H))break;C.float32[D]=H?I+zt:I,f=f||H!==B}}}return f}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const r in this.instancesPerModel){const l=this.instancesPerModel[r];l.instancedDataArray.length<0||l.instancedDataArray.length===0||(l.instancedDataBuffer?l.instancedDataBuffer.updateData(l.instancedDataArray):l.instancedDataBuffer=e.createVertexBuffer(l.instancedDataArray,tc.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const r in this.instancesPerModel){const l=this.instancesPerModel[r];l.instancedDataArray.length!==0&&l.instancedDataBuffer&&l.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris)for(const r of this.modelUris)e.removeModel(r,"")}addFeature(e,r,l){const u=this.layers[0],c=u.layout.get("model-id").evaluate(l,{},this.canonical);if(!c)return xe(`modelId is not evaluated for layer ${u.id} and it is not going to get rendered.`),c;ix(c,!1)&&(this.modelUris.includes(c)||this.modelUris.push(c)),this.instancesPerModel[c]||(this.instancesPerModel[c]=new sx);const f=this.instancesPerModel[c],x=f.instancedDataArray,S=new ox(l,x.length);for(const C of r)for(const _ of C){if(_.x<0||_.x>=zt||_.y<0||_.y>=zt)continue;const E=(this.lookupDim-1)/zt,M=this.lookupDim*(_.y*E|0)+_.x*E|0;if(this.lookup){if(this.lookup[M]!==0)continue;this.lookup[M]=1}this.instanceCount++;const A=x.length;x.resize(A+1),f.instancesEvaluatedElevation.push(0),x.float32[16*A]=_.x,x.float32[16*A+1]=_.y}return S.instancedDataCount=f.instancedDataArray.length-S.instancedDataOffset,S.instancedDataCount>0&&(e.id&&(f.idToFeaturesIndex[e.id]=f.features.length),f.features.push(S),this.evaluate(S,{},f,!1)),c}getModelUris(){return this.modelUris}evaluate(e,r,l,u){const c=this.layers[0],f=e.feature,x=this.canonical,S=e.rotation=c.paint.get("model-rotation").evaluate(f,r,x),C=e.scale=c.paint.get("model-scale").evaluate(f,r,x),_=e.translation=c.paint.get("model-translation").evaluate(f,r,x),E=c.paint.get("model-color").evaluate(f,r,x);E.a=c.paint.get("model-color-mix-intensity").evaluate(f,r,x);const M=[];this.maxVerticalOffset<_[2]&&(this.maxVerticalOffset=_[2]),this.maxScale=Math.max(Math.max(this.maxScale,C[0]),Math.max(C[1],C[2])),z_(M,S,C);const A=Math.round(100*E.a)+E.b/1.05;for(let D=0;D<e.instancedDataCount;++D){const I=e.instancedDataOffset+D,B=16*I,U=l.instancedDataArray.float32;let G=0;u&&(G=U[B+6]-l.instancesEvaluatedElevation[I]);const H=0|U[B+1];U[B]=(0|U[B])+E.r/1.05,U[B+1]=H+E.g/1.05,U[B+2]=A,U[B+3]=1/(x.z>10?this.tileToMeter:h(x,H)),U[B+4]=_[0],U[B+5]=_[1],U[B+6]=_[2]+G,U[B+7]=M[0],U[B+8]=M[1],U[B+9]=M[2],U[B+10]=M[4],U[B+11]=M[5],U[B+12]=M[6],U[B+13]=M[8],U[B+14]=M[9],U[B+15]=M[10],l.instancesEvaluatedElevation[I]=_[2]}}}let Td,ax;nn(B_,"ModelBucket",{omit:["layers"]}),nn(sx,"PerModelAttributes"),nn(ox,"ModelFeature");const Ed=64,Fh={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function yp(s,e,r,l,u,c,f,x,S,C=!1){const _=r.zoom,E=r.project(l),M=uu(l.lat,_),A=1/M;de.mat4.identity(s),de.mat4.translate(s,s,[E.x+f[0]*A,E.y+f[1]*A,f[2]]);let D=1,I=1;const B=r.worldSize;if(C){if(r.projection.name==="mercator"){let q=0;r.elevation&&(q=r.elevation.getAtPointOrZero(new t(E.x/B,E.y/B),0));const Y=de.vec4.transformMat4([],[E.x,E.y,q,1],r.projMatrix)[3]/r.cameraToCenterDistance;D=Y,I=Y*uu(r.center.lat,_)}else if(r.projection.name==="globe"){const q=_p(s,r),Y=de.mat4.multiply([],r.projMatrix,q),J=[0,0,0,1];de.vec4.transformMat4(J,J,Y);const ne=J[3]/r.cameraToCenterDistance,me=Yo(_),ce=r.projection.pixelsPerMeter(l.lat,B)*uu(l.lat,_),ue=r.projection.pixelsPerMeter(r.center.lat,B)*uu(r.center.lat,_);D=ne/En(ce,n_(r.center.lat),me),I=ne*M/ce,D*=ue,I*=ue}}else D=A;de.mat4.scale(s,s,[D,D,I]);const U=[...s],G=e.orientation,H=[];if(z_(H,[G[0]+u[0],G[1]+u[1],G[2]+u[2]],c),de.mat4.multiply(s,U,H),x&&r.elevation){let q=0;const Y=[];if(S&&r.elevation){q=function(me,ce,ue,Ee,_e){const De=ce.elevation;if(!De)return 0;const Le=fn.projectAabbCorners(ue,Ee),Ne=bo(1,_e.lat)*ce.worldSize,Ge=function(xn,Jt){const an=[0,0,1],Rn=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const qn of Rn){const On=xn[qn.corners[0]],Vn=xn[qn.corners[1]],Fn=xn[qn.corners[2]],nr=[Vn[0]-On[0],Vn[1]-On[1],Jt*(Vn[2]-On[2])],pr=de.vec3.cross(nr,nr,[Fn[0]-On[0],Fn[1]-On[1],Jt*(Fn[2]-On[2])]);de.vec3.normalize(pr,pr),qn.dotProductWithUp=de.vec3.dot(pr,an)}return Rn.sort((qn,On)=>qn.dotProductWithUp-On.dotProductWithUp),Rn[0].corners}(Le,Ne),Ve=Le[Ge[0]],Ke=Le[Ge[1]],Ze=Le[Ge[2]],Je=Le[Ge[3]],vt=De.getAtPointOrZero(new t(Ve[0]/ce.worldSize,Ve[1]/ce.worldSize),0),_t=De.getAtPointOrZero(new t(Ke[0]/ce.worldSize,Ke[1]/ce.worldSize),0),tn=De.getAtPointOrZero(new t(Ze[0]/ce.worldSize,Ze[1]/ce.worldSize),0),Ct=De.getAtPointOrZero(new t(Je[0]/ce.worldSize,Je[1]/ce.worldSize),0),Bt=(vt+Ct)/2,bt=(_t+tn)/2;return Bt>bt?_t<tn?P_(me,Ke,Je,Ve,_t,Ct,vt,Ne):P_(me,Ze,Ve,Je,tn,vt,Ct,Ne):vt<Ct?P_(me,Ve,Ke,Ze,vt,_t,tn,Ne):P_(me,Je,Ze,Ke,Ct,tn,_t,Ne),Math.max(Bt,bt)}(Y,r,e.aabb,s,l);const J=de.mat4.fromQuat([],Y),ne=de.mat4.multiply([],J,H);de.mat4.multiply(s,U,ne)}else q=r.elevation.getAtPointOrZero(new t(E.x/B,E.y/B),0);q!==0&&(s[14]+=q)}}function Uh(s,e,r=!1){s.uploaded||(s.gfxTexture=new Eo(e,s.image,r?e.gl.R8:e.gl.RGBA8,{useMipmap:s.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),s.uploaded=!0,s.image=null)}function ag(s,e,r){s.indexBuffer=e.createIndexBuffer(s.indexArray,!1,!0),s.vertexBuffer=e.createVertexBuffer(s.vertexArray,Mv.members,!1,!0),s.normalArray&&(s.normalBuffer=e.createVertexBuffer(s.normalArray,ec.members,!1,!0)),s.texcoordArray&&(s.texcoordBuffer=e.createVertexBuffer(s.texcoordArray,Rv.members,!1,!0)),s.colorArray&&(s.colorBuffer=e.createVertexBuffer(s.colorArray,(s.colorArray.bytesPerElement===12?rx:L_).members,!1,!0)),s.featureArray&&(s.pbrBuffer=e.createVertexBuffer(s.featureArray,ya.members,!0)),s.segments=ri.simpleSegment(0,0,s.vertexArray.length,s.indexArray.length);const l=s.material;l.pbrMetallicRoughness.baseColorTexture&&Uh(l.pbrMetallicRoughness.baseColorTexture,e),l.pbrMetallicRoughness.metallicRoughnessTexture&&Uh(l.pbrMetallicRoughness.metallicRoughnessTexture,e),l.normalTexture&&Uh(l.normalTexture,e),l.occlusionTexture&&Uh(l.occlusionTexture,e,r),l.emissionTexture&&Uh(l.emissionTexture,e)}function kv(s,e,r){if(s.meshes)for(const l of s.meshes)ag(l,e,r);if(s.children)for(const l of s.children)kv(l,e,r)}function F_(s){if(s.meshes)for(const e of s.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(s.children)for(const e of s.children)F_(e)}function U_(s){if(s.meshes)for(const r of s.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((e=r.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(s.children)for(const r of s.children)U_(r)}class vp{constructor(e,r,l){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=l}static create(e,r,l){const u=l||e.findDEMTileFor(r);if(!u||!u.dem)return;const c=u.dem,f=u.tileID,x=1<<r.canonical.z-f.canonical.z;return new vp(u,c.dim/zt/x,[(r.canonical.x/x-f.canonical.x)*c.dim,(r.canonical.y/x-f.canonical.y)*c.dim])}tileCoordToPixel(e,r){const l=r*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),c=Math.floor(l);return new qt(u,c)}getElevationAt(e,r,l,u){const c=e*this._scale+this._offset[0],f=r*this._scale+this._offset[1],x=Math.floor(c),S=Math.floor(f),C=this._dem;return u=!!u,l?En(En(C.get(x,S,u),C.get(x,S+1,u),f-S),En(C.get(x+1,S,u),C.get(x+1,S+1,u),f-S),c-x):C.get(x,S,u)}getElevationAtPixel(e,r,l){return this._dem.get(e,r,!!l)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*bo(1,e)*this._dem.stride}}const _u=new Float32Array(262144),ur=new Uint8Array(262144);function Oi(s){let e=0;if(s.meshes)for(const r of s.meshes)e=Math.max(e,r.aabb.max[2]);if(s.children)for(const r of s.children)e=Math.max(e,Oi(r));return e}function Ao(s,e,r){if(s.meshes)for(const l of s.meshes){if(l.aabb.min[0]===1/0)continue;const u=fn.applyTransform(l.aabb,s.matrix);r.insert(e,u.min[0],u.min[1],u.max[0],u.max[1])}if(s.children)for(const l of s.children)Ao(l,e,r)}const j_=["","wall","door","roof","window","lamp","logo"];class xp{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:Oi(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new fn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const r=new fn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const l of this.node.meshes)this.node.lightMeshIndex!==e&&(l.transformedAabb=fn.applyTransformFast(l.aabb,this.node.matrix),r.encapsulate(l.transformedAabb)),e++;this.aabb=r}return this.aabb}}class yu{constructor(e,r,l,u,c,f,x){this.id=l,this.layers=e,this.layerIds=this.layers.map(S=>S.fqid),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id),this.modelTraits|=Fh.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,u&&(this.modelTraits|=Fh.HasMapboxMeshFeatures),c&&(this.modelTraits|=Fh.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=f,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const S of r)this.nodesInfo.push(new xp(S)),Ao(S,x.featureIndexArray.length,x.grid),x.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,x.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,r){for(const l of this.getNodesInfo()){const u=l.node;u.footprint&&r.push({footprint:u.footprint,id:e})}}update(e){const r=Object.keys(e).length!==0;if(r&&!this.stateDependentLayers.length)return;const l=r?this.stateDependentLayers:this.layers;if(!cs(e,this.states))for(const u of l)this.evaluate(u,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const r=this.getNodesInfo();for(const l of r){const u=l.node;this.uploaded?this.updatePbrBuffer(u):kv(u,e,!0)}for(const l of r)F_(l.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let r=!1;if(!e.meshes)return r;for(const l of e.meshes)l.pbrBuffer&&(l.pbrBuffer.updateData(l.featureArray),r=!0);return r}needsReEvaluation(e,r,l){const u=e.transform.projectionOptions,c=e.style.getBrightness(),f=this.brightness!==c;if(!this.uploaded||this.dirty||u.name!==this.projection.name||jh(l.paint.get("model-color").value,f)||jh(l.paint.get("model-color-mix-intensity").value,f)||jh(l.paint.get("model-roughness").value,f)||jh(l.paint.get("model-emissive-strength").value,f)||jh(l.paint.get("model-height-based-emissive-strength-multiplier").value,f)){this.projection=u,this.brightness=c;const x=this.getNodesInfo();for(const S of x)S.state=null;return!0}return!1}evaluateScale(e,r){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const l=this.getNodesInfo(),u=this.id.canonical;for(const c of l){const f=c.feature;c.evaluatedScale=r.paint.get("model-scale").evaluate(f,{},u)}}evaluate(e,r){const l=this.getNodesInfo();for(const u of l){if(!u.node.meshes)continue;const c=u.feature,f=r&&r[c.id];if(cs(f,u.state))continue;u.state=structuredClone(f);const x=u.node.meshes&&u.node.meshes[0].featureData,S=u.evaluatedColor[2],C=u.evaluatedRMEA[2],_=this.id.canonical;if(u.hasTranslucentParts=!1,x){for(let E=0;E<j_.length;E++){const M=j_[E];M.length&&(c.properties.part=M);const A=e.paint.get("model-color").evaluate(c,f,_).toRenderColor(null),D=e.paint.get("model-color-mix-intensity").evaluate(c,f,_);u.evaluatedColor[E]=[A.r,A.g,A.b,D],u.evaluatedRMEA[E][0]=e.paint.get("model-roughness").evaluate(c,f,_),u.evaluatedRMEA[E][2]=e.paint.get("model-emissive-strength").evaluate(c,f,_),u.evaluatedRMEA[E][3]=A.a,u.emissionHeightBasedParams[E]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(c,f,_),!u.hasTranslucentParts&&A.a<1&&(u.hasTranslucentParts=!0)}delete c.properties.part,Ad(u,S!==u.evaluatedColor[2]||C!==u.evaluatedRMEA[2],this.modelTraits)}else u.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(c,f,_);u.evaluatedScale=e.paint.get("model-scale").evaluate(c,f,_),this.updatePbrBuffer(u.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,r,l,u){const c=e.findDEMTileFor(l);if(c&&(c.tileID.canonical!==this.terrainTile||r!==this.terrainExaggeration)){if(c.dem&&c.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=c.tileID.overscaledZ;const f=vp.create(e,l,c);if(!f)return;this.modelTraits&Fh.HasMapboxMeshFeatures&&this.updateDEM(e,f,l,u);for(const x of this.getNodesInfo()){const S=x.node;if(!S.footprint||!S.footprint.vertices||!S.footprint.vertices.length)continue;const C=S.footprint.vertices;let _=f.getElevationAt(C[0].x,C[0].y,!0,!0);for(let E=1;E<C.length;E++)_=Math.min(_,f.getElevationAt(C[E].x,C[E].y,!0,!0));S.elevation=_}}this.terrainTile=c.tileID.canonical,this.terrainExaggeration=r}}updateDEM(e,r,l,u){let c=r._dem._modifiedForSources[u];if(c===void 0&&(r._dem._modifiedForSources[u]=[],c=r._dem._modifiedForSources[u]),c.includes(l.canonical))return;const f=r._dem.dim;c.push(l.canonical);let x=!1;for(const S of this.getNodesInfo()){const C=S.node;if(!C.footprint||!C.footprint.grid)continue;const _=C.footprint.grid,E=r.tileCoordToPixel(_.min.x,_.min.y),M=r.tileCoordToPixel(_.max.x,_.max.y),A=Math.min(Math.min(f-M.y,E.x),Math.min(E.y,f-M.x));if(A<0)continue;const D=$n(A,2,5);let I=Math.max(0,E.x-D),B=Math.max(0,E.y-D),U=Math.min(M.x+D,f-1),G=Math.min(M.y+D,f-1);for(let J=B;J<=G;++J)for(let ne=I;ne<=U;++ne)ur[J*f+ne]=255;let H=0,q=0;for(let J=0;J<_.cellsY;++J)for(let ne=0;ne<_.cellsX;++ne){if(!_.cells[J*_.cellsX+ne])continue;const me=r.tileCoordToPixel(_.min.x+ne/_.xScale,_.min.y+J/_.yScale),ce=r.tileCoordToPixel(_.min.x+(ne+1)/_.xScale,_.min.y+(J+1)/_.yScale);for(let ue=me.y;ue<=Math.min(ce.y+1,f-1);++ue)for(let Ee=me.x;Ee<=Math.min(ce.x+1,f-1);++Ee)ur[ue*f+Ee]===255&&(ur[ue*f+Ee]=0,H+=r.getElevationAtPixel(Ee,ue),q++)}const Y=H/q;I=Math.max(1,E.x-D),B=Math.max(1,E.y-D),U=Math.min(M.x+D,f-2),G=Math.min(M.y+D,f-2),x=!0;for(let J=B;J<=G;++J)for(let ne=I;ne<=U;++ne)ur[J*f+ne]===0&&(_u[J*f+ne]=r._dem.set(ne,J,Y));for(let J=1;J<D;++J){I=Math.max(1,E.x-J),B=Math.max(1,E.y-J),U=Math.min(M.x+J,f-2),G=Math.min(M.y+J,f-2);for(let ne=B;ne<=G;++ne)for(let me=I;me<=U;++me){const ce=ne*f+me;if(ur[ce]===255){let ue=0,Ee=0,_e=-1,De=-1;for(let Le=-1;Le<=1;++Le)for(let Ne=-1;Ne<=1;++Ne){const Ge=(ne+Le)*f+me+Ne;if(ur[Ge]>=J)continue;const Ve=_u[Ge],Ke=Math.abs(Ve);Ke>Ee&&(ue=Ve,Ee=Ke,_e=Ne,De=Le)}if(Ee>.1){const Le=1-(J+.5*Math.abs(_e*De))/D;let Ne=r._dem.get(me,ne)+ue*Le;const Ge=r._dem.get(me+_e,ne+De),Ve=r._dem.get(me-_e,ne-De,!0);(Ne-Ge)*(Ne-Ve)>0&&(Ne=(Ge+Ve)/2),_u[ce]=r._dem.set(me,ne,Ne),ur[ce]=J}}}}}x&&(r._demTile.needsDEMTextureUpload=!0,r._dem._timestamp=ct.now())}setFilter(e){this.filter=e?Vg(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new Hr(this.id.overscaledZ),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const r of e)F_(r.node),U_(r.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const l=r.getReplacementRegionsForTile(e.toUnwrapped()),u=this.getNodesInfo();for(let c=0;c<this.nodesInfo.length;c++){const f=u[c].node;u[c].hiddenByReplacement=!!f.footprint&&!l.find(x=>x.footprint===f.footprint)}}getHeightAtTileCoord(e,r){const l=this.getNodesInfo(),u=[],c=[0,0,0],f=de.mat4.identity([]);for(let x=0;x<this.nodesInfo.length;x++){const S=l[x],C=S.node.meshes[0],_=C.transformedAabb;if(e<_.min[0]||r<_.min[1]||e>_.max[0]||r>_.max[1])continue;if(S.node.hidden===!0)return{height:1/0,maxHeight:S.feature.properties.height,hidden:!1,verticalScale:S.evaluatedScale[2]};de.mat4.invert(f,S.node.matrix),c[0]=e,c[1]=r,de.vec3.transformMat4(c,c,f);const E=(c[0]-C.aabb.min[0])/(C.aabb.max[0]-C.aabb.min[0])*Ed|0,M=Math.min(63,(c[1]-C.aabb.min[1])/(C.aabb.max[1]-C.aabb.min[1])*Ed|0)*Ed+Math.min(63,E),A=C.heightmap[M];if(!(A<0&&S.node.footprint))return S.hiddenByReplacement?void 0:{height:A,maxHeight:S.feature.properties.height,hidden:!1,verticalScale:S.evaluatedScale[2]};if(S.node.footprint.grid.query(new qt(e,r),new qt(e,r),u),u.length>0)return{height:void 0,maxHeight:S.feature.properties.height,hidden:S.hiddenByReplacement,verticalScale:S.evaluatedScale[2]}}}}function jh(s,e){return!s.isLightConstant&&e}function V_(s,e,r,l,u,c,f,x){let S=(61440&e|(61440&e)>>4)>>8,C=(3840&e|(3840&e)>>4)>>4,_=240&e|(240&e)>>4;r[3]>0&&(S=En(S,255*r[0],r[3]),C=En(C,255*r[1],r[3]),_=En(_,255*r[2],r[3]));const E=S<<8|C,M=_<<8|Math.floor(255*l[3]),A=function(J){const ne=$n(J,0,2);return Math.min(Math.round(.5*ne*255),255)}(l[2])<<8|15*l[0]<<4|15*l[1],D=$n(u[0],0,1),I=$n(u[1],0,1),B=$n(u[2],0,1),U=$n(u[3],0,1);let G,H,q,Y;if(D!==I&&f!==c&&I!==D){const J=f-c;H=1/(J*(I-D)),q=-(c+J*D)/(J*(I-D));const ne=$n(u[4],-1,1);Y=Math.pow(10,ne),G=255*B<<8|255*U}else G=65535,H=0,q=1,Y=1;if(s.emplaceBack(E,M,A,G,H,q,Y),x){const J=x.length;x.clear();for(let ne=0;ne<J;ne++)x.emplaceBack(E,M,A,G,H,q,Y)}}function Ad(s,e,r){const l=s.node;let u=0;const c=r&Fh.HasMeshoptCompression;for(const f of l.meshes){if(l.lights&&l.lightMeshIndex===u||!f.featureData)continue;f.featureArray=new hh,f.featureArray.reserve(f.featureData.length);let x=e;for(const S of f.featureData){const C=c?65535&S:S>>16&65535,_=c?S>>16&65535:65535&S,E=(15&_)<8?15&_:0,M=s.evaluatedRMEA[E],A=s.evaluatedColor[E],D=s.emissionHeightBasedParams[E];let I;if(x&&E===2&&l.lights&&(I=new hh,I.resize(10*l.lights.length)),V_(f.featureArray,C,A,M,D,f.aabb.min[2],f.aabb.max[2],I),I&&x){x=!1;const B=l.meshes[l.lightMeshIndex];B.featureArray=I,B.featureArray._trim()}}f.featureArray._trim(),u++}}function x1(s,e,r,l){const u=1<<s.z;e.lat=Sr((l/zt+s.y)/u),e.lng=vs((r/zt+s.x)/u)}nn(yu,"Tiled3dModelBucket",{omit:["layers"]}),nn(xp,"Tiled3dModelFeature");const mS={circle:class extends Xi{constructor(s,e,r,l){super(s,{layout:He||(He=new li({"circle-sort-key":new en(Qe.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Ot(Qe.layout_circle["circle-elevation-reference"]),visibility:new Ot(Qe.layout_circle.visibility)})),paint:mt||(mt=new li({"circle-radius":new en(Qe.paint_circle["circle-radius"]),"circle-color":new en(Qe.paint_circle["circle-color"]),"circle-blur":new en(Qe.paint_circle["circle-blur"]),"circle-opacity":new en(Qe.paint_circle["circle-opacity"]),"circle-translate":new Ot(Qe.paint_circle["circle-translate"]),"circle-translate-anchor":new Ot(Qe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ot(Qe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ot(Qe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new en(Qe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new en(Qe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new en(Qe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Ot(Qe.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new en({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new en({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l)}createBucket(s){return new Z(s)}queryRadius(s){const e=s;return Xe("circle-radius",this,e)+Xe("circle-stroke-width",this,e)+ft(this.paint.get("circle-translate"))}queryIntersectsFeature(s,e,r,l,u,c,f,x){const S=Mt(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),c.angle,s.pixelToTileUnitsFactor),C=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return Pm(s,l,c,f,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",S,C)}getProgramIds(){return["circle"]}getDefaultProgramParams(s,e,r){const l=Th(this);return{config:new pd(this,{zoom:e,lut:r}),defines:l,overrideFog:!1}}},heatmap:class extends Xi{createBucket(s){return new i0(s)}constructor(s,e,r,l){super(s,{layout:o0||(o0=new li({visibility:new Ot(Qe.layout_heatmap.visibility)})),paint:i_||(i_=new li({"heatmap-radius":new en(Qe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new en(Qe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ot(Qe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new sd(Qe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ot(Qe.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new en({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Gf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return Xe("heatmap-radius",this,s)}queryIntersectsFeature(s,e,r,l,u,c,f,x){const S=this.paint.get("heatmap-radius").evaluate(e,r);return Pm(s,l,c,f,x,!0,!0,new qt(0,0),S)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(s,e,r){return s==="heatmap"?{config:new pd(this,{zoom:e,lut:r}),overrideFog:!1}:{}}},hillshade:class extends Xi{constructor(s,e,r,l){super(s,{layout:Hf||(Hf=new li({visibility:new Ot(Qe.layout_hillshade.visibility)})),paint:Bm||(Bm=new li({"hillshade-illumination-direction":new Ot(Qe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ot(Qe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ot(Qe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ot(Qe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ot(Qe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ot(Qe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Ot(Qe.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new en({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new en({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new en({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(s,e,r){return{overrideFog:!1}}},fill:class extends Xi{constructor(s,e,r,l){super(s,{layout:es||(es=new li({"fill-sort-key":new en(Qe.layout_fill["fill-sort-key"]),visibility:new Ot(Qe.layout_fill.visibility),"fill-elevation-reference":new Ot(Qe.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new en(Qe.layout_fill["fill-construct-bridge-guard-rail"])})),paint:Pt||(Pt=new li({"fill-antialias":new Ot(Qe.paint_fill["fill-antialias"]),"fill-opacity":new en(Qe.paint_fill["fill-opacity"]),"fill-color":new en(Qe.paint_fill["fill-color"]),"fill-outline-color":new en(Qe.paint_fill["fill-outline-color"]),"fill-translate":new Ot(Qe.paint_fill["fill-translate"]),"fill-translate-anchor":new Ot(Qe.paint_fill["fill-translate-anchor"]),"fill-pattern":new en(Qe.paint_fill["fill-pattern"]),"fill-emissive-strength":new Ot(Qe.paint_fill["fill-emissive-strength"]),"fill-z-offset":new en(Qe.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new en(Qe.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new en(Qe.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new en({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new en({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new en({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new en({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l)}getProgramIds(){const s=this.paint.get("fill-pattern"),e=s&&s.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(s,e,r){return{config:new pd(this,{zoom:e,lut:r}),overrideFog:!1}}recalculate(s,e){super.recalculate(s,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new x0(s)}queryRadius(){return ft(this.paint.get("fill-translate"))}queryIntersectsFeature(s,e,r,l,u,c){return!s.queryGeometry.isAboveHorizon&&te(gt(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),c.angle,s.pixelToTileUnitsFactor),l)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(s){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return s!=null?e&&!s:e}},"fill-extrusion":class extends Xi{constructor(s,e,r,l){super(s,{layout:O0||(O0=new li({visibility:new Ot(Qe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Ot(Qe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:ov||(ov=new li({"fill-extrusion-opacity":new Ot(Qe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new en(Qe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ot(Qe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ot(Qe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new en(Qe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new en(Qe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new en(Qe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Ot(Qe["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Ot(Qe["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Ot(Qe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ot(Qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ot(Qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Ot(Qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Ot(Qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Ot(Qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Ot(Qe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Ot(Qe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new en(Qe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new en(Qe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Ot(Qe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Ot(Qe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Ot(Qe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Ot(Qe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new en(Qe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new en(Qe["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Ot(Qe["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new en({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new en({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new iv(s)}queryRadius(){return ft(this.paint.get("fill-extrusion-translate"))}is3D(s){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(s,e,r,l,u,c,f,x,S){const C=Mt(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),c.angle,s.pixelToTileUnitsFactor),_=this.paint.get("fill-extrusion-height").evaluate(e,r),E=this.paint.get("fill-extrusion-base").evaluate(e,r),M=[0,0],A=x&&c.elevation,D=c.elevation?c.elevation.exaggeration():1,I=s.tile.getBucket(this);if(A&&I instanceof iv){const q=I.centroidVertexArray,Y=S+1;Y<q.length&&(M[0]=q.geta_centroid_pos0(Y),M[1]=q.geta_centroid_pos1(Y))}if(M[0]===0&&M[1]===1)return!1;c.projection.name==="globe"&&(l=k0([l],[new qt(0,0),new qt(zt,zt)],s.tileID.canonical).map(q=>q.polygon).flat());const B=A?x:null,[U,G]=function(q,Y,J,ne,me,ce,ue,Ee,_e,De,Le){return q.projection.name==="globe"?function(Ne,Ge,Ve,Ke,Ze,Je,vt,_t,tn,Ct,Bt){const bt=[],xn=[],Jt=Ne.projection.upVectorScale(Bt,Ne.center.lat,Ne.worldSize).metersToTile,an=[0,0,0,1],Rn=[0,0,0,1],qn=(Vn,Fn,nr,pr)=>{Vn[0]=Fn,Vn[1]=nr,Vn[2]=pr,Vn[3]=1},On=R0();Ve>0&&(Ve+=On),Ke+=On;for(const Vn of Ge){const Fn=[],nr=[];for(const pr of Vn){const mr=pr.x+Ze.x,wn=pr.y+Ze.y,lr=Ne.projection.projectTilePoint(mr,wn,Bt),Ir=Ne.projection.upVector(Bt,pr.x,pr.y);let Kr=Ve,di=Ke;if(vt){const hi=av(mr,wn,Ve,Ke,vt,_t,tn,Ct);Kr+=hi.base,di+=hi.top}Ve!==0?qn(an,lr.x+Ir[0]*Jt*Kr,lr.y+Ir[1]*Jt*Kr,lr.z+Ir[2]*Jt*Kr):qn(an,lr.x,lr.y,lr.z),qn(Rn,lr.x+Ir[0]*Jt*di,lr.y+Ir[1]*Jt*di,lr.z+Ir[2]*Jt*di),de.vec3.transformMat4(an,an,Je),de.vec3.transformMat4(Rn,Rn,Je),Fn.push(new Wf(an[0],an[1],an[2])),nr.push(new Wf(Rn[0],Rn[1],Rn[2]))}bt.push(Fn),xn.push(nr)}return[bt,xn]}(q,Y,J,ne,me,ce,ue,Ee,_e,De,Le):ue?function(Ne,Ge,Ve,Ke,Ze,Je,vt,_t,tn){const Ct=[],Bt=[],bt=[0,0,0,1];for(const xn of Ne){const Jt=[],an=[];for(const Rn of xn){const qn=Rn.x+Ke.x,On=Rn.y+Ke.y,Vn=av(qn,On,Ge,Ve,Je,vt,_t,tn);bt[0]=qn,bt[1]=On,bt[2]=Vn.base,bt[3]=1,de.vec4.transformMat4(bt,bt,Ze),bt[3]=Math.max(bt[3],1e-5);const Fn=new Wf(bt[0]/bt[3],bt[1]/bt[3],bt[2]/bt[3]);bt[0]=qn,bt[1]=On,bt[2]=Vn.top,bt[3]=1,de.vec4.transformMat4(bt,bt,Ze),bt[3]=Math.max(bt[3],1e-5);const nr=new Wf(bt[0]/bt[3],bt[1]/bt[3],bt[2]/bt[3]);Jt.push(Fn),an.push(nr)}Ct.push(Jt),Bt.push(an)}return[Ct,Bt]}(Y,J,ne,me,ce,ue,Ee,_e,De):function(Ne,Ge,Ve,Ke,Ze){const Je=[],vt=[],_t=Ze[8]*Ge,tn=Ze[9]*Ge,Ct=Ze[10]*Ge,Bt=Ze[11]*Ge,bt=Ze[8]*Ve,xn=Ze[9]*Ve,Jt=Ze[10]*Ve,an=Ze[11]*Ve;for(const Rn of Ne){const qn=[],On=[];for(const Vn of Rn){const Fn=Vn.x+Ke.x,nr=Vn.y+Ke.y,pr=Ze[0]*Fn+Ze[4]*nr+Ze[12],mr=Ze[1]*Fn+Ze[5]*nr+Ze[13],wn=Ze[2]*Fn+Ze[6]*nr+Ze[14],lr=Ze[3]*Fn+Ze[7]*nr+Ze[15],Ir=pr+_t,Kr=mr+tn,di=wn+Ct,hi=Math.max(lr+Bt,1e-5),zr=pr+bt,ji=mr+xn,so=wn+Jt,ki=Math.max(lr+an,1e-5);qn.push(new Wf(Ir/hi,Kr/hi,di/hi)),On.push(new Wf(zr/ki,ji/ki,so/ki))}Je.push(qn),vt.push(On)}return[Je,vt]}(Y,J,ne,me,ce)}(c,l,E,_,C,f,B,M,D,c.center.lat,s.tileID.canonical),H=s.queryGeometry;return function(q,Y,J){let ne=1/0;te(J,Y)&&(ne=sv(J,Y[0]));for(let me=0;me<Y.length;me++){const ce=Y[me],ue=q[me];for(let Ee=0;Ee<ce.length-1;Ee++){const _e=ce[Ee],De=[_e,ce[Ee+1],ue[Ee+1],ue[Ee],_e];Q(J,De)&&(ne=Math.min(ne,sv(J,De)))}}return ne!==1/0&&ne}(U,G,H.isPointQuery()?H.screenBounds:H.screenGeometry)}},line:class extends Xi{constructor(s,e,r,l){const u=Gb();super(s,u,e,r,l),u.layout&&(this.layout=new Ta(u.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ls,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(s,e){super.recalculate(s,e),this.paint._values["line-floorwidth"]=(()=>{if(Ym)return Ym;const r=Gb();return Ym=new iS(r.paint.properties["line-width"].specification),Ym.useIntegerZoom=!0,Ym})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new lv(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(s,e,r){const l=L0(this);return{config:new pd(this,{zoom:e,lut:r}),defines:l,overrideFog:!1}}queryRadius(s){const e=s,r=tp(Xe("line-width",this,e),Xe("line-gap-width",this,e)),l=Xe("line-offset",this,e);return r/2+Math.abs(l)+ft(this.paint.get("line-translate"))}queryIntersectsFeature(s,e,r,l,u,c){if(s.queryGeometry.isAboveHorizon)return!1;const f=gt(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),c.angle,s.pixelToTileUnitsFactor),x=s.pixelToTileUnitsFactor/2*tp(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),S=this.paint.get("line-offset").evaluate(e,r);return S&&(l=function(C,_){const E=[],M=new qt(0,0);for(let A=0;A<C.length;A++){const D=C[A],I=[];for(let B=0;B<D.length;B++){const U=D[B],G=D[B+1],H=B===0?M:U.sub(D[B-1])._unit()._perp(),q=B===D.length-1?M:G.sub(U)._unit()._perp(),Y=H._add(q)._unit();Y._mult(1/(Y.x*q.x+Y.y*q.y)),I.push(Y._mult(_)._add(U))}E.push(I)}return E}(l,S*s.pixelToTileUnitsFactor)),function(C,_,E){for(let M=0;M<_.length;M++){const A=_[M];if(C.length>=3){for(let D=0;D<A.length;D++)if(Se(C,A[D]))return!0}if(re(C,A,E))return!0}return!1}(f,l,x)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(s){return!this.hasElevatedBuckets}},symbol:rg,background:class extends Xi{constructor(s,e,r,l){super(s,{layout:K0||(K0=new li({visibility:new Ot(Qe.layout_background.visibility)})),paint:k_||(k_=new li({"background-pitch-alignment":new Ot(Qe.paint_background["background-pitch-alignment"]),"background-color":new Ot(Qe.paint_background["background-color"]),"background-pattern":new Ot(Qe.paint_background["background-pattern"]),"background-opacity":new Ot(Qe.paint_background["background-opacity"]),"background-emissive-strength":new Ot(Qe.paint_background["background-emissive-strength"]),"background-color-use-theme":new en({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(s,e,r){return{overrideFog:!1}}is3D(s){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:N_,"raster-particle":Ph,sky:class extends Xi{constructor(s,e,r,l){super(s,{layout:zh||(zh=new li({visibility:new Ot(Qe.layout_sky.visibility)})),paint:pp||(pp=new li({"sky-type":new Ot(Qe.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ot(Qe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ot(Qe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ot(Qe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ot(Qe.paint_sky["sky-gradient-radius"]),"sky-gradient":new sd(Qe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ot(Qe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ot(Qe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ot(Qe.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new en({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new en({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new en({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="sky-gradient"?this._updateColorRamp():s!=="sky-atmosphere-sun"&&s!=="sky-atmosphere-halo-color"&&s!=="sky-atmosphere-color"&&s!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Gf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(s,e){if(this.paint.get("sky-type")==="atmosphere"){const l=this.paint.get("sky-atmosphere-sun"),u=!l,c=s.style.light,f=c.properties.get("position");return u&&c.properties.get("anchor")==="viewport"&&xe("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?mp(f.azimuthal,90-f.polar,e):mp(l[0],90-l[1],e)}const r=this.paint.get("sky-gradient-center");return mp(r[0],90-r[1],e)}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return s==="atmosphere"?["skyboxCapture","skybox"]:s==="gradient"?["skyboxGradient"]:null}},slot:class extends Xi{constructor(s,e,r,l){super(s,{paint:tx||(tx=new li({}))},e,null)}},model:class extends Xi{constructor(s,e,r,l){super(s,{layout:Td||(Td=new li({visibility:new Ot(Qe.layout_model.visibility),"model-id":new en(Qe.layout_model["model-id"])})),paint:ax||(ax=new li({"model-opacity":new en(Qe.paint_model["model-opacity"]),"model-rotation":new en(Qe.paint_model["model-rotation"]),"model-scale":new en(Qe.paint_model["model-scale"]),"model-translation":new en(Qe.paint_model["model-translation"]),"model-color":new en(Qe.paint_model["model-color"]),"model-color-mix-intensity":new en(Qe.paint_model["model-color-mix-intensity"]),"model-type":new Ot(Qe.paint_model["model-type"]),"model-cast-shadows":new Ot(Qe.paint_model["model-cast-shadows"]),"model-receive-shadows":new Ot(Qe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Ot(Qe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new en(Qe.paint_model["model-emissive-strength"]),"model-roughness":new en(Qe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new en(Qe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Ot(Qe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Ot(Qe.paint_model["model-front-cutoff"]),"model-color-use-theme":new en({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new B_(s)}getProgramIds(){return["model"]}is3D(s){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(s){return s instanceof yu?zt-1:0}queryIntersectsFeature(s,e,r,l,u,c){if(!this.modelManager)return!1;const f=this.modelManager,x=s.tile.getBucket(this);if(!(x&&x instanceof B_))return!1;for(const S in x.instancesPerModel){const C=x.instancesPerModel[S],_=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(C.idToFeaturesIndex.hasOwnProperty(_)){const E=C.features[C.idToFeaturesIndex[_]],M=f.getModel(S,this.scope);if(!M)return!1;let A=de.mat4.create();const D=new hr(0,0),I=x.canonical;let B=Number.MAX_VALUE;for(let U=0;U<E.instancedDataCount;++U){const G=16*(E.instancedDataOffset+U),H=C.instancedDataArray.float32,q=[H[G+4],H[G+5],H[G+6]];x1(I,D,H[G],0|H[G+1]),yp(A,M,c,D,E.rotation,E.scale,q,!1,!1,!1),c.projection.name==="globe"&&(A=_p(A,c));const Y=de.mat4.multiply([],c.projMatrix,A),J=s.queryGeometry,ne=nx(J.isPointQuery()?J.screenBounds:J.screenGeometry,c,Y,M.aabb);ne!=null&&(B=Math.min(ne,B))}return B!==Number.MAX_VALUE&&B}}return!1}_handleOverridablePaintPropertyUpdate(s,e,r){return!(!this.layout||e.isDataDriven()||r.isDataDriven()||s!=="model-color"&&s!=="model-color-mix-intensity"&&s!=="model-rotation"&&s!=="model-scale"&&s!=="model-translation"&&s!=="model-emissive-strength")}_isPropertyZoomDependent(s){const e=this._transitionablePaint._values[s];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Qc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Xi{constructor(s,e,r,l){super(s,{layout:yi||(yi=new li({"clip-layer-types":new Ot(Qe.layout_clip["clip-layer-types"]),"clip-layer-scope":new Ot(Qe.layout_clip["clip-layer-scope"])})),paint:Ab||(Ab=new li({}))},e,r,l)}recalculate(s,e){super.recalculate(s,e)}createBucket(s){return new hu(s)}is3D(s){return!0}}};class Lt{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class nc{constructor(){this.tasks={},this.taskQueue=[],bl(["process"],this),this.invoker=new Lt(this.process),this.nextId=0}add(e,r){const l=this.nextId++,u=function({type:c,isSymbolTile:f,zoom:x}){return x=x||0,c==="message"?0:c!=="maybePrepare"||f?c!=="parseTile"||f?c==="parseTile"&&f?300-x:c==="maybePrepare"&&f?400-x:500:200-x:100-x}(r);if(u===0){try{e()}finally{}return null}return this.tasks[l]={fn:e,metadata:r,priority:u,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let u=0;u<this.taskQueue.length;u++){const c=this.tasks[this.taskQueue[u]];c.priority<r&&(r=c.priority,e=u)}if(e===null)return null;const l=this.taskQueue[e];return this.taskQueue.splice(e,1),l}remove(){this.invoker.remove()}}class vu{constructor(e,r,l){this.target=e,this.parent=r,this.mapId=l,this.callbacks={},this.cancelCallbacks={},bl(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new nc}send(e,r,l,u,c=!1,f){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=f,this.callbacks[x]=l);const S=new Set;return this.target.postMessage({id:x,type:e,hasCallback:!!l,targetMapId:u,mustQueue:c,sourceMapId:this.mapId,data:vc(r,S)},S),{cancel:()=>{l&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(e){const r=e.data;if(!r)return;const l=r.id;if(l&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){const u=this.cancelCallbacks[l];delete this.cancelCallbacks[l],u&&u.cancel()}else if(r.mustQueue||kn()){const u=this.callbacks[l],c=this.scheduler.add(()=>this.processTask(l,r),u&&u.metadata||{type:"message"});c&&(this.cancelCallbacks[l]=c)}else this.processTask(l,r)}processTask(e,r){if(delete this.cancelCallbacks[e],r.type==="<response>"){const l=this.callbacks[e];delete this.callbacks[e],l&&(r.error?l(ms(r.error)):l(null,ms(r.data)))}else{const l=new Set,u=r.hasCallback?(f,x)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:f?vc(f):null,data:vc(x,l)},l)}:()=>{},c=ms(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,c,u);else if(this.parent.getWorkerSource){const f=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,f[0],c.source,c.scope)[f[1]](c,u)}else u(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Cd={workerUrl:"",workerClass:null,workerParams:void 0};const lg="mapboxgl_preloaded_worker_pool";class Dd{constructor(){this.active={}}acquire(e,r=Dd.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<r;)this.workers.push(Cd.workerClass!=null?new Cd.workerClass:new self.Worker(Cd.workerUrl,Cd.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[lg]}numActive(){return Object.keys(this.active).length}}Dd.workerCount=2;class bp{constructor(e,r,l="Worker",u=Dd.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=us();const c=this.workerPool.acquire(this.id,u);for(let f=0;f<c.length;f++){const x=new bp.Actor(c[f],r,this.id);x.name=`${l} ${f}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,r,l){Ua(this.actors,(u,c)=>{u.send(e,r,c)},l=l||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let wp,Ov;function gl(){return wp||(wp=new Dd),wp}bp.Actor=vu;const _l=new gr(0,0,0);var cg=(s=>(s[s.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",s[s.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",s[s.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",s))(cg||{}),q_=(s=>(s[s.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",s[s.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",s[s.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",s[s.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",s))(q_||{}),Sp=(s=>(s[s.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",s[s.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",s[s.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",s[s.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",s[s.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",s))(Sp||{}),lx=(s=>(s[s.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",s[s.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",s[s.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",s))(lx||{}),Tp=(s=>(s[s.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",s[s.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",s[s.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",s[s.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",s[s.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",s[s.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",s))(Tp||{}),cx=(s=>(s[s.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",s[s.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",s[s.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",s))(cx||{});function ux(s,e,r){s===1&&e.icons.push(function(l,u){return function(c){if(c.usvg_tree.height||(c.usvg_tree.height=c.usvg_tree.width),!c.metadata)return c;const{metadata:f}=c;if(f.content_area){const{content_area:x}=f;x.top==null&&(x.top=x.left),x.width==null&&(x.width=c.usvg_tree.width),x.height==null&&(x.height=x.width)}return f.stretch_x&&f.stretch_x.length&&dx(f,"x"),f.stretch_y&&f.stretch_y.length&&dx(f,"y"),c}(l.readFields(b1,{name:void 0},u))}(r,r.readVarint()+r.pos))}function dx(s,e){const r=[],l=s[`stretch_${e}`];let u=null;for(let c=0;c<l.length;c++)u===null?u=r.length===0?l[0]:r[r.length-1][1]+l[c]:(r.push([u,u+l[c]]),u=null);s[`stretch_${e}_areas`]=r}function b1(s,e,r){s===1?e.name=r.readString():s===2?e.metadata=function(l,u){return l.readFields(w1,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},u)}(r,r.readVarint()+r.pos):s===3&&(e.usvg_tree=function(l,u){return l.readFields(T1,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},u)}(r,r.readVarint()+r.pos),e.data="usvg_tree")}function w1(s,e,r){s===1?e.stretch_x=r.readPackedVarint():s===2?e.stretch_y=r.readPackedVarint():s===3?e.content_area=function(l,u){return l.readFields(gS,{left:0},u)}(r,r.readVarint()+r.pos):s===4&&e.variables.push(function(l,u){return l.readFields(S1,{name:void 0},u)}(r,r.readVarint()+r.pos))}function gS(s,e,r){s===1?e.left=r.readVarint():s===2?e.width=r.readVarint():s===3?e.top=r.readVarint():s===4&&(e.height=r.readVarint())}function S1(s,e,r){s===1?e.name=r.readString():s===2&&(e.rgb_color=qh(r.readVarint()),e.value="rgb_color")}function T1(s,e,r){s===1?e.width=e.height=r.readVarint():s===2?e.height=r.readVarint():s===3?e.children.push(H_(r,r.readVarint()+r.pos)):s===4?e.linear_gradients.push(function(l,u){return l.readFields(hx,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},u)}(r,r.readVarint()+r.pos)):s===5?e.radial_gradients.push(function(l,u){return l.readFields(D1,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},u)}(r,r.readVarint()+r.pos)):s===7?e.clip_paths.push(function(l,u){return l.readFields(M1,{children:[]},u)}(r,r.readVarint()+r.pos)):s===8&&e.masks.push(function(l,u){const c=l.readFields(dg,{left:0,width:20,mask_type:1,children:[]},u);return c.height==null&&(c.height=c.width),c.top==null&&(c.top=c.left),c}(r,r.readVarint()+r.pos))}function H_(s,e){return s.readFields(_S,{},e)}function _S(s,e,r){s===1?(e.group=function(l,u){return l.readFields(E1,{opacity:255,children:[]},u)}(r,r.readVarint()+r.pos),e.node="group"):s===2&&(e.path=function(l,u){return l.readFields(Vh,{paint_order:1,commands:[],step:1,diffs:[],rule:1},u)}(r,r.readVarint()+r.pos),e.node="path")}function E1(s,e,r){s===1?e.transform=Iv(r,r.readVarint()+r.pos):s===2?e.opacity=r.readVarint():s===5?e.clip_path_idx=r.readVarint():s===6?e.mask_idx=r.readVarint():s===7&&e.children.push(H_(r,r.readVarint()+r.pos))}function Iv(s,e){return s.readFields(A1,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function A1(s,e,r){s===1?e.sx=r.readFloat():s===2?e.ky=r.readFloat():s===3?e.kx=r.readFloat():s===4?e.sy=r.readFloat():s===5?e.tx=r.readFloat():s===6&&(e.ty=r.readFloat())}function Vh(s,e,r){s===1?e.fill=function(l,u){return l.readFields(ug,{rgb_color:_l,paint:"rgb_color",opacity:255},u)}(r,r.readVarint()+r.pos):s===2?e.stroke=function(l,u){return l.readFields(Ur,{rgb_color:_l,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},u)}(r,r.readVarint()+r.pos):s===3?e.paint_order=r.readVarint():s===5?r.readPackedVarint(e.commands):s===6?e.step=r.readFloat():s===7?r.readPackedSVarint(e.diffs):s===8&&(e.rule=r.readVarint())}function ug(s,e,r){s===1?(e.rgb_color=qh(r.readVarint()),e.paint="rgb_color"):s===2?(e.linear_gradient_idx=r.readVarint(),e.paint="linear_gradient_idx"):s===3?(e.radial_gradient_idx=r.readVarint(),e.paint="radial_gradient_idx"):s===5&&(e.opacity=r.readVarint())}function qh(s){return new gr((s>>16&255)/255,(s>>8&255)/255,(255&s)/255,1)}function Ur(s,e,r){s===1?(e.rgb_color=qh(r.readVarint()),e.paint="rgb_color"):s===2?(e.linear_gradient_idx=r.readVarint(),e.paint="linear_gradient_idx"):s===3?(e.radial_gradient_idx=r.readVarint(),e.paint="radial_gradient_idx"):s===5?r.readPackedFloat(e.dasharray):s===6?e.dashoffset=r.readFloat():s===7?e.miterlimit=r.readFloat():s===8?e.opacity=r.readVarint():s===9?e.width=r.readFloat():s===10?e.linecap=r.readVarint():s===11&&(e.linejoin=r.readVarint())}function hx(s,e,r){s===1?e.transform=Iv(r,r.readVarint()+r.pos):s===2?e.spread_method=r.readVarint():s===3?e.stops.push(fx(r,r.readVarint()+r.pos)):s===4?e.x1=r.readFloat():s===5?e.y1=r.readFloat():s===6?e.x2=r.readFloat():s===7&&(e.y2=r.readFloat())}function fx(s,e){return s.readFields(C1,{offset:0,opacity:255,rgb_color:_l},e)}function C1(s,e,r){s===1?e.offset=r.readFloat():s===2?e.opacity=r.readVarint():s===3&&(e.rgb_color=qh(r.readVarint()))}function D1(s,e,r){s===1?e.transform=Iv(r,r.readVarint()+r.pos):s===2?e.spread_method=r.readVarint():s===3?e.stops.push(fx(r,r.readVarint()+r.pos)):s===4?e.cx=r.readFloat():s===5?e.cy=r.readFloat():s===6?e.r=r.readFloat():s===7?e.fx=r.readFloat():s===8?e.fy=r.readFloat():s===9&&(e.fr=r.readFloat())}function M1(s,e,r){s===1?e.transform=Iv(r,r.readVarint()+r.pos):s===2?e.clip_path_idx=r.readVarint():s===3&&e.children.push(H_(r,r.readVarint()+r.pos))}function dg(s,e,r){s===1?e.left=e.top=r.readFloat():s===2?e.width=e.height=r.readFloat():s===3?e.top=r.readFloat():s===4?e.height=r.readFloat():s===5?e.mask_type=r.readVarint():s===6?e.mask_idx=r.readVarint():s===7&&e.children.push(H_(r,r.readVarint()+r.pos))}class R1{static calculate(e={},r=[]){const l=new Map,u=new Map;if(Object.keys(e).length===0)return l;r.forEach(c=>{u.set(c.name,c.rgb_color||new gr(0,0,0))});for(const[c,f]of Object.entries(e))u.has(c)?l.set(u.get(c).toStringPremultipliedAlpha(),f):console.warn(`Ignoring unknown image variable "${c}"`);return l}}function Ts(s,e=255,r){const l=e/255,u=s.toStringPremultipliedAlpha(),c=r.has(u)?r.get(u).clone():s.clone();return c.a*=l,c.toString()}function Ia(s,e){if(!Ye()){const r=document.createElement("canvas");return r.width=s,r.height=e,r}return new OffscreenCanvas(s,e)}function hg(s,e){const r=R1.calculate(e.params,s.metadata?s.metadata.variables:[]),l=s.usvg_tree,u=l.width,c=l.height,f=e.transform?e.transform:new DOMMatrix,x=Math.max(1,Math.round(u*f.a)),S=Math.max(1,Math.round(c*f.d)),C=new DOMMatrix([x/u,0,0,S/c,0,0]),_=Ia(x,S).getContext("2d");return Ep(_,C,l,l,r),_.getImageData(0,0,x,S)}function Ep(s,e,r,l,u){for(const c of l.children)Lo(s,e,r,c,u)}function Lo(s,e,r,l,u){l.group?(s.save(),function(c,f,x,S,C){const _=S.mask_idx!=null?x.masks[S.mask_idx]:null,E=S.clip_path_idx!=null?x.clip_paths[S.clip_path_idx]:null;if(S.transform&&(f=G_(S.transform).preMultiplySelf(f)),!function(D,I,B){return D.opacity!==255||I||B}(S,E!=null,_!=null))return void Ep(c,f,x,S,C);const M=Ia(c.canvas.width,c.canvas.height),A=M.getContext("2d");Ep(A,f,x,S,C),E&&xx(A,f,x,E),_&&bx(A,f,x,_,C),c.globalAlpha=S.opacity/255,c.drawImage(M,0,0)}(s,e,r,l.group,u),s.restore()):l.path&&(s.save(),function(c,f,x,S,C){const _=wx(S);c.setTransform(f),S.paint_order===lx.PAINT_ORDER_FILL_AND_STROKE?(px(c,x,S,_,C),gx(c,x,S,_,C)):(gx(c,x,S,_,C),px(c,x,S,_,C))}(s,e,r,l.path,u),s.restore())}function px(s,e,r,l,u){const c=r.fill;if(!c)return;const f=c.opacity/255;switch(c.paint){case"rgb_color":s.fillStyle=Ts(c.rgb_color,c.opacity,u);break;case"linear_gradient_idx":s.fillStyle=_x(s,e.linear_gradients[c.linear_gradient_idx],f,u);break;case"radial_gradient_idx":s.fillStyle=yx(s,e.radial_gradients[c.radial_gradient_idx],f,u)}s.fill(l,mx(r))}function mx(s){return s.rule===cg.PATH_RULE_NON_ZERO?"nonzero":s.rule===cg.PATH_RULE_EVEN_ODD?"evenodd":void 0}function gx(s,e,r,l,u){const c=r.stroke;if(!c)return;s.lineWidth=c.width,s.miterLimit=c.miterlimit,s.setLineDash(c.dasharray),s.lineDashOffset=c.dashoffset;const f=c.opacity/255;switch(c.paint){case"rgb_color":s.strokeStyle=Ts(c.rgb_color,c.opacity,u);break;case"linear_gradient_idx":s.strokeStyle=_x(s,e.linear_gradients[c.linear_gradient_idx],f,u);break;case"radial_gradient_idx":s.strokeStyle=yx(s,e.radial_gradients[c.radial_gradient_idx],f,u)}switch(c.linejoin){case Sp.LINE_JOIN_MITER_CLIP:case Sp.LINE_JOIN_MITER:s.lineJoin="miter";break;case Sp.LINE_JOIN_ROUND:s.lineJoin="round";break;case Sp.LINE_JOIN_BEVEL:s.lineJoin="bevel"}switch(c.linecap){case q_.LINE_CAP_BUTT:s.lineCap="butt";break;case q_.LINE_CAP_ROUND:s.lineCap="round";break;case q_.LINE_CAP_SQUARE:s.lineCap="square"}s.stroke(l)}function _x(s,e,r,l){if(e.stops.length===1){const M=e.stops[0];return Ts(M.rgb_color,M.opacity*r,l)}const u=G_(e.transform),{x1:c,y1:f,x2:x,y2:S}=e,C=u.transformPoint(new DOMPoint(c,f)),_=u.transformPoint(new DOMPoint(x,S)),E=s.createLinearGradient(C.x,C.y,_.x,_.y);for(const M of e.stops)E.addColorStop(M.offset,Ts(M.rgb_color,M.opacity*r,l));return E}function yx(s,e,r,l){if(e.stops.length===1){const M=e.stops[0];return Ts(M.rgb_color,M.opacity*r,l)}const u=G_(e.transform),{fx:c,fy:f,cx:x,cy:S}=e,C=u.transformPoint(new DOMPoint(c,f)),_=u.transformPoint(new DOMPoint(x,S)),E=s.createRadialGradient(C.x,C.y,0,_.x,_.y,e.r*((u.a+u.d)/2));for(const M of e.stops)E.addColorStop(M.offset,Ts(M.rgb_color,M.opacity*r,l));return E}function vx(s,e,r,l){const u=l.transform?G_(l.transform).preMultiplySelf(e):e,c=Ia(s.canvas.width,s.canvas.height),f=c.getContext("2d");for(const S of l.children)if(S.group)vx(f,u,r,S.group);else if(S.path){const C=S.path,_=new Path2D;_.addPath(wx(C),u),f.fill(_,mx(C))}const x=l.clip_path_idx!=null?r.clip_paths[l.clip_path_idx]:null;x&&xx(f,u,r,x),s.globalCompositeOperation="source-over",s.drawImage(c,0,0)}function xx(s,e,r,l){const u=Ia(s.canvas.width,s.canvas.height);vx(u.getContext("2d"),e,r,l),s.globalCompositeOperation="destination-in",s.drawImage(u,0,0)}function bx(s,e,r,l,u){if(l.children.length===0)return;const c=l.mask_idx!=null?r.masks[l.mask_idx]:null;c&&bx(s,e,r,c,u);const f=s.canvas.width,x=s.canvas.height,S=Ia(f,x),C=S.getContext("2d"),_=l.width,E=l.height,M=l.left,A=l.top,D=new Path2D,I=new Path2D;I.rect(M,A,_,E),D.addPath(I,e),C.clip(D);for(const G of l.children)Lo(C,e,r,G,u);const B=C.getImageData(0,0,f,x),U=B.data;if(l.mask_type===cx.MASK_TYPE_LUMINANCE)for(let G=0;G<U.length;G+=4)U[G+3]=U[G+3]/255*(.2126*U[G]+.7152*U[G+1]+.0722*U[G+2]);C.putImageData(B,0,0),s.globalCompositeOperation="destination-in",s.drawImage(S,0,0)}function G_(s){return s?new DOMMatrix([s.sx,s.ky,s.kx,s.sy,s.tx,s.ty]):new DOMMatrix}function wx(s){const e=new Path2D,r=s.step;let l=s.diffs[0]*r,u=s.diffs[1]*r;e.moveTo(l,u);for(let c=0,f=2;c<s.commands.length;c++)switch(s.commands[c]){case Tp.PATH_COMMAND_MOVE:l+=s.diffs[f++]*r,u+=s.diffs[f++]*r,e.moveTo(l,u);break;case Tp.PATH_COMMAND_LINE:l+=s.diffs[f++]*r,u+=s.diffs[f++]*r,e.lineTo(l,u);break;case Tp.PATH_COMMAND_QUAD:{const x=l+s.diffs[f++]*r,S=u+s.diffs[f++]*r;l=x+s.diffs[f++]*r,u=S+s.diffs[f++]*r,e.quadraticCurveTo(x,S,l,u);break}case Tp.PATH_COMMAND_CUBIC:{const x=l+s.diffs[f++]*r,S=u+s.diffs[f++]*r,C=x+s.diffs[f++]*r,_=S+s.diffs[f++]*r;l=C+s.diffs[f++]*r,u=_+s.diffs[f++]*r,e.bezierCurveTo(x,S,C,_,l,u);break}case Tp.PATH_COMMAND_CLOSE:e.closePath()}return e}class $_{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const r=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,r),r}put(e,r){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,r)}delete(e){this.cache.delete(e)}}nn($_,"LRUCache");class Z_{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new So(e,e.data)}getFromCache(e,r,l){return this.cacheMap.has(l)||this.cacheMap.set(l,new $_(150)),this.cacheMap.get(l).get(nu(e.toString(),r))}setInCache(e,r,l,u){this.cacheDependenciesMap.has(u)||this.cacheDependenciesMap.set(u,new Map),this.cacheMap.has(u)||this.cacheMap.set(u,new $_(150));const c=this.cacheDependenciesMap.get(u),f=nu(e.id.toString(),l);c.get(f)||c.set(f,new Set);const x=this.cacheMap.get(u),S=e.toString();c.get(f).add(S),x.put(nu(e.toString(),l),r)}removeImagesFromCacheByIds(e,r,l=0){if(!this.cacheMap.has(l)||!this.cacheDependenciesMap.has(l))return;const u=this.cacheMap.get(l),c=this.cacheDependenciesMap.get(l);for(const f of e){const x=nu(f.toString(),r);if(c.has(x)){for(const S of c.get(x))u.delete(S);c.delete(x)}}}rasterize(e,r,l,u,c=hg){const f=this.getFromCache(e,l,u);if(f)return f.clone();const x=c(r.icon,e.options),S=Z_._getImage(x);return this.setInCache(e,S,l,u),S.clone()}}class Nv{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const l=this.toIdx(e,r);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function Ap(s,e,r,l){let u=0,c=Number.MAX_VALUE;for(let f=0;f<3;f++)if(Math.abs(l[f])<1e-15){if(r[f]<s[f]||r[f]>e[f])return null}else{const x=1/l[f];let S=(s[f]-r[f])*x,C=(e[f]-r[f])*x;if(S>C){const _=S;S=C,C=_}if(S>u&&(u=S),C<c&&(c=C),u>c)return null}return u}function zv(s,e,r,l,u,c,f,x,S,C,_){const E=l-s,M=u-e,A=c-r,D=f-s,I=x-e,B=S-r,U=_[1]*B-_[2]*I,G=_[2]*D-_[0]*B,H=_[0]*I-_[1]*D,q=E*U+M*G+A*H;if(Math.abs(q)<1e-15)return null;const Y=1/q,J=C[0]-s,ne=C[1]-e,me=C[2]-r,ce=(J*U+ne*G+me*H)*Y;if(ce<0||ce>1)return null;const ue=ne*A-me*M,Ee=me*E-J*A,_e=J*M-ne*E,De=(_[0]*ue+_[1]*Ee+_[2]*_e)*Y;return De<0||ce+De>1?null:(D*ue+I*Ee+B*_e)*Y}function Sx(s,e,r){return(s-e)/(r-e)}function Xo(s,e,r,l,u,c,f,x,S){const C=1<<r,_=c-l,E=f-u,M=(s+1)/C*_+l,A=(e+0)/C*E+u,D=(e+1)/C*E+u;x[0]=(s+0)/C*_+l,x[1]=A,S[0]=M,S[1]=D}class Tx{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(c){const f=Math.ceil(Math.log2(c.dim/8)),x=[];let S=Math.ceil(Math.pow(2,f));const C=1/S,_=(A,D,I,B,U)=>{const G=B?1:0,H=(A+1)*I-G,q=D*I,Y=(D+1)*I-G;U[0]=A*I,U[1]=q,U[2]=H,U[3]=Y};let E=new Nv(S);const M=[];for(let A=0;A<S*S;A++){_(A%S,Math.floor(A/S),C,!1,M);const D=Md(M[0],M[1],c),I=Md(M[2],M[1],c),B=Md(M[2],M[3],c),U=Md(M[0],M[3],c);E.minimums.push(Math.min(D,I,B,U)),E.maximums.push(Math.max(D,I,B,U)),E.leaves.push(1)}for(x.push(E),S/=2;S>=1;S/=2){const A=x[x.length-1];E=new Nv(S);for(let D=0;D<S*S;D++){_(D%S,Math.floor(D/S),2,!0,M);const I=A.getElevation(M[0],M[1]),B=A.getElevation(M[2],M[1]),U=A.getElevation(M[2],M[3]),G=A.getElevation(M[0],M[3]),H=A.isLeaf(M[0],M[1]),q=A.isLeaf(M[2],M[1]),Y=A.isLeaf(M[2],M[3]),J=A.isLeaf(M[0],M[3]),ne=Math.min(I.min,B.min,U.min,G.min),me=Math.max(I.max,B.max,U.max,G.max),ce=H&&q&&Y&&J;E.maximums.push(me),E.minimums.push(ne),E.leaves.push(me-ne<=5&&ce?1:0)}x.push(E)}return x}(this.dem),l=r.length-1,u=r[l];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(r,0,0,l,0)}raycastRoot(e,r,l,u,c,f,x=1){return Ap([e,r,-100],[l,u,this.maximums[0]*x],c,f)}raycast(e,r,l,u,c,f,x=1){if(!this.nodeCount)return null;const S=this.raycastRoot(e,r,l,u,c,f,x);if(S==null)return null;const C=[],_=[],E=[],M=[],A=[{idx:0,t:S,nodex:0,nodey:0,depth:0}];for(;A.length>0;){const{idx:D,t:I,nodex:B,nodey:U,depth:G}=A.pop();if(this.leaves[D]){Xo(B,U,G,e,r,l,u,E,M);const q=1<<G,Y=(B+0)/q,J=(B+1)/q,ne=(U+0)/q,me=(U+1)/q,ce=Md(Y,ne,this.dem)*x,ue=Md(J,ne,this.dem)*x,Ee=Md(J,me,this.dem)*x,_e=Md(Y,me,this.dem)*x,De=zv(E[0],E[1],ce,M[0],E[1],ue,M[0],M[1],Ee,c,f),Le=zv(M[0],M[1],Ee,E[0],M[1],_e,E[0],E[1],ce,c,f),Ne=Math.min(De!==null?De:Number.MAX_VALUE,Le!==null?Le:Number.MAX_VALUE);if(Ne!==Number.MAX_VALUE)return Ne;{const Ge=de.vec3.scaleAndAdd([],c,f,I);if(Ex(ce,ue,_e,Ee,Sx(Ge[0],E[0],M[0]),Sx(Ge[1],E[1],M[1]))>=Ge[2])return I}continue}let H=0;for(let q=0;q<this._siblingOffset.length;q++){Xo((B<<1)+this._siblingOffset[q][0],(U<<1)+this._siblingOffset[q][1],G+1,e,r,l,u,E,M),E[2]=-100,M[2]=this.maximums[this.childOffsets[D]+q]*x;const Y=Ap(E,M,c,f);if(Y!=null){const J=Y;C[q]=J;let ne=!1;for(let me=0;me<H&&!ne;me++)J>=C[_[me]]&&(_.splice(me,0,q),ne=!0);ne||(_[H]=q),H++}}for(let q=0;q<H;q++){const Y=_[q];A.push({idx:this.childOffsets[D]+Y,t:C[Y],nodex:(B<<1)+this._siblingOffset[Y][0],nodey:(U<<1)+this._siblingOffset[Y][1],depth:G+1})}}return null}_addNode(e,r,l){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,l,u,c){if(e[u].isLeaf(r,l)===1)return;this.childOffsets[c]||(this.childOffsets[c]=this.nodeCount);const f=u-1,x=e[f];let S=0,C=0;for(let _=0;_<this._siblingOffset.length;_++){const E=2*r+this._siblingOffset[_][0],M=2*l+this._siblingOffset[_][1],A=x.getElevation(E,M),D=x.isLeaf(E,M),I=this._addNode(A.min,A.max,D);D&&(S|=1<<_),C||(C=I)}for(let _=0;_<this._siblingOffset.length;_++)S&1<<_||this._construct(e,2*r+this._siblingOffset[_][0],2*l+this._siblingOffset[_][1],f,C+_)}}function Ex(s,e,r,l,u,c){return En(En(s,r,c),En(e,l,c),u)}function Md(s,e,r){const l=r.dim,u=$n(s*l-.5,0,l-1),c=$n(e*l-.5,0,l-1),f=Math.floor(u),x=Math.floor(c),S=Math.min(f+1,l-1),C=Math.min(x+1,l-1);return Ex(r.get(f,x),r.get(S,x),r.get(f,C),r.get(S,C),u-f,c-x)}const k1={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function fg(s,e,r){return(256*s*256+256*e+r)/10-1e4}function O1(s,e,r){return 256*s+e+r/256-32768}class pg{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,l,u=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return void xe(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const c=this.dim=r.height-2,f=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.floatView=new Float32Array(r.data.buffer),this.borderReady=u,this._modifiedForSources={},!u){for(let S=0;S<c;S++)f[this._idx(-1,S)]=f[this._idx(0,S)],f[this._idx(c,S)]=f[this._idx(c-1,S)],f[this._idx(S,-1)]=f[this._idx(S,0)],f[this._idx(S,c)]=f[this._idx(S,c-1)];f[this._idx(-1,-1)]=f[this._idx(0,0)],f[this._idx(c,-1)]=f[this._idx(c-1,0)],f[this._idx(-1,c)]=f[this._idx(0,c-1)],f[this._idx(c,c)]=f[this._idx(c-1,c-1)]}const x=l==="terrarium"?O1:fg;for(let S=0;S<f.length;++S){const C=4*S;this.floatView[S]=x(this.pixels[C],this.pixels[C+1],this.pixels[C+2])}this._timestamp=ct.now()}_buildQuadTree(){this._tree=new Tx(this)}get(e,r,l=!1){l&&(e=$n(e,-1,this.dim),r=$n(r,-1,this.dim));const u=this._idx(e,r);return this.floatView[u]}set(e,r,l){const u=this._idx(e,r),c=this.floatView[u];return this.floatView[u]=l,l-c}static getUnpackVector(e){return k1[e]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}static pack(e,r){const l=[0,0,0,0],u=pg.getUnpackVector(r);let c=Math.floor((e+u[3])/u[2]);return l[2]=c%256,c=Math.floor(c/256),l[1]=c%256,c=Math.floor(c/256),l[0]=c,l}getPixels(){return new o_({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=r*this.dim,c=r*this.dim+this.dim,f=l*this.dim,x=l*this.dim+this.dim;switch(r){case-1:u=c-1;break;case 1:c=u+1}switch(l){case-1:f=x-1;break;case 1:x=f+1}const S=-r*this.dim,C=-l*this.dim;for(let _=f;_<x;_++)for(let E=u;E<c;E++){const M=4*this._idx(E,_),A=4*this._idx(E+S,_+C);this.pixels[M+0]=e.pixels[A+0],this.pixels[M+1]=e.pixels[A+1],this.pixels[M+2]=e.pixels[A+2],this.pixels[M+3]=e.pixels[A+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function Ax(s,e,r){s===1?e.headerLength=r.readFixed32():s===2?e.x=r.readVarint():s===3?e.y=r.readVarint():s===4?e.z=r.readVarint():s===5&&e.layers.push(function(l,u){return l.readFields(Cx,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},u)}(r,r.readVarint()+r.pos))}function I1(s,e,r){s===1?(e.delta_filter=function(l,u){return l.readFields(N1,{blockSize:0},u)}(r,r.readVarint()+r.pos),e.filter="delta_filter"):s===2?(r.readVarint(),e.filter="zigzag_filter"):s===3?(r.readVarint(),e.filter="bitshuffle_filter"):s===4&&(r.readVarint(),e.filter="byteshuffle_filter")}function N1(s,e,r){s===1&&(e.blockSize=r.readVarint())}function Rd(s,e,r){s===1?(r.readVarint(),e.codec="gzip_data"):s===2?(r.readVarint(),e.codec="jpeg_image"):s===3?(r.readVarint(),e.codec="webp_image"):s===4&&(r.readVarint(),e.codec="png_image")}function Co(s,e,r){let l=0,u=0;s===1?e.firstByte=r.readFixed64():s===2?e.lastByte=r.readFixed64():s===3?e.filters.push(function(c,f){return c.readFields(I1,{},f)}(r,r.readVarint()+r.pos)):s===4?e.codec=function(c,f){return c.readFields(Rd,{},f)}(r,r.readVarint()+r.pos):s===5?u=r.readFloat():s===6?l=r.readFloat():s===7?e.bands.push(r.readString()):s===8?e.offset=r.readDouble():s===9&&(e.scale=r.readDouble()),e.offset===0&&(e.offset=u),e.scale===0&&(e.scale=l)}function Cx(s,e,r){s===1?e.version=r.readVarint():s===2?e.name=r.readString():s===3?e.units=r.readString():s===4?e.tileSize=r.readVarint():s===5?e.buffer=r.readVarint():s===6?e.pixelFormat=r.readVarint():s===7&&e.dataIndex.push(function(l,u){return l.readFields(Co,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},u)}(r,r.readVarint()+r.pos))}function z1(s,e,r){if(s===2)(function(l,u,c){l.readFields(os,c,u)})(r,r.readVarint()+r.pos,e);else if(s===3)throw new Error("Not implemented")}function os(s,e,r){if(s===1){let l=0;const u=r.readVarint()+r.pos;for(;r.pos<u;)e[l++]=r.readVarint()}}function mg(s,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let r=e[3];for(let l=2;l>=1;l--){const u=l===1?1:0,c=l===2?1:0;for(let f=0;f<e[0];f++){const x=e[1]*f;for(let S=u;S<e[1];S++){const C=e[2]*(S+x);for(let _=c;_<e[2];_++){const E=e[3]*(_+C);for(let M=0;M<e[3];M++){const A=E+M;s[A]+=s[A-r]}}}}r*=e[l]}return s}function gg(s){for(let e=0,r=s.length;e<r;e++)s[e]=s[e]>>>1^-(1&s[e]);return s}function Bo(s,e){switch(e){case"uint32":return s;case"uint16":for(let r=0;r<s.length;r+=2){const l=s[r],u=s[r+1];s[r]=(240&l)>>4|(61440&l)>>8|(240&u)<<4|61440&u,s[r+1]=15&l|(3840&l)>>4|(15&u)<<8|(3840&u)<<4}return s;case"uint8":for(let r=0;r<s.length;r+=4){const l=s[r],u=s[r+1],c=s[r+2],f=s[r+3];s[r+0]=(192&l)>>6|(192&u)>>4|(192&c)>>2|192&f,s[r+1]=(48&l)>>4|(48&u)>>2|48&c|(48&f)<<2,s[r+2]=(12&l)>>2|12&u|(12&c)<<2|(12&f)<<4,s[r+3]=3&l|(3&u)<<2|(3&c)<<4|(3&f)<<6}return s;default:throw new Error(`Invalid pixel format, "${e}"`)}}nn(pg,"DEMData"),nn(Tx,"DemMinMaxQuadTree",{omit:["dem"]});var Ui=Uint8Array,va=Uint16Array,Y_=Int32Array,P1=new Ui([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),_g=new Ui([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),yS=new Ui([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),L1=function(s,e){for(var r=new va(31),l=0;l<31;++l)r[l]=e+=1<<s[l-1];var u=new Y_(r[30]);for(l=1;l<30;++l)for(var c=r[l];c<r[l+1];++c)u[c]=c-r[l]<<5|l;return{b:r,r:u}},Na=L1(P1,2),Xs=Na.b,Nc=Na.r;Xs[28]=258,Nc[258]=28;for(var kd=L1(_g,0).b,yg=new va(32768),Ri=0;Ri<32768;++Ri){var Hh=(43690&Ri)>>1|(21845&Ri)<<1;yg[Ri]=((65280&(Hh=(61680&(Hh=(52428&Hh)>>2|(13107&Hh)<<2))>>4|(3855&Hh)<<4))>>8|(255&Hh)<<8)>>1}var zc=function(s,e,r){for(var l=s.length,u=0,c=new va(e);u<l;++u)s[u]&&++c[s[u]-1];var f,x=new va(e);for(u=1;u<e;++u)x[u]=x[u-1]+c[u-1]<<1;f=new va(1<<e);var S=15-e;for(u=0;u<l;++u)if(s[u])for(var C=u<<4|s[u],_=e-s[u],E=x[s[u]-1]++<<_,M=E|(1<<_)-1;E<=M;++E)f[yg[E]>>S]=C;return f},Gh=new Ui(288);for(Ri=0;Ri<144;++Ri)Gh[Ri]=8;for(Ri=144;Ri<256;++Ri)Gh[Ri]=9;for(Ri=256;Ri<280;++Ri)Gh[Ri]=7;for(Ri=280;Ri<288;++Ri)Gh[Ri]=8;var Dx=new Ui(32);for(Ri=0;Ri<32;++Ri)Dx[Ri]=5;var Ai=zc(Gh,9),Li=zc(Dx,5),jr=function(s){for(var e=s[0],r=1;r<s.length;++r)s[r]>e&&(e=s[r]);return e},Tr=function(s,e,r){var l=e/8|0;return(s[l]|s[l+1]<<8)>>(7&e)&r},Ks=function(s,e){var r=e/8|0;return(s[r]|s[r+1]<<8|s[r+2]<<16)>>(7&e)},W_=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Es=function(s,e,r){var l=new Error(e||W_[s]);if(l.code=s,Error.captureStackTrace&&Error.captureStackTrace(l,Es),!r)throw l;return l},X_=new Ui(0),B1=typeof TextDecoder<"u"&&new TextDecoder;try{B1.decode(X_,{stream:!0})}catch{}const Mx={gzip_data:"gzip"};class As extends Error{constructor(e){super(e),this.name="MRTError"}}const K_={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},Pv={uint32:1,uint16:2,uint8:4},Cp={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let vi;class Js{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const r=this.layers[e];if(!r)throw new As(`Layer '${e}' not found`);return r}getHeaderLength(e){const r=new Uint8Array(e),l=new DataView(e);if(r[0]!==13)throw new As("File is not a valid MRT.");return l.getUint32(1,!0)}parseHeader(e){const r=new Uint8Array(e),l=this.getHeaderLength(e);if(r.length<l)throw new As(`Expected header with length >= ${l} but got buffer of length ${r.length}`);const u=function(c,f){return c.readFields(Ax,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new vi(r.subarray(0,l)));if(!isNaN(this.x)&&(this.x!==u.x||this.y!==u.y||this.z!==u.z))throw new As(`Invalid attempt to parse header ${u.z}/${u.x}/${u.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=u.x,this.y=u.y,this.z=u.z;for(const c of u.layers)this.layers[c.name]=new Od(c,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const r=[],l=this.getLayer(e.layerName);for(let u of e.blockIndices){const c=l.dataIndex[u],f=c.firstByte-e.firstByte,x=c.lastByte-e.firstByte;if(l._blocksInProgress.has(u))continue;const S={layerName:l.name,firstByte:f,lastByte:x,pixelFormat:l.pixelFormat,blockIndex:u,blockShape:[c.bands.length].concat(l.bandShape),buffer:l.buffer,codec:c.codec.codec,filters:c.filters.map(C=>C.filter)};l._blocksInProgress.add(u),r.push(S)}return new Dp(r,()=>{r.forEach(u=>l._blocksInProgress.delete(u.blockIndex))},(u,c)=>{if(r.forEach(f=>l._blocksInProgress.delete(f.blockIndex)),u)throw u;c.forEach(f=>{this.getLayer(f.layerName).processDecodedData(f)})})}}class Od{constructor({version:e,name:r,units:l,tileSize:u,pixelFormat:c,buffer:f,dataIndex:x},S){if(this.version=e,this.version!==1)throw new As(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=r,this.units=l,this.tileSize=u,this.buffer=f,this.pixelFormat=K_[c],this.dataIndex=x,this.bandShape=[u+2*f,u+2*f,Pv[this.pixelFormat]],this._decodedBlocks=new $_(S?S.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return Pv[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const r=e.blockIndex.toString();this._decodedBlocks.get(r)||this._decodedBlocks.put(r,e.data)}getBlockForBand(e){let r=0;switch(typeof e){case"string":for(const[l,u]of this.dataIndex.entries()){for(const[c,f]of u.bands.entries())if(f===e)return{bandIndex:r+c,blockIndex:l,blockBandIndex:c};r+=u.bands.length}break;case"number":for(const[l,u]of this.dataIndex.entries()){if(e>=r&&e<r+u.bands.length)return{bandIndex:e,blockIndex:l,blockBandIndex:e-r};r+=u.bands.length}break;default:throw new As(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let r=1/0,l=-1/0;const u=[],c=new Set;for(const f of e){const{blockIndex:x}=this.getBlockForBand(f);if(x<0)throw new As(`Invalid band: ${JSON.stringify(f)}`);const S=this.dataIndex[x];u.includes(x)||u.push(x),c.add(x),r=Math.min(r,S.firstByte),l=Math.max(l,S.lastByte)}if(c.size>this.cacheSize)throw new As(`Number of blocks to decode (${c.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:r,lastByte:l,blockIndices:u}}hasBand(e){const{blockIndex:r}=this.getBlockForBand(e);return r>=0}hasDataForBand(e){const{blockIndex:r}=this.getBlockForBand(e);return r>=0&&!!this._decodedBlocks.get(r.toString())}getBandView(e){const{blockIndex:r,blockBandIndex:l}=this.getBlockForBand(e);if(r<0)throw new As(`Band not found: ${JSON.stringify(e)}`);const u=this._decodedBlocks.get(r.toString());if(!u)throw new As(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const c=this.dataIndex[r],f=this.bandShape.reduce((C,_)=>C*_,1),x=l*f,S=u.subarray(x,x+f);return{data:S,bytes:new Uint8Array(S.buffer).subarray(S.byteOffset,S.byteOffset+S.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:c.offset,scale:c.scale}}}Js.setPbf=function(s){vi=s};class Dp{constructor(e,r,l){this.tasks=e,this._onCancel=r,this._onComplete=l,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,r){this._finalized||(this._onComplete(e,r),this._finalized=!0)}}Js.performDecoding=function(s,e){const r=new Uint8Array(s);return Promise.all(e.tasks.map(l=>{const{layerName:u,firstByte:c,lastByte:f,pixelFormat:x,blockShape:S,blockIndex:C,filters:_,codec:E}=l,M=r.subarray(c,f+1),A=new Uint32Array(S[0]*S[1]*S[2]);let D;if(E!=="gzip_data")throw new As(`Unhandled codec: ${E}`);return D=function(I,B){if(!globalThis.DecompressionStream&&B==="gzip_data")return Promise.resolve(((q=function(ne){ne[0]==31&&ne[1]==139&&ne[2]==8||Es(6,"invalid gzip data");var me=ne[3],ce=10;4&me&&(ce+=2+(ne[10]|ne[11]<<8));for(var ue=(me>>3&1)+(me>>4&1);ue>0;ue-=!ne[ce++]);return ce+(2&me)}(H=I))+8>H.length&&Es(6,"invalid gzip data"),function(ne,me,ce,ue){var Ee=ne.length;if(!Ee||me.f&&!me.l)return ce||new Ui(0);var _e=!ce,De=_e||me.i!=2,Le=me.i;_e&&(ce=new Ui(3*Ee));var Ne,Ge,Ve=function(Nd){var zd=ce.length;if(Nd>zd){var of=new Ui(Math.max(2*zd,Nd));of.set(ce),ce=of}},Ke=me.f||0,Ze=me.p||0,Je=me.b||0,vt=me.l,_t=me.d,tn=me.m,Ct=me.n,Bt=8*Ee;do{if(!vt){Ke=Tr(ne,Ze,1);var bt=Tr(ne,Ze+1,3);if(Ze+=3,!bt){var xn=ne[(wn=4+((Ze+7)/8|0))-4]|ne[wn-3]<<8,Jt=wn+xn;if(Jt>Ee){Le&&Es(0);break}De&&Ve(Je+xn),ce.set(ne.subarray(wn,Jt),Je),me.b=Je+=xn,me.p=Ze=8*Jt,me.f=Ke;continue}if(bt==1)vt=Ai,_t=Li,tn=9,Ct=5;else if(bt==2){var an=Tr(ne,Ze,31)+257,Rn=Tr(ne,Ze+10,15)+4,qn=an+Tr(ne,Ze+5,31)+1;Ze+=14;for(var On=new Ui(qn),Vn=new Ui(19),Fn=0;Fn<Rn;++Fn)Vn[yS[Fn]]=Tr(ne,Ze+3*Fn,7);Ze+=3*Rn;var nr=jr(Vn),pr=(1<<nr)-1,mr=zc(Vn,nr);for(Fn=0;Fn<qn;){var wn,lr=mr[Tr(ne,Ze,pr)];if(Ze+=15&lr,(wn=lr>>4)<16)On[Fn++]=wn;else{var Ir=0,Kr=0;for(wn==16?(Kr=3+Tr(ne,Ze,3),Ze+=2,Ir=On[Fn-1]):wn==17?(Kr=3+Tr(ne,Ze,7),Ze+=3):wn==18&&(Kr=11+Tr(ne,Ze,127),Ze+=7);Kr--;)On[Fn++]=Ir}}var di=On.subarray(0,an),hi=On.subarray(an);tn=jr(di),Ct=jr(hi),vt=zc(di,tn),_t=zc(hi,Ct)}else Es(1);if(Ze>Bt){Le&&Es(0);break}}De&&Ve(Je+131072);for(var zr=(1<<tn)-1,ji=(1<<Ct)-1,so=Ze;;so=Ze){var ki=(Ir=vt[Ks(ne,Ze)&zr])>>4;if((Ze+=15&Ir)>Bt){Le&&Es(0);break}if(Ir||Es(2),ki<256)ce[Je++]=ki;else{if(ki==256){so=Ze,vt=null;break}var Vi=ki-254;ki>264&&(Vi=Tr(ne,Ze,(1<<(Qs=P1[Fn=ki-257]))-1)+Xs[Fn],Ze+=Qs);var Fo=_t[Ks(ne,Ze)&ji],ho=Fo>>4;if(Fo||Es(3),Ze+=15&Fo,hi=kd[ho],ho>3){var Qs=_g[ho];hi+=Ks(ne,Ze)&(1<<Qs)-1,Ze+=Qs}if(Ze>Bt){Le&&Es(0);break}De&&Ve(Je+131072);var rf=Je+Vi;if(Je<hi){var vl=0-hi,ic=Math.min(hi,rf);for(vl+Je<0&&Es(3);Je<ic;++Je)ce[Je]=(void 0)[vl+Je]}for(;Je<rf;++Je)ce[Je]=ce[Je-hi]}}me.l=vt,me.p=so,me.b=Je,me.f=Ke,vt&&(Ke=1,me.m=tn,me.d=_t,me.n=Ct)}while(!Ke);return Je!=ce.length&&_e?(Ne=ce,((Ge=Je)==null||Ge>Ne.length)&&(Ge=Ne.length),new Ui(Ne.subarray(0,Ge))):ce.subarray(0,Je)}(H.subarray(q,-8),{i:2},new Ui(((U=H)[(G=U.length)-4]|U[G-3]<<8|U[G-2]<<16|U[G-1]<<24)>>>0))));var U,G,H,q;const Y=Mx[B];if(!Y)throw new Error(`Unhandled codec: ${B}`);const J=new globalThis.DecompressionStream(Y);return new Response(new Blob([I]).stream().pipeThrough(J)).arrayBuffer().then(ne=>new Uint8Array(ne))}(M,E).then(I=>(function(B,U){B.readFields(z1,U)}(new vi(I),A),new Cp[x](A.buffer))),D.then(I=>{for(let B=_.length-1;B>=0;B--)switch(_[B]){case"delta_filter":mg(I,S);break;case"zigzag_filter":gg(I);break;case"bitshuffle_filter":Bo(I,x);break;default:throw new As(`Unhandled filter "${_[B]}"`)}return{layerName:u,blockIndex:C,data:I}}).catch(I=>{throw I})}))},nn(Dp,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),nn(Js,"MapboxRasterTile"),nn(Od,"MapboxRasterLayer",{omit:["_blocksInProgress"]});let Mp,rc,xi,yl,xu,$h=null;function za(){return kn()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:rc||ie.DRACO_URL}function Zh(){if(kn()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(yl)return yl;const s=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return yl=WebAssembly.validate(s)?ie.MESHOPT_SIMD_URL:ie.MESHOPT_URL,yl}const Yh={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},xa={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Wh={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Lv(s,e,r){const l=r.json.bufferViews.length,u=r.buffers.length;e.bufferView=l,r.json.bufferViews[l]={buffer:u,byteLength:s.byteLength},r.buffers[u]=s}const Bv="KHR_draco_mesh_compression";function Fv(s,e){const r=s.extensions&&s.extensions[Bv];if(!r)return;const l=new xi.Decoder,u=Xh(e,r.bufferView),c=new xi.Mesh;if(!l.DecodeArrayToMesh(u,u.byteLength,c))throw new Error("Failed to decode Draco mesh");const f=e.json.accessors[s.indices],x=Yh[f.componentType],S=f.count*x.BYTES_PER_ELEMENT,C=xi._malloc(S);x===Uint16Array?l.GetTrianglesUInt16Array(c,S,C):l.GetTrianglesUInt32Array(c,S,C),Lv(xi.memory.buffer.slice(C,C+S),f,e),xi._free(C);for(const _ of Object.keys(r.attributes)){const E=l.GetAttributeByUniqueId(c,r.attributes[_]),M=e.json.accessors[s.attributes[_]],A=xa[M.componentType],D=M.count*Wh[M.type]*Yh[M.componentType].BYTES_PER_ELEMENT,I=xi._malloc(D);l.GetAttributeDataArrayForAllPoints(c,E,xi[A],D,I),Lv(xi.memory.buffer.slice(I,I+D),M,e),xi._free(I)}l.destroy(),c.destroy(),delete s.extensions[Bv]}const J_="EXT_meshopt_compression";function Q_(s,e){if(!s.extensions||!s.extensions[J_])return;const r=s.extensions[J_],l=new Uint8Array(e.buffers[r.buffer],r.byteOffset||0,r.byteLength||0),u=new Uint8Array(r.count*r.byteStride);xu.decodeGltfBuffer(u,r.count,r.byteStride,l,r.mode,r.filter),s.buffer=e.buffers.length,s.byteOffset=0,e.buffers[s.buffer]=u.buffer,delete s.extensions[J_]}const Id=1179937895,F1=new TextDecoder("utf8");function U1(s,e){return new URL(s,e).href}function vS(s,e,r,l){return fetch(U1(s.uri,l)).then(u=>u.arrayBuffer()).then(u=>{e.buffers[r]=u})}function Xh(s,e){const r=s.json.bufferViews[e];return new Uint8Array(s.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function j1(s,e,r,l){if(s.uri){const u=U1(s.uri,l);return fetch(u).then(c=>c.blob()).then(c=>createImageBitmap(c)).then(c=>{e.images[r]=c})}if(s.bufferView!==void 0){const u=Xh(e,s.bufferView),c=new Blob([u],{type:s.mimeType});return createImageBitmap(c).then(f=>{e.images[r]=f})}}function Rx(s,e=0,r){const l={json:null,images:[],buffers:[]};if(new Uint32Array(s,e,1)[0]===Id){const _=new Uint32Array(s,e);let E=2;const M=(_[E++]>>2)-3,A=_[E++]>>2;if(E++,l.json=JSON.parse(F1.decode(_.subarray(E,E+A))),E+=A,E<M){const D=_[E++];E++;const I=e+(E<<2);l.buffers[0]=s.slice(I,I+D)}}else l.json=JSON.parse(F1.decode(new Uint8Array(s,e)));const{buffers:u,images:c,meshes:f,extensionsUsed:x,bufferViews:S}=l.json;let C=Promise.resolve();if(u){const _=[];for(let E=0;E<u.length;E++){const M=u[E];M.uri?_.push(vS(M,l,E,r)):l.buffers[E]||(l.buffers[E]=null)}C=Promise.all(_)}return C.then(()=>{const _=[],E=x&&x.includes(Bv),M=x&&x.includes(J_);if(E&&_.push(function(){if(!xi)return Mp??(Mp=function(A){let D,I=null;function B(){D=new Uint8Array(I.buffer)}function U(){throw new Error("Unexpected Draco error.")}const G={a:{a:U,d:function(H,q,Y){return D.copyWithin(H,q,q+Y)},c:function(H){const q=D.length,Y=Math.max(H>>>0,Math.ceil(1.2*q)),J=Math.ceil((Y-q)/65536);try{return I.grow(J),B(),!0}catch{return!1}},b:U}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(A,G):A.then(H=>H.arrayBuffer()).then(H=>WebAssembly.instantiate(H,G))).then(H=>{const{Rb:q,Qb:Y,P:J,T:ne,X:me,Ja:ce,La:ue,Qa:Ee,Va:_e,Wa:De,eb:Le,jb:Ne,f:Ge,e:Ve,yb:Ke,zb:Ze,Ab:Je,Bb:vt,Db:_t,Gb:tn}=H.instance.exports;I=Ve;const Ct=(()=>{let Bt=0,bt=0,xn=0,Jt=0;return an=>{xn&&(q(Jt),q(Bt),bt+=xn,xn=Bt=0),Bt||(bt+=128,Bt=Y(bt));const Rn=an.length+7&-8;let qn=Bt;Rn>=bt&&(xn=Rn,qn=Jt=Y(Rn));for(let On=0;On<an.length;On++)D[qn+On]=an[On];return qn}})();return B(),Ge(),{memory:Ve,_free:q,_malloc:Y,Mesh:class{constructor(){this.ptr=J()}destroy(){ne(this.ptr)}},Decoder:class{constructor(){this.ptr=ce()}destroy(){Ne(this.ptr)}DecodeArrayToMesh(Bt,bt,xn){const Jt=Ct(Bt),an=ue(this.ptr,Jt,bt,xn.ptr);return!!me(an)}GetAttributeByUniqueId(Bt,bt){return{ptr:Ee(this.ptr,Bt.ptr,bt)}}GetTrianglesUInt16Array(Bt,bt,xn){_e(this.ptr,Bt.ptr,bt,xn)}GetTrianglesUInt32Array(Bt,bt,xn){De(this.ptr,Bt.ptr,bt,xn)}GetAttributeDataArrayForAllPoints(Bt,bt,xn,Jt,an){Le(this.ptr,Bt.ptr,bt.ptr,xn,Jt,an)}},DT_INT8:Ke(),DT_UINT8:Ze(),DT_INT16:Je(),DT_UINT16:vt(),DT_UINT32:_t(),DT_FLOAT32:tn()}})}(fetch(za())),Mp.then(A=>{xi=A,Mp=void 0}))}()),M&&_.push(function(){if(xu)return;const A=function(D){let I;const B=WebAssembly.instantiateStreaming(D,{}).then(H=>{I=H.instance,I.exports.__wasm_call_ctors()}),U={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},G={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:B,supported:!0,decodeGltfBuffer(H,q,Y,J,ne,me){(function(ce,ue,Ee,_e,De,Le,Ne){const Ge=ce.exports.sbrk,Ve=_e+3&-4,Ke=Ge(Ve*De),Ze=Ge(Le.length),Je=new Uint8Array(ce.exports.memory.buffer);Je.set(Le,Ze);const vt=ue(Ke,_e,De,Ze,Le.length);if(vt===0&&Ne&&Ne(Ke,Ve,De),Ee.set(Je.subarray(Ke,Ke+_e*De)),Ge(Ke-Ge(0)),vt!==0)throw new Error(`Malformed buffer data: ${vt}`)})(I,I.exports[G[ne]],H,q,Y,J,I.exports[U[me]])}}}(fetch(Zh()));return A.ready.then(()=>{xu=A})}()),c)for(let A=0;A<c.length;A++)_.push(j1(c[A],l,A,r));return(_.length?Promise.all(_):Promise.resolve()).then(()=>{if(E&&f)for(const{primitives:A}of f)for(const D of A)Fv(D,l);if(M&&f&&S)for(const A of S)Q_(A,l);return l})})}function Kh(s,e){const r=s.json.bufferViews[e.bufferView],l=Yh[e.componentType];return new l(s.buffers[r.buffer],(e.byteOffset||0)+(r.byteOffset||0),e.count*(r.byteStride&&r.byteStride!==Wh[e.type]*l.BYTES_PER_ELEMENT?r.byteStride/l.BYTES_PER_ELEMENT:Wh[e.type]))}function kx(s,e,r,l){const u=Yh[e.componentType],c=function(_){switch(_){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(u),f=s.json.bufferViews[e.bufferView],x=f.byteStride?f.byteStride/u.BYTES_PER_ELEMENT:Wh[e.type],S=r.float32,C=S.length/r.capacity;for(let _=0,E=0;_<e.count*x;_+=x,E+=C)for(let M=0;M<C;M++)S[E+M]=l[_+M]*c;r._trim()}function Ox(s,e,r){const l=s.indices,u=s.attributes,c={};c.indexArray=new xo;const f=e.json.accessors[l],x=f.count/3;c.indexArray.reserve(x);const S=Kh(e,f);for(let M=0;M<x;M++)c.indexArray.emplaceBack(S[3*M],S[3*M+1],S[3*M+2]);c.indexArray._trim(),c.vertexArray=new gs;const C=e.json.accessors[u.POSITION];c.vertexArray.reserve(C.count);const _=Kh(e,C);for(let M=0;M<C.count;M++)c.vertexArray.emplaceBack(_[3*M],_[3*M+1],_[3*M+2]);if(c.vertexArray._trim(),c.aabb=new fn(C.min,C.max),c.centroid=function(M,A){const D=[0,0,0],I=M.length;if(I>0){for(let B=0;B<I;B++){const U=3*M[B];D[0]+=A[U],D[1]+=A[U+1],D[2]+=A[U+2]}D[0]/=I,D[1]/=I,D[2]/=I}return D}(S,_),u.COLOR_0!==void 0){const M=e.json.accessors[u.COLOR_0],A=Wh[M.type],D=Kh(e,M);c.colorArray=A===3?new gs:new ru,c.colorArray.resize(M.count),kx(e,M,c.colorArray,D)}if(u.NORMAL!==void 0){c.normalArray=new gs;const M=e.json.accessors[u.NORMAL];c.normalArray.resize(M.count);const A=Kh(e,M);kx(e,M,c.normalArray,A)}if(u.TEXCOORD_0!==void 0&&r.length>0){c.texcoordArray=new ch;const M=e.json.accessors[u.TEXCOORD_0];c.texcoordArray.resize(M.count);const A=Kh(e,M);kx(e,M,c.texcoordArray,A)}if(u._FEATURE_ID_RGBA4444!==void 0){const M=e.json.accessors[u._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(c.featureData=Kh(e,M))}u._FEATURE_RGBA4444!==void 0&&(c.featureData=new Uint32Array(Kh(e,e.json.accessors[u._FEATURE_RGBA4444]).buffer));const E=s.material;return c.material=function(M,A){const{emissiveFactor:D=[0,0,0],alphaMode:I="OPAQUE",alphaCutoff:B=.5,normalTexture:U,occlusionTexture:G,emissiveTexture:H,doubleSided:q}=M,{baseColorFactor:Y=[1,1,1,1],metallicFactor:J=1,roughnessFactor:ne=1,baseColorTexture:me,metallicRoughnessTexture:ce}=M.pbrMetallicRoughness||{},ue=G?A[G.index]:void 0;if(G&&G.extensions&&G.extensions.KHR_texture_transform&&ue){const Ee=G.extensions.KHR_texture_transform;ue.offsetScale=[Ee.offset[0],Ee.offset[1],Ee.scale[0],Ee.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new gr(...Y),metallicFactor:J,roughnessFactor:ne,baseColorTexture:me?A[me.index]:void 0,metallicRoughnessTexture:ce?A[ce.index]:void 0},doubleSided:q,emissiveFactor:D,alphaMode:I,alphaCutoff:B,normalTexture:U?A[U.index]:void 0,occlusionTexture:ue,emissionTexture:H?A[H.index]:void 0,defined:M.defined===void 0}}(E!==void 0?e.json.materials[E]:{defined:!1},r),c}function ss(s,e,r){const{matrix:l,rotation:u,translation:c,scale:f,mesh:x,extras:S,children:C}=s,_={};if(_.matrix=l||de.mat4.fromRotationTranslationScale([],u||[0,0,0,1],c||[0,0,0],f||[1,1,1]),x!==void 0){_.meshes=r[x];const E=_.anchor=[0,0];for(const M of _.meshes){const{min:A,max:D}=M.aabb;E[0]+=A[0]+D[0],E[1]+=A[1]+D[1]}E[0]=Math.floor(E[0]/_.meshes.length/2),E[1]=Math.floor(E[1]/_.meshes.length/2)}if(S&&(S.id&&(_.id=S.id),S.lights&&(_.lights=function(E){if(!E.length)return[];const M=function(U){const G=atob(U),H=new Uint8Array(G.length);for(let q=0;q<G.length;q++)H[q]=G.codePointAt(q);return H}(E),A=[],D=M.length/24,I=new Uint16Array(M.buffer),B=new Float32Array(M.buffer);for(let U=0;U<D;U++){const G=I[2*U*6]/30,H=I[2*U*6+1]/30,q=I[2*U*6+10]/100,Y=B[6*U+1],J=B[6*U+2],ne=B[6*U+3],me=B[6*U+4],ce=ne-Y,ue=me-J,Ee=Math.hypot(ce,ue);A.push({pos:[Y+.5*ce,J+.5*ue,H],normal:[ue/Ee,-ce/Ee,0],width:Ee,height:G,depth:q,points:[Y,J,ne,me]})}return A}(S.lights))),C){const E=[];for(const M of C)E.push(ss(e.json.nodes[M],e,r));_.children=E}return _}function Jh(s){if(s.vertices.length===0||s.indices.length===0)return null;const e=new f_(s.vertices,s.indices,8,256),[r,l]=[e.min.clone(),e.max.clone()];return{vertices:s.vertices,indices:s.indices,grid:e,min:r,max:l}}function vg(s){if(!s.extras||!s.extras.ground)return null;const e=s.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const r=e[0];if(!r||!Array.isArray(r)||r.length===0)return null;const l=[];for(const f of r){if(!Array.isArray(f)||f.length!==2)continue;const x=f[0],S=f[1];typeof x=="number"&&typeof S=="number"&&l.push(new qt(x,S))}if(l.length<3)return null;l.length>1&&l[l.length-1].equals(l[0])&&l.pop();let u=0;for(let f=0;f<l.length;f++){const x=l[f],S=l[(f+1)%l.length],C=l[(f+2)%l.length];u+=(x.x-S.x)*(C.y-S.y)-(C.x-S.x)*(x.y-S.y)}u>0&&l.reverse();const c=Fm(l.flatMap(f=>[f.x,f.y]),[]);return c.length===0?null:{vertices:l,indices:c}}function Qh(s,e){const r=[],l=[];let u=0;const c=[];for(const f of s){u=r.length;const x=f.vertexArray.float32,S=f.indexArray.uint16;for(let C=0;C<f.vertexArray.length;C++)c[0]=x[3*C+0],c[1]=x[3*C+1],c[2]=x[3*C+2],de.vec3.transformMat4(c,c,e),r.push(new qt(c[0],c[1]));for(let C=0;C<3*f.indexArray.length;C++)l.push(S[C]+u)}if(l.length%3!=0)return null;for(let f=0;f<l.length;f+=3){const x=r[l[f+0]],S=r[l[f+1]],C=r[l[f+2]];(x.x-S.x)*(C.y-S.y)-(C.x-S.x)*(x.y-S.y)>0&&([l[f+1],l[f+2]]=[l[f+2],l[f+1]])}return{vertices:r,indices:l}}function Uv(s){const e=function(S,C){const _=[],E=WebGL2RenderingContext;if(S.json.textures)for(const M of S.json.textures){const A={magFilter:E.LINEAR,minFilter:E.NEAREST,wrapS:E.REPEAT,wrapT:E.REPEAT};M.sampler!==void 0&&Object.assign(A,S.json.samplers[M.sampler]),_.push({image:C[M.source],sampler:A,uploaded:!1})}return _}(s,s.images),r=function(S,C){const _=[];for(const E of S.json.meshes){const M=[];for(const A of E.primitives)M.push(Ox(A,S,C));_.push(M)}return _}(s,e),{scenes:l,scene:u,nodes:c}=s.json,f=l?l[u||0].nodes:c,x=[];for(const S of f)x.push(ss(c[S],s,r));return function(S,C,_){const E={},M=new Set;for(let A=0;A<S.length;A++){const D=_[C[A]];if(!D.extras)continue;const I=D.extras["mapbox:footprint:version"],B=D.extras["mapbox:footprint:id"];(I||B)&&M.add(A),I==="1.0.0"&&B&&(E[B]=A)}for(let A=0;A<S.length;A++){if(M.has(A))continue;const D=S[A],I=_[C[A]];if(!I.extras)continue;let B=null;D.id in E&&(B=Qh(S[E[D.id]].meshes,D.matrix)),B||(B=vg(I)),B&&(D.footprint=Jh(B))}if(M.size>0){const A=Array.from(M.values()).sort((D,I)=>D-I);for(let D=A.length-1;D>=0;D--)S.splice(A[D],1)}}(x,f,s.json.nodes),x}function Ix(s){s.heightmap=new Float32Array(4096),s.heightmap.fill(-1);const e=s.vertexArray.float32,r=s.aabb.min[0]-1,l=s.aabb.min[1]-1,u=Ed/(s.aabb.max[0]-r+2),c=Ed/(s.aabb.max[1]-l+2);for(let f=0;f<e.length;f+=3){const x=e[f+2],S=(e[f+0]-r)*u|0,C=(e[f+1]-l)*c|0;x>s.heightmap[C*Ed+S]&&(s.heightmap[C*Ed+S]=x)}}function V1(s,e){const r={};r.indexArray=new xo,r.indexArray.reserve(4*s.length),r.vertexArray=new gs,r.vertexArray.reserve(10*s.length),r.colorArray=new ru,r.vertexArray.reserve(10*s.length);let l=0;for(const f of s){const x=Math.min(10,Math.max(4,1.3*f.height))*e,S=[-f.normal[1],f.normal[0],0],C=Math.min(.29,.1*f.width/f.depth),_=f.width-2*f.depth*e*(C+.01),E=de.vec3.scaleAndAdd([],f.pos,S,_/2),M=de.vec3.scaleAndAdd([],f.pos,S,-_/2),A=[E[0],E[1],E[2]+f.height],D=[M[0],M[1],M[2]+f.height],I=de.vec3.scaleAndAdd([],f.normal,S,C);de.vec3.scale(I,I,x);const B=de.vec3.scaleAndAdd([],f.normal,S,-C);de.vec3.scale(B,B,x),de.vec3.add(I,E,I),de.vec3.add(B,M,B),E[2]+=.1,M[2]+=.1,r.vertexArray.emplaceBack(I[0],I[1],I[2]),r.vertexArray.emplaceBack(B[0],B[1],B[2]),r.vertexArray.emplaceBack(E[0],E[1],E[2]),r.vertexArray.emplaceBack(M[0],M[1],M[2]),r.vertexArray.emplaceBack(A[0],A[1],A[2]),r.vertexArray.emplaceBack(D[0],D[1],D[2]),r.vertexArray.emplaceBack(E[0],E[1],E[2]),r.vertexArray.emplaceBack(M[0],M[1],M[2]),r.vertexArray.emplaceBack(I[0],I[1],I[2]),r.vertexArray.emplaceBack(B[0],B[1],B[2]);const U=_/x/2;r.colorArray.emplaceBack(-U-C,-1,U,.8),r.colorArray.emplaceBack(U+C,-1,U,.8),r.colorArray.emplaceBack(-U,0,U,1.3),r.colorArray.emplaceBack(U,0,U,1.3),r.colorArray.emplaceBack(U+C,-.8,U,.7),r.colorArray.emplaceBack(U+C,-.8,U,.7),r.colorArray.emplaceBack(0,0,U,1.3),r.colorArray.emplaceBack(0,0,U,1.3),r.colorArray.emplaceBack(U+C,-1.2,U,.8),r.colorArray.emplaceBack(U+C,-1.2,U,.8),r.indexArray.emplaceBack(6+l,4+l,8+l),r.indexArray.emplaceBack(7+l,9+l,5+l),r.indexArray.emplaceBack(0+l,1+l,2+l),r.indexArray.emplaceBack(1+l,3+l,2+l),l+=10}const u={defined:!0,emissiveFactor:[0,0,0]},c={};return c.baseColorFactor=gr.white,u.pbrMetallicRoughness=c,r.material=u,r.aabb=new fn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}class q1{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const l=e[r];this._stringToNumber[l]=r,this._numberToString[r]=l}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const ey=["id","tile","layer","source","sourceLayer","state"];class ef{constructor(e,r,l,u,c){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=l,this._y=u,this.properties=e.properties,this.id=c}clone(){const e=new ef(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const r of ey)this[r]!==void 0&&(e[r]=this[r]);return e}}class jv{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new eu(zt,16,0),this.featureIndexArray=new Qo,this.promoteId=r,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,r,l,u,c,f=0,x=0){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,u,c,f);const C=this.grid;for(let _=0;_<r.length;_++){const E=r[_],M=[1/0,1/0,-1/0,-1/0];for(let A=0;A<E.length;A++){const D=E[A];M[0]=Math.min(M[0],D.x),M[1]=Math.min(M[1],D.y),M[2]=Math.max(M[2],D.x),M[3]=Math.max(M[3],D.y)}x!==0&&(M[0]-=x,M[1]-=x,M[2]+=x,M[3]+=x),M[0]<zt&&M[1]<zt&&M[2]>=0&&M[3]>=0&&C.insert(S,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ul.VectorTile(new Rc(this.rawTileData)).layers,this.sourceLayerCoder=new q1(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r){const{tilespaceGeometry:l,transform:u,tileTransform:c,pixelPosMatrix:f,availableImages:x}=r;this.loadVTLayers(),this.serializedLayersCache.clear();const S=l.bufferedTilespaceBounds,C=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(A,D,I,B)=>Te(l.bufferedTilespaceGeometry,A,D,I,B));C.sort(xS);let _=null;u.elevation&&C.length>0&&(_=vp.create(u.elevation,this.tileID));const E={};let M;for(let A=0;A<C.length;A++){const D=C[A];if(D===M)continue;M=D;const I=this.featureIndexArray.get(D);let B=null;this.is3DTile?this.loadMatchingModelFeature(E,I,e,l,u):this.loadMatchingFeature(E,I,e,x,(U,G,H,q=0)=>(B||(B=P(U,this.tileID.canonical,c)),G.queryIntersectsFeature(l,U,H,B,this.z,u,f,_,q)))}return E}loadMatchingFeature(e,r,l,u,c){const{featureIndex:f,bucketIndex:x,sourceLayerIndex:S,layoutVertexArrayOffset:C}=r,_=this.bucketLayerIDs[x],E=l.layers,M=Object.keys(E);if(M.length&&!function(U,G){for(let H=0;H<U.length;H++)if(G.indexOf(U[H])>=0)return!0;return!1}(M,_))return;const A=l.sourceCache,D=this.sourceLayerCoder.decode(S),I=this.vtLayers[D].feature(f),B=this.getId(I,D);for(let U=0;U<_.length;U++){const G=_[U];if(!E[G])continue;const{styleLayer:H,targets:q}=E[G];let Y={};B!==void 0&&(Y=A.getFeatureState(H.sourceLayer,B));const J=!c||c(I,H,Y,C);if(!J)continue;const ne=new ef(I,this.z,this.x,this.y,B);ne.tile=this.tileID.canonical,ne.state=Y;let me=this.serializedLayersCache.get(G);me||(me=H.serialize(),me.id=G,this.serializedLayersCache.set(G,me)),ne.source=me.source,ne.sourceLayer=me["source-layer"],ne.layer=ao({},me),ne.layer.paint=ty(me.paint,H.paint,I,Y,u),ne.layer.layout=ty(me.layout,H.layout,I,Y,u);let ce=!1;for(const ue of q){this.updateFeatureProperties(ne,ue);const{filter:Ee}=ue;if(Ee){if(I.properties=ne.properties,Ee.needGeometry){const _e=F(I,!0);if(!Ee.filter(new Hr(this.tileID.overscaledZ),_e,this.tileID.canonical))continue}else if(!Ee.filter(new Hr(this.tileID.overscaledZ),I))continue}ce=!0,ue.targetId&&this.addFeatureVariant(ne,ue)}ce&&this.appendToResult(e,G,f,ne,J)}}loadMatchingModelFeature(e,r,l,u,c){const f=this.bucketLayerIDs[0][0],x=l.layers;if(!x[f])return;const{styleLayer:S,targets:C}=x[f];if(S.type!=="model")return;const _=u.tile,E=r.featureIndex,M=_.getBucket(S);if(!(M&&M instanceof yu))return;const A=function(me,ce,ue,Ee){const _e=me.getNodesInfo()[ce];if(_e.hiddenByReplacement||!_e.node.meshes)return;let De=Number.MAX_VALUE;const Le=_e.node,Ne=ue.tile,Ge=Ee.calculatePosMatrix(Ne.tileID.toUnwrapped(),Ee.worldSize),Ve=_e.evaluatedScale;let Ke=0;Ee.elevation&&Le.elevation&&(Ke=Le.elevation*Ee.elevation.exaggeration()),de.mat4.translate(Ge,Ge,[(Le.anchor?Le.anchor[0]:0)*(Ve[0]-1),(Le.anchor?Le.anchor[1]:0)*(Ve[1]-1),Ke]),de.mat4.scale(Ge,Ge,Ve);const Ze=ue.queryGeometry,Je=Ze.isPointQuery()?Ze.screenBounds:Ze.screenGeometry,vt=function(tn){const Ct=de.mat4.multiply([],Ge,tn.matrix);de.mat4.multiply(Ct,Ee.expandedFarZProjMatrix,Ct);for(let Bt=0;Bt<tn.meshes.length;++Bt){const bt=tn.meshes[Bt];if(Bt===tn.lightMeshIndex)continue;const xn=nx(Je,Ee,Ct,bt.aabb);xn!=null&&(De=Math.min(xn,De))}if(tn.children)for(const Bt of tn.children)vt(Bt)};if(vt(Le),De===Number.MAX_VALUE)return;const _t=new hr(0,0);return x1(Ne.tileID.canonical,_t,_e.node.anchor[0],_e.node.anchor[1]),{intersectionZ:De,position:_t,feature:_e.feature}}(M,E,u,c);if(!A)return;const{z:D,x:I,y:B}=_.tileID.canonical,{feature:U,intersectionZ:G,position:H}=A;let q={};U.id!==void 0&&(q=l.sourceCache.getFeatureState(S.sourceLayer,U.id));const Y=new ef({},D,I,B,U.id);Y.tile=this.tileID.canonical,Y.state=q,Y.properties=U.properties,Y.geometry={type:"Point",coordinates:[H.lng,H.lat]};let J=this.serializedLayersCache.get(f);J||(J=S.serialize(),J.id=f,this.serializedLayersCache.set(f,J)),Y.source=J.source,Y.sourceLayer=J["source-layer"],Y.layer=ao({},J);let ne=!1;for(const me of C){this.updateFeatureProperties(Y,me);const{filter:ce}=me;if(ce){if(U.properties=Y.properties,ce.needGeometry){if(!ce.filter(new Hr(this.tileID.overscaledZ),U,this.tileID.canonical))continue}else if(!ce.filter(new Hr(this.tileID.overscaledZ),U))continue}ne=!0,me.targetId&&this.addFeatureVariant(Y,me)}ne&&this.appendToResult(e,f,E,Y,G)}updateFeatureProperties(e,r,l){if(r.properties){const u={};for(const c in r.properties){const f=r.properties[c].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,l);f!=null&&(u[c]=f)}e.properties=u}}addFeatureVariant(e,r,l){const u={target:r.target,namespace:r.namespace,uniqueFeatureID:r.uniqueFeatureID};r.properties&&(u.properties=e.properties),e.variants=e.variants||{},e.variants[r.targetId]=e.variants[r.targetId]||[],e.variants[r.targetId].push(u)}appendToResult(e,r,l,u,c){let f=e[r];f===void 0&&(f=e[r]=[]),f.push({featureIndex:l,feature:u,intersectionZ:c})}lookupSymbolFeatures(e,r,l,u,c){const f={};this.loadVTLayers();for(const x of e)this.loadMatchingFeature(f,{bucketIndex:r,sourceLayerIndex:l,featureIndex:x,layoutVertexArrayOffset:0},u,c);return f}loadFeature(e){const{featureIndex:r,sourceLayerIndex:l}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(l),c=this.vtFeatures[u];if(c[r])return c[r];const f=this.vtLayers[u].feature(r);return c[r]=f,f}hasLayer(e){for(const r of this.bucketLayerIDs)for(const l of r)if(e===l)return!0;return!1}getId(e,r){let l=e.id;if(this.promoteId){const u=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[r];if(u!=null)if(Array.isArray(u)){if(!this.promoteIdExpression){const c=Jc(u);if(c.result!=="success"){const f=c.value.map(x=>`${x.key}: ${x.message}`).join(", ");return void xe(`Failed to create expression for promoteId: ${f}`)}this.promoteIdExpression=c.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Ps),l=this.promoteIdExpression.evaluate({zoom:0},e)}else l=e.properties[u];typeof l=="boolean"&&(l=Number(l))}return l}}function ty(s,e,r,l,u){return ks(s,(c,f)=>{const x=e instanceof Ta?e.get(f):null;return x&&x.evaluate?x.evaluate(r,l,u):x})}function xS(s,e){return e-s}nn(jv,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const tf=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Rp{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,l]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=l>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const c=tf[15&l];if(!c)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(e,2,1),[x]=new Uint32Array(e,4,1);return new Rp(x,f,c,e)}constructor(e,r=64,l=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const c=tf.indexOf(this.ArrayType),f=2*e*this.ArrayType.BYTES_PER_ELEMENT,x=e*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-x%8)%8;if(c<0)throw new Error(`Unexpected typed array class: ${l}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+S,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+f+x+S),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+S,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+c]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=r,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return nf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,l,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:f,nodeSize:x}=this,S=[0,c.length-1,0],C=[];for(;S.length;){const _=S.pop()||0,E=S.pop()||0,M=S.pop()||0;if(E-M<=x){for(let B=M;B<=E;B++){const U=f[2*B],G=f[2*B+1];U>=e&&U<=l&&G>=r&&G<=u&&C.push(c[B])}continue}const A=M+E>>1,D=f[2*A],I=f[2*A+1];D>=e&&D<=l&&I>=r&&I<=u&&C.push(c[A]),(_===0?e<=D:r<=I)&&(S.push(M),S.push(A-1),S.push(1-_)),(_===0?l>=D:u>=I)&&(S.push(A+1),S.push(E),S.push(1-_))}return C}within(e,r,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:c,nodeSize:f}=this,x=[0,u.length-1,0],S=[],C=l*l;for(;x.length;){const _=x.pop()||0,E=x.pop()||0,M=x.pop()||0;if(E-M<=f){for(let B=M;B<=E;B++)H1(c[2*B],c[2*B+1],e,r)<=C&&S.push(u[B]);continue}const A=M+E>>1,D=c[2*A],I=c[2*A+1];H1(D,I,e,r)<=C&&S.push(u[A]),(_===0?e-l<=D:r-l<=I)&&(x.push(M),x.push(A-1),x.push(1-_)),(_===0?e+l>=D:r+l>=I)&&(x.push(A+1),x.push(E),x.push(1-_))}return S}}function nf(s,e,r,l,u,c){if(u-l<=r)return;const f=l+u>>1;ny(s,e,f,l,u,c),nf(s,e,r,l,f-1,1-c),nf(s,e,r,f+1,u,1-c)}function ny(s,e,r,l,u,c){for(;u>l;){if(u-l>600){const C=u-l+1,_=r-l+1,E=Math.log(C),M=.5*Math.exp(2*E/3),A=.5*Math.sqrt(E*M*(C-M)/C)*(_-C/2<0?-1:1);ny(s,e,r,Math.max(l,Math.floor(r-_*M/C+A)),Math.min(u,Math.floor(r+(C-_)*M/C+A)),c)}const f=e[2*r+c];let x=l,S=u;for(xg(s,e,l,r),e[2*u+c]>f&&xg(s,e,l,u);x<S;){for(xg(s,e,x,S),x++,S--;e[2*x+c]<f;)x++;for(;e[2*S+c]>f;)S--}e[2*l+c]===f?xg(s,e,l,S):(S++,xg(s,e,S,u)),S<=r&&(l=S+1),r<=S&&(u=S-1)}}function xg(s,e,r,l){Vv(s,r,l),Vv(e,2*r,2*l),Vv(e,2*r+1,2*l+1)}function Vv(s,e,r){const l=s[e];s[e]=s[r],s[r]=l}function H1(s,e,r,l){const u=s-r,c=e-l;return u*u+c*c}a.$=Ci,a.A=hs,a.B=Ha,a.C=nu,a.D=bp,a.E=Is,a.F=2,a.G=w_,a.H=l1,a.I=go,a.J=class extends uo{},a.K=$a,a.L=or,a.M=_m,a.N=um,a.O=Yu,a.P=qt,a.Q=Cf,a.R=io,a.S=Rf,a.T=Eo,a.U=oh,a.V=uo,a.W=Qd,a.X=Jc,a.Y=Yd,a.Z=el,a._=Vu,a.a=function(s){return ie.API_CDN_URL_REGEX.test(s)},a.a$=F,a.a0=aa,a.a1=Nf,a.a2=dm,a.a3=yc,a.a4=function(s){const e=s.value;let r=[];if(!e)return r;const l=$a(e);return l!=="string"?(r=r.concat([new uo(s.key,e,`string expected, "${l}" found`)]),r):(ix(e,!0)||(r=r.concat([new uo(s.key,e,`invalid url "${e}"`)])),r)},a.a5=Qe,a.a6=rh,a.a7=li,a.a8=Ot,a.a9=class{constructor(s){this.specification=s}possiblyEvaluate(s,e){return Sn(s.expression.evaluate(e))}interpolate(s,e,r){return{x:En(s.x,e.x,r),y:En(s.y,e.y,r),z:En(s.z,e.z,r),azimuthal:En(s.azimuthal,e.azimuthal,r),polar:En(s.polar,e.polar,r)}}},a.aA=function(s,e){const r={};for(let l=0;l<e.length;l++){const u=e[l];u in s&&(r[u]=s[u])}return r},a.aB=Ec,a.aC=Ki,a.aD=class{constructor(s){this.entries={},this.scheduler=s}request(s,e,r,l){const u=this.entries[s]=this.entries[s]||{callbacks:[]};if(u.result){const[c,f]=u.result;return this.scheduler?this.scheduler.add(()=>{l(c,f)},e):l(c,f),()=>{}}return u.callbacks.push(l),u.cancel||(u.cancel=r((c,f)=>{u.result=[c,f];for(const x of u.callbacks)this.scheduler?this.scheduler.add(()=>{x(c,f)},e):x(c,f);setTimeout(()=>delete this.entries[s],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(c=>c!==l),u.callbacks.length||(u.cancel(),delete this.entries[s]))}}},a.aE=function(s,e,r){const l=JSON.stringify(s.request);return s.data&&(this.deduped.entries[l]={result:[null,s.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},u=>{const c=Va(s.request,(f,x,S,C)=>{f?u(f):x&&u(null,{vectorTile:r?void 0:new ul.VectorTile(new Rc(x)),rawData:x,cacheControl:S,expires:C})});return()=>{c.cancel(),u()}},e)},a.aF=function(s){Ar++,Ar>jn&&(s.getActor().send("enforceCacheSizeLimit",Nn),Ar=0)},a.aG=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},a.aH=dt,a.aI=N_,a.aJ=Ph,a.aK=Nh,a.aL=function(s,e){const r=document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let l=0;l<s.length;l++){const u=document.createElement("source");Eu(s[l])||(r.crossOrigin="Anonymous"),u.src=s[l],r.appendChild(u)}return{cancel:()=>{}}},a.aM=Sd,a.aN=function(s){return fetch(s).then(e=>e.arrayBuffer()).then(e=>Rx(e,0,s))},a.aO=Uv,a.aP=class{constructor(s,e,r,l){this.id=s,this.position=e!=null?new hr(e[0],e[1]):new hr(0,0),this.orientation=r??[0,0,0],this.nodes=l,this.uploaded=!1,this.aabb=new fn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(s,e){if(de.mat4.multiply(s.matrix,e,s.matrix),s.meshes)for(const r of s.meshes){const l=fn.applyTransformFast(r.aabb,s.matrix);this.aabb.encapsulate(l)}if(s.children)for(const r of s.children)this._applyTransformations(r,s.matrix)}computeBoundsAndApplyParent(){const s=de.mat4.identity([]);for(const e of this.nodes)this._applyTransformations(e,s)}computeModelMatrix(s,e,r,l,u,c,f=!1){yp(this.matrix,this,s.transform,this.position,e,r,l,u,c,f)}upload(s){if(!this.uploaded){for(const e of this.nodes)kv(e,s);for(const e of this.nodes)F_(e);this.uploaded=!0}}destroy(){for(const s of this.nodes)U_(s)}},a.aQ=bl,a.aR=up,a.aS=vs,a.aT=Sr,a.aU=sl,a.aV=xo,a.aW=us,a.aX=mh,a.aY=ng,a.aZ=function(){vo.isLoading()||vo.isLoaded()||nd()!=="deferred"||jg()},a.a_=Vg,a.aa=Hr,a.ab=Qc,a.ac=t,a.ad=de,a.ae=mo,a.af=Ta,a.ag=Yo,a.ah=En,a.ai=zt,a.aj=vy,a.ak=Jn,a.al=gr,a.am=class{constructor(s){this.specification=s}possiblyEvaluate(s,e){return function([r,l]){const u=Sn([1,r,l]);return{x:u.x,y:u.y,z:u.z}}(s.expression.evaluate(e))}interpolate(s,e,r){return{x:En(s.x,e.x,r),y:En(s.y,e.y,r),z:En(s.z,e.z,r)}}},a.an=function(s,e,r=0,l=!0){const u=new qt(r,r),c=s.sub(u),f=e.add(u),x=[c,new qt(f.x,c.y),f,new qt(c.x,f.y)];return l&&x.push(c.clone()),x},a.ao=function(s,e){const r=[];for(let l=0;l<s.length;l++){const u=Fa(l-1,-1,s.length-1),c=Fa(l+1,-1,s.length-1),f=s[l],x=s[c],S=s[u].sub(f).unit(),C=x.sub(f).unit(),_=C.angleWithSep(S.x,S.y),E=S.add(C).unit().mult(-1*e/Math.sin(_/2));r.push(f.add(E))}return r},a.ap=Oh,a.aq=Te,a.ar=function(s,e,r=0){return de.vec3.fromValues(((e.x-r)*s.scale-s.x)*zt,(e.y*s.scale-s.y)*zt,qf(e.z,e.y))},a.as=Mn,a.at=Hb,a.au=function(s){let e=1/0,r=1/0,l=-1/0,u=-1/0;for(const c of s)e=Math.min(e,c.x),r=Math.min(r,c.y),l=Math.max(l,c.x),u=Math.max(u,c.y);return{min:new qt(e,r),max:new qt(l,u)}},a.av=ll,a.aw=Se,a.ax=d,a.ay=$n,a.az=Zo,a.b=function(s){return ie.API_FONTS_REGEX.test(s)},a.b$=Lh,a.b0=ef,a.b1=br,a.b2=lv,a.b3=x0,a.b4=P,a.b5=Pl,a.b6=dh,a.b7=bn,a.b8=ri,a.b9=Fm,a.bA=$s,a.bB=bv,a.bC=cp,a.bD=V0,a.bE=Rp,a.bF=Fa,a.bG=Br,a.bH=bo,a.bI=function(s,e,r){s[4*e+0]=r[0],s[4*e+1]=r[1],s[4*e+2]=r[2],s[4*e+3]=r[3]},a.bJ=au,a.bK=Go,a.bL=fd,a.bM=Ti,a.bN=_h,a.bO=hr,a.bP=Ih,a.bQ=st,a.bR=Pn,a.bS=sg,a.bT=yt,a.bU=Fi,a.bV=function(s,e,r,l,u,c,f,x,S){if(S.name==="globe")return Fi(s,e,new yt(r,l,u),!1);const C=up({z:r,x:l,y:u},S);return new fn([(c+C.x/C.scale)*e,e*(C.y/C.scale),f],[(c+C.x2/C.scale)*e,e*(C.y2/C.scale),x])},a.bW=function(s,e,r){let l=0;for(let u=0;u<2;++u)s[u]>0&&(l+=(s[u]-0)*(s[u]-0)),e[u]<0&&(l+=(0-e[u])*(0-e[u]));return l},a.bX=xs,a.bY=km,a.bZ=function(s){const e=de.mat4.identity(new Float64Array(16));de.mat4.multiply(e,s.pixelMatrix,s.globeMatrix);const r=[0,Vs,0],l=[0,qs,0];return de.vec3.transformMat4(r,r,e),de.vec3.transformMat4(l,l,e),[r[0]>0&&r[0]<=s.width&&r[1]>0&&r[1]<=s.height&&!Pi(s,new hr(s.center.lat,90)),l[0]>0&&l[0]<=s.width&&l[1]>0&&l[1]<=s.height&&!Pi(s,new hr(s.center.lat,-90))]},a.b_=function(s,e){const{scale:r}=s.tileTransform,l=r*zt/(s.tileSize*Math.pow(2,e.zoom-s.tileID.overscaledZ+s.tileID.canonical.z));return de.mat2.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[l,l])},a.ba=J0,a.bb=function(s,e){const r=Yo(e.zoom);if(r===0)return Ji(s);const l=fr(s),u=ui(l),c=ll(l.getWest())*e.worldSize,f=ll(l.getEast())*e.worldSize,x=Ki(l.getNorth())*e.worldSize,S=Ki(l.getSouth())*e.worldSize,C=[c,x,0],_=[f,x,0],E=[c,S,0],M=[f,S,0],A=de.mat4.invert([],e.globeMatrix);return de.vec3.transformMat4(C,C,A),de.vec3.transformMat4(_,_,A),de.vec3.transformMat4(E,E,A),de.vec3.transformMat4(M,M,A),u[0]=Qi(u[0],E,r),u[1]=Qi(u[1],M,r),u[2]=Qi(u[2],_,r),u[3]=Qi(u[3],C,r),fn.fromPoints(u)},a.bc=ii,a.bd=xr,a.be=Qi,a.bf=Bs,a.bg=In,a.bh=Js,a.bi=Rc,a.bj=Va,a.bk=function(s,e){const r=[];for(const l in s)l in e||r.push(l);return r},a.bl=Ua,a.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.bn=cs,a.bo=function(s,e){const{x:r,y:l}=s.point,u=ka(r,l,s.worldSize/s._pixelsPerMercatorPixel,0,0);return de.mat4.multiply(u,u,eo(Ji(e)))},a.bp=np,a.bq=_a,a.br=ns,a.bs=function(s,e,r,l,u){const c=5*e+2;s.float32[c+0]=r,s.float32[c+1]=l,s.float32[c+2]=u},a.bt=Xl,a.bu=q0,a.bv=Q,a.bw=$i,a.bx=Xf,a.by=is,a.bz=Hl,a.c=we,a.c$=L0,a.c0=og,a.c1=function(s){const e=og(s,!0);return de.mat2.invert([],[e[0],e[1],e[4],e[5]])},a.c2=tr,a.c3=function(s){const{x:e,y:r}=s.point,{lng:l,lat:u}=s._center;return ka(e,r,s.worldSize,l,u)},a.c4=Wi,a.c5=Ht,a.c6=cu,a.c7=function(s){const e=Math.round((s+45+360)%360/90)%4;return dr[e]},a.c8=45,a.c9=xy,a.cA=vh,a.cB=class extends _s{constructor(s){super(s),this.current=Mm}set(s,e,r){if(this.fetchUniformLocation(s,e)){for(let l=0;l<9;l++)if(r[l]!==this.current[l]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},a.cC=ea,a.cD=function(s,e,r){const l=Yo(r.zoom),u=s.style.map._antialias,c=s.terrain&&s.terrain.exaggeration()>0;return l===0&&!u&&!c},a.cE=function(s){const e=s.pixelsPerMeter,r=e/bo(1,s.center.lat),l=de.mat4.identity(new Float64Array(16));return de.mat4.translate(l,l,[s.point.x,s.point.y,0]),de.mat4.scale(l,l,[r,r,e]),Float32Array.from(l)},a.cF=fr,a.cG=function(s){const e=xs-5;s=$n(s,-80.051129,e)/e*90;const r=Math.pow(Math.abs(Math.sin(Jn(s))),3);return Math.round(r*(Om.length-1))},a.cH=function(s,e,r,l){const u=e.getNorth(),c=e.getSouth(),f=e.getWest(),x=e.getEast(),S=1<<s.z,C=x-f,_=u-c,E=C/wh,M=-_/Om[r],A=[0,E,0,M,0,0,u,f,0];if(s.z>0){const D=180/l;de.mat3.multiply(A,A,[D/C+1,0,0,0,D/_+1,0,-.5*D/E,.5*D/M,1])}return A[2]=S,A[5]=s.x,A[8]=s.y,A},a.cI=Ji,a.cJ=function(s,e,r){const l=de.mat4.identity(new Float64Array(16)),u=(e/(1<<s)-.5)*Math.PI*2;return de.mat4.rotateY(l,r.globeMatrix,u),Float32Array.from(l)},a.cK=class{isDataAvailableAtPoint(s){const e=this._source();if(this.isUsingMockSource()||!e||s.y<0||s.y>1)return!1;const r=e.getSource().maxzoom,l=1<<r,u=Math.floor(s.x),c=Math.floor((s.x-u)*l),f=Math.floor(s.y*l),x=this.findDEMTileFor(new dt(r,u,r,c,f));return!(!x||!x.dem)}getAtPointOrZero(s,e=0){return this.getAtPoint(s,e)||0}getAtPoint(s,e,r=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const l=this._source();if(!l||s.y<0||s.y>1)return e;const u=l.getSource().maxzoom,c=1<<u,f=Math.floor(s.x),x=s.x-f,S=new dt(u,f,u,Math.floor(x*c),Math.floor(s.y*c)),C=this.findDEMTileFor(S);if(!C||!C.dem)return e;const _=C.dem,E=1<<C.tileID.canonical.z,M=(x*E-C.tileID.canonical.x)*_.dim,A=(s.y*E-C.tileID.canonical.y)*_.dim,D=Math.floor(M),I=Math.floor(A);return(r?this.exaggeration():1)*En(En(_.get(D,I),_.get(D,I+1),A-I),En(_.get(D+1,I),_.get(D+1,I+1),A-I),M-D)}getAtTileOffset(s,e,r){const l=1<<s.canonical.z;return this.getAtPointOrZero(new t(s.wrap+(s.canonical.x+e/zt)/l,(s.canonical.y+r/zt)/l))}getAtTileOffsetFunc(s,e,r,l){return u=>{const c=this.getAtTileOffset(s,u.x,u.y),f=l.upVector(s.canonical,u.x,u.y),x=l.upVectorScale(s.canonical,e,r).metersToTile;return de.vec3.scale(f,f,c*x),f}}getForTilePoints(s,e,r,l){if(this.isUsingMockSource())return!1;const u=vp.create(this,s,l);return!!u&&(e.forEach(c=>{c[2]=this.exaggeration()*u.getElevationAt(c[0],c[1],r)}),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(s);if(!e||!e.dem)return null;const r=e.dem.tree,l=e.tileID,u=1<<s.canonical.z-l.canonical.z;let c=s.canonical.x/u-l.canonical.x,f=s.canonical.y/u-l.canonical.y,x=0;for(let S=0;S<s.canonical.z-l.canonical.z&&!r.leaves[x];S++){c*=2,f*=2;const C=2*Math.floor(f)+Math.floor(c);x=r.childOffsets[x]+C,c%=1,f%=1}return{min:this.exaggeration()*r.minimums[x],max:this.exaggeration()*r.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const s=this.visibleDemTiles;if(s.length===0)return null;let e=!1,r=Number.MAX_VALUE,l=Number.MIN_VALUE;for(const u of s){const c=this.getMinMaxForTile(u.tileID);c&&(r=Math.min(r,c.min),l=Math.max(l,c.max),e=!0)}return e?{min:r,max:l}:null}},a.cL=o_,a.cM=ar,a.cN=function(s,e){return[Math.pow(s[0],2.2)*e,Math.pow(s[1],2.2)*e,Math.pow(s[2],2.2)*e]},a.cO=Hs,a.cP=ut,a.cQ=ia,a.cR=256,a.cS=function(s,e){const r=[0,0,0],l=ii(Ji(e.canonical));return de.vec3.transformMat4(r,r,l),de.vec3.transformMat4(r,r,s),r},a.cT=s=>({u_camera_to_center_distance:new Ti(s),u_extrude_scale:new Jg(s),u_device_pixel_ratio:new Ti(s),u_matrix:new au(s),u_inv_rot_matrix:new au(s),u_merc_center:new Go(s),u_tile_id:new fd(s),u_zoom_transition:new Ti(s),u_up_dir:new fd(s),u_emissive_strength:new Ti(s)}),a.cU=s=>({u_matrix:new au(s),u_pixels_to_tile_units:new Jg(s),u_device_pixel_ratio:new Ti(s),u_width_scale:new Ti(s),u_floor_width_scale:new Ti(s),u_units_to_pixels:new Go(s),u_dash_image:new _h(s),u_gradient_image:new _h(s),u_image_height:new Ti(s),u_texsize:new Go(s),u_tile_units_to_pixels:new Ti(s),u_alpha_discard_threshold:new Ti(s),u_trim_offset:new Go(s),u_trim_fade_range:new Go(s),u_trim_color:new yh(s),u_emissive_strength:new Ti(s),u_zbias_factor:new Ti(s),u_tile_to_meter:new Ti(s)}),a.cV=s=>({u_matrix:new au(s),u_texsize:new Go(s),u_pixels_to_tile_units:new Jg(s),u_device_pixel_ratio:new Ti(s),u_width_scale:new Ti(s),u_floor_width_scale:new Ti(s),u_image:new _h(s),u_units_to_pixels:new Go(s),u_tile_units_to_pixels:new Ti(s),u_alpha_discard_threshold:new Ti(s),u_trim_offset:new Go(s),u_trim_fade_range:new Go(s),u_trim_color:new yh(s),u_emissive_strength:new Ti(s),u_zbias_factor:new Ti(s),u_tile_to_meter:new Ti(s)}),a.cW=Pf,a.cX=Wb,a.cY=sS,a.cZ=Th,a.c_=(s,e,r,l,u,c)=>{const f=s.transform,x=f.projection.name==="globe";let S;if(c.paint.get("circle-pitch-alignment")==="map")if(x){const _=Hs(f.zoom,e.canonical)*f._pixelsPerMercatorPixel;S=Float32Array.from([_,0,0,_])}else S=f.calculatePixelsToTileUnitsMatrix(r);else S=new Float32Array([f.pixelsToGLUnits[0],0,0,f.pixelsToGLUnits[1]]);const C={u_camera_to_center_distance:s.transform.getCameraToCenterDistance(f.projection),u_matrix:s.translatePosMatrix(e.projMatrix,r,c.paint.get("circle-translate"),c.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ct.devicePixelRatio,u_extrude_scale:S,u_inv_rot_matrix:zm,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:c.paint.get("circle-emissive-strength")};if(x){C.u_inv_rot_matrix=l,C.u_merc_center=u,C.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],C.u_zoom_transition=Yo(f.zoom);const _=u[0]*zt,E=u[1]*zt;C.u_up_dir=f.projection.upVector(new yt(0,0,0),_,E)}return C},a.ca=Nm,a.cb=yh,a.cc=function(s,e,r){const l=Math.sqrt(s*s+e*e+r*r),u=l>0?Math.acos(r/l)*Do:0;let c=s!==0||e!==0?Math.atan2(-e,-s)*Do+90:0;return c<0&&(c+=360),[l,c,u]},a.cd=h,a.ce=fn,a.cf=Sn,a.cg=function(s){return[Math.pow(s[0],1/2.2),Math.pow(s[1],1/2.2),Math.pow(s[2],1/2.2)]},a.ch=function(s,e){return s.readFields(ux,{icons:[]},e)},a.ci=function(s){return s({pluginStatus:No,pluginURL:rl}),bc.on("pluginStateChange",s),s},a.cj=gl,a.ck=Rh,a.cl=_v,a.cm=ja,a.cn=xc,a.co=Qt,a.cp=Os,a.cq=qi,a.cr=function(s){const e=s.indexOf(sh);return e>=0?s.slice(0,e):s},a.cs=function(s){return s.indexOf(sh)>=0},a.ct=function(s){const e=s.indexOf(sh);return e>=0?s.slice(e+1):""},a.cu=function(s){const e=[],r=s.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),s.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},a.cv=function(s,e,r,l){return s.type==="custom"?new Ic(s,e):new mS[s.type](s,e,r,l)},a.cw=jo,a.cx=class extends ef{constructor(s,e){super(s._vectorTileFeature,s._z,s._x,s._y,s.id),s.state&&(this.state=Object.assign({},s.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=s.source,this.sourceLayer=s.sourceLayer,this.layer=s.layer)}toJSON(){const s=super.toJSON();return s.target=this.target,s.namespace=this.namespace,s}},a.cy=bc,a.cz=Ro,a.d=function(s){return ie.API_TILEJSON_REGEX.test(s)},a.d$=q1,a.d0=Oo,a.d1=(s,e,r,l,u,c,f,x)=>{const S=s.transform,C=S.pitch<15?P0(.07,.7,$n((14-S.zoom)/5,0,1)):.07,_=r.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:cv(s,e,r,l),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:S.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:u,u_width_scale:c,u_floor_width_scale:f,u_image:0,u_tile_units_to_pixels:g_(e,S),u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:x,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toRenderColor(_?null:r.lut).toArray01(),u_emissive_strength:r.paint.get("line-emissive-strength"),u_zbias_factor:C,u_tile_to_meter:h(e.tileID.canonical,0)}},a.d2=(s,e,r,l,u,c,f,x,S)=>{const C=s.transform,_=C.calculatePixelsToTileUnitsMatrix(e),E=r.paint.get("line-trim-color-use-theme").constantOr("default")==="none",M=C.pitch<15?P0(.07,.7,$n((14-C.zoom)/5,0,1)):.07;return{u_matrix:cv(s,e,r,l),u_pixels_to_tile_units:_,u_device_pixel_ratio:c,u_width_scale:f,u_floor_width_scale:x,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:u,u_texsize:B0(r)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:g_(e,s.transform),u_alpha_discard_threshold:0,u_trim_offset:S,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toRenderColor(E?null:r.lut).toArray01(),u_emissive_strength:r.paint.get("line-emissive-strength"),u_zbias_factor:M,u_tile_to_meter:h(e.tileID.canonical,0)}},a.d3=lc,a.d4=Gf,a.d5=qf,a.d6=R0,a.d7=kt,a.d8=iv,a.d9=ga,a.dA=Hm,a.dB=Rs,a.dC=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},a.dD=ta,a.dE=r0,a.dF=Ma,a.dG=function([s,e,r]){const l=Math.hypot(s,e,r),u=Math.atan2(s,r),c=.5*Math.PI-Math.acos(-e/l);return new hr(Wi(u),Wi(c))},a.dH=gp,a.dI=function(s){const e=s.navigator?s.navigator.userAgent:null;return!!function(r){if(wr==null){const l=r.navigator?r.navigator.userAgent:null;wr=!!r.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return wr}(s)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},a.dJ=function(s,e){Nn=s,jn=e},a.dK=Pi,a.dL=Oa,a.dM=function(s){const e=[0,0,0],r=de.mat4.identity(new Float64Array(16));return de.mat4.multiply(r,s.pixelMatrix,s.globeMatrix),de.vec3.transformMat4(e,e,r),new qt(e[0],e[1])},a.dN=function(s,e,r=!1){if(No===nh||No===nl||No===gm)throw new Error("setRTLTextPlugin cannot be called multiple times.");rl=ct.resolveURL(s),No=nh,yo=e,td(),r||jg()},a.dO=nd,a.dP=function(){gl().acquire(lg)},a.dQ=function(){const s=wp;s&&(s.isPreloaded()&&s.numActive()===1?(s.release(lg),wp=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},a.dR=Dd,a.dS=function(s){const e=si();if(!e)return;const r=e.delete(on);s&&r.catch(s).then(()=>s())},a.dT=Cd,a.dU=za,a.dV=function(s){rc=ct.resolveURL(s),$h||($h=new bp(gl(),new Is)),$h.broadcast("setDracoUrl",rc)},a.dW=Zh,a.dX=function(s){yl=ct.resolveURL(s),$h||($h=new bp(gl(),new Is)),$h.broadcast("setMeshoptUrl",yl)},a.dY=nn,a.dZ=jl,a.d_=kc,a.da=450,a.db=7,a.dc=Cv,a.dd=_r,a.de=fh,a.df=256,a.dg=eo,a.dh=gs,a.di=Fs,a.dj=ou,a.dk=function(s,e,r,l,u){return $n((s-e)/(r-e)*(u-l)+l,l,u)},a.dl=Ef,a.dm=uu,a.dn=class{constructor(s,e,r,l){this.context=s,this.format=l,this.size=r,this.texture=s.gl.createTexture();const[u,c,f]=this.size,{gl:x}=s;x.bindTexture(x.TEXTURE_3D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(!1),x.texImage3D(x.TEXTURE_3D,0,this.format,u,c,f,0,Q0(this.format),ex(this.format),e.data)}bind(s,e){const{context:r}=this,{gl:l}=r;l.bindTexture(l.TEXTURE_3D,this.texture),s!==this.minFilter&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MAG_FILTER,s),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MIN_FILTER,s),this.minFilter=s),e!==this.wrapS&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_S,e),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}},a.dp=_p,a.dq=[1,1,1],a.dr=vp,a.ds=Fh,a.dt=Aa,a.du=ch,a.dv=Bl,a.dw=Cm,a.dx=Ca,a.dy=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new qt(1/0,1/0),max:new qt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(s,e=!1){const r=Kf(new qt(0,0),new qt(zt,zt),s),l=[];if(e&&!w0(r,this._globalClipBounds))return l;for(const u of this._activeRegions){if(u.hiddenByOverlap||!w0(r,u))continue;const c=Gs(u.min,u.max,s);l.push({min:c.min,max:c.max,sourceId:this._sourceIds[u.priority],footprint:u.footprint,footprintTileId:u.tileId,order:u.order,clipMask:u.clipMask,clipScope:u.clipScope})}return l}setSources(s){this._setSources(s.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const r=[];for(const l of e.cache.getVisibleCoordinates()){const u=e.cache.getTile(l).buckets[e.layer];u&&u.updateFootprints(l.toUnwrapped(),r)}return r},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(s){const e=s.getFootprints();if(e.length===0)return;const r=s.getOrder(),l=s.getClipMask(),u=s.getClipScope();for(const c of e){if(!c.footprint)continue;const f=Kf(c.footprint.min,c.footprint.max,c.id);this._activeRegions.push({min:f.min,max:f.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:c.id,footprint:c.footprint,order:r,clipMask:l,clipScope:u})}this._sourceIds.push(s.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,r)=>e.priority-r.priority||ev(e.min,r.min)||ev(e.max,r.max)||e.order-r.order||e.clipMask-r.clipMask||function(l,u){const c=(f,x)=>f+x;return l.length-u.length||l.reduce(c,"").localeCompare(u.reduce(c,""))}(e.clipScope,r.clipScope));let s=this._activeRegions.length!==this._prevRegions.length;if(!s){let e=0;for(;!s&&e!==this._activeRegions.length;){const r=this._activeRegions[e],l=this._prevRegions[e];s=r.priority!==l.priority||!tv(r,l)||r.order!==l.order||r.clipMask!==l.clipMask||!cs(r.clipScope,l.clipScope),++e}}if(s){++this._updateTime;for(const r of this._activeRegions)r.order!==Hm&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,r.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,r.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,r.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,r.max.y));const e=r=>{const l=this._activeRegions;if(r>=l.length)return r;const u=l[r].priority;for(;r<l.length&&l[r].priority===u;)++r;return r};if(this._sourceIds.length>1){let r=0,l=e(r);for(;r!==l;){let u=r;const c=r;for(;u!==l;){const f=this._activeRegions[u];f.hiddenByOverlap=!1;for(let x=0;x<c;x++){const S=this._activeRegions[x];if(!S.hiddenByOverlap&&f.order===Hm&&w0(f,S)&&(f.hiddenByOverlap=Cc(f.footprint,f.tileId,S.footprint,S.tileId),f.hiddenByOverlap))break}++u}r=l,l=e(r)}}}}_setSources(s){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=s.length-1;e>=0;e--)this._addSource(s[e]);this._computeReplacement()}},a.dz=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.withSkirts.destroy(),s.withoutSkirts.destroy()}_fillGridMeshWithLods(s,e){const r=new Pl,l=new xo,u=[],c=s+1+2,f=e[0]+1,x=e[0]+1+(1+e.length),S=(C,_,E)=>{let M=C===c-1?C-2:C===0?C:C-1;return M+=E?24575:0,[M,_]};for(let C=0;C<c;++C)r.emplaceBack(...S(C,0,!0));for(let C=0;C<f;++C)for(let _=0;_<c;++_)r.emplaceBack(...S(_,C,(_===0||_===c-1)&&!0));for(let C=0;C<e.length;++C){const _=e[C];for(let E=0;E<c;++E)r.emplaceBack(...S(E,_,!0))}for(let C=0;C<e.length;++C){const _=l.length,E=e[C]+1+2,M=new xo;for(let I=0;I<E-1;I++){const B=I===E-2,U=B?c*(x-e.length+C-I):c;for(let G=0;G<c-1;G++){const H=I*c+G;I===0||B||G===0||G===c-2?(M.emplaceBack(H+1,H,H+U),M.emplaceBack(H+U,H+U+1,H+1)):(l.emplaceBack(H+1,H,H+U),l.emplaceBack(H+U,H+U+1,H+1))}}const A=ri.simpleSegment(0,_,r.length,l.length-_);for(let I=0;I<M.uint16.length;I+=3)l.emplaceBack(M.uint16[I],M.uint16[I+1],M.uint16[I+2]);const D=ri.simpleSegment(0,_,r.length,l.length-_);u.push({withoutSkirts:A,withSkirts:D})}return{vertices:r,indices:l,segments:u}}_createGrid(s){const e=this._fillGridMeshWithLods(wh,Om);this._gridSegments=e.segments,this._gridBuffer=s.createVertexBuffer(e.vertices,bn.members),this._gridIndexBuffer=s.createIndexBuffer(e.indices,!0)}_createPoles(s){const e=new xo;for(let f=0;f<=wh;f++)e.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=s.createIndexBuffer(e,!0);const r=new Fs,l=new Fs,u=new Fs,c=new Fs;this._poleSegments=[];for(let f=0,x=0;f<cu;f++){const S=360/(1<<f);r.emplaceBack(0,-Zo,0,.5,0),l.emplaceBack(0,-Zo,0,.5,1),u.emplaceBack(0,-Zo,0,.5,.5),c.emplaceBack(0,-Zo,0,.5,.5);for(let C=0;C<=wh;C++){let _=C/wh,E=0;const M=En(0,S,_),[A,D,I]=Sh(cl,Ul,M,Zo);r.emplaceBack(A,D,I,_,E),l.emplaceBack(A,D,I,_,1-E);const B=Jn(M);_=.5+.5*Math.sin(B),E=.5+.5*Math.cos(B),u.emplaceBack(A,D,I,_,E),c.emplaceBack(A,D,I,_,1-E)}this._poleSegments.push(ri.simpleSegment(x,0,66,64)),x+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(r,hn,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(l,hn,!1),this._texturedPoleNorthVertexBuffer=s.createVertexBuffer(u,hn,!1),this._texturedPoleSouthVertexBuffer=s.createVertexBuffer(c,hn,!1)}getGridBuffers(s,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[s].withSkirts:this._gridSegments[s].withoutSkirts]}getPoleBuffers(s,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}},a.e=ie,a.e0=jv,a.e1=I0,a.e2=Vl,a.e3="hd_road_elevation",a.e4=class{static parseFrom(s,e){const r=dl.parse(s);if(!r)return[];let{vertices:l,features:u}=r;const c=1/h(e);u.sort((C,_)=>C.id-_.id),l.sort((C,_)=>C.id-_.id||C.idx-_.idx),l=l.filter((C,_,E)=>_===E.findIndex(M=>M.id===C.id&&M.idx===C.idx));const f=new Array;let x=0;const S=l.length;for(const C of u){if(C.constantHeight){f.push(new d_(C.id,C.bounds,C.constantHeight));continue}for(;x!==S&&l[x].id<C.id;)x++;if(x===S||l[x].id!==C.id)continue;const _=new Array,E=new Array,M=x;for(;x!==S&&l[x].id===C.id;){const A=l[x];if(_.push({position:A.position,height:A.height,extent:A.extent}),x!==M&&l[x-1].idx===A.idx-1){const D=x-M;E.push({a:D-1,b:D})}x++}f.push(new d_(C.id,C.bounds,void 0,_,E,c))}return f}},a.e5=ks,a.e6=Wo,a.e7=c1,a.e8=Km,a.e9=function(s,e,r,l,u,c,f,x=1,S){s.createArrays(),s.tilePixelRatio=zt/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const C=s.layers[0].layout,_=s.layers[0]._unevaluatedLayout._values,E={};E.scaleFactor=x,E.textSizeScaleRange=C.get("text-size-scale-range"),E.iconSizeScaleRange=C.get("icon-size-scale-range");const[M,A]=E.textSizeScaleRange,[D,I]=E.iconSizeScaleRange;E.textScaleFactor=$n(E.scaleFactor,M,A),E.iconScaleFactor=$n(E.scaleFactor,D,I);const B=_["text-size"],U=_["icon-size"];if(s.textSizeData.kind==="composite"){const{minZoom:ne,maxZoom:me}=s.textSizeData;E.compositeTextSizes=[B.possiblyEvaluate(new Hr(ne),c),B.possiblyEvaluate(new Hr(me),c)]}if(s.iconSizeData.kind==="composite"){const{minZoom:ne,maxZoom:me}=s.iconSizeData;E.compositeIconSizes=[U.possiblyEvaluate(new Hr(ne),c),U.possiblyEvaluate(new Hr(me),c)]}E.layoutTextSize=B.possiblyEvaluate(new Hr(f+1),c),E.layoutIconSize=U.possiblyEvaluate(new Hr(f+1),c),E.textMaxSize=B.possiblyEvaluate(new Hr(18),c);const G=C.get("symbol-placement"),H=C.get("text-rotation-alignment")==="map"&&G!=="point",q=C.get("text-size");let Y=!1;const J=[];for(const ne of s.features){const me=C.get("text-font").evaluate(ne,{},c).join(","),ce=q.evaluate(ne,{},c)*E.textScaleFactor,ue=E.layoutTextSize.evaluate(ne,{},c)*E.textScaleFactor,Ee=E.layoutIconSize.evaluate(ne,{},c)*E.iconScaleFactor,_e={horizontal:{},vertical:void 0},De=ne.text;let Le,Ne=[0,0];if(De){const bt=De.toString(),xn=C.get("text-letter-spacing").evaluate(ne,{},c)*$i,Jt=C.get("text-line-height").evaluate(ne,{},c)*$i,an=Qu(bt)?xn:0,Rn=C.get("text-anchor").evaluate(ne,{},c),qn=C.get("text-variable-anchor");if(!qn){const pr=C.get("text-radial-offset").evaluate(ne,{},c);Ne=pr?cp(Rn,[pr*$i,bs]):C.get("text-offset").evaluate(ne,{},c).map(mr=>mr*$i)}let On=H?"center":C.get("text-justify").evaluate(ne,{},c);const Vn=G==="point",Fn=Vn?C.get("text-max-width").evaluate(ne,{},c)*$i:1/0,nr=pr=>{s.allowVerticalPlacement&&fm(bt)&&(_e.vertical=sp(De,e,r,u,me,Fn,Jt,Rn,pr,an,Ne,_a.vertical,!0,ue,ce,S))};if(!H&&qn){const pr=On==="auto"?qn.map(wn=>bv(wn)):[On];let mr=!1;for(let wn=0;wn<pr.length;wn++){const lr=pr[wn];if(!_e.horizontal[lr])if(mr)_e.horizontal[lr]=_e.horizontal[0];else{const Ir=sp(De,e,r,u,me,Fn,Jt,"center",lr,an,Ne,_a.horizontal,!1,ue,ce,S);Ir&&(_e.horizontal[lr]=Ir,mr=Ir.positionedLines.length===1)}}nr("left")}else{if(On==="auto"&&(On=bv(Rn)),Vn||C.get("text-writing-mode").indexOf("horizontal")>=0||!fm(bt)){const pr=sp(De,e,r,u,me,Fn,Jt,Rn,On,an,Ne,_a.horizontal,!1,ue,ce,S);pr&&(_e.horizontal[On]=pr)}nr(Vn?"left":On)}}let Ge,Ve,Ke,Ze,Je,vt=!1;if(ne.icon&&ne.icon.hasPrimary()){const bt=Jm(ne.icon,s.iconSizeData,_["icon-size"],c,s.zoom,ne,S,E.iconScaleFactor);Ge=bt.iconPrimary,Ve=bt.iconSecondary;const xn=Ge.toString(),Jt=l.get(xn);Jt&&(Ke=C.get("icon-offset").evaluate(ne,{},c),Ze=C.get("icon-anchor").evaluate(ne,{},c),Je=C.get("icon-text-fit").evaluate(ne,{},c),Le=uS(u.get(xn),Ve?u.get(Ve.toString()):void 0,Ke,Ze),vt=Jt.sdf,s.sdfIcons===void 0?s.sdfIcons=Jt.sdf:s.sdfIcons!==Jt.sdf&&xe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Jt.pixelRatio!==s.pixelRatio||C.get("icon-rotate").constantOr(1)!==0)&&(s.iconsNeedLinear=!0))}Y=Y||!(!ne.icon||!ne.icon.hasSecondary());const _t=$0(_e.horizontal)||_e.vertical;s.iconsInText||(s.iconsInText=!!_t&&_t.iconsInText);const tn=ue*E.textScaleFactor/$i,{defaultShapedIcon:Ct,verticallyShapedIcon:Bt}=p1(s,Le,C,ne,c,_e,tn,Ke,Je);Le=Ct,J.push({feature:ne,shapedTextOrientations:_e,shapedText:_t,shapedIcon:Le,iconPrimary:Ge,iconSecondary:Ve,iconOffset:Ke,iconAnchor:Ze,verticallyShapedIcon:Bt,layoutTextSize:ue,layoutIconSize:Ee,textOffset:Ne,isSDFIcon:vt,iconTextFit:Je})}return{featureData:J,sizes:E,hasAnySecondaryIcon:Y,textAlongLine:H,symbolPlacement:G}},a.ea=u1,a.eb=function(s,e,r,l,u,c,f,x,S,C){const{featureData:_,hasAnySecondaryIcon:E,sizes:M,textAlongLine:A,symbolPlacement:D}=e;for(const I of _){const{shapedIcon:B,verticallyShapedIcon:U,feature:G,shapedTextOrientations:H,shapedText:q,layoutTextSize:Y,textOffset:J,isSDFIcon:ne,iconPrimary:me,iconSecondary:ce,iconTextFit:ue,iconOffset:Ee}=I;vv(B,C.iconPositions,me,ce),vv(U,C.iconPositions,me,ce),Qm(H,C.iconPositions),(q||B)&&m1(s,G,H,B,U,S,M,Y,0,J,ne,l,u,f,x,E,ue,Ee,A,D)}r&&s.generateCollisionDebugBuffers(c,s.collisionBoxArray,M.textScaleFactor)},a.ec=ul,a.ed=pg,a.ee=ls,a.ef=gd,a.eg=Xm,a.eh=ee,a.ei=function(s){let e=0;if(new Uint32Array(s,0,1)[0]!==Id){const r=new Uint32Array(s,0,7),[,,l,u,c,f]=r;e=r.byteLength+u+c+f+c,(l!==s.byteLength||e>=s.byteLength)&&xe("Invalid b3dm header information.")}return Rx(s,e)},a.ej=function(s,e){const r=Uv(s);for(const l of r){for(const u of l.meshes)Ix(u);l.lights&&(l.lightMeshIndex=l.meshes.length,l.meshes.push(V1(l.lights,e)))}return r},a.ek=yu,a.el=vu,a.em=vo,a.en=function(s){Qn(),zn!=null&&zn.then(e=>{e.keys().then(r=>{for(let l=0;l<r.length-s;l++)e.delete(r[l])})})},a.f=function(s){return s.indexOf("mapbox:")===0},a.g=function(s,e){return Ro(ao(s,{method:"GET"}),e)},a.h=ae,a.i=function(s){return ie.API_STYLE_REGEX.test(s)&&!we(s)},a.j=function(s){return decodeURIComponent(atob(s).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},a.k=function(s){return btoa(encodeURIComponent(s).replace(/%([0-9A-F]{2})/g,(e,r)=>String.fromCharCode(+("0x"+r))))},a.l=ao,a.m=Rr,a.n=function(s,e){return Ro(ao(s,{type:"json"}),e)},a.o=jc,a.p=function(s,e){return Ro(ao(s,{method:"POST"}),e)},a.q=ct,a.r=So,a.s=function(s){try{const e=self[s];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},a.t=Ye,a.u=function(){return function s(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()},a.v=function(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)},a.w=xe,a.x=function(){return Ov||(Ov=new Dd),Ov},a.y=Z_,a.z=qd}),$(["./shared"],function(a){function ee(ut){const ie=ut?ut.url.toString():void 0;return ie?performance.getEntriesByName(ie):[]}function se(ut){if(typeof ut=="number"||typeof ut=="boolean"||typeof ut=="string"||ut==null)return JSON.stringify(ut);if(Array.isArray(ut)){let ae="[";for(const we of ut)ae+=`${se(we)},`;return`${ae}]`}let ie="{";for(const ae of Object.keys(ut).sort())ie+=`${ae}:${se(ut[ae])},`;return`${ie}}`}function fe(ut){let ie="";for(const ae of a.bm)(ut.type!=="model"||ae!=="minzoom"&&ae!=="maxzoom")&&(ie+=`/${se(ut[ae])}`);return ie}class ge{constructor(ie){this.keyCache={},this._layers={},this._layerConfigs={},ie&&this.replace(ie)}replace(ie,ae){this._layerConfigs={},this._layers={},this.update(ie,[],ae)}update(ie,ae,we){this._options=we;for(const Ie of ie)this._layerConfigs[Ie.id]=Ie,(this._layers[Ie.id]=a.cv(Ie,this.scope,null,this._options)).compileFilter(we),this.keyCache[Ie.id]&&delete this.keyCache[Ie.id];for(const Ie of ae)delete this.keyCache[Ie],delete this._layerConfigs[Ie],delete this._layers[Ie];this.familiesBySource={};const Oe=function(Ie,je){const rt={};for(let at=0;at<Ie.length;at++){const Ye=Ie[at];let ct=je&&je[Ye.id];!ct&&(ct=fe(Ye),Ye.type==="line"&&Ye.paint)&&function Qt(on){return typeof on=="string"&&on==="line-progress"||(Array.isArray(on)?on.some(Qt):!(!on||typeof on!="object")&&Object.values(on).some(Qt))}(Ye.paint["line-width"])&&(ct+=`/${se(Ye.paint["line-width"])}`),je&&(je[Ye.id]=ct);let At=rt[ct];At||(At=rt[ct]=[]),At.push(Ye)}const $e=[];for(const at in rt)$e.push(rt[at]);return $e}(Object.values(this._layerConfigs),this.keyCache);for(const Ie of Oe){const je=Ie.map(At=>this._layers[At.id]),rt=je[0];if(rt.visibility==="none")continue;const $e=rt.source||"";let at=this.familiesBySource[$e];at||(at=this.familiesBySource[$e]={});const Ye=rt.sourceLayer||"_geojsonTileLayer";let ct=at[Ye];ct||(ct=at[Ye]=[]),ct.push(je)}}}const le=1*a.d_;class ke{constructor(ie){const ae={},we=[];for(const rt in ie){const $e=ie[rt],at=ae[rt]={};for(const Ye in $e.glyphs){const ct=$e.glyphs[+Ye];if(!ct||ct.bitmap.width===0||ct.bitmap.height===0)continue;const At=ct.metrics.localGlyph?le:1,Qt={x:0,y:0,w:ct.bitmap.width+2*At,h:ct.bitmap.height+2*At};we.push(Qt),at[Ye]=Qt}}const{w:Oe,h:Ie}=a.H(we),je=new a.dZ({width:Oe||1,height:Ie||1});for(const rt in ie){const $e=ie[rt];for(const at in $e.glyphs){const Ye=$e.glyphs[+at];if(!Ye||Ye.bitmap.width===0||Ye.bitmap.height===0)continue;const ct=ae[rt][at],At=Ye.metrics.localGlyph?le:1;a.dZ.copy(Ye.bitmap,je,{x:0,y:0},{x:ct.x+At,y:ct.y+At},Ye.bitmap)}}this.image=je,this.positions=ae}}a.dY(ke,"GlyphAtlas");class Re{constructor(ie){this.tileID=new a.aH(ie.tileID.overscaledZ,ie.tileID.wrap,ie.tileID.canonical.z,ie.tileID.canonical.x,ie.tileID.canonical.y),this.tileZoom=ie.tileZoom,this.uid=ie.uid,this.zoom=ie.zoom,this.lut=ie.lut,this.canonical=ie.tileID.canonical,this.pixelRatio=ie.pixelRatio,this.tileSize=ie.tileSize,this.source=ie.source,this.scope=ie.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ie.showCollisionBoxes,this.collectResourceTiming=!!ie.request&&ie.request.collectResourceTiming,this.promoteId=ie.promoteId,this.isSymbolTile=ie.isSymbolTile,this.tileTransform=a.aR(ie.tileID.canonical,ie.projection),this.projection=ie.projection,this.worldview=ie.worldview,this.localizableLayerIds=ie.localizableLayerIds,this.brightness=ie.brightness,this.extraShadowCaster=!!ie.extraShadowCaster,this.tessellationStep=ie.tessellationStep,this.scaleFactor=ie.scaleFactor}parse(ie,ae,we,Oe,Ie){this.status="parsing",this.data=ie,this.collisionBoxArray=new a.aX;const je=new a.d$(Object.keys(ie.layers).sort()),rt=new a.e0(this.tileID,this.promoteId);rt.bucketLayerIDs=[];const $e={},at=new a.e1(256,256),Ye={featureIndex:rt,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:at,availableImages:we,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},ct=ae.familiesBySource[this.source];for(const Qn in ct){const Ar=ie.layers[Qn];if(!Ar)continue;let Rr=!1,Or=!1,fi=!1;for(const Vo of ct[Qn])Vo[0].type==="symbol"?Rr=!0:Or=!0,Vo[0].is3D()&&Vo[0].type!=="model"&&(fi=!0);if(this.extraShadowCaster&&!fi||this.isSymbolTile===!0&&!Rr||this.isSymbolTile===!1&&!Or)continue;Ar.version===1&&a.w(`Vector tile source "${this.source}" layer "${Qn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ro=je.encode(Qn),Mo=[];let oa=!1;for(let Vo=0,io=0;Vo<Ar.length;Vo++){const pi=Ar.feature(Vo),ja=rt.getId(pi,Qn);if(this.localizableLayerIds&&this.localizableLayerIds.has(Qn)){const Ro=pi.properties?pi.properties.worldview:null;if(this.worldview&&typeof Ro=="string")if(Ro==="all")pi.properties.$localized=!0;else{if(!Ro.split(",").includes(this.worldview))continue;pi.properties.$localized=!0,pi.properties.worldview=this.worldview}}!oa&&pi.properties&&pi.properties.hasOwnProperty(a.e2)&&(oa=!0),Mo.push({feature:pi,id:ja,index:io,sourceLayerIndex:ro}),io++}oa&&!Ye.elevationFeatures&&ie.layers.hasOwnProperty(a.e3)&&(Ye.elevationFeatures=a.e4.parseFrom(ie.layers[a.e3],this.canonical));for(const Vo of ct[Qn]){const io=Vo[0];(!this.extraShadowCaster||io.is3D()&&io.type!=="model")&&(this.isSymbolTile!==void 0&&io.type==="symbol"!==this.isSymbolTile||io.minzoom&&this.zoom<Math.floor(io.minzoom)||io.maxzoom&&this.zoom>=io.maxzoom||io.visibility!=="none"&&(Ue(Vo,this.zoom,Ye.brightness,we),($e[io.id]=io.createBucket({index:rt.bucketLayerIDs.length,layers:Vo,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ro,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Mo,Ye,this.tileID.canonical,this.tileTransform),rt.bucketLayerIDs.push(Vo.map(pi=>a.C(pi.id,pi.scope)))))}}let At,Qt,on,Nn,jn,Un;at.trim();const zn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Wr=()=>{if(At)return this.status="done",Ie(At);if(this.extraShadowCaster)this.status="done",Ie(null,{buckets:Object.values($e).filter(Qn=>!Qn.isEmpty()),featureIndex:rt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Ye.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Qt&&on&&Nn){const Qn=new ke(Qt),Ar=new Map;for(const[fi,ro]of on.entries()){const{imagePosition:Mo}=a.e7(fi,ro,a.e8);Ar.set(fi,Mo)}const Rr={};for(const fi in $e){const ro=$e[fi];ro instanceof a.aY&&(Ue(ro.layers,this.zoom,Ye.brightness,we),Rr[fi]=a.e9(ro,Qt,Qn.positions,on,Ar,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio))}const Or={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Oe,on,jn,()=>{Or.iconsPending=!1,si(Rr,Qn,Or)}),this.rasterizeIfNeeded(Oe,Nn,Un,()=>{Or.patternsPending=!1,si(Rr,Qn,Or)})}},si=(Qn,Ar,Rr,Or)=>{if(Rr.iconsPending||Rr.patternsPending)return;const fi=new a.ea(on,Nn,this.lut);for(const ro in $e){const Mo=$e[ro];if(ro in Qn)a.eb(Mo,Qn[ro],this.showCollisionBoxes,we,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,on,fi);else if(Mo.hasPattern&&(Mo instanceof a.b2||Mo instanceof a.b3||Mo instanceof a.d8)){Ue(Mo.layers,this.zoom,Ye.brightness,we);const oa=Object.fromEntries(fi.patternPositions);Mo.addFeatures(Ye,this.tileID.canonical,oa,we,this.tileTransform,this.brightness)}}this.status="done",Ie(null,{buckets:Object.values($e).filter(ro=>!ro.isEmpty()),featureIndex:rt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ar.image,lineAtlas:at,imageAtlas:fi,brightness:Ye.brightness})};if(!this.extraShadowCaster){const Qn=a.e5(Ye.glyphDependencies,Or=>Object.keys(Or).map(Number));Object.keys(Qn).length?Oe.send("getGlyphs",{uid:this.uid,stacks:Qn,scope:this.scope},(Or,fi)=>{At||(At=Or,Qt=fi,Wr())},void 0,!1,zn):Qt={};const Ar=Array.from(Ye.iconDependencies.keys()).map(Or=>a.I.parse(Or));Ar.length?Oe.send("getImages",{images:Ar,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Or,fi)=>{At||(At=Or,on=new Map,jn=this.updateImageMapAndGetImageTaskQueue(on,fi,Ye.iconDependencies),Wr())},void 0,!1,zn):(on=new Map,jn=new Map);const Rr=Array.from(Ye.patternDependencies.keys()).map(Or=>a.I.parse(Or));Rr.length?Oe.send("getImages",{images:Rr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Or,fi)=>{At||(At=Or,Nn=new Map,Un=this.updateImageMapAndGetImageTaskQueue(Nn,fi,Ye.patternDependencies),Wr())},void 0,!1,zn):(Nn=new Map,Un=new Map)}if(Ye.elevationFeatures&&Ye.elevationFeatures.length>0){const Qn=[];for(const Rr of Object.values($e))if(Rr instanceof a.b3){const Or=Rr.getUnevaluatedPortalGraph();Or&&Qn.push(Or)}const Ar=a.e6.evaluate(Qn);for(const Rr of Object.values($e))Rr instanceof a.b3&&Rr.setEvaluatedPortalGraph(Ar)}Wr()}rasterizeIfNeeded(ie,ae,we,Oe){Array.from(ae.values()).some(Ie=>Ie.usvg)?this.rasterize(ie,ae,we,Oe):Oe()}updateImageMapAndGetImageTaskQueue(ie,ae,we){const Oe=new Map;for(const Ie of ae.keys()){const je=we.get(Ie)||[];for(const rt of je){const $e=rt.toString(),at=ae.get(rt.id.toString());at.usvg?Oe.has($e)||(Oe.set($e,rt),ie.set($e,Object.assign({},at))):ie.set($e,at)}}return Oe}rasterize(ie,ae,we,Oe){this.rasterizeTask=ie.send("rasterizeImages",{scope:this.scope,tasks:we},(Ie,je)=>{if(!Ie)for(const[rt,$e]of je.entries()){const at=Object.assign(ae.get(rt),{data:$e});ae.set(rt,at)}Oe()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Ue(ut,ie,ae,we){const Oe=new a.aa(ie,{brightness:ae});for(const Ie of ut)Ie.recalculate(Oe,we)}class Pe extends a.E{constructor(ie,ae,we,Oe,Ie,je){super(),this.actor=ie,this.layerIndex=ae,this.availableImages=we,this.loadVectorData=Ie||a.aE,this.loading={},this.loaded={},this.deduped=new a.aD(ie.scheduler),this.isSpriteLoaded=Oe,this.scheduler=ie.scheduler,this.brightness=je}loadTile(ie,ae){const we=ie.uid,Oe=ie&&ie.request,Ie=Oe&&Oe.collectResourceTiming,je=this.loading[we]=new Re(ie);je.abort=this.loadVectorData(ie,(rt,$e)=>{const at=!this.loading[we];if(delete this.loading[we],je.cancelRasterize(),at||rt||!$e)return je.status="done",at||(this.loaded[we]=je),ae(rt);const Ye=$e.rawData,ct={};$e.expires&&(ct.expires=$e.expires),$e.cacheControl&&(ct.cacheControl=$e.cacheControl),je.vectorTile=$e.vectorTile||new a.ec.VectorTile(new a.bi(Ye));const At=()=>{je.parse(je.vectorTile,this.layerIndex,this.availableImages,this.actor,(Qt,on)=>{if(Qt||!on)return ae(Qt);const Nn={};if(Ie){const jn=ee(Oe);jn.length>0&&(Nn.resourceTiming=JSON.parse(JSON.stringify(jn)))}ae(null,a.l({rawTileData:Ye.slice(0)},on,ct,Nn))})};this.isSpriteLoaded?At():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(At,{type:"parseTile",isSymbolTile:ie.isSymbolTile,zoom:ie.tileZoom}):At()}),this.loaded=this.loaded||{},this.loaded[we]=je})}reloadTile(ie,ae){const we=this.loaded,Oe=ie.uid;if(we&&we[Oe]){const Ie=we[Oe];Ie.scaleFactor=ie.scaleFactor,Ie.showCollisionBoxes=ie.showCollisionBoxes,Ie.projection=ie.projection,Ie.brightness=ie.brightness,Ie.tileTransform=a.aR(ie.tileID.canonical,ie.projection),Ie.extraShadowCaster=ie.extraShadowCaster,Ie.lut=ie.lut;const je=(rt,$e)=>{const at=Ie.reloadCallback;at&&(delete Ie.reloadCallback,Ie.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.actor,at)),ae(rt,$e)};Ie.status==="parsing"?Ie.reloadCallback=je:Ie.status==="done"&&(Ie.vectorTile?Ie.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.actor,je):je())}else ae(null,void 0)}abortTile(ie,ae){const we=ie.uid,Oe=this.loading[we];Oe&&(Oe.abort&&Oe.abort(),delete this.loading[we]),ae()}removeTile(ie,ae){const we=this.loaded,Oe=ie.uid;we&&we[Oe]&&delete we[Oe],ae()}}class We{loadTile(ie,ae){const{uid:we,encoding:Oe,rawImageData:Ie,padding:je}=ie,rt=ImageBitmap&&Ie instanceof ImageBitmap?this.getImageData(Ie,je):Ie;ae(null,new a.ed(we,rt,Oe,je<1))}reloadTile(ie,ae){ae(null,null)}abortTile(ie,ae){ae()}removeTile(ie,ae){ae()}getImageData(ie,ae){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ie.width,ie.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ie.width,this.offscreenCanvas.height=ie.height,this.offscreenCanvasContext.drawImage(ie,0,0,ie.width,ie.height);const we=this.offscreenCanvasContext.getImageData(-ae,-ae,ie.width+2*ae,ie.height+2*ae);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),we}}a.bh.setPbf(a.bi);class Tt{constructor(ie){this._mrt=new a.bh(ie.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=ie.uid,this.tileID=ie.tileID,this.source=ie.source}parse(ie,ae){const we=this._mrt;this.status="parsing",this._entireBuffer=ie;try{we.parseHeader(ie),this._isHeaderLoaded=!0;const Oe=[];for(const Ie in we.layers){const je=we.getLayer(Ie),rt=je.getDataRange(je.getBandList()),$e=we.createDecodingTask(rt),at=ie.slice(rt.firstByte,rt.lastByte+1),Ye=a.bh.performDecoding(at,$e).then(ct=>$e.complete(null,ct)).catch(ct=>$e.complete(ct,null));Oe.push(Ye)}Promise.allSettled(Oe).then(()=>ae(null,we))}catch(Oe){ae(Oe)}}}class wt{constructor(ie){this.actor=ie,this.loading={},this.loaded={}}loadTile(ie,ae){const we=ie.uid,Oe=ie.request,Ie=this.loading[we]=new Tt(ie),{cancel:je}=a.bj(Oe,(rt,$e,at,Ye)=>{const ct=!this.loading[we];if(delete this.loading[we],ct||rt||!$e)return Ie.status="done",ct||(this.loaded[we]=Ie),ae(rt);Ie.parse($e,(At,Qt)=>{if(At||!Qt)return ae(At);ae(null,Qt,at,Ye)}),this.loaded[we]=Ie});Ie.abort=je}reloadTile(ie,ae){ae(null,void 0)}abortTile(ie,ae){const we=ie.uid,Oe=this.loading[we];Oe&&(Oe.abort&&Oe.abort(),delete this.loading[we]),ae()}removeTile(ie,ae){const we=ie.uid;this.loaded[we]&&delete this.loaded[we],ae()}decodeRasterArray({task:ie,buffer:ae},we){a.bh.performDecoding(ae,ie).then(Oe=>we(null,Oe)).catch(Oe=>we(Oe))}}const St=a.ec.VectorTileFeature.prototype.toGeoJSON;class Xt{constructor(ie){this._feature=ie,this.extent=a.ai,this.type=ie.type,this.properties=ie.tags,"id"in ie&&!isNaN(ie.id)&&(this.id=parseInt(ie.id,10))}loadGeometry(){if(this._feature.type===1){const ie=[];for(const ae of this._feature.geometry)ie.push([new a.P(ae[0],ae[1])]);return ie}{const ie=[];for(const ae of this._feature.geometry){const we=[];for(const Oe of ae)we.push(new a.P(Oe[0],Oe[1]));ie.push(we)}return ie}}toGeoJSON(ie,ae,we){return St.call(this,ie,ae,we)}}class cn{constructor(ie){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.ai,this.length=ie.length,this._features=ie}feature(ie){return new Xt(this._features[ie])}}const xt=64/4096,rn=128;class Ut{constructor(){this.features=new Map}clear(){this.features.clear()}load(ie=[],ae){for(const we of ie){const Oe=we.id;if(Oe==null)continue;let Ie=this.features.get(Oe);Ie&&this.updateCache(Ie,ae),we.geometry?(Ie=Rt(we),this.updateCache(Ie,ae),this.features.set(Oe,Ie)):this.features.delete(Oe),this.updateCache(Ie,ae)}}updateCache(ie,ae){for(const{canonical:we,uid:Oe}of Object.values(ae)){const{z:Ie,x:je,y:rt}=we;Yt(ie,Math.pow(2,Ie),je,rt)&&delete ae[Oe]}}getTile(ie,ae,we){const Oe=Math.pow(2,ie),Ie=[];for(const je of this.features.values())Yt(je,Oe,ae,we)&&Ie.push($t(je,Oe,ae,we));return{features:Ie}}getFeatures(){return[...this.features.values()]}}function Yt({minX:ut,minY:ie,maxX:ae,maxY:we},Oe,Ie,je){return ut<(Ie+1+xt)/Oe&&ie<(je+1+xt)/Oe&&ae>(Ie-xt)/Oe&&we>(je-xt)/Oe}function Rt(ut){const{id:ie,geometry:ae,properties:we}=ut;if(!ae)return;if(ae.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Oe,coordinates:Ie}=ae,je={id:ie,type:1,geometry:[],tags:we,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},rt=je.geometry;if(Oe==="Point")ln(Ie,rt,je);else if(Oe==="MultiPoint")for(const $e of Ie)ln($e,rt,je);else if(Oe==="LineString")je.type=2,An(Ie,rt,je);else if(Oe==="MultiLineString")je.type=2,mn(Ie,rt,je);else if(Oe==="Polygon")je.type=3,mn(Ie,rt,je,!0);else{if(Oe!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");je.type=3;for(const $e of Ie)mn($e,rt,je,!0)}return je}function ln([ut,ie],ae,we){const Oe=a.av(ut);let Ie=a.aC(ie);Ie=Ie<0?0:Ie>1?1:Ie,ae.push(Oe,Ie),we.minX=Math.min(we.minX,Oe),we.minY=Math.min(we.minY,Ie),we.maxX=Math.max(we.maxX,Oe),we.maxY=Math.max(we.maxY,Ie)}function An(ut,ie,ae,we=!1,Oe=!1){const Ie=[];for(const je of ut)ln(je,Ie,ae);ie.push(Ie),we&&function(je,rt){let $e=0;for(let at=0,Ye=je.length,ct=Ye-2;at<Ye;ct=at,at+=2)$e+=(je[at]-je[ct])*(je[at+1]+je[ct+1]);if($e>0===rt)for(let at=0,Ye=je.length;at<Ye/2;at+=2){const ct=je[at],At=je[at+1];je[at]=je[Ye-2-at],je[at+1]=je[Ye-1-at],je[Ye-2-at]=ct,je[Ye-1-at]=At}}(Ie,Oe)}function mn(ut,ie,ae,we=!1){for(let Oe=0;Oe<ut.length;Oe++)An(ut[Oe],ie,ae,we,Oe===0)}function $t(ut,ie,ae,we){const{id:Oe,type:Ie,geometry:je,tags:rt}=ut,$e=[];if(Ie===1)(function(at,Ye,ct,At,Qt){for(let on=0;on<at.length;on+=2){const Nn=Math.round(a.ai*(at[on+0]*Ye-ct)),jn=Math.round(a.ai*(at[on+1]*Ye-At));Qt.push([Nn,jn])}})(je,ie,ae,we,$e);else for(const at of je)Nt(at,ie,ae,we,$e);return{id:Oe,type:Ie,geometry:$e,tags:rt}}function Nt(ut,ie,ae,we,Oe){const je=a.ai+rn;let rt;for(let $e=0;$e<ut.length-2;$e+=2){let at=Math.round(a.ai*(ut[$e+0]*ie-ae)),Ye=Math.round(a.ai*(ut[$e+1]*ie-we)),ct=Math.round(a.ai*(ut[$e+2]*ie-ae)),At=Math.round(a.ai*(ut[$e+3]*ie-we));const Qt=ct-at,on=At-Ye;at<-128&&ct<-128||(at<-128?(Ye+=Math.round(on*((-128-at)/Qt)),at=-128):ct<-128&&(At=Ye+Math.round(on*((-128-at)/Qt)),ct=-128),Ye<-128&&At<-128||(Ye<-128?(at+=Math.round(Qt*((-128-Ye)/on)),Ye=-128):At<-128&&(ct=at+Math.round(Qt*((-128-Ye)/on)),At=-128),at>=je&&ct>=je||(at>=je?(Ye+=Math.round(on*((je-at)/Qt)),at=je):ct>=je&&(At=Ye+Math.round(on*((je-at)/Qt)),ct=je),Ye>=je&&At>=je||(Ye>=je?(at+=Math.round(Qt*((je-Ye)/on)),Ye=je):At>=je&&(ct=at+Math.round(Qt*((je-Ye)/on)),At=je),rt&&at===rt[rt.length-1][0]&&Ye===rt[rt.length-1][1]||(rt=[[at,Ye]],Oe.push(rt)),rt.push([ct,At])))))}}var Kt,It,sn,tt={exports:{}},un=function(){if(sn)return tt.exports;sn=1;var ut=a.eg(),ie=function(){if(It)return Kt;It=1;var Ye=a.ee(),ct=a.ef().VectorTileFeature;function At(on,Nn){this.options=Nn||{},this.features=on,this.length=on.length}function Qt(on,Nn){this.id=typeof on.id=="number"?on.id:void 0,this.type=on.type,this.rawGeometry=on.type===1?[on.geometry]:on.geometry,this.properties=on.tags,this.extent=Nn||4096}return Kt=At,At.prototype.feature=function(on){return new Qt(this.features[on],this.options.extent)},Qt.prototype.loadGeometry=function(){var on=this.rawGeometry;this.geometry=[];for(var Nn=0;Nn<on.length;Nn++){for(var jn=on[Nn],Un=[],zn=0;zn<jn.length;zn++)Un.push(new Ye(jn[zn][0],jn[zn][1]));this.geometry.push(Un)}return this.geometry},Qt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var on=this.geometry,Nn=1/0,jn=-1/0,Un=1/0,zn=-1/0,Wr=0;Wr<on.length;Wr++)for(var si=on[Wr],Qn=0;Qn<si.length;Qn++){var Ar=si[Qn];Nn=Math.min(Nn,Ar.x),jn=Math.max(jn,Ar.x),Un=Math.min(Un,Ar.y),zn=Math.max(zn,Ar.y)}return[Nn,Un,jn,zn]},Qt.prototype.toGeoJSON=ct.prototype.toGeoJSON,Kt}();function ae(Ye){var ct=new ut;return function(At,Qt){for(var on in At.layers)Qt.writeMessage(3,we,At.layers[on])}(Ye,ct),ct.finish()}function we(Ye,ct){var At;ct.writeVarintField(15,Ye.version||1),ct.writeStringField(1,Ye.name||""),ct.writeVarintField(5,Ye.extent||4096);var Qt={keys:[],values:[],keycache:{},valuecache:{}};for(At=0;At<Ye.length;At++)Qt.feature=Ye.feature(At),ct.writeMessage(2,Oe,Qt);var on=Qt.keys;for(At=0;At<on.length;At++)ct.writeStringField(3,on[At]);var Nn=Qt.values;for(At=0;At<Nn.length;At++)ct.writeMessage(4,at,Nn[At])}function Oe(Ye,ct){var At=Ye.feature;At.id!==void 0&&ct.writeVarintField(1,At.id),ct.writeMessage(2,Ie,Ye),ct.writeVarintField(3,At.type),ct.writeMessage(4,$e,At)}function Ie(Ye,ct){var At=Ye.feature,Qt=Ye.keys,on=Ye.values,Nn=Ye.keycache,jn=Ye.valuecache;for(var Un in At.properties){var zn=At.properties[Un],Wr=Nn[Un];if(zn!==null){Wr===void 0&&(Qt.push(Un),Nn[Un]=Wr=Qt.length-1),ct.writeVarint(Wr);var si=typeof zn;si!=="string"&&si!=="boolean"&&si!=="number"&&(zn=JSON.stringify(zn));var Qn=si+":"+zn,Ar=jn[Qn];Ar===void 0&&(on.push(zn),jn[Qn]=Ar=on.length-1),ct.writeVarint(Ar)}}}function je(Ye,ct){return(ct<<3)+(7&Ye)}function rt(Ye){return Ye<<1^Ye>>31}function $e(Ye,ct){for(var At=Ye.loadGeometry(),Qt=Ye.type,on=0,Nn=0,jn=At.length,Un=0;Un<jn;Un++){var zn=At[Un],Wr=1;Qt===1&&(Wr=zn.length),ct.writeVarint(je(1,Wr));for(var si=Qt===3?zn.length-1:zn.length,Qn=0;Qn<si;Qn++){Qn===1&&Qt!==1&&ct.writeVarint(je(2,si-1));var Ar=zn[Qn].x-on,Rr=zn[Qn].y-Nn;ct.writeVarint(rt(Ar)),ct.writeVarint(rt(Rr)),on+=Ar,Nn+=Rr}Qt===3&&ct.writeVarint(je(7,1))}}function at(Ye,ct){var At=typeof Ye;At==="string"?ct.writeStringField(1,Ye):At==="boolean"?ct.writeBooleanField(7,Ye):At==="number"&&(Ye%1!=0?ct.writeDoubleField(3,Ye):Ye<0?ct.writeSVarintField(6,Ye):ct.writeVarintField(5,Ye))}return tt.exports=ae,tt.exports.fromVectorTileJs=ae,tt.exports.fromGeojsonVt=function(Ye,ct){ct=ct||{};var At={};for(var Qt in Ye)At[Qt]=new ie(Ye[Qt].features,ct),At[Qt].name=Qt,At[Qt].version=ct.version,At[Qt].extent=ct.extent;return ae({layers:At})},tt.exports.GeoJSONWrapper=ie,tt.exports}(),pn=a.eh(un);const Vt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ut=>ut},ir=Math.fround||(Nr=new Float32Array(1),ut=>(Nr[0]=+ut,Nr[0]));var Nr;const rr=3,kr=5,sr=6;class Yr{constructor(ie){this.options=Object.assign(Object.create(Vt),ie),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ie){const{log:ae,minZoom:we,maxZoom:Oe}=this.options;ae&&console.time("total time");const Ie=`prepare ${ie.length} points`;ae&&console.time(Ie),this.points=ie;const je=[];for(let $e=0;$e<ie.length;$e++){const at=ie[$e];if(!at.geometry)continue;const[Ye,ct]=at.geometry.coordinates,At=ir(Uo(Ye)),Qt=ir(ls(ct));je.push(At,Qt,1/0,$e,-1,1),this.options.reduce&&je.push(0)}let rt=this.trees[Oe+1]=this._createTree(je);ae&&console.timeEnd(Ie);for(let $e=Oe;$e>=we;$e--){const at=+Date.now();rt=this.trees[$e]=this._createTree(this._cluster(rt,$e)),ae&&console.log("z%d: %d clusters in %dms",$e,rt.numItems,+Date.now()-at)}return ae&&console.timeEnd("total time"),this}getClusters(ie,ae){let we=((ie[0]+180)%360+360)%360-180;const Oe=Math.max(-90,Math.min(90,ie[1]));let Ie=ie[2]===180?180:((ie[2]+180)%360+360)%360-180;const je=Math.max(-90,Math.min(90,ie[3]));if(ie[2]-ie[0]>=360)we=-180,Ie=180;else if(we>Ie){const ct=this.getClusters([we,Oe,180,je],ae),At=this.getClusters([-180,Oe,Ie,je],ae);return ct.concat(At)}const rt=this.trees[this._limitZoom(ae)],$e=rt.range(Uo(we),ls(je),Uo(Ie),ls(Oe)),at=rt.data,Ye=[];for(const ct of $e){const At=this.stride*ct;Ye.push(at[At+kr]>1?de(at,At,this.clusterProps):this.points[at[At+rr]])}return Ye}getChildren(ie){const ae=this._getOriginId(ie),we=this._getOriginZoom(ie),Oe="No cluster with the specified id.",Ie=this.trees[we];if(!Ie)throw new Error(Oe);const je=Ie.data;if(ae*this.stride>=je.length)throw new Error(Oe);const rt=this.options.radius/(this.options.extent*Math.pow(2,we-1)),$e=Ie.within(je[ae*this.stride],je[ae*this.stride+1],rt),at=[];for(const Ye of $e){const ct=Ye*this.stride;je[ct+4]===ie&&at.push(je[ct+kr]>1?de(je,ct,this.clusterProps):this.points[je[ct+rr]])}if(at.length===0)throw new Error(Oe);return at}getLeaves(ie,ae,we){const Oe=[];return this._appendLeaves(Oe,ie,ae=ae||10,we=we||0,0),Oe}getTile(ie,ae,we){const Oe=this.trees[this._limitZoom(ie)],Ie=Math.pow(2,ie),{extent:je,radius:rt}=this.options,$e=rt/je,at=(we-$e)/Ie,Ye=(we+1+$e)/Ie,ct={features:[]};return this._addTileFeatures(Oe.range((ae-$e)/Ie,at,(ae+1+$e)/Ie,Ye),Oe.data,ae,we,Ie,ct),ae===0&&this._addTileFeatures(Oe.range(1-$e/Ie,at,1,Ye),Oe.data,Ie,we,Ie,ct),ae===Ie-1&&this._addTileFeatures(Oe.range(0,at,$e/Ie,Ye),Oe.data,-1,we,Ie,ct),ct.features.length?ct:null}getClusterExpansionZoom(ie){let ae=this._getOriginZoom(ie)-1;for(;ae<=this.options.maxZoom;){const we=this.getChildren(ie);if(ae++,we.length!==1)break;ie=we[0].properties.cluster_id}return ae}_appendLeaves(ie,ae,we,Oe,Ie){const je=this.getChildren(ae);for(const rt of je){const $e=rt.properties;if($e&&$e.cluster?Ie+$e.point_count<=Oe?Ie+=$e.point_count:Ie=this._appendLeaves(ie,$e.cluster_id,we,Oe,Ie):Ie<Oe?Ie++:ie.push(rt),ie.length===we)break}return Ie}_createTree(ie){const ae=new a.bE(ie.length/this.stride|0,this.options.nodeSize,Float32Array);for(let we=0;we<ie.length;we+=this.stride)ae.add(ie[we],ie[we+1]);return ae.finish(),ae.data=ie,ae}_addTileFeatures(ie,ae,we,Oe,Ie,je){for(const rt of ie){const $e=rt*this.stride,at=ae[$e+kr]>1;let Ye,ct,At;if(at)Ye=po(ae,$e,this.clusterProps),ct=ae[$e],At=ae[$e+1];else{const Nn=this.points[ae[$e+rr]];Ye=Nn.properties;const[jn,Un]=Nn.geometry.coordinates;ct=Uo(jn),At=ls(Un)}const Qt={type:1,geometry:[[Math.round(this.options.extent*(ct*Ie-we)),Math.round(this.options.extent*(At*Ie-Oe))]],tags:Ye};let on;on=at||this.options.generateId?ae[$e+rr]:this.points[ae[$e+rr]].id,on!==void 0&&(Qt.id=on),je.features.push(Qt)}}_limitZoom(ie){return Math.max(this.options.minZoom,Math.min(Math.floor(+ie),this.options.maxZoom+1))}_cluster(ie,ae){const{radius:we,extent:Oe,reduce:Ie,minPoints:je}=this.options,rt=we/(Oe*Math.pow(2,ae)),$e=ie.data,at=[],Ye=this.stride;for(let ct=0;ct<$e.length;ct+=Ye){if($e[ct+2]<=ae)continue;$e[ct+2]=ae;const At=$e[ct],Qt=$e[ct+1],on=ie.within($e[ct],$e[ct+1],rt),Nn=$e[ct+kr];let jn=Nn;for(const Un of on){const zn=Un*Ye;$e[zn+2]>ae&&(jn+=$e[zn+kr])}if(jn>Nn&&jn>=je){let Un,zn=At*Nn,Wr=Qt*Nn,si=-1;const Qn=(ct/Ye<<5)+(ae+1)+this.points.length;for(const Ar of on){const Rr=Ar*Ye;if($e[Rr+2]<=ae)continue;$e[Rr+2]=ae;const Or=$e[Rr+kr];zn+=$e[Rr]*Or,Wr+=$e[Rr+1]*Or,$e[Rr+4]=Qn,Ie&&(Un||(Un=this._map($e,ct,!0),si=this.clusterProps.length,this.clusterProps.push(Un)),Ie(Un,this._map($e,Rr)))}$e[ct+4]=Qn,at.push(zn/jn,Wr/jn,1/0,Qn,-1,jn),Ie&&at.push(si)}else{for(let Un=0;Un<Ye;Un++)at.push($e[ct+Un]);if(jn>1)for(const Un of on){const zn=Un*Ye;if(!($e[zn+2]<=ae)){$e[zn+2]=ae;for(let Wr=0;Wr<Ye;Wr++)at.push($e[zn+Wr])}}}}return at}_getOriginId(ie){return ie-this.points.length>>5}_getOriginZoom(ie){return(ie-this.points.length)%32}_map(ie,ae,we){if(ie[ae+kr]>1){const je=this.clusterProps[ie[ae+sr]];return we?Object.assign({},je):je}const Oe=this.points[ie[ae+rr]].properties,Ie=this.options.map(Oe);return we&&Ie===Oe?Object.assign({},Ie):Ie}}function de(ut,ie,ae){return{type:"Feature",id:ut[ie+rr],properties:po(ut,ie,ae),geometry:{type:"Point",coordinates:[(we=ut[ie],360*(we-.5)),qt(ut[ie+1])]}};var we}function po(ut,ie,ae){const we=ut[ie+kr],Oe=we>=1e4?`${Math.round(we/1e3)}k`:we>=1e3?Math.round(we/100)/10+"k":we,Ie=ut[ie+sr],je=Ie===-1?{}:Object.assign({},ae[Ie]);return Object.assign(je,{cluster:!0,cluster_id:ut[ie+rr],point_count:we,point_count_abbreviated:Oe})}function Uo(ut){return ut/360+.5}function ls(ut){const ie=Math.sin(ut*Math.PI/180),ae=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return ae<0?0:ae>1?1:ae}function qt(ut){const ie=(180-360*ut)*Math.PI/180;return 360*Math.atan(Math.exp(ie))/Math.PI-90}function cs(ut,ie,ae,we){let Oe=we;const Ie=ie+(ae-ie>>1);let je,rt=ae-ie;const $e=ut[ie],at=ut[ie+1],Ye=ut[ae],ct=ut[ae+1];for(let At=ie+3;At<ae;At+=3){const Qt=ti(ut[At],ut[At+1],$e,at,Ye,ct);if(Qt>Oe)je=At,Oe=Qt;else if(Qt===Oe){const on=Math.abs(At-Ie);on<rt&&(je=At,rt=on)}}Oe>we&&(je-ie>3&&cs(ut,ie,je,we),ut[je+2]=Oe,ae-je>3&&cs(ut,je,ae,we))}function ti(ut,ie,ae,we,Oe,Ie){let je=Oe-ae,rt=Ie-we;if(je!==0||rt!==0){const $e=((ut-ae)*je+(ie-we)*rt)/(je*je+rt*rt);$e>1?(ae=Oe,we=Ie):$e>0&&(ae+=je*$e,we+=rt*$e)}return je=ut-ae,rt=ie-we,je*je+rt*rt}function Do(ut,ie,ae,we){const Oe={id:ut??null,type:ie,geometry:ae,tags:we,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ie==="Point"||ie==="MultiPoint"||ie==="LineString")Jn(Oe,ae);else if(ie==="Polygon")Jn(Oe,ae[0]);else if(ie==="MultiLineString")for(const Ie of ae)Jn(Oe,Ie);else if(ie==="MultiPolygon")for(const Ie of ae)Jn(Oe,Ie[0]);return Oe}function Jn(ut,ie){for(let ae=0;ae<ie.length;ae+=3)ut.minX=Math.min(ut.minX,ie[ae]),ut.minY=Math.min(ut.minY,ie[ae+1]),ut.maxX=Math.max(ut.maxX,ie[ae]),ut.maxY=Math.max(ut.maxY,ie[ae+1])}function Wi(ut,ie,ae,we){if(!ie.geometry)return;const Oe=ie.geometry.coordinates;if(Oe&&Oe.length===0)return;const Ie=ie.geometry.type,je=Math.pow(ae.tolerance/((1<<ae.maxZoom)*ae.extent),2);let rt=[],$e=ie.id;if(ae.promoteId?$e=ie.properties[ae.promoteId]:ae.generateId&&($e=we||0),Ie==="Point")dr(Oe,rt);else if(Ie==="MultiPoint")for(const at of Oe)dr(at,rt);else if(Ie==="LineString")ea(Oe,rt,je,!1);else if(Ie==="MultiLineString"){if(ae.lineMetrics){for(const at of Oe)rt=[],ea(at,rt,je,!1),ut.push(Do($e,"LineString",rt,ie.properties));return}Rs(Oe,rt,je,!1)}else if(Ie==="Polygon")Rs(Oe,rt,je,!0);else{if(Ie!=="MultiPolygon"){if(Ie==="GeometryCollection"){for(const at of ie.geometry.geometries)Wi(ut,{id:$e,geometry:at,properties:ie.properties},ae,we);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const at of Oe){const Ye=[];Rs(at,Ye,je,!0),rt.push(Ye)}}ut.push(Do($e,Ie,rt,ie.properties))}function dr(ut,ie){ie.push(ta(ut[0]),$n(ut[1]),0)}function ea(ut,ie,ae,we){let Oe,Ie,je=0;for(let $e=0;$e<ut.length;$e++){const at=ta(ut[$e][0]),Ye=$n(ut[$e][1]);ie.push(at,Ye,0),$e>0&&(je+=we?(Oe*Ye-at*Ie)/2:Math.sqrt(Math.pow(at-Oe,2)+Math.pow(Ye-Ie,2))),Oe=at,Ie=Ye}const rt=ie.length-3;ie[2]=1,cs(ie,0,rt,ae),ie[rt+2]=1,ie.size=Math.abs(je),ie.start=0,ie.end=ie.size}function Rs(ut,ie,ae,we){for(let Oe=0;Oe<ut.length;Oe++){const Ie=[];ea(ut[Oe],Ie,ae,we),ie.push(Ie)}}function ta(ut){return ut/360+.5}function $n(ut){const ie=Math.sin(ut*Math.PI/180),ae=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return ae<0?0:ae>1?1:ae}function mo(ut,ie,ae,we,Oe,Ie,je,rt){if(we/=ie,Ie>=(ae/=ie)&&je<we)return ut;if(je<ae||Ie>=we)return null;const $e=[];for(const at of ut){const Ye=at.geometry;let ct=at.type;const At=Oe===0?at.minX:at.minY,Qt=Oe===0?at.maxX:at.maxY;if(At>=ae&&Qt<we){$e.push(at);continue}if(Qt<ae||At>=we)continue;let on=[];if(ct==="Point"||ct==="MultiPoint")Fa(Ye,on,ae,we,Oe);else if(ct==="LineString")Ua(Ye,on,ae,we,Oe,!1,rt.lineMetrics);else if(ct==="MultiLineString")na(Ye,on,ae,we,Oe,!1);else if(ct==="Polygon")na(Ye,on,ae,we,Oe,!0);else if(ct==="MultiPolygon")for(const Nn of Ye){const jn=[];na(Nn,jn,ae,we,Oe,!0),jn.length&&on.push(jn)}if(on.length){if(rt.lineMetrics&&ct==="LineString"){for(const Nn of on)$e.push(Do(at.id,ct,Nn,at.tags));continue}ct!=="LineString"&&ct!=="MultiLineString"||(on.length===1?(ct="LineString",on=on[0]):ct="MultiLineString"),ct!=="Point"&&ct!=="MultiPoint"||(ct=on.length===3?"Point":"MultiPoint"),$e.push(Do(at.id,ct,on,at.tags))}}return $e.length?$e:null}function Fa(ut,ie,ae,we,Oe){for(let Ie=0;Ie<ut.length;Ie+=3){const je=ut[Ie+Oe];je>=ae&&je<=we&&us(ie,ut[Ie],ut[Ie+1],ut[Ie+2])}}function Ua(ut,ie,ae,we,Oe,Ie,je){let rt=ao(ut);const $e=Oe===0?lc:bl;let at,Ye,ct=ut.start;for(let jn=0;jn<ut.length-3;jn+=3){const Un=ut[jn],zn=ut[jn+1],Wr=ut[jn+2],si=ut[jn+3],Qn=ut[jn+4],Ar=Oe===0?Un:zn,Rr=Oe===0?si:Qn;let Or=!1;je&&(at=Math.sqrt(Math.pow(Un-si,2)+Math.pow(zn-Qn,2))),Ar<ae?Rr>ae&&(Ye=$e(rt,Un,zn,si,Qn,ae),je&&(rt.start=ct+at*Ye)):Ar>we?Rr<we&&(Ye=$e(rt,Un,zn,si,Qn,we),je&&(rt.start=ct+at*Ye)):us(rt,Un,zn,Wr),Rr<ae&&Ar>=ae&&(Ye=$e(rt,Un,zn,si,Qn,ae),Or=!0),Rr>we&&Ar<=we&&(Ye=$e(rt,Un,zn,si,Qn,we),Or=!0),!Ie&&Or&&(je&&(rt.end=ct+at*Ye),ie.push(rt),rt=ao(ut)),je&&(ct+=at)}let At=ut.length-3;const Qt=ut[At],on=ut[At+1],Nn=Oe===0?Qt:on;Nn>=ae&&Nn<=we&&us(rt,Qt,on,ut[At+2]),At=rt.length-3,Ie&&At>=3&&(rt[At]!==rt[0]||rt[At+1]!==rt[1])&&us(rt,rt[0],rt[1],rt[2]),rt.length&&ie.push(rt)}function ao(ut){const ie=[];return ie.size=ut.size,ie.start=ut.start,ie.end=ut.end,ie}function na(ut,ie,ae,we,Oe,Ie){for(const je of ut)Ua(je,ie,ae,we,Oe,Ie,!1)}function us(ut,ie,ae,we){ut.push(ie,ae,we)}function lc(ut,ie,ae,we,Oe,Ie){const je=(Ie-ie)/(we-ie);return us(ut,Ie,ae+(Oe-ae)*je,1),je}function bl(ut,ie,ae,we,Oe,Ie){const je=(Ie-ae)/(Oe-ae);return us(ut,ie+(we-ie)*je,Ie,1),je}function ks(ut,ie){const ae=[];for(let we=0;we<ut.length;we++){const Oe=ut[we],Ie=Oe.type;let je;if(Ie==="Point"||Ie==="MultiPoint"||Ie==="LineString")je=jo(Oe.geometry,ie);else if(Ie==="MultiLineString"||Ie==="Polygon"){je=[];for(const rt of Oe.geometry)je.push(jo(rt,ie))}else if(Ie==="MultiPolygon"){je=[];for(const rt of Oe.geometry){const $e=[];for(const at of rt)$e.push(jo(at,ie));je.push($e)}}ae.push(Do(Oe.id,Ie,je,Oe.tags))}return ae}function jo(ut,ie){const ae=[];ae.size=ut.size,ut.start!==void 0&&(ae.start=ut.start,ae.end=ut.end);for(let we=0;we<ut.length;we+=3)ae.push(ut[we]+ie,ut[we+1],ut[we+2]);return ae}function qi(ut,ie){if(ut.transformed)return ut;const ae=1<<ut.z,we=ut.x,Oe=ut.y;for(const Ie of ut.features){const je=Ie.geometry,rt=Ie.type;if(Ie.geometry=[],rt===1)for(let $e=0;$e<je.length;$e+=2)Ie.geometry.push(ra(je[$e],je[$e+1],ie,ae,we,Oe));else for(let $e=0;$e<je.length;$e++){const at=[];for(let Ye=0;Ye<je[$e].length;Ye+=2)at.push(ra(je[$e][Ye],je[$e][Ye+1],ie,ae,we,Oe));Ie.geometry.push(at)}}return ut.transformed=!0,ut}function ra(ut,ie,ae,we,Oe,Ie){return[Math.round(ae*(ut*we-Oe)),Math.round(ae*(ie*we-Ie))]}function xe(ut,ie,ae,we,Oe){const Ie=ie===Oe.maxZoom?0:Oe.tolerance/((1<<ie)*Oe.extent),je={features:[],numPoints:0,numSimplified:0,numFeatures:ut.length,source:null,x:ae,y:we,z:ie,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const rt of ut)it(je,rt,Ie,Oe);return je}function it(ut,ie,ae,we){const Oe=ie.geometry,Ie=ie.type,je=[];if(ut.minX=Math.min(ut.minX,ie.minX),ut.minY=Math.min(ut.minY,ie.minY),ut.maxX=Math.max(ut.maxX,ie.maxX),ut.maxY=Math.max(ut.maxY,ie.maxY),Ie==="Point"||Ie==="MultiPoint")for(let rt=0;rt<Oe.length;rt+=3)je.push(Oe[rt],Oe[rt+1]),ut.numPoints++,ut.numSimplified++;else if(Ie==="LineString")yn(je,Oe,ut,ae,!1,!1);else if(Ie==="MultiLineString"||Ie==="Polygon")for(let rt=0;rt<Oe.length;rt++)yn(je,Oe[rt],ut,ae,Ie==="Polygon",rt===0);else if(Ie==="MultiPolygon")for(let rt=0;rt<Oe.length;rt++){const $e=Oe[rt];for(let at=0;at<$e.length;at++)yn(je,$e[at],ut,ae,!0,at===0)}if(je.length){let rt=ie.tags||null;if(Ie==="LineString"&&we.lineMetrics){rt={};for(const at in ie.tags)rt[at]=ie.tags[at];rt.mapbox_clip_start=Oe.start/Oe.size,rt.mapbox_clip_end=Oe.end/Oe.size}const $e={geometry:je,type:Ie==="Polygon"||Ie==="MultiPolygon"?3:Ie==="LineString"||Ie==="MultiLineString"?2:1,tags:rt};ie.id!==null&&($e.id=ie.id),ut.features.push($e)}}function yn(ut,ie,ae,we,Oe,Ie){const je=we*we;if(we>0&&ie.size<(Oe?je:we))return void(ae.numPoints+=ie.length/3);const rt=[];for(let $e=0;$e<ie.length;$e+=3)(we===0||ie[$e+2]>je)&&(ae.numSimplified++,rt.push(ie[$e],ie[$e+1])),ae.numPoints++;Oe&&function($e,at){let Ye=0;for(let ct=0,At=$e.length,Qt=At-2;ct<At;Qt=ct,ct+=2)Ye+=($e[ct]-$e[Qt])*($e[ct+1]+$e[Qt+1]);if(Ye>0===at)for(let ct=0,At=$e.length;ct<At/2;ct+=2){const Qt=$e[ct],on=$e[ct+1];$e[ct]=$e[At-2-ct],$e[ct+1]=$e[At-1-ct],$e[At-2-ct]=Qt,$e[At-1-ct]=on}}(rt,Ie),ut.push(rt)}const Sn={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class kn{constructor(ie,ae){const we=(ae=this.options=function(Ie,je){for(const rt in je)Ie[rt]=je[rt];return Ie}(Object.create(Sn),ae)).debug;if(we&&console.time("preprocess data"),ae.maxZoom<0||ae.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ae.promoteId&&ae.generateId)throw new Error("promoteId and generateId cannot be used together.");let Oe=function(Ie,je){const rt=[];if(Ie.type==="FeatureCollection")for(let $e=0;$e<Ie.features.length;$e++)Wi(rt,Ie.features[$e],je,$e);else Wi(rt,Ie.type==="Feature"?Ie:{geometry:Ie},je);return rt}(ie,ae);this.tiles={},this.tileCoords=[],we&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ae.indexMaxZoom,ae.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Oe=function(Ie,je){const rt=je.buffer/je.extent;let $e=Ie;const at=mo(Ie,1,-1-rt,rt,0,-1,2,je),Ye=mo(Ie,1,1-rt,2+rt,0,-1,2,je);return(at||Ye)&&($e=mo(Ie,1,-rt,1+rt,0,-1,2,je)||[],at&&($e=ks(at,1).concat($e)),Ye&&($e=$e.concat(ks(Ye,-1)))),$e}(Oe,ae),Oe.length&&this.splitTile(Oe,0,0,0),we&&(Oe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ie,ae,we,Oe,Ie,je,rt){const $e=[ie,ae,we,Oe],at=this.options,Ye=at.debug;for(;$e.length;){Oe=$e.pop(),we=$e.pop(),ae=$e.pop(),ie=$e.pop();const ct=1<<ae,At=br(ae,we,Oe);let Qt=this.tiles[At];if(!Qt&&(Ye>1&&console.time("creation"),Qt=this.tiles[At]=xe(ie,ae,we,Oe,at),this.tileCoords.push({z:ae,x:we,y:Oe}),Ye)){Ye>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ae,we,Oe,Qt.numFeatures,Qt.numPoints,Qt.numSimplified),console.timeEnd("creation"));const Or=`z${ae}`;this.stats[Or]=(this.stats[Or]||0)+1,this.total++}if(Qt.source=ie,Ie==null){if(ae===at.indexMaxZoom||Qt.numPoints<=at.indexMaxPoints)continue}else{if(ae===at.maxZoom||ae===Ie)continue;if(Ie!=null){const Or=Ie-ae;if(we!==je>>Or||Oe!==rt>>Or)continue}}if(Qt.source=null,ie.length===0)continue;Ye>1&&console.time("clipping");const on=.5*at.buffer/at.extent,Nn=.5-on,jn=.5+on,Un=1+on;let zn=null,Wr=null,si=null,Qn=null,Ar=mo(ie,ct,we-on,we+jn,0,Qt.minX,Qt.maxX,at),Rr=mo(ie,ct,we+Nn,we+Un,0,Qt.minX,Qt.maxX,at);ie=null,Ar&&(zn=mo(Ar,ct,Oe-on,Oe+jn,1,Qt.minY,Qt.maxY,at),Wr=mo(Ar,ct,Oe+Nn,Oe+Un,1,Qt.minY,Qt.maxY,at),Ar=null),Rr&&(si=mo(Rr,ct,Oe-on,Oe+jn,1,Qt.minY,Qt.maxY,at),Qn=mo(Rr,ct,Oe+Nn,Oe+Un,1,Qt.minY,Qt.maxY,at),Rr=null),Ye>1&&console.timeEnd("clipping"),$e.push(zn||[],ae+1,2*we,2*Oe),$e.push(Wr||[],ae+1,2*we,2*Oe+1),$e.push(si||[],ae+1,2*we+1,2*Oe),$e.push(Qn||[],ae+1,2*we+1,2*Oe+1)}}getTile(ie,ae,we){ie=+ie,ae=+ae,we=+we;const Oe=this.options,{extent:Ie,debug:je}=Oe;if(ie<0||ie>24)return null;const rt=1<<ie,$e=br(ie,ae=ae+rt&rt-1,we);if(this.tiles[$e])return qi(this.tiles[$e],Ie);je>1&&console.log("drilling down to z%d-%d-%d",ie,ae,we);let at,Ye=ie,ct=ae,At=we;for(;!at&&Ye>0;)Ye--,ct>>=1,At>>=1,at=this.tiles[br(Ye,ct,At)];return at&&at.source?(je>1&&(console.log("found parent tile z%d-%d-%d",Ye,ct,At),console.time("drilling down")),this.splitTile(at.source,Ye,ct,At,ie,ae,we),je>1&&console.timeEnd("drilling down"),this.tiles[$e]?qi(this.tiles[$e],Ie):null):null}}function br(ut,ie,ae){return 32*((1<<ut)*ae+ie)+ut}function wr(ut,ie){const ae=ut.tileID.canonical;if(!this._geoJSONIndex)return void ie(null,null);const we=this._geoJSONIndex.getTile(ae.z,ae.x,ae.y);if(!we)return void ie(null,null);const Oe=new cn(we.features);let Ie=pn(Oe);Ie.byteOffset===0&&Ie.byteLength===Ie.buffer.byteLength||(Ie=new Uint8Array(Ie)),ie(null,{vectorTile:Oe,rawData:Ie.buffer})}class Br extends Pe{constructor(ie,ae,we,Oe,Ie,je){super(ie,ae,we,Oe,wr,je),Ie&&(this.loadGeoJSON=Ie),this._dynamicIndex=new Ut}loadData(ie,ae){const we=ie&&ie.request,Oe=we&&we.collectResourceTiming;this.loadGeoJSON(ie,(Ie,je)=>{if(Ie||!je)return ae(Ie);if(typeof je!="object")return ae(new Error(`Input data given to '${ie.source}' is not a valid GeoJSON object.`));{try{if(ie.filter){const $e=a.X(ie.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if($e.result==="error")throw new Error($e.value.map(at=>`${at.key}: ${at.message}`).join(", "));je.features=je.features.filter(at=>$e.value.evaluate({zoom:0},at))}ie.dynamic?(je.type==="Feature"&&(je={type:"FeatureCollection",features:[je]}),ie.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(je.features,this.loaded),ie.cluster&&(je.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ie.cluster?new Yr(function({superclusterOptions:$e,clusterProperties:at}){if(!at||!$e)return $e;const Ye={},ct={},At={accumulated:null,zoom:0},Qt={properties:null},on=Object.keys(at);for(const Nn of on){const[jn,Un]=at[Nn],zn=a.X(Un),Wr=a.X(typeof jn=="string"?[jn,["accumulated"],["get",Nn]]:jn);Ye[Nn]=zn.value,ct[Nn]=Wr.value}return $e.map=Nn=>{Qt.properties=Nn;const jn={};for(const Un of on)jn[Un]=Ye[Un].evaluate(At,Qt);return jn},$e.reduce=(Nn,jn)=>{Qt.properties=jn;for(const Un of on)At.accumulated=Nn[Un],Nn[Un]=ct[Un].evaluate(At,Qt)},$e}(ie)).load(je.features):ie.dynamic?this._dynamicIndex:function($e,at){return new kn($e,at)}(je,ie.geojsonVtOptions)}catch($e){return ae($e)}const rt={};if(Oe){const $e=ee(we);$e&&(rt.resourceTiming={},rt.resourceTiming[ie.source]=JSON.parse(JSON.stringify($e)))}ae(null,rt)}})}reloadTile(ie,ae){const we=this.loaded;return we&&we[ie.uid]?ie.partial?ae(null,void 0):super.reloadTile(ie,ae):this.loadTile(ie,ae)}loadGeoJSON(ie,ae){if(ie.request)a.n(ie.request,ae);else{if(typeof ie.data!="string")return ae(new Error(`Input data given to '${ie.source}' is not a valid GeoJSON object.`));try{return ae(null,JSON.parse(ie.data))}catch{return ae(new Error(`Input data given to '${ie.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ie,ae){try{ae(null,this._geoJSONIndex.getClusterExpansionZoom(ie.clusterId))}catch(we){ae(we)}}getClusterChildren(ie,ae){try{ae(null,this._geoJSONIndex.getChildren(ie.clusterId))}catch(we){ae(we)}}getClusterLeaves(ie,ae){try{ae(null,this._geoJSONIndex.getLeaves(ie.clusterId,ie.limit,ie.offset))}catch(we){ae(we)}}}class Er{constructor(ie,ae){this.tileID=new a.aH(ie.tileID.overscaledZ,ie.tileID.wrap,ie.tileID.canonical.z,ie.tileID.canonical.x,ie.tileID.canonical.y),this.tileZoom=ie.tileZoom,this.uid=ie.uid,this.zoom=ie.zoom,this.canonical=ie.tileID.canonical,this.pixelRatio=ie.pixelRatio,this.tileSize=ie.tileSize,this.source=ie.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ie.projection,this.brightness=ae}parse(ie,ae,we,Oe){this.status="parsing";const Ie=new a.aH(we.tileID.overscaledZ,we.tileID.wrap,we.tileID.canonical.z,we.tileID.canonical.x,we.tileID.canonical.y),je=[],rt=ae.familiesBySource[we.source],$e=new a.e0(Ie,we.promoteId);return $e.bucketLayerIDs=[],$e.is3DTile=!0,a.ei(ie).then(at=>{if(!at)return Oe(new Error("Could not parse tile"));const Ye=a.ej(at,1/a.cd(we.tileID.canonical)),ct=at.json.extensionsUsed&&at.json.extensionsUsed.includes("MAPBOX_mesh_features")||at.json.asset.extras&&at.json.asset.extras.MAPBOX_mesh_features,At=at.json.extensionsUsed&&at.json.extensionsUsed.includes("EXT_meshopt_compression"),Qt=new a.aa(this.zoom,{brightness:this.brightness});for(const on in rt)for(const Nn of rt[on]){const jn=Nn[0];$e.bucketLayerIDs.push(Nn.map(zn=>a.C(zn.id,zn.scope))),jn.recalculate(Qt,[]);const Un=new a.ek(Nn,Ye,Ie,ct,At,this.brightness,$e);ct||(Un.needsUpload=!0),je.push(Un),Un.evaluate(jn)}this.status="done",Oe(null,{buckets:je,featureIndex:$e,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(at=>Oe(new Error(at.message)))}}class no{constructor(ie,ae,we,Oe,Ie,je){this.actor=ie,this.layerIndex=ae,this.availableImages=we,this.brightness=je,this.loading={},this.loaded={}}loadTile(ie,ae){const we=ie.uid,Oe=this.loading[we]=new Er(ie,this.brightness);a.bj(ie.request,(Ie,je)=>{const rt=!this.loading[we];return delete this.loading[we],rt||Ie?(Oe.status="done",rt||(this.loaded[we]=Oe),ae(Ie)):je&&je.byteLength!==0?void Oe.parse(je,this.layerIndex,ie,($e,at)=>{Oe.status="done",this.loaded=this.loaded||{},this.loaded[we]=Oe,$e||!at?ae($e):ae(null,at)}):(Oe.status="done",this.loaded[we]=Oe,ae())})}reloadTile(ie,ae){const we=this.loaded,Oe=ie.uid;if(we&&we[Oe]){const Ie=we[Oe];Ie.projection=ie.projection,Ie.brightness=ie.brightness;const je=(rt,$e)=>{Ie.reloadCallback&&(delete Ie.reloadCallback,this.loadTile(ie,ae)),ae(rt,$e)};Ie.status==="parsing"?Ie.reloadCallback=je:Ie.status==="done"&&this.loadTile(ie,ae)}}abortTile(ie,ae){const we=ie.uid;this.loading[we]&&delete this.loading[we],ae()}removeTile(ie,ae){const we=this.loaded,Oe=ie.uid;we&&we[Oe]&&delete we[Oe],ae()}}class ia{constructor(ie){this.self=ie,this.actor=new a.el(ie,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new a.y,this.projections={},this.defaultProjection=a.bP({name:"mercator"}),this.workerSourceTypes={vector:Pe,geojson:Br,"raster-dem":We,"raster-array":wt,"batched-model":no},this.workerSources={},this.self.registerWorkerSource=(ae,we)=>{if(this.workerSourceTypes[ae])throw new Error(`Worker source with name "${ae}" already registered.`);this.workerSourceTypes[ae]=we},this.self.registerRTLTextPlugin=ae=>{if(a.em.isParsed())throw new Error("RTL text plugin already registered.");a.em.applyArabicShaping=ae.applyArabicShaping,a.em.processBidirectionalText=ae.processBidirectionalText,a.em.processStyledBidirectionalText=ae.processStyledBidirectionalText}}clearCaches(ie,ae,we){delete this.layerIndexes[ie],delete this.availableImages[ie],delete this.workerSources[ie],we()}checkIfReady(ie,ae,we){we()}setReferrer(ie,ae){this.referrer=ae}spriteLoaded(ie,{scope:ae,isLoaded:we}){if(this.isSpriteLoaded[ie]||(this.isSpriteLoaded[ie]={}),this.isSpriteLoaded[ie][ae]=we,this.workerSources[ie]&&this.workerSources[ie][ae])for(const Oe in this.workerSources[ie][ae]){const Ie=this.workerSources[ie][ae][Oe];for(const je in Ie){const rt=Ie[je];rt instanceof Pe&&(rt.isSpriteLoaded=we,rt.fire(new a.A("isSpriteLoaded")))}}}setImages(ie,{scope:ae,images:we},Oe){if(this.availableImages[ie]||(this.availableImages[ie]={}),this.availableImages[ie][ae]=we,this.workerSources[ie]&&this.workerSources[ie][ae]){for(const Ie in this.workerSources[ie][ae]){const je=this.workerSources[ie][ae][Ie];for(const rt in je)je[rt].availableImages=we}Oe()}else Oe()}setProjection(ie,ae){this.projections[ie]=a.bP(ae)}setBrightness(ie,ae,we){this.brightness=ae,we()}setLayers(ie,ae,we){this.getLayerIndex(ie,ae.scope).replace(ae.layers,ae.options),we()}updateLayers(ie,ae,we){this.getLayerIndex(ie,ae.scope).update(ae.layers,ae.removedIds,ae.options),we()}loadTile(ie,ae,we){ae.projection=this.projections[ie]||this.defaultProjection,this.getWorkerSource(ie,ae.type,ae.source,ae.scope).loadTile(ae,we)}decodeRasterArray(ie,ae,we){this.getWorkerSource(ie,ae.type,ae.source,ae.scope).decodeRasterArray(ae,we)}reloadTile(ie,ae,we){ae.projection=this.projections[ie]||this.defaultProjection,this.getWorkerSource(ie,ae.type,ae.source,ae.scope).reloadTile(ae,we)}abortTile(ie,ae,we){this.getWorkerSource(ie,ae.type,ae.source,ae.scope).abortTile(ae,we)}removeTile(ie,ae,we){this.getWorkerSource(ie,ae.type,ae.source,ae.scope).removeTile(ae,we)}removeSource(ie,ae,we){if(!(this.workerSources[ie]&&this.workerSources[ie][ae.scope]&&this.workerSources[ie][ae.scope][ae.type]&&this.workerSources[ie][ae.scope][ae.type][ae.source]))return;const Oe=this.workerSources[ie][ae.scope][ae.type][ae.source];delete this.workerSources[ie][ae.scope][ae.type][ae.source],Oe.removeSource!==void 0?Oe.removeSource(ae,we):we()}loadWorkerSource(ie,ae,we){try{this.self.importScripts(ae.url),we()}catch(Oe){we(Oe.toString())}}syncRTLPluginState(ie,ae,we){try{a.em.setState(ae);const Oe=a.em.getPluginURL();if(a.em.isLoaded()&&!a.em.isParsed()&&Oe!=null){this.self.importScripts(Oe);const Ie=a.em.isParsed();we(Ie?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Oe}`),Ie)}}catch(Oe){we(Oe.toString())}}setDracoUrl(ie,ae){this.dracoUrl=ae}getAvailableImages(ie,ae){this.availableImages[ie]||(this.availableImages[ie]={});let we=this.availableImages[ie][ae];return we||(we=[]),we}getLayerIndex(ie,ae){this.layerIndexes[ie]||(this.layerIndexes[ie]={});let we=this.layerIndexes[ie][ae];return we||(we=this.layerIndexes[ie][ae]=new ge,we.scope=ae),we}getWorkerSource(ie,ae,we,Oe){const Ie=this.workerSources;return Ie[ie]||(Ie[ie]={}),Ie[ie][Oe]||(Ie[ie][Oe]={}),Ie[ie][Oe][ae]||(Ie[ie][Oe][ae]={}),this.isSpriteLoaded[ie]||(this.isSpriteLoaded[ie]={}),Ie[ie][Oe][ae][we]||(Ie[ie][Oe][ae][we]=new this.workerSourceTypes[ae]({send:(je,rt,$e,at,Ye,ct)=>{this.actor.send(je,rt,$e,ie,Ye,ct)},scheduler:this.actor.scheduler},this.getLayerIndex(ie,Oe),this.getAvailableImages(ie,Oe),this.isSpriteLoaded[ie][Oe],void 0,this.brightness)),Ie[ie][Oe][ae][we]}rasterizeImages(ie,ae,we){const Oe=new Map;for(const[Ie,{image:je,imageVariant:rt}]of ae.tasks.entries()){const $e=this.imageRasterizer.rasterize(rt,je,ae.scope,ie);Oe.set(Ie,$e)}we(void 0,Oe)}removeRasterizedImages(ie,ae,we){this.imageRasterizer.removeImagesFromCacheByIds(ae.imageIds,ae.scope,ie),we()}enforceCacheSizeLimit(ie,ae){a.en(ae)}getWorkerPerformanceMetrics(ie,ae,we){we(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ia(self)),ia}),$(["./shared"],function(a){var ee="3.11.1";const se={create:"create",load:"load",fullLoad:"fullLoad"},fe={mark(h){performance.mark(h)},measure(h,t,i){performance.measure(h,t,i)}};function ge(h){const t=h.name.split("?")[0];return a.a(t)&&t.includes("mapbox-gl.js")?"javascript":a.a(t)&&t.includes("mapbox-gl.css")?"css":a.b(t)?"fontRange":a.c(t)?"sprite":a.i(t)?"style":a.d(t)?"tilejson":"other"}var le,ke={},Re=function(){if(le)return ke;function h(d){return!t(d)}function t(d){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,w,R=new Blob([""],{type:"text/javascript"}),N=URL.createObjectURL(R);try{w=new Worker(N),v=!0}catch{v=!1}return w&&w.terminate(),URL.revokeObjectURL(N),v}()?function(){var v=document.createElement("canvas");v.width=v.height=1;var w=v.getContext("2d");if(!w)return!1;var R=w.getImageData(0,0,1,1);return R&&R.width===v.width}()?(i[m=d&&d.failIfMajorPerformanceCaveat]===void 0&&(i[m]=function(v){var w,R=function(N){var P=document.createElement("canvas"),F=Object.create(h.webGLContextAttributes);return F.failIfMajorPerformanceCaveat=N,P.getContext("webgl2",F)}(v);if(!R)return!1;try{w=R.createShader(R.VERTEX_SHADER)}catch{return!1}return!(!w||R.isContextLost())&&(R.shaderSource(w,"void main() {}"),R.compileShader(w),R.getShaderParameter(w,R.COMPILE_STATUS)===!0)}(m)),i[m]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var m}le=1,ke.supported=h,ke.notSupportedReason=t;var i={};return h.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},ke}();function Ue(h,t,i){const d=document.createElement(h);return t!=null&&(d.className=t),i&&i.appendChild(d),d}function Pe(h,t,i){const d=document.createElementNS("http://www.w3.org/2000/svg",h);for(const m of Object.keys(t))d.setAttributeNS(null,m,String(t[m]));return i&&i.appendChild(d),d}const We=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Tt=We&&We.userSelect!==void 0?"userSelect":"WebkitUserSelect";let wt;function St(){We&&Tt&&(wt=We[Tt],We[Tt]="none")}function Xt(){We&&Tt&&(We[Tt]=wt)}function cn(h){h.preventDefault(),h.stopPropagation(),window.removeEventListener("click",cn,!0)}function xt(){window.addEventListener("click",cn,!0),window.setTimeout(()=>{window.removeEventListener("click",cn,!0)},0)}function rn(h,t){const i=h.getBoundingClientRect();return Rt(h,i,t)}function Ut(h,t){const i=h.getBoundingClientRect(),d=[];for(let m=0;m<t.length;m++)d.push(Rt(h,i,t[m]));return d}function Yt(h){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&h.button===2&&h.ctrlKey?0:h.button}function Rt(h,t,i){const d=h.offsetWidth===t.width?1:h.offsetWidth/t.width;return new a.P((i.clientX-t.left)*d,(i.clientY-t.top)*d)}const ln="01",An="NO_ACCESS_TOKEN";class mn{constructor(t,i,d){this._transformRequestFn=t,this._customAccessToken=i,this._silenceAuthErrors=!!d,this._createSkuToken()}_createSkuToken(){const t=function(){let i="";for(let d=0;d<10;d++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ln,i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,i){return this._transformRequestFn&&this._transformRequestFn(t,i)||{url:t}}normalizeStyleURL(t,i){if(!a.f(t))return t;const d=Nt(t);return d.params.push(`sdk=js-${ee}`),d.path=`/styles/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||i)}normalizeGlyphsURL(t,i){if(!a.f(t))return t;const d=Nt(t);return d.path=`/fonts/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||i)}normalizeModelURL(t,i){if(!a.f(t))return t;const d=Nt(t);return d.path=`/models/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||i)}normalizeSourceURL(t,i,d,m){if(!a.f(t))return t;const v=Nt(t);return v.path=`/v4/${v.authority}.json`,v.params.push("secure"),d&&v.params.push(`language=${d}`),m&&v.params.push(`worldview=${m}`),this._makeAPIURL(v,this._customAccessToken||i)}normalizeIconsetURL(t,i){const d=Nt(t);return a.f(t)?(d.path=`/styles/v1${d.path}/iconset.pbf`,this._makeAPIURL(d,this._customAccessToken||i)):Kt(d)}normalizeSpriteURL(t,i,d,m){const v=Nt(t);return a.f(t)?(v.path=`/styles/v1${v.path}/sprite${i}${d}`,this._makeAPIURL(v,this._customAccessToken||m)):(v.path+=`${i}${d}`,Kt(v))}normalizeTileURL(t,i,d){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!a.f(t))return t;const m=Nt(t);m.path=m.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||d&&m.authority!=="raster"&&d===512?"@2x":""}${a.m.supported?".webp":"$1"}`),m.authority==="raster"?m.path=`/${a.e.RASTER_URL_PREFIX}${m.path}`:m.authority==="rasterarrays"?m.path=`/${a.e.RASTERARRAYS_URL_PREFIX}${m.path}`:m.authority==="3dtiles"?m.path=`/${a.e.TILES3D_URL_PREFIX}${m.path}`:(m.path=m.path.replace(/^.+\/v4\//,"/"),m.path=`/${a.e.TILE_URL_VERSION}${m.path}`);const v=this._customAccessToken||function(w){for(const R of w){const N=R.match(/^access_token=(.*)$/);if(N)return N[1]}return null}(m.params)||a.e.ACCESS_TOKEN;return a.e.REQUIRE_ACCESS_TOKEN&&v&&this._skuToken&&m.params.push(`sku=${this._skuToken}`),this._makeAPIURL(m,v)}canonicalizeTileURL(t,i){const d=Nt(t);if(!d.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!d.path.match(/\.[\w]+$/))return t;let m="mapbox://";d.path.match(/^\/raster\/v1\//)?m+=`raster/${d.path.replace(`/${a.e.RASTER_URL_PREFIX}/`,"")}`:d.path.match(/^\/rasterarrays\/v1\//)?m+=`rasterarrays/${d.path.replace(`/${a.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:m+=`tiles/${d.path.replace(`/${a.e.TILE_URL_VERSION}/`,"")}`;let v=d.params;return i&&(v=v.filter(w=>!w.match(/^access_token=/))),v.length&&(m+=`?${v.join("&")}`),m}canonicalizeTileset(t,i){const d=!!i&&a.f(i),m=[];for(const v of t.tiles||[])a.h(v)?m.push(this.canonicalizeTileURL(v,d)):m.push(v);return m}_makeAPIURL(t,i){const d="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",m=Nt(a.e.API_URL);if(t.protocol=m.protocol,t.authority=m.authority,t.protocol==="http"){const v=t.params.indexOf("secure");v>=0&&t.params.splice(v,1)}if(m.path!=="/"&&(t.path=`${m.path}${t.path}`),!a.e.REQUIRE_ACCESS_TOKEN)return Kt(t);if(i=i||a.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${d}`);if(i[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${d}`)}return t.params=t.params.filter(v=>v.indexOf("access_token")===-1),t.params.push(`access_token=${i||""}`),Kt(t)}}const $t=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Nt(h){const t=h.match($t);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Kt(h){const t=h.params.length?`?${h.params.join("&")}`:"";return`${h.protocol}://${h.authority}${h.path}${t}`}const It="mapbox.eventData";function sn(h){if(!h)return null;const t=h.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(a.j(t[1]))}catch{return null}}class tt{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const i=sn(a.e.ACCESS_TOKEN);let d="";return d=i&&i.u?a.k(i.u):a.e.ACCESS_TOKEN||"",t?`${It}.${t}:${d}`:`${It}:${d}`}fetchEventData(){const t=a.s("localStorage"),i=this.getStorageKey(),d=this.getStorageKey("uuid");if(t)try{const m=localStorage.getItem(i);m&&(this.eventData=JSON.parse(m));const v=localStorage.getItem(d);v&&(this.anonId=v)}catch{a.w("Unable to read from LocalStorage")}}saveEventData(){const t=a.s("localStorage"),i=this.getStorageKey(),d=this.getStorageKey("uuid"),m=this.anonId;if(t&&m)try{localStorage.setItem(d,m),Object.keys(this.eventData).length>=1&&localStorage.setItem(i,JSON.stringify(this.eventData))}catch{a.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,i,d,m){if(!a.e.EVENTS_URL)return;const v=Nt(a.e.EVENTS_URL);v.params.push(`access_token=${m||a.e.ACCESS_TOKEN||""}`);const w={event:this.type,created:new Date(t).toISOString()},R=i?a.l(w,i):w,N={url:Kt(v),headers:{"Content-Type":"text/plain"},body:JSON.stringify([R])};this.pendingRequest=a.p(N,P=>{this.pendingRequest=null,d(P),this.saveEventData(),this.processRequests(m)})}queueRequest(t,i){this.queue.push(t),this.processRequests(i)}}const un=new class extends tt{constructor(h){super("appUserTurnstile"),this._customAccessToken=h}postTurnstileEvent(h,t){a.e.EVENTS_URL&&a.e.ACCESS_TOKEN&&Array.isArray(h)&&h.some(i=>a.f(i)||a.h(i))&&this.queueRequest(Date.now(),t)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=sn(a.e.ACCESS_TOKEN),i=t?t.u:a.e.ACCESS_TOKEN;let d=i!==this.eventData.tokenU;a.v(this.anonId)||(this.anonId=a.u(),d=!0);const m=this.queue.shift();if(this.eventData.lastSuccess){const v=new Date(this.eventData.lastSuccess),w=new Date(m),R=(m-this.eventData.lastSuccess)/864e5;d=d||R>=1||R<-1||v.getDate()!==w.getDate()}else d=!0;d?this.postEvent(m,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ee,skuId:ln,"enabled.telemetry":!1,userId:this.anonId},v=>{v||(this.eventData.lastSuccess=m,this.eventData.tokenU=i)},h):this.processRequests()}},pn=un.postTurnstileEvent.bind(un),Vt=new class extends tt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(h,t,i,d){this.skuToken=t,this.errorCb=d,a.e.EVENTS_URL&&(i||a.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},i):this.errorCb(new Error(An)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),a.v(this.anonId)||(this.anonId=a.u()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ee,skuId:ln,skuToken:this.skuToken,userId:this.anonId},d=>{d?this.errorCb(d):t&&(this.success[t]=!0)},h))}remove(){this.errorCb=null}},ir=Vt.postMapLoadEvent.bind(Vt),Nr=new class extends tt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(h){let t=this.mapInstanceIdMap.get(h);return t||(t=a.u(),this.mapInstanceIdMap.set(h,t)),t}getEventId(h){const t=this.eventIdPerMapInstanceMap.get(h)||0;return this.eventIdPerMapInstanceMap.set(h,t+1),t}postStyleLoadEvent(h,t){const{map:i,style:d,importedStyles:m}=t;if(!a.e.EVENTS_URL||!h&&!a.e.ACCESS_TOKEN)return;const v=this.getMapInstanceId(i),w={mapInstanceId:v,eventId:this.getEventId(v),style:d};m.length&&(w.importedStyles=m),this.queueRequest({timestamp:Date.now(),payload:w},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:i}=this.queue.shift();this.postEvent(t,i,()=>{},h)}},rr=Nr.postStyleLoadEvent.bind(Nr),kr=new class extends tt{constructor(){super("gljs.performance")}postPerformanceEvent(h,t){a.e.EVENTS_URL&&(h||a.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:i}=this.queue.shift(),d=function(m){const v=performance.getEntriesByType("resource"),w=performance.getEntriesByType("mark"),R=function(Z){const Q={};if(Z){for(const K in Z)if(K!=="other")for(const te of Z[K]){const re=`${K}ResolveRangeMin`,pe=`${K}ResolveRangeMax`,be=`${K}RequestCount`,ye=`${K}RequestCachedCount`;Q[re]=Math.min(Q[re]||1/0,te.startTime),Q[pe]=Math.max(Q[pe]||-1/0,te.responseEnd);const Ae=ve=>{Q[ve]===void 0&&(Q[ve]=0),++Q[ve]};te.transferSize!==void 0&&te.transferSize===0&&Ae(ye),Ae(be)}}return Q}(function(Z,Q){const K={};if(Z)for(const te of Z){const re=Q(te);K[re]===void 0&&(K[re]=[]),K[re].push(te)}return K}(v,ge)),N=window.devicePixelRatio,P=navigator.connection||navigator.mozConnection||navigator.webkitConnection,F=P?P.effectiveType:void 0,V={counters:[],metadata:[],attributes:[]},j=(Z,Q,K)=>{K!=null&&Z.push({name:Q,value:K.toString()})};for(const Z in R)j(V.counters,Z,R[Z]);if(m.interactionRange[0]!==1/0&&m.interactionRange[1]!==-1/0&&(j(V.counters,"interactionRangeMin",m.interactionRange[0]),j(V.counters,"interactionRangeMax",m.interactionRange[1])),w)for(const Z of Object.keys(se)){const Q=se[Z],K=w.find(te=>te.name===Q);K&&j(V.counters,Q,K.startTime)}return j(V.counters,"visibilityHidden",m.visibilityHidden),j(V.attributes,"style",function(Z){if(Z)for(const Q of Z){const K=Q.name.split("?")[0];if(a.i(K)){const te=K.split("/").slice(-2);if(te.length===2)return`mapbox://styles/${te[0]}/${te[1]}`}}}(v)),j(V.attributes,"terrainEnabled",m.terrainEnabled?"true":"false"),j(V.attributes,"fogEnabled",m.fogEnabled?"true":"false"),j(V.attributes,"projection",m.projection),j(V.attributes,"zoom",m.zoom),j(V.metadata,"devicePixelRatio",N),j(V.metadata,"connectionEffectiveType",F),j(V.metadata,"navigatorUserAgent",navigator.userAgent),j(V.metadata,"screenWidth",window.screen.width),j(V.metadata,"screenHeight",window.screen.height),j(V.metadata,"windowWidth",window.innerWidth),j(V.metadata,"windowHeight",window.innerHeight),j(V.metadata,"mapWidth",m.width/N),j(V.metadata,"mapHeight",m.height/N),j(V.metadata,"webglRenderer",m.renderer),j(V.metadata,"webglVendor",m.vendor),j(V.metadata,"sdkVersion",ee),j(V.metadata,"sdkIdentifier","mapbox-gl-js"),V}(i);for(const m of d.metadata);for(const m of d.counters);for(const m of d.attributes);this.postEvent(t,d,()=>{},h)}},sr=kr.postPerformanceEvent.bind(kr),Yr=new class extends tt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(h,t,i,d){if(!a.e.API_URL||!a.e.SESSION_PATH)return;const m=Nt(a.e.API_URL+a.e.SESSION_PATH);m.params.push(`sku=${t||""}`),m.params.push(`access_token=${d||a.e.ACCESS_TOKEN||""}`);const v={url:Kt(m),headers:{"Content-Type":"text/plain"}};this.pendingRequest=a.g(v,w=>{this.pendingRequest=null,i(w),this.saveEventData(),this.processRequests(d)})}getSessionAPI(h,t,i,d){this.skuToken=t,this.errorCb=d,a.e.SESSION_PATH&&a.e.API_URL&&(i||a.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},i):this.errorCb(new Error(An)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||this.getSession(i,this.skuToken,d=>{d?this.errorCb(d):t&&(this.success[t]=!0)},h)}remove(){this.errorCb=null}},de=Yr.getSessionAPI.bind(Yr),po=new Set;function Uo(h,t){t?po.add(h):po.delete(h)}class ls{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,i){this._updatedSourceCaches[t]=i,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const i=t.scope;this._updatedLayers[i]=this._updatedLayers[i]||new Set,this._updatedLayers[i].add(t.id),this.setDirty()}removeLayer(t){const i=t.scope;this._removedLayers[i]=this._removedLayers[i]||{},this._updatedLayers[i]=this._updatedLayers[i]||new Set,this._removedLayers[i][t.id]=t,this._updatedLayers[i].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const i in this._updatedLayers)t[i]=t[i]||{},t[i].updatedIds=Array.from(this._updatedLayers[i].values());for(const i in this._removedLayers)t[i]=t[i]||{},t[i].removedIds=Object.keys(this._removedLayers[i]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,i){this._updatedImages[i]=this._updatedImages[i]||new Set,this._updatedImages[i].add(a.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function qt(h){const{userImage:t}=h;return!!(t&&t.render&&t.render())&&(h.data.replace(new Uint8Array(t.data.buffer)),!0)}class cs extends a.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&a.t()&&(this.imageRasterizerDispatcher=new a.D(a.x(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new a.r({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const i=this.atlasTexture.get(t);i&&(i.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,i){this.imageProviders.has(i)||this.imageProviders.set(i,new Map),this.imageProviders.get(i).set(t.id,t)}removeImageProvider(t,i){this.imageProviders.has(i)&&this.imageProviders.get(i).delete(t)}getPendingImageProviders(){const t=[];for(const i of this.imageProviders.values())for(const d of i.values())d.hasPendingRequests()&&t.push(d);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new a.y),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,i){if(this.loaded.get(i)!==t&&(this.loaded.set(i,t),t)){for(const{ids:d,callback:m}of this.requestors)this._notify(d,i,m);this.requestors=[]}}hasImage(t,i){return!!this.getImage(t,i)}getImage(t,i){return this.images.get(i).get(t.toString())}addImage(t,i,d){this._validate(t,d)&&this.images.get(i).set(t.toString(),d)}_validate(t,i){let d=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new a.z(new Error(`Image "${t.name}" has invalid "stretchX" value`))),d=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new a.z(new Error(`Image "${t.name}" has invalid "stretchY" value`))),d=!1),this._validateContent(i.content,i)||(this.fire(new a.z(new Error(`Image "${t.name}" has invalid "content" value`))),d=!1),d}_validateStretch(t,i){if(!t)return!0;let d=0;for(const m of t){if(m[0]<d||m[1]<m[0]||i<m[1])return!1;d=m[1]}return!0}_validateContent(t,i){return t?t.length!==4||!i.usvg&&(t[0]<0||i.data.width<t[0]||t[1]<0||i.data.height<t[1]||t[2]<0||i.data.width<t[2]||t[3]<0||i.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,i,d){const m=this.images.get(i).get(t.toString());d.version=m.version+1,this.images.get(i).set(t.toString(),d),this.updatedImages.get(i).add(t),this.removeFromImageRasterizerCache(t,i)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,i){if(this.spriteFormat!=="raster")if(a.t()){const d={imageIds:[t],scope:i};this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",d)}else this.imageRasterizer.removeImagesFromCacheByIds([t],i)}removeImage(t,i){const d=this.images.get(i),m=d.get(t.toString());d.delete(t.toString()),this.patterns.get(i).delete(t.toString()),this.removeFromImageRasterizerCache(t,i),m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(i=>a.I.from(i))}getImages(t,i,d){const m=[],v=[],w=this.imageProviders.get(i);for(const F of t){if(!F.iconsetId){m.push(F);continue}const V=w.get(F.iconsetId);V&&(this.getImage(F,i)?v.push(F):V.addPendingRequest(F))}if(m.length===0)return void this._notify(v,i,d);let R=!0;const N=!!this.loaded.get(i),P=this.images.get(i);if(!N)for(const F of m)P.has(F.toString())||(R=!1);N||R?this._notify(m,i,d):this.requestors.push({ids:m,scope:i,callback:d})}rasterizeImages({scope:t,tasks:i},d){const m=new Map;for(const[v,w]of i.entries()){const R=this.getImage(w.id,t);R&&m.set(v,{image:R,imageVariant:w})}this._rasterizeImages(t,m,d)}_rasterizeImages(t,i,d){if(a.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{tasks:i,scope:t},d);else{const m=new Map;for(const[v,{image:w,imageVariant:R}]of i.entries())m.set(v,this.imageRasterizer.rasterize(R,w,t,0));d(void 0,m)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,i,d){const m=this.images.get(i),v=new Map;for(const w of t){const R=m.get(w.toString());if(!R){if(w.iconsetId)continue;a.w(`Image "${w.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`),this.fire(new a.A("styleimagemissing",{id:w.name}));continue}const N={data:R.usvg?null:R.data.clone(),pixelRatio:R.pixelRatio,sdf:R.sdf,usvg:R.usvg,version:R.version,stretchX:R.stretchX,stretchY:R.stretchY,content:R.content,hasRenderCallback:!!(R.userImage&&R.userImage.render)};R.usvg&&Object.assign(N,{width:R.icon.usvg_tree.width,height:R.icon.usvg_tree.height}),v.set(a.I.toString(w),N)}d(null,v)}getPixelSize(t){const{width:i,height:d}=this.atlasImage.get(t);return{width:i,height:d}}getPattern(t,i,d){const m=t.toString(),v=this.patterns.get(i),w=v.get(m),R=this.getImage(t,i);if(!R)return null;if(w){if(w.position.version===R.version)return w.position;w.position.version=R.version}else{if(R.usvg&&!R.data){const N=this.getPatternInFlightId(m,i);if(this.patternsInFlight.has(N))return null;this.patternsInFlight.add(N);const P=new a.B(t).scaleSelf(a.q.devicePixelRatio),F=new Map([[P.toString(),{image:R,imageVariant:P}]]);return this._rasterizeImages(i,F,(V,j)=>this.storePatternImage(P,i,R,d,j)),null}this.storePattern(t,i,R)}return this._updatePatternAtlas(i,d),v.get(m).position}getPatternInFlightId(t,i){return a.C(t,i)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,i,d,m,v){const w=t.toString(),R=v?v.get(w):void 0;R&&(d.data=R,this.storePattern(t.id,i,d),this._updatePatternAtlas(i,m),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),i)))}storePattern(t,i,d){const m={w:d.data.width+2*a.F,h:d.data.height+2*a.F,x:0,y:0},v=new a.G(m,d,a.F);this.patterns.get(i).set(t.toString(),{bin:m,position:v})}bind(t,i){const d=t.gl;let m=this.atlasTexture.get(i);m?this.dirty&&(m.update(this.atlasImage.get(i)),this.dirty=!1):(m=new a.T(t,this.atlasImage.get(i),d.RGBA8),this.atlasTexture.set(i,m)),m.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(t,i){const d=this.patterns.get(t),m=Array.from(d.values()).map(({bin:P})=>P),{w:v,h:w}=a.H(m),R=this.atlasImage.get(t);R.resize({width:v||1,height:w||1});const N=this.images.get(t);for(const[P,{bin:F,position:V}]of d.entries()){let j=V.padding;const Z=F.x+j,Q=F.y+j,K=N.get(P).data,te=K.width,re=K.height;j=j>1?j-1:j,a.r.copy(K,R,{x:0,y:0},{x:Z,y:Q},{width:te,height:re},i),a.r.copy(K,R,{x:0,y:re-j},{x:Z,y:Q-j},{width:te,height:j},i),a.r.copy(K,R,{x:0,y:0},{x:Z,y:Q+re},{width:te,height:j},i),a.r.copy(K,R,{x:te-j,y:0},{x:Z-j,y:Q},{width:j,height:re},i),a.r.copy(K,R,{x:0,y:0},{x:Z+te,y:Q},{width:j,height:re},i),a.r.copy(K,R,{x:te-j,y:re-j},{x:Z-j,y:Q-j},{width:j,height:j},i),a.r.copy(K,R,{x:0,y:re-j},{x:Z+te,y:Q-j},{width:j,height:j},i),a.r.copy(K,R,{x:0,y:0},{x:Z+te,y:Q+re},{width:j,height:j},i),a.r.copy(K,R,{x:te-j,y:0},{x:Z-j,y:Q+re},{width:j,height:j},i)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,i){const d=this.images.get(i);for(const m of t){if(this.callbackDispatchedThisFrame.get(i).has(m.toString()))continue;this.callbackDispatchedThisFrame.get(i).add(m.toString());const v=d.get(m.toString());qt(v)&&this.updateImage(m,i,v)}}}function ti(h){const t=h.key,i=h.value,d=h.valueSpec||{},m=h.objectElementValidators||{},v=h.style,w=h.styleSpec;let R=[];const N=a.K(i);if(N!=="object")return[new a.V(t,i,`object expected, ${N} found`)];for(const P in i){const F=P.split(".")[0];let V;m[F]?V=m[F]:d[F]?V=it:m["*"]?V=m["*"]:d["*"]&&(V=it),V?R=R.concat(V({key:(t&&`${t}.`)+P,value:i[P],valueSpec:d[F]||d["*"],style:v,styleSpec:w,object:i,objectKey:P},i)):R.push(new a.J(t,i[P],`unknown property "${P}"`))}for(const P in d)m[P]||d[P].required&&d[P].default===void 0&&i[P]===void 0&&R.push(new a.V(t,i,`missing required property "${P}"`));return R}function Do(h){const t=h.value,i=h.valueSpec,d=h.style,m=h.styleSpec,v=h.key,w=h.arrayElementValidator||it;if(a.K(t)!=="array")return[new a.V(v,t,`array expected, ${a.K(t)} found`)];if(i.length&&t.length!==i.length)return[new a.V(v,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new a.V(v,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let R={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};m.$version<7&&(R.function=i.function),a.K(i.value)==="object"&&(R=i.value);let N=[];for(let P=0;P<t.length;P++)N=N.concat(w({array:t,arrayIndex:P,value:t[P],valueSpec:R,style:d,styleSpec:m,key:`${v}[${P}]`},!0));return N}function Jn(h){const t=h.key,i=h.value,d=h.valueSpec;let m=a.K(i);if(m==="number"&&i!=i&&(m="NaN"),m!=="number")return[new a.V(t,i,`number expected, ${m} found`)];if("minimum"in d){let v=d.minimum;if(a.K(d.minimum)==="array"&&(v=d.minimum[h.arrayIndex]),i<v)return[new a.V(t,i,`${i} is less than the minimum value ${v}`)]}if("maximum"in d){let v=d.maximum;if(a.K(d.maximum)==="array"&&(v=d.maximum[h.arrayIndex]),i>v)return[new a.V(t,i,`${i} is greater than the maximum value ${v}`)]}return[]}function Wi(h){const t=h.valueSpec,i=a.M(h.value.type);let d,m,v,w={};const R=i!=="categorical"&&h.value.property===void 0,N=!R,P=a.K(h.value.stops)==="array"&&a.K(h.value.stops[0])==="array"&&a.K(h.value.stops[0][0])==="object",F=ti({key:h.key,value:h.value,valueSpec:h.styleSpec.function,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(Z){if(i==="identity")return[new a.V(Z.key,Z.value,'identity function may not have a "stops" property')];let Q=[];const K=Z.value;return Q=Q.concat(Do({key:Z.key,value:K,valueSpec:Z.valueSpec,style:Z.style,styleSpec:Z.styleSpec,arrayElementValidator:V})),a.K(K)==="array"&&K.length===0&&Q.push(new a.V(Z.key,K,"array must have at least one stop")),Q},default:function(Z){return it({key:Z.key,value:Z.value,valueSpec:t,style:Z.style,styleSpec:Z.styleSpec})}}});return i==="identity"&&R&&F.push(new a.V(h.key,h.value,'missing required property "property"')),i==="identity"||h.value.stops||F.push(new a.V(h.key,h.value,'missing required property "stops"')),i==="exponential"&&h.valueSpec.expression&&!a.N(h.valueSpec)&&F.push(new a.V(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(N&&!a.O(h.valueSpec)?F.push(new a.V(h.key,h.value,"property functions not supported")):R&&!a.Q(h.valueSpec)&&F.push(new a.V(h.key,h.value,"zoom functions not supported"))),i!=="categorical"&&!P||h.value.property!==void 0||F.push(new a.V(h.key,h.value,'"property" property is required')),F;function V(Z){let Q=[];const K=Z.value,te=Z.key;if(a.K(K)!=="array")return[new a.V(te,K,`array expected, ${a.K(K)} found`)];if(K.length!==2)return[new a.V(te,K,`array length 2 expected, length ${K.length} found`)];if(P){if(a.K(K[0])!=="object")return[new a.V(te,K,`object expected, ${a.K(K[0])} found`)];if(K[0].zoom===void 0)return[new a.V(te,K,"object stop key must have zoom")];if(K[0].value===void 0)return[new a.V(te,K,"object stop key must have value")];const re=a.M(K[0].zoom);if(typeof re!="number")return[new a.V(te,K[0].zoom,"stop zoom values must be numbers")];if(v&&v>re)return[new a.V(te,K[0].zoom,"stop zoom values must appear in ascending order")];re!==v&&(v=re,m=void 0,w={}),Q=Q.concat(ti({key:`${te}[0]`,value:K[0],valueSpec:{zoom:{}},style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{zoom:Jn,value:j}}))}else Q=Q.concat(j({key:`${te}[0]`,value:K[0],style:Z.style,styleSpec:Z.styleSpec},K));return a.S(a.U(K[1]))?Q.concat([new a.V(`${te}[1]`,K[1],"expressions are not allowed in function stops.")]):Q.concat(it({key:`${te}[1]`,value:K[1],valueSpec:t,style:Z.style,styleSpec:Z.styleSpec}))}function j(Z,Q){const K=a.K(Z.value),te=a.M(Z.value),re=Z.value!==null?Z.value:Q;if(d){if(K!==d)return[new a.V(Z.key,re,`${K} stop domain type must match previous stop domain type ${d}`)]}else d=K;if(K!=="number"&&K!=="string"&&K!=="boolean"&&typeof te!="number"&&typeof te!="string"&&typeof te!="boolean")return[new a.V(Z.key,re,"stop domain value must be a number, string, or boolean")];if(K!=="number"&&i!=="categorical"){let pe=`number expected, ${K} found`;return a.O(t)&&i===void 0&&(pe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new a.V(Z.key,re,pe)]}return i!=="categorical"||K!=="number"||typeof te=="number"&&isFinite(te)&&Math.floor(te)===te?i!=="categorical"&&K==="number"&&typeof te=="number"&&typeof m=="number"&&m!==void 0&&te<m?[new a.V(Z.key,re,"stop domain values must appear in ascending order")]:(m=te,i==="categorical"&&te in w?[new a.V(Z.key,re,"stop domain values must be unique")]:(w[te]=!0,[])):[new a.V(Z.key,re,`integer expected, found ${String(te)}`)]}}function dr(h){const t=(h.expressionContext==="property"?a.W:a.X)(a.U(h.value),h.valueSpec);if(t.result==="error")return t.value.map(d=>new a.V(`${h.key}${d.key}`,h.value,d.message));const i=t.value.expression||t.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!i.outputDefined())return[new a.V(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!a.Y(i))return[new a.V(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter")return ea(i,h);if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!a.Z(i,["zoom","feature-state"]))return[new a.V(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!a._(i))return[new a.V(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ea(h,t){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const m of t.valueSpec.expression.parameters)i.delete(m);if(i.size===0)return[];const d=[];return h instanceof a.$&&i.has(h.name)?[new a.V(t.key,t.value,`["${h.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(h.eachChild(m=>{d.push(...ea(m,t))}),d)}function Rs(h){const t=h.key,i=h.value,d=h.valueSpec,m=[];return Array.isArray(d.values)?d.values.indexOf(a.M(i))===-1&&m.push(new a.V(t,i,`expected one of [${d.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(d.values).indexOf(a.M(i))===-1&&m.push(new a.V(t,i,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(i)} found`)),m}function ta(h){return a.a1(a.U(h.value))?dr(a.L({},h,{expressionContext:"filter",valueSpec:h.styleSpec[`filter_${h.layerType||"fill"}`]})):$n(h)}function $n(h){const t=h.value,i=h.key;if(a.K(t)!=="array")return[new a.V(i,t,`array expected, ${a.K(t)} found`)];const d=h.styleSpec;let m,v=[];if(t.length<1)return[new a.V(i,t,"filter array must have at least 1 element")];switch(v=v.concat(Rs({key:`${i}[0]`,value:t[0],valueSpec:d.filter_operator,style:h.style,styleSpec:h.styleSpec})),a.M(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&a.M(t[1])==="$type"&&v.push(new a.V(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&v.push(new a.V(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(m=a.K(t[1]),m!=="string"&&v.push(new a.V(`${i}[1]`,t[1],`string expected, ${m} found`)));for(let w=2;w<t.length;w++)m=a.K(t[w]),a.M(t[1])==="$type"?v=v.concat(Rs({key:`${i}[${w}]`,value:t[w],valueSpec:d.geometry_type,style:h.style,styleSpec:h.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&v.push(new a.V(`${i}[${w}]`,t[w],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let w=1;w<t.length;w++)v=v.concat($n({key:`${i}[${w}]`,value:t[w],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":m=a.K(t[1]),t.length!==2?v.push(new a.V(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):m!=="string"&&v.push(new a.V(`${i}[1]`,t[1],`string expected, ${m} found`))}return v}function mo(h,t){const i=h.key,d=h.style,m=h.layer,v=h.styleSpec,w=h.value,R=h.objectKey,N=v[`${t}_${h.layerType}`];if(!N)return[];const P=R.match(/^(.*)-use-theme$/);if(t==="paint"&&P&&N[P[1]])return a.S(w)?[].concat(it({key:h.key,value:w,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:d,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:R})):it({key:i,value:w,valueSpec:{type:"string"},style:d,styleSpec:v});const F=R.match(/^(.*)-transition$/);if(t==="paint"&&F&&N[F[1]]&&N[F[1]].transition)return it({key:i,value:w,valueSpec:v.transition,style:d,styleSpec:v});const V=h.valueSpec||N[R];if(!V)return[new a.J(i,w,`unknown property "${R}"`)];let j;if(a.K(w)==="string"&&a.O(V)&&!V.tokens&&(j=/^{([^}]+)}$/.exec(w))){const Q=`\`{ "type": "identity", "property": ${j?JSON.stringify(j[1]):'"_"'} }\``;return[new a.V(i,w,`"${R}" does not support interpolation syntax
Use an identity property function instead: ${Q}.`)]}const Z=[];if(h.layerType==="symbol")R!=="text-field"||!d||d.glyphs||d.imports||Z.push(new a.V(i,w,'use of "text-field" requires a style "glyphs" property')),R==="text-font"&&a.a2(a.U(w))&&a.M(w.type)==="identity"&&Z.push(new a.V(i,w,'"text-font" does not support identity functions'));else if(h.layerType==="model"&&t==="paint"&&m&&m.layout&&m.layout.hasOwnProperty("model-id")&&a.O(V)&&(a.a3(V)||a.Q(V))){const Q=a.W(a.U(w),V),K=Q.value.expression||Q.value._styleExpression.expression;K&&!a.Z(K,["measure-light"])&&(R==="model-emissive-strength"&&a._(K)&&a.Y(K)||Z.push(new a.V(i,w,`${R} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return Z.concat(it({key:h.key,value:w,valueSpec:V,style:d,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:R}))}function Fa(h){return mo(h,"paint")}function Ua(h){return mo(h,"layout")}function ao(h){let t=[];const i=h.value,d=h.key,m=h.style,v=h.styleSpec;i.type||i.ref||t.push(new a.V(d,i,'either "type" or "ref" is required'));let w=a.M(i.type);const R=a.M(i.ref);if(i.id){const N=a.M(i.id);for(let P=0;P<h.arrayIndex;P++){const F=m.layers[P];a.M(F.id)===N&&t.push(new a.V(d,i.id,`duplicate layer id "${i.id}", previously used at line ${F.id.__line__}`))}}if("ref"in i){let N;["type","source","source-layer","filter","layout"].forEach(P=>{P in i&&t.push(new a.V(d,i[P],`"${P}" is prohibited for ref layers`))}),m.layers.forEach(P=>{a.M(P.id)===R&&(N=P)}),N?N.ref?t.push(new a.V(d,i.ref,"ref cannot reference another ref layer")):w=a.M(N.type):typeof R=="string"&&t.push(new a.V(d,i.ref,`ref layer "${R}" not found`))}else if(w!=="background"&&w!=="sky"&&w!=="slot")if(i.source){const N=m.sources&&m.sources[i.source],P=N&&a.M(N.type);N?P==="vector"&&w==="raster"?t.push(new a.V(d,i.source,`layer "${i.id}" requires a raster source`)):P==="raster"&&w!=="raster"?t.push(new a.V(d,i.source,`layer "${i.id}" requires a vector source`)):P!=="vector"||i["source-layer"]?P==="raster-dem"&&w!=="hillshade"?t.push(new a.V(d,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="raster-array"||["raster","raster-particle"].includes(w)?w!=="line"||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||P==="geojson"&&N.lineMetrics?w==="raster-particle"&&P!=="raster-array"&&t.push(new a.V(d,i.source,`layer "${i.id}" requires a 'raster-array' source.`)):t.push(new a.V(d,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new a.V(d,i.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new a.V(d,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new a.V(d,i.source,`source "${i.source}" not found`))}else t.push(new a.V(d,i,'missing required property "source"'));return t=t.concat(ti({key:d,value:i,valueSpec:v.layer,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{"*":()=>[],type:()=>it({key:`${d}.type`,value:i.type,valueSpec:v.layer.type,style:h.style,styleSpec:h.styleSpec,object:i,objectKey:"type"}),filter:N=>ta(a.L({layerType:w},N)),layout:N=>ti({layer:i,key:N.key,value:N.value,valueSpec:{},style:N.style,styleSpec:N.styleSpec,objectElementValidators:{"*":P=>Ua(a.L({layerType:w},P))}}),paint:N=>ti({layer:i,key:N.key,value:N.value,valueSpec:{},style:N.style,styleSpec:N.styleSpec,objectElementValidators:{"*":P=>Fa(a.L({layerType:w,layer:i},P))}})}})),t}function na(h){const t=h.value,i=h.key,d=a.K(t);return d!=="string"?[new a.V(i,t,`string expected, ${d} found`)]:[]}const us={promoteId:function h({key:t,value:i}){if(a.K(i)==="string")return na({key:t,value:i});if(Array.isArray(i)){const d=[],m=a.U(i),v=a.X(m);return v.result==="error"&&v.value.forEach(w=>{d.push(new a.V(`${t}${w.key}`,null,`${w.message}`))}),a.Z(v.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||d.push(new a.V(`${t}`,null,"promoteId expression should be only feature dependent")),d}{const d=[];for(const m in i)d.push(...h({key:`${t}.${m}`,value:i[m]}));return d}}};function lc(h){const t=h.value,i=h.key,d=h.styleSpec,m=h.style;if(!t.type)return[new a.V(i,t,'"type" is required')];const v=a.M(t.type);let w=[];switch(["vector","raster","raster-dem","raster-array"].includes(v)&&(t.url||t.tiles||w.push(new a.J(i,t,'Either "url" or "tiles" is required.'))),v){case"vector":case"raster":case"raster-dem":case"raster-array":return w=w.concat(ti({key:i,value:t,valueSpec:d[`source_${v.replace("-","_")}`],style:h.style,styleSpec:d,objectElementValidators:us})),w;case"geojson":if(w=ti({key:i,value:t,valueSpec:d.source_geojson,style:m,styleSpec:d,objectElementValidators:us}),t.cluster)for(const R in t.clusterProperties){const[N,P]=t.clusterProperties[R],F=typeof N=="string"?[N,["accumulated"],["get",R]]:N;w.push(...dr({key:`${i}.${R}.map`,value:P,expressionContext:"cluster-map"})),w.push(...dr({key:`${i}.${R}.reduce`,value:F,expressionContext:"cluster-reduce"}))}return w;case"video":return ti({key:i,value:t,valueSpec:d.source_video,style:m,styleSpec:d});case"image":return ti({key:i,value:t,valueSpec:d.source_image,style:m,styleSpec:d});case"canvas":return[new a.V(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Rs({key:`${i}.type`,value:t.type,valueSpec:{values:bl(d)}})}}function bl(h){return h.source.reduce((t,i)=>{const d=h[i];return d.type.type==="enum"&&(t=t.concat(Object.keys(d.type.values))),t},[])}function ks(h){const t=h.value,i=h.styleSpec,d=i.light,m=h.style;let v=[];const w=a.K(t);if(t===void 0)return v;if(w!=="object")return v=v.concat([new a.V("light",t,`object expected, ${w} found`)]),v;for(const R in t){const N=R.match(/^(.*)-transition$/),P=R.match(/^(.*)-use-theme$/);v=v.concat(P&&d[P[1]]?it({key:R,value:t[R],valueSpec:{type:"string"},style:m,styleSpec:i}):N&&d[N[1]]&&d[N[1]].transition?it({key:R,value:t[R],valueSpec:i.transition,style:m,styleSpec:i}):d[R]?it({key:R,value:t[R],valueSpec:d[R],style:m,styleSpec:i}):[new a.V(R,t[R],`unknown property "${R}"`)])}return v}function jo(h){const t=h.value;let i=[];if(!t)return i;const d=a.K(t);if(d!=="object")return i=i.concat([new a.V("light-3d",t,`object expected, ${d} found`)]),i;const m=h.styleSpec,v=m["light-3d"],w=h.key,R=h.style,N=h.style.lights;for(const V of["type","id"])if(!(V in t))return i=i.concat([new a.V("light-3d",t,`missing property ${V} on light`)]),i;if(t.type&&N)for(let V=0;V<h.arrayIndex;V++){const j=a.M(t.type),Z=N[V];a.M(Z.type)===j&&i.push(new a.V(w,t.id,`duplicate light type "${t.type}", previously defined at line ${Z.id.__line__}`))}const P=`properties_light_${t.type}`;if(!(P in m))return i=i.concat([new a.V("light-3d",t,`Invalid light type ${t.type}`)]),i;const F=m[P];for(const V in t)if(V==="properties"){const j=t[V],Z=a.K(j);if(Z!=="object")return i=i.concat([new a.V("properties",j,`object expected, ${Z} found`)]),i;for(const Q in j)i=i.concat(F[Q]?it({key:Q,value:j[Q],valueSpec:F[Q],style:R,styleSpec:m}):[new a.J(h.key,j[Q],`unknown property "${Q}"`)])}else{const j=V.match(/^(.*)-transition$/),Z=V.match(/^(.*)-use-theme$/);i=i.concat(Z&&v[Z[1]]?it({key:V,value:t[V],valueSpec:{type:"string"},style:R,styleSpec:m}):j&&v[j[1]]&&v[j[1]].transition?it({key:V,value:t[V],valueSpec:m.transition,style:R,styleSpec:m}):v[V]?it({key:V,value:t[V],valueSpec:v[V],style:R,styleSpec:m}):[new a.J(V,t[V],`unknown property "${V}"`)])}return i}function qi(h){const t=h.value,i=h.key,d=h.style,m=h.styleSpec,v=m.terrain;let w=[];const R=a.K(t);if(t===void 0||R==="null")return w;if(R!=="object")return w=w.concat([new a.V("terrain",t,`object expected, ${R} found`)]),w;for(const N in t){const P=N.match(/^(.*)-transition$/),F=N.match(/^(.*)-use-theme$/);w=w.concat(F&&v[F[1]]?it({key:N,value:t[N],valueSpec:{type:"string"},style:d,styleSpec:m}):P&&v[P[1]]&&v[P[1]].transition?it({key:N,value:t[N],valueSpec:m.transition,style:d,styleSpec:m}):v[N]?it({key:N,value:t[N],valueSpec:v[N],style:d,styleSpec:m}):[new a.J(N,t[N],`unknown property "${N}"`)])}if(t.source){const N=d.sources&&d.sources[t.source],P=N&&a.M(N.type);N?P!=="raster-dem"&&w.push(new a.V(i,t.source,`terrain cannot be used with a source of type ${String(P)}, it only be used with a "raster-dem" source type`)):w.push(new a.V(i,t.source,`source "${t.source}" not found`))}else w.push(new a.V(i,t,'terrain is missing required property "source"'));return w}function ra(h){const t=h.value,i=h.style,d=h.styleSpec,m=d.fog;let v=[];const w=a.K(t);if(t===void 0)return v;if(w!=="object")return v=v.concat([new a.V("fog",t,`object expected, ${w} found`)]),v;for(const R in t){const N=R.match(/^(.*)-transition$/),P=R.match(/^(.*)-use-theme$/);v=v.concat(P&&m[P[1]]?it({key:R,value:t[R],valueSpec:{type:"string"},style:i,styleSpec:d}):N&&m[N[1]]&&m[N[1]].transition?it({key:R,value:t[R],valueSpec:d.transition,style:i,styleSpec:d}):m[R]?it({key:R,value:t[R],valueSpec:m[R],style:i,styleSpec:d}):[new a.J(R,t[R],`unknown property "${R}"`)])}return v}const xe={"*":()=>[],array:Do,boolean:function(h){const t=h.value,i=h.key,d=a.K(t);return d!=="boolean"?[new a.V(i,t,`boolean expected, ${d} found`)]:[]},number:Jn,color:function(h){const t=h.key,i=h.value,d=a.K(i);return d!=="string"?[new a.V(t,i,`color expected, ${d} found`)]:a.a0.parseCSSColor(i)===null?[new a.V(t,i,`color expected, "${i}" found`)]:[]},enum:Rs,filter:ta,function:Wi,layer:ao,object:ti,source:lc,model:a.a4,light:ks,"light-3d":jo,terrain:qi,fog:ra,string:na,formatted:function(h){return na(h).length===0?[]:dr(h)},resolvedImage:function(h){return na(h).length===0?[]:dr(h)},projection:function(h){const t=h.value,i=h.styleSpec,d=i.projection,m=h.style;let v=[];const w=a.K(t);if(w==="object")for(const R in t)v=v.concat(it({key:R,value:t[R],valueSpec:d[R],style:m,styleSpec:i}));else w!=="string"&&(v=v.concat([new a.V("projection",t,`object or string expected, ${w} found`)]));return v},import:function(h){const{value:t,styleSpec:i}=h,{data:d,...m}=t;Object.defineProperty(m,"__line__",{value:t.__line__,enumerable:!1});let v=ti(a.L({},h,{value:m,valueSpec:i.import}));return a.M(m.id)===""&&v.push(new a.V(`${h.key}.id`,m,"import id can't be an empty string")),d&&(v=v.concat(Sn(d,i,{key:`${h.key}.data`}))),v},iconset:function(h){const t=h.value,i=h.key,d=h.styleSpec,m=h.style;if(!t.type)return[new a.V(i,t,'"type" is required')];const v=a.M(t.type);let w=[];if(w=w.concat(ti({key:i,value:t,valueSpec:d[`iconset_${v}`],style:m,styleSpec:d})),v==="source"&&t.source){const R=m.sources&&m.sources[t.source],N=R&&a.M(R.type);R?N!=="raster-array"&&w.push(new a.V(i,t.source,`iconset cannot be used with a source of type ${String(N)}, it only be used with a "raster-array" source type`)):w.push(new a.V(i,t.source,`source "${t.source}" not found`))}return w}};function it(h,t=!1){const i=h.value,d=h.valueSpec,m=h.styleSpec;if(d.expression&&a.a2(a.M(i)))return Wi(h);if(d.expression&&a.S(a.U(i)))return dr(h);if(d.type&&xe[d.type]){const v=xe[d.type](h);return t===!0&&v.length>0&&a.K(h.value)==="array"?dr(h):v}return ti(a.L({},h,{valueSpec:d.type?m[d.type]:d}))}function yn(h){const t=h.value,i=h.key,d=na(h);return d.length||(t.indexOf("{fontstack}")===-1&&d.push(new a.V(i,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&d.push(new a.V(i,t,'"glyphs" url must include a "{range}" token'))),d}function Sn(h,t=a.a5,i={}){return it({key:i.key||"",value:h,valueSpec:t.$root,styleSpec:t,style:h,objectElementValidators:{glyphs:yn,"*":()=>[]}})}function kn(h,t=a.a5){return je(Sn(h,t))}const br=h=>je(lc(h)),wr=h=>je(ks(h)),Br=h=>je(jo(h)),Er=h=>je(qi(h)),no=h=>je(ra(h)),ia=h=>je(function(t){const i=t.value,d=t.style,m=t.styleSpec,v=m.snow;let w=[];const R=a.K(i);if(i===void 0)return w;if(R!=="object")return w=w.concat([new a.V("snow",i,`object expected, ${R} found`)]),w;for(const N in i){const P=N.match(/^(.*)-transition$/);w=w.concat(P&&v[P[1]]&&v[P[1]].transition?it({key:N,value:i[N],valueSpec:m.transition,style:d,styleSpec:m}):v[N]?it({key:N,value:i[N],valueSpec:v[N],style:d,styleSpec:m}):[new a.J(N,i[N],`unknown property "${N}"`)])}return w}(h)),ut=h=>je(function(t){const i=t.value,d=t.style,m=t.styleSpec,v=m.rain;let w=[];const R=a.K(i);if(i===void 0)return w;if(R!=="object")return w=w.concat([new a.V("rain",i,`object expected, ${R} found`)]),w;for(const N in i){const P=N.match(/^(.*)-transition$/);w=w.concat(P&&v[P[1]]&&v[P[1]].transition?it({key:N,value:i[N],valueSpec:m.transition,style:d,styleSpec:m}):v[N]?it({key:N,value:i[N],valueSpec:v[N],style:d,styleSpec:m}):[new a.J(N,i[N],`unknown property "${N}"`)])}return w}(h)),ie=h=>je(ao(h)),ae=h=>je(ta(h)),we=h=>je(Fa(h)),Oe=h=>je(Ua(h)),Ie=h=>je(a.a4(h));function je(h){return h.slice().sort((t,i)=>t.line&&i.line?t.line-i.line:0)}function rt(h,t){let i=!1;if(t&&t.length)for(const d of t)d instanceof a.J?a.w(d.message):(h.fire(new a.z(new Error(d.message))),i=!0);return i}let $e;class at extends a.E{constructor(t,i="flat"){super(),this._transitionable=new a.a6($e||($e=new a.a7({anchor:new a.a8(a.a5.light.anchor),position:new a.a9(a.a5.light.position),color:new a.a8(a.a5.light.color),intensity:new a.a8(a.a5.light.intensity)}))),this.setLight(t,i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,i,d={}){this._validate(wr,t,d)||(this._transitionable.setTransitionOrValue(t),this.id=i)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,i,d){return(!d||d.validate!==!1)&&rt(this,t.call(kn,a.l({value:i,style:{glyphs:!0,sprite:!0},styleSpec:a.a5})))}}let Ye=class extends a.E{constructor(h,t,i,d){super(),this.scope=i,this._transitionable=new a.a6(new a.a7({source:new a.a8(a.a5.terrain.source),exaggeration:new a.a8(a.a5.terrain.exaggeration)}),i,d),this._transitionable.setTransitionOrValue(h,d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(h,t){this._transitionable.setTransitionOrValue(h,t)}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}getExaggeration(h){return this._transitioning.possiblyEvaluate(new a.aa(h)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const h=this._transitionable._values.exaggeration;if(!h)return null;const t=h.value.expression;if(!t)return null;let i=-1,d=-1,m=1;for(const v of t.zoomStops)m=t.evaluate(new a.aa(v)),m>.01?(i=v,d=-1):d=v;return m<.01&&i>0&&d>i?[i,d]:null}isZoomDependent(){const h=this._transitionable._values.exaggeration;return h!=null&&h.value!=null&&h.value.expression!=null&&h.value.expression instanceof a.ab}};const ct=45,At=65,Qt=.05;function on(h,t,i,d){const m=a.ae(ct,At,i),[v,w]=Nn(h,d);let R=1-Math.min(1,Math.exp((t-v)/(w-v)*-6));return R*=R*R,R=Math.min(1,1.00747*R),R*m*h.alpha}function Nn(h,t){const i=.5/Math.tan(.5*t);return[h.range[0]+i,h.range[1]+i]}function jn(h,t,i,d,m){const v=a.ad.vec3.transformMat4([],[t,i,d],m.mercatorFogMatrix);return on(h,a.ad.vec3.length(v),m.pitch,m._fov)}function Un(h,t,i,d,m,v,w){const R=[[i,d,0],[m,d,0],[m,v,0],[i,v,0]];let N=Number.MAX_VALUE,P=-Number.MAX_VALUE;for(const F of R){const V=a.ad.vec3.transformMat4([],F,t),j=a.ad.vec3.length(V);N=Math.min(N,j),P=Math.max(P,j)}return[on(h,N,w.pitch,w._fov),on(h,P,w.pitch,w._fov)]}class zn extends a.E{constructor(t,i,d,m){super();const v=new a.a7({range:new a.a8(a.a5.fog.range),color:new a.a8(a.a5.fog.color),"color-use-theme":new a.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new a.a8(a.a5.fog["high-color"]),"high-color-use-theme":new a.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new a.a8(a.a5.fog["space-color"]),"space-color-use-theme":new a.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new a.a8(a.a5.fog["horizon-blend"]),"star-intensity":new a.a8(a.a5.fog["star-intensity"]),"vertical-range":new a.a8(a.a5.fog["vertical-range"])});this._transitionable=new a.a6(v,d,new Map(m)),this.set(t,m),this._transitioning=this._transitionable.untransitioned(),this._transform=i,this.properties=new a.af(v),this.scope=d}get state(){const t=this._transform,i=t.projection.name==="globe",d=a.ag(t.zoom),m=this.properties.get("range"),v=[.5,3];return{range:i?[a.ah(v[0],m[0],d),a.ah(v[1],m[1],d)]:m,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,i,d={}){if(this._validate(no,t,d))return;const m=a.l({},t);for(const v of Object.keys(a.a5.fog))m[v]===void 0&&(m[v]=a.a5.fog[v].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,i)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const i=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:a.ae(ct,At,t))*i.a}getOpacityAtLatLng(t,i){return this._transform.projection.supportsFog?function(d,m,v){const w=a.ac.fromLngLat(m),R=v.elevation?v.elevation.getAtPointOrZero(w):0;return jn(d,w.x,w.y,R,v)}(this.state,t,i):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const i=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Un(this.state,i,0,0,a.ai,a.ai,this._transform)}getOpacityForBounds(t,i,d,m,v){return this._transform.projection.supportsFog?Un(this.state,t,i,d,m,v,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Nn(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const i=[4,5,6,7];for(const d of i){const m=t.points[d];let v;if(m[2]>=0)v=m;else{const w=t.points[d-4];v=a.aj(w,m,w[2]/(w[2]-m[2]))}if(jn(this.state,v[0],v[1],0,this._transform)>=Qt)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,i,d){return(!d||d.validate!==!1)&&rt(this,t.call(kn,a.l({value:i,style:{glyphs:!0,sprite:!0},styleSpec:a.a5})))}}let Wr,si,Qn,Ar,Rr=class extends a.E{constructor(h,t,i,d){super();const m=Wr||(Wr=new a.a7({density:new a.a8(a.a5.snow.density),intensity:new a.a8(a.a5.snow.intensity),color:new a.a8(a.a5.snow.color),opacity:new a.a8(a.a5.snow.opacity),vignette:new a.a8(a.a5.snow.vignette),"vignette-color":new a.a8(a.a5.snow["vignette-color"]),"center-thinning":new a.a8(a.a5.snow["center-thinning"]),direction:new a.a8(a.a5.snow.direction),"flake-size":new a.a8(a.a5.snow["flake-size"])}));this._transitionable=new a.a6(m,i,new Map(d)),this.set(h,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new a.af(m),this.scope=i}get state(){const h=this.properties.get("opacity"),t=this.properties.get("color"),i=this.properties.get("direction"),d=a.ak(i[0]),m=-Math.max(a.ak(i[1]),.01),v=[Math.cos(d)*Math.cos(m),Math.sin(d)*Math.cos(m),Math.sin(m)],w=this.properties.get("vignette"),R=this.properties.get("vignette-color");return R.a=w,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new a.al(t.r,t.g,t.b,t.a*h),direction:v,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:R}}get(){return this._transitionable.serialize()}set(h,t,i={}){if(this._validate(ia,h,i))return;const d=a.l({},h);for(const m of Object.keys(a.a5.snow))d[m]===void 0&&(d[m]=a.a5.snow[m].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(h){this._transitionable.setTransitionOrValue(this._options,new Map(h))}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,t,i){return(!i||i.validate!==!1)&&rt(this,h.call(kn,a.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:a.a5})))}},Or=class extends a.E{constructor(h,t,i,d){super();const m=si||(si=new a.a7({density:new a.a8(a.a5.rain.density),intensity:new a.a8(a.a5.rain.intensity),color:new a.a8(a.a5.rain.color),opacity:new a.a8(a.a5.rain.opacity),vignette:new a.a8(a.a5.rain.vignette),"vignette-color":new a.a8(a.a5.rain["vignette-color"]),"center-thinning":new a.a8(a.a5.rain["center-thinning"]),direction:new a.a8(a.a5.rain.direction),"droplet-size":new a.a8(a.a5.rain["droplet-size"]),"distortion-strength":new a.a8(a.a5.rain["distortion-strength"])}));this._transitionable=new a.a6(m,i,new Map(d)),this.set(h,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new a.af(m),this.scope=i}get state(){const h=this.properties.get("opacity"),t=this.properties.get("color"),i=this.properties.get("direction"),d=a.ak(i[0]),m=-Math.max(a.ak(i[1]),.01),v=[Math.cos(d)*Math.cos(m),Math.sin(d)*Math.cos(m),Math.sin(m)],w=this.properties.get("vignette-color");return w.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new a.al(t.r,t.g,t.b,t.a*h),direction:v,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:w}}get(){return this._transitionable.serialize()}set(h,t,i={}){if(this._validate(ut,h,i))return;const d=a.l({},h);for(const m of Object.keys(a.a5.rain))d[m]===void 0&&(d[m]=a.a5.rain[m].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(h){this._transitionable.setTransitionOrValue(this._options,new Map(h))}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,t,i){return(!i||i.validate!==!1)&&rt(this,h.call(kn,a.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:a.a5})))}};class fi extends a.E{constructor(t,i,d,m){super(),this.scope=d,this._options=t,this.properties=new a.af(i),this._transitionable=new a.a6(i,d,new Map(m)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,i){this._options=t,this._transitionable.setTransitionOrValue(t.properties,i)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class ro{constructor(t,i,d,m){this.screenBounds=t,this.cameraPoint=i,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=d,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,m)}static createFromScreenPoints(t,i){let d,m;if(t instanceof a.P||typeof t[0]=="number"){const v=a.P.convert(t);d=[v],m=i.isPointAboveHorizon(v)}else{const v=a.P.convert(t[0]),w=a.P.convert(t[1]);d=[v,w],m=a.an(v,w).every(R=>i.isPointAboveHorizon(R))}return new ro(d,i.getCameraPoint(),m,i)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return a.an(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const i=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],m=a.an(i,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>i.x&&this.cameraPoint.x<d.x?m.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?m[2]=this.cameraPoint:this.cameraPoint.x<=i.x&&(m[3]=this.cameraPoint)),a.ao(m,t)}bufferedCameraGeometryGlobe(t){const i=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],m=a.an(i,d,t),v=this.cameraPoint.clone();switch(3*((v.y>i.y)+(v.y>d.y))+((v.x>i.x)+(v.x>d.x))){case 0:m[0]=v,m[4]=v.clone();break;case 1:m.splice(1,0,v);break;case 2:m[1]=v;break;case 3:m.splice(4,0,v);break;case 5:m.splice(2,0,v);break;case 6:m[3]=v;break;case 7:m.splice(3,0,v);break;case 8:m[2]=v}return m}containsTile(t,i,d,m=0){const v=t.queryPadding/i._pixelsPerMercatorPixel+1,w=d?this._bufferedCameraMercator(v,i):this._bufferedScreenMercator(v,i);let R=t.tileID.wrap+(w.unwrapped?m:0);const N=w.polygon.map(te=>a.ap(t.tileTransform,te,R));if(!a.aq(N,0,0,a.ai,a.ai))return;R=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?m:0);const P=this.screenGeometryMercator.polygon.map(te=>a.ar(t.tileTransform,te,R)),F=P.map(te=>new a.P(te[0],te[1])),V=i.getFreeCameraOptions().position||new a.ac(0,0,0),j=a.ar(t.tileTransform,V,R),Z=P.map(te=>{const re=a.ad.vec3.sub(te,te,j);return a.ad.vec3.normalize(re,re),new a.as(j,re)}),Q=a.at(t,1,i.zoom)*i._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:F,tilespaceRays:Z,bufferedTilespaceGeometry:N,bufferedTilespaceBounds:(K=a.au(N),K.min.x=a.ay(K.min.x,0,a.ai),K.min.y=a.ay(K.min.y,0,a.ai),K.max.x=a.ay(K.max.x,0,a.ai),K.max.y=a.ay(K.max.y,0,a.ai),K),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:Q};var K}_bufferedScreenMercator(t,i){const d=Vo(t);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{let m;return m=i.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),i):{polygon:this.bufferedScreenGeometry(t).map(v=>i.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[d]=m,m}}_bufferedCameraMercator(t,i){const d=Vo(t);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{let m;return m=i.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),i):{polygon:this.bufferedCameraGeometry(t).map(v=>i.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[d]=m,m}}_projectAndResample(t,i){const d=function(v,w){const R=a.ad.mat4.multiply([],w.pixelMatrix,w.globeMatrix),N=[0,-a.az,0,1],P=[0,a.az,0,1],F=[0,0,0,1];a.ad.vec4.transformMat4(N,N,R),a.ad.vec4.transformMat4(P,P,R),a.ad.vec4.transformMat4(F,F,R);const V=new a.P(N[0]/N[3],N[1]/N[3]),j=new a.P(P[0]/P[3],P[1]/P[3]),Z=a.aw(v,V)&&N[3]<F[3],Q=a.aw(v,j)&&P[3]<F[3];if(!Z&&!Q)return null;const K=function(Se,Te,Me){for(let ze=1;ze<Se.length;ze++){const ot=oa(Te.pointCoordinate3D(Se[ze-1]).x),Xe=oa(Te.pointCoordinate3D(Se[ze]).x);if(Me<0){if(ot<Xe)return{idx:ze,t:-ot/(Xe-1-ot)}}else if(Xe<ot)return{idx:ze,t:(1-ot)/(Xe+1-ot)}}return null}(v,w,Z?-1:1);if(!K)return null;const{idx:te,t:re}=K;let pe=te>1?Mo(v.slice(0,te),w):[],be=te<v.length?Mo(v.slice(te),w):[];pe=pe.map(Se=>new a.P(oa(Se.x),Se.y)),be=be.map(Se=>new a.P(oa(Se.x),Se.y));const ye=[...pe];ye.length===0&&ye.push(be[be.length-1]);const Ae=a.ah(ye[ye.length-1].y,(be.length===0?pe[0]:be[0]).y,re);let ve;return ve=Z?[new a.P(0,Ae),new a.P(0,0),new a.P(1,0),new a.P(1,Ae)]:[new a.P(1,Ae),new a.P(1,1),new a.P(0,1),new a.P(0,Ae)],ye.push(...ve),be.length===0?ye.push(pe[0]):ye.push(...be),{polygon:ye.map(Se=>new a.ac(Se.x,Se.y)),unwrapped:!1}}(t,i);if(d)return d;const m=function(v,w){let R=!1,N=-1/0,P=0;for(let V=0;V<v.length-1;V++)v[V].x>N&&(N=v[V].x,P=V);for(let V=0;V<v.length-1;V++){const j=(P+V)%(v.length-1),Z=v[j],Q=v[j+1];Math.abs(Z.x-Q.x)>.5&&(Z.x<Q.x?(Z.x+=1,j===0&&(v[v.length-1].x+=1)):(Q.x+=1,j+1===v.length-1&&(v[0].x+=1)),R=!0)}const F=a.av(w.center.lng);return R&&F<Math.abs(F-1)&&v.forEach(V=>{V.x-=1}),{polygon:v,unwrapped:R}}(Mo(t,i).map(v=>new a.P(oa(v.x),v.y)),i);return{polygon:m.polygon.map(v=>new a.ac(v.x,v.y)),unwrapped:m.unwrapped}}}function Mo(h,t){return a.ax(h,i=>{const d=t.pointCoordinate3D(i);i.x=d.x,i.y=d.y},1/256)}function oa(h){return h<0?1+h%1:h%1}function Vo(h){return 100*h|0}function io(h,t,i,d,m){const v=function(R,N){if(R)return m(R);if(N){if(h.url&&N.tiles&&h.tiles&&delete h.tiles,N.variants){if(!Array.isArray(N.variants))return m(new Error("variants must be an array"));for(const F of N.variants){if(F==null||typeof F!="object"||F.constructor!==Object)return m(new Error("variant must be an object"));if(!Array.isArray(F.capabilities))return m(new Error("capabilities must be an array"));if(F.capabilities.length===1&&F.capabilities[0]==="meshopt"){N=a.l(N,F);break}}}const P=a.aA(a.l({},N,h),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);P.tiles=t.canonicalizeTileset(P,h.url),m(null,P)}},w=function(R,N,P){if(!R)return null;if(!N&&!P)return R;P=P||R.worldview_default;const F=Object.values(R.language||{});if(F.length===0)return null;const V=Object.values(R.worldview||{});if(V.length===0)return null;const j=F.every(Q=>Q===N),Z=V.every(Q=>Q===P);return j&&Z?R:N in(R.language_options||{})||P in(R.worldview_options||{})?null:R.language_options&&R.worldview_options?R:null}(h.data,i,d);return w?a.q.frame(()=>v(null,w)):h.url?a.n(t.transformRequest(t.normalizeSourceURL(h.url,null,i,d),a.R.Source),v):a.q.frame(()=>{const{data:R,...N}=h;v(null,N)})}class pi{constructor(t,i,d){this.bounds=a.aB.convert(this.validateBounds(t)),this.minzoom=i||0,this.maxzoom=d||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const i=Math.pow(2,t.z),d=Math.floor(a.av(this.bounds.getWest())*i),m=Math.floor(a.aC(this.bounds.getNorth())*i),v=Math.ceil(a.av(this.bounds.getEast())*i),w=Math.ceil(a.aC(this.bounds.getSouth())*i);return t.x>=d&&t.x<v&&t.y>=m&&t.y<w}}class ja extends a.E{constructor(t,i,d,m){if(super(),this.id=t,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.l(this,a.aA(i,["url","scheme","tileSize","promoteId"])),this._options=a.l({type:"vector"},i),this._collectResourceTiming=!!i.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new a.aD}load(t){this._loaded=!1,this.fire(new a.A("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map.getWorldview();this._tileJSONRequest=io(this._options,this.map._requestManager,i,d,(m,v)=>{if(this._tileJSONRequest=null,this._loaded=!0,m)i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),d&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new a.z(m));else if(v){if(a.l(this,v),this.hasWorldviews=!!v.worldview_options,v.worldview_default&&(this.worldviewDefault=v.worldview_default),v.vector_layers){this.vectorLayers=v.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const w of v.vector_layers)this.vectorLayerIds.push(w.id),v.worldview&&v.worldview[w.source]&&this.localizableLayerIds.add(w.id)}v.bounds&&(this.tileBounds=new pi(v.bounds,this.minzoom,this.maxzoom)),pn(v.tiles,this.map._requestManager._customAccessToken),this.fire(new a.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.A("data",{dataType:"source",sourceDataType:"content"}))}t&&t(m)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=a.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return a.l({},this._options)}loadTile(t,i){const d=t.tileID.canonical.url(this.tiles,this.scheme),m=this.map._requestManager.normalizeTileURL(d),v=this.map._requestManager.transformRequest(m,a.R.Tile),w=this.map.style?this.map.style.getLut(this.scope):null,R=w?{image:w.image.clone()}:null,N={request:v,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:R,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:a.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&a.f(d)&&(N.worldview=this.map.getWorldview()||this.worldviewDefault,N.localizableLayerIds=this.localizableLayerIds),N.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=i:t.request=t.actor.send("reloadTile",N,P.bind(this));else if(t.actor=this._tileWorkers[m]=this._tileWorkers[m]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",N,P.bind(this),void 0,!0);else{const F=a.aE.call({deduped:this._deduped},N,(V,j)=>{V||!j?P.call(this,V):(N.data={cacheControl:j.cacheControl,expires:j.expires,rawData:j.rawData.slice(0)},t.actor&&t.actor.send("loadTile",N,P.bind(this),void 0,!0))},!0);t.request={cancel:F}}function P(F,V){return delete t.request,t.aborted?i(null):F&&F.status!==404?i(F):(V&&V.resourceTiming&&(t.resourceTiming=V.resourceTiming),this.map._refreshExpiredTiles&&V&&t.setExpiryData(V),t.loadVectorData(V,this.map.painter),a.aF(this.dispatcher),i(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,i){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ro extends a.E{constructor(t,i,d,m){super(),this.id=t,this.dispatcher=d,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.l({type:"raster"},i),a.l(this,a.aA(i,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new a.A("dataloading",{dataType:"source"})),this._tileJSONRequest=io(this._options,this.map._requestManager,null,null,(i,d)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new a.z(i)):d&&(a.l(this,d),d.raster_layers&&(this.rasterLayers=d.raster_layers,this.rasterLayerIds=this.rasterLayers.map(m=>m.id)),d.bounds&&(this.tileBounds=new pi(d.bounds,this.minzoom,this.maxzoom)),pn(d.tiles),this.fire(new a.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(i)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=a.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return a.l({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,i){const d=a.q.devicePixelRatio>=2,m=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);t.request=a.o(this.map._requestManager.transformRequest(m,a.R.Tile),(v,w,R,N)=>(delete t.request,t.aborted?(t.state="unloaded",i(null)):v?(t.state="errored",i(v)):w?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:R,expires:N}),t.setTexture(w,this.map.painter),t.state="loaded",a.aF(this.dispatcher),void i(null)):i(null)))}abortTile(t,i){t.request&&(t.request.cancel(),delete t.request),i&&i()}unloadTile(t,i){t.texture&&t.texture instanceof a.T?(t.destroy(!0),t.texture&&t.texture instanceof a.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),i&&i()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Va extends Ro{constructor(t,i,d,m){super(t,i,d,m),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=a.l({type:"raster-array"},i)}triggerRepaint(t){const i=this.map.painter._terrain,d=this.map.style.getSourceCache(this.id);i&&i.enabled&&d&&i._clearRenderCacheForTile(d.id,t.tileID),this.map.triggerRepaint()}loadTile(t,i){const d=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),m=this.map._requestManager.transformRequest(d,a.R.Tile),v={request:m,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=m,t.actor||(t.actor=this.dispatcher.getActor());const w=(R,N,P,F)=>{if(delete t.request,t.aborted)return t.state="unloaded",i(null);if(R)return R.name==="AbortError"?void 0:(t.state="errored",i(R));if(this.map._refreshExpiredTiles&&N&&t.setExpiryData({cacheControl:P,expires:F}),this.partial)t.state="empty";else{if(!N)return i(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=N}i(null)};t.request=this.partial?t.fetchHeader(void 0,w.bind(this)):t.actor.send("loadTile",v,w.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,i){const d=t.texture;d&&d instanceof a.T?(t.destroy(!0),this.map.painter.saveTileTexture(d)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,i,d){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(i,d,(m,v)=>{if(m)return t.state="errored",this.fire(new a.z(m)),void this.triggerRepaint(t);v&&(t._isHeaderLoaded=!0,t.setTexture(v,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const i=this.rasterLayers.find(({id:v})=>v===t),d=i&&i.fields,m=d&&d.bands&&d.bands;return m?m[0]:0}getTextureDescriptor(t,i,d){if(!t)return;const m=i.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!m)return;let v=null;i instanceof a.aI?v=i.paint.get("raster-array-band"):i instanceof a.aJ&&(v=i.paint.get("raster-particle-array-band"));const w=v||this.getInitialBand(m);if(w!=null)if(t.textureDescriptor){if(!t.updateNeeded(m,w)||d)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,m,w)}getImages(t,i){const d=new Map;for(const m of t)for(const v of i){const[w,R]=v.split("/"),N=m.getLayer(w);if(!N||!N.hasBand(R)||!N.hasDataForBand(R))continue;const{bytes:P,tileSize:F,buffer:V}=N.getBandView(R),j=F+2*V,Z={data:new a.r({width:j,height:j},P),pixelRatio:2,sdf:!1,usvg:!1,version:0};d.set(v,Z)}return d}}const Eu={vector:ja,raster:Ro,"raster-dem":class extends Ro{constructor(h,t,i,d){super(h,t,i,d),this.type="raster-dem",this.maxzoom=22,this._options=a.l({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(h,t){const i=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(m,v){m&&(h.state="errored",t(m)),v&&(h.dem=v,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",t(null))}h.request=a.o(this.map._requestManager.transformRequest(i,a.R.Tile),(function(m,v,w,R){if(delete h.request,h.aborted)h.state="unloaded",t(null);else if(m)h.state="errored",t(m);else if(v){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:w,expires:R});const N=ImageBitmap&&v instanceof ImageBitmap&&a.t(),P=1-(v.width-a.aG(v.width))/2;P<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const F=N?v:a.q.getImageData(v,P),V={uid:h.uid,tileID:h.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:F,encoding:this.encoding,padding:P};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadTile",V,d.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(h){const t=h.canonical,i=Math.pow(2,t.z),d=(t.x-1+i)%i,m=t.x===0?h.wrap-1:h.wrap,v=(t.x+1+i)%i,w=t.x+1===i?h.wrap+1:h.wrap,R={};return R[new a.aH(h.overscaledZ,m,t.z,d,t.y).key]={backfilled:!1},R[new a.aH(h.overscaledZ,w,t.z,v,t.y).key]={backfilled:!1},t.y>0&&(R[new a.aH(h.overscaledZ,m,t.z,d,t.y-1).key]={backfilled:!1},R[new a.aH(h.overscaledZ,h.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},R[new a.aH(h.overscaledZ,w,t.z,v,t.y-1).key]={backfilled:!1}),t.y+1<i&&(R[new a.aH(h.overscaledZ,m,t.z,d,t.y+1).key]={backfilled:!1},R[new a.aH(h.overscaledZ,h.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},R[new a.aH(h.overscaledZ,w,t.z,v,t.y+1).key]={backfilled:!1}),R}},"raster-array":Va,geojson:class extends a.E{constructor(h,t,i,d){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(d),this._data=t.data,this._options=a.l({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const m=a.ai/this.tileSize;this.workerOptions=a.l({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*m,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*m,extent:a.ai,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:a.ai,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*m,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}updateData(h){if(!this._options.dynamic)return this.fire(new a.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof h!="string"&&(h.type==="Feature"&&(h={type:"FeatureCollection",features:[h]}),h.type!=="FeatureCollection"))return this.fire(new a.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof h!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const i of this._data.features)t.set(i.id,i);for(const i of h.features)t.set(i.id,i);this._data.features=[...t.values()]}else this._data=h;return this._updateWorkerData(!0),this}getClusterExpansionZoom(h,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id,scope:this.scope},t),this}getClusterChildren(h,t){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id,scope:this.scope},t),this}getClusterLeaves(h,t,i,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:h,limit:t,offset:i},d),this}_updateWorkerData(h=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.A("dataloading",{dataType:"source"})),this._loaded=!1;const t=a.l({append:h},this.workerOptions);t.scope=this.scope;const i=this._data;typeof i=="string"?(t.request=this.map._requestManager.transformRequest(a.q.resolveURL(i),a.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(d,m)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new a.z(d));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(v.resourceTiming=m.resourceTiming[this.id]),h&&(this._partialReload=!0),this.fire(new a.A("data",v)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(h),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const h=a.C(this.id,this.scope);this.map.style.clearSource(h),this._updateWorkerData()}loadTile(h,t){const i=h.actor?"reloadTile":"loadTile";h.actor=this.actor;const d=this.map.style?this.map.style.getLut(this.scope):null,m=d?{image:d.image.clone()}:null,v=this._partialReload,w={type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:m,scope:this.scope,pixelRatio:a.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:v};h.request=this.actor.send(i,w,(R,N)=>v&&!N?(h.state="loaded",t(null)):(delete h.request,h.destroy(),h.aborted?t(null):R?t(R):(h.loadVectorData(N,this.map.painter,i==="reloadTile"),t(null))),void 0,i==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h,t){this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id,scope:this.scope}),h.destroy()}onRemove(h){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends a.aK{constructor(h,t,i,d){super(h,t,i,d),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const t of h.urls)this.urls.push(this.map._requestManager.transformRequest(t,a.R.Source).url);a.aL(this.urls,(t,i)=>{this._loaded=!0,t?this.fire(new a.z(t)):i&&(this.video=i,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const t=this.video.seekable;h<t.start(0)||h>t.end(0)?this.fire(new a.z(new a.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const h=this.map.painter.context,t=h.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new a.T(h,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:a.aK,model:class extends a.E{constructor(h,t,i,d){super(),this.id=h,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const h=[];for(const t in this._options.models){const i=this._options.models[t],d=a.aN(this.map._requestManager.transformRequest(i.uri,a.R.Model).url).then(m=>{if(!m)return;const v=a.aO(m),w=new a.aP(t,i.position,i.orientation,v);w.computeBoundsAndApplyParent(),this.models.push(w)}).catch(m=>{this.fire(new a.z(new Error(`Could not load model ${t} from ${i.uri}: ${m.message}`)))});h.push(d)}return Promise.allSettled(h).then(()=>{this._loaded=!0,this.fire(new a.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new a.z(new Error(`Could not load models: ${t.message}`)))})}onAdd(h){this.map=h,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(h,t){}serialize(){return{type:"model"}}},"batched-model":class extends a.E{constructor(h,t,i,d){super(),this.type="batched-model",this.id=h,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=i,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(d)}onAdd(h){this.map=h,this.load()}reload(){this.cancelTileJSONRequest();const h=a.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(h))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(h){this._loaded=!1,this.fire(new a.A("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,i=this.map.getWorldview();this._tileJSONRequest=io(this._options,this.map._requestManager,t,i,(d,m)=>{this._tileJSONRequest=null,this._loaded=!0,d?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),i&&i.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${i}`),this.fire(new a.z(d))):m&&(a.l(this,m),m.bounds&&(this.tileBounds=new pi(m.bounds,this.minzoom,this.maxzoom)),pn(m.tiles,this.map._requestManager._customAccessToken),this.fire(new a.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.A("data",{dataType:"source",sourceDataType:"content"}))),h&&h(d)})}hasTransition(){return!1}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}loaded(){return this._loaded}loadTile(h,t){const i=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(i,a.R.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:h.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:a.q.devicePixelRatio,promoteId:this.promoteId};if(h.actor&&h.state!=="expired")if(h.state==="loading")h.reloadCallback=t;else{if(h.buckets){const v=Object.values(h.buckets);for(const w of v)w.dirty=!0;return void(h.state="loaded")}h.request=h.actor.send("reloadTile",d,m.bind(this))}else h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",d,m.bind(this),void 0,!0);function m(v,w){return h.aborted?t(null):v&&v.status!==404?t(v):(this.map._refreshExpiredTiles&&w&&h.setExpiryData(w),h.loadModelData(w,this.map.painter),h.state="loaded",void t(null))}}serialize(){return a.l({},this._options)}},canvas:class extends a.aK{constructor(h,t,i,d){super(h,t,i,d),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(v=>typeof v!="number"))||this.fire(new a.z(new a.V(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.z(new a.V(`sources.${h}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new a.z(new a.V(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new a.z(new a.V(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.z(new a.V(`sources.${h}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(h){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!h&&!this._playing||this.texture instanceof a.aM||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends a.E{constructor(h,t,i,d){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=i,this._implementation=t,this.setEventedParent(d),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new pi(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),a.l(this,a.aA(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.aA(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this.map=h,this._loaded=!1,this.fire(new a.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:t,y:i,z:d}=h.canonical;return this._implementation.hasTile({x:t,y:i,z:d})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,t){const{x:i,y:d,z:m}=h.tileID.canonical,v=new AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:i,y:d,z:m},{signal:v.signal})).then((function(w){return delete h.request,h.aborted?(h.state="unloaded",t(null)):w===void 0?(h.state="errored",t(null)):w===null?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",t(null)):function(R){return R instanceof ImageData||R instanceof HTMLCanvasElement||R instanceof ImageBitmap||R instanceof HTMLImageElement}(w)?(this.loadTileData(h,w),h.state="loaded",void t(null)):(h.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(w=>{w.name!=="AbortError"&&(h.state="errored",t(w))}),h.request.cancel=()=>v.abort()}loadTileData(h,t){h.setTexture(t,this.map.painter)}unloadTile(h,t){if(h.texture&&h.texture instanceof a.T?(h.destroy(!0),h.texture&&h.texture instanceof a.T&&this.map.painter.saveTileTexture(h.texture)):h.destroy(),this._implementation.unloadTile){const{x:i,y:d,z:m}=h.tileID.canonical;this._implementation.unloadTile({x:i,y:d,z:m})}t&&t()}abortTile(h,t){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_clearTiles(){const h=a.C(this.id,this.scope);this.map.style.clearSource(h)}_update(){this.fire(new a.A("data",{dataType:"source",sourceDataType:"content"}))}}},Au=function(h,t,i,d){const m=new Eu[t.type](h,t,i,d);if(m.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${m.id}`);return a.aQ(["load","abort","unload","serialize","prepare"],m),m};function Cu(h,t,i=""){return`${i}:${t.id||""}:${t.layer.id}:${function(d){if("layerId"in d)return`layer:${d.layerId}`;{const{featuresetId:m,importId:v}=d;return`featureset:${m}${v?`:import:${v}`:""}`}}(h.target)}`}function wl(h,t,i,d=""){if(h.uniqueFeatureID){const m=Cu(h,t,d);if(i.has(m))return!0;i.add(m)}return!1}function jc(h,t,i,d,m=!1){const v=t.sourceCache.transform,w=t.sourceCache.tilesIn(h,t.has3DLayers,m);w.sort(Dg);const R=[];for(const N of w){const P=N.tile.queryRenderedFeatures(t,N,i,d,v,m);Object.keys(P).length&&R.push({wrappedTileID:N.tile.tileID.wrapped().key,queryResults:P})}return R.length===0?{}:function(N){const P={},F={};for(const V of N){const j=V.queryResults,Z=V.wrappedTileID,Q=F[Z]=F[Z]||{};for(const K in j){const te=j[K],re=Q[K]=Q[K]||{},pe=P[K]=P[K]||[];for(const be of te)re[be.featureIndex]||(re[be.featureIndex]=!0,pe.push(be))}}return P}(R)}function jp(h,t,i,d,m){const v={},w=d.queryRenderedSymbols(h),R=[];for(const N of Object.keys(w).map(Number))R.push(m[N]);R.sort(Dg);for(const N of R){const P=N.featureIndex.lookupSymbolFeatures(w[N.bucketInstanceId],N.bucketIndex,N.sourceLayerIndex,t,i);for(const F in P){const V=v[F]=v[F]||[],j=P[F];j.sort((Z,Q)=>{const K=N.featureSortOrder;if(K){const te=K.indexOf(Z.featureIndex);return K.indexOf(Q.featureIndex)-te}return Q.featureIndex-Z.featureIndex});for(const Z of j)V.push(Z)}}return v}function _y(h,t){const i=h.getRenderableIds().map(v=>h.getTileByID(v)),d=[],m={};for(let v=0;v<i.length;v++){const w=i[v],R=w.tileID.canonical.key;m[R]||(m[R]=!0,w.querySourceFeatures(d,t))}return d}function Dg(h,t){const i=h.tileID,d=t.tileID;return i.overscaledZ-d.overscaledZ||i.canonical.y-d.canonical.y||i.wrap-d.wrap||i.canonical.x-d.canonical.x}function Du(h,t){const i={};if(!t)return i;for(const d of h){const m=d.layerIds.map(v=>t.getLayer(v)).filter(Boolean);if(m.length!==0){d.layers=m,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map(v=>m.filter(w=>w.id===v)[0]));for(const v of m)i[v.fqid]=d}}return i}const ds=32,sa=33,cc=new Uint16Array(8184);for(let h=0;h<2046;h++){let t=h+2,i=0,d=0,m=0,v=0,w=0,R=0;for(1&t?m=v=w=ds:i=d=R=ds;(t>>=1)>1;){const P=i+m>>1,F=d+v>>1;1&t?(m=i,v=d,i=w,d=R):(i=m,d=v,m=w,v=R),w=P,R=F}const N=4*h;cc[N+0]=i,cc[N+1]=d,cc[N+2]=m,cc[N+3]=v}const Os=new Uint16Array(2178),hs=new Uint8Array(1089),qd=new Uint16Array(1089);function Vp(h){return h===0?-.03125:h===32?.03125:0}const Hd={type:2,extent:a.ai,loadGeometry:()=>[[new a.P(0,0),new a.P(a.ai+1,0),new a.P(a.ai+1,a.ai+1),new a.P(0,a.ai+1),new a.P(0,0)]]};class Is{constructor(t,i,d,m,v){this.tileID=t,this.uid=a.aW(),this.uses=0,this.tileSize=i,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=v,m&&m.style&&(this._lastUpdatedBrightness=m.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",m&&m.transform&&(this.projection=m.transform.projection)}registerFadeDuration(t){const i=t+this.timeAdded;i<a.q.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=a.aR(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,i,d){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=Du(t.buckets,i.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const v=this.buckets[m];if(v instanceof a.aY){if(this.hasSymbolBuckets=!0,!d)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const v=this.buckets[m];if(v instanceof a.aY&&v.hasRTLText){this.hasRTLText=!0,a.aZ();break}}this.queryPadding=0;for(const m in this.buckets){const v=this.buckets[m],w=i.style.getOwnLayer(m);if(!w)continue;const R=w.queryRadius(v);this.queryPadding=Math.max(this.queryPadding,R)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new a.aX}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,i,d){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,Du(t.buckets,i.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const m in this.buckets){const v=this.buckets[m];v.uploadPending()&&v.upload(t)}const i=t.gl,d=this.imageAtlas;d&&!d.uploaded&&(this.imageAtlasTexture=new a.T(t,d.image,i.RGBA8,{useMipmap:!!d.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new a.T(t,this.glyphAtlasImage,i.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new a.T(t,this.lineAtlas.image,i.R8),this.lineAtlas.uploaded=!0)}prepare(t,i,d){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,d),!i||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const m=i.style.getBrightness();(this._lastUpdatedBrightness||m)&&(this._lastUpdatedBrightness&&m&&Math.abs(this._lastUpdatedBrightness-m)<.001||(this.updateBuckets(i,this._lastUpdatedBrightness!==m),this._lastUpdatedBrightness=m))}queryRenderedFeatures(t,i,d,m,v,w){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const R=function(N,P){const F=a.ad.mat4.fromScaling([],[.5*N.width,.5*-N.height,1]);return a.ad.mat4.translate(F,F,[1,-1,0]),a.ad.mat4.multiply(F,F,N.calculateProjMatrix(P.toUnwrapped())),Float32Array.from(F)}(v,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:i,pixelPosMatrix:R,transform:m,availableImages:d,tileTransform:this.tileTransform})}querySourceFeatures(t,i){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const m=d.loadVTLayers(),v=i?i.sourceLayer:"",w=m._geojsonTileLayer||m[v];if(!w)return;const R=a.a_(i&&i.filter),{z:N,x:P,y:F}=this.tileID.canonical,V={z:N,x:P,y:F};for(let j=0;j<w.length;j++){const Z=w.feature(j);if(R.needGeometry){const te=a.a$(Z,!0);if(!R.filter(new a.aa(this.tileID.overscaledZ),te,this.tileID.canonical))continue}else if(!R.filter(new a.aa(this.tileID.overscaledZ),Z))continue;const Q=d.getId(Z,v),K=new a.b0(Z,N,P,F,Q);K.tile=V,t.push(K)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const i=this.expirationTime;if(t.cacheControl){const d=a.b1(t.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const d=Date.now();let m=!1;if(this.expirationTime>d)m=!1;else if(i)if(this.expirationTime<i)m=!0;else{const v=this.expirationTime-i;v?this.expirationTime=d+Math.max(v,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,i){if(!this.latestFeatureIndex||!t.style)return;const d=this.latestFeatureIndex.loadVTLayers(),m=t.style.listImages(),v=t.style.getBrightness();for(const w in this.buckets){if(!t.style.hasLayer(w))continue;const R=this.buckets[w],N=R.layers[0],P=N.sourceLayer||"_geojsonTileLayer",F=d[P],V=t.style.getLayerSourceCache(N);let j={};V&&(j=V._state.getState(P,void 0));const Z=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},Q=Object.keys(j).length>0&&!i;Q&&!R.stateDependentLayers.length&&!i||R.update(j,F,m,Z,Q?R.stateDependentLayers:R.layers,i,v),(R instanceof a.b2||R instanceof a.b3)&&t._terrain&&t._terrain.enabled&&V&&R.uploadPending()&&t._terrain._clearRenderCacheForTile(V.id,this.tileID);const K=t&&t.style&&t.style.getOwnLayer(w);K&&(this.queryPadding=Math.max(this.queryPadding,K.queryRadius(R)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<a.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=a.q.now()+t}setTexture(t,i){const d=i.context,m=d.gl;this.texture=this.texture||i.getTileTexture(t.width),this.texture&&this.texture instanceof a.T?this.texture.update(t):(this.texture=new a.T(d,t,m.RGBA8,{useMipmap:!0}),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE))}setDependencies(t,i){const d={};for(const m of i)d[m]=!0;this.dependencies[t]=d}hasDependency(t,i){for(const d of t){const m=this.dependencies[d];if(m){for(const v of i)if(m[v])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;const d=a.b4(Hd,this.tileID.canonical,this.tileTransform)[0],m=new a.b5,v=new a.b6;for(let w=0;w<d.length;w++){const{x:R,y:N}=d[w];m.emplaceBack(R,N),v.emplaceBack(w)}v.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(v),this._tileDebugBuffer=t.createVertexBuffer(m,a.b7.members),this._tileDebugSegments=a.b8.simpleSegment(0,0,m.length,v.length)}_makeTileBoundsBuffers(t,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;const d=a.b4(Hd,this.tileID.canonical,this.tileTransform)[0];let m,v;if(this.isRaster){const w=function(R,N){const P=a.aR(R,N),F=Math.pow(2,R.z);for(let te=0;te<sa;te++)for(let re=0;re<sa;re++){const pe=a.aS((R.x+(re+Vp(re))/ds)/F),be=a.aT((R.y+(te+Vp(te))/ds)/F),ye=N.project(pe,be),Ae=te*sa+re;Os[2*Ae+0]=Math.round((ye.x*P.scale-P.x)*a.ai),Os[2*Ae+1]=Math.round((ye.y*P.scale-P.y)*a.ai)}hs.fill(0),qd.fill(0);for(let te=2045;te>=0;te--){const re=4*te,pe=cc[re+0],be=cc[re+1],ye=cc[re+2],Ae=cc[re+3],ve=pe+ye>>1,Se=be+Ae>>1,Te=ve+Se-be,Me=Se+pe-ve,ze=be*sa+pe,ot=Ae*sa+ye,Xe=Se*sa+ve,ft=Math.hypot((Os[2*ze+0]+Os[2*ot+0])/2-Os[2*Xe+0],(Os[2*ze+1]+Os[2*ot+1])/2-Os[2*Xe+1])>=16;hs[Xe]=hs[Xe]||(ft?1:0),te<1022&&(hs[Xe]=hs[Xe]||hs[(be+Me>>1)*sa+(pe+Te>>1)]||hs[(Ae+Me>>1)*sa+(ye+Te>>1)])}const V=new a.aU,j=new a.aV;let Z=0;function Q(te,re){const pe=re*sa+te;return qd[pe]===0&&(V.emplaceBack(Os[2*pe+0],Os[2*pe+1],te*a.ai/ds,re*a.ai/ds),qd[pe]=++Z),qd[pe]-1}function K(te,re,pe,be,ye,Ae){const ve=te+pe>>1,Se=re+be>>1;if(Math.abs(te-ye)+Math.abs(re-Ae)>1&&hs[Se*sa+ve])K(ye,Ae,te,re,ve,Se),K(pe,be,ye,Ae,ve,Se);else{const Te=Q(te,re),Me=Q(pe,be),ze=Q(ye,Ae);j.emplaceBack(Te,Me,ze)}}return K(0,0,ds,ds,ds,0),K(ds,ds,0,0,0,ds),{vertices:V,indices:j}}(this.tileID.canonical,i);m=w.vertices,v=w.indices}else{m=new a.aU,v=new a.aV;for(const{x:R,y:N}of d)m.emplaceBack(R,N,0,0);const w=a.b9(m.int16,void 0,4);for(let R=0;R<w.length;R+=3)v.emplaceBack(w[R],w[R+1],w[R+2])}this._tileBoundsBuffer=t.createVertexBuffer(m,a.ba.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(v),this._tileBoundsSegments=a.b8.simpleSegment(0,0,m.length,v.length)}_makeGlobeTileDebugBuffers(t,i){const d=i.projection;if(!d||d.name!=="globe"||i.freezeTileCoverage)return;const m=this.tileID.canonical,v=a.bb(m,i),w=a.bc(v),R=a.ag(i.zoom);let N;R>0&&(N=a.ad.mat4.invert(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,m,i,w,N,R),this._makeGlobeTileDebugTextBuffer(t,m,i,w,N,R)}_globePoint(t,i,d,m,v,w,R){let N=a.bd(t,i,d);if(w){const P=1<<d.z,F=a.av(m.center.lng),V=a.aC(m.center.lat),j=(d.x+.5)/P-F;let Z=0;j>.5?Z=-1:j<-.5&&(Z=1);let Q=(t/a.ai+d.x)/P+Z,K=(i/a.ai+d.y)/P;Q=(Q-F)*m._pixelsPerMercatorPixel+F,K=(K-V)*m._pixelsPerMercatorPixel+V;const te=[Q*m.worldSize,K*m.worldSize,0];a.ad.vec3.transformMat4(te,te,w),N=a.be(N,te,R)}return a.ad.vec3.transformMat4(N,N,v)}_makeGlobeTileDebugBorderBuffer(t,i,d,m,v,w){const R=new a.b5,N=new a.b6,P=new a.bf,F=(j,Z,Q,K,te)=>{const re=(Q-j)/(te-1),pe=(K-Z)/(te-1),be=R.length;for(let ye=0;ye<te;ye++){const Ae=j+ye*re,ve=Z+ye*pe;R.emplaceBack(Ae,ve);const Se=this._globePoint(Ae,ve,i,d,m,v,w);P.emplaceBack(Se[0],Se[1],Se[2]),N.emplaceBack(be+ye)}},V=a.ai;F(0,0,V,0,16),F(V,0,V,V,16),F(V,V,0,V,16),F(0,V,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(N),this._tileDebugBuffer=t.createVertexBuffer(R,a.b7.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(P,a.bg.members),this._tileDebugSegments=a.b8.simpleSegment(0,0,R.length,N.length)}_makeGlobeTileDebugTextBuffer(t,i,d,m,v,w){const R=a.ai/4,N=new a.b5,P=new a.aV,F=new a.bf,V=25;P.reserve(32),N.reserve(V),F.reserve(V);const j=(Z,Q)=>V*Z+Q;for(let Z=0;Z<V;Z++){const Q=Z*R;for(let K=0;K<V;K++){const te=K*R;N.emplaceBack(te,Q);const re=this._globePoint(te,Q,i,d,m,v,w);F.emplaceBack(re[0],re[1],re[2])}}for(let Z=0;Z<4;Z++)for(let Q=0;Q<4;Q++){const K=j(Z,Q),te=j(Z,Q+1),re=j(Z+1,Q),pe=j(Z+1,Q+1);P.emplaceBack(K,te,re),P.emplaceBack(re,te,pe)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(P),this._tileDebugTextBuffer=t.createVertexBuffer(N,a.b7.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(F,a.bg.members),this._tileDebugTextSegments=a.b8.simpleSegment(0,0,V,32)}destroy(t=!1){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof a.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}a.bh.setPbf(a.bi);class go extends Is{constructor(t,i,d,m,v){super(t,i,d,m,v),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexture(t,i){const d=i.context,m=d.gl;this.texture=this.texture||i.getTileTexture(t.width),this.texture&&this.texture instanceof a.T?this.texture.update(t,{premultiply:!1}):this.texture=new a.T(d,t,m.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,i){const d=this._mrt=new a.bh(30),m=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=a.bj(m,(v,w,R,N)=>{if(v)i(v);else try{const P=d.getHeaderLength(w);if(P>t)return void(this.request=this.fetchHeader(P,i));d.parseHeader(w),this._isHeaderLoaded=!0;let F=0;for(const V of Object.values(d.layers))F=Math.max(F,V.dataIndex[V.dataIndex.length-1].lastByte);w.byteLength>=F&&(this.entireBuffer=w),i(null,this.entireBuffer||w,R,N)}catch(P){i(P)}}),this.request}fetchBand(t,i,d){const m=this._mrt;if(!this._isHeaderLoaded||!m)return void d(new Error("Tile header is not ready"));const v=this.actor;if(!v)return void d(new Error("Can't fetch tile band without an actor"));let w;const R=(V,j)=>{w.complete(V,j),V?d(V):(this.updateTextureDescriptor(t,i),d(null,this.textureDescriptor&&this.textureDescriptor.img))},N=(V,j)=>{if(V)return d(V);const Z=v.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:j,task:w},R,void 0,!0);this._workQueue.push(()=>{Z&&Z.cancel(),w.cancel()})},P=m.getLayer(t);if(!P)return void d(new Error(`Unknown sourceLayer "${t}"`));if(P.hasDataForBand(i))return this.updateTextureDescriptor(t,i),void d(null,this.textureDescriptor?this.textureDescriptor.img:null);const F=P.getDataRange([i]);if(w=m.createDecodingTask(F),!w||w.tasks.length)if(this.flushQueues(),this.entireBuffer)N(null,this.entireBuffer.slice(F.firstByte,F.lastByte+1));else{const V=Object.assign({},this.requestParams,{headers:{Range:`bytes=${F.firstByte}-${F.lastByte}`}}),j=a.bj(V,N);this._fetchQueue.push(()=>{j.cancel(),w.cancel()})}else d(null)}updateNeeded(t,i){return(!this.textureDescriptor||this.textureDescriptor.band!==i||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,i){if(!this._mrt)return;const d=this._mrt.getLayer(t);if(!d||!d.hasBand(i)||!d.hasDataForBand(i))return;const{bytes:m,tileSize:v,buffer:w,offset:R,scale:N}=d.getBandView(i),P=v+2*w,F=new a.r({width:P,height:P},m),V=this.texture;V&&V instanceof a.T&&V.update(F,{premultiply:!1}),this.textureDescriptor={layer:t,band:i,img:F,buffer:w,offset:R,tileSize:v,format:d.pixelFormat,mix:[N,256*N,65536*N,16777216*N]}}}class yy{constructor(t,i){this.max=t,this.onRemove=i,this.reset()}reset(){for(const t in this.data)for(const i of this.data[t])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(t,i,d){const m=t.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const v={value:i,timeout:void 0};if(d!==void 0&&(v.timeout=setTimeout(()=>{this.remove(t,v)},d)),this.data[m].push(v),this.order.push(m),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const i=this.data[t].shift();return i.timeout&&clearTimeout(i.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),i.value}getByKey(t){const i=this.data[t];return i?i[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,i){if(!this.has(t))return this;const d=t.wrapped().key,m=i===void 0?0:this.data[d].indexOf(i),v=this.data[d][m];return this.data[d].splice(m,1),v.timeout&&clearTimeout(v.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(v.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(t){const i=[];for(const d in this.data)for(const m of this.data[d])t(m.value)||i.push(m);for(const d of i)this.remove(d.value.tileID,d)}}class qp{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,i,d){const m=String(i);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][m]=this.stateChanges[t][m]||{},a.l(this.stateChanges[t][m],d),this.deletedStates[t]===null){this.deletedStates[t]={};for(const v in this.state[t])v!==m&&(this.deletedStates[t][v]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][m]===null){this.deletedStates[t][m]={};for(const v in this.state[t][m])d[v]||(this.deletedStates[t][m][v]=null)}else for(const v in d)this.deletedStates[t]&&this.deletedStates[t][m]&&this.deletedStates[t][m][v]===null&&delete this.deletedStates[t][m][v]}removeFeatureState(t,i,d){if(this.deletedStates[t]===null)return;const m=String(i);if(this.deletedStates[t]=this.deletedStates[t]||{},d&&i!==void 0)this.deletedStates[t][m]!==null&&(this.deletedStates[t][m]=this.deletedStates[t][m]||{},this.deletedStates[t][m][d]=null);else if(i!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][m])for(d in this.deletedStates[t][m]={},this.stateChanges[t][m])this.deletedStates[t][m][d]=null;else this.deletedStates[t][m]=null;else this.deletedStates[t]=null}getState(t,i){const d=this.state[t]||{},m=this.stateChanges[t]||{},v=this.deletedStates[t];if(v===null)return{};if(i!==void 0){const R=String(i),N=a.l({},d[R],m[R]);if(v){const P=v[i];if(P===null)return{};for(const F in P)delete N[F]}return N}const w=a.l({},d,m);if(v)for(const R in v)delete w[R];return w}initializeTileState(t,i){t.refreshFeatureState(i)}coalesceChanges(t,i){const d={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const v={};for(const w in this.stateChanges[m])this.state[m][w]||(this.state[m][w]={}),a.l(this.state[m][w],this.stateChanges[m][w]),v[w]=this.state[m][w];d[m]=v}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const v={};if(this.deletedStates[m]===null)for(const w in this.state[m])v[w]={},this.state[m][w]={};else for(const w in this.deletedStates[m]){if(this.deletedStates[m][w]===null)this.state[m][w]={};else if(this.state[m][w])for(const R of Object.keys(this.deletedStates[m][w]))delete this.state[m][w][R];v[w]=this.state[m][w]}d[m]=d[m]||{},a.l(d[m],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const m in t)t[m].refreshFeatureState(i)}}class aa extends a.E{constructor(t,i,d){super(),this.id=t,this._onlySymbols=d,i.on("data",m=>{m.dataType==="source"&&m.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&m.dataType==="source"&&m.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new yy(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new qp,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,i){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,i)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const d=this._tiles[i];d.upload(t),d.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(gr).map(t=>t.key)}getRenderableIds(t,i){const d=[];for(const m in this._tiles)this._isIdRenderable(+m,t,i)&&d.push(this._tiles[m]);return t?d.sort((m,v)=>{const w=m.tileID,R=v.tileID,N=new a.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),P=new a.P(R.canonical.x,R.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-R.overscaledZ||P.y-N.y||P.x-N.x}).map(m=>m.tileID.key):d.map(m=>m.tileID).sort(gr).map(m=>m.key)}hasRenderableParent(t){const i=this.findLoadedParent(t,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(t,i,d){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(i||!this._tiles[t].holdingForFade())&&(d||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,i){const d=this._tiles[t];d&&(d.state!=="loading"&&(d.state=i),this._loadTile(d,this._tileLoaded.bind(this,d,t,i)))}_tileLoaded(t,i,d,m){if(m)if(t.state="errored",m.status!==404)this._source.fire(new a.z(m,{tile:t}));else{if(this._source.fire(new a.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const v=this.map.painter.terrain;this.update(this.transform,v.getScaledDemTileSize(),!0),v.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=a.q.now(),d==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(i,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new a.A("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const i=this.getRenderableIds();for(let m=0;m<i.length;m++){const v=i[m];if(t.neighboringTiles&&t.neighboringTiles[v]){const w=this.getTileByID(v);d(t,w),d(w,t)}}function d(m,v){if(!m.dem||m.dem.borderReady)return;m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0;let w=v.tileID.canonical.x-m.tileID.canonical.x;const R=v.tileID.canonical.y-m.tileID.canonical.y,N=Math.pow(2,m.tileID.canonical.z),P=v.tileID.key;w===0&&R===0||Math.abs(R)>1||(Math.abs(w)>1&&(Math.abs(w+N)===1?w+=N:Math.abs(w-N)===1&&(w-=N)),v.dem&&m.dem&&(m.dem.backfillBorder(v.dem,w,R),m.neighboringTiles&&m.neighboringTiles[P]&&(m.neighboringTiles[P].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,i,d,m){for(const v in this._tiles){let w=this._tiles[v];if(m[v]||!w.hasData()||w.tileID.overscaledZ<=i||w.tileID.overscaledZ>d)continue;let R=w.tileID;for(;w&&w.tileID.overscaledZ>i+1;){const P=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[P.key],w&&w.hasData()&&(R=P)}let N=R;for(;N.overscaledZ>i;)if(N=N.scaledTo(N.overscaledZ-1),t[N.key]){m[R.key]=R;break}}}findLoadedParent(t,i){if(t.key in this._loadedParentTiles){const d=this._loadedParentTiles[t.key];return d&&d.tileID.overscaledZ>=i?d:null}for(let d=t.overscaledZ-1;d>=i;d--){const m=t.scaledTo(d),v=this._getLoadedTile(m);if(v)return v}}_getLoadedTile(t){const i=this._tiles[t.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,i){i=i||this._source.tileSize;const d=Math.ceil(t.width/i)+1,m=Math.ceil(t.height/i)+1,v=Math.floor(d*m*5),w=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,v):v,R=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(R)}handleWrapJump(t){const i=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,i){const d={};for(const m in this._tiles){const v=this._tiles[m];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+i),d[v.tileID.key]=v}this._tiles=d;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(+m,this._tiles[m])}}update(t,i,d,m){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;this.updateCacheSize(t,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const v=this._source.type==="batched-model";let w,R=this._source.maxzoom;const N=this.map&&this.map.painter?this.map.painter._terrain:null;if(N&&N.sourceCache===this&&N.attenuationRange()){const V=N.attenuationRange()[0],j=Math.floor(V)-Math.log2(N.getDemUpscale());R>j&&(R=j)}if(this.used||this.usedForTerrain){if(this._source.tileID)w=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(V=>new a.aH(V.canonical.z,V.wrap,V.canonical.z,V.canonical.x,V.canonical.y));else if(this.tileCoverLift!==0){const V=t.clone();V.tileCoverLift=this.tileCoverLift,w=V.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:R,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.minzoom<=1&&t.projection.name==="globe"&&(w.push(new a.aH(1,0,1,0,0)),w.push(new a.aH(1,0,1,1,0)),w.push(new a.aH(1,0,1,0,1)),w.push(new a.aH(1,0,1,1,1)))}else if(w=t.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:R,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.hasTile){const V=this._source.hasTile.bind(this._source);w=w.filter(j=>V(j))}}else w=[];if(w.length>0&&this.castsShadows&&m&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Hp(this._source.type)){const V=t.coveringZoomLevel({tileSize:i||this._source.tileSize,roundZoom:this._source.roundZoom&&!d}),j=Math.min(V,this._source.maxzoom);if(v){const Z=t.extendTileCover(w,j);for(const Q of Z)w.push(Q)}else{const Z=t.extendTileCover(w,j,m);for(const Q of Z)this._shadowCasterTiles[Q.key]=!0,w.push(Q)}}const P=this._updateRetainedTiles(w);if(Hp(this._source.type)&&w.length!==0){const V={},j={},Z=Object.keys(P);for(const K of Z){const te=P[K],re=this._tiles[K];if(!re||re.fadeEndTime&&re.fadeEndTime<=a.q.now())continue;const pe=this.findLoadedParent(te,Math.max(te.overscaledZ-aa.maxOverzooming,this._source.minzoom));pe&&(this._addTile(pe.tileID),V[pe.tileID.key]=pe.tileID),j[K]=te}const Q=w[w.length-1].overscaledZ;for(const K in this._tiles){const te=this._tiles[K];if(P[K]||!te.hasData())continue;let re=te.tileID;for(;re.overscaledZ>Q;){re=re.scaledTo(re.overscaledZ-1);const pe=this._tiles[re.key];if(pe&&pe.hasData()&&j[re.key]){P[K]=te.tileID;break}}}for(const K in V)P[K]||(this._coveredTiles[K]=!0,P[K]=V[K])}for(const V in P)this._tiles[V].clearFadeHold();const F=a.bk(this._tiles,P);for(const V of F){const j=this._tiles[V];j.hasSymbolBuckets&&!j.holdingForFade()?j.setHoldDuration(this.map._fadeDuration):j.hasSymbolBuckets&&!j.symbolFadeFinished()||this._removeTile(+V)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const i={};if(t.length===0)return i;const d={},m=t.reduce((P,F)=>Math.min(P,F.overscaledZ),1/0),v=t[0].overscaledZ,w=Math.max(v-aa.maxOverzooming,this._source.minzoom),R=Math.max(v+aa.maxUnderzooming,this._source.minzoom),N={};for(const P of t){const F=this._addTile(P);i[P.key]=P,F.hasData()||m<this._source.maxzoom&&(N[P.key]=P)}this._retainLoadedChildren(N,m,R,i);for(const P of t){let F=this._tiles[P.key];if(F.hasData())continue;if(P.canonical.z>=this._source.maxzoom){const j=P.children(this._source.maxzoom)[0],Z=this.getTile(j);if(Z&&Z.hasData()){i[j.key]=j;continue}}else{const j=P.children(this._source.maxzoom);if(i[j[0].key]&&i[j[1].key]&&i[j[2].key]&&i[j[3].key])continue}let V=F.wasRequested();for(let j=P.overscaledZ-1;j>=w;--j){const Z=P.scaledTo(j);if(d[Z.key]||(d[Z.key]=!0,F=this.getTile(Z),!F&&V&&(F=this._addTile(Z)),F&&(i[Z.key]=Z,V=F.wasRequested(),F.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const i=[];let d,m=this._tiles[t].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){d=this._loadedParentTiles[m.key];break}i.push(m.key);const v=m.scaledTo(m.overscaledZ-1);if(d=this._getLoadedTile(v),d)break;m=v}for(const v of i)this._loadedParentTiles[v]=d}}_addTile(t){let i=this._tiles[t.key];if(i)return i.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),i;i=this._cache.getAndRemove(t),i&&(this._setTileReloadTimer(t.key,i),i.tileID=t,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,i)));const d=!!i;if(!d){const m=this.map?this.map.painter:null,v=this._source.tileSize*t.overscaleFactor();i=this._source.type==="raster-array"?new go(t,v,this.transform.tileZoom,m,this._isRaster):new Is(t,v,this.transform.tileZoom,m,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,t.key,i.state))}return i?(i.uses++,this._tiles[t.key]=i,d||this._source.fire(new a.A("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(t,i){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const d=i.getExpiryTimeout();d&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},d))}_removeTile(t){const i=this._tiles[t];i&&(i.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),i.uses>0||(i.hasData()&&i.state!=="reloading"||i.state==="empty"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,i,d){const m=[],v=this.transform;if(!v)return m;const w=v.projection.name==="globe",R=a.av(v.center.lng);for(const N in this._tiles){const P=this._tiles[N];if(d&&P.clearQueryDebugViz(),P.holdingForFade())continue;let F;if(w){const V=P.tileID.canonical;if(V.z===0){const j=[Math.abs(a.ay(R,...En(V,-1))-R),Math.abs(a.ay(R,...En(V,1))-R)];F=[0,2*j.indexOf(Math.min(...j))-1]}else{const j=[Math.abs(a.ay(R,...En(V,-1))-R),Math.abs(a.ay(R,...En(V,0))-R),Math.abs(a.ay(R,...En(V,1))-R)];F=[j.indexOf(Math.min(...j))-1]}}else F=[0];for(const V of F){const j=t.containsTile(P,v,i,V);j&&m.push(j)}}return m}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,i){const d=this.getRenderableIds(t,i).map(v=>this._tiles[v].tileID),m=this.transform.projection.name==="globe";for(const v of d)v.projMatrix=this.transform.calculateProjMatrix(v.toUnwrapped()),v.expandedProjMatrix=m?this.transform.calculateProjMatrix(v.toUnwrapped(),!1,!0):v.projMatrix;return d}sortCoordinatesByDistance(t){const i=t.slice(),d=this.transform._camera.position,m=this.transform._camera.forward(),v={};for(const w of i){const R=1/(1<<w.canonical.z);v[w.key]=((w.canonical.x+.5)*R+w.wrap-d[0])*m[0]+((w.canonical.y+.5)*R-d[1])*m[1]-d[2]*m[2]}return i.sort((w,R)=>v[w.key]-v[R.key]),i}hasTransition(){if(this._source.hasTransition())return!0;if(Hp(this._source.type))for(const t in this._tiles){const i=this._tiles[t];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=a.q.now())return!0}return!1}setFeatureState(t,i,d){this._state.updateState(t=t||"_geojsonTileLayer",i,d)}removeFeatureState(t,i,d){this._state.removeFeatureState(t=t||"_geojsonTileLayer",i,d)}getFeatureState(t,i){return this._state.getState(t=t||"_geojsonTileLayer",i)}setDependencies(t,i,d){const m=this._tiles[t];m&&m.setDependencies(i,d)}reloadTilesForDependencies(t,i){for(const d in this._tiles)this._tiles[d].hasDependency(t,i)&&this._reloadTile(+d,"reloading");this._cache.filter(d=>!d.hasDependency(t,i))}_preloadTiles(t,i){if(!this._sourceLoaded){const N=()=>{this._sourceLoaded&&(this._source.off("data",N),this._preloadTiles(t,i))};return void this._source.on("data",N)}const d=new Map,m=Array.isArray(t)?t:[t],v=this.map.painter.terrain,w=this.usedForTerrain&&v?v.getScaledDemTileSize():this._source.tileSize;for(const N of m){const P=N.coveringTiles({tileSize:w,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const F of P)d.set(F.key,F);this.usedForTerrain&&N.updateElevation(!1)}const R=Array.from(d.values());a.bl(R,(N,P)=>{const F=new Is(N,this._source.tileSize*N.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(F,V=>{this._source.type==="raster-dem"&&F.dem&&this._backfillDEM(F),P(V,F)})},i)}}function gr(h,t){const i=Math.abs(2*h.wrap)-+(h.wrap<0),d=Math.abs(2*t.wrap)-+(t.wrap<0);return h.overscaledZ-t.overscaledZ||d-i||t.canonical.y-h.canonical.y||t.canonical.x-h.canonical.x}function Hp(h){return h==="raster"||h==="image"||h==="video"||h==="custom"}function En(h,t){const i=1<<h.z;return[h.x/i+t,(h.x+1)/i+t]}aa.maxOverzooming=10,aa.maxUnderzooming=3;class vy{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,i=!1;for(const d in this.style._mergedLayers){const m=this.style._mergedLayers[d];if(m.type==="fill-extrusion")this.layers.push({layer:m,visible:t,visibilityChanged:i});else if(m.type==="model"){const v=this.style.getLayerSource(m);v&&v.type==="batched-model"&&this.layers.push({layer:m,visible:t,visibilityChanged:i})}}}onNewFrame(t){this.layersGotHidden=!1;for(const i of this.layers){const d=i.layer;let m=!1;d.type==="fill-extrusion"?m=!d.isHidden(t)&&d.paint.get("fill-extrusion-opacity")>0:d.type==="model"&&(m=!d.isHidden(t)&&d.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!m&&i.visible,i.visible=m}}updateZOffset(t,i){this.currentBuildingBuckets=[];for(const m of this.layers){const v=m.layer,w=this.style.getLayerSourceCache(v);let R=1;v.type==="fill-extrusion"&&(R=m.visible?v.paint.get("fill-extrusion-vertical-scale"):0);let N=w?w.getTile(i):null;if(!N&&w&&i.canonical.z>w.getSource().minzoom){let P=i.scaledTo(Math.min(w.getSource().maxzoom,i.overscaledZ-1));for(;P.overscaledZ>=w.getSource().minzoom&&(N=w.getTile(P),!N&&P.overscaledZ!==0);)P=P.scaledTo(P.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:N?N.getBucket(v):null,tileID:N?N.tileID:i,verticalScale:R})}t.hasAnyZOffset=!1;let d=!1;for(let m=0;m<t.symbolInstances.length;m++){const v=t.symbolInstances.get(m),w=v.zOffset,R=this._getHeightAtTileOffset(i,v.tileAnchorX,v.tileAnchorY);v.zOffset=R!==Number.NEGATIVE_INFINITY?R:w,d||w===v.zOffset||(d=!0),t.hasAnyZOffset||v.zOffset===0||(t.hasAnyZOffset=!0)}d&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,i,d,m){let v=i,w=d;if(t.canonical.z!==m.canonical.z){const R=m.canonical,N=1/(1<<t.canonical.z-R.z);v=(i+t.canonical.x*a.ai)*N-R.x*a.ai|0,w=(d+t.canonical.y*a.ai)*N-R.y*a.ai|0}return{tileX:v,tileY:w}}_getHeightAtTileOffset(t,i,d){let m,v;for(let w=0;w<this.layers.length;++w){if(this.layers[w].layer.type!=="fill-extrusion")continue;const{bucket:R,tileID:N,verticalScale:P}=this.currentBuildingBuckets[w];if(!R)continue;const{tileX:F,tileY:V}=this._mapCoordToOverlappingTile(t,i,d,N),j=R.getHeightAtTileCoord(F,V);j&&j.height!==void 0&&(j.hidden?m=j.height:v=Math.max(j.height*P,v||0))}if(v!==void 0)return v;for(let w=0;w<this.layers.length;++w){const R=this.layers[w];if(R.layer.type!=="model"||!R.visible)continue;const{bucket:N,tileID:P}=this.currentBuildingBuckets[w];if(!N)continue;const{tileX:F,tileY:V}=this._mapCoordToOverlappingTile(t,i,d,P),j=N.getHeightAtTileCoord(F,V);if(j&&!j.hidden)return j.height===void 0&&m!==void 0?Math.min(j.maxHeight,m)*j.verticalScale:j.height?j.height*j.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function xy(h,t){const i={};for(const d in h)d!=="ref"&&(i[d]=h[d]);return a.bm.forEach(d=>{d in t&&(i[d]=t[d])}),i}function uf(h){h=h.slice();const t=Object.create(null);for(let i=0;i<h.length;i++)t[h[i].id]=h[i];for(let i=0;i<h.length;i++)"ref"in h[i]&&(h[i]=xy(h[i],t[h[i].ref]));return h}const or={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Ns(h,t,i){i.push({command:or.addSource,args:[h,t[h]]})}function df(h,t,i){t.push({command:or.removeSource,args:[h]}),i[h]=!0}function Mu(h,t,i,d){df(h,i,d),Ns(h,t,i)}function dn(h,t,i){let d;for(d in h[i])if(h[i].hasOwnProperty(d)&&d!=="data"&&!a.bn(h[i][d],t[i][d]))return!1;for(d in t[i])if(t[i].hasOwnProperty(d)&&d!=="data"&&!a.bn(h[i][d],t[i][d]))return!1;return!0}function Cr(h,t,i,d,m,v){let w;for(w in t=t||{},h=h||{})h.hasOwnProperty(w)&&(a.bn(h[w],t[w])||i.push({command:v,args:[d,w,t[w],m]}));for(w in t)t.hasOwnProperty(w)&&!h.hasOwnProperty(w)&&(a.bn(h[w],t[w])||i.push({command:v,args:[d,w,t[w],m]}))}function cr(h){return h.id}function lo(h,t){return h[t.id]=t,h}class Ru{constructor(t,i){this.reset(t,i)}reset(t,i){this.points=t||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(i||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=a.ay(t,0,1);let i=1,d=this._distances[i];const m=t*this.paddedLength+this.padding;for(;d<m&&i<this._distances.length;)d=this._distances[++i];const v=i-1,w=this._distances[v],R=d-w,N=R>0?(m-w)/R:0;return this.points[v].mult(1-N).add(this.points[i].mult(N))}}class Wn{constructor(t,i,d){const m=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(t/d),this.yCellCount=Math.ceil(i/d);for(let w=0;w<this.xCellCount*this.yCellCount;w++)m.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=i,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/i,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,i,d,m,v){this._forEachCell(i,d,m,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(i),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(v)}insertCircle(t,i,d,m){this._forEachCell(i-m,d-m,i+m,d+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(i),this.circles.push(d),this.circles.push(m)}_insertBoxCell(t,i,d,m,v,w){this.boxCells[v].push(w)}_insertCircleCell(t,i,d,m,v,w){this.circleCells[v].push(w)}_query(t,i,d,m,v,w){if(d<0||t>this.width||m<0||i>this.height)return!v&&[];const R=[];if(t<=0&&i<=0&&this.width<=d&&this.height<=m){if(v)return!0;for(let N=0;N<this.boxKeys.length;N++)R.push({key:this.boxKeys[N],x1:this.bboxes[4*N],y1:this.bboxes[4*N+1],x2:this.bboxes[4*N+2],y2:this.bboxes[4*N+3]});for(let N=0;N<this.circleKeys.length;N++){const P=this.circles[3*N],F=this.circles[3*N+1],V=this.circles[3*N+2];R.push({key:this.circleKeys[N],x1:P-V,y1:F-V,x2:P+V,y2:F+V})}return w?R.filter(w):R}return this._forEachCell(t,i,d,m,this._queryCell,R,{hitTest:v,seenUids:{box:{},circle:{}}},w),v?R.length>0:R}_queryCircle(t,i,d,m,v){const w=t-d,R=t+d,N=i-d,P=i+d;if(R<0||w>this.width||P<0||N>this.height)return!m&&[];const F=[];return this._forEachCell(w,N,R,P,this._queryCellCircle,F,{hitTest:m,circle:{x:t,y:i,radius:d},seenUids:{box:{},circle:{}}},v),m?F.length>0:F}query(t,i,d,m,v){return this._query(t,i,d,m,!1,v)}hitTest(t,i,d,m,v){return this._query(t,i,d,m,!0,v)}hitTestCircle(t,i,d,m){return this._queryCircle(t,i,d,!0,m)}_queryCell(t,i,d,m,v,w,R,N){const P=R.seenUids,F=this.boxCells[v];if(F!==null){const j=this.bboxes;for(const Z of F)if(!P.box[Z]){P.box[Z]=!0;const Q=4*Z;if(t<=j[Q+2]&&i<=j[Q+3]&&d>=j[Q+0]&&m>=j[Q+1]&&(!N||N(this.boxKeys[Z]))){if(R.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[Z],x1:j[Q],y1:j[Q+1],x2:j[Q+2],y2:j[Q+3]})}}}const V=this.circleCells[v];if(V!==null){const j=this.circles;for(const Z of V)if(!P.circle[Z]){P.circle[Z]=!0;const Q=3*Z;if(this._circleAndRectCollide(j[Q],j[Q+1],j[Q+2],t,i,d,m)&&(!N||N(this.circleKeys[Z]))){if(R.hitTest)return w.push(!0),!0;{const K=j[Q],te=j[Q+1],re=j[Q+2];w.push({key:this.circleKeys[Z],x1:K-re,y1:te-re,x2:K+re,y2:te+re})}}}}}_queryCellCircle(t,i,d,m,v,w,R,N){const P=R.circle,F=R.seenUids,V=this.boxCells[v];if(V!==null){const Z=this.bboxes;for(const Q of V)if(!F.box[Q]){F.box[Q]=!0;const K=4*Q;if(this._circleAndRectCollide(P.x,P.y,P.radius,Z[K+0],Z[K+1],Z[K+2],Z[K+3])&&(!N||N(this.boxKeys[Q])))return w.push(!0),!0}}const j=this.circleCells[v];if(j!==null){const Z=this.circles;for(const Q of j)if(!F.circle[Q]){F.circle[Q]=!0;const K=3*Q;if(this._circlesCollide(Z[K],Z[K+1],Z[K+2],P.x,P.y,P.radius)&&(!N||N(this.circleKeys[Q])))return w.push(!0),!0}}}_forEachCell(t,i,d,m,v,w,R,N){const P=this._convertToXCellCoord(t),F=this._convertToYCellCoord(i),V=this._convertToXCellCoord(d),j=this._convertToYCellCoord(m);for(let Z=P;Z<=V;Z++)for(let Q=F;Q<=j;Q++)if(v.call(this,t,i,d,m,this.xCellCount*Q+Z,w,R,N))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,i,d,m,v,w){const R=m-t,N=v-i,P=d+w;return P*P>R*R+N*N}_circleAndRectCollide(t,i,d,m,v,w,R){const N=(w-m)/2,P=Math.abs(t-(m+N));if(P>N+d)return!1;const F=(R-v)/2,V=Math.abs(i-(v+F));if(V>F+d)return!1;if(P<=N||V<=F)return!0;const j=P-N,Z=V-F;return j*j+Z*Z<=d*d}}const uc={unknown:0,flipRequired:1,flipNotRequired:2},ku=Math.tan(85*Math.PI/180);function Sl(h,t,i,d,m,v,w){const R=a.ad.mat4.create();if(i)if(v.name==="globe"){const N=a.bo(m,t);a.ad.mat4.multiply(R,R,N)}else{const N=a.ad.mat2.invert([],w);R[0]=N[0],R[1]=N[1],R[4]=N[2],R[5]=N[3],d||a.ad.mat4.rotateZ(R,R,m.angle)}else a.ad.mat4.multiply(R,m.labelPlaneMatrix,h);return R}function _o(h,t,i,d,m,v,w){const R=Sl(h,t,i,d,m,v,w);return v.name==="globe"&&i||(R[2]=R[6]=R[10]=R[14]=0),R}function Ii(h,t,i,d,m,v,w){if(i){if(v.name==="globe"){const R=Sl(h,t,i,d,m,v,w);return a.ad.mat4.invert(R,R),a.ad.mat4.multiply(R,h,R),R}{const R=a.ad.mat4.clone(h),N=a.ad.mat4.identity([]);return N[0]=w[0],N[1]=w[1],N[4]=w[2],N[5]=w[3],a.ad.mat4.multiply(R,R,N),d||a.ad.mat4.rotateZ(R,R,-m.angle),R}}return m.glCoordMatrix}function qa(h,t,i,d){const m=[h,t,i,1];i?a.ad.vec4.transformMat4(m,m,d):Hi(m,m,d);const v=m[3];return m[0]/=v,m[1]/=v,m[2]/=v,m}function Ou(h,t){return Math.min(.5+h/t*.5,1.5)}function Mg(h,t){const i=h[0]/h[3],d=h[1]/h[3];return i>=-t[0]&&i<=t[0]&&d>=-t[1]&&d<=t[1]}function Iu(h,t,i,d,m,v,w,R,N,P){const F=i.transform,V=d?h.textSizeData:h.iconSizeData,j=a.bp(V,i.transform.zoom),Z=F.projection.name==="globe",Q=[256/i.width*2+1,256/i.height*2+1],K=d?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;K.clear();let te=null;Z&&(te=d?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const re=h.lineVertexArray,pe=d?h.text.placedSymbolArray:h.icon.placedSymbolArray,be=i.transform.width/i.transform.height;let ye,Ae=!1;for(let ve=0;ve<pe.length;ve++){const Se=pe.get(ve),{numGlyphs:Te,writingMode:Me}=Se;if(Me!==a.bq.vertical||Ae||ye===a.bq.horizontal||(Ae=!0),ye=Me,(Se.hidden||Me===a.bq.vertical)&&!Ae){Ga(Te,K);continue}Ae=!1;const ze=new a.P(Se.tileAnchorX,Se.tileAnchorY);let{x:ot,y:Xe,z:ft}=F.projection.projectTilePoint(ze.x,ze.y,P.canonical);if(N){const[kt,Wt,hn]=N(ze);ot+=kt,Xe+=Wt,ft+=hn}const gt=[ot,Xe,ft,1];if(a.ad.vec4.transformMat4(gt,gt,t),!Mg(gt,Q)){Ga(Te,K);continue}const Mt=gt[3],He=Ou(i.transform.getCameraToCenterDistance(F.projection),Mt),mt=a.br(V,j,Se),qe=w?mt/He:mt*He,pt=qa(ot,Xe,ft,m);if(pt[3]<=0){Ga(Te,K);continue}let lt={};const yt=a.ak(h.layers[0].layout.get("text-max-angle")),st=Math.cos(yt),dt=w?null:N,Ht=ko(Se,qe,!1,R,t,m,v,h.glyphOffsetArray,re,K,te,pt,ze,lt,be,dt,F.projection,P,w,st);Ae=Ht.useVertical,dt&&Ht.needsFlipping&&(lt={}),(Ht.notEnoughRoom||Ae||Ht.needsFlipping&&ko(Se,qe,!0,R,t,m,v,h.glyphOffsetArray,re,K,te,pt,ze,lt,be,dt,F.projection,P,w,st).notEnoughRoom)&&Ga(Te,K)}d?(h.text.dynamicLayoutVertexBuffer.updateData(K),te&&h.text.globeExtVertexBuffer&&h.text.globeExtVertexBuffer.updateData(te)):(h.icon.dynamicLayoutVertexBuffer.updateData(K),te&&h.icon.globeExtVertexBuffer&&h.icon.globeExtVertexBuffer.updateData(te))}function Gp(h,t,i,d,m,v,w,R,N,P,F,V,j,Z,Q,K,te){const{lineStartIndex:re,glyphStartIndex:pe,segment:be}=R,ye=pe+R.numGlyphs,Ae=re+R.lineLength,ve=t.getoffsetX(pe),Se=t.getoffsetX(ye-1),Te=hf(h*ve,i,d,m,v,w,be,re,Ae,N,P,F,V,j,!0,Z,Q,K,te);if(!Te)return null;const Me=hf(h*Se,i,d,m,v,w,be,re,Ae,N,P,F,V,j,!0,Z,Q,K,te);return Me?{first:Te,last:Me}:null}function Vc(h,t,i,d){return h===a.bq.horizontal&&Math.abs(d)>Math.abs(i)?{useVertical:!0}:h===a.bq.vertical?d>0?{needsFlipping:!0}:null:t!==uc.unknown&&function(m,v){return m===0||Math.abs(v/m)>ku}(i,d)?t===uc.flipRequired?{needsFlipping:!0}:null:i<0?{needsFlipping:!0}:null}function ko(h,t,i,d,m,v,w,R,N,P,F,V,j,Z,Q,K,te,re,pe,be){const ye=t/24,Ae=h.lineOffsetX*ye,ve=h.lineOffsetY*ye,{lineStartIndex:Se,glyphStartIndex:Te,numGlyphs:Me,segment:ze,writingMode:ot,flipState:Xe}=h,ft=Se+h.lineLength,gt=Mt=>{if(F){const[pt,lt,yt]=Mt.up,st=P.length;a.bs(F,st+0,pt,lt,yt),a.bs(F,st+1,pt,lt,yt),a.bs(F,st+2,pt,lt,yt),a.bs(F,st+3,pt,lt,yt)}const[He,mt,qe]=Mt.point;a.bt(P,He,mt,qe,Mt.angle)};if(Me>1){const Mt=Gp(ye,R,Ae,ve,i,V,j,h,N,v,Z,K,!1,te,re,pe,be);if(!Mt)return{notEnoughRoom:!0};if(d&&!i){let[He,mt,qe]=Mt.first.point,[pt,lt,yt]=Mt.last.point;[He,mt]=qa(He,mt,qe,w),[pt,lt]=qa(pt,lt,yt,w);const st=Vc(ot,Xe,(pt-He)*Q,lt-mt);if(h.flipState=st&&st.needsFlipping?uc.flipRequired:uc.flipNotRequired,st)return st}gt(Mt.first);for(let He=Te+1;He<Te+Me-1;He++){const mt=hf(ye*R.getoffsetX(He),Ae,ve,i,V,j,ze,Se,ft,N,v,Z,K,!1,!1,te,re,pe,be);if(!mt)return P.length-=4*(He-Te),{notEnoughRoom:!0};gt(mt)}gt(Mt.last)}else{if(d&&!i){const He=qa(j.x,j.y,0,m),mt=Se+ze+1,qe=new a.P(N.getx(mt),N.gety(mt)),pt=qa(qe.x,qe.y,0,m),lt=pt[3]>0?pt:Oo(j,qe,He,1,m,void 0,te,re.canonical),yt=Vc(ot,Xe,(lt[0]-He[0])*Q,lt[1]-He[1]);if(h.flipState=yt&&yt.needsFlipping?uc.flipRequired:uc.flipNotRequired,yt)return yt}const Mt=hf(ye*R.getoffsetX(Te),Ae,ve,i,V,j,ze,Se,ft,N,v,Z,K,!1,!1,te,re,pe,be);if(!Mt)return{notEnoughRoom:!0};gt(Mt)}return{}}function Ha(h,t,i,d,m){const{x:v,y:w,z:R}=d.projectTilePoint(h.x,h.y,t);if(!m)return qa(v,w,R,i);const[N,P,F]=m(h);return qa(v+N,w+P,R+F,i)}function Oo(h,t,i,d,m,v,w,R){const N=Ha(h.sub(t)._unit()._add(h),R,m,w,v);return a.ad.vec3.sub(N,i,N),a.ad.vec3.normalize(N,N),a.ad.vec3.scaleAndAdd(N,i,N,d)}function hf(h,t,i,d,m,v,w,R,N,P,F,V,j,Z,Q,K,te,re,pe){const be=d?h-t:h+t;let ye=be>0?1:-1,Ae=0;d&&(ye*=-1,Ae=Math.PI),ye<0&&(Ae+=Math.PI);let ve=R+w+(ye>0?0:1)|0,Se=m,Te=m,Me=0,ze=0;const ot=Math.abs(be),Xe=[],ft=[];let gt=v,Mt=gt,He=a.ad.vec3.zero([]);const mt=()=>Oo(Mt,gt,Te,ot-Me+1,F,j,K,te.canonical);for(;Me+ze<=ot;){if(ve+=ye,ve<R||ve>=N)return null;if(Te=Se,Mt=gt,Xe.push(Te),Z&&ft.push(Mt),gt=new a.P(P.getx(ve),P.gety(ve)),Se=V[ve],!Se){const hn=Ha(gt,te.canonical,F,K,j);Se=hn[3]>0?V[ve]=hn:mt()}Me+=ze;const kt=a.ad.vec3.sub([],Se,Te),Wt=a.ad.vec3.distance(Te,Se);if(i&&Wt>0&&ze>0&&a.ad.vec3.dot(He,kt)/(ze*Wt)<pe)return null;ze=Wt,He=kt}Q&&j&&(V[ve]&&(Se=mt(),ze=a.ad.vec3.distance(Te,Se),He=a.ad.vec3.sub([],Se,Te)),V[ve]=Se);const qe=(ot-Me)/ze,pt=gt.sub(Mt)._mult(qe)._add(Mt),lt=a.ad.vec3.scaleAndAdd([],Te,He,qe);let yt=[0,0,1],st=He[0],dt=He[1];if(re&&(yt=K.upVector(te.canonical,pt.x,pt.y),yt[0]!==0||yt[1]!==0||yt[2]!==1)){const kt=[yt[2],0,-yt[0]],Wt=a.ad.vec3.cross([],yt,kt);a.ad.vec3.normalize(kt,kt),a.ad.vec3.normalize(Wt,Wt),st=a.ad.vec3.dot(He,kt),dt=a.ad.vec3.dot(He,Wt)}if(i){const kt=a.ad.vec3.cross([],yt,He);a.ad.vec3.normalize(kt,kt),a.ad.vec3.scaleAndAdd(lt,lt,kt,i*ye)}const Ht=Ae+Math.atan2(dt,st);return Xe.push(lt),Z&&ft.push(pt),{point:lt,angle:Ht,path:Xe,tilePath:ft,up:yt}}function Ga(h,t){const i=t.length,d=i+4*h;t.resize(d),t.float32.fill(-1/0,4*i,4*d)}function Hi(h,t,i){const d=t[0],m=t[1];return h[0]=i[0]*d+i[4]*m+i[12],h[1]=i[1]*d+i[5]*m+i[13],h[3]=i[3]*d+i[7]*m+i[15],h}const co=100;class dc{constructor(t,i,d=new Wn(t.width+200,t.height+200,25),m=new Wn(t.width+200,t.height+200,25)){this.transform=t,this.grid=d,this.ignoredGrid=m,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+co,this.screenBottomBoundary=t.height+co,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=i}placeCollisionBox(t,i,d,m,v,w,R,N){let P=d.projectedAnchorX,F=d.projectedAnchorY,V=d.projectedAnchorZ;const j=d.elevation,Z=d.tileID,Q=t.getProjection();if(j&&Z){const[ve,Se,Te]=Q.upVector(Z.canonical,d.tileAnchorX,d.tileAnchorY),Me=Q.upVectorScale(Z.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;P+=ve*j*Me,F+=Se*j*Me,V+=Te*j*Me}const K=this.projectAndGetPerspectiveRatio(R,P,F,V,d.tileID,Q.name==="globe"||!!j||this.transform.pitch>0,Q),te=w*K.perspectiveRatio,re=(d.x1*i+m.x-d.padding)*te+K.point.x,pe=(d.y1*i+m.y-d.padding)*te+K.point.y,be=(d.x2*i+m.x+d.padding)*te+K.point.x,ye=(d.y2*i+m.y+d.padding)*te+K.point.y,Ae=K.perspectiveRatio<=.55||K.occluded;return!this.isInsideGrid(re,pe,be,ye)||!v&&this.grid.hitTest(re,pe,be,ye,N)||Ae?{box:[],offscreen:!1,occluded:K.occluded}:{box:[re,pe,be,ye],offscreen:this.isOffscreen(re,pe,be,ye),occluded:!1}}placeCollisionCircles(t,i,d,m,v,w,R,N,P,F,V,j,Z,Q,K){const te=[],re=this.transform.elevation,pe=t.getProjection(),be=re?re.getAtTileOffsetFunc(K,this.transform.center.lat,this.transform.worldSize,pe):null,ye=new a.P(d.tileAnchorX,d.tileAnchorY);let{x:Ae,y:ve,z:Se}=pe.projectTilePoint(ye.x,ye.y,K.canonical);if(be){const[yt,st,dt]=be(ye);Ae+=yt,ve+=st,Se+=dt}const Te=pe.name==="globe",Me=this.projectAndGetPerspectiveRatio(R,Ae,ve,Se,K,Te||!!re||this.transform.pitch>0,pe),{perspectiveRatio:ze}=Me,ot=(V?w/ze:w*ze)/a.bw,Xe=qa(Ae,ve,Se,N),ft=d.lineOffsetX*ot,gt=d.lineOffsetY*ot,Mt=a.ak(t.layers[0].layout.get("text-max-angle")),He=Math.cos(Mt),mt=Me.signedDistanceFromCamera>0?Gp(ot,v,ft,gt,!1,Xe,ye,d,m,N,{},re&&!V?be:null,V&&!!re,pe,K,V,He):null;let qe=!1,pt=!1,lt=!0;if(mt&&!Me.occluded){const yt=.5*Z*ze+Q,st=new a.P(-100,-100),dt=new a.P(this.screenRightBoundary,this.screenBottomBoundary),Ht=new Ru,{first:kt,last:Wt}=mt,hn=kt.path.length;let In=[];for(let Mn=hn-1;Mn>=1;Mn--)In.push(kt.path[Mn]);for(let Mn=1;Mn<Wt.path.length;Mn++)In.push(Wt.path[Mn]);const bn=2.5*yt;P&&(In=In.map(([Mn,tr,yr],Gr)=>(be&&!Te&&(yr=be(Gr<hn-1?kt.tilePath[hn-1-Gr]:Wt.tilePath[Gr-hn+2])[2]),qa(Mn,tr,yr,P))),In.some(Mn=>Mn[3]<=0)&&(In=[]));let Tn=[];if(In.length>0){let Mn=1/0,tr=-1/0,yr=1/0,Gr=-1/0;for(const Kn of In)Mn=Math.min(Mn,Kn[0]),yr=Math.min(yr,Kn[1]),tr=Math.max(tr,Kn[0]),Gr=Math.max(Gr,Kn[1]);tr>=st.x&&Mn<=dt.x&&Gr>=st.y&&yr<=dt.y&&(Tn=[In.map(Kn=>new a.P(Kn[0],Kn[1]))],(Mn<st.x||tr>dt.x||yr<st.y||Gr>dt.y)&&(Tn=a.bu(Tn,st.x,st.y,dt.x,dt.y)))}for(const Mn of Tn){Ht.reset(Mn,.25*yt);let tr=0;tr=Ht.length<=.5*yt?1:Math.ceil(Ht.paddedLength/bn)+1;for(let yr=0;yr<tr;yr++){const Gr=yr/Math.max(tr-1,1),Kn=Ht.lerp(Gr),ci=Kn.x+co,Pn=Kn.y+co;te.push(ci,Pn,yt,0);const fn=ci-yt,ar=Pn-yt,Dr=ci+yt,vr=Pn+yt;if(lt=lt&&this.isOffscreen(fn,ar,Dr,vr),pt=pt||this.isInsideGrid(fn,ar,Dr,vr),!i&&this.grid.hitTestCircle(ci,Pn,yt,j)&&(qe=!0,!F))return{circles:[],offscreen:!1,collisionDetected:qe,occluded:!1}}}}return{circles:!F&&qe||!pt?[]:te,offscreen:lt,collisionDetected:qe,occluded:Me.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const i=[];let d=1/0,m=1/0,v=-1/0,w=-1/0;for(const F of t){const V=new a.P(F.x+co,F.y+co);d=Math.min(d,V.x),m=Math.min(m,V.y),v=Math.max(v,V.x),w=Math.max(w,V.y),i.push(V)}const R=this.grid.query(d,m,v,w).concat(this.ignoredGrid.query(d,m,v,w)),N={},P={};for(const F of R){const V=F.key;if(N[V.bucketInstanceId]===void 0&&(N[V.bucketInstanceId]={}),N[V.bucketInstanceId][V.featureIndex])continue;const j=[new a.P(F.x1,F.y1),new a.P(F.x2,F.y1),new a.P(F.x2,F.y2),new a.P(F.x1,F.y2)];a.bv(i,j)&&(N[V.bucketInstanceId][V.featureIndex]=!0,P[V.bucketInstanceId]===void 0&&(P[V.bucketInstanceId]=[]),P[V.bucketInstanceId].push(V.featureIndex))}return P}insertCollisionBox(t,i,d,m,v){(i?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:m,collisionGroupID:v},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,i,d,m,v){const w=i?this.ignoredGrid:this.grid,R={bucketInstanceId:d,featureIndex:m,collisionGroupID:v};for(let N=0;N<t.length;N+=4)w.insertCircle(R,t[N],t[N+1],t[N+2])}projectAndGetPerspectiveRatio(t,i,d,m,v,w,R){const N=[i,d,m,1];let P=!1;m||this.transform.pitch>0?(a.ad.vec4.transformMat4(N,N,t),this.fogState&&v&&R.name!=="globe"&&(P=function(j,Z,Q,K,te,re){const pe=re.calculateFogTileMatrix(te),be=[Z,Q,K];return a.ad.vec3.transformMat4(be,be,pe),on(j,a.ad.vec3.length(be),re.pitch,re._fov)}(this.fogState,i,d,m,v.toUnwrapped(),this.transform)>.9)):Hi(N,N,t);const F=N[3];return{point:new a.P((N[0]/F+1)/2*this.transform.width+co,(-N[1]/F+1)/2*this.transform.height+co),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(R)/F*.5,1.5),signedDistanceFromCamera:F,occluded:w&&N[2]>F||P}}isOffscreen(t,i,d,m){return d<co||t>=this.screenRightBoundary||m<co||i>this.screenBottomBoundary}isInsideGrid(t,i,d,m){return d>=0&&t<this.gridRightBoundary&&m>=0&&i<this.gridBottomBoundary}getViewportMatrix(){const t=a.ad.mat4.identity([]);return a.ad.mat4.translate(t,t,[-100,-100,0]),t}}function wi(h,t,i){const d=t.createTileMatrix(h,h.worldSize,i.toUnwrapped());return a.ad.mat4.multiply(new Float32Array(16),h.projMatrix,d)}function $p(h,t,i){if(t.projection.name===i.projection.name)return h.projMatrix;const d=i.clone();return d.setProjection(t.projection),wi(d,t.getProjection(),h)}function zs(h,t,i){return t.name===i.projection.name?h.projMatrix:wi(i,t,h)}class Nu{constructor(t,i,d,m){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?i:-i))):m&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class hc{constructor(t,i,d,m,v,w=!1){this.text=new Nu(t?t.text:null,i,d,v),this.icon=new Nu(t?t.icon:null,i,m,v),this.clipped=w}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class $a{constructor(t,i,d,m=!1){this.text=t,this.icon=i,this.skipFade=d,this.clipped=m}}class by{constructor(){this.invProjMatrix=a.ad.mat4.create(),this.viewportMatrix=a.ad.mat4.create(),this.circles=[]}}class fs{constructor(t,i,d,m,v){this.bucketInstanceId=t,this.featureIndex=i,this.sourceLayerIndex=d,this.bucketIndex=m,this.tileID=v}}class zu{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const i=++this.maxGroupID;this.collisionGroups[t]={ID:i,predicate:d=>d.collisionGroupID===i}}return this.collisionGroups[t]}}function Ps(h,t,i,d,m){const{horizontalAlign:v,verticalAlign:w}=a.bD(h),R=-(v-.5)*t,N=-(w-.5)*i,P=a.bC(h,d);return new a.P(R+P[0]*m,N+P[1]*m)}function Ci(h,t,i,d,m){const v=new a.P(h,t);return i&&v._rotate(d?m:-m),v}class Zp{constructor(t,i,d,m,v,w){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new dc(this.transform,v),this.buildingIndex=w,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=i,this.retainedQueryData={},this.collisionGroups=new zu(d),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,i,d,m,v=1){const w=d.getBucket(i),R=d.latestFeatureIndex;if(!w||!R||i.fqid!==w.layerIds[0])return;const N=w.layers[0].layout,P=w.layers[0].paint,F=d.collisionBoxArray,V=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),j=d.tileSize/a.ai,Z=d.tileID.toUnwrapped();this.transform.setProjection(w.projection);const Q=(K=d.tileID,te=w.getProjection(),re=this.transform,te.name===this.projection?re.calculateProjMatrix(K.toUnwrapped()):wi(re,te,K));var K,te,re;const pe=N.get("text-pitch-alignment")==="map",be=N.get("text-rotation-alignment")==="map";i.compileFilter(i.options);const ye=i.dynamicFilter(),Ae=i.dynamicFilterNeedsFeature(),ve=this.transform.calculatePixelsToTileUnitsMatrix(d),Se=_o(Q,d.tileID.canonical,pe,be,this.transform,w.getProjection(),ve);let Te=null;if(pe){const mt=Ii(Q,d.tileID.canonical,pe,be,this.transform,w.getProjection(),ve);Te=a.ad.mat4.multiply([],this.transform.labelPlaneMatrix,mt)}let Me=null;ye&&d.latestFeatureIndex&&(Me={unwrappedTileID:Z,dynamicFilter:ye,dynamicFilterNeedsFeature:Ae}),this.retainedQueryData[w.bucketInstanceId]=new fs(w.bucketInstanceId,R,w.sourceLayerIndex,w.index,d.tileID);const[ze,ot]=w.layers[0].layout.get("text-size-scale-range"),Xe=a.ay(v,ze,ot),[ft,gt]=N.get("icon-size-scale-range"),Mt=a.ay(v,ft,gt),He={bucket:w,layout:N,paint:P,posMatrix:Q,textLabelPlaneMatrix:Se,labelToScreenMatrix:Te,clippingData:Me,scale:V,textPixelRatio:j,holdingForFade:d.holdingForFade(),collisionBoxArray:F,partiallyEvaluatedTextSize:a.bp(w.textSizeData,this.transform.zoom,Xe),partiallyEvaluatedIconSize:a.bp(w.iconSizeData,this.transform.zoom,Mt),collisionGroup:this.collisionGroups.get(w.sourceID),latestFeatureIndex:d.latestFeatureIndex};if(m)for(const mt of w.sortKeyRanges){const{sortKey:qe,symbolInstanceStart:pt,symbolInstanceEnd:lt}=mt;t.push({sortKey:qe,symbolInstanceStart:pt,symbolInstanceEnd:lt,parameters:He})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:He})}attemptAnchorPlacement(t,i,d,m,v,w,R,N,P,F,V,j,Z,Q,K,te,re,pe){const{textOffset0:be,textOffset1:ye,crossTileID:Ae}=j,ve=[be,ye],Se=Ps(t,d,m,ve,v),Te=this.collisionIndex.placeCollisionBox(Q,v,i,Ci(Se.x,Se.y,w,R,this.transform.angle),V,N,P,F.predicate);if(te){const Me=Q.getSymbolInstanceIconSize(pe,this.transform.zoom,j.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Q,Me,te,Ci(Se.x,Se.y,w,R,this.transform.angle),V,N,P,F.predicate).box.length===0)return}if(Te.box.length>0){let Me;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ae]&&this.prevPlacement.placements[Ae]&&this.prevPlacement.placements[Ae].text&&(Me=this.prevPlacement.variableOffsets[Ae].anchor),this.variableOffsets[Ae]={textOffset:ve,width:d,height:m,anchor:t,textScale:v,prevAnchor:Me},this.markUsedJustification(Q,t,j,K),Q.allowVerticalPlacement&&(this.markUsedOrientation(Q,K,j),this.placedOrientations[Ae]=K),{shift:Se,placedGlyphBoxes:Te}}}placeLayerBucketPart(t,i,d,m,v=1){const{bucket:w,layout:R,paint:N,posMatrix:P,textLabelPlaneMatrix:F,labelToScreenMatrix:V,clippingData:j,textPixelRatio:Z,holdingForFade:Q,collisionBoxArray:K,partiallyEvaluatedTextSize:te,partiallyEvaluatedIconSize:re,collisionGroup:pe,latestFeatureIndex:be}=t.parameters,ye=R.get("text-optional"),Ae=R.get("icon-optional"),ve=R.get("text-allow-overlap"),Se=R.get("icon-allow-overlap"),Te=R.get("text-rotation-alignment")==="map",Me=R.get("text-pitch-alignment")==="map",ze=N.get("symbol-z-offset"),ot=R.get("symbol-elevation-reference")==="sea",[Xe,ft]=R.get("text-size-scale-range"),[gt,Mt]=R.get("icon-size-scale-range"),He=a.ay(v,Xe,ft),mt=a.ay(v,gt,Mt);this.transform.setProjection(w.projection);let qe=ve&&(Se||!w.hasIconData()||Ae),pt=Se&&(ve||!w.hasTextData()||ye);const lt=!ze.isConstant();!w.collisionArrays&&K&&w.deserializeCollisionBoxes(K),d&&m&&w.updateCollisionDebugBuffers(this.transform.zoom,K,He,mt);const yt=(st,dt,Ht)=>{const{crossTileID:kt,numVerticalGlyphVertices:Wt}=st;let hn=null;if(j&&j.dynamicFilterNeedsFeature||lt){const fr=this.retainedQueryData[w.bucketInstanceId];hn=be.loadFeature({featureIndex:st.featureIndex,bucketIndex:fr.bucketIndex,sourceLayerIndex:fr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(j&&!(0,j.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},hn,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new a.P(st.tileAnchorX,st.tileAnchorY),this.transform.calculateDistanceTileData(j.unwrappedTileID)))return this.placements[kt]=new $a(!1,!1,!1,!0),void i.add(kt);const In=ze.evaluate(hn,{});if(i.has(kt))return;if(Q)return void(this.placements[kt]=new $a(!1,!1,!1));let bn=!1,Tn=!1,Mn=!0,tr=!1,yr=!1,Gr=null,Kn={box:null,offscreen:null,occluded:null},ci={box:null},Pn=null,fn=null,ar=null,Dr=0,vr=0,Di=0;Ht.textFeatureIndex?Dr=Ht.textFeatureIndex:st.useRuntimeCollisionCircles&&(Dr=st.featureIndex),Ht.verticalTextFeatureIndex&&(vr=Ht.verticalTextFeatureIndex);const Bi=fr=>{fr.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;const ui=this.transform.elevation;fr.elevation=ot?In:In+(ui?ui.getAtTileOffset(fr.tileID,fr.tileAnchorX,fr.tileAnchorY):0),fr.elevation+=st.zOffset},Ji=Ht.textBox;if(Ji){Bi(Ji);const fr=xr=>{let $r=a.bq.horizontal;if(w.allowVerticalPlacement&&!xr&&this.prevPlacement){const wo=this.prevPlacement.placedOrientations[kt];wo&&(this.placedOrientations[kt]=wo,$r=wo,this.markUsedOrientation(w,$r,st))}return $r},ui=(xr,$r)=>{if(w.allowVerticalPlacement&&Wt>0&&Ht.verticalTextBox){for(const wo of w.writingModes)if(wo===a.bq.vertical?(Kn=$r(),ci=Kn):Kn=xr(),Kn&&Kn.box&&Kn.box.length)break}else Kn=xr()};if(R.get("text-variable-anchor")){let xr=R.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[kt]){const ii=this.prevPlacement.variableOffsets[kt];xr.indexOf(ii.anchor)>0&&(xr=xr.filter(eo=>eo!==ii.anchor),xr.unshift(ii.anchor))}const $r=(ii,eo,Ra)=>{const Hs=w.getSymbolInstanceTextSize(te,st,this.transform.zoom,dt),ka=(ii.x2-ii.x1)*Hs+2*ii.padding,Yo=(ii.y2-ii.y1)*Hs+2*ii.padding,Oa=st.hasIconTextFit&&!Se?eo:null;Oa&&Bi(Oa);let Pi={box:[],offscreen:!1,occluded:!1};const Fl=ve?2*xr.length:xr.length;for(let cl=0;cl<Fl;++cl){const Ul=this.attemptAnchorPlacement(xr[cl%xr.length],ii,ka,Yo,Hs,Te,Me,Z,P,pe,cl>=xr.length,st,dt,w,Ra,Oa,te,re);if(Ul&&(Pi=Ul.placedGlyphBoxes,Pi&&Pi.box&&Pi.box.length)){bn=!0,Gr=Ul.shift;break}}return Pi};ui(()=>$r(Ji,Ht.iconBox,a.bq.horizontal),()=>{const ii=Ht.verticalTextBox;return ii&&Bi(ii),w.allowVerticalPlacement&&!(Kn&&Kn.box&&Kn.box.length)&&Wt>0&&ii?$r(ii,Ht.verticalIconBox,a.bq.vertical):{box:null,offscreen:null,occluded:null}}),Kn&&(bn=Kn.box,Mn=Kn.offscreen,tr=Kn.occluded);const wo=fr(!(!Kn||!Kn.box));if(!bn&&this.prevPlacement){const ii=this.prevPlacement.variableOffsets[kt];ii&&(this.variableOffsets[kt]=ii,this.markUsedJustification(w,ii.anchor,st,wo))}}else{const xr=($r,wo)=>{const ii=w.getSymbolInstanceTextSize(te,st,this.transform.zoom,dt,v),eo=this.collisionIndex.placeCollisionBox(w,ii,$r,new a.P(0,0),ve,Z,P,pe.predicate);return eo&&eo.box&&eo.box.length&&(this.markUsedOrientation(w,wo,st),this.placedOrientations[kt]=wo),eo};ui(()=>xr(Ji,a.bq.horizontal),()=>{const $r=Ht.verticalTextBox;return w.allowVerticalPlacement&&Wt>0&&$r?(Bi($r),xr($r,a.bq.vertical)):{box:null,offscreen:null,occluded:null}}),fr(!!(Kn&&Kn.box&&Kn.box.length))}}if(Pn=Kn,bn=Pn&&Pn.box&&Pn.box.length>0,Mn=Pn&&Pn.offscreen,tr=Pn&&Pn.occluded,st.useRuntimeCollisionCircles){const fr=w.text.placedSymbolArray.get(st.centerJustifiedTextSymbolIndex>=0?st.centerJustifiedTextSymbolIndex:st.verticalPlacedTextSymbolIndex),ui=a.br(w.textSizeData,te,fr),xr=R.get("text-padding");fn=this.collisionIndex.placeCollisionCircles(w,ve,fr,w.lineVertexArray,w.glyphOffsetArray,ui,P,F,V,d,Me,pe.predicate,st.collisionCircleDiameter*ui/a.bw,xr,this.retainedQueryData[w.bucketInstanceId].tileID),bn=ve||fn.circles.length>0&&!fn.collisionDetected,Mn=Mn&&fn.offscreen,tr=fn.occluded}if(Ht.iconFeatureIndex&&(Di=Ht.iconFeatureIndex),Ht.iconBox){const fr=ui=>{Bi(ui);const xr=st.hasIconTextFit&&Gr?Ci(Gr.x,Gr.y,Te,Me,this.transform.angle):new a.P(0,0),$r=w.getSymbolInstanceIconSize(re,this.transform.zoom,st.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,$r,ui,xr,Se,Z,P,pe.predicate)};ci&&ci.box&&ci.box.length&&Ht.verticalIconBox?(ar=fr(Ht.verticalIconBox),Tn=ar.box.length>0):(ar=fr(Ht.iconBox),Tn=ar.box.length>0),Mn=Mn&&ar.offscreen,yr=ar.occluded}const Qi=ye||st.numHorizontalGlyphVertices===0&&Wt===0,ma=Ae||st.numIconVertices===0;if(Qi||ma?ma?Qi||(Tn=Tn&&bn):bn=Tn&&bn:Tn=bn=Tn&&bn,bn&&Pn&&Pn.box&&this.collisionIndex.insertCollisionBox(Pn.box,R.get("text-ignore-placement"),w.bucketInstanceId,ci&&ci.box&&vr?vr:Dr,pe.ID),Tn&&ar&&this.collisionIndex.insertCollisionBox(ar.box,R.get("icon-ignore-placement"),w.bucketInstanceId,Di,pe.ID),fn&&(bn&&this.collisionIndex.insertCollisionCircles(fn.circles,R.get("text-ignore-placement"),w.bucketInstanceId,Dr,pe.ID),d)){const fr=w.bucketInstanceId;let ui=this.collisionCircleArrays[fr];ui===void 0&&(ui=this.collisionCircleArrays[fr]=new by);for(let xr=0;xr<fn.circles.length;xr+=4)ui.circles.push(fn.circles[xr+0]),ui.circles.push(fn.circles[xr+1]),ui.circles.push(fn.circles[xr+2]),ui.circles.push(fn.collisionDetected?1:0)}const Fi=w.projection.name!=="globe";qe=qe&&(Fi||!tr),pt=pt&&(Fi||!yr),this.placements[kt]=new $a(bn||qe,Tn||pt,Mn||w.justReloaded),i.add(kt)};if(w.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(w,this.retainedQueryData[w.bucketInstanceId].tileID),w.elevationType==="road"&&w.updateRoadElevation(),w.updateZOffset(),w.sortFeaturesByY){const st=w.getSortedSymbolIndexes(this.transform.angle);for(let dt=st.length-1;dt>=0;--dt){const Ht=st[dt];yt(w.symbolInstances.get(Ht),Ht,w.collisionArrays[Ht])}w.hasAnyZOffset&&a.w(`${w.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(w.hasAnyZOffset){const st=w.getSortedIndexesByZOffset();for(let dt=0;dt<st.length;++dt){const Ht=st[dt];yt(w.symbolInstances.get(Ht),Ht,w.collisionArrays[Ht])}}else for(let st=t.symbolInstanceStart;st<t.symbolInstanceEnd;st++)yt(w.symbolInstances.get(st),st,w.collisionArrays[st]);if(d&&w.bucketInstanceId in this.collisionCircleArrays){const st=this.collisionCircleArrays[w.bucketInstanceId];a.ad.mat4.invert(st.invProjMatrix,P),st.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(t,i,d,m){const{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:w,rightJustifiedTextSymbolIndex:R,verticalPlacedTextSymbolIndex:N,crossTileID:P}=d,F=a.bB(i),V=m===a.bq.vertical?N:F==="left"?v:F==="center"?w:F==="right"?R:-1;v>=0&&(t.text.placedSymbolArray.get(v).crossTileID=V>=0&&v!==V?0:P),w>=0&&(t.text.placedSymbolArray.get(w).crossTileID=V>=0&&w!==V?0:P),R>=0&&(t.text.placedSymbolArray.get(R).crossTileID=V>=0&&R!==V?0:P),N>=0&&(t.text.placedSymbolArray.get(N).crossTileID=V>=0&&N!==V?0:P)}markUsedOrientation(t,i,d){const m=i===a.bq.horizontal||i===a.bq.horizontalOnly?i:0,v=i===a.bq.vertical?i:0,{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:R,rightJustifiedTextSymbolIndex:N,verticalPlacedTextSymbolIndex:P}=d,F=t.text.placedSymbolArray;w>=0&&(F.get(w).placedOrientation=m),R>=0&&(F.get(R).placedOrientation=m),N>=0&&(F.get(N).placedOrientation=m),P>=0&&(F.get(P).placedOrientation=v)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const i=this.prevPlacement;let d=!1;this.prevZoomAdjustment=i?i.zoomAdjustment(this.transform.zoom):0;const m=i?i.symbolFadeChange(t):1,v=i?i.opacities:{},w=i?i.variableOffsets:{},R=i?i.placedOrientations:{};for(const N in this.placements){const P=this.placements[N],F=v[N];F?(this.opacities[N]=new hc(F,m,P.text,P.icon,null,P.clipped),d=d||P.text!==F.text.placed||P.icon!==F.icon.placed):(this.opacities[N]=new hc(null,m,P.text,P.icon,P.skipFade,P.clipped),d=d||P.text||P.icon)}for(const N in v){const P=v[N];if(!this.opacities[N]){const F=new hc(P,m,!1,!1);F.isHidden()||(this.opacities[N]=F,d=d||P.text.placed||P.icon.placed)}}for(const N in w)this.variableOffsets[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.variableOffsets[N]=w[N]);for(const N in R)this.placedOrientations[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.placedOrientations[N]=R[N]);d?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=i?i.lastPlacementChangeTime:t)}updateLayerOpacities(t,i,d,m){const v=new Set;for(const w of i){const R=w.getBucket(t);R&&w.latestFeatureIndex&&t.fqid===R.layerIds[0]&&(this.updateBucketOpacities(R,v,w,w.collisionBoxArray,d,m,w.tileID,t.scope),R.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(R,w.tileID),R.elevationType==="road"&&R.updateRoadElevation(),R.updateZOffset())}}updateBucketOpacities(t,i,d,m,v,w,R,N){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const P=t.layers[0].layout,F=t.layers[0].paint,V=!!t.layers[0].dynamicFilter(),j=new hc(null,0,!1,!1,!0),Z=P.get("text-allow-overlap"),Q=P.get("icon-allow-overlap"),K=P.get("text-variable-anchor"),te=P.get("text-rotation-alignment")==="map",re=P.get("text-pitch-alignment")==="map",pe=F.get("symbol-z-offset"),be=P.get("symbol-elevation-reference")==="sea",ye=!pe.isConstant(),Ae=new hc(null,0,Z&&(Q||!t.hasIconData()||P.get("icon-optional")),Q&&(Z||!t.hasTextData()||P.get("text-optional")),!0);!t.collisionArrays&&m&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(m);const ve=(Te,Me,ze)=>{for(let ot=0;ot<Me/4;ot++)Te.opacityVertexArray.emplaceBack(ze)};let Se=0;w&&t.updateReplacement(R,w);for(let Te=0;Te<t.symbolInstances.length;Te++){const Me=t.symbolInstances.get(Te),{numHorizontalGlyphVertices:ze,numVerticalGlyphVertices:ot,crossTileID:Xe,numIconVertices:ft,tileAnchorX:gt,tileAnchorY:Mt}=Me;let He=null;const mt=this.retainedQueryData[t.bucketInstanceId];ye&&Me&&mt&&(He=d.latestFeatureIndex.loadFeature({featureIndex:Me.featureIndex,bucketIndex:mt.bucketIndex,sourceLayerIndex:mt.sourceLayerIndex,layoutVertexArrayOffset:0}));const qe=pe.evaluate(He,{}),pt=i.has(Xe);let lt=this.opacities[Xe];pt?lt=j:lt||(lt=Ae,this.opacities[Xe]=lt),i.add(Xe);const yt=ze>0||ot>0,st=ft>0,dt=this.placedOrientations[Xe],Ht=dt===a.bq.vertical,kt=dt===a.bq.horizontal||dt===a.bq.horizontalOnly;!yt&&!st||lt.isHidden()||Se++;let Wt=!1;if((yt||st)&&w)for(const hn of t.activeReplacements){if(a.bx(hn,v,a.by.Symbol,N)||hn.min.x>gt||gt>hn.max.x||hn.min.y>Mt||Mt>hn.max.y)continue;const In=a.bz(gt,Mt,R.canonical,hn.footprintTileId.canonical);if(Wt=a.bA(In,hn.footprint),Wt)break}if(yt){const hn=Wt?fc:qc(lt.text);ve(t.text,ze,Ht?fc:hn),ve(t.text,ot,kt?fc:hn);const In=lt.text.isHidden(),{leftJustifiedTextSymbolIndex:bn,centerJustifiedTextSymbolIndex:Tn,rightJustifiedTextSymbolIndex:Mn,verticalPlacedTextSymbolIndex:tr}=Me,yr=t.text.placedSymbolArray,Gr=In||Ht?1:0;bn>=0&&(yr.get(bn).hidden=Gr),Tn>=0&&(yr.get(Tn).hidden=Gr),Mn>=0&&(yr.get(Mn).hidden=Gr),tr>=0&&(yr.get(tr).hidden=In||kt?1:0);const Kn=this.variableOffsets[Xe];Kn&&this.markUsedJustification(t,Kn.anchor,Me,dt);const ci=this.placedOrientations[Xe];ci&&(this.markUsedJustification(t,"left",Me,ci),this.markUsedOrientation(t,ci,Me))}if(st){const hn=Wt?fc:qc(lt.icon),{placedIconSymbolIndex:In,verticalPlacedIconSymbolIndex:bn}=Me,Tn=t.icon.placedSymbolArray,Mn=lt.icon.isHidden()?1:0;In>=0&&(ve(t.icon,ft,Ht?fc:hn),Tn.get(In).hidden=Mn),bn>=0&&(ve(t.icon,Me.numVerticalIconVertices,kt?fc:hn),Tn.get(bn).hidden=Mn)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const hn=t.collisionArrays[Te];if(hn){let In=new a.P(0,0),bn=!0;if(hn.textBox||hn.verticalTextBox){if(K){const Mn=this.variableOffsets[Xe];Mn?(In=Ps(Mn.anchor,Mn.width,Mn.height,Mn.textOffset,Mn.textScale),te&&In._rotate(re?this.transform.angle:-this.transform.angle)):bn=!1}V&&(bn=!lt.clipped),hn.textBox&&Tl(t.textCollisionBox.collisionVertexArray,lt.text.placed,!bn||Ht,qe,be,In.x,In.y),hn.verticalTextBox&&Tl(t.textCollisionBox.collisionVertexArray,lt.text.placed,!bn||kt,qe,be,In.x,In.y)}const Tn=bn&&!!(!kt&&hn.verticalIconBox);hn.iconBox&&Tl(t.iconCollisionBox.collisionVertexArray,lt.icon.placed,Tn,qe,be,Me.hasIconTextFit?In.x:0,Me.hasIconTextFit?In.y:0),hn.verticalIconBox&&Tl(t.iconCollisionBox.collisionVertexArray,lt.icon.placed,!Tn,qe,be,Me.hasIconTextFit?In.x:0,Me.hasIconTextFit?In.y:0)}}}if(t.fullyClipped=Se===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const Te=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=Te.invProjMatrix,t.placementViewportMatrix=Te.viewportMatrix,t.collisionCircleArray=Te.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,i){const d=this.zoomAtLastRecencyCheck===i?1-this.zoomAdjustment(i):1;return this.zoomAtLastRecencyCheck=i,this.commitTime+this.fadeDuration*d>t}setStale(){this.stale=!0}}function Tl(h,t,i,d,m,v,w){h.emplaceBack(t?1:0,i?1:0,v||0,w||0,d,m?1:0),h.emplaceBack(t?1:0,i?1:0,v||0,w||0,d,m?1:0),h.emplaceBack(t?1:0,i?1:0,v||0,w||0,d,m?1:0),h.emplaceBack(t?1:0,i?1:0,v||0,w||0,d,m?1:0)}const Yp=Math.pow(2,25),Io=Math.pow(2,24),wy=Math.pow(2,17),Wp=Math.pow(2,16),Za=Math.pow(2,9),Pu=Math.pow(2,8),Sy=Math.pow(2,1);function qc(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const t=h.placed?1:0,i=Math.floor(127*h.opacity);return i*Yp+t*Io+i*wy+t*Wp+i*Za+t*Pu+i*Sy+t}const fc=0;class Xp{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,i,d,m,v,w){const R=this._bucketParts;for(;this._currentTileIndex<t.length;)if(i.getBucketParts(R,m,t[this._currentTileIndex],this._sortAcrossTiles,w),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,R.sort((N,P)=>N.sortKey-P.sortKey));this._currentPartIndex<R.length;){const N=R[this._currentPartIndex];if(i.placeLayerBucketPart(N,this._seenCrossTileIDs,d,N.symbolInstanceStart===0,w),this._currentPartIndex++,v())return!0}return!1}}class El{constructor(t,i,d,m,v,w,R,N,P){this.placement=new Zp(t,v,w,R,N,P),this._currentPlacementIndex=i.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(t,i,d,m,v){const w=a.q.now(),R=()=>{const N=a.q.now()-w;return!this._forceFullPlacement&&N>2};for(;this._currentPlacementIndex>=0;){const N=i[t[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(N.type==="symbol"&&(!N.minzoom||N.minzoom<=P)&&(!N.maxzoom||N.maxzoom>P)){const F=N,V=F.layout.get("symbol-z-elevate"),j=F.layout.get("symbol-sort-key").constantOr(1)!==void 0,Z=F.layout.get("symbol-z-order"),Q=Z==="viewport-y"||Z==="auto"&&!(Z!=="viewport-y"&&j),K=F.layout.get("text-allow-overlap")||F.layout.get("icon-allow-overlap")||F.layout.get("text-ignore-placement")||F.layout.get("icon-ignore-placement"),te=Q&&K,re=this._inProgressLayer=this._inProgressLayer||new Xp(F),pe=a.C(N.source,N.scope);if(re.continuePlacement(V||te?m[pe]:d[pe],this.placement,this._showCollisionBoxes,N,R,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Ya=512/a.ai/2;class Ty{constructor(t,i,d){this.tileID=t,this.bucketInstanceId=d,this.index=new a.bE(i.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const m=t.canonical.x*a.ai,v=t.canonical.y*a.ai;for(let w=0;w<i.length;w++){const{key:R,crossTileID:N,tileAnchorX:P,tileAnchorY:F}=i.get(w),V=Math.floor((m+P)*Ya),j=Math.floor((v+F)*Ya);this.index.add(V,j),this.keys.push(R),this.crossTileIDs.push(N)}this.index.finish()}findMatches(t,i,d){const m=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z),v=Ya/Math.pow(2,i.canonical.z-this.tileID.canonical.z),w=i.canonical.x*a.ai,R=i.canonical.y*a.ai;for(let N=0;N<t.length;N++){const P=t.get(N);if(P.crossTileID)continue;const{key:F,tileAnchorX:V,tileAnchorY:j}=P,Z=Math.floor((w+V)*v),Q=Math.floor((R+j)*v),K=this.index.range(Z-m,Q-m,Z+m,Q+m);for(const te of K){const re=this.crossTileIDs[te];if(this.keys[te]===F&&!d.has(re)){d.add(re),P.crossTileID=re;break}}}}}class Rg{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ff{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const i=Math.round((t-this.lng)/360);if(i!==0)for(const d in this.indexes){const m=this.indexes[d],v={};for(const w in m){const R=m[w];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+i),v[R.tileID.key]=R}this.indexes[d]=v}this.lng=t}addBucket(t,i,d){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===i.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let v=0;v<i.symbolInstances.length;v++)i.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const m=this.usedCrossTileIDs[t.overscaledZ];for(const v in this.indexes){const w=this.indexes[v];if(Number(v)>t.overscaledZ)for(const R in w){const N=w[R];N.tileID.isChildOf(t)&&N.findMatches(i.symbolInstances,t,m)}else{const R=w[t.scaledTo(Number(v)).key];R&&R.findMatches(i.symbolInstances,t,m)}}for(let v=0;v<i.symbolInstances.length;v++){const w=i.symbolInstances.get(v);w.crossTileID||(w.crossTileID=d.generate(),m.add(w.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ty(t,i.symbolInstances,i.bucketInstanceId),!0}removeBucketCrossTileIDs(t,i){for(const d of i.crossTileIDs)this.usedCrossTileIDs[t].delete(d)}removeStaleBuckets(t){let i=!1;for(const d in this.indexes){const m=this.indexes[d];for(const v in m)t[m[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,m[v]),delete m[v],i=!0)}return i}}class Lu{constructor(){this.layerIndexes={},this.crossTileIDs=new Rg,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,i,d,m){let v=this.layerIndexes[t.fqid];v===void 0&&(v=this.layerIndexes[t.fqid]=new ff);let w=!1;const R={};m.name!=="globe"&&v.handleWrapJump(d);for(const N of i){const P=N.getBucket(t);P&&t.fqid===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(N.tileID,P,this.crossTileIDs)&&(w=!0),R[P.bucketInstanceId]=!0)}return v.removeStaleBuckets(R)&&(w=!0),w}pruneUnusedLayers(t){const i={};t.forEach(d=>{i[d]=!0});for(const d in this.layerIndexes)i[d]||delete this.layerIndexes[d]}}const Al=771;class Xn{constructor(t,i,d,m){this.blendFunction=t,this.blendColor=i,this.mask=d,this.blendEquation=m}}Xn.Replace=[1,0,1,0],Xn.disabled=new Xn(Xn.Replace,a.al.transparent,[!1,!1,!1,!1]),Xn.unblended=new Xn(Xn.Replace,a.al.transparent,[!0,!0,!0,!0]),Xn.alphaBlended=new Xn([1,Al,1,Al],a.al.transparent,[!0,!0,!0,!0]),Xn.alphaBlendedNonPremultiplied=new Xn([770,Al,770,Al],a.al.transparent,[!0,!0,!0,!0]),Xn.multiply=new Xn([774,0,774,0],a.al.transparent,[!0,!0,!0,!0]);class _n{constructor(t,i,d){this.func=t,this.mask=i,this.range=d}}_n.ReadOnly=!1,_n.ReadWrite=!0,_n.disabled=new _n(519,_n.ReadOnly,[0,1]);const pf=7680;class Bn{constructor(t,i,d,m,v,w){this.test=t,this.ref=i,this.mask=d,this.fail=m,this.depthFail=v,this.pass=w}}Bn.disabled=new Bn({func:519,mask:0},0,0,pf,pf,pf);const Wa=1029,ba=2305;class Dn{constructor(t,i,d){this.enable=t,this.mode=i,this.frontFace=d}}function mf(h,t){const i=a.bG(h,3);a.ad.mat4.fromQuat(h,t),a.bI(h,3,i)}function la(h,t){const i=a.ad.quat.identity([]);return a.ad.quat.rotateZ(i,i,-t),a.ad.quat.rotateX(i,i,-h),i}function Bu(h,t){const i=[h[0],h[1],0],d=[t[0],t[1],0];if(a.ad.vec3.length(i)>=1e-15){const w=a.ad.vec3.normalize([],i);a.ad.vec3.scale(d,w,a.ad.vec3.dot(d,w)),t[0]=d[0],t[1]=d[1]}const m=a.ad.vec3.cross([],t,h);if(a.ad.vec3.len(m)<1e-15)return null;const v=Math.atan2(-m[1],m[0]);return la(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),v)}Dn.disabled=new Dn(!1,Wa,ba),Dn.backCCW=new Dn(!0,Wa,ba),Dn.backCW=new Dn(!0,Wa,2304),Dn.frontCW=new Dn(!0,1028,2304),Dn.frontCCW=new Dn(!0,1028,ba);class Kp{constructor(t,i){this.position=t,this.orientation=i}get position(){return this._position}set position(t){if(t){const i=t instanceof a.ac?t:new a.ac(t[0],t[1],t[2]);this._renderWorldCopies&&(i.x=a.bF(i.x,0,1)),this._position=i}else this._position=null}lookAtPoint(t,i){if(this.orientation=null,!this.position)return;const d=this.position,m=this._elevation?this._elevation.getAtPointOrZero(a.ac.fromLngLat(t)):0,v=a.ac.fromLngLat(t,m),w=[v.x-d.x,v.y-d.y,v.z-d.z];i||(i=[0,0,1]),i[2]=Math.abs(i[2]),this.orientation=Bu(w,i)}setPitchBearing(t,i){this.orientation=la(a.ak(t),a.ak(-i))}}class Cl{constructor(t,i){this._transform=a.ad.mat4.identity([]),this.orientation=i,this.position=t}get mercatorPosition(){const t=this.position;return new a.ac(t[0],t[1],t[2])}get position(){const t=a.bG(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var i;t&&a.bI(this._transform,3,[(i=t)[0],i[1],i[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||a.ad.quat.identity([]),t&&mf(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),i=this.right();return{bearing:Math.atan2(-i[1],i[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,i){this._orientation=la(t,i),mf(this._transform,this._orientation)}forward(){const t=a.bG(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=a.bG(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=a.bG(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,i){const d=new Float64Array(16);return a.ad.mat4.invert(d,this.getWorldToCamera(t,i)),d}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,i,d){const m=this.position;a.ad.vec3.scale(m,m,-t);const v=new Float64Array(16);return a.ad.mat4.fromScaling(v,[d,d,d]),a.ad.mat4.translate(v,v,m),v[10]*=i,v}getWorldToCamera(t,i){const d=new Float64Array(16),m=new Float64Array(4),v=this.position;return a.ad.quat.conjugate(m,this._orientation),a.ad.vec3.scale(v,v,-t),a.ad.mat4.fromQuat(d,m),a.ad.mat4.translate(d,d,v),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=i,d[9]*=i,d[10]*=i,d[11]*=i,d}getCameraToClipPerspective(t,i,d,m){const v=new Float64Array(16);return a.ad.mat4.perspective(v,t,i,d,m),v}getCameraToClipOrthographic(t,i,d,m,v,w){const R=new Float64Array(16);return a.ad.mat4.ortho(R,t,i,d,m,v,w),R}getDistanceToElevation(t,i=!1){const d=t===0?0:a.bH(t,i?a.aT(this.position[1]):this.position[1]),m=this.forward();return(d-this.position[2])/m[2]}clone(){return new Cl([...this.position],[...this.orientation])}}const mi={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Gd{constructor(t=0,i=0,d=0,m=0){if(isNaN(t)||t<0||isNaN(i)||i<0||isNaN(d)||d<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=i,this.left=d,this.right=m}interpolate(t,i,d){return i.top!=null&&t.top!=null&&(this.top=a.ah(t.top,i.top,d)),i.bottom!=null&&t.bottom!=null&&(this.bottom=a.ah(t.bottom,i.bottom,d)),i.left!=null&&t.left!=null&&(this.left=a.ah(t.left,i.left,d)),i.right!=null&&t.right!=null&&(this.right=a.ah(t.right,i.right,d)),this}getCenter(t,i){const d=a.ay((this.left+t-this.right)/2,0,t),m=a.ay((this.top+i-this.bottom)/2,0,i);return new a.P(d,m)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Gd(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const zt=15;class gf{constructor(t,i,d,m,v,w,R){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=t||0,this._maxZoom=i||22,this._minPitch=d??0,this._maxPitch=m??60,this.setProjection(w),this.setMaxBounds(R),this.width=0,this.height=0,this._center=new a.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Gd,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Cl,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new gf(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<zt}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,i=!1){const d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||d)&&this._updateCameraOnTerrain(),(t||d)&&this._constrainCamera(i),this._calcMatrices()}getProjection(){return a.aA(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const i=this.projection?this.getProjection():void 0;this.projection=a.bP(this.projectionOptions);const d=this.getProjection(),m=!a.bn(i,d);return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=a.bP({name:"mercator"});const i=t!==this.projection.name;return i&&this._calcMatrices(),i}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return a.bF(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const i=-t*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=a.ad.mat2.create(),a.ad.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const i=a.ay(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=a.ak(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const i=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==i&&(this._unmodified=!1,this._setZoom(i),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,i=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!i||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const d=this._elevation;i||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&d.exaggeration()&&this._centerAltitudeValidForExaggeration!==d.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*d.exaggeration(),this._centerAltitudeValidForExaggeration=d.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=d.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,i=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop();let m=0,v=0;for(let w=0;w<i.length;w++){const R=new a.P(i[w][0]*this.width,d+i[w][1]*(this.height-d)),N=t.pointCoordinate(R);if(!N)continue;const P=1/Math.hypot(N[0]-this._camera.position[0],N[1]-this._camera.position[1]);m+=N[3]*P,v+=P}return v===0?NaN:m/v}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,i=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*i,m=this._mercatorZfromZoom(t),v=this._mercatorZfromZoom(this._maxZoom),w=Math.max(m-d,v);this._setZoom(this._zoomFromMercatorZ(w))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const i=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let d;d=t.z<this._camera.position[2]?[i.x,i.y,i.z]:[t.x,t.y,t.z];const m=a.ad.vec3.length(a.ad.vec3.sub([],this._camera.position,d));return a.ay(this._zoomFromMercatorZ(m),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let i=!1;if(t.orientation&&!a.ad.quat.exactEquals(t.orientation,this._camera.orientation)&&(i=this._setCameraOrientation(t.orientation)),t.position){const d=[t.position.x,t.position.y,t.position.z];a.ad.vec3.exactEquals(d,this._camera.position)||(this._setCameraPosition(d),i=!0)}i&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,i=new Kp;return i.position=new a.ac(t[0],t[1],t[2]),i.orientation=this._camera.orientation,i._elevation=this.elevation,i._renderWorldCopies=this.renderWorldCopies,i}_setCameraOrientation(t){if(!a.ad.quat.length(t))return!1;a.ad.quat.normalize(t,t);const i=a.ad.vec3.transformQuat([],[0,0,-1],t),d=a.ad.vec3.transformQuat([],[0,-1,0],t);if(d[2]<0)return!1;const m=Bu(i,d);return!!m&&(this._camera.orientation=m,!0)}_setCameraPosition(t){const i=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,m=this.cameraToCenterDistance;t[2]=a.ay(t[2],m/d,m/i),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,i,d){this._unmodified=!1,this._edgeInsets.interpolate(t,i,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const i=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,i)}getVisibleUnwrappedCoordinates(t){const i=[new a.bQ(0,t)];if(this.renderWorldCopies){const d=this.pointCoordinate(new a.P(0,0)),m=this.pointCoordinate(new a.P(this.width,0)),v=this.pointCoordinate(new a.P(this.width,this.height)),w=this.pointCoordinate(new a.P(0,this.height)),R=Math.floor(Math.min(d.x,m.x,v.x,w.x)),N=Math.floor(Math.max(d.x,m.x,v.x,w.x)),P=1;for(let F=R-P;F<=N+P;F++)F!==0&&i.push(new a.bQ(F,t))}return i}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,i,d){let m=[];const v=d!==void 0,w=!v;if(w&&this.zoom<i||v&&d[0]===0&&d[1]===0)return m;const R=new Set,N=(F,V,j,Z,Q)=>{const K=a.c5(V,F,j,Z,Q);R.has(K)||(m.push(new a.aH(F,V,j,Z,Q)),R.add(K))};for(let F=0;F<t.length;F++){const V=t[F];if(w&&V.canonical.z!==i)continue;const j=V.canonical,Z=V.overscaledZ,Q=V.wrap,K=1<<j.z,te=j.x+1<K,re=j.x>0,pe=j.y+1<K,be=j.y>0,ye=V.wrap-(re?0:1),Ae=V.wrap+(te?0:1),ve=re?j.x-1:K-1,Se=te?j.x+1:0;if(v)d[0]<0?(N(Z,Ae,j.z,Se,j.y),d[1]<0&&pe&&(N(Z,Q,j.z,j.x,j.y+1),N(Z,Ae,j.z,Se,j.y+1)),d[1]>0&&be&&(N(Z,Q,j.z,j.x,j.y-1),N(Z,Ae,j.z,Se,j.y-1))):d[0]>0?(N(Z,ye,j.z,ve,j.y),d[1]<0&&pe&&(N(Z,Q,j.z,j.x,j.y+1),N(Z,ye,j.z,ve,j.y+1)),d[1]>0&&be&&(N(Z,Q,j.z,j.x,j.y-1),N(Z,ye,j.z,ve,j.y-1))):d[1]<0&&pe?N(Z,Q,j.z,j.x,j.y+1):be&&N(Z,Q,j.z,j.x,j.y-1);else{const Te=V.visibleQuadrants;1&Te&&(N(Z,ye,j.z,ve,j.y),be&&(N(Z,Q,j.z,j.x,j.y-1),N(Z,ye,j.z,ve,j.y-1))),2&Te&&(N(Z,Ae,j.z,Se,j.y),be&&(N(Z,Q,j.z,j.x,j.y-1),N(Z,Ae,j.z,Se,j.y-1))),4&Te&&(N(Z,ye,j.z,ve,j.y),pe&&(N(Z,Q,j.z,j.x,j.y+1),N(Z,ye,j.z,ve,j.y+1))),8&Te&&(N(Z,Ae,j.z,Se,j.y),pe&&(N(Z,Q,j.z,j.x,j.y+1),N(Z,Ae,j.z,Se,j.y+1)))}}const P=[];for(const F of m)m.some(V=>F.isChildOf(V))||P.push(F);if(m=P.filter(F=>!t.some(V=>!!(F.overscaledZ<i&&V.isChildOf(F))||F.equals(V)||F.isChildOf(V))),w){const F=1<<i,V=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),j=[F*V.x,F*V.y],Z=4,Q=Z*Z;m=m.filter(K=>{const te=K.canonical.x+.5-j[0],re=K.canonical.y+.5-j[1];return te*te+re*re<Q})}return m}coveringTiles(t){let i=this.coveringZoomLevel(t);const d=i,m=this.elevation&&this.elevation.exaggeration(),v=m&&!t.isTerrainDEM,w=this.projection.name==="mercator";if(t.minzoom!==void 0&&i<t.minzoom)return[];t.maxzoom!==void 0&&i>t.maxzoom&&(i=t.maxzoom);const R=this.locationCoordinate(this.center),N=this.center.lat,P=1<<i,F=[P*R.x,P*R.y,0],V=this.projection.name==="globe",j=!V,Z=a.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,j),Q=V?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),K=P*a.bH(1,this.center.lat),te=this._camera.position[2]/a.bH(1,this.center.lat),re=[P*Q.x,P*Q.y,te*(j?1:K)],pe=V||m,be=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ye=this.isLODDisabled(!0)?i:0;let Ae;if(this._elevation&&t.isTerrainDEM)Ae=1e4*this._elevation.exaggeration();else if(this._elevation){const qe=this._elevation.getMinMaxForVisibleTiles();Ae=qe?qe.max:this._centerAltitude}else Ae=this._centerAltitude;const ve=t.isTerrainDEM?-Ae:this._elevation?this._elevation.getMinElevationBelowMSL():0,Se=this.projection.isReprojectedInTileSpace?a.bS(this):1,Te=qe=>{const lt=new a.ac(qe.x+25e-6,qe.y,qe.z),yt=new a.ac(qe.x,qe.y+25e-6,qe.z),st=qe.toLngLat(),dt=lt.toLngLat(),Ht=yt.toLngLat(),kt=this.locationCoordinate(st),Wt=this.locationCoordinate(dt),hn=this.locationCoordinate(Ht),In=Math.hypot(Wt.x-kt.x,Wt.y-kt.y),bn=Math.hypot(hn.x-kt.x,hn.y-kt.y);return Math.sqrt(In*bn)*Se/25e-6},Me=qe=>{const pt=Ae,lt=ve;return{aabb:a.bV(this,P,0,0,0,qe,lt,pt,this.projection),zoom:0,x:0,y:0,minZ:lt,maxZ:pt,wrap:qe,fullyVisible:!1}},ze=[];let ot=[];const Xe=i,ft=t.reparseOverscaled?d:i,gt=(te-this._centerAltitude)*K,Mt=qe=>{if(!this._elevation||!qe.tileID||!w)return;const pt=this._elevation.getMinMaxForTile(qe.tileID),lt=qe.aabb;pt?(lt.min[2]=pt.min,lt.max[2]=pt.max,lt.center[2]=(lt.min[2]+lt.max[2])/2):(qe.shouldSplit=mt(qe),qe.shouldSplit||(lt.min[2]=lt.max[2]=lt.center[2]=this._centerAltitude))},He=(qe,pt)=>{if(.707*pt<qe)return 1;const lt=pt/qe;return lt/(1.4144271570014144+(Math.pow(1.1,lt-1.4144271570014144+1)-1)/(1.1-1)-1)},mt=qe=>{if(qe.zoom<ye)return!0;if(qe.zoom===Xe)return!1;if(qe.shouldSplit!=null)return qe.shouldSplit;const pt=qe.aabb.distanceX(re),lt=qe.aabb.distanceY(re);let yt=gt,st=1;if(V){yt=qe.aabb.distanceZ(re);const bn=Math.pow(2,qe.zoom),Tn=a.aT((qe.y+1)/bn),Mn=a.aT(qe.y/bn),tr=Math.min(Math.max(N,Tn),Mn),yr=a.ca(tr)/a.ca(N);if(st=tr===N?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,yr/this._mercatorScaleRatio),this.zoom<=a.c6&&qe.zoom===Xe-1&&yr>=.9)return!0}else if(v&&(yt=qe.aabb.distanceZ(re)*K),this.projection.isReprojectedInTileSpace&&d<=5){const bn=Math.pow(2,qe.zoom),Tn=Te(new a.ac((qe.x+.5)/bn,(qe.y+.5)/bn));st=Tn>.85?1:Tn}if(!w){const bn=Math.sqrt(pt*pt+lt*lt+yt*yt);let Tn=(1<<Xe-qe.zoom)*be*st;return Tn*=He(Math.max(yt,gt),bn),bn<Tn}let dt=Number.MAX_VALUE,Ht=0;const kt=qe.aabb.getCorners(),Wt=[];for(const bn of kt){a.ad.vec3.sub(Wt,bn,re),V||(v?Wt[2]*=K:Wt[2]=gt);const Tn=a.ad.vec3.dot(Wt,this._camera.forward());Tn<dt&&(dt=Tn,Ht=Math.abs(Wt[2]))}let hn=(1<<Xe-qe.zoom)*be*st;if(hn*=He(Math.max(Ht,gt),dt),dt<hn)return!0;const In=qe.aabb.closestPoint(F);return In[0]===F[0]&&In[1]===F[1]};if(this.renderWorldCopies)for(let qe=1;qe<=3;qe++)ze.push(Me(-qe)),ze.push(Me(qe));for(ze.push(Me(0));ze.length>0;){const qe=ze.pop(),pt=qe.x,lt=qe.y;let yt=qe.fullyVisible;const st=()=>this.projection.name==="globe"&&(qe.y===0||qe.y===(1<<qe.zoom)-1);if(!yt){let dt=pe?qe.aabb.intersects(Z):qe.aabb.intersectsFlat(Z);if(dt===0&&st()){const Ht=new a.bT(qe.zoom,pt,lt);dt=a.bU(this,P,Ht,!0).intersects(Z)}if(dt===0)continue;yt=dt===2}if(qe.zoom!==Xe&&mt(qe))for(let dt=0;dt<4;dt++){const Ht=(pt<<1)+dt%2,kt=(lt<<1)+(dt>>1),Wt={aabb:w?qe.aabb.quadrant(dt):a.bV(this,P,qe.zoom+1,Ht,kt,qe.wrap,qe.minZ,qe.maxZ,this.projection),zoom:qe.zoom+1,x:Ht,y:kt,wrap:qe.wrap,fullyVisible:yt,tileID:void 0,shouldSplit:void 0,minZ:qe.minZ,maxZ:qe.maxZ};v&&!V&&(Wt.tileID=new a.aH(qe.zoom+1===Xe?ft:qe.zoom+1,qe.wrap,qe.zoom+1,Ht,kt),Mt(Wt)),ze.push(Wt)}else{const dt=qe.zoom===Xe?ft:qe.zoom;if(t.minzoom&&t.minzoom>dt)continue;let Ht=0;if(!yt){let In=pe?qe.aabb.intersectsPrecise(Z):qe.aabb.intersectsPreciseFlat(Z);if(In===0&&st()){const bn=new a.bT(qe.zoom,pt,lt);In=a.bU(this,P,bn,!0).intersectsPrecise(Z)}if(In===0)continue;if(t.calculateQuadrantVisibility)if(Z.containsPoint(qe.aabb.center))Ht=15;else for(let bn=0;bn<4;bn++)qe.aabb.quadrant(bn).intersects(Z)!==0&&(Ht|=1<<bn)}const kt=F[0]-(.5+pt+(qe.wrap<<qe.zoom))*(1<<i-qe.zoom),Wt=F[1]-.5-lt,hn=qe.tileID?qe.tileID:new a.aH(dt,qe.wrap,qe.zoom,pt,lt);t.calculateQuadrantVisibility&&(hn.visibleQuadrants=Ht),ot.push({tileID:hn,distanceSq:kt*kt+Wt*Wt})}}if(this.fogCullDistSq){const qe=this.fogCullDistSq,pt=this.horizonLineFromTop();ot=ot.filter(lt=>{const yt=[0,0,0,1],st=[a.ai,a.ai,0,1],dt=this.calculateFogTileMatrix(lt.tileID.toUnwrapped());a.ad.vec4.transformMat4(yt,yt,dt),a.ad.vec4.transformMat4(st,st,dt);const Ht=a.ad.vec4.min([],yt,st),kt=a.ad.vec4.max([],yt,st),Wt=a.bW(Ht,kt);if(Wt===0)return!0;let hn=!1;const In=this._elevation;if(In&&Wt>qe&&pt!==0){const bn=this.calculateProjMatrix(lt.tileID.toUnwrapped());let Tn;t.isTerrainDEM||(Tn=In.getMinMaxForTile(lt.tileID)),Tn||(Tn={min:ve,max:Ae});const Mn=a.c7(this.rotation),tr=[Mn[0]*a.ai,Mn[1]*a.ai,Tn.max];a.ad.vec3.transformMat4(tr,tr,bn),hn=(1-tr[1])*this.height*.5<pt}return Wt<qe||hn})}return ot.sort((qe,pt)=>qe.distanceSq-pt.distanceSq).map(qe=>qe.tileID)}resize(t,i){this.width=t,this.height=i,this.pixelsToGLUnits=[2/t,-2/i],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const i=a.ay(t.lat,-a.bX,a.bX),d=this.projection.project(t.lng,i);return new a.P(d.x*this.worldSize,d.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/a.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,i){let d,m;const v=this.centerPoint;if(this.projection.name==="globe"){const R=this.worldSize;d=(i.x-v.x)/R,m=(i.y-v.y)/R}else{const R=this.pointCoordinate(i),N=this.pointCoordinate(v);d=R.x-N.x,m=R.y-N.y}const w=this.locationCoordinate(t);this.setLocation(new a.ac(w.x-d,w.y-m))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,i){return this.projection.locationPoint(this,t,i)}locationPoint3D(t,i){return this.projection.locationPoint(this,t,i,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,i){return this.coordinateLocation(this.pointCoordinate3D(t,i))}locationCoordinate(t,i){const d=i?a.bH(i,t.lat):void 0,m=this.projection.project(t.lng,t.lat);return new a.ac(m.x,m.y,d)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,i){const d=i??this._centerAltitude,m=[t.x,t.y,0,1],v=[t.x,t.y,1,1];a.ad.vec4.transformMat4(m,m,this.pixelMatrixInverse),a.ad.vec4.transformMat4(v,v,this.pixelMatrixInverse);const w=v[3];a.ad.vec4.scale(m,m,1/m[3]),a.ad.vec4.scale(v,v,1/w);const R=m[2],N=v[2];return{p0:m,p1:v,t:R===N?0:(d-R)/(N-R)}}screenPointToMercatorRay(t){const i=[t.x,t.y,0,1],d=[t.x,t.y,1,1];return a.ad.vec4.transformMat4(i,i,this.pixelMatrixInverse),a.ad.vec4.transformMat4(d,d,this.pixelMatrixInverse),a.ad.vec4.scale(i,i,1/i[3]),a.ad.vec4.scale(d,d,1/d[3]),i[2]=a.bH(i[2],this._center.lat)*this.worldSize,d[2]=a.bH(d[2],this._center.lat)*this.worldSize,a.ad.vec4.scale(i,i,1/this.worldSize),a.ad.vec4.scale(d,d,1/this.worldSize),new a.as([i[0],i[1],i[2]],a.ad.vec3.normalize([],a.ad.vec3.sub([],d,i)))}rayIntersectionCoordinate(t){const{p0:i,p1:d,t:m}=t,v=a.bH(i[2],this._center.lat),w=a.bH(d[2],this._center.lat);return new a.ac(a.ah(i[0],d[0],m)/this.worldSize,a.ah(i[1],d[1],m)/this.worldSize,a.ah(v,w,m))}pointCoordinate(t,i=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,i)}pointCoordinate3D(t,i){if(!this.elevation)return this.pointCoordinate(t,i);let d=this.projection.pointCoordinate3D(this,t.x,t.y);if(d)return new a.ac(d[0],d[1],d[2]);let m=0,v=this.horizonLineFromTop();if(t.y>v)return this.pointCoordinate(t,i);const w=.02*v,R=t.clone();for(let N=0;N<10&&v-m>w;N++){R.y=a.ah(m,v,.66);const P=this.projection.pointCoordinate3D(this,R.x,R.y);P?(v=R.y,d=P):m=R.y}return d?new a.ac(d[0],d[1],d[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=a.bY)return!this.isPointAboveHorizon(t);const i=this.pointCoordinate(t);return i.y>=0&&i.y<=1}_coordinatePoint(t,i){const d=i&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,m=[t.x*this.worldSize,t.y*this.worldSize,d+t.toAltitude(),1];return a.ad.vec4.transformMat4(m,m,this.pixelMatrix),m[3]>0?new a.P(m[0]/m[3],m[1]/m[3]):new a.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:i}=this._edgeInsets,d=this.height-this._edgeInsets.bottom,m=this.width-this._edgeInsets.right,v=this.pointLocation3D(new a.P(i,t)),w=this.pointLocation3D(new a.P(m,t)),R=this.pointLocation3D(new a.P(m,d)),N=this.pointLocation3D(new a.P(i,d));let P=Math.min(v.lng,w.lng,R.lng,N.lng),F=Math.max(v.lng,w.lng,R.lng,N.lng),V=Math.min(v.lat,w.lat,R.lat,N.lat),j=Math.max(v.lat,w.lat,R.lat,N.lat);const Z=Math.pow(2,-this.zoom)/16*270,Q=this.projection.name==="globe"?1:4,K=(te,re,pe,be,ye)=>{const Ae=(te+pe)/2,ve=(re+be)/2,Se=new a.P(Ae,ve),{lng:Te,lat:Me}=this.pointLocation3D(Se),ze=Math.max(0,P-Te,V-Me,Te-F,Me-j);P=Math.min(P,Te),F=Math.max(F,Te),V=Math.min(V,Me),j=Math.max(j,Me),(ye<Q||ze>Z)&&(K(te,re,Ae,ve,ye+1),K(Ae,ve,pe,be,ye+1))};if(K(i,t,m,t,1),K(m,t,m,d,1),K(m,d,i,d,1),K(i,d,i,t,1),this.projection.name==="globe"){const[te,re]=a.bZ(this);te?(j=90,F=180,P=-180):re&&(V=-90,F=180,P=-180)}return new a.aB(new a.bO(P,V),new a.bO(F,j))}_getBoundsRectangular(t,i){const{top:d,left:m}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,R=new a.P(m,d),N=new a.P(w,d),P=new a.P(w,v),F=new a.P(m,v);let V=this.pointCoordinate(R,t),j=this.pointCoordinate(N,t);const Z=this.pointCoordinate(P,i),Q=this.pointCoordinate(F,i),K=(te,re)=>(re.y-te.y)/(re.x-te.x);return V.y>1&&j.y>=0?V=new a.ac((1-Q.y)/K(Q,V)+Q.x,1):V.y<0&&j.y<=1&&(V=new a.ac(-Q.y/K(Q,V)+Q.x,0)),j.y>1&&V.y>=0?j=new a.ac((1-Z.y)/K(Z,j)+Z.x,1):j.y<0&&V.y<=1&&(j=new a.ac(-Z.y/K(Z,j)+Z.x,0)),new a.aB().extend(this.coordinateLocation(V)).extend(this.coordinateLocation(j)).extend(this.coordinateLocation(Q)).extend(this.coordinateLocation(Z))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const i=t.visibleDemTiles.reduce((d,m)=>{if(m.dem){const v=m.dem.tree;d.min=Math.min(d.min,v.minimums[0]),d.max=Math.max(d.max,v.maximums[0])}return d},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(i.min*t.exaggeration(),i.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const i=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,d=this.height/2-i*(1-this._horizonShift);return t?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-a.bX,this.maxLat=a.bX,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.av(this.minLng)*this.tileSize,this.worldMaxX=a.av(this.maxLng)*this.tileSize,this.worldMinY=a.aC(this.maxLat)*this.tileSize,this.worldMaxY=a.aC(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,i){return this.projection.createTileMatrix(this,i,t)}calculateDistanceTileData(t){const i=t.key,d=this._distanceTileDataCache;if(d[i])return d[i];const m=t.canonical,v=1/this.height,w=this.cameraWorldSize,R=w/this.zoomScale(m.z),N=(m.x+Math.pow(2,m.z)*t.wrap)*R,P=m.y*R,F=this.point;F.x*=w/this.worldSize,F.y*=w/this.worldSize;const V=this.angle,j=Math.sin(-V),Z=-Math.cos(-V);return d[i]={bearing:[j,Z],center:[(F.x-N)*v,(F.y-P)*v],scale:R/a.ai*v},d[i]}calculateFogTileMatrix(t){const i=t.key,d=this._fogTileMatrixCache;if(d[i])return d[i];const m=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return a.ad.mat4.multiply(m,this.worldToFogMatrix,m),d[i]=new Float32Array(m),d[i]}calculateProjMatrix(t,i=!1,d=!1){const m=t.key;let v;if(v=d?this._expandedProjMatrixCache:i?this._alignedProjMatrixCache:this._projMatrixCache,v[m])return v[m];const w=this.calculatePosMatrix(t,this.worldSize);let R;return R=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.expandedFarZProjMatrix:i?this.alignedProjMatrix:this.projMatrix,a.ad.mat4.multiply(w,R,w),v[m]=new Float32Array(w),v[m]}calculatePixelsToTileUnitsMatrix(t){const i=t.tileID.key,d=this._pixelsToTileUnitsCache;if(d[i])return d[i];const m=a.b_(t,this);return d[i]=m,d[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,i=a.ad.mat4.fromScaling([],[t,t,t]);return a.ad.mat4.multiply(i,i,this.globeMatrix),i}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const i=a.bH(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(i),m=this._camera.forward(),v=a.bH(1,this._center.lat);d[2]/=v,m[2]/=v,a.ad.vec3.normalize(m,m);const w=t.raycast(d,m,t.exaggeration());if(w){const R=a.ad.vec3.scaleAndAdd([],d,m,w),N=new a.ac(R[0],R[1],a.bH(R[2],a.aT(R[1]))),P=(N.z+a.ad.vec3.length([N.x-d[0],N.y-d[1],N.z-d[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(P),this._centerAltitude=N.toAltitude(),this._center=this.coordinateLocation(N),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const i=this._elevation,d=a.bH(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(d),v=i.getAtPointOrZero(new a.ac(...m)),w=this.pixelsPerMeter/this.worldSize*v,R=this._minimumHeightOverTerrain(),N=m[2]-w;if(N<=R)if(N<0||t){const P=this.locationCoordinate(this._center,this._centerAltitude),F=[m[0],m[1],P.z-m[2]],V=a.ad.vec3.length(F);F[2]-=(R-N)/this._pixelsPerMercatorPixel;const j=a.ad.vec3.length(F);if(j===0)return;a.ad.vec3.scale(F,F,V/j*this._pixelsPerMercatorPixel),this._camera.position=[m[0],m[1],P.z*this._pixelsPerMercatorPixel-F[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const j=this.center;return j.lat=a.ay(j.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(j.lng=a.ay(j.lng,this.minLng,this.maxLng)),this.center=j,void(this._constraining=!1)}const i=this._unmodified,{x:d,y:m}=this.point;let v=0,w=d,R=m;const N=this.width/2,P=this.height/2,F=this.worldMinY*this.scale,V=this.worldMaxY*this.scale;if(m-P<F&&(R=F+P),m+P>V&&(R=V-P),V-F<this.height&&(v=Math.max(v,this.height/(V-F)),R=(V+F)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const j=this.worldMinX*this.scale,Z=this.worldMaxX*this.scale,Q=this.worldSize/2-(j+Z)/2;w=(d+Q+this.worldSize)%this.worldSize-Q,w-N<j&&(w=j+N),w+N>Z&&(w=Z-N),Z-j<this.width&&(v=Math.max(v,this.width/(Z-j)),w=(Z+j)/2)}w===d&&R===m||this._allowWorldUnderZoom||(this.center=this.unproject(new a.P(w,R))),v&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(v)),this._constrainCamera(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,i=this.projection.name==="globe",d=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=a.bH(1,this.center.lat)/a.bH(1,a.c8));const m=a.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v=this.projection.zAxisUnit==="meters"?d:1,w=this._camera.getWorldToCamera(this.worldSize,v);let R;const N=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(N[8]=2*-t.x/this.width,N[9]=2*t.y/this.height,this.isOrthographic){let Me=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ze=Me*this.aspect,ot=-ze,Xe=-Me;ze-=t.x,ot-=t.x,Me+=t.y,Xe+=t.y,R=this._camera.getCameraToClipOrthographic(ot,ze,Xe,Me,this._nearZ,this._farZ),((ft,gt,Mt,He)=>{for(let mt=0;mt<16;mt++)ft[mt]=a.ah(gt[mt],Mt[mt],He)})(R,R,N,a.c9(this.pitch>=zt?1:this.pitch/zt))}else R=N;const P=a.ad.mat4.mul([],N,w);let F=a.ad.mat4.mul([],R,w);if(this.projection.isReprojectedInTileSpace){const Me=this.locationCoordinate(this.center),ze=a.ad.mat4.identity([]);a.ad.mat4.translate(ze,ze,[Me.x*this.worldSize,Me.y*this.worldSize,0]),a.ad.mat4.multiply(ze,ze,a.c0(this)),a.ad.mat4.translate(ze,ze,[-Me.x*this.worldSize,-Me.y*this.worldSize,0]),a.ad.mat4.multiply(F,F,ze),a.ad.mat4.multiply(P,P,ze),this.inverseAdjustmentMatrix=a.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=a.ad.mat4.scale([],F,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=F,this.invProjMatrix=a.ad.mat4.invert(new Float64Array(16),this.projMatrix),i){const Me=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Me[8]=2*-t.x/this.width,Me[9]=2*t.y/this.height,this.expandedFarZProjMatrix=a.ad.mat4.mul([],Me,w)}else this.expandedFarZProjMatrix=this.projMatrix;const V=a.ad.mat4.invert([],R);this.frustumCorners=a.c2.fromInvProjectionMatrix(V,this.horizonLineFromTop(),this.height),this.cameraFrustum=a.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!i);const j=new Float32Array(16);a.ad.mat4.identity(j),a.ad.mat4.scale(j,j,[1,-1,1]),a.ad.mat4.rotateX(j,j,this._pitch),a.ad.mat4.rotateZ(j,j,this.angle);const Z=a.ad.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=a.ad.mat4.clone(Z);const Q=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Z[8]=2*-t.x/this.width,Z[9]=2*(t.y+Q)/this.height,this.skyboxMatrix=a.ad.mat4.multiply(j,Z,j);const K=this.point,te=K.x,re=K.y,pe=this.width%2/2,be=this.height%2/2,ye=Math.cos(this.angle),Ae=Math.sin(this.angle),ve=te-Math.round(te)+ye*pe+Ae*be,Se=re-Math.round(re)+ye*be+Ae*pe,Te=new Float64Array(F);if(a.ad.mat4.translate(Te,Te,[ve>.5?ve-1:ve,Se>.5?Se-1:Se,0]),this.alignedProjMatrix=Te,F=a.ad.mat4.create(),a.ad.mat4.scale(F,F,[this.width/2,-this.height/2,1]),a.ad.mat4.translate(F,F,[1,-1,0]),this.labelPlaneMatrix=F,F=a.ad.mat4.create(),a.ad.mat4.scale(F,F,[1,-1,1]),a.ad.mat4.translate(F,F,[-1,-1,0]),a.ad.mat4.scale(F,F,[2/this.width,2/this.height,1]),this.glCoordMatrix=F,this.pixelMatrix=a.ad.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,P),this._calcFogMatrices(),this._distanceTileDataCache={},F=a.ad.mat4.invert(new Float64Array(16),this.pixelMatrix),!F)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=F,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=a.c3(this);const Me=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.ad.vec3.transformMat4(Me,Me,w),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=F;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,i=this.cameraPixelsPerMeter,d=this._camera.position,m=1/this.height/this._pixelsPerMercatorPixel,v=[t,t,i];a.ad.vec3.scale(v,v,m),a.ad.vec3.scale(d,d,-1),a.ad.vec3.multiply(d,d,v);const w=a.ad.mat4.create();a.ad.mat4.translate(w,w,d),a.ad.mat4.scale(w,w,v),this.mercatorFogMatrix=w,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,i,m)}_computeCameraPosition(t){const i=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),m=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*i-t/this.worldSize*this._centerAltitude;return[m.x/this.worldSize-d[0]*v,m.y/this.worldSize-d[1]*v,t/this.worldSize*this._centerAltitude-d[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const i=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=this._camera.position[2],m=t[2];let v=1;this.projection.wrap&&(this.center=this.center.wrap()),m>0&&(v=Math.min((i-d)/m,1)),this._camera.position=a.ad.vec3.scaleAndAdd([],this._camera.position,t,v),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,i=this._camera.forward(),{pitch:d,bearing:m}=this._camera.getPitchBearing(),v=a.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,w=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.ak(this._maxPitch)),R=Math.max((t[2]-v)/Math.cos(d),w),N=this._zoomFromMercatorZ(R);a.ad.vec3.scaleAndAdd(t,t,i,R),this._pitch=a.ay(d,a.ak(this.minPitch),a.ak(this.maxPitch)),this.angle=a.bF(m,-Math.PI,Math.PI),this._setZoom(a.ay(N,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a.ac(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let i=0,d=a.bY,m=0,v=1/0;for(;d-i>1e-6&&d>i;){const w=i+.5*(d-i),R=this.tileSize*Math.pow(2,w),N=this.getCameraToCenterDistance(this.projection,w,R),P=this.scaleZoom(N/(t*this.tileSize)),F=Math.abs(w-P);F<v&&(v=F,m=w),w<P?i=w:d=w}return m}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,i){const d=Math.min(t.x,i.x),m=Math.max(t.x,i.x),v=Math.min(t.y,i.y),w=Math.max(t.y,i.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const R=[new a.P(d,v),new a.P(m,w),new a.P(d,w),new a.P(m,v)],N=this.renderWorldCopies?-3:0,P=this.renderWorldCopies?4:1;for(const F of R){const V=this.pointRayIntersection(F);if(V.t<0)return!0;const j=this.rayIntersectionCoordinate(V);if(j.x<N||j.y<0||j.x>P||j.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.P(0,0),new a.P(this.width,this.height))}zoomDeltaToMovement(t,i){const d=a.ad.vec3.length(a.ad.vec3.sub([],this._camera.position,t)),m=this._zoomFromMercatorZ(d)+i;return d-this._mercatorZfromZoom(m)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([i,d,m],v){const w=[i,d,m,1];a.ad.vec4.transformMat4(w,w,v);const R=w[3]=Math.max(w[3],1e-6);return w[0]/=R,w[1]/=R,w[2]/=R,w}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,t))}}getCameraToCenterDistance(t,i=this.zoom,d=this.worldSize){const m=a.b$(t,i,this.width,this.height,1024),v=t.pixelSpaceConversion(this.center.lat,d,m);let w=.5/Math.tan(.5*this._fov)*this.height*v;return this.isOrthographic&&(w=a.ah(1,w,a.c9(this.pitch>=zt?1:this.pitch/zt))),w}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&a.ad.mat4.multiply(t,t,this.globeMatrix),t}getFrustum(t){return a.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const wa=(h,t)=>{if(t>0&&h.terrain&&a.w("Cutoff is currently disabled on terrain"),t<=0||h.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const i=h.transform,d=Math.max(Math.abs(i._zoom-(h.minCutoffZoom-1)),1),m=i.isLODDisabled(!1)?a.ae(60,45,i.pitch):a.ae(30,15,i.pitch),v=i._farZ-i._nearZ,w=t*i.height,R=((1-(N=m))*i.cameraToCenterDistance+N*(i._farZ+w))*d;var N;return{shouldRenderCutoff:m<1,uniformValues:{u_cutoff_params:[i._nearZ,i._farZ,(R-i._nearZ)/v,(R-w-i._nearZ)/v]}}},zi={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Dl{constructor(t,i){this.aabb=t,this.lastCascade=i}}class $d{add(t,i){const d=this.receivers[t.key];d!==void 0?(d.aabb.min[0]=Math.min(d.aabb.min[0],i.min[0]),d.aabb.min[1]=Math.min(d.aabb.min[1],i.min[1]),d.aabb.min[2]=Math.min(d.aabb.min[2],i.min[2]),d.aabb.max[0]=Math.max(d.aabb.max[0],i.max[0]),d.aabb.max[1]=Math.max(d.aabb.max[1],i.max[1]),d.aabb.max[2]=Math.max(d.aabb.max[2],i.max[2])):this.receivers[t.key]=new Dl(i,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,i,d){const m=a.ce.fromPoints(t.points);let v=0;for(const w in this.receivers){const R=this.receivers[w];if(!R||!m.intersectsAabb(R.aabb))continue;R.aabb.min=m.closestPoint(R.aabb.min),R.aabb.max=m.closestPoint(R.aabb.max);const N=R.aabb.getCorners();for(let P=0;P<d.length;P++){let F=!0;for(const V of N){const j=[V[0]*i,V[1]*i,V[2]];if(a.ad.vec3.transformMat4(j,j,d[P].matrix),j[0]<-1||j[0]>1||j[1]<-1||j[1]>1){F=!1;break}}if(R.lastCascade=P,v=Math.max(v,P),F)break}}return v+1}}class Xa{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new $d,this._depthMode=new _n(t.context.gl.LEQUAL,_n.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(zi,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(zi,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(zi,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,i){const d=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!i||!i.properties)return;const m=i.properties.get("shadow-intensity");if(!i.shadowsEnabled()||m<=0||(this._shadowLayerCount=d.style.order.reduce((Q,K)=>{const te=d.style._mergedLayers[K];return Q+(te.hasShadowPass()&&!te.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const v=d.context,w=zi.shadowMapResolution,R=zi.shadowMapResolution;if(this._cascades.length===0||zi.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Q=0;Q<zi.cascadeCount;++Q){const K=d._shadowMapDebug,te=v.gl,re=v.createFramebuffer(w,R,K,"texture"),pe=new a.T(v,{width:w,height:R,data:null},te.DEPTH_COMPONENT16);if(re.depthAttachment.set(pe.texture),K){const be=new a.T(v,{width:w,height:R,data:null},te.RGBA8);re.colorAttachment.set(be.texture)}this._cascades.push({framebuffer:re,texture:pe,matrix:[],far:0,boundingSphereRadius:0,frustum:new a.bR,scale:0})}}this.shadowDirection=Ka(i);let N=0;if(t.elevation){const Q=t.elevation,K=[1e4,-1e4];Q.visibleDemTiles.filter(te=>te.dem).forEach(te=>{const re=te.dem.tree;K[0]=Math.min(K[0],re.minimums[0]),K[1]=Math.max(K[1],re.maximums[0])}),K[0]!==1e4&&(N=(K[1]-K[0])*Q.exaggeration())}const P=1.5*t.cameraToCenterDistance,F=3*P,V=new Float64Array(16);for(let Q=0;Q<this._cascades.length;++Q){const K=this._cascades[Q];let te=t.height/50,re=1;zi.cascadeCount===1?re=F:Q===0?re=P:(te=P,re=F);const[pe,be]=Si(t,this.shadowDirection,te,re,zi.shadowMapResolution,N);K.scale=t.scale,K.matrix=pe,K.boundingSphereRadius=be,a.ad.mat4.invert(V,K.matrix),K.frustum=a.bR.fromInvProjectionMatrix(V,1,0,!0),K.far=re}const j=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[j].far,this._cascades[j].far],this._uniformValues.u_shadow_intensity=m,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/zi.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=zi.shadowMapResolution,this._uniformValues.u_shadowmap_0=mi.ShadowMap0,this._uniformValues.u_shadowmap_1=mi.ShadowMap0+1,this._groundShadowTiles=d.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const Z=d.transform.elevation;for(const Q of this._groundShadowTiles){let K={min:0,max:0};if(Z){const te=Z.getMinMaxForTile(Q);te&&(K=te)}this.addShadowReceiver(Q.toUnwrapped(),K.min,K.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,i){if(!this.enabled)return;const d=this.painter,m=d.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(d.transform.getFrustum(0),d.transform.worldSize,this._cascades),m.viewport.set([0,0,zi.shadowMapResolution,zi.shadowMapResolution]);for(let v=0;v<this._numCascadesToRender;++v){d.currentShadowCascade=v,m.bindFramebuffer.set(this._cascades[v].framebuffer.framebuffer),m.clear({color:a.al.white,depth:1});for(const w of t.order){const R=t._mergedLayers[w];if(!R.hasShadowPass()||R.isHidden(d.transform.zoom))continue;const N=t.getLayerSourceCache(R),P=N?i[N.id]:void 0;(R.type==="model"||P&&P.length)&&d.renderLayer(d,N,R,P)}}d.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,i=t.style,d=t.context,m=i.directionalLight,v=i.ambientLight;if(!m||!v)return;const w=[],R=wa(t,t.longestCutoffRange);R.shouldRenderCutoff&&w.push("RENDER_CUTOFF"),w.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&w.push("NORMAL_OFFSET");const N=Sa(i,m,v),P=new _n(d.gl.LEQUAL,_n.ReadOnly,t.depthRangeFor3D);for(const F of this._groundShadowTiles){const V=F.toUnwrapped(),j=t.isTileAffectedByFog(F),Z=t.getOrCreateProgram("groundShadow",{defines:w,overrideFog:j});this.setupShadows(V,Z),t.uploadCommonUniforms(d,Z,V,null,R);const Q={u_matrix:t.transform.calculateProjMatrix(V),u_ground_shadow_factor:N};Z.draw(t,d.gl.TRIANGLES,P,Bn.disabled,Xn.multiply,Dn.disabled,Q,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Xn.unblended:Xn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const i=this.painter.transform,d=i.calculatePosMatrix(t,i.worldSize);return a.ad.mat4.multiply(d,this._cascades[this.painter.currentShadowCascade].matrix,d),Float32Array.from(d)}calculateShadowPassMatrixFromMatrix(t){return a.ad.mat4.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,i,d,m=0){if(!this.enabled)return;const v=this.painter.transform,w=this.painter.context,R=w.gl,N=this._uniformValues,P=new Float64Array(16),F=v.calculatePosMatrix(t,v.worldSize);for(let V=0;V<this._cascades.length;V++)a.ad.mat4.multiply(P,this._cascades[V].matrix,F),N[V===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(P),w.activeTexture.set(R.TEXTURE0+mi.ShadowMap0+V),this._cascades[V].texture.bind(R.NEAREST,R.CLAMP_TO_EDGE);if(this.useNormalOffset=!!d,this.useNormalOffset){const V=a.cd(t.canonical),j=2/v.tileSize*a.ai/zi.shadowMapResolution,Z=j*this._cascades[0].boundingSphereRadius,Q=j*this._cascades[this._cascades.length-1].boundingSphereRadius,K=(d==="vector-tile"?1:3)/Math.pow(2,m-t.canonical.z-(1-v.zoom+Math.floor(v.zoom)));N.u_shadow_normal_offset=[V,Z*K,Q*K],N.u_shadow_bias=[6e-5,.0012,.012]}else N.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(w,N)}setupShadowsFromMatrix(t,i,d=!1){if(!this.enabled)return;const m=this.painter.context,v=m.gl,w=this._uniformValues,R=new Float64Array(16);for(let N=0;N<zi.cascadeCount;N++)a.ad.mat4.multiply(R,this._cascades[N].matrix,t),w[N===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(R),m.activeTexture.set(v.TEXTURE0+mi.ShadowMap0+N),this._cascades[N].texture.bind(v.NEAREST,v.CLAMP_TO_EDGE);if(this.useNormalOffset=d,d){const N=zi.normalOffset;w.u_shadow_normal_offset=[1,N,N],w.u_shadow_bias=[6e-5,.0012,.012]}else w.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(m,w)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,i,d,m){if(m[2]>=0)return{};const v=function(N,P,F){const V=F/(1<<N.canonical.z);return new a.ce([N.canonical.x*V+N.wrap*F,N.canonical.y*V+N.wrap*F,0],[(N.canonical.x+1)*V+N.wrap*F,(N.canonical.y+1)*V+N.wrap*F,P])}(t,i,d).getCorners(),w=i/-m[2];m[0]<0?(a.ad.vec3.add(v[0],v[0],[m[0]*w,0,0]),a.ad.vec3.add(v[3],v[3],[m[0]*w,0,0])):m[0]>0&&(a.ad.vec3.add(v[1],v[1],[m[0]*w,0,0]),a.ad.vec3.add(v[2],v[2],[m[0]*w,0,0])),m[1]<0?(a.ad.vec3.add(v[0],v[0],[0,m[1]*w,0]),a.ad.vec3.add(v[1],v[1],[0,m[1]*w,0])):m[1]>0&&(a.ad.vec3.add(v[2],v[2],[0,m[1]*w,0]),a.ad.vec3.add(v[3],v[3],[0,m[1]*w,0]));const R={};return R.vertices=v,R.planes=[Ml(v[1],v[0],v[4]),Ml(v[2],v[1],v[5]),Ml(v[3],v[2],v[6]),Ml(v[0],v[3],v[7])],R}addShadowReceiver(t,i,d){this._receivers.add(t,a.ce.fromTileIdAndHeight(t,i,d))}getMaxCascadeForTile(t){const i=this._receivers.get(t);return i&&i.lastCascade?i.lastCascade:0}}function Ml(h,t,i){const d=a.ad.vec3.sub([],i,t),m=a.ad.vec3.sub([],h,t),v=a.ad.vec3.cross([],d,m),w=a.ad.vec3.length(v);return w===0?[0,0,1,0]:(a.ad.vec3.scale(v,v,1/w),[v[0],v[1],v[2],-a.ad.vec3.dot(v,t)])}function Ka(h){const t=h.properties.get("direction"),i=a.cc(t.x,t.y,t.z);i[2]=a.ay(i[2],0,75);const d=a.cf([i[0],i[1],i[2]]);return a.ad.vec3.fromValues(d.x,d.y,d.z)}function Sa(h,t,i){const d=t.properties.get("color-use-theme")==="none",m=t.properties.get("color"),v=t.properties.get("intensity"),w=t.properties.get("direction"),R=[w.x,w.y,w.z],N=i.properties.get("color-use-theme")==="none",P=i.properties.get("color"),F=i.properties.get("intensity"),V=Math.max(a.ad.vec3.dot([0,0,1],R),0),j=[0,0,0];a.ad.vec3.scale(j,P.toRenderColor(N?null:h.getLut(t.scope)).toArray01Linear().slice(0,3),F);const Z=[0,0,0];return a.ad.vec3.scale(Z,m.toRenderColor(d?null:h.getLut(i.scope)).toArray01Linear().slice(0,3),V*v),a.cg([j[0]>0?j[0]/(j[0]+Z[0]):0,j[1]>0?j[1]/(j[1]+Z[1]):0,j[2]>0?j[2]/(j[2]+Z[2]):0])}function Si(h,t,i,d,m,v){const w=h.zoom,R=h.scale,N=h.worldSize,P=1/N,F=h.aspect,V=Math.sqrt(1+F*F)*Math.tan(.5*h.fovX),j=V*V,Z=d-i,Q=d+i;let K,te;j>Z/Q?(K=d,te=d*V):(K=.5*Q*(1+j),te=.5*Math.sqrt(Z*Z+2*(d*d+i*i)*j+Q*Q*j*j));const re=h.projection.pixelsPerMeter(h.center.lat,N),pe=h._camera.getCameraToWorldMercator(),be=[0,0,-K*P];a.ad.vec3.transformMat4(be,be,pe);let ye=te*P;const Ae=h._edgeInsets;if(!(Ae.left===0&&Ae.top===0&&Ae.right===0&&Ae.bottom===0||Ae.left===Ae.right&&Ae.top===Ae.bottom)){const yt=h._camera.getWorldToCamera(h.worldSize,h.projection.zAxisUnit==="meters"?re:1),st=h._camera.getCameraToClipPerspective(h._fov,h.width/h.height,i,d);st[8]=2*-h.centerOffset.x/h.width,st[9]=2*h.centerOffset.y/h.height;const dt=new Float64Array(16);a.ad.mat4.mul(dt,st,yt);const Ht=new Float64Array(16);a.ad.mat4.invert(Ht,dt);const kt=a.bR.fromInvProjectionMatrix(Ht,N,w,!0);for(const Wt of kt.points){const hn=((ve=Wt)[0]/=R,ve[1]/=R,ve[2]=a.bH(ve[2],h._center.lat),ve);ye=Math.max(ye,a.ad.vec3.len(a.ad.vec3.subtract([],be,hn)))}}var ve;ye*=m/(m-1);const Se=Math.acos(t[2]),Te=Math.atan2(-t[0],-t[1]),Me=new Cl;Me.position=be,Me.setPitchBearing(Se,Te);const ze=Me.getWorldToCamera(N,re),ot=ye*N,Xe=Math.min(h._mercatorZfromZoom(17)*N*-2,-2*ot),ft=Me.getCameraToClipOrthographic(-ot,ot,-ot,ot,Xe,(ot+v*re)/t[2]),gt=new Float64Array(16);a.ad.mat4.multiply(gt,ft,ze);const Mt=a.ad.vec3.fromValues(Math.floor(1e6*be[0])/1e6*N,Math.floor(1e6*be[1])/1e6*N,0),He=.5*m,mt=[0,0,0];a.ad.vec3.transformMat4(mt,Mt,gt),a.ad.vec3.scale(mt,mt,He);const qe=[Math.floor(mt[0]),Math.floor(mt[1]),Math.floor(mt[2])],pt=[0,0,0];a.ad.vec3.sub(pt,mt,qe),a.ad.vec3.scale(pt,pt,-1/He);const lt=new Float64Array(16);return a.ad.mat4.identity(lt),a.ad.mat4.translate(lt,lt,pt),a.ad.mat4.multiply(gt,lt,gt),[gt,ot]}class Jp extends a.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.numModelsLoading={}}loadModel(t,i){return a.aN(this.requestManager.transformRequest(i,a.R.Model).url).then(d=>{if(!d)return;const m=a.aO(d),v=new a.aP(t,void 0,void 0,m);return v.computeBoundsAndApplyParent(),v}).catch(d=>{if(d&&d.status===404)return null;this.fire(new a.z(new Error(`Could not load model ${t} from ${i}: ${d.message}`)))})}load(t,i,d={keepNumReferences:!1}){this.models[i]||(this.models[i]={});const m=Object.keys(t);this.numModelsLoading[i]=(this.numModelsLoading[i]||0)+m.length;const v=[];for(const w of m)v.push(this.loadModel(w,t[w]));Promise.allSettled(v).then(w=>{for(let R=0;R<w.length;R++){const{status:N,value:P}=w[R];if(N==="fulfilled"&&P){const F=this.models[i][m[R]];this.models[i][m[R]]={model:P,numReferences:d.keepNumReferences&&F?F.numReferences:1}}}this.numModelsLoading[i]-=m.length,this.fire(new a.A("data",{dataType:"style"}))}).catch(w=>{this.fire(new a.z(new Error(`Could not load models: ${w.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,i){return!!this.getModel(t,i)}getModel(t,i){return this.models[i]||(this.models[i]={}),this.models[i][t]?this.models[i][t].model:void 0}addModel(t,i,d){this.models[d]||(this.models[d]={}),this.modelUris[d]||(this.modelUris[d]={}),this.hasModel(t,d)&&this.models[d][t].numReferences++,this.modelUris[d][t]=this.requestManager.normalizeModelURL(i),this.load({[t]:this.modelUris[d][t]},d)}addModels(t,i){this.models[i]||(this.models[i]={}),this.modelUris[i]||(this.modelUris[i]={});const d=this.modelUris[i];for(const m in t)this.models[i][m]={},d[m]=this.requestManager.normalizeModelURL(t[m]);this.load(d,i,{keepNumReferences:!0})}reloadModels(t){this.load(this.modelUris[t],t)}addModelsFromBucket(t,i){this.models[i]||(this.models[i]={}),this.modelUris[i]||(this.modelUris[i]={});const d={};for(const m of t)this.hasModel(m,i)?this.models[i][m].numReferences++:(this.modelUris[i][m]=this.requestManager.normalizeModelURL(m),d[m]=this.modelUris[i][m]);this.load(d,i)}removeModel(t,i){if(this.models[i]&&this.models[i][t]&&(this.models[i][t].numReferences--,this.models[i][t].numReferences===0)){const d=this.models[i][t].model;delete this.models[i][t],delete this.modelUris[i][t],d.destroy()}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,i){this.models[i]||(this.models[i]={});for(const d in this.models[i])this.models[i][d].model&&this.models[i][d].model.upload(t.context)}}const Ey=new a.a7({data:new a.a8(a.a5.colorTheme.data)}),_f={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function Hc(h){return h=h||{},Object.assign(h,_f)}class Zd extends a.E{constructor(t){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},a.aQ(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=t,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new a.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=t.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=t.stylesheet.indoor.buildingFeaturesetId,this._scope=t.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:t=>(t.feature&&t.feature.properties.floorplan&&this.selectFloorplan(t.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(t){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(w,R){const[N,P]=w,{center:F,radius:V}=R,[j,Z]=F,Q=Math.abs(N-j);return Math.sqrt((Q>180?360-Q:Q)**2+(P-Z)**2)<=V}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new a.A("floorplangone")));const i={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},d=new a.P(this._map.transform.width/2,this._map.transform.height/2),m=[new a.P(0,0),new a.P(this._map.transform.width,this._map.transform.height)],v=this._map.queryRenderedFeatures(t?m:d,i);v.length>0&&(this._selectedFloorplan&&v[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=v[0],this._floorplanSelected(!1)))}_floorplanSelected(t){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(v){const[[w,R],[N,P]]=v,F=(N-w+360)%360,V=F>180?360-F:F;return{center:[(w+V/2+360)%360,(R+P)/2],radius:Math.sqrt(V**2+(P-R)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const i=this._floorplanStates[this._indoorData.id].selectedBuilding,d=this._floorplanStates[this._indoorData.id].selectedLevel;let m;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const v of this._indoorData.levels)v.id===this._selectedLevel.id&&(m=v.id);if(this.fire(new a.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:m})),i){const v=this._indoorData.buildings.find(w=>w.id===i);this._buildingSelected(v,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(d){const v=this._indoorData.levels.find(w=>w.id===d);this._updateLevels(v,t)}else t&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(t,i){i&&t&&t.extent&&this._map.fitBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=t?t.id:void 0;const d=this._indoorData.levels.filter(m=>t.levels.includes(m.id));this.fire(new a.A("buildingselected",{buildingId:t.id,levels:d}))}_levelSelected(t){if(t==="overview")this._updateLevels(void 0,!0);else{const i=this._indoorData.levels.find(d=>d.id===t);this._updateLevels(i,!0)}this.fire(new a.A("levelselected",{levelId:t==="overview"?void 0:t}))}_updateLevels(t,i){if(!t)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(i&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function d(P){const F=P.indexOf("/floor/");if(F===-1)return P;const V=F+7,j=P.indexOf("/",V);return j===-1?P.slice(V):P.slice(V,j)}this._selectedLevel=t,this._floorplanStates[this._indoorData.id].selectedLevel=t?t.id:void 0;const m=[],v={},w={},R={},N={};for(const P of this._indoorData.levels)if(m.push(P.id),v[P.id]=P.height,w[P.id]=P.base,t){if(this.mergeFloors){const F=d(t.id),V=d(P.id);R[P.id]=V===F?"true":"false"}else R[P.id]=P.id===t.id?"true":"false";N[P.id]=P.base<t.base?"true":"false"}else N[P.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",m]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",v]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",w]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",R]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",N]),t&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!t.isUnderground),i&&t.extent)){const P=this._map.cameraForBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),F=this._map.getZoom(),V=P.zoom?Math.abs(F-P.zoom):0;this._map.fitBounds(t.extent,V>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:F})}}selectFloorplan(t){const i={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},d=[new a.P(0,0),new a.P(this._map.transform.width,this._map.transform.height)],m=this._map.queryRenderedFeatures(d,i);if(m.length>0){for(const v of m)if(JSON.parse(v.properties["indoor-data"]).floorplanIDs.includes(t)){this._selectedFloorplan=v,this._floorplanSelected(!0);break}}}selectBuilding(t){const i=this._indoorData.buildings.find(d=>d.id===t);this._buildingSelected(i,!0)}selectLevel(t){this._levelSelected(t)}}function Rl(h){if(!h.metadata||!h.metadata.content_area)return;const t=a.q.devicePixelRatio,{left:i,top:d,width:m,height:v}=h.metadata.content_area,w=i*t,R=d*t;return[w,R,w+m*t,R+v*t]}function Fu(h){if(h)return h.map(([t,i])=>[t*a.q.devicePixelRatio,i*a.q.devicePixelRatio])}class yf{constructor(t,i,d){this.id=t,this.scope=i,this.sourceCache=d,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const i=this.sourceCache.getVisibleCoordinates();if(i.length===0)return t;const d=this.sourceCache.getSource();if(!(d instanceof Va))return t;const m=i.map(w=>this.sourceCache.getTile(w)),v=d.getImages(m,Array.from(this.pendingRequests));for(const[w,R]of v)t.set(a.I.from({name:w,iconsetId:this.id}),R),this.pendingRequests.delete(w);for(const w of this.pendingRequests)this.missingRequests.add(w);return this.pendingRequests.clear(),t}}const pc=(h,t)=>rt(h,t&&t.filter(i=>i.identifier!=="source.canvas")),kg=a.aA(or,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Ay=a.aA(or,["setCenter","setZoom","setBearing","setPitch"]),ca=new Set(["background","sky","slot","custom"]),Ja={version:8,layers:[],sources:{}},Gc={duration:300,delay:0};class Qa extends a.E{constructor(t,i={}){super(),this.map=t,this.scope=i.scope||"",this.globalId=null,this.fragments=[],this.importDepth=i.importDepth||0,this.importsCache=i.importsCache||new Map,this.resolvedImports=i.resolvedImports||new Set,this.transition=a.l({},Gc),this._buildingIndex=new vy(this),this.crossTileSymbolIndex=new Lu,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=i.styleChanges||new ls,this.dispatcher=i.dispatcher?i.dispatcher:new a.D(a.cj(),this),i.imageManager?this.imageManager=i.imageManager:(this.imageManager=new cs(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=i.glyphManager?i.glyphManager:new a.ck(t._requestManager,i.localFontFamily?a.cl.all:i.localIdeographFontFamily?a.cl.ideographs:a.cl.none,i.localFontFamily||i.localIdeographFontFamily),i.modelManager?this.modelManager=i.modelManager:(this.modelManager=new Jp(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=i.configOptions?i.configOptions:new Map,this._configDependentLayers=i.configDependentLayers?i.configDependentLayers:new Set,this._config=i.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:i.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=i.initialConfig,this.dispatcher.broadcast("setReferrer",a.cm());const d=this;this._rtlTextPluginCallback=Qa.registerForPluginStateChange(m=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(v,w)=>{if(a.cn(v),w&&w.every(R=>R))for(const R in d._sourceCaches){const N=d._sourceCaches[R],P=N.getSource().type;P!=="vector"&&P!=="geojson"||N.reload()}})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const v=this.getOwnSource(m.sourceId);if(v&&v.vectorLayerIds)for(const w in this._layers){const R=this._layers[w];R.source===v.id&&this._validateLayer(R)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(a.f(t))return t;const i=a.co(t);if(!i.startsWith("http"))try{return new URL(i,location.href).toString()}catch{return i}return i}return`json://${a.cp(JSON.stringify(t))}`}_diffStyle(t,i,d){this.globalId=this._getGlobalId(t);const m=(v,w)=>{try{w(null,this.setState(v,d))}catch(R){w(R,!1)}};if(typeof t=="string"){const v=this.map._requestManager.normalizeStyleURL(t),w=this.map._requestManager.transformRequest(v,a.R.Style);a.n(w,(R,N)=>{R?this.fire(new a.z(R)):N&&m(N,i)})}else typeof t=="object"&&m(t,i)}loadURL(t,i={}){this.fire(new a.A("dataloading",{dataType:"style"}));const d=typeof i.validate=="boolean"?i.validate:!a.f(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,i.accessToken),this.resolvedImports.add(t);const m=this.importsCache.get(t);if(m)return this._load(m,d);const v=this.map._requestManager.transformRequest(t,a.R.Style);this._request=a.n(v,(w,R)=>{if(this._request=null,w)this.fire(new a.z(w));else if(R)return this.importsCache.set(t,R),this._load(R,d)})}loadJSON(t,i={}){this.fire(new a.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=a.q.frame(()=>{this._request=null,this._load(t,i.validate!==!1)})}loadEmpty(){this.fire(new a.A("dataloading",{dataType:"style"})),this._load(Ja,!1)}_loadImports(t,i,d){if(this.importDepth>=4)return a.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const m=[];for(const v of t){const w=this._createFragmentStyle(v),R=new Promise(F=>{w.once("style.import.load",F),w.once("error",F)}).then(()=>this.mergeAll());if(m.push(R),this.resolvedImports.has(v.url)){w.loadEmpty();continue}const N=v.data||this.importsCache.get(v.url);N?(w.loadJSON(N,{validate:i}),this._isInternalStyle(N)&&(w.globalId=null)):v.url?w.loadURL(v.url,{validate:i}):w.loadEmpty();const P={style:w,id:v.id,config:v.config};if(d){const F=this.fragments.findIndex(({id:V})=>V===d);this.fragments=this.fragments.slice(0,F).concat(P).concat(this.fragments.slice(F))}else this.fragments.push(P)}return Promise.allSettled(m)}getImportGlobalIds(t=this,i=new Set){for(const d of t.fragments)d.style.globalId&&i.add(d.style.globalId),this.getImportGlobalIds(d.style,i);return[...i.values()]}_createFragmentStyle(t){const i=this.scope?a.C(t.id,this.scope):t.id;let d;const m=this._initialConfig&&this._initialConfig[i];(t.config||m)&&(d=a.l({},t.config,m));const v=new Qa(this.map,{scope:i,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:d,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return v.setEventedParent(this.map,{style:v}),v}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,i){const d=t.indoor?Hc(t.schema):t.schema;if(this._isInternalStyle(t)){const w=a.l({},Ja,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(w,i)}if(this.updateConfig(this._config,d),i&&pc(this,kn(t)))return;this._loaded=!0,this.stylesheet=a.cq(t);const m=()=>{for(const P in t.sources)this.addSource(P,t.sources[P],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const P in t.iconsets)this.addIconset(P,t.iconsets[P]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(t.glyphs);const w=uf(this.stylesheet.layers);if(this._order=w.map(P=>P.id),this.stylesheet.light&&a.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const P=this.stylesheet.lights[0];this.light=new at(P.properties,P.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new at(this.stylesheet.light)),this._layers={};for(const P of w){const F=a.cv(P,this.scope,this._styleColorTheme.lut,this.options);F.configDependencies.size!==0&&this._configDependentLayers.add(F.fqid),F.setEventedParent(this,{layer:{id:F.id}}),this._layers[F.id]=F;const V=this.getOwnLayerSourceCache(F),j=!!this.directionalLight&&this.directionalLight.shadowsEnabled();V&&F.canCastShadows()&&j&&(V.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const R=this.stylesheet.terrain;R&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(R,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new a.A("data",{dataType:"style"}));const N=this.isRootStyle();t.imports?this._loadImports(t.imports,i).then(()=>{this._reloadImports(),this.fire(new a.A(N?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new a.A(N?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const v=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(v){const w=this._evaluateColorThemeData(v);this._loadColorTheme(w).then(()=>{m()}).catch(R=>{a.w(`Couldn't load color theme from the stylesheet: ${R}`),m()})}else this._styleColorTheme.lut=null,m()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,i,d,m,v,w,R,N,P,F;const V={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(j=>{if(j.stylesheet){if(j.light!=null&&(t=j.light),j.stylesheet.lights)for(const Z of j.stylesheet.lights)Z.type==="ambient"&&j.ambientLight!=null&&(i=j.ambientLight),Z.type==="directional"&&j.directionalLight!=null&&(d=j.directionalLight);m=this._prioritizeTerrain(m,j.terrain,j.stylesheet.terrain),j.stylesheet.fog&&j.fog!=null&&(v=j.fog),j.stylesheet.snow&&j.snow!=null&&(w=j.snow),j.stylesheet.rain&&j.rain!=null&&(R=j.rain),j.stylesheet.camera!=null&&(F=j.stylesheet.camera),j.stylesheet.projection!=null&&(N=j.stylesheet.projection),j.stylesheet.transition!=null&&(P=j.stylesheet.transition),V[j.scope]=j._styleColorTheme}}),this.light=t,this.ambientLight=i,this.directionalLight=d,this.fog=v,this.snow=w,this.rain=R,this._styleColorThemeForScope=V,m===null?delete this.terrain:this.terrain=m,this.camera=F||{"camera-projection":"perspective"},this.projection=N||{name:"mercator"},this.transition=a.l({},Gc,P),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const i=d=>{for(const m of d.fragments)i(m.style);t(d)};i(this)}_prioritizeTerrain(t,i,d){const m=t&&t.drapeRenderMode===0;return d===null?i&&i.drapeRenderMode===0?i:m?t:null:i!=null&&(!t||m||i&&i.drapeRenderMode===1)?i:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(i=>{t=this._prioritizeTerrain(t,i.terrain,i.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(i=>{i.stylesheet.projection!=null&&(t=i.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},i={},d={};this.forEachFragmentStyle(m=>{for(const v in m._sourceCaches){const w=a.C(v,m.scope);t[w]=m._sourceCaches[v]}for(const v in m._otherSourceCaches){const w=a.C(v,m.scope);i[w]=m._otherSourceCaches[v]}for(const v in m._symbolSourceCaches){const w=a.C(v,m.scope);d[w]=m._symbolSourceCaches[v]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=i,this._mergedSymbolSourceCaches=d}mergeLayers(){const t={},i=[],d={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(v=>{for(const w of v._order){const R=v._layers[w];if(R.type==="slot"){const N=a.cr(w);if(t[N])continue;t[N]=[]}R.slot&&t[R.slot]?t[R.slot].push(R):i.push(R)}}),this._mergedOrder=[];const m=(v=[])=>{for(const w of v)if(w.type==="slot"){const R=a.cr(w.id);t[R]&&m(t[R]),this._mergedSlots.push(R)}else{const R=a.C(w.id,w.scope);this._mergedOrder.push(R),d[R]=w,w.is3D(!!this.terrain)&&(this._has3DLayers=!0),w.type==="circle"&&(this._hasCircleLayers=!0),w.type==="symbol"&&(this._hasSymbolLayers=!0),w.type==="clip"&&(this._clipLayerPresent=!0)}};m(i),this._mergedOrder.sort((v,w)=>{const R=d[v],N=d[w];return R.hasInitialOcclusionOpacityProperties?N.is3D(!!this.terrain)?1:0:R.is3D(!!this.terrain)&&N.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=d,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=a.l({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(i,d,m){const v=a.l({},d);for(const R of Object.keys(a.a5.colorTheme))v[R]===void 0&&(v[R]=a.a5.colorTheme[R].default);const w=new a.a6(Ey,i,new Map(m));return w.setTransitionOrValue(v,m),w.untransitioned().possiblyEvaluate(new a.aa(0))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const i=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((d,m)=>{const v="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void d();let w=t;w.startsWith(v)||(w=v+w);const R=a.I.from("mapbox-reserved-lut"),N=new Image;N.src=w,N.onerror=()=>{this._styleColorTheme.lutLoading=!1,m(new Error("Failed to load image data"))},N.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==i)return void d();this._styleColorTheme.lutLoading=!1;const{width:P,height:F,data:V}=a.q.getImageData(N);if(F>32)return void m(new Error("The height of the image must be less than or equal to 32 pixels."));if(P!==F*F)return void m(new Error("The width of the image must be equal to the height squared."));this.getImage(R,this.scope)&&this.removeImage(R,this.scope),this.addImage(R,this.scope,{data:new a.r({width:P,height:F},V),pixelRatio:1,sdf:!1,usvg:!1,version:0});const j=this.imageManager.getImage(R,this.scope);j?(this._styleColorTheme.lut={image:j.data,data:t},d()):m(new Error("Missing LUT image."))}})}getLut(t){const i=this._styleColorThemeForScope[t];return i?i.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(i,d,m){let v,w,R;const N=a.q.devicePixelRatio>1?"@2x":"";let P=a.n(d.transformRequest(d.normalizeSpriteURL(i,N,".json"),a.R.SpriteJSON),(j,Z)=>{P=null,R||(R=j,v=Z,V())}),F=a.o(d.transformRequest(d.normalizeSpriteURL(i,N,".png"),a.R.SpriteImage),(j,Z)=>{F=null,R||(R=j,w=Z,V())});function V(){if(R)m(R);else if(v&&w){const j=a.q.getImageData(w),Z={};for(const Q in v){const{width:K,height:te,x:re,y:pe,sdf:be,pixelRatio:ye,stretchX:Ae,stretchY:ve,content:Se}=v[Q],Te=new a.r({width:K,height:te});a.r.copy(j,Te,{x:re,y:pe},{x:0,y:0},{width:K,height:te},null),Z[Q]={data:Te,pixelRatio:ye,sdf:be,stretchX:Ae,stretchY:ve,content:Se,usvg:!1}}m(null,Z)}}return{cancel(){P&&(P.cancel(),P=null),F&&(F.cancel(),F=null)}}}(t,this.map._requestManager,(i,d)=>{if(this._spriteRequest=null,i)this.fire(new a.z(i));else if(d){const m=new Map;for(const v in d)m.set(a.I.from(v),d[v]);this.addImages(m,this.scope)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new a.A("data",{dataType:"style"}))})}addIconset(t,i){if(i.type==="sprite")return void this._loadSprite(i.url);const d=this.getOwnSourceCache(i.source);if(!d)return void this.fire(new a.z(new Error(`Source "${i.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const m=d.getSource();if(m.type!=="raster-array")return void this.fire(new a.z(new Error(`Source "${i.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));m.partial=!1;const v=new yf(t,this.scope,d);this.imageManager.addImageProvider(v,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!a.f(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const i=this.map._spriteFormat==="auto";var d,m;this._spriteRequest=(m=(v,w)=>{if(this._spriteRequest=null,v)i?this._loadSprite(t):this.fire(new a.z(v));else if(w){const R=new Map;for(const N in w)R.set(a.I.from(N),w[N]);this.addImages(R,this.scope)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new a.A("data",{dataType:"style"}))},a.bj((d=this.map._requestManager).transformRequest(d.normalizeIconsetURL(t),a.R.Iconset),(v,w)=>{if(v)return void m(v);const R={},N=a.ch(new a.bi(w));for(const P of N.icons){const F={version:1,pixelRatio:a.q.devicePixelRatio,content:Rl(P),stretchX:P.metadata?Fu(P.metadata.stretch_x_areas):void 0,stretchY:P.metadata?Fu(P.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:P};R[P.name]=F}m(null,R)}))}_validateLayer(t){const i=this.getOwnSource(t.source);if(!i)return;const d=t.sourceLayer;d&&(i.type==="geojson"||i.vectorLayerIds&&i.vectorLayerIds.indexOf(d)===-1)&&this.fire(new a.z(new Error(`Source layer "${d}" does not exist on source "${i.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,i)=>{const d=this.fragments[i];return d&&d.style&&(t.data=d.style.serialize()),t})}_serializeSources(){const t={};for(const i in this._sourceCaches){const d=this._sourceCaches[i].getSource();t[d.id]||(t[d.id]=d.serialize())}return t}_serializeLayers(t){const i=[];for(const d of t){const m=this._layers[d];m&&m.type!=="custom"&&i.push(m.serialize())}return i}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const i=this.getOwnLayer(t);if(i)return i;this.fire(new a.z(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const i=this.getOwnSource(t);if(i)return i;this.fire(new a.z(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,i){const d=this.map.painter;if(d)for(let m=t.minzoom||0;m<(t.maxzoom||25.5);m++){const v=t.getProgramIds();if(v)for(const w of v){const R=t.getDefaultProgramParams(w,i.zoom,this._styleColorTheme.lut);R&&(d.style=this,this.fog&&(d._fogVisible=!0,R.overrideFog=!0,d.getOrCreateProgram(w,R)),d._fogVisible=!1,R.overrideFog=!1,d.getOrCreateProgram(w,R),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(R.overrideRtt=!0,d.getOrCreateProgram(w,R)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const i=this.calculateLightsBrightness();t.brightness=i||0,i!==this._brightness&&(this._brightness=i,this.dispatcher.broadcast("setBrightness",i));const d=this._changes.isDirty();let m=!1;if(this._changes.isDirty()){const R=this._changes.getLayerUpdatesByScope();for(const N in R){const{updatedIds:P,removedIds:F}=R[N];(P||F)&&(this._updateWorkerLayers(N,P,F),m=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const v={};for(const R in this._mergedSourceCaches){const N=this._mergedSourceCaches[R];v[R]=N.used,N.used=!1,N.tileCoverLift=0}for(const R of this._mergedOrder){const N=this._mergedLayers[R];if(N.recalculate(t,this._availableImages),!N.isHidden(t.zoom)){const P=this.getLayerSourceCache(N);P&&(P.used=!0,P.tileCoverLift=Math.max(P.tileCoverLift,N.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(N,t)}):this.precompilePrograms(N,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&m&&this.mergeLayers();const w=this.imageManager.getPendingImageProviders();for(const R of w)R.sourceCache.used=!0;for(const R in v){const N=this._mergedSourceCaches[R];v[R]!==N.used&&N.getSource().fire(new a.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:N.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),d&&this.fire(new a.A("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const i of t){const d=i.resolvePendingRequests();this.addImages(d,i.scope)}}_updateTilesForChangedImages(){const t={};for(const i in this._mergedSourceCaches){const d=this._mergedSourceCaches[i].getSource().scope;t[d]=t[d]||this._changes.getUpdatedImages(d),t[d].length!==0&&this._mergedSourceCaches[i].reloadTilesForDependencies(["icons","patterns"],t[d])}for(const i in t)this._changes.resetUpdatedImages(i)}_updateWorkerLayers(t,i,d){const m=this.getFragmentStyle(t);m&&this.dispatcher.broadcast("updateLayers",{layers:i?m._serializeLayers(i):[],scope:t,removedIds:d||[],options:m.options})}setState(t,i){if(this._checkLoaded(),pc(this,kn(t)))return!1;(t=a.cq(t)).layers=uf(t.layers);const d=function(w,R){if(!w)return[{command:or.setStyle,args:[R]}];let N=[];try{if(!a.bn(w.version,R.version))return[{command:or.setStyle,args:[R]}];if(a.bn(w.center,R.center)||N.push({command:or.setCenter,args:[R.center]}),a.bn(w.zoom,R.zoom)||N.push({command:or.setZoom,args:[R.zoom]}),a.bn(w.bearing,R.bearing)||N.push({command:or.setBearing,args:[R.bearing]}),a.bn(w.pitch,R.pitch)||N.push({command:or.setPitch,args:[R.pitch]}),a.bn(w.sprite,R.sprite)||N.push({command:or.setSprite,args:[R.sprite]}),a.bn(w.glyphs,R.glyphs)||N.push({command:or.setGlyphs,args:[R.glyphs]}),a.bn(w.imports,R.imports)||function(Z=[],Q=[],K){Q=Q||[];const te=(Z=Z||[]).map(cr),re=Q.map(cr),pe=Z.reduce(lo,{}),be=Q.reduce(lo,{}),ye=te.slice();let Ae,ve,Se,Te;for(Ae=0,ve=0;Ae<te.length;Ae++)Se=te[Ae],be.hasOwnProperty(Se)?ve++:(K.push({command:or.removeImport,args:[Se]}),ye.splice(ye.indexOf(Se,ve),1));for(Ae=0,ve=0;Ae<re.length;Ae++)Se=re[re.length-1-Ae],ye[ye.length-1-Ae]!==Se&&(pe.hasOwnProperty(Se)?(K.push({command:or.removeImport,args:[Se]}),ye.splice(ye.lastIndexOf(Se,ye.length-ve),1)):ve++,Te=ye[ye.length-Ae],K.push({command:or.addImport,args:[be[Se],Te]}),ye.splice(ye.length-Ae,0,Se));for(const Me of Q){const ze=pe[Me.id];ze&&!a.bn(ze,Me)&&K.push({command:or.updateImport,args:[Me.id,Me]})}}(w.imports,R.imports,N),a.bn(w.transition,R.transition)||N.push({command:or.setTransition,args:[R.transition]}),a.bn(w.light,R.light)||N.push({command:or.setLight,args:[R.light]}),a.bn(w.fog,R.fog)||N.push({command:or.setFog,args:[R.fog]}),a.bn(w.snow,R.snow)||N.push({command:or.setSnow,args:[R.snow]}),a.bn(w.rain,R.rain)||N.push({command:or.setRain,args:[R.rain]}),a.bn(w.projection,R.projection)||N.push({command:or.setProjection,args:[R.projection]}),a.bn(w.lights,R.lights)||N.push({command:or.setLights,args:[R.lights]}),a.bn(w.camera,R.camera)||N.push({command:or.setCamera,args:[R.camera]}),a.bn(w.iconsets,R.iconsets)||function(Z,Q,K){let te;for(te in Q=Q||{},Z=Z||{})Z.hasOwnProperty(te)&&(Q.hasOwnProperty(te)||K.push({command:or.removeIconset,args:[te]}));for(te in Q){if(!Q.hasOwnProperty(te))continue;const re=Q[te];Z.hasOwnProperty(te)?a.bn(Z[te],re)||(K.push({command:or.removeIconset,args:[te]}),K.push({command:or.addIconset,args:[te,re]})):K.push({command:or.addIconset,args:[te,re]})}}(w.iconsets,R.iconsets,N),!a.bn(w["color-theme"],R["color-theme"]))return[{command:or.setStyle,args:[R]}];const P={},F=[];(function(Z,Q,K,te){let re;for(re in Q=Q||{},Z=Z||{})Z.hasOwnProperty(re)&&(Q.hasOwnProperty(re)||df(re,K,te));for(re in Q){if(!Q.hasOwnProperty(re))continue;const pe=Q[re];Z.hasOwnProperty(re)?a.bn(Z[re],pe)||(Z[re].type==="geojson"&&pe.type==="geojson"&&dn(Z,Q,re)?K.push({command:or.setGeoJSONSourceData,args:[re,pe.data]}):Mu(re,Q,K,te)):Ns(re,Q,K)}})(w.sources,R.sources,F,P);const V=[];w.layers&&w.layers.forEach(Z=>{Z.source&&P[Z.source]?N.push({command:or.removeLayer,args:[Z.id]}):V.push(Z)});let j=w.terrain;j&&P[j.source]&&(N.push({command:or.setTerrain,args:[void 0]}),j=void 0),N=N.concat(F),a.bn(j,R.terrain)||N.push({command:or.setTerrain,args:[R.terrain]}),function(Z,Q,K){Q=Q||[];const te=(Z=Z||[]).map(cr),re=Q.map(cr),pe=Z.reduce(lo,{}),be=Q.reduce(lo,{}),ye=te.slice(),Ae=Object.create(null);let ve,Se,Te,Me,ze,ot,Xe;for(ve=0,Se=0;ve<te.length;ve++)Te=te[ve],be.hasOwnProperty(Te)?Se++:(K.push({command:or.removeLayer,args:[Te]}),ye.splice(ye.indexOf(Te,Se),1));for(ve=0,Se=0;ve<re.length;ve++)Te=re[re.length-1-ve],ye[ye.length-1-ve]!==Te&&(pe.hasOwnProperty(Te)?(K.push({command:or.removeLayer,args:[Te]}),ye.splice(ye.lastIndexOf(Te,ye.length-Se),1)):Se++,ot=ye[ye.length-ve],K.push({command:or.addLayer,args:[be[Te],ot]}),ye.splice(ye.length-ve,0,Te),Ae[Te]=!0);for(ve=0;ve<re.length;ve++)if(Te=re[ve],Me=pe[Te],ze=be[Te],!Ae[Te]&&!a.bn(Me,ze))if(a.bn(Me.source,ze.source)&&a.bn(Me["source-layer"],ze["source-layer"])&&a.bn(Me.type,ze.type)){for(Xe in Cr(Me.layout,ze.layout,K,Te,null,or.setLayoutProperty),Cr(Me.paint,ze.paint,K,Te,null,or.setPaintProperty),a.bn(Me.slot,ze.slot)||K.push({command:or.setSlot,args:[Te,ze.slot]}),a.bn(Me.filter,ze.filter)||K.push({command:or.setFilter,args:[Te,ze.filter]}),a.bn(Me.minzoom,ze.minzoom)&&a.bn(Me.maxzoom,ze.maxzoom)||K.push({command:or.setLayerZoomRange,args:[Te,ze.minzoom,ze.maxzoom]}),Me)Me.hasOwnProperty(Xe)&&Xe!=="layout"&&Xe!=="paint"&&Xe!=="filter"&&Xe!=="metadata"&&Xe!=="minzoom"&&Xe!=="maxzoom"&&Xe!=="slot"&&(Xe.indexOf("paint.")===0?Cr(Me[Xe],ze[Xe],K,Te,Xe.slice(6),or.setPaintProperty):a.bn(Me[Xe],ze[Xe])||K.push({command:or.setLayerProperty,args:[Te,Xe,ze[Xe]]}));for(Xe in ze)ze.hasOwnProperty(Xe)&&!Me.hasOwnProperty(Xe)&&Xe!=="layout"&&Xe!=="paint"&&Xe!=="filter"&&Xe!=="metadata"&&Xe!=="minzoom"&&Xe!=="maxzoom"&&Xe!=="slot"&&(Xe.indexOf("paint.")===0?Cr(Me[Xe],ze[Xe],K,Te,Xe.slice(6),or.setPaintProperty):a.bn(Me[Xe],ze[Xe])||K.push({command:or.setLayerProperty,args:[Te,Xe,ze[Xe]]}))}else K.push({command:or.removeLayer,args:[Te]}),ot=ye[ye.lastIndexOf(Te)+1],K.push({command:or.addLayer,args:[ze,ot]})}(V,R.layers,N)}catch(P){console.warn("Unable to compute style diff:",P),N=[{command:or.setStyle,args:[R]}]}return N}(this.serialize(),t).filter(w=>!(w.command in Ay));if(d.length===0)return!1;const m=d.filter(w=>!(w.command in kg));if(m.length>0)throw new Error(`Unimplemented: ${m.map(w=>w.command).join(", ")}.`);const v=[];return d.forEach(w=>{v.push(this[w.command].apply(this,w.args))}),i&&Promise.all(v).then(i),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(t){const i=this.getFragmentStyle(t);i&&(i._availableImages=i.imageManager.listImages(t),i.dispatcher.broadcast("setImages",{scope:t,images:i._availableImages}))}addImages(t,i){for(const[d,m]of t.entries()){if(this.getImage(d,i))return this.fire(new a.z(new Error(`An image with the name "${d.name}" already exists.`)));this.imageManager.addImage(d,i,m),this._changes.updateImage(d,i)}return this._updateWorkerImages(i),this.fire(new a.A("data",{dataType:"style"})),this}addImage(t,i,d){return this.getImage(t,i)?this.fire(new a.z(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,i,d),this._changes.updateImage(t,i),this._updateWorkerImages(i),this.fire(new a.A("data",{dataType:"style"})),this)}updateImage(t,i,d,m=!1){this.imageManager.updateImage(t,i,d),m&&(this._changes.updateImage(t,i),this._updateWorkerImages(i),this.fire(new a.A("data",{dataType:"style"})))}getImage(t,i){return this.imageManager.getImage(t,i)}removeImage(t,i){return this.getImage(t,i)?(this.imageManager.removeImage(t,i),this._changes.updateImage(t,i),this._updateWorkerImages(i),this.fire(new a.A("data",{dataType:"style"})),this):this.fire(new a.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,i,d={}){return this._checkLoaded(),this._validate(Ie,`models.${t}`,i,null,d)||(this.modelManager.addModel(t,i,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new a.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,i,d={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(br,`sources.${t}`,i,null,d))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const m=Au(t,i,this.dispatcher,this);m.scope=this.scope,m.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(m.id),source:m.serialize(),sourceId:m.id}));const v=w=>{const R=(w?"symbol:":"other:")+m.id,N=a.C(R,this.scope),P=this._sourceCaches[R]=new aa(N,m,w);(w?this._symbolSourceCaches:this._otherSourceCaches)[m.id]=P,P.onAdd(this.map)};v(!1),i.type!=="vector"&&i.type!=="geojson"||v(!0),m.onAdd&&m.onAdd(this.map),d.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const i=this.getOwnSource(t);if(!i)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===t)return this.fire(new a.z(new Error(`Source "${t}" cannot be removed while layer "${m}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new a.z(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const m=Object.entries(this.stylesheet.iconsets).find(([v,w])=>w.type==="source"&&w.source===t);if(m)return this.fire(new a.z(new Error(`Source "${t}" cannot be removed while iconset "${m[0]}" is using it.`)))}const d=this.getOwnSourceCaches(t);for(const m of d){const v=a.cr(m.id);delete this._sourceCaches[v],this._changes.discardSourceCacheUpdate(m.id),m.fire(new a.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:m.getSource().id})),m.setEventedParent(null),m.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),i.setEventedParent(null),i.onRemove&&i.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,i){this._checkLoaded(),this.getOwnSource(t).setData(i),this._changes.setDirty()}getOwnSource(t){const i=this.getOwnSourceCache(t);return i&&i.getSource()}getOwnSources(){const t=[];for(const i in this._otherSourceCaches){const d=this.getOwnSourceCache(i);d&&t.push(d.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const i in t){const d=t[i]._tiles;for(const m in d){const v=d[m];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const i=this._getTransitionParameters();for(const m of t){if(this._validate(Br,"lights",m))return;switch(m.type){case"ambient":if(this.ambientLight){const v=this.ambientLight;v.set(m),v.updateTransitions(i)}else this.ambientLight=new fi(m,Qn||(Qn=new a.a7({color:new a.a8(a.a5.properties_light_ambient.color),"color-use-theme":new a.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new a.a8(a.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const v=this.directionalLight;v.set(m),v.updateTransitions(i)}else this.directionalLight=new fi(m,Ar||(Ar=new a.a7({direction:new a.am(a.a5.properties_light_directional.direction),color:new a.a8(a.a5.properties_light_directional.color),"color-use-theme":new a.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new a.a8(a.a5.properties_light_directional.intensity),"cast-shadows":new a.a8(a.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new a.a8(a.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new a.a8(a.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const d=new a.aa(this.z||0,i);this.ambientLight&&this.ambientLight.recalculate(d),this.directionalLight&&this.directionalLight.recalculate(d),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,i=this.ambientLight;if(!t||!i)return;const d=j=>.2126*(j[0]<=.03928?j[0]/12.92:Math.pow((j[0]+.055)/1.055,2.4))+.7152*(j[1]<=.03928?j[1]/12.92:Math.pow((j[1]+.055)/1.055,2.4))+.0722*(j[2]<=.03928?j[2]/12.92:Math.pow((j[2]+.055)/1.055,2.4)),m=t.properties.get("color").toRenderColor(null).toArray01(),v=t.properties.get("intensity"),w=t.properties.get("direction"),R=1-a.cc(w.x,w.y,w.z)[2]/90,N=d(m)*v*R,P=i.properties.get("color").toRenderColor(null).toArray01(),F=i.properties.get("intensity"),V=d(P)*F;return Number(((N+V)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(a.cs(t)){const i=a.ct(t),d=this.fragments.find(({id:v})=>v===i);if(!d)throw new Error(`Style import '${t}' not found`);const m=a.cr(t);return d.style.getFragmentStyle(m)}{const i=this.fragments.find(({id:d})=>d===t);return i?i.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const i={},d=(m,v="")=>`${m}::${v}`;this._featuresetSelectors={};for(const m in t){const v=this._featuresetSelectors[m]=[];for(const w of t[m].selectors){if(w.featureNamespace){const N=this.getOwnLayer(w.layer);if(!N){a.w(`Layer is undefined for selector: ${w.layer}`);continue}const P=d(N.source,N.sourceLayer);if(P in i&&i[P]!==w.featureNamespace){a.w(`"featureNamespace ${w.featureNamespace} of featureset ${m}'s selector is not associated to the same source, skip this selector`);continue}i[P]=w.featureNamespace}let R;if(w.properties)for(const N in w.properties){const P=a.X(w.properties[N]);P.result==="success"&&(R=R||{},R[N]=P.value)}v.push({layerId:w.layer,namespace:w.featureNamespace,properties:R,uniqueFeatureID:w._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const i=this.getFragmentStyle(t);if(!i||!i.stylesheet.featuresets)return[];const d=[];for(const m in i.stylesheet.featuresets)d.push({featuresetId:m,importId:i.scope?i.scope:void 0});return d}getFeaturesetLayers(t,i){const d=this.getFragmentStyle(i),m=d.stylesheet.featuresets;if(!m||!m[t])return this.fire(new a.z(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const v=[];for(const w of m[t].selectors){const R=d.getOwnLayer(w.layer);R&&v.push(R)}return v}getConfigProperty(t,i){const d=this.getFragmentStyle(t);if(!d)return null;const m=a.C(i,d.scope),v=d.options.get(m),w=v?v.value||v.default:null;return w?w.serialize():null}setConfigProperty(t,i,d){const m=this.getFragmentStyle(t);if(!m)return;const v=m.stylesheet.indoor?Hc(m.stylesheet.schema):m.stylesheet.schema;if(!v||!v[i])return;const w=a.X(d);if(w.result!=="success")return void pc(this,w.value);const R=w.value.expression,N=a.C(i,m.scope),P=m.options.get(N);if(!P)return;let F;const{minValue:V,maxValue:j,stepValue:Z,type:Q,values:K}=v[i],te=a.X(v[i].default);te.result==="success"&&(F=te.value.expression),F?(this.options.set(N,Object.assign({},P,{value:R,default:F,minValue:V,maxValue:j,stepValue:Z,type:Q,values:K})),this.updateConfigDependencies(i)):this.fire(new a.z(new Error(`No schema defined for the config option "${i}" in the "${t}" fragment.`)))}getConfig(t){const i=this.getFragmentStyle(t);if(!i)return null;const d=i.stylesheet.schema;if(!d)return null;const m={};for(const v in d){const w=a.C(v,i.scope),R=i.options.get(w),N=R?R.value||R.default:null;m[v]=N?N.serialize():null}return m}setConfig(t,i){const d=this.getFragmentStyle(t);d&&(d.updateConfig(i,d.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const i=this.getFragmentStyle(t);return i?i.stylesheet.schema:null}setSchema(t,i){const d=this.getFragmentStyle(t);d&&(d.stylesheet.schema=i,d.updateConfig(d._config,i),this.updateConfigDependencies())}updateConfig(t,i){if(this._config=t,t||i)if(i)for(const d in i){let m,v;const w=a.X(i[d].default);if(w.result==="success"&&(m=w.value.expression),t&&t[d]!==void 0){const j=a.X(t[d]);j.result==="success"&&(v=j.value.expression)}const{minValue:R,maxValue:N,stepValue:P,type:F,values:V}=i[d];if(m){const j=a.C(d,this.scope);this.options.set(j,{default:m,value:v,minValue:R,maxValue:N,stepValue:P,type:F,values:V})}else this.fire(new a.z(new Error(`No schema defined for config option "${d}".`)))}else this.fire(new a.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const i of this._configDependentLayers){const d=this.getLayer(i);if(d){if(t&&!d.configDependencies.has(t))continue;d.possiblyEvaluateVisibility(),this._updateLayer(d)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(i=>{const d=i._styleColorTheme.colorThemeOverride?i._styleColorTheme.colorThemeOverride:i._styleColorTheme.colorTheme;if(d){const m=i._evaluateColorThemeData(d);(!i._styleColorTheme.lut&&m!==""||i._styleColorTheme.lut&&m!==i._styleColorTheme.lut.data)&&i.setColorTheme(d)}}),this._changes.setDirty()}addLayer(t,i,d={}){this._checkLoaded();const m=t.id;if(this._layers[m])return void this.fire(new a.z(new Error(`Layer with id "${m}" already exists on this map`)));let v;if(t.type==="custom"){if(pc(this,a.cu(t)))return;v=a.cv(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(m,t.source),t=a.cq(t),t=a.l(t,{source:m})),this._validate(ie,`layers.${m}`,t,{arrayIndex:-1},d))return;v=a.cv(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(v),v.setEventedParent(this,{layer:{id:m}})}v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid);let w=this._order.length;if(i){const F=this._order.indexOf(i);if(F===-1)return void this.fire(new a.z(new Error(`Layer with id "${i}" does not exist on this map.`)));v.slot===this._layers[i].slot?w=F:a.w(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,m),this._layerOrderChanged=!0,this._layers[m]=v;const R=this.getOwnLayerSourceCache(v),N=!!this.directionalLight&&this.directionalLight.shadowsEnabled();R&&v.canCastShadows()&&N&&(R.castsShadows=!0);const P=this._changes.getRemovedLayer(v);if(P&&v.source&&R&&v.type!=="custom"){this._changes.discardLayerRemoval(v);const F=a.C(v.source,v.scope);P.type!==v.type?this._changes.updateSourceCache(F,"clear"):(this._changes.updateSourceCache(F,"reload"),R.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),v.scope=this.scope,this.mergeLayers()}moveLayer(t,i){this._checkLoaded();const d=this._checkLayer(t);if(!d||t===i)return;const m=this._order.indexOf(t);this._order.splice(m,1);let v=this._order.length;if(i){const w=this._order.indexOf(i);if(w===-1)return void this.fire(new a.z(new Error(`Layer with id "${i}" does not exist on this map.`)));d.slot===this._layers[i].slot?v=w:a.w(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const i=this._checkLayer(t);if(!i)return;i.setEventedParent(null);const d=this._order.indexOf(t);this._order.splice(d,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(i.fqid),this._changes.removeLayer(i);const m=this.getOwnLayerSourceCache(i);if(m&&m.castsShadows){let v=!1;for(const w in this._layers)if(this._layers[w].source===i.source&&this._layers[w].canCastShadows()){v=!0;break}m.castsShadows=v}i.onRemove&&i.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const i in this._layers)if(this._layers[i].type===t)return!0;return!1}setLayerZoomRange(t,i,d){this._checkLoaded();const m=this._checkLayer(t);m&&(m.minzoom===i&&m.maxzoom===d||(i!=null&&(m.minzoom=i),d!=null&&(m.maxzoom=d),this._updateLayer(m)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,i){this._checkLoaded();const d=this._checkLayer(t);d&&d.slot!==i&&(d.slot=i,this._updateLayer(d))}setFilter(t,i,d={}){this._checkLoaded();const m=this._checkLayer(t);if(m&&!a.bn(m.filter,i))return i==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(ae,`layers.${m.id}.filter`,i,{layerType:m.type},d)||(m.filter=a.cq(i),this._updateLayer(m)))}getFilter(t){const i=this._checkLayer(t);if(i)return a.cq(i.filter)}setLayoutProperty(t,i,d,m={}){this._checkLoaded();const v=this._checkLayer(t);if(v&&!a.bn(v.getLayoutProperty(i),d)){if(d!=null&&(!m||m.validate!==!1)&&pc(v,Oe.call(kn,{key:`layers.${t}.layout.${i}`,layerType:v.type,objectKey:i,value:d,styleSpec:a.a5,style:{glyphs:!0,sprite:!0}})))return;v.setLayoutProperty(i,d),v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid),this._updateLayer(v)}}getLayoutProperty(t,i){const d=this._checkLayer(t);if(d)return d.getLayoutProperty(i)}setPaintProperty(t,i,d,m={}){this._checkLoaded();const v=this._checkLayer(t);if(!v||a.bn(v.getPaintProperty(i),d)||d!=null&&(!m||m.validate!==!1)&&pc(v,we.call(kn,{key:`layers.${t}.paint.${i}`,layerType:v.type,objectKey:i,value:d,styleSpec:a.a5})))return;const w=v.setPaintProperty(i,d);v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid),w&&this._updateLayer(v),this._changes.updatePaintProperties(v)}getPaintProperty(t,i){const d=this._checkLayer(t);if(d)return d.getPaintProperty(i)}setFeatureState(t,i){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:N,importId:P}=t.target,F=this.getFragmentStyle(P),V=F.getFeaturesetLayers(N);for(const{source:j,sourceLayer:Z}of V)F.setFeatureState({id:t.id,source:j,sourceLayer:Z},i)}else if("layerId"in t.target){const{layerId:N}=t.target,P=this.getLayer(N);this.setFeatureState({id:t.id,source:P.source,sourceLayer:P.sourceLayer},i)}return}const d=t.source,m=t.sourceLayer,v=this._checkSource(d);if(!v)return;const w=v.type;if(w==="geojson"&&m)return void this.fire(new a.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(w==="vector"&&!m)return void this.fire(new a.z(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new a.z(new Error("The feature id parameter must be provided.")));const R=this.getOwnSourceCaches(d);for(const N of R)N.setFeatureState(m,t.id,i)}removeFeatureState(t,i){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:N,importId:P}=t.target,F=this.getFragmentStyle(P),V=F.getFeaturesetLayers(N);for(const{source:j,sourceLayer:Z}of V)F.removeFeatureState({id:t.id,source:j,sourceLayer:Z},i)}else if("layerId"in t.target){const{layerId:N}=t.target,P=this.getLayer(N);this.removeFeatureState({id:t.id,source:P.source,sourceLayer:P.sourceLayer},i)}return}const d=t.source,m=this._checkSource(d);if(!m)return;const v=m.type,w=v==="vector"?t.sourceLayer:void 0;if(v==="vector"&&!w)return void this.fire(new a.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(i&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new a.z(new Error("A feature id is required to remove its specific state property.")));const R=this.getOwnSourceCaches(d);for(const N of R)N.removeFeatureState(w,t.id,i)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let v;if("featuresetId"in t.target){const{featuresetId:w,importId:R}=t.target,N=this.getFragmentStyle(R),P=N.getFeaturesetLayers(w);for(const{source:F,sourceLayer:V}of P){const j=N.getFeatureState({id:t.id,source:F,sourceLayer:V});if(j&&!v)v=j;else if(!a.bn(v,j))return void this.fire(new a.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:w}=t.target,R=this.getLayer(w);v=this.getFeatureState({id:t.id,source:R.source,sourceLayer:R.sourceLayer})}return v}const i=t.source,d=t.sourceLayer,m=this._checkSource(i);if(m){if(m.type!=="vector"||d)return t.id===void 0&&this.fire(new a.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(i)[0].getFeatureState(d,t.id);this.fire(new a.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=a.l({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return a.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),i=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return a.cw({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:i,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},d=>d!==void 0)}_updateFilteredLayers(t){for(const i of Object.values(this._mergedLayers))t(i)&&this._updateLayer(i)}_updateLayer(t){this._changes.updateLayer(t);const i=this.getLayerSourceCache(t),d=a.C(t.source,t.scope),m=this._changes.getUpdatedSourceCaches();t.source&&!m[d]&&i&&i.getSource().type!=="raster"&&(this._changes.updateSourceCache(d,"reload"),i.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const i=R=>this._mergedLayers[R].is3D(!!this.terrain),d=this.order,m={},v=[];for(let R=d.length-1;R>=0;R--){const N=d[R];if(i(N)){m[N]=R;for(const P of t){const F=P[N];if(F)for(const V of F)v.push(V)}}}v.sort((R,N)=>N.intersectionZ-R.intersectionZ);const w=[];for(let R=d.length-1;R>=0;R--){const N=d[R];if(i(N))for(let P=v.length-1;P>=0;P--){const F=v[P].feature;if(F.layer&&m[F.layer.id]<R)break;w.push(F),v.pop()}else for(const P of t){const F=P[N];if(F)for(const V of F)w.push(V.feature)}}return w}queryRenderedFeatures(t,i,d){let m;i&&!Array.isArray(i)&&i.filter&&(this._validate(ae,"queryRenderedFeatures.filter",i.filter,null,i),m=a.a_(i.filter));const v={},w=F=>{if(ca.has(F.type))return;const V=this.getOwnLayerSourceCache(F),j=v[V.id]=v[V.id]||{sourceCache:V,layers:{},has3DLayers:!1};F.is3D(!!this.terrain)&&(j.has3DLayers=!0),j.layers[F.fqid]=j.layers[F.fqid]||{styleLayer:F,targets:[]},j.layers[F.fqid].targets.push({filter:m})};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new a.z(new Error("parameters.layers must be an Array."))),[];for(const F of i.layers){const V=this._layers[F];if(!V)return this.fire(new a.z(new Error(`The layer '${F}' does not exist in the map's style and cannot be queried for features.`))),[];w(V)}}else for(const F in this._layers)w(this._layers[F]);const R=this._queryRenderedFeatures(t,v,d),N=this._flattenAndSortRenderedFeatures(R),P=[];for(const F of N)a.ct(F.layer.id)===this.scope&&P.push(F);return P}queryRenderedFeatureset(t,i,d){let m;i&&!Array.isArray(i)&&i.filter&&(this._validate(ae,"queryRenderedFeatures.filter",i.filter,null,i),m=a.a_(i.filter));const v="mock",w=[];if(i&&i.target)w.push(Object.assign({},i,{targetId:v,filter:m}));else{const F=this.getFeaturesetDescriptors();for(const V of F)w.push({targetId:v,filter:m,target:V});for(const{style:V}of this.fragments){const j=V.getFeaturesetDescriptors();for(const Z of j)w.push({targetId:v,filter:m,target:Z})}}const R=this.queryRenderedTargets(t,w,d),N=[],P=new Set;for(const F of R)for(const V of F.variants[v])wl(V,F,P)||N.push(new a.cx(F,V));return N}queryRenderedTargets(t,i,d){const m={},v=(R,N,P,F)=>{const V=m[N.id]=m[N.id]||{sourceCache:N,layers:{},has3DLayers:!1};if(V.layers[R.fqid]=V.layers[R.fqid]||{styleLayer:R,targets:[]},R.is3D(!!this.terrain)&&(V.has3DLayers=!0),!F)return P.uniqueFeatureID=!1,void V.layers[R.fqid].targets.push(P);V.layers[R.fqid].targets.push(Object.assign({},P,{namespace:F.namespace,properties:F.properties,uniqueFeatureID:F.uniqueFeatureID}))};for(const R of i)if("featuresetId"in R.target){const{featuresetId:N,importId:P}=R.target,F=this.getFragmentStyle(P);if(!F||!F._featuresetSelectors)continue;const V=F._featuresetSelectors[N];if(!V){this.fire(new a.z(new Error(`The featureset '${N}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const j of V){const Z=F.getOwnLayer(j.layerId);Z&&!ca.has(Z.type)&&v(Z,F.getOwnLayerSourceCache(Z),R,j)}}else if("layerId"in R.target){const{layerId:N}=R.target,P=this.getLayer(N);if(!P||ca.has(P.type))continue;v(P,this.getLayerSourceCache(P),R)}const w=this._queryRenderedFeatures(t,m,d);return this._flattenAndSortRenderedFeatures(w)}_queryRenderedFeatures(t,i,d){const m=[],v=!!this.map._showQueryGeometry,w=ro.createFromScreenPoints(t,d);for(const R in i){const N=jc(w,i[R],this._availableImages,d,v);Object.keys(N).length&&m.push(N)}if(this.placement)for(const R in i){if(!i[R].sourceCache._onlySymbols)continue;const N=jp(w.screenGeometry,i[R],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(N).length&&m.push(N)}return m}querySourceFeatures(t,i){const d=i&&i.filter;d&&this._validate(ae,"querySourceFeatures.filter",d,null,i);let m=[];const v=this.getOwnSourceCaches(t);for(const w of v)m=m.concat(_y(w,i));return m}addSourceType(t,i,d){return Qa.getSourceType(t)?d(new Error(`A source type called "${t}" already exists.`)):(Qa.setSourceType(t,i),i.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:i.workerSourceURL},d):d(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,i,d={}){this._checkLoaded();const m=this.light.getLight();let v=!1;for(const R in t)if(!a.bn(t[R],m[R])){v=!0;break}if(!v)return;const w=this._getTransitionParameters();this.light.setLight(t,i,d),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=a.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&a.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,i=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),i===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let d=t;const m=t.source==null;if(i===1){if(this.disableElevatedTerrain)return;if(typeof d.source=="object"){const R="terrain-dem-src";this.addSource(R,d.source),d=a.cq(d),d=a.l(d,{source:R})}const v=a.l({},d),w={};if(this.terrain&&m){v.source=this.terrain.get().source;const R=this.terrain?this.getFragmentStyle(this.terrain.scope):null;R&&(w.style=R.serialize())}if(this._validate(Er,"terrain",v,w))return}if(!this.terrain||this.terrain.scope!==this.scope&&!m||this.terrain&&i!==this.terrain.drapeRenderMode){if(!d)return;this._createTerrain(d,i),this.fire(new a.A("data",{dataType:"style"}))}else{const v=this.terrain,w=v.get();for(const R of Object.keys(a.a5.terrain))!d.hasOwnProperty(R)&&a.a5.terrain[R].default&&(d[R]=a.a5.terrain[R].default);for(const R in t)if(!a.bn(t[R],w[R])){v.set(t,this.options),this.stylesheet.terrain=t;const N=this._getTransitionParameters({duration:0});v.updateTransitions(N),this.fire(new a.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const i=this.fog=new zn(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=i.get();const d=this._getTransitionParameters({duration:0});i.updateTransitions(d)}_createSnow(t){const i=this.snow=new Rr(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=i.get();const d=this._getTransitionParameters({duration:0});i.updateTransitions(d)}_createRain(t){const i=this.rain=new Or(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=i.get();const d=this._getTransitionParameters({duration:0});i.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const i=this.fog;if(!a.bn(i.get(),t)){i.set(t,this.options),this.stylesheet.fog=i.get();const d=this._getTransitionParameters({duration:0});i.updateTransitions(d)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const i=this.snow;if(!a.bn(i.get(),t)){i.set(t,this.options),this.stylesheet.snow=i.get();const d=this._getTransitionParameters({duration:0});i.updateTransitions(d)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const i=this.rain;if(!a.bn(i.get(),t)){i.set(t,this.options),this.stylesheet.rain=i.get();const d=this._getTransitionParameters({duration:0});i.updateTransitions(d)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const m in this._layers)this._layers[m].lut=this._styleColorTheme.lut;for(const m in this._sourceCaches)this._sourceCaches[m].clearTiles()},i=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!i)return this._styleColorTheme.lut=null,void t();const d=this._evaluateColorThemeData(i);this._loadColorTheme(d).then(()=>{this.fire(new a.A("colorthemeset")),t()}).catch(m=>{a.w(`Couldn't set color theme: ${m}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&a.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,i){const d=this.getFragmentStyle(t);d&&(d._styleColorTheme.colorThemeOverride=i,d._reloadColorTheme())}_getTransitionParameters(t){return{now:a.q.now(),transition:a.l(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],i=[];for(const d of this._mergedOrder)this.isLayerDraped(this._mergedLayers[d])?t.push(d):i.push(d);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...i)}_createTerrain(t,i){const d=this.terrain=new Ye(t,i,this.scope,this.options);i===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const m=this._getTransitionParameters({duration:0});d.updateTransitions(m)}_force3DLayerUpdate(){for(const t in this._layers){const i=this._layers[t];i.type==="fill-extrusion"&&this._updateLayer(i)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const i=this._layers[t];i.type==="symbol"&&this._updateLayer(i)}}_validate(t,i,d,m,v={}){if(v&&v.validate===!1)return!1;const w=a.l({},this.serialize());return pc(this,t.call(kn,a.l({key:i,style:w,value:d,styleSpec:a.a5},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.cy.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){const i=this.getSourceCaches(t);for(const d of i)d.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const i=this.getSourceCaches(t);for(const d of i)d.resume(),d.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let i;this.directionalLight&&(i=Ka(this.directionalLight));for(const d in this._mergedSourceCaches)this._mergedSourceCaches[d].update(t,void 0,void 0,i)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const i=this._sourceCaches[t];i.resume(),i.reload()}}_updatePlacement(t,i,d,m,v,w,R=!1){let N=!1,P=!1;const F={},V={};for(const j of this._mergedOrder){const Z=this._mergedLayers[j];if(Z.type!=="symbol")continue;const Q=a.C(Z.source,Z.scope);let K=F[Q];if(!K){const re=this.getLayerSourceCache(Z);if(!re)continue;const pe=re.getRenderableIds(!0).map(be=>re.getTileByID(be));V[Q]=pe.slice(),K=F[Q]=pe.sort((be,ye)=>ye.tileID.overscaledZ-be.tileID.overscaledZ||(be.tileID.isLessThan(ye.tileID)?-1:1))}const te=this.crossTileSymbolIndex.addLayer(Z,K,i.center.lng,i.projection);N=N||te}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),R=R||this._layerOrderChanged||m===0,this._layerOrderChanged&&this.fire(new a.A("neworder")),(R||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.q.now(),i.zoom))&&(this.pauseablePlacement=new El(i,this._mergedOrder,R,d,m,v,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,F,V,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.q.now()),P=!0),N&&this.pauseablePlacement.placement.setStale()),P||N){this._buildingIndex.onNewFrame(i.zoom);for(let j=0;j<this._mergedOrder.length;j++){const Z=this._mergedLayers[this._mergedOrder[j]];if(Z.type!=="symbol")continue;const Q=this.isLayerClipped(Z);this.placement.updateLayerOpacities(Z,F[a.C(Z.source,Z.scope)],j,Q?w:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,i){this._checkLoaded();const d=this.stylesheet.imports=this.stylesheet.imports||[];if(d.findIndex(({id:v})=>v===t.id)!==-1)return void this.fire(new a.z(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!i)return d.push(t),this._loadImports([t],!0);const m=d.findIndex(({id:v})=>v===i);return m===-1&&this.fire(new a.z(new Error(`Import with id "${i}" does not exist on this map.`))),this.stylesheet.imports=d.slice(0,m).concat(t).concat(d.slice(m)),this._loadImports([t],!0,i)}updateImport(t,i){this._checkLoaded();const d=this.stylesheet.imports||[],m=this.getImportIndex(t);return m===-1?this:typeof i=="string"?(this.setImportUrl(t,i),this):(i.url&&i.url!==d[m].url&&this.setImportUrl(t,i.url),a.bn(i.config,d[m].config)||this.setImportConfig(t,i.config,i.data.schema),a.bn(i.data,d[m].data)||this.setImportData(t,i.data),this)}moveImport(t,i){this._checkLoaded();let d=this.stylesheet.imports||[];const m=this.getImportIndex(t);if(m===-1)return this;const v=this.getImportIndex(i);if(v===-1)return this;const w=d[m],R=this.fragments[m];return d=d.filter(({id:N})=>N!==t),this.fragments=this.fragments.filter(({id:N})=>N!==t),this.stylesheet.imports=d.slice(0,v).concat(w).concat(d.slice(v)),this.fragments=this.fragments.slice(0,v).concat(R).concat(this.fragments.slice(v)),this.mergeLayers(),this}setImportUrl(t,i){this._checkLoaded();const d=this.stylesheet.imports||[],m=this.getImportIndex(t);if(m===-1)return this;d[m].url=i;const v=this.fragments[m];return v.style=this._createFragmentStyle(d[m]),v.style.on("style.import.load",()=>this.mergeAll()),v.style.loadURL(i),this}setImportData(t,i){this._checkLoaded();const d=this.getImportIndex(t),m=this.stylesheet.imports||[];return d===-1?this:i?(this.fragments[d].style.setState(i),this._reloadImports(),this):(delete m[d].data,this.setImportUrl(t,m[d].url))}setImportConfig(t,i,d){this._checkLoaded();const m=this.getImportIndex(t),v=this.stylesheet.imports||[];if(m===-1)return this;i?v[m].config=i:delete v[m].config;const w=this.fragments[m];d&&w.style.stylesheet&&(w.style.stylesheet.schema=d);const R=w.style.stylesheet&&w.style.stylesheet.schema;return w.config=i,w.style.updateConfig(i,R),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const i=this.stylesheet.imports||[],d=this.getImportIndex(t);d!==-1&&(i.splice(d,1),this.fragments[d].style._remove(),this.fragments.splice(d,1),this._reloadImports())}getImportIndex(t){const i=(this.stylesheet.imports||[]).findIndex(d=>d.id===t);return i===-1&&this.fire(new a.z(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),i}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const i in this._mergedOtherSourceCaches){const d=this._mergedOtherSourceCaches[i];d&&t.push(d.getSource())}return t}getSource(t,i){const d=this.getSourceCache(t,i);return d&&d.getSource()}getLayerSource(t){const i=this.getLayerSourceCache(t);return i&&i.getSource()}getSourceCache(t,i){const d=a.C(t,i);return this._mergedOtherSourceCaches[d]}getLayerSourceCache(t){const i=a.C(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[i]:this._mergedOtherSourceCaches[i]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const i=[];return this._mergedOtherSourceCaches[t]&&i.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&i.push(this._mergedSymbolSourceCaches[t]),i}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const i in t){const d=t[i];d==="reload"?this.reloadSource(i):d==="clear"&&this.clearSource(i)}}updateLayers(t){const i=this._changes.getUpdatedPaintProperties();for(const d of i){const m=this.getLayer(d);m&&m.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t,this.scope)}getImages(t,i,d){this.imageManager.getImages(i.images,i.scope,d),this._updateTilesForChangedImages();const m=w=>{if(w){const R=i.images.map(N=>a.I.toString(N));w.setDependencies(i.tileID.key,i.type,R)}},v=a.C(i.source,i.scope);m(this._mergedOtherSourceCaches[v]),m(this._mergedSymbolSourceCaches[v])}rasterizeImages(t,i,d){this.imageManager.rasterizeImages(i,d)}getGlyphs(t,i,d){this.glyphManager.getGlyphs(i.stacks,i.scope,d)}getResource(t,i,d){return a.cz(i,d)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const i=[];return this._otherSourceCaches[t]&&i.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&i.push(this._symbolSourceCaches[t]),i}_isSourceCacheLoaded(t){const i=this.getOwnSourceCaches(t);return i.length===0?(this.fire(new a.z(new Error(`There is no source with ID '${t}'`))),!1):i.every(d=>d.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,i){if(!this._clipLayerPresent&&t.type!=="fill-extrusion")return!1;const d=t.type==="fill-extrusion"&&t.sourceLayer==="building";if(t.is3D(!!this.terrain)){if(d||i&&i.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Qa.getSourceType=function(h){return Eu[h]},Qa.setSourceType=function(h,t){Eu[h]=t},Qa.registerForPluginStateChange=a.ci;var Qp=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,em=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Uu=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,ju="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",mc=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,vf=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,tm=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,kl=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Vu=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Yd=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Wd=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return clamp(mix(lerpx.x,lerpx.y,f.y),0.0,1.0);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const el=[];Ls(Qp,el),Ls(Uu,el),Ls(em,el);const gc={"_prelude_fog.vertex.glsl":vf,"_prelude_terrain.vertex.glsl":mc,"_prelude_shadow.vertex.glsl":Yd,"_prelude_fog.fragment.glsl":tm,"_prelude_shadow.fragment.glsl":Wd,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":kl,"_prelude_raster_particle.glsl":Vu},ua={};er("",mc),er(tm,vf),er(Wd,Yd),er(kl,""),er(Vu,"");const Ol=er(em,Uu),$c=Qp;var Zc={background:er(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:er(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:er(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:er("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:er(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:er(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:er("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:er("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:er("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:er(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:er(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:er(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
void main() {vec3 color=vec3(241.0/255.0,236.0/255.0,225.0/255.0);
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,normal);
#endif
if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(v_normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:er(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:er(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:er(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:er(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:er(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:er(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:er(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:er(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:er(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:er(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:er(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:er(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),0.001);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:er(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:er(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:er(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:er("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:er("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:er(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:er(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#endif
}`),terrainRaster:er(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:er("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:er(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ju),skyboxGradient:er(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ju),skyboxCapture:er(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:er(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:er(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:er(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:er(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:er(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:er("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:er("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:er("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:er("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Ls(h,t){const i=h.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let d of i)if(d=d.trim(),d[0]==="#"&&d.includes("if")&&!d.includes("endif")){d=d.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const m=d.split(" ");for(const v of m)t.includes(v)||t.push(v)}}function er(h,t){const i=/#include\s+"([^"]+)"/g,d=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let m=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);m&&(m=m.map(P=>{const F=P.split(" ");return F[F.length-1]}),m=[...new Set(m)]);const v={},w=[],R=[];if(h=h.replace(i,(P,F)=>(R.push(F),"")),(t=t.replace(i,(P,F)=>(w.push(F),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let N=[...el];Ls(h,N),Ls(t,N);for(const P of[...w,...R])gc[P]||console.error(`Undefined include: ${P}`),ua[P]||(ua[P]=[],Ls(gc[P],ua[P])),N=[...N,...ua[P]];return{fragmentSource:h=h.replace(d,(P,F,V,j,Z)=>(v[Z]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
in ${V} ${j} ${Z};
#else
uniform ${V} ${j} u_${Z};
#endif
`:F==="initialize"?`
#ifdef HAS_UNIFORM_u_${Z}
    ${V} ${j} ${Z} = u_${Z};
#endif
`:F==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Z}
    in ${V} ${j} ${Z};
#endif
`:F==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(d,(P,F,V,j,Z)=>{const Q=j==="float"?"vec2":j,K=Z.match(/color/)?"color":Q;return F==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${Z}
in ${V} ${j} a_${Z};
#endif
`:v[Z]?F==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
uniform lowp float u_${Z}_t;
in ${V} ${Q} a_${Z};
out ${V} ${j} ${Z};
#else
uniform ${V} ${j} u_${Z};
#endif
`:F==="initialize"?K==="vec4"?`
#ifndef HAS_UNIFORM_u_${Z}
    ${Z} = a_${Z};
#else
    ${V} ${j} ${Z} = u_${Z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Z}
    ${Z} = unpack_mix_${K}(a_${Z}, u_${Z}_t);
#else
    ${V} ${j} ${Z} = u_${Z};
#endif
`:F==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Z}
    in ${V} ${j} a_${Z};
    out ${V} ${j} ${Z};
#endif
`:F==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Z}
    ${Z} = a_${Z};
#endif
`:void 0:F==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
uniform lowp float u_${Z}_t;
in ${V} ${Q} a_${Z};
#else
uniform ${V} ${j} u_${Z};
#endif
`:F==="define-instanced"?K==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${Z}0;
in vec4 a_${Z}1;
in vec4 a_${Z}2;
in vec4 a_${Z}3;
#else
uniform ${V} ${j} u_${Z};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${V} ${Q} a_${Z};
#else
uniform ${V} ${j} u_${Z};
#endif
`:F==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${Z}
    ${V} ${j} ${Z} = a_${Z};
#endif
`:K==="vec4"?`
#ifndef HAS_UNIFORM_u_${Z}
    ${V} ${j} ${Z} = a_${Z};
#else
    ${V} ${j} ${Z} = u_${Z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Z}
    ${V} ${j} ${Z} = unpack_mix_${K}(a_${Z}, u_${Z}_t);
#else
    ${V} ${j} ${Z} = u_${Z};
#endif
`}),staticAttributes:m,usedDefines:N,vertexIncludes:w,fragmentIncludes:R}}class Og{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,i,d,m,v,w,R,N){this.context=t;let P=this.boundPaintVertexBuffers.length!==m.length;for(let V=0;!P&&V<m.length;V++)this.boundPaintVertexBuffers[V]!==m[V]&&(P=!0);let F=this.boundDynamicVertexBuffers.length!==R.length;for(let V=0;!F&&V<R.length;V++)this.boundDynamicVertexBuffers[V]!==R[V]&&(F=!0);if(!this.vao||this.boundProgram!==i||this.boundLayoutVertexBuffer!==d||P||F||this.boundIndexBuffer!==v||this.boundVertexOffset!==w)this.freshBind(i,d,m,v,w,R,N);else{t.bindVertexArrayOES.set(this.vao);for(const V of R)V&&(V.bind(),N&&V.instanceCount&&V.setVertexAttribDivisor(t.gl,i,N));v&&v.dynamicDraw&&v.bind()}}freshBind(t,i,d,m,v,w,R){const N=t.numAttributes,P=this.context,F=P.gl;this.vao&&this.destroy(),this.vao=P.gl.createVertexArray(),P.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=i,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=m,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=w,i.enableAttributes(F,t),i.bind(),i.setVertexAttribPointers(F,t,v);for(const V of d)V.enableAttributes(F,t),V.bind(),V.setVertexAttribPointers(F,t,v);for(const V of w)V&&(V.enableAttributes(F,t),V.bind(),V.setVertexAttribPointers(F,t,v),R&&V.instanceCount&&V.setVertexAttribDivisor(F,t,R));m&&m.bind(),P.currentNumAttributes=N}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Cy(h,t){const i=Math.pow(2,t.canonical.z),d=t.canonical.y;return[new a.ac(0,d/i).toLngLat().lat,new a.ac(0,(d+1)/i).toLngLat().lat]}function qu(h,t,i,d,m,v,w){const R=h.context,N=R.gl,P=i.hillshadeFBO;if(!P)return;h.prepareDrawTile();const F=h.isTileAffectedByFog(t),V=h.getOrCreateProgram("hillshade",{overrideFog:F});R.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,P.colorAttachment.get());const j=((te,re,pe,be)=>{const ye=pe.paint.get("hillshade-shadow-color"),Ae=pe.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",ve=pe.paint.get("hillshade-highlight-color"),Se=pe.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Te=pe.paint.get("hillshade-accent-color"),Me=pe.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",ze=pe.paint.get("hillshade-emissive-strength");let ot=a.ak(pe.paint.get("hillshade-illumination-direction"));if(pe.paint.get("hillshade-illumination-anchor")==="viewport")ot-=te.transform.angle;else if(te.style&&te.style.enable3dLights()&&te.style.directionalLight){const ft=te.style.directionalLight.properties.get("direction"),gt=a.cc(ft.x,ft.y,ft.z);ot=a.ak(gt[1])}const Xe=!te.options.moving;return{u_matrix:be||te.transform.calculateProjMatrix(re.tileID.toUnwrapped(),Xe),u_image:0,u_latrange:Cy(0,re.tileID),u_light:[pe.paint.get("hillshade-exaggeration"),ot],u_shadow:ye.toRenderColor(Ae?null:pe.lut),u_highlight:ve.toRenderColor(Se?null:pe.lut),u_emissive_strength:ze,u_accent:Te.toRenderColor(Me?null:pe.lut)}})(h,i,d,h.terrain?t.projMatrix:null);h.uploadCommonUniforms(R,V,t.toUnwrapped());const{tileBoundsBuffer:Z,tileBoundsIndexBuffer:Q,tileBoundsSegments:K}=h.getTileBoundsBuffers(i);V.draw(h,N.TRIANGLES,m,v,w,Dn.disabled,j,d.id,Z,Q,K)}function nm(h,t,i){if(!t.needsDEMTextureUpload)return;const d=h.context,m=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||h.getTileTexture(i.stride);const v=i.getPixels();t.demTexture?t.demTexture.update(v,{premultiply:!1}):t.demTexture=new a.T(d,v,m.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Ig(h,t,i){const d=h.context,m=d.gl;if(!t.dem)return;const v=t.dem;if(d.activeTexture.set(m.TEXTURE1),nm(h,t,v),!t.demTexture)return;t.demTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE);const w=v.dim;d.activeTexture.set(m.TEXTURE0);let R=t.hillshadeFBO;if(!R){const j=new a.T(d,{width:w,height:w,data:null},m.RGBA8);j.bind(m.LINEAR,m.CLAMP_TO_EDGE),R=t.hillshadeFBO=d.createFramebuffer(w,w,!0,"renderbuffer"),R.colorAttachment.set(j.texture)}d.bindFramebuffer.set(R.framebuffer),d.viewport.set([0,0,w,w]);const{tileBoundsBuffer:N,tileBoundsIndexBuffer:P,tileBoundsSegments:F}=h.getMercatorTileBoundsBuffers(),V=[];h.linearFloatFilteringSupported()&&V.push("TERRAIN_DEM_FLOAT_FORMAT"),h.getOrCreateProgram("hillshadePrepare",{defines:V}).draw(h,m.TRIANGLES,_n.disabled,Bn.disabled,Xn.unblended,Dn.disabled,((j,Z)=>{const Q=Z.stride,K=a.ad.mat4.create();return a.ad.mat4.ortho(K,0,a.ai,-a.ai,0,0,1),a.ad.mat4.translate(K,K,[0,-a.ai,0]),{u_matrix:K,u_image:1,u_dimension:[Q,Q],u_zoom:j.overscaledZ}})(t.tileID,v),i.id,N,P,F),t.needsHillshadePrepare=!1}class ni{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class qr extends ni{getDefault(){return a.al.transparent}set(t){const i=this.current;(t.r!==i.r||t.g!==i.g||t.b!==i.b||t.a!==i.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class gn extends ni{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Yc extends ni{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Xd extends ni{getDefault(){return[!0,!0,!0,!0]}set(t){const i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[3]!==i[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Gi extends ni{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class rm extends ni{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class im extends ni{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const i=this.current;(t.func!==i.func||t.ref!==i.ref||t.mask!==i.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Dy extends ni{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Hu extends ni{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;t?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),this.current=t,this.dirty=!1}}class xf extends ni{getDefault(){return[0,1]}set(t){const i=this.current;(t[0]!==i[0]||t[1]!==i[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class om extends ni{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;t?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),this.current=t,this.dirty=!1}}class ps extends ni{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class bf extends ni{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;t?i.enable(i.BLEND):i.disable(i.BLEND),this.current=t,this.dirty=!1}}class qo extends ni{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[3]!==i[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ai extends ni{getDefault(){return a.al.transparent}set(t){const i=this.current;(t.r!==i.r||t.g!==i.g||t.b!==i.b||t.a!==i.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class wf extends ni{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class Gu extends ni{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;t?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),this.current=t,this.dirty=!1}}class Il extends ni{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Nl extends ni{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let da=class extends ni{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}};class Sf extends ni{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class _c extends ni{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[3]!==i[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class sm extends ni{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Kd extends ni{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;i.bindRenderbuffer(i.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Wc extends ni{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;i.bindTexture(i.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class am extends ni{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class My extends ni{getDefault(){return null}set(t){const i=this.gl;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ry extends ni{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class ky extends ni{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Oy extends ni{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Iy extends ni{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class $u extends ni{constructor(t,i){super(t),this.context=t,this.parent=i}getDefault(){return null}}class Tf extends $u{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Ef extends $u{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,this.attachment(),i.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Zu extends $u{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,this.attachment(),i.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Ng extends Ef{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const zg=(h,t,i)=>({u_matrix:h,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:i}),Pg=(h,t,i,d,m,v,w,R,N,P,F,V,j,Z,Q,K)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(d),u_merc_matrix:i,u_zoom_transition:m,u_merc_center:v,u_image0:0,u_frustum_tl:w,u_frustum_tr:R,u_frustum_br:N,u_frustum_bl:P,u_globe_pos:F,u_globe_radius:V,u_viewport:j,u_grid_matrix:K?Float32Array.from(K):new Float32Array(9),u_skirt_height:Z,u_far_z_cutoff:Q});function Af(h,t){return h!=null&&t!=null&&!(!h.hasData()||!t.hasData())&&h.demTexture!=null&&t.demTexture!=null&&h.tileID.key!==t.tileID.key}const ha=new class{constructor(){this.operations={}}newMorphing(h,t,i,d,m){if(h in this.operations){const v=this.operations[h];v.to.tileID.key!==i.tileID.key&&(v.queued=i)}else this.operations[h]={startTime:d,phase:0,duration:m,from:t,to:i,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const t=this.operations[h];return{from:t.from,to:t.to,phase:t.phase}}update(h){for(const t in this.operations){const i=this.operations[t];for(i.phase=(h-i.startTime)/i.duration;i.phase>=1||!this._validOp(i);)if(!this._nextOp(i,h)){delete this.operations[t];break}}}_nextOp(h,t){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=t,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},lm={0:null,1:"TERRAIN_VERTEX_MORPHING"};function tl(h,t,i){if(t===0)return 0;const d=t<1&&i===514?.25/t:1;return 6*Math.pow(1.5,22-h)*Math.max(t,1)*d}function cm(h,t){const i=1<<h.z;return!t&&(h.x===0||h.x===i-1)||h.y===0||h.y===i-1}const Yu=h=>({u_matrix:h});function yc(h,t,i,d,m){if(m>0){const v=a.q.now(),w=(v-h.timeAdded)/m,R=t?(v-t.timeAdded)/m:-1,N=i.getSource(),P=d.coveringZoomLevel({tileSize:N.tileSize,roundZoom:N.roundZoom}),F=!t||Math.abs(t.tileID.overscaledZ-P)>Math.abs(h.tileID.overscaledZ-P),V=F&&h.refreshedUponExpiration?1:a.ay(F?w:1-R,0,1);return h.refreshedUponExpiration&&w>=1&&(h.refreshedUponExpiration=!1),t?{opacity:1,mix:1-V}:{opacity:V,mix:0}}return{opacity:1,mix:0}}class Cf extends aa{constructor(t){const i={type:"raster-dem",maxzoom:t.transform.maxZoom},d=new a.D(a.cj(),null),m=Au("mock-dem",i,d,t.style);super("mock-dem",m,!1),m.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,i){t.state="loaded",i(null)}}class um extends aa{constructor(t){const i=Au("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new a.D(a.cj(),null),t.style);super("proxy",i,!1),i.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,i,d){if(t.freezeTileCoverage)return;this.transform=t;const m=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,w)=>{if(v[w.key]="",!this._tiles[w.key]){const R=new Is(w,this._source.tileSize*w.overscaleFactor(),t.tileZoom);R.state="loaded",this._tiles[w.key]=R}return v},{});for(const v in this._tiles)v in m||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(t){const i=this.proxyCachedFBO[t];if(i!==void 0){const d=Object.values(i);this.renderCachePool.push(...d),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class dm extends a.aH{constructor(t,i,d){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=i,this.projMatrix=d}}class Df extends a.cK{constructor(t,i){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[d,m,v]=function(N){const P=new a.b5,F=new a.aV,V=131;P.reserve(17161),F.reserve(33800);const j=a.ai/128,Z=a.ai+j/2,Q=Z+j;for(let te=-j;te<Q;te+=j)for(let re=-j;re<Q;re+=j){const pe=re<0||re>Z||te<0||te>Z?24575:0,be=a.ay(Math.round(re),0,a.ai),ye=a.ay(Math.round(te),0,a.ai);P.emplaceBack(be+pe,ye)}const K=(te,re)=>{const pe=re*V+te;F.emplaceBack(pe+1,pe,pe+V),F.emplaceBack(pe+V,pe+V+1,pe+1)};for(let te=1;te<129;te++)for(let re=1;re<129;re++)K(re,te);return[0,129].forEach(te=>{for(let re=0;re<130;re++)K(re,te),K(te,re)}),[P,F,32768]}(),w=t.context;this.gridBuffer=w.createVertexBuffer(d,a.b7.members),this.gridIndexBuffer=w.createIndexBuffer(m),this.gridSegments=a.b8.simpleSegment(0,0,d.length,m.length),this.gridNoSkirtSegments=a.b8.simpleSegment(0,0,d.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new um(i.map),this.orthoMatrix=a.ad.mat4.create(),a.ad.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,a.ai,0,a.ai,0,1);const R=w.gl;this._overlapStencilMode=new Bn({func:R.GEQUAL,mask:255},0,255,R.KEEP,R.KEEP,R.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=i,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Cf(i.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,i,d){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const m=t.terrain.properties,v=t.terrain.drapeRenderMode===0,w=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=a.q.now();const R=t.terrain&&t.terrain.scope,N=m.get("source"),P=v?this._mockSourceCache:t.getSourceCache(N,R);if(!P)return void a.w(`Couldn't find terrain source "${N}".`);if(this.sourceCache=P,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=w?this.calculateExaggeration(i):m.get("exaggeration"),!i.projection.requiresDraping&&w&&this._exaggeration===0)return void this._disable();this.enabled=!0;const F=()=>{this.sourceCache.used&&a.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const V=this.getScaledDemTileSize();this.sourceCache.update(i,V,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,F(),this._initializing=!0),F(),i.updateElevation(!0,d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(i),this._emptyDEMTextureDirty=!0,this._previousZoom=i.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const i=this._previousCameraAltitude,d=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=d;const m=i!=null?d-i:Number.MAX_VALUE;if(Math.abs(m)<2)return this._exaggeration;const v=t.zoom,w=this._style.terrain;if(!this._previousUpdateTimestamp)return w.getExaggeration(v);let R=v-this._previousZoom;const N=this._previousUpdateTimestamp;let P=v;this._evaluationZoom!=null&&(P=this._evaluationZoom,Math.abs(v-P)>.5&&(R=.5*(v-P+R)),R*m<0&&(P+=R)),this._evaluationZoom=P;const F=w.getExaggeration(P),V=F===w.getExaggeration(Math.max(0,P-.1));if(V&&Math.abs(F-this._exaggeration)<.01)return F;let j=Math.min(.1,.00375*(this._updateTimestamp-N));return(V||F<.1||Math.abs(R)<1e-4)&&(j=Math.min(.2,4*j)),a.ah(this._exaggeration,F,j)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const i=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(a.ac.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const m=this.proxyCoords=i.getIds().map(N=>{const P=i.getTileByID(N).tileID;return P.projMatrix=d.calculateProjMatrix(P.toUnwrapped()),P});(function(N,P){const F=P.transform.pointCoordinate(P.transform.getCameraPoint()),V=new a.P(F.x,F.y);N.sort((j,Z)=>{if(Z.overscaledZ-j.overscaledZ)return Z.overscaledZ-j.overscaledZ;const Q=new a.P(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),K=new a.P(Z.canonical.x+(1<<Z.canonical.z)*Z.wrap,Z.canonical.y),te=V.mult(1<<j.canonical.z);return te.x-=.5,te.y-=.5,te.distSqr(Q)-te.distSqr(K)})})(m,this.painter);const v=this.proxyToSource||{};this.proxyToSource={},m.forEach(N=>{this.proxyToSource[N.key]={}}),this.terrainTileForTile={};const w=this._style._mergedSourceCaches;for(const N in w){const P=w[N];if(!P.used||(P!==this.sourceCache&&this.resetTileLookupCache(P.id),this._setupProxiedCoordsForOrtho(P,t[N],v),P.usedForTerrain))continue;const F=t[N];P.getSource().reparseOverscaled&&this._assignTerrainTiles(F)}this.proxiedCoords[i.id]=m.map(N=>new dm(N,N.key,this.orthoMatrix)),this._assignTerrainTiles(m),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1;const R={};this._visibleDemTiles=[];for(const N of this.proxyCoords){const P=this.terrainTileForTile[N.key];if(!P)continue;const F=P.tileID.key;F in R||(this._visibleDemTiles.push(P),R[F]=F)}}_assignTerrainTiles(t){this._initializing||t.forEach(i=>{if(this.terrainTileForTile[i.key])return;const d=this._findTileCoveringTileID(i,this.sourceCache);d&&(this.terrainTileForTile[i.key]=d)})}_prepareDEMTextures(){const t=this.painter.context,i=t.gl;for(const d in this.terrainTileForTile){const m=this.terrainTileForTile[d],v=m.dem;!v||m.demTexture&&!m.needsDEMTextureUpload||(t.activeTexture.set(i.TEXTURE1),nm(this.painter,m,v))}}_prepareDemTileUniforms(t,i,d,m){if(!i||i.demTexture==null)return!1;const v=t.tileID.canonical,w=Math.pow(2,i.tileID.canonical.z-v.z),R=m||"";return d[`u_dem_tl${R}`]=[v.x*w%1,v.y*w%1],d[`u_dem_scale${R}`]=w,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const i=this._visibleDemTiles.reduce((d,m)=>{if(!m.dem)return d;const v=m.dem.tree.minimums[0];return v>0&&t++,d+v},0);return t?i/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,i=t.gl;t.activeTexture.set(i.TEXTURE2);const d=this._getLoadedAreaMinimum(),m=new a.cL({width:1,height:1},new Float32Array([d]));this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(m,{premultiply:!1}):v=this._emptyDEMTexture=new a.T(t,m,i.R32F,{premultiply:!1}),v}setupElevationDraw(t,i,d){const m=this.painter.context,v=m.gl,w={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};w.u_exaggeration=this.exaggeration();let R=null,N=null,P=1;if(d&&d.morphing&&this._useVertexMorphing){const Z=d.morphing.srcDemTile,Q=d.morphing.dstDemTile;P=d.morphing.phase,Z&&Q&&(this._prepareDemTileUniforms(t,Z,w,"_prev")&&(N=Z),this._prepareDemTileUniforms(t,Q,w)&&(R=Q))}const F=Z=>Z&&Z.demTexture&&this.painter.linearFloatFilteringSupported()?v.LINEAR:v.NEAREST;let V=null;var j;if(this.enabled?N&&R?(V=R.demTexture,m.activeTexture.set(v.TEXTURE4),N.demTexture.bind(F(N),v.CLAMP_TO_EDGE),w.u_dem_lerp=P):(R=this.terrainTileForTile[t.tileID.key],V=this._prepareDemTileUniforms(t,R,w)?R.demTexture:this.emptyDEMTexture):V=this.emptyDEMTexture,m.activeTexture.set(v.TEXTURE2),V&&(w.u_dem_size=(j=V).size[0]===1?1:j.size[0]-2,V.bind(F(R),v.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(d&&d.useDepthForOcclusion,i,w),d&&d.useMeterToDem&&R){const Z=(1<<R.tileID.canonical.z)*a.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;w.u_meter_to_dem=Z}if(d&&d.labelPlaneMatrixInv&&(w.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),i.setTerrainUniformValues(m,w),this.painter.transform.projection.name==="globe"){const Z=this.globeUniformValues(this.painter.transform,t.tileID.canonical,d&&d.useDenormalizedUpVectorScale);i.setGlobeUniformValues(m,Z)}}globeUniformValues(t,i,d){const m=t.projection;return{u_tile_tl_up:m.upVector(i,0,0),u_tile_tr_up:m.upVector(i,a.ai,0),u_tile_br_up:m.upVector(i,a.ai,a.ai),u_tile_bl_up:m.upVector(i,0,a.ai),u_tile_up_scale:d?a.cM(1):m.upVectorScale(i,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const i=this.painter,d=this.painter.context;t.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,i.width,i.height]),i.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(m,v,w,R,N){if(m.transform.projection.name==="globe")(function(P,F,V,j,Z){const Q=P.context,K=Q.gl;let te,re;const pe=P.transform,be=a.cD(P,Q,pe),ye=(ft,gt)=>{if(re===gt)return;const Mt=[lm[gt],"PROJECTION_GLOBE_VIEW"];be&&Mt.push("CUSTOM_ANTIALIASING");const He=P.isTileAffectedByFog(ft);te=P.getOrCreateProgram("globeRaster",{defines:Mt,overrideFog:He}),re=gt},Ae=P.colorModeForRenderPass(),ve=new _n(K.LEQUAL,_n.ReadWrite,P.depthRangeFor3D);ha.update(Z);const Se=a.cE(pe),Te=[a.av(pe.center.lng),a.aC(pe.center.lat)],Me=P.globeSharedBuffers,ze=[pe.width*a.q.devicePixelRatio,pe.height*a.q.devicePixelRatio],ot=Float32Array.from(pe.globeMatrix),Xe={useDenormalizedUpVectorScale:!0};{const ft=P.transform,gt=tl(ft.zoom,F.exaggeration(),F.sourceCache._source.tileSize);re=-1;const Mt=K.TRIANGLES;for(const He of j){const mt=V.getTile(He),qe=Bn.disabled,pt=F.prevTerrainTileForTile[He.key],lt=F.terrainTileForTile[He.key];Af(pt,lt)&&ha.newMorphing(He.key,pt,lt,Z,250),Q.activeTexture.set(K.TEXTURE0),mt.texture&&mt.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);const yt=ha.getMorphValuesForProxy(He.key),st=yt?1:0;yt&&a.L(Xe,{morphing:{srcDemTile:yt.from,dstDemTile:yt.to,phase:a.cC(yt.phase)}});const dt=a.cF(He.canonical),Ht=a.cG(dt.getCenter().lat),kt=a.cH(He.canonical,dt,Ht,ft.worldSize/ft._pixelsPerMercatorPixel),Wt=a.bc(a.cI(He.canonical)),hn=Pg(ft.expandedFarZProjMatrix,ot,Se,Wt,a.ag(ft.zoom),Te,ft.frustumCorners.TL,ft.frustumCorners.TR,ft.frustumCorners.BR,ft.frustumCorners.BL,ft.globeCenterInViewSpace,ft.globeRadius,ze,gt,ft._farZ,kt);if(ye(He,st),te&&(F.setupElevationDraw(mt,te,Xe),P.uploadCommonUniforms(Q,te,He.toUnwrapped()),Me)){const[In,bn,Tn]=Me.getGridBuffers(Ht,gt!==0);te.draw(P,Mt,ve,qe,Ae,Dn.backCCW,hn,"globe_raster",In,bn,Tn)}}}if(Me&&(P.renderDefaultNorthPole||P.renderDefaultSouthPole)){const ft=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];be&&ft.push("CUSTOM_ANTIALIASING"),te=P.getOrCreateProgram("globeRaster",{defines:ft});for(const gt of j){const{x:Mt,y:He,z:mt}=gt.canonical,qe=He===0,pt=He===(1<<mt)-1,[lt,yt,st,dt]=Me.getPoleBuffers(mt,!1);if(dt&&(qe||pt)){const Ht=V.getTile(gt);Q.activeTexture.set(K.TEXTURE0),Ht.texture&&Ht.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);let kt=a.cJ(mt,Mt,pe);const Wt=a.bc(a.cI(gt.canonical)),hn=(In,bn)=>In.draw(P,K.TRIANGLES,ve,Bn.disabled,Ae,Dn.disabled,Pg(pe.expandedFarZProjMatrix,kt,kt,Wt,0,Te,pe.frustumCorners.TL,pe.frustumCorners.TR,pe.frustumCorners.BR,pe.frustumCorners.BL,pe.globeCenterInViewSpace,pe.globeRadius,ze,0,pe._farZ),"globe_pole_raster",bn,st,dt);F.setupElevationDraw(Ht,te,Xe),P.uploadCommonUniforms(Q,te,gt.toUnwrapped()),qe&&P.renderDefaultNorthPole&&hn(te,lt),pt&&P.renderDefaultSouthPole&&(kt=a.ad.mat4.scale(a.ad.mat4.create(),kt,[1,-1,1]),hn(te,yt))}}}})(m,v,w,R,N);else{const P=m.context,F=P.gl;let V,j;const Z=m.shadowRenderer,Q=wa(m,m.longestCutoffRange),K=Ae=>{if(j===Ae)return;const ve=[];ve.push(lm[Ae]),Q.shouldRenderCutoff&&ve.push("RENDER_CUTOFF"),Z&&(ve.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Z.useNormalOffset&&ve.push("NORMAL_OFFSET")),V=m.getOrCreateProgram("terrainRaster",{defines:ve}),j=Ae},te=m.colorModeForRenderPass(),re=new _n(F.LEQUAL,_n.ReadWrite,m.depthRangeFor3D);ha.update(N);const pe=m.transform,be=tl(pe.zoom,v.exaggeration(),v.sourceCache._source.tileSize);let ye=[0,0,0];if(Z){const Ae=m.style.directionalLight,ve=m.style.ambientLight;Ae&&ve&&(ye=Sa(m.style,Ae,ve))}{j=-1;const Ae=F.TRIANGLES,[ve,Se]=[v.gridIndexBuffer,v.gridSegments];for(const Te of R){const Me=w.getTile(Te),ze=Bn.disabled,ot=v.prevTerrainTileForTile[Te.key],Xe=v.terrainTileForTile[Te.key];Af(ot,Xe)&&ha.newMorphing(Te.key,ot,Xe,N,250),P.activeTexture.set(F.TEXTURE0),Me.texture&&Me.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const ft=ha.getMorphValuesForProxy(Te.key),gt=ft?1:0;let Mt;ft&&(Mt={morphing:{srcDemTile:ft.from,dstDemTile:ft.to,phase:a.cC(ft.phase)}});const He=zg(Te.projMatrix,cm(Te.canonical,pe.renderWorldCopies)?be/10:be,ye);if(K(gt),!V)continue;v.setupElevationDraw(Me,V,Mt);const mt=Te.toUnwrapped();Z&&Z.setupShadows(mt,V),m.uploadCommonUniforms(P,V,mt,null,Q),V.draw(m,Ae,re,ze,te,Dn.backCCW,He,"terrain_raster",v.gridBuffer,ve,Se)}}}}(i,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,i.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const i=this.painter,d=this.painter.context,m=this.proxySourceCache,v=this.proxiedCoords[m.id],w=this._drapedRenderBatches.shift(),R=i.style.order,N=[];let P=0;for(const F of v){const V=m.getTileByID(F.proxyTileKey),j=m.proxyCachedFBO[F.key]?m.proxyCachedFBO[F.key][t]:void 0,Z=j!==void 0?m.renderCache[j]:this.pool[P++],Q=j!==void 0;if(V.texture=Z.tex,Q&&!Z.dirty){N.push(V.tileID);continue}let K;d.bindFramebuffer.set(Z.fb.framebuffer),this.renderedToTile=!1,Z.dirty&&(d.clear({color:a.al.transparent,stencil:0}),Z.dirty=!1);for(let te=w.start;te<=w.end;++te){const re=i.style._mergedLayers[R[te]];if(re.isHidden(i.transform.zoom))continue;const pe=i.style.getLayerSourceCache(re),be=pe?this.proxyToSource[F.key][pe.id]:[F];if(!be)continue;const ye=be;d.viewport.set([0,0,Z.fb.width,Z.fb.height]),K!==(pe?pe.id:null)&&(this._setupStencil(Z,be,re,pe),K=pe?pe.id:null),i.renderLayer(i,pe,re,ye)}if(this._drapedRenderBatches.length===0)for(const te of this._pendingGroundEffectLayers){const re=i.style._mergedLayers[R[te]];if(re.isHidden(i.transform.zoom))continue;const pe=i.style.getLayerSourceCache(re),be=pe?this.proxyToSource[F.key][pe.id]:[F];if(!be)continue;const ye=be;d.viewport.set([0,0,Z.fb.width,Z.fb.height]),K!==(pe?pe.id:null)&&(this._setupStencil(Z,be,re,pe),K=pe?pe.id:null),i.renderLayer(i,pe,re,ye)}this.renderedToTile?(Z.dirty=!0,N.push(V.tileID)):Q||--P,P===5&&(P=0,this.renderToBackBuffer(N))}return this.renderToBackBuffer(N),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,i.width,i.height]),w.end+1}postRender(){}isLayerOrderingCorrect(t){const i=t.order.length;let d=-1,m=i;for(let v=0;v<i;++v)this._style.isLayerDraped(t._mergedLayers[t.order[v]])?d=Math.max(d,v):m=Math.min(m,v);return m>d}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(i=>i.dem).forEach(i=>{t=Math.min(t,i.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,i,d){if(!this._visibleDemTiles)return null;const m=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const w=v.tileID,R=1<<w.overscaledZ,{x:N,y:P}=w.canonical,F=N/R,V=(N+1)/R,j=P/R,Z=(P+1)/R;return{minx:F,miny:j,maxx:V,maxy:Z,t:v.dem.tree.raycastRoot(F,j,V,Z,t,i,d),tile:v}});m.sort((v,w)=>(v.t!==null?v.t:Number.MAX_VALUE)-(w.t!==null?w.t:Number.MAX_VALUE));for(const v of m){if(v.t==null)return null;const w=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,t,i,d);if(w!=null)return w}return null}_createFBO(){const t=this.painter.context,i=t.gl,d=this.drapeBufferSize;t.activeTexture.set(i.TEXTURE0);const m=new a.T(t,{width:d[0],height:d[1],data:null},i.RGBA8);m.bind(i.LINEAR,i.CLAMP_TO_EDGE);const v=t.createFramebuffer(d[0],d[1],!0,null);return v.colorAttachment.set(m.texture),v.depthAttachment=new Ng(t,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&i.texParameterf(i.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:v,tex:m,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const i=this._style._mergedLayers[t],d=i.isHidden(this.painter.transform.zoom);return i.type==="hillshade"||i.type==="custom"?!d&&i.shouldRedrape():!d&&i.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const d of this._style.getSources())if(d instanceof ja){t=!0;break}if(!t)return;const i={};for(let d=0;d<this._style.order.length;++d){const m=this._style._mergedLayers[this._style.order[d]],v=this._style.getLayerSourceCache(m);if(v&&!i[v.id]&&!m.isHidden(this.painter.transform.zoom)&&m.type==="line"&&m.widthExpression()instanceof a.ab){i[v.id]=!0;for(const w of this.proxyCoords){const R=this.proxyToSource[w.key][v.id];if(R)for(const N of R)this._clearRenderCacheForTile(v.id,N)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const d in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[d]._source instanceof Ro){t=!0;break}if(!t)return;const i={};for(let d=0;d<this._style.order.length;++d){const m=this._style._mergedLayers[this._style.order[d]],v=this._style.getLayerSourceCache(m);if(!v||i[v.id]||m.isHidden(this.painter.transform.zoom)||m.type!=="raster")continue;const w=m.paint.get("raster-fade-duration");for(const R of this.proxyCoords){const N=this.proxyToSource[R.key][v.id];if(N)for(const P of N){const F=yc(v.getTile(P),v.findLoadedParent(P,0),v,this.painter.transform,w);(F.opacity!==1||F.mix!==0)&&this._clearRenderCacheForTile(v.id,P)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,i=t.length;if(i===0)return;const d=[];this._pendingGroundEffectLayers=[];let m,v=0,w=this._style._mergedLayers[t[v]];for(;!this._style.isLayerDraped(w)&&w.isHidden(this.painter.transform.zoom)&&++v<i;)w=this._style._mergedLayers[t[v]];for(;v<i;++v){const R=this._style._mergedLayers[t[v]];R.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(R)?m===void 0&&(m=v):(R.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(v),m!==void 0&&(d.push({start:m,end:v-1}),m=void 0)))}if(m!==void 0&&d.push({start:m,end:v-1}),d.length!==0){const R=d[d.length-1];this._pendingGroundEffectLayers.every(N=>N>R.end)||a.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=d}_setupRenderCache(t){const i=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,i.renderCache.length>i.renderCachePool.length){const w=Object.values(i.proxyCachedFBO);i.proxyCachedFBO={};for(let R=0;R<w.length;++R){const N=Object.values(w[R]);i.renderCachePool.push(...N)}}return}this._clearRasterLayersFromRenderCache();const d=this.proxyCoords,m=this._tilesDirty;for(let w=d.length-1;w>=0;w--){const R=d[w];if(i.getTileByID(R.key),i.proxyCachedFBO[R.key]!==void 0){const N=t[R.key],P=this.proxyToSource[R.key];let F=0;for(const V in P){const j=P[V],Z=N[V];if(!Z||Z.length!==j.length||j.some((Q,K)=>Q!==Z[K]||m[V]&&m[V].hasOwnProperty(Q.key))){F=-1;break}++F}for(const V in i.proxyCachedFBO[R.key])i.renderCache[i.proxyCachedFBO[R.key][V]].dirty=F<0||F!==Object.values(N).length}}const v=[...this._drapedRenderBatches];v.sort((w,R)=>R.end-R.start-(w.end-w.start));for(const w of v)for(const R of d){if(i.proxyCachedFBO[R.key])continue;let N=i.renderCachePool.pop();N===void 0&&i.renderCache.length<50&&(N=i.renderCache.length,i.renderCache.push(this._createFBO())),N!==void 0&&(i.proxyCachedFBO[R.key]={},i.proxyCachedFBO[R.key][w.start]=N,i.renderCache[N].dirty=!0)}this._tilesDirty={}}_setupStencil(t,i,d,m){if(!m||!this._sourceTilesOverlap[m.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,w=v.gl;if(i.length<=1)return void(this._overlapStencilType=!1);let R;if(d.isTileClipped())R=i.length,this._overlapStencilMode.test={func:w.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(i[0].overscaledZ>i[i.length-1].overscaledZ))return void(this._overlapStencilType=!1);R=1,this._overlapStencilMode.test={func:w.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+R>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=R,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(i,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Bn.disabled}_renderTileClippingMasks(t,i){const d=this.painter,m=this.painter.context,v=m.gl;d._tileClippingMaskIDs={},m.setColorMode(Xn.disabled),m.setDepthMode(_n.disabled);const w=d.getOrCreateProgram("clippingMask");for(const R of t){const N=d._tileClippingMaskIDs[R.key]=--i;w.draw(d,v.TRIANGLES,_n.disabled,new Bn({func:v.ALWAYS,mask:0},N,255,v.KEEP,v.KEEP,v.REPLACE),Xn.disabled,Dn.disabled,Yu(R.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(t){const i=this.painter.transform;if(t.x<0||t.x>i.width||t.y<0||t.y>i.height)return null;const d=[t.x,t.y,1,1];a.ad.vec4.transformMat4(d,d,i.pixelMatrixInverse),a.ad.vec4.scale(d,d,1/d[3]),d[0]/=i.worldSize,d[1]/=i.worldSize;const m=i._camera.position,v=a.bH(1,i.center.lat),w=[m[0],m[1],m[2]/v,0],R=a.ad.vec3.subtract([],d.slice(0,3),w);a.ad.vec3.normalize(R,R);const N=this.raycast(w,R,this._exaggeration);return N!==null&&N?(a.ad.vec3.scaleAndAdd(w,w,R,N),w[3]=w[2],w[2]*=v,w):null}_setupProxiedCoordsForOrtho(t,i,d){if(t.getSource()instanceof a.aK)return this._setupProxiedCoordsForImageSource(t,i,d);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const m=this.proxiedCoords[t.id]=[],v=this.proxyCoords;for(let N=0;N<v.length;N++){const P=v[N],F=this._findTileCoveringTileID(P,t);if(F){const V=this._createProxiedId(P,F,d[P.key]&&d[P.key][t.id]);m.push(V),this.proxyToSource[P.key][t.id]=[V]}}let w=!1;const R=new Set;for(let N=0;N<i.length;N++){const P=t.getTile(i[N]);if(!P||!P.hasData())continue;const F=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(F&&F.tileID.canonical.z!==P.tileID.canonical.z){const V=this.proxyToSource[F.tileID.key][t.id],j=this._createProxiedId(F.tileID,P,d[F.tileID.key]&&d[F.tileID.key][t.id]);V?V.splice(V.length-1,0,j):this.proxyToSource[F.tileID.key][t.id]=[j];const Z=this.proxyToSource[F.tileID.key][t.id];R.has(Z)||R.add(Z),m.push(j),w=!0}}if(this._sourceTilesOverlap[t.id]=w,w&&this._debugParams.sortTilesHiZFirst)for(const N of R)N.sort((P,F)=>F.overscaledZ-P.overscaledZ)}_setupProxiedCoordsForImageSource(t,i,d){if(!t.getSource().loaded())return;const m=this.proxiedCoords[t.id]=[],v=this.proxyCoords,w=t.getSource(),R=w.tileID;if(!R)return;const N=new a.P(R.x,R.y)._div(1<<R.z),P=w.coordinates.map(a.ac.fromLngLat).reduce((V,j)=>(V.min.x=Math.min(V.min.x,j.x-N.x),V.min.y=Math.min(V.min.y,j.y-N.y),V.max.x=Math.max(V.max.x,j.x-N.x),V.max.y=Math.max(V.max.y,j.y-N.y),V),{min:new a.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),F=(V,j)=>{const Z=V.wrap+V.canonical.x/(1<<V.canonical.z),Q=V.canonical.y/(1<<V.canonical.z),K=a.ai/(1<<V.canonical.z),te=j.wrap+j.canonical.x/(1<<j.canonical.z),re=j.canonical.y/(1<<j.canonical.z);return Z+K<te+P.min.x||Z>te+P.max.x||Q+K<re+P.min.y||Q>re+P.max.y};for(let V=0;V<v.length;V++){const j=v[V];for(let Z=0;Z<i.length;Z++){const Q=t.getTile(i[Z]);if(!Q||!Q.hasData()||F(j,Q.tileID))continue;const K=this._createProxiedId(j,Q,d[j.key]&&d[j.key][t.id]),te=this.proxyToSource[j.key][t.id];te?te.push(K):this.proxyToSource[j.key][t.id]=[K],m.push(K)}}}_createProxiedId(t,i,d){let m=this.orthoMatrix;if(d){const v=d.find(w=>w.key===i.tileID.key);if(v)return v}if(i.tileID.key!==t.key){const v=t.canonical.z-i.tileID.canonical.z;let w,R,N;m=a.ad.mat4.create();const P=i.tileID.wrap-t.wrap<<t.overscaledZ;v>0?(w=a.ai>>v,R=w*((i.tileID.canonical.x<<v)-t.canonical.x+P),N=w*((i.tileID.canonical.y<<v)-t.canonical.y)):(w=a.ai<<-v,R=a.ai*(i.tileID.canonical.x-(t.canonical.x+P<<-v)),N=a.ai*(i.tileID.canonical.y-(t.canonical.y<<-v))),a.ad.mat4.ortho(m,0,w,0,w,0,1),a.ad.mat4.translate(m,m,[R,N,0])}return new dm(i.tileID,t.key,m)}_findTileCoveringTileID(t,i){let d=i.getTile(t);if(d&&d.hasData())return d;const m=this._findCoveringTileCache[i.id],v=m[t.key];if(d=v?i.getTileByID(v):null,d&&d.hasData()||v===null)return d;let w=d?d.tileID:t,R=w.overscaledZ;const N=i.getSource().minzoom,P=[];if(!v){const V=i.getSource().maxzoom;if(t.canonical.z>=V){const j=t.canonical.z-V;i.getSource().reparseOverscaled?(R=Math.max(t.canonical.z+2,i.transform.tileZoom),w=new a.aH(R,t.wrap,V,t.canonical.x>>j,t.canonical.y>>j)):j!==0&&(R=V,w=new a.aH(R,t.wrap,V,t.canonical.x>>j,t.canonical.y>>j))}w.key!==t.key&&(P.push(w.key),d=i.getTile(w))}const F=V=>{P.forEach(j=>{m[j]=V}),P.length=0};for(R-=1;R>=N&&(!d||!d.hasData());R--){d&&F(d.tileID.key);const V=w.calculateScaledKey(R);if(d=i.getTileByID(V),d&&d.hasData())break;const j=m[V];if(j===null)break;j===void 0?P.push(V):d=i.getTileByID(j)}return F(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,i){let d=this._tilesDirty[t];d||(d=this._tilesDirty[t]={}),d[i.key]=!0}}function Wu(h,t,i){const d=function(R,N,P){const F=a.ad.vec3.dot(N,R),V=a.ad.vec3.dot(P,[.2126,.7152,.0722]),j=(Q,K,te)=>(1-te)*Q+te*K,Z=j(1-.3*Math.min(V,1),1,Math.min(F+1,1));return j(.92,1,Math.asin(a.ay(N[2],-1,1))/Math.PI+.5)*Z}(h,[0,0,1],t),m=[0,0,0];a.ad.vec3.scale(m,i.slice(0,3),d);const v=[0,0,0];a.ad.vec3.scale(v,t.slice(0,3),h[2]);const w=[0,0,0];return a.ad.vec3.add(w,m,v),a.cg(w)}const Xc=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Lg=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Kc{static cacheKey(t,i,d,m){let v=`${i}${m?m.cacheKey:""}`;for(const w of d)t.usedDefines.includes(w)&&(v+=`/${w}`);return v}constructor(t,i,d,m,v,w){const R=t.gl;this.program=R.createProgram(),this.configuration=m,this.name=i,this.fixedDefines=[...w];const N=m?m.getBinderAttributes():[],P=(d.staticAttributes||[]).concat(N);let F=m?m.defines():[];F=F.concat(w.map(te=>`#define ${te}`));const V=`#version 300 es
`;let j=V+F.concat("precision mediump float;",$c,Ol.fragmentSource).join(`
`);for(const te of d.fragmentIncludes)j+=`
${gc[te]}`;j+=`
${d.fragmentSource}`;let Z=V+F.concat("precision highp float;",$c,Ol.vertexSource).join(`
`);for(const te of d.vertexIncludes)Z+=`
${gc[te]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&d.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(Z+=`
uniform int u_instanceID;
`),Z+=`
${d.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(Z=Z.replaceAll("gl_InstanceID","u_instanceID"));const Q=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);R.shaderSource(Q,j),R.compileShader(Q),R.attachShader(this.program,Q);const K=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(K,Z),R.compileShader(K),R.attachShader(this.program,K),this.attributes={},this.numAttributes=P.length;for(let te=0;te<this.numAttributes;te++)if(P[te]){const re=P[te].startsWith("a_")?P[te]:`a_${P[te]}`;R.bindAttribLocation(this.program,te,re),this.attributes[re]=te}R.linkProgram(this.program),R.deleteShader(K),R.deleteShader(Q),this.fixedUniforms=v(t),this.binderUniforms=m?m.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(te=>({u_instanceID:new a.bN(te)}))(t)),(w.includes("TERRAIN")||i.indexOf("symbol")!==-1||i.indexOf("circle")!==-1)&&(this.terrainUniforms=(te=>({u_dem:new a.bN(te),u_dem_prev:new a.bN(te),u_dem_tl:new a.bK(te),u_dem_scale:new a.bM(te),u_dem_tl_prev:new a.bK(te),u_dem_scale_prev:new a.bM(te),u_dem_size:new a.bM(te),u_dem_lerp:new a.bM(te),u_exaggeration:new a.bM(te),u_depth:new a.bN(te),u_depth_size_inv:new a.bK(te),u_depth_range_unpack:new a.bK(te),u_occluder_half_size:new a.bM(te),u_occlusion_depth_offset:new a.bM(te),u_meter_to_dem:new a.bM(te),u_label_plane_matrix_inv:new a.bJ(te)}))(t)),w.includes("GLOBE")&&(this.globeUniforms=(te=>({u_tile_tl_up:new a.bL(te),u_tile_tr_up:new a.bL(te),u_tile_br_up:new a.bL(te),u_tile_bl_up:new a.bL(te),u_tile_up_scale:new a.bM(te)}))(t)),w.includes("FOG")&&(this.fogUniforms=(te=>({u_fog_matrix:new a.bJ(te),u_fog_range:new a.bK(te),u_fog_color:new a.cb(te),u_fog_horizon_blend:new a.bM(te),u_fog_vertical_limit:new a.bK(te),u_fog_temporal_offset:new a.bM(te),u_frustum_tl:new a.bL(te),u_frustum_tr:new a.bL(te),u_frustum_br:new a.bL(te),u_frustum_bl:new a.bL(te),u_globe_pos:new a.bL(te),u_globe_radius:new a.bM(te),u_globe_transition:new a.bM(te),u_is_globe:new a.bN(te),u_viewport:new a.bK(te)}))(t)),w.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(te=>({u_cutoff_params:new a.cb(te)}))(t)),w.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(te=>({u_lighting_ambient_color:new a.bL(te),u_lighting_directional_dir:new a.bL(te),u_lighting_directional_color:new a.bL(te),u_ground_radiance:new a.bL(te)}))(t)),w.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(te=>({u_light_matrix_0:new a.bJ(te),u_light_matrix_1:new a.bJ(te),u_fade_range:new a.bK(te),u_shadow_normal_offset:new a.bL(te),u_shadow_intensity:new a.bM(te),u_shadow_texel_size:new a.bM(te),u_shadow_map_resolution:new a.bM(te),u_shadow_direction:new a.bL(te),u_shadow_bias:new a.bL(te),u_shadowmap_0:new a.bN(te),u_shadowmap_1:new a.bN(te)}))(t))}}setTerrainUniformValues(t,i){if(!this.terrainUniforms)return;const d=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in i)d[m]&&d[m].set(this.program,m,i[m])}}setGlobeUniformValues(t,i){if(!this.globeUniforms)return;const d=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in i)d[m]&&d[m].set(this.program,m,i[m])}}setFogUniformValues(t,i){if(!this.fogUniforms)return;const d=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in i)d[m].set(this.program,m,i[m])}}setCutoffUniformValues(t,i){if(!this.cutoffUniforms)return;const d=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in i)d[m].set(this.program,m,i[m])}}setLightsUniformValues(t,i){if(!this.lightsUniforms)return;const d=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in i)d[m].set(this.program,m,i[m])}}setShadowUniformValues(t,i){if(this.failedToCreate||!this.shadowUniforms)return;const d=this.shadowUniforms;t.program.set(this.program);for(const m in i)d[m].set(this.program,m,i[m])}_drawDebugWireframe(t,i,d,m,v,w,R,N,P,F){const V=t.options.wireframe;if(V.terrain===!1&&V.layers2D===!1&&V.layers3D===!1)return;const j=t.context;if(!(!(!V.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!V.layers2D||t._terrain&&t._terrain.renderingToTexture||!Xc.includes(this.name))||!(!V.layers3D||!Lg.includes(this.name))))return;const Z=j.gl,Q=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,v,j);if(!Q)return;const K=[...this.fixedDefines];K.push("DEBUG_WIREFRAME");const te=t.getOrCreateProgram(this.name,{config:this.configuration,defines:K});j.program.set(te.program);const re=(ye,Ae,ve)=>{if(Ae[ye]&&ve[ye])for(const Se in Ae[ye])ve[ye][Se]&&ve[ye][Se].set(ve.program,Se,Ae[ye][Se].current)};P&&P.setUniforms(te.program,j,te.binderUniforms,R,{zoom:N}),re("fixedUniforms",this,te),re("terrainUniforms",this,te),re("globeUniforms",this,te),re("fogUniforms",this,te),re("lightsUniforms",this,te),re("shadowUniforms",this,te),Q.bind(),j.setColorMode(new Xn([Z.ONE,Z.ONE_MINUS_SRC_ALPHA,Z.ZERO,Z.ONE],a.al.transparent,[!0,!0,!0,!1])),j.setDepthMode(new _n(i.func===Z.LESS?Z.LEQUAL:i.func,_n.ReadOnly,i.range)),j.setStencilMode(Bn.disabled);const pe=3*w.primitiveLength*2,be=3*w.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ye=F||1;for(let Ae=0;Ae<ye;++Ae)te.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ae),Z.drawElements(Z.LINES,pe,Z.UNSIGNED_SHORT,be)}else F&&F>1?Z.drawElementsInstanced(Z.LINES,pe,Z.UNSIGNED_SHORT,be,F):Z.drawElements(Z.LINES,pe,Z.UNSIGNED_SHORT,be);v.bind(),j.program.set(this.program),j.setDepthMode(i),j.setStencilMode(d),j.setColorMode(m)}checkUniforms(t,i,d){if(this.fixedDefines.includes(i)){for(const m of Object.keys(d))if(!d[m].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${m} not set but required by ${i} being defined`)}}draw(t,i,d,m,v,w,R,N,P,F,V,j,Z,Q,K,te){const re=t.context,pe=re.gl;if(this.failedToCreate)return;re.program.set(this.program),re.setDepthMode(d),re.setStencilMode(m),re.setColorMode(v),re.setCullFace(w);for(const Ae of Object.keys(this.fixedUniforms))this.fixedUniforms[Ae].set(this.program,Ae,R[Ae]);Q&&Q.setUniforms(this.program,re,this.binderUniforms,j,{zoom:Z});const be={[pe.POINTS]:1,[pe.LINES]:2,[pe.TRIANGLES]:3,[pe.LINE_STRIP]:1}[i];this.checkUniforms(N,"RENDER_SHADOWS",this.shadowUniforms);const ye=te&&te>0?1:void 0;for(const Ae of V.get()){const ve=Ae.vaos||(Ae.vaos={});if((ve[N]||(ve[N]=new Og)).bind(re,this,P,Q?Q.getPaintVertexBuffers():[],F,Ae.vertexOffset,K||[],ye),this.forceManualRenderingForInstanceIDShaders){const Se=te||1;for(let Te=0;Te<Se;++Te)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Te),F?pe.drawElements(i,Ae.primitiveLength*be,pe.UNSIGNED_SHORT,Ae.primitiveOffset*be*2):pe.drawArrays(i,Ae.vertexOffset,Ae.vertexLength)}else te&&te>1?pe.drawElementsInstanced(i,Ae.primitiveLength*be,pe.UNSIGNED_SHORT,Ae.primitiveOffset*be*2,te):F?pe.drawElements(i,Ae.primitiveLength*be,pe.UNSIGNED_SHORT,Ae.primitiveOffset*be*2):pe.drawArrays(i,Ae.vertexOffset,Ae.vertexLength);i===pe.TRIANGLES&&F&&this._drawDebugWireframe(t,d,m,v,F,Ae,j,Z,Q,te)}}}function Jo(h,t){const i=Math.pow(2,t.tileID.overscaledZ),d=t.tileSize*Math.pow(2,h.transform.tileZoom)/i,m=d*(t.tileID.canonical.x+t.tileID.wrap*i),v=d*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/a.at(t,1,h.transform.tileZoom),u_pixel_coord_upper:[m>>16,v>>16],u_pixel_coord_lower:[65535&m,65535&v]}}const Xu={terrain:0,flat:1},Mf=a.ad.mat4.create(),Rf=(h,t,i,d,m,v,w,R,N,P,F,V,j,Z,Q,K,te,re)=>{const pe=t.style.light,be=pe.properties.get("position"),ye=[be.x,be.y,be.z],Ae=a.ad.mat3.create();pe.properties.get("anchor")==="viewport"&&(a.ad.mat3.fromRotation(Ae,-t.transform.angle),a.ad.vec3.transformMat3(ye,ye,Ae));const ve=pe.properties.get("color"),Se=t.transform,Te={u_matrix:h,u_lightpos:ye,u_lightintensity:pe.properties.get("intensity"),u_lightcolor:[ve.r,ve.g,ve.b],u_vertical_gradient:+i,u_opacity:d,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Mf,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Xu[P],u_base_type:Xu[F],u_ao:m,u_edge_radius:v,u_width_scale:w,u_flood_light_color:Q,u_vertical_scale:K,u_flood_light_intensity:te,u_ground_shadow_factor:re};return Se.projection.name==="globe"&&(Te.u_tile_id=[R.canonical.x,R.canonical.y,1<<R.canonical.z],Te.u_zoom_transition=V,Te.u_inv_rot_matrix=Z,Te.u_merc_center=j,Te.u_up_dir=Se.projection.upVector(new a.bT(0,0,0),j[0]*a.ai,j[1]*a.ai),Te.u_height_lift=N),Te},Jc=(h,t,i,d,m,v)=>({u_matrix:h,u_edge_radius:t,u_width_scale:i,u_vertical_scale:d,u_height_type:Xu[m],u_base_type:Xu[v]}),Jd=(h,t,i,d,m,v,w,R,N,P,F,V,j,Z,Q,K,te)=>{const re=Rf(h,t,i,d,m,v,w,R,P,F,V,j,Z,Q,K,te,1,[0,0,0]),pe={u_height_factor:-Math.pow(2,R.overscaledZ)/N.tileSize/8};return a.l(re,Jo(t,N),pe)},Qc=(h,t)=>({u_matrix:h,u_emissive_strength:t}),Qd=(h,t,i,d)=>a.l(Qc(h,t),Jo(i,d)),eh=(h,t,i)=>({u_matrix:h,u_world:i,u_emissive_strength:t}),Ku=(h,t,i,d,m)=>a.l(Qd(h,t,i,d),{u_world:m}),Ju=(h,t,i,d,m)=>({u_matrix:h,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:i,u_height_scale:d,u_reset_depth:m}),Bg=(h,t,i,d)=>{const m=a.ai/i.tileSize;return{u_matrix:h,u_camera_to_center_distance:t.getCameraToCenterDistance(d),u_extrude_scale:[t.pixelsToGLUnits[0]/m,t.pixelsToGLUnits[1]/m]}},Fg=(h,t,i=1)=>({u_matrix:h,u_color:t.toRenderColor(null),u_overlay:0,u_overlay_scale:i}),eu=a.ad.mat4.create(),kf=(h,t,i,d,m,v,w)=>{const R=h.transform,N=R.projection.name==="globe",P=N?a.cO(R.zoom,t.canonical)*R._pixelsPerMercatorPixel:a.at(i,1,v),F={u_matrix:t.projMatrix,u_extrude_scale:P,u_intensity:w,u_inv_rot_matrix:eu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(N){F.u_inv_rot_matrix=d,F.u_merc_center=m,F.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],F.u_zoom_transition=a.ag(R.zoom);const V=m[0]*a.ai,j=m[1]*a.ai;F.u_up_dir=R.projection.upVector(new a.bT(0,0,0),V,j)}return F};function nn(h,[t,i,d,m],[v,w]){if(v===w)return[0,0,0,0];const R=255*(h-1)/(h*(w-v));return[t*R,i*R,d*R,m*R]}function Of(h,t,[i,d]){return i===d?0:.5/h+(t-i)*(h-1)/(h*(d-i))}const hm=(h,t,i,d,m,v,w,R,N,P,F,V,j,Z,Q,K,te,re,pe,be,ye)=>({u_matrix:h,u_normalize_matrix:t,u_globe_matrix:i,u_merc_matrix:d,u_grid_matrix:m,u_tl_parent:v,u_scale_parent:P,u_fade_t:F.mix,u_opacity:F.opacity*V.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:V.paint.get("raster-brightness-min"),u_brightness_high:V.paint.get("raster-brightness-max"),u_saturation_factor:a.cP(V.paint.get("raster-saturation")),u_contrast_factor:a.cQ(V.paint.get("raster-contrast")),u_spin_weights:vc(V.paint.get("raster-hue-rotate")),u_perspective_transform:j,u_raster_elevation:Z,u_zoom_transition:w,u_merc_center:R,u_cutoff_params:N,u_colorization_mix:nn(a.cR,K,re),u_colorization_offset:Of(a.cR,te,re),u_color_ramp:Q,u_texture_offset:[be/(pe+2*be),pe/(pe+2*be)],u_texture_res:[pe+2*be,pe+2*be],u_emissive_strength:ye});function vc(h){h*=Math.PI/180;const t=Math.sin(h),i=Math.cos(h);return[(2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3]}const ms=.05,vn=(h,t,i,d,m,v,w,R,N,P,F,V)=>({u_matrix:h,u_normalize_matrix:t,u_globe_matrix:i,u_merc_matrix:d,u_grid_matrix:m,u_tl_parent:v,u_scale_parent:P,u_fade_t:F.mix,u_opacity:F.opacity,u_image0:0,u_image1:1,u_raster_elevation:V,u_zoom_transition:w,u_merc_center:R,u_cutoff_params:N}),fm=(h,t,i,d,m,v,w,R,N,P)=>({u_particle_texture:h,u_particle_texture_side_len:t,u_tile_offset:i,u_velocity:d,u_color_ramp:v,u_velocity_res:m,u_max_speed:w,u_uv_offset:R,u_data_scale:[255*N[0],255*N[1]],u_data_offset:P,u_particle_pos_scale:1.1,u_particle_pos_offset:[ms,ms]}),Qu=(h,t,i,d,m,v,w,R,N,P)=>({u_particle_texture:h,u_particle_texture_side_len:t,u_velocity:i,u_velocity_res:d,u_max_speed:m,u_speed_factor:v,u_reset_rate:w,u_rand_seed:Math.random(),u_uv_offset:R,u_data_scale:[255*N[0],255*N[1]],u_data_offset:P,u_particle_pos_scale:1.1,u_particle_pos_offset:[ms,ms]}),pm=a.ad.mat4.create(),th=(h,t,i,d,m,v,w,R,N,P,F,V,j,Z,Q,K,te,re,pe,be,ye,Ae)=>{const ve=m.transform,Se={u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:ve.getCameraToCenterDistance(pe),u_rotate_symbol:+i,u_aspect_ratio:ve.width/ve.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:w,u_coord_matrix:R,u_is_text:+P,u_elevation_from_sea:N?1:0,u_pitch_with_map:+d,u_texsize:F,u_texsize_icon:V,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:pm,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:pm,u_up_vector:[0,-1,0],u_color_adj_mat:be,u_icon_transition:ye||0,u_gamma_scale:d?m.transform.getCameraToCenterDistance(pe)*Math.cos(m.terrain?0:m.transform._pitch):1,u_device_pixel_ratio:a.q.devicePixelRatio,u_is_halo:1,u_scale_factor:Ae||1};return pe.name==="globe"&&(Se.u_tile_id=[Z.canonical.x,Z.canonical.y,1<<Z.canonical.z],Se.u_zoom_transition=Q,Se.u_inv_rot_matrix=te,Se.u_merc_center=K,Se.u_camera_forward=ve._camera.forward(),Se.u_ecef_origin=a.cS(ve.globeMatrix,Z.toUnwrapped()),Se.u_tile_matrix=Float32Array.from(ve.globeMatrix),Se.u_up_vector=re),Se},Ug=(h,t,i,d)=>({u_matrix:h,u_emissive_strength:t,u_opacity:i,u_color:d}),Ny=(h,t,i,d,m,v,w,R,N)=>a.l(function(P,F,V,j,Z,Q){const{width:K,height:te}=j.imageManager.getPixelSize(F),re=Math.pow(2,Q.tileID.overscaledZ),pe=Q.tileSize*Math.pow(2,j.transform.tileZoom)/re,be=pe*(Q.tileID.canonical.x+Q.tileID.wrap*re),ye=pe*Q.tileID.canonical.y;return{u_image:0,u_pattern_tl:V.tl,u_pattern_br:V.br,u_texsize:[K,te],u_pattern_size:V.displaySize,u_pattern_units_to_pixels:Z?[j.transform.width,-1*j.transform.height]:[1/a.at(Q,1,j.transform.tileZoom),1/a.at(Q,1,j.transform.tileZoom)],u_pixel_coord_upper:[be>>16,ye>>16],u_pixel_coord_lower:[65535&be,65535&ye]}}(0,v,w,d,R,N),{u_matrix:h,u_emissive_strength:t,u_opacity:i}),If=new Float32Array(a.ad.mat4.identity([])),ed=(h,t,i,d,m,v,w,R,N,P,F,V,j,Z=[0,0,0],Q)=>{const K=m.style.light,te=K.properties.get("position"),re=[-te.x,-te.y,te.z],pe=a.ad.mat3.create();K.properties.get("anchor")==="viewport"&&(a.ad.mat3.fromRotation(pe,-m.transform.angle),a.ad.vec3.transformMat3(re,re,pe));const be=F.alphaMode==="MASK",ye=K.properties.get("color").toRenderColor(null),Ae=j.paint.get("model-ambient-occlusion-intensity"),ve=j.paint.get("model-color").constantOr(a.al.white).toRenderColor(null),Se=j.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:h,u_lighting_matrix:t,u_normal_matrix:i,u_node_matrix:d||If,u_lightpos:re,u_lightintensity:K.properties.get("intensity"),u_lightcolor:[ye.r,ye.g,ye.b],u_camera_pos:Z,u_opacity:v,u_baseTextureIsAlpha:0,u_alphaMask:+be,u_alphaCutoff:F.alphaCutoff,u_baseColorFactor:[w.r,w.g,w.b,w.a],u_emissiveFactor:[R[0],R[1],R[2],1],u_metallicFactor:N,u_roughnessFactor:P,u_baseColorTexture:mi.BaseColor,u_metallicRoughnessTexture:mi.MetallicRoughness,u_normalTexture:mi.Normal,u_occlusionTexture:mi.Occlusion,u_emissionTexture:mi.Emission,u_lutTexture:mi.LUT,u_color_mix:[ve.r,ve.g,ve.b,Se],u_aoIntensity:Ae,u_emissive_strength:V,u_occlusionTextureTransform:Q||[0,0,0,0]}},mm=(h,t=If,i=If)=>({u_matrix:h,u_instance:t,u_node_matrix:i}),nh={fillExtrusion:h=>({u_matrix:new a.bJ(h),u_lightpos:new a.bL(h),u_lightintensity:new a.bM(h),u_lightcolor:new a.bL(h),u_vertical_gradient:new a.bM(h),u_opacity:new a.bM(h),u_edge_radius:new a.bM(h),u_width_scale:new a.bM(h),u_ao:new a.bK(h),u_height_type:new a.bN(h),u_base_type:new a.bN(h),u_tile_id:new a.bL(h),u_zoom_transition:new a.bM(h),u_inv_rot_matrix:new a.bJ(h),u_merc_center:new a.bK(h),u_up_dir:new a.bL(h),u_height_lift:new a.bM(h),u_flood_light_color:new a.bL(h),u_vertical_scale:new a.bM(h),u_flood_light_intensity:new a.bM(h),u_ground_shadow_factor:new a.bL(h)}),fillExtrusionDepth:h=>({u_matrix:new a.bJ(h),u_edge_radius:new a.bM(h),u_width_scale:new a.bM(h),u_vertical_scale:new a.bM(h),u_height_type:new a.bN(h),u_base_type:new a.bN(h)}),fillExtrusionPattern:h=>({u_matrix:new a.bJ(h),u_lightpos:new a.bL(h),u_lightintensity:new a.bM(h),u_lightcolor:new a.bL(h),u_vertical_gradient:new a.bM(h),u_height_factor:new a.bM(h),u_edge_radius:new a.bM(h),u_width_scale:new a.bM(h),u_ao:new a.bK(h),u_height_type:new a.bN(h),u_base_type:new a.bN(h),u_tile_id:new a.bL(h),u_zoom_transition:new a.bM(h),u_inv_rot_matrix:new a.bJ(h),u_merc_center:new a.bK(h),u_up_dir:new a.bL(h),u_height_lift:new a.bM(h),u_image:new a.bN(h),u_texsize:new a.bK(h),u_pixel_coord_upper:new a.bK(h),u_pixel_coord_lower:new a.bK(h),u_tile_units_to_pixels:new a.bM(h),u_opacity:new a.bM(h)}),fillExtrusionGroundEffect:h=>({u_matrix:new a.bJ(h),u_opacity:new a.bM(h),u_ao_pass:new a.bM(h),u_meter_to_tile:new a.bM(h),u_ao:new a.bK(h),u_flood_light_intensity:new a.bM(h),u_flood_light_color:new a.bL(h),u_attenuation:new a.bM(h),u_edge_radius:new a.bM(h),u_fb:new a.bN(h),u_fb_size:new a.bM(h),u_dynamic_offset:new a.bM(h)}),fill:h=>({u_matrix:new a.bJ(h),u_emissive_strength:new a.bM(h)}),fillPattern:h=>({u_matrix:new a.bJ(h),u_emissive_strength:new a.bM(h),u_image:new a.bN(h),u_texsize:new a.bK(h),u_pixel_coord_upper:new a.bK(h),u_pixel_coord_lower:new a.bK(h),u_tile_units_to_pixels:new a.bM(h)}),fillOutline:h=>({u_matrix:new a.bJ(h),u_emissive_strength:new a.bM(h),u_world:new a.bK(h)}),fillOutlinePattern:h=>({u_matrix:new a.bJ(h),u_emissive_strength:new a.bM(h),u_world:new a.bK(h),u_image:new a.bN(h),u_texsize:new a.bK(h),u_pixel_coord_upper:new a.bK(h),u_pixel_coord_lower:new a.bK(h),u_tile_units_to_pixels:new a.bM(h)}),elevatedStructures:h=>({u_matrix:new a.bJ(h)}),elevatedStructuresDepthReconstruct:h=>({u_matrix:new a.bJ(h),u_camera_pos:new a.bL(h),u_depth_bias:new a.bM(h),u_height_scale:new a.bM(h),u_reset_depth:new a.bM(h)}),circle:a.cT,collisionBox:h=>({u_matrix:new a.bJ(h),u_camera_to_center_distance:new a.bM(h),u_extrude_scale:new a.bK(h)}),collisionCircle:h=>({u_matrix:new a.bJ(h),u_inv_matrix:new a.bJ(h),u_camera_to_center_distance:new a.bM(h),u_viewport_size:new a.bK(h)}),debug:h=>({u_color:new a.cA(h),u_matrix:new a.bJ(h),u_overlay:new a.bN(h),u_overlay_scale:new a.bM(h)}),clippingMask:h=>({u_matrix:new a.bJ(h)}),heatmap:h=>({u_extrude_scale:new a.bM(h),u_intensity:new a.bM(h),u_matrix:new a.bJ(h),u_inv_rot_matrix:new a.bJ(h),u_merc_center:new a.bK(h),u_tile_id:new a.bL(h),u_zoom_transition:new a.bM(h),u_up_dir:new a.bL(h)}),heatmapTexture:h=>({u_image:new a.bN(h),u_color_ramp:new a.bN(h),u_opacity:new a.bM(h)}),hillshade:h=>({u_matrix:new a.bJ(h),u_image:new a.bN(h),u_latrange:new a.bK(h),u_light:new a.bK(h),u_shadow:new a.cA(h),u_highlight:new a.cA(h),u_emissive_strength:new a.bM(h),u_accent:new a.cA(h)}),hillshadePrepare:h=>({u_matrix:new a.bJ(h),u_image:new a.bN(h),u_dimension:new a.bK(h),u_zoom:new a.bM(h)}),line:a.cU,linePattern:a.cV,raster:h=>({u_matrix:new a.bJ(h),u_normalize_matrix:new a.bJ(h),u_globe_matrix:new a.bJ(h),u_merc_matrix:new a.bJ(h),u_grid_matrix:new a.cB(h),u_tl_parent:new a.bK(h),u_scale_parent:new a.bM(h),u_fade_t:new a.bM(h),u_opacity:new a.bM(h),u_image0:new a.bN(h),u_image1:new a.bN(h),u_brightness_low:new a.bM(h),u_brightness_high:new a.bM(h),u_saturation_factor:new a.bM(h),u_contrast_factor:new a.bM(h),u_spin_weights:new a.bL(h),u_perspective_transform:new a.bK(h),u_raster_elevation:new a.bM(h),u_zoom_transition:new a.bM(h),u_merc_center:new a.bK(h),u_cutoff_params:new a.cb(h),u_colorization_mix:new a.cb(h),u_colorization_offset:new a.bM(h),u_color_ramp:new a.bN(h),u_texture_offset:new a.bK(h),u_texture_res:new a.bK(h),u_emissive_strength:new a.bM(h)}),rasterParticle:h=>({u_matrix:new a.bJ(h),u_normalize_matrix:new a.bJ(h),u_globe_matrix:new a.bJ(h),u_merc_matrix:new a.bJ(h),u_grid_matrix:new a.cB(h),u_tl_parent:new a.bK(h),u_scale_parent:new a.bM(h),u_fade_t:new a.bM(h),u_opacity:new a.bM(h),u_image0:new a.bN(h),u_image1:new a.bN(h),u_raster_elevation:new a.bM(h),u_zoom_transition:new a.bM(h),u_merc_center:new a.bK(h),u_cutoff_params:new a.cb(h)}),rasterParticleTexture:h=>({u_texture:new a.bN(h),u_opacity:new a.bM(h)}),rasterParticleDraw:h=>({u_particle_texture:new a.bN(h),u_particle_texture_side_len:new a.bM(h),u_tile_offset:new a.bK(h),u_velocity:new a.bN(h),u_color_ramp:new a.bN(h),u_velocity_res:new a.bK(h),u_max_speed:new a.bM(h),u_uv_offset:new a.bK(h),u_data_scale:new a.bK(h),u_data_offset:new a.bM(h),u_particle_pos_scale:new a.bM(h),u_particle_pos_offset:new a.bK(h)}),rasterParticleUpdate:h=>({u_particle_texture:new a.bN(h),u_particle_texture_side_len:new a.bM(h),u_velocity:new a.bN(h),u_velocity_res:new a.bK(h),u_max_speed:new a.bM(h),u_speed_factor:new a.bM(h),u_reset_rate:new a.bM(h),u_rand_seed:new a.bM(h),u_uv_offset:new a.bK(h),u_data_scale:new a.bK(h),u_data_offset:new a.bM(h),u_particle_pos_scale:new a.bM(h),u_particle_pos_offset:new a.bK(h)}),symbol:h=>({u_is_size_zoom_constant:new a.bN(h),u_is_size_feature_constant:new a.bN(h),u_size_t:new a.bM(h),u_size:new a.bM(h),u_camera_to_center_distance:new a.bM(h),u_rotate_symbol:new a.bN(h),u_aspect_ratio:new a.bM(h),u_fade_change:new a.bM(h),u_matrix:new a.bJ(h),u_label_plane_matrix:new a.bJ(h),u_coord_matrix:new a.bJ(h),u_is_text:new a.bN(h),u_elevation_from_sea:new a.bN(h),u_pitch_with_map:new a.bN(h),u_texsize:new a.bK(h),u_texsize_icon:new a.bK(h),u_texture:new a.bN(h),u_texture_icon:new a.bN(h),u_gamma_scale:new a.bM(h),u_device_pixel_ratio:new a.bM(h),u_tile_id:new a.bL(h),u_zoom_transition:new a.bM(h),u_inv_rot_matrix:new a.bJ(h),u_merc_center:new a.bK(h),u_camera_forward:new a.bL(h),u_tile_matrix:new a.bJ(h),u_up_vector:new a.bL(h),u_ecef_origin:new a.bL(h),u_is_halo:new a.bN(h),u_icon_transition:new a.bM(h),u_color_adj_mat:new a.bJ(h),u_scale_factor:new a.bM(h)}),background:h=>({u_matrix:new a.bJ(h),u_emissive_strength:new a.bM(h),u_opacity:new a.bM(h),u_color:new a.cA(h)}),backgroundPattern:h=>({u_matrix:new a.bJ(h),u_emissive_strength:new a.bM(h),u_opacity:new a.bM(h),u_image:new a.bN(h),u_pattern_tl:new a.bK(h),u_pattern_br:new a.bK(h),u_texsize:new a.bK(h),u_pattern_size:new a.bK(h),u_pixel_coord_upper:new a.bK(h),u_pixel_coord_lower:new a.bK(h),u_pattern_units_to_pixels:new a.bK(h)}),terrainRaster:h=>({u_matrix:new a.bJ(h),u_image0:new a.bN(h),u_skirt_height:new a.bM(h),u_ground_shadow_factor:new a.bL(h)}),skybox:h=>({u_matrix:new a.bJ(h),u_sun_direction:new a.bL(h),u_cubemap:new a.bN(h),u_opacity:new a.bM(h),u_temporal_offset:new a.bM(h)}),skyboxGradient:h=>({u_matrix:new a.bJ(h),u_color_ramp:new a.bN(h),u_center_direction:new a.bL(h),u_radius:new a.bM(h),u_opacity:new a.bM(h),u_temporal_offset:new a.bM(h)}),skyboxCapture:h=>({u_matrix_3f:new a.cB(h),u_sun_direction:new a.bL(h),u_sun_intensity:new a.bM(h),u_color_tint_r:new a.cb(h),u_color_tint_m:new a.cb(h),u_luminance:new a.bM(h)}),globeRaster:h=>({u_proj_matrix:new a.bJ(h),u_globe_matrix:new a.bJ(h),u_normalize_matrix:new a.bJ(h),u_merc_matrix:new a.bJ(h),u_zoom_transition:new a.bM(h),u_merc_center:new a.bK(h),u_image0:new a.bN(h),u_grid_matrix:new a.cB(h),u_skirt_height:new a.bM(h),u_far_z_cutoff:new a.bM(h),u_frustum_tl:new a.bL(h),u_frustum_tr:new a.bL(h),u_frustum_br:new a.bL(h),u_frustum_bl:new a.bL(h),u_globe_pos:new a.bL(h),u_globe_radius:new a.bM(h),u_viewport:new a.bK(h)}),globeAtmosphere:h=>({u_frustum_tl:new a.bL(h),u_frustum_tr:new a.bL(h),u_frustum_br:new a.bL(h),u_frustum_bl:new a.bL(h),u_horizon:new a.bM(h),u_transition:new a.bM(h),u_fadeout_range:new a.bM(h),u_color:new a.cb(h),u_high_color:new a.cb(h),u_space_color:new a.cb(h),u_temporal_offset:new a.bM(h),u_horizon_angle:new a.bM(h)}),model:h=>({u_matrix:new a.bJ(h),u_lighting_matrix:new a.bJ(h),u_normal_matrix:new a.bJ(h),u_node_matrix:new a.bJ(h),u_lightpos:new a.bL(h),u_lightintensity:new a.bM(h),u_lightcolor:new a.bL(h),u_camera_pos:new a.bL(h),u_opacity:new a.bM(h),u_baseColorFactor:new a.cb(h),u_emissiveFactor:new a.cb(h),u_metallicFactor:new a.bM(h),u_roughnessFactor:new a.bM(h),u_baseTextureIsAlpha:new a.bN(h),u_alphaMask:new a.bN(h),u_alphaCutoff:new a.bM(h),u_baseColorTexture:new a.bN(h),u_metallicRoughnessTexture:new a.bN(h),u_normalTexture:new a.bN(h),u_occlusionTexture:new a.bN(h),u_emissionTexture:new a.bN(h),u_lutTexture:new a.bN(h),u_color_mix:new a.cb(h),u_aoIntensity:new a.bM(h),u_emissive_strength:new a.bM(h),u_occlusionTextureTransform:new a.cb(h)}),modelDepth:h=>({u_matrix:new a.bJ(h),u_instance:new a.bJ(h),u_node_matrix:new a.bJ(h)}),groundShadow:h=>({u_matrix:new a.bJ(h),u_ground_shadow_factor:new a.bL(h)}),stars:h=>({u_matrix:new a.bJ(h),u_up:new a.bL(h),u_right:new a.bL(h),u_intensity_multiplier:new a.bM(h)}),snowParticle:h=>({u_modelview:new a.bJ(h),u_projection:new a.bJ(h),u_time:new a.bM(h),u_cam_pos:new a.bL(h),u_velocityConeAperture:new a.bM(h),u_velocity:new a.bM(h),u_horizontalOscillationRadius:new a.bM(h),u_horizontalOscillationRate:new a.bM(h),u_boxSize:new a.bM(h),u_billboardSize:new a.bM(h),u_simpleShapeParameters:new a.bK(h),u_screenSize:new a.bK(h),u_thinningCenterPos:new a.bK(h),u_thinningShape:new a.bL(h),u_thinningAffectedRatio:new a.bM(h),u_thinningParticleOffset:new a.bM(h),u_particleColor:new a.cb(h),u_direction:new a.bL(h)}),rainParticle:h=>({u_modelview:new a.bJ(h),u_projection:new a.bJ(h),u_time:new a.bM(h),u_cam_pos:new a.bL(h),u_texScreen:new a.bN(h),u_velocityConeAperture:new a.bM(h),u_velocity:new a.bM(h),u_boxSize:new a.bM(h),u_rainDropletSize:new a.bK(h),u_distortionStrength:new a.bM(h),u_rainDirection:new a.bL(h),u_color:new a.cb(h),u_screenSize:new a.bK(h),u_thinningCenterPos:new a.bK(h),u_thinningShape:new a.bL(h),u_thinningAffectedRatio:new a.bM(h),u_thinningParticleOffset:new a.bM(h),u_shapeDirectionalPower:new a.bM(h),u_shapeNormalPower:new a.bM(h),u_mode:new a.bM(h)}),vignette:h=>({u_vignetteShape:new a.bL(h),u_vignetteColor:new a.cb(h)}),occlusion:h=>({u_matrix:new a.bJ(h),u_anchorPos:new a.bL(h),u_screenSizePx:new a.bK(h),u_occluderSizePx:new a.bK(h),u_color:new a.cb(h)})};class nl{constructor(t,i,d,m){this.id=nl.uniqueIdxCounter,nl.uniqueIdxCounter++,this.context=t;const v=t.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||m||i.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=nl.uniqueIdxCounter,nl.uniqueIdxCounter++;const i=this.context.gl;this.context.unbindVAO(),this.bind(),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}nl.uniqueIdxCounter=0;const gm={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class yo{constructor(t,i,d,m,v,w){this.length=i.length,this.attributes=d,this.itemSize=i.bytesPerElement,this.dynamicDraw=m,this.instanceCount=w,this.context=t;const R=t.gl;this.buffer=R.createBuffer(),t.bindVertexBuffer.set(this.buffer),R.bufferData(R.ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?R.DYNAMIC_DRAW:R.STATIC_DRAW),this.dynamicDraw||v||i.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const i=this.context.gl;this.bind(),i.bufferSubData(i.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,i){for(let d=0;d<this.attributes.length;d++){const m=i.attributes[this.attributes[d].name];m!==void 0&&t.enableVertexAttribArray(m)}}setVertexAttribPointers(t,i,d){for(let m=0;m<this.attributes.length;m++){const v=this.attributes[m],w=i.attributes[v.name];w!==void 0&&t.vertexAttribPointer(w,v.components,t[gm[v.type]],!1,this.itemSize,v.offset+this.itemSize*(d||0))}}setVertexAttribDivisor(t,i,d){for(let m=0;m<this.attributes.length;m++){const v=i.attributes[this.attributes[m].name];v!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(v,d)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class No{constructor(t,i,d,m,v){this.context=t,this.width=i,this.height=d;const w=this.framebuffer=t.gl.createFramebuffer();m&&(this.colorAttachment=new Tf(t,w)),v&&(this.depthAttachmentType=v,this.depthAttachment=v==="renderbuffer"?new Ef(t,w):new Zu(t,w))}destroy(){const t=this.context.gl;if(this.colorAttachment){const i=this.colorAttachment.get();i&&t.deleteTexture(i)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const i=this.depthAttachment.get();i&&t.deleteRenderbuffer(i)}else{const i=this.depthAttachment.get();i&&t.deleteTexture(i)}t.deleteFramebuffer(this.framebuffer)}}class rl{constructor(t,i){this.gl=t,this.clearColor=new qr(this),this.clearDepth=new gn(this),this.clearStencil=new Yc(this),this.colorMask=new Xd(this),this.depthMask=new Gi(this),this.stencilMask=new rm(this),this.stencilFunc=new im(this),this.stencilOp=new Dy(this),this.stencilTest=new Hu(this),this.depthRange=new xf(this),this.depthTest=new om(this),this.depthFunc=new ps(this),this.blend=new bf(this),this.blendFunc=new qo(this),this.blendColor=new ai(this),this.blendEquation=new wf(this),this.cullFace=new Gu(this),this.cullFaceSide=new Il(this),this.frontFace=new Nl(this),this.program=new da(this),this.activeTexture=new Sf(this),this.viewport=new _c(this),this.bindFramebuffer=new sm(this),this.bindRenderbuffer=new Kd(this),this.bindTexture=new Wc(this),this.bindVertexBuffer=new am(this),this.bindElementBuffer=new My(this),this.bindVertexArrayOES=new Ry(this),this.pixelStoreUnpack=new ky(this),this.pixelStoreUnpackPremultiplyAlpha=new Oy(this),this.pixelStoreUnpackFlipY=new Iy(this),this.options=i?Object.assign({},i):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=i&&!!i.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,i,d){return new nl(this,t,i,d)}createVertexBuffer(t,i,d,m,v){return new yo(this,t,i,d,m,v)}createRenderbuffer(t,i,d){const m=this.gl,v=m.createRenderbuffer();return this.bindRenderbuffer.set(v),m.renderbufferStorage(m.RENDERBUFFER,t,i,d),this.bindRenderbuffer.set(null),v}createFramebuffer(t,i,d,m){return new No(this,t,i,d,m)}clear({color:t,depth:i,stencil:d,colorMask:m}){const v=this.gl;let w=0;t&&(w|=v.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(m||[!0,!0,!0,!0])),i!==void 0&&(w|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),d!==void 0&&(w|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),v.clear(w)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){a.bn(t.blendFunction,Xn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let xc;function td(h,t,i,d,m,v,w){const R=h.context,N=R.gl,P=h.transform,F=h.getOrCreateProgram("collisionBox"),V=[];let j=0,Z=0;for(let ye=0;ye<d.length;ye++){const Ae=d[ye],ve=t.getTile(Ae),Se=ve.getBucket(i);if(!Se)continue;const Te=$p(Ae,Se,P);let Me=Te;m[0]===0&&m[1]===0||(Me=h.translatePosMatrix(Te,ve,m,v));const ze=w?Se.textCollisionBox:Se.iconCollisionBox,ot=Se.collisionCircleArray;if(ot.length>0){const Xe=a.ad.mat4.create(),ft=Me;a.ad.mat4.mul(Xe,Se.placementInvProjMatrix,P.glCoordMatrix),a.ad.mat4.mul(Xe,Xe,Se.placementViewportMatrix),V.push({circleArray:ot,circleOffset:Z,transform:ft,invTransform:Xe,projection:Se.getProjection()}),j+=ot.length/4,Z=j}ze&&(h.terrain&&h.terrain.setupElevationDraw(ve,F),F.draw(h,N.LINES,_n.disabled,Bn.disabled,h.colorModeForRenderPass(),Dn.disabled,Bg(Me,P,ve,Se.getProjection()),i.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,null,P.zoom,null,[ze.collisionVertexBuffer,ze.collisionVertexBufferExt]))}if(!w||!V.length)return;const Q=h.getOrCreateProgram("collisionCircle"),K=new a.cW;K.resize(4*j),K._trim();let te=0;for(const ye of V)for(let Ae=0;Ae<ye.circleArray.length/4;Ae++){const ve=4*Ae,Se=ye.circleArray[ve+0],Te=ye.circleArray[ve+1],Me=ye.circleArray[ve+2],ze=ye.circleArray[ve+3];K.emplace(te++,Se,Te,Me,ze,0),K.emplace(te++,Se,Te,Me,ze,1),K.emplace(te++,Se,Te,Me,ze,2),K.emplace(te++,Se,Te,Me,ze,3)}(!xc||xc.length<2*j)&&(xc=function(ye){const Ae=2*ye,ve=new a.aV;ve.resize(Ae),ve._trim();for(let Se=0;Se<Ae;Se++){const Te=6*Se;ve.uint16[Te+0]=4*Se+0,ve.uint16[Te+1]=4*Se+1,ve.uint16[Te+2]=4*Se+2,ve.uint16[Te+3]=4*Se+2,ve.uint16[Te+4]=4*Se+3,ve.uint16[Te+5]=4*Se+0}return ve}(j));const re=R.createIndexBuffer(xc,!0),pe=R.createVertexBuffer(K,a.cX.members,!0);for(const ye of V){const Ae={u_matrix:ye.transform,u_inv_matrix:ye.invTransform,u_camera_to_center_distance:(be=P).getCameraToCenterDistance(ye.projection),u_viewport_size:[be.width,be.height]};Q.draw(h,N.TRIANGLES,_n.disabled,Bn.disabled,h.colorModeForRenderPass(),Dn.disabled,Ae,i.id,pe,re,a.b8.simpleSegment(0,2*ye.circleOffset,ye.circleArray.length,ye.circleArray.length/2),null,P.zoom)}var be;pe.destroy(),re.destroy()}const bc=a.ad.mat4.create();function nd(h){const t=h._camera.getWorldToCamera(h.worldSize,1),i=a.ad.mat4.multiply([],t,h.globeMatrix);a.ad.mat4.invert(i,i);const d=[0,0,0],m=[0,1,0,0];return a.ad.vec4.transformMat4(m,m,i),d[0]=m[0],d[1]=m[1],d[2]=m[2],a.ad.vec3.normalize(d,d),d}function jg({width:h,height:t,anchor:i,textOffset:d,textScale:m},v){const{horizontalAlign:w,verticalAlign:R}=a.bD(i),N=-(w-.5)*h,P=-(R-.5)*t,F=a.bC(i,d);return new a.P((N/m+F[0])*v,(P/m+F[1])*v)}function vo(h,t,i,d,m,v,w,R,N,P,F){const V=h.text.placedSymbolArray,j=h.text.dynamicLayoutVertexArray,Z=h.icon.dynamicLayoutVertexArray,Q={},K=h.getProjection(),te=zs(R,K,v),re=v.elevation,pe=K.upVectorScale(R.canonical,v.center.lat,v.worldSize).metersToTile;j.clear();for(let be=0;be<V.length;be++){const ye=V.get(be),{tileAnchorX:Ae,tileAnchorY:ve,numGlyphs:Se}=ye,Te=ye.hidden||!ye.crossTileID||h.allowVerticalPlacement&&!ye.placedOrientation?null:d[ye.crossTileID];if(Te){let Me=0,ze=0,ot=0;if(re){const lt=re?re.getAtTileOffset(R,Ae,ve):0,[yt,st,dt]=K.upVector(R.canonical,Ae,ve);Me=lt*yt*pe,ze=lt*st*pe,ot=lt*dt*pe}let[Xe,ft,gt,Mt]=qa(ye.projectedAnchorX+Me,ye.projectedAnchorY+ze,ye.projectedAnchorZ+ot,i?te:w);const He=Ou(v.getCameraToCenterDistance(K),Mt);let mt=m.evaluateSizeForFeature(h.textSizeData,P,ye)*He/a.bw;i&&(mt*=h.tilePixelRatio/N);const qe=jg(Te,mt);i?({x:Xe,y:ft,z:gt}=K.projectTilePoint(Ae+qe.x,ve+qe.y,R.canonical),[Xe,ft,gt]=qa(Xe+Me,ft+ze,gt+ot,w)):(t&&qe._rotate(-v.angle),Xe+=qe.x,ft+=qe.y,gt=0);const pt=h.allowVerticalPlacement&&ye.placedOrientation===a.bq.vertical?Math.PI/2:0;for(let lt=0;lt<Se;lt++)a.bt(j,Xe,ft,gt,pt);F&&ye.associatedIconIndex>=0&&(Q[ye.associatedIconIndex]={x:Xe,y:ft,z:gt,angle:pt})}else Ga(Se,j)}if(F){Z.clear();const be=h.icon.placedSymbolArray;for(let ye=0;ye<be.length;ye++){const Ae=be.get(ye),{numGlyphs:ve}=Ae,Se=Q[ye];if(Ae.hidden||!Se)Ga(ve,Z);else{const{x:Te,y:Me,z:ze,angle:ot}=Se;for(let Xe=0;Xe<ve;Xe++)a.bt(Z,Te,Me,ze,ot)}}h.icon.dynamicLayoutVertexBuffer.updateData(Z)}h.text.dynamicLayoutVertexBuffer.updateData(j)}function Hr(h,t,i,d,m,v,w={}){const R=i.paint.get("icon-translate"),N=i.paint.get("text-translate"),P=i.paint.get("icon-translate-anchor"),F=i.paint.get("text-translate-anchor"),V=i.layout.get("icon-rotation-alignment"),j=i.layout.get("text-rotation-alignment"),Z=i.layout.get("icon-pitch-alignment"),Q=i.layout.get("text-pitch-alignment"),K=i.layout.get("icon-keep-upright"),te=i.layout.get("text-keep-upright"),re=i.paint.get("icon-color-saturation"),pe=i.paint.get("icon-color-contrast"),be=i.paint.get("icon-color-brightness-min"),ye=i.paint.get("icon-color-brightness-max"),Ae=i.layout.get("symbol-elevation-reference")==="sea",ve=h.context,Se=ve.gl,Te=h.transform,Me=V==="map",ze=j==="map",ot=Z==="map",Xe=Q==="map",ft=i.layout.get("symbol-sort-key").constantOr(1)!==void 0;let gt=!1;const Mt=h.depthModeForSublayer(0,_n.ReadOnly),He=[a.av(Te.center.lng),a.aC(Te.center.lat)],mt=i.layout.get("text-variable-anchor"),qe=Te.projection.name==="globe",pt=[],lt=[0,-1,0];for(const yt of d){const st=t.getTile(yt),dt=st.getBucket(i);if(!dt||dt.projection.name==="mercator"&&qe||dt.fullyClipped)continue;const Ht=dt.projection.name==="globe",kt=Ht?a.ag(Te.zoom):0,Wt=zs(yt,dt.getProjection(),Te),hn=Te.calculatePixelsToTileUnitsMatrix(st),In=mt&&dt.hasTextData(),bn=dt.hasIconTextFit()&&In&&dt.hasIconData(),Tn=dt.getProjection().createInversionMatrix(Te,yt.canonical),Mn=Dr=>{Te.depthOcclusionForSymbolsAndCircles&&(i.hasInitialOcclusionOpacityProperties||h.terrain)&&(Dr.push("DEPTH_D24"),Dr.push("DEPTH_OCCLUSION"))},tr=()=>{const Dr=Me&&i.layout.get("symbol-placement")!=="point",vr=[];Mn(vr);const Di=Dr||bn,Bi=i.paint.get("icon-image-cross-fade").constantOr(0);h.terrainRenderModeElevated()&&ot&&vr.push("PITCH_WITH_MAP_TERRAIN"),Ht&&(vr.push("PROJECTION_GLOBE_VIEW"),Di&&vr.push("PROJECTED_POS_ON_VIEWPORT")),Bi>0&&vr.push("ICON_TRANSITION"),dt.icon.zOffsetVertexBuffer&&vr.push("Z_OFFSET"),re===0&&pe===0&&be===0&&ye===1||vr.push("COLOR_ADJUSTMENT"),dt.sdfIcons&&vr.push("RENDER_SDF");const Ji=dt.icon.programConfigurations.get(i.id),Qi=h.getOrCreateProgram("symbol",{config:Ji,defines:vr}),ma=st.imageAtlasTexture?st.imageAtlasTexture.size:[0,0],Fi=dt.iconSizeData,fr=a.bp(Fi,Te.zoom),ui=ot||Te.pitch!==0,xr=Sl(Wt,st.tileID.canonical,ot,Me,Te,dt.getProjection(),hn),$r=Ii(Wt,st.tileID.canonical,ot,Me,Te,dt.getProjection(),hn),wo=h.translatePosMatrix($r,st,R,P,!0),ii=h.translatePosMatrix(Wt,st,R,P),eo=Di?bc:xr,Ra=Me&&!ot&&!Dr;let Hs=lt;!qe&&!Te.mercatorFromTransition||Me||(Hs=nd(Te));const ka=Ht?Hs:lt,Yo=i.getColorAdjustmentMatrix(re,pe,be,ye),Oa=th(Fi.kind,fr,Ra,ot,h,ii,eo,wo,Ae,!1,ma,[0,0],!0,yt,kt,He,Tn,ka,dt.getProjection(),Yo,Bi),Pi=st.imageAtlasTexture?st.imageAtlasTexture:null,Fl=i.layout.get("icon-size").constantOr(0)!==1||dt.iconsNeedLinear,cl=dt.sdfIcons||h.options.rotating||h.options.zooming||Fl||ui?Se.LINEAR:Se.NEAREST,Ul=dt.sdfIcons&&i.paint.get("icon-halo-width").constantOr(1)!==0,zm=h.terrain&&ot&&Dr?a.ad.mat4.invert(a.ad.mat4.create(),xr):bc;if(Dr&&dt.icon){const Th=Te.elevation,Pm=Th?Th.getAtTileOffsetFunc(yt,Te.center.lat,Te.worldSize,dt.getProjection()):null,Lm=_o(Wt,st.tileID.canonical,ot,Me,Te,dt.getProjection(),hn);Iu(dt,Wt,h,!1,Lm,$r,ot,K,Pm,yt)}return{program:Qi,buffers:dt.icon,uniformValues:Oa,atlasTexture:Pi,atlasTextureIcon:null,atlasInterpolation:cl,atlasInterpolationIcon:null,isSDF:dt.sdfIcons,hasHalo:Ul,tile:st,labelPlaneMatrixInv:zm}},yr=()=>{const Dr=ze&&i.layout.get("symbol-placement")!=="point",vr=[],Di=Dr||mt||bn;h.terrainRenderModeElevated()&&Xe&&vr.push("PITCH_WITH_MAP_TERRAIN"),Ht&&(vr.push("PROJECTION_GLOBE_VIEW"),Di&&vr.push("PROJECTED_POS_ON_VIEWPORT")),dt.text.zOffsetVertexBuffer&&vr.push("Z_OFFSET"),dt.iconsInText&&vr.push("RENDER_TEXT_AND_SYMBOL"),vr.push("RENDER_SDF"),Mn(vr);const Bi=dt.text.programConfigurations.get(i.id),Ji=h.getOrCreateProgram("symbol",{config:Bi,defines:vr});let Qi,ma=[0,0],Fi=null;const fr=dt.textSizeData;dt.iconsInText&&(ma=st.imageAtlasTexture?st.imageAtlasTexture.size:[0,0],Fi=st.imageAtlasTexture?st.imageAtlasTexture:null,Qi=Xe||Te.pitch!==0||h.options.rotating||h.options.zooming||fr.kind==="composite"||fr.kind==="camera"?Se.LINEAR:Se.NEAREST);const ui=st.glyphAtlasTexture?st.glyphAtlasTexture.size:[0,0],xr=i.layout.get("text-size-scale-range"),$r=a.ay(h.scaleFactor,xr[0],xr[1]),wo=a.bp(fr,Te.zoom,$r),ii=Sl(Wt,st.tileID.canonical,Xe,ze,Te,dt.getProjection(),hn),eo=Ii(Wt,st.tileID.canonical,Xe,ze,Te,dt.getProjection(),hn),Ra=h.translatePosMatrix(eo,st,N,F,!0),Hs=h.translatePosMatrix(Wt,st,N,F),ka=Di?bc:ii,Yo=ze&&!Xe&&!Dr;let Oa=lt;!qe&&!Te.mercatorFromTransition||ze||(Oa=nd(Te));const Pi=th(fr.kind,wo,Yo,Xe,h,Hs,ka,Ra,Ae,!0,ui,ma,!0,yt,kt,He,Tn,Ht?Oa:lt,dt.getProjection(),null,null,$r),Fl=st.glyphAtlasTexture?st.glyphAtlasTexture:null,cl=Se.LINEAR,Ul=i.paint.get("text-halo-width").constantOr(1)!==0,zm=h.terrain&&Xe&&Dr?a.ad.mat4.invert(a.ad.mat4.create(),ii):bc;if(Dr&&dt.text){const Th=Te.elevation,Pm=Th?Th.getAtTileOffsetFunc(yt,Te.center.lat,Te.worldSize,dt.getProjection()):null,Lm=_o(Wt,st.tileID.canonical,Xe,ze,Te,dt.getProjection(),hn);Iu(dt,Wt,h,!0,Lm,eo,Xe,te,Pm,yt)}return{program:Ji,buffers:dt.text,uniformValues:Pi,atlasTexture:Fl,atlasTextureIcon:Fi,atlasInterpolation:cl,atlasInterpolationIcon:Qi,isSDF:!0,hasHalo:Ul,tile:st,labelPlaneMatrixInv:zm}},Gr=dt.icon.segments.get().length,Kn=dt.text.segments.get().length,ci=Gr&&!w.onlyText?tr():null,Pn=Kn&&!w.onlyIcons?yr():null,fn=i.paint.get("icon-opacity").constantOr(1),ar=i.paint.get("text-opacity").constantOr(1);if(ft&&dt.canOverlap){gt=!0;const Dr=fn&&!w.onlyText?dt.icon.segments.get():[],vr=ar&&!w.onlyIcons?dt.text.segments.get():[];for(const Di of Dr)pt.push({segments:new a.b8([Di]),sortKey:Di.sortKey,state:ci});for(const Di of vr)pt.push({segments:new a.b8([Di]),sortKey:Di.sortKey,state:Pn})}else w.onlyText||pt.push({segments:fn?dt.icon.segments:new a.b8([]),sortKey:0,state:ci}),w.onlyIcons||pt.push({segments:ar?dt.text.segments:new a.b8([]),sortKey:0,state:Pn})}gt&&pt.sort((yt,st)=>yt.sortKey-st.sortKey);for(const yt of pt){const st=yt.state;if(st)if(h.terrain?h.terrain.setupElevationDraw(st.tile,st.program,{useDepthForOcclusion:Te.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:st.labelPlaneMatrixInv}):h.setupDepthForOcclusion(Te.depthOcclusionForSymbolsAndCircles,st.program),ve.activeTexture.set(Se.TEXTURE0),st.atlasTexture&&st.atlasTexture.bind(st.atlasInterpolation,Se.CLAMP_TO_EDGE,!0),st.atlasTextureIcon&&(ve.activeTexture.set(Se.TEXTURE1),st.atlasTextureIcon&&st.atlasTextureIcon.bind(st.atlasInterpolationIcon,Se.CLAMP_TO_EDGE,!0)),h.uploadCommonLightUniforms(h.context,st.program),st.hasHalo){const dt=st.uniformValues;dt.u_is_halo=1,fa(st.buffers,yt.segments,i,h,st.program,Mt,m,v,dt,2),dt.u_is_halo=0}else{if(st.isSDF){const dt=st.uniformValues;st.hasHalo&&(dt.u_is_halo=1,fa(st.buffers,yt.segments,i,h,st.program,Mt,m,v,dt,1)),dt.u_is_halo=0}fa(st.buffers,yt.segments,i,h,st.program,Mt,m,v,st.uniformValues,1)}}}function fa(h,t,i,d,m,v,w,R,N,P){const F=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.iconTransitioningVertexBuffer,h.globeExtVertexBuffer,h.zOffsetVertexBuffer];m.draw(d,d.context.gl.TRIANGLES,v,w,R,Dn.disabled,N,i.id,h.layoutVertexBuffer,h.indexBuffer,t,i.paint,d.transform.zoom,h.programConfigurations.get(i.id),F,P)}function il(h,t){const i=1<<h.canonical.z,d=(t.x*i-h.canonical.x-h.wrap*i)*a.ai,m=(t.y*i-h.canonical.y)*a.ai,v=a.d5(t.z,t.y);return a.ad.vec3.fromValues(d,m,v)}function rh(h,t,i,d,m){if(!i.layout||i.layout.get("fill-elevation-reference")==="none")return;const v=h.context.gl,w=new _n(h.context.gl.LEQUAL,_n.ReadWrite,h.depthRangeFor3D),R=new _n(h.context.gl.GREATER,_n.ReadWrite,h.depthRangeFor3D),N=function(Z){const Q=a.c4(Z.pitch);let K=.01;return Z.isOrthographic&&(K=a.ah(1e-4,K,a.c9(Q>=zt?1:Q/zt))),2*K}(h.transform),P=h.transform.getFreeCameraOptions().position,F="elevatedStructuresDepthReconstruct",V=h.getOrCreateProgram(F,{defines:["DEPTH_RECONSTRUCTION"]}),j=h.getOrCreateProgram(F);for(const Z of d){const Q=t.getTile(Z),K=Q.getBucket(i);if(!K)continue;const te=K.elevatedStructures;if(!te)continue;const re=K.elevationBufferData.heightRange,pe=il(Z.toUnwrapped(),P),be=h.translatePosMatrix(Z.projMatrix,Q,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor"));let ye,Ae,ve,Se;if(m==="initialize"){if(!re||re.min>=1||te.depthSegments.segments[0].primitiveLength===0)continue;ye=Ju(be,pe,N,1,0),Ae=w,ve=te.depthSegments,Se=V}else if(m==="reset"){if(!re||re.min>=0||te.maskSegments.segments[0].primitiveLength===0)continue;ye=Ju(be,pe,0,0,1),Ae=R,ve=te.maskSegments,Se=V}else if(m==="geometry"){if(te.depthSegments.segments[0].primitiveLength===0)continue;ye=Ju(be,pe,N,1,0),Ae=w,ve=te.depthSegments,Se=j}Se.draw(h,v.TRIANGLES,Ae,Bn.disabled,Xn.disabled,Dn.disabled,ye,i.id,te.vertexBuffer,te.indexBuffer,ve,i.paint,h.transform.zoom)}}function ih(h,t,i){const{painter:d,sourceCache:m,layer:v,coords:w,colorMode:R,elevationType:N,terrainEnabled:P,pass:F}=h,V=d.context.gl,j=v.paint.get("fill-pattern");let Z=N;N!=="road"||t&&!P||(Z="none");const Q=Z==="road",K=new _n(d.context.gl.LEQUAL,_n.ReadWrite,d.depthRangeFor3D),te=j&&j.constantOr(1),re=(pe,be)=>{let ye,Ae,ve,Se,Te;be?(Ae=te&&!v.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ye=V.LINES):(Ae=te?"fillPattern":"fill",ye=V.TRIANGLES);for(const Me of w){const ze=m.getTile(Me);if(te&&!ze.patternsLoaded())continue;const ot=ze.getBucket(v);if(!ot)continue;const Xe=t?ot.elevationBufferData:ot.bufferData;if(Xe.isEmpty())continue;d.prepareDrawTile();const ft=Xe.programConfigurations.get(v.id),gt=d.isTileAffectedByFog(Me),Mt=[],He=[];Q&&(Mt.push("ELEVATED_ROADS"),He.push(Xe.elevatedLayoutVertexBuffer));const mt=d.getOrCreateProgram(Ae,{config:ft,overrideFog:gt,defines:Mt});te&&(d.context.activeTexture.set(V.TEXTURE0),ze.imageAtlasTexture&&ze.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),ft.updatePaintBuffers());const qe=j.constantOr(null);if(qe&&ze.imageAtlas){const yt=ze.imageAtlas,st=a.d0.from(qe).getPrimary().scaleSelf(a.q.devicePixelRatio).toString(),dt=yt.patternPositions.get(st);dt&&ft.setConstantPatternPositions(dt)}const pt=d.translatePosMatrix(Me.projMatrix,ze,v.paint.get("fill-translate"),v.paint.get("fill-translate-anchor")),lt=v.paint.get("fill-emissive-strength");if(be){Se=Xe.lineIndexBuffer,Te=Xe.lineSegments;const yt=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[V.drawingBufferWidth,V.drawingBufferHeight];ve=Ae==="fillOutlinePattern"&&te?Ku(pt,lt,d,ze,yt):eh(pt,lt,yt)}else Se=Xe.indexBuffer,Te=Xe.triangleSegments,ve=te?Qd(pt,lt,d,ze):Qc(pt,lt);d.uploadCommonUniforms(d.context,mt,Me.toUnwrapped()),mt.draw(d,ye,Z!=="none"?K:pe,i||d.stencilModeForClipping(Me),R,Dn.disabled,ve,v.id,Xe.layoutVertexBuffer,Se,Te,v.paint,d.transform.zoom,ft,He)}};d.renderPass===F&&re(d.depthModeForSublayer(1,d.renderPass==="opaque"?_n.ReadWrite:_n.ReadOnly),!1),Z==="none"&&d.renderPass==="translucent"&&v.paint.get("fill-antialias")&&re(d.depthModeForSublayer(v.getPaintProperty("fill-outline-color")?2:0,_n.ReadOnly),!0)}function rd(h,t,i,d,m,v,w,R){i.resetLayerRenderingStats(h);const N=h.context,P=N.gl,F=h.transform,V=i.paint.get("fill-extrusion-pattern"),j=V.constantOr(1),Z=i.paint.get("fill-extrusion-opacity"),Q=h.style.enable3dLights(),K=i.paint.get(Q&&!j?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),te=[i.paint.get("fill-extrusion-ambient-occlusion-intensity"),K],re=i.layout.get("fill-extrusion-edge-radius"),pe=re>0&&!i.paint.get("fill-extrusion-rounded-roof"),be=pe?0:re,ye=F.projection.name==="globe"?a.d6():0,Ae=F.projection.name==="globe",ve=Ae?a.ag(F.zoom):0,Se=[a.av(F.center.lng),a.aC(F.center.lat)],Te=i.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Me=i.paint.get("fill-extrusion-flood-light-color").toRenderColor(Te?null:i.lut).toArray01().slice(0,3),ze=i.paint.get("fill-extrusion-flood-light-intensity"),ot=i.paint.get("fill-extrusion-vertical-scale"),Xe=i.paint.get("fill-extrusion-line-width").constantOr(1)!==0,ft=i.paint.get("fill-extrusion-height-alignment"),gt=i.paint.get("fill-extrusion-base-alignment"),Mt=wa(h,i.paint.get("fill-extrusion-cutoff-fade-range")),He=[];let mt;Ae&&He.push("PROJECTION_GLOBE_VIEW"),te[0]>0&&He.push("FAUX_AO"),pe&&He.push("ZERO_ROOF_RADIUS"),R&&He.push("HAS_CENTROID"),ze>0&&He.push("FLOOD_LIGHT"),Mt.shouldRenderCutoff&&He.push("RENDER_CUTOFF"),Xe&&He.push("RENDER_WALL_MODE");const qe=h.renderPass==="shadow",pt=h.shadowRenderer,lt=qe&&!!pt;h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!0);let yt=[0,0,0];if(pt){const Ht=h.style.directionalLight,kt=h.style.ambientLight;Ht&&kt&&(yt=Sa(h.style,Ht,kt)),qe||(He.push("RENDER_SHADOWS","DEPTH_TEXTURE"),pt.useNormalOffset&&He.push("NORMAL_OFFSET")),mt=He.concat(["SHADOWS_SINGLE_CASCADE"])}const st=lt?"fillExtrusionDepth":j?"fillExtrusionPattern":"fillExtrusion",dt=i.getLayerRenderingStats();for(const Ht of d){const kt=t.getTile(Ht),Wt=kt.getBucket(i);if(!Wt||Wt.projection.name!==F.projection.name)continue;let hn=!1;pt&&(hn=pt.getMaxCascadeForTile(Ht.toUnwrapped())===0);const In=h.isTileAffectedByFog(Ht),bn=Wt.programConfigurations.get(i.id),Tn=h.getOrCreateProgram(st,{config:bn,defines:hn?mt:He,overrideFog:In});if(h.terrain&&h.terrain.setupElevationDraw(kt,Tn,{useMeterToDem:!0}),!Wt.centroidVertexBuffer){const Pn=Tn.attributes.a_centroid_pos;Pn!==void 0&&P.vertexAttrib2f(Pn,0,0)}!qe&&pt&&pt.setupShadows(kt.tileID.toUnwrapped(),Tn,"vector-tile",kt.tileID.overscaledZ),j&&(h.context.activeTexture.set(P.TEXTURE0),kt.imageAtlasTexture&&kt.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),bn.updatePaintBuffers());const Mn=V.constantOr(null);if(Mn&&kt.imageAtlas){const Pn=kt.imageAtlas,fn=a.d0.from(Mn).getPrimary().scaleSelf(a.q.devicePixelRatio),ar=Pn.patternPositions.get(fn.toString());ar&&bn.setConstantPatternPositions(ar)}const tr=i.paint.get("fill-extrusion-vertical-gradient"),yr=1/Wt.tileToMeter;let Gr;if(qe&&pt){if(sd(kt.tileID,Wt,h))continue;const Pn=pt.calculateShadowPassMatrixFromTile(kt.tileID.toUnwrapped());Gr=Jc(Pn,be,yr,ot,ft,gt)}else{const Pn=h.translatePosMatrix(Ht.expandedProjMatrix,kt,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),fn=F.projection.createInversionMatrix(F,Ht.canonical);Gr=j?Jd(Pn,h,tr,Z,te,be,yr,Ht,kt,ye,ft,gt,ve,Se,fn,Me,ot):Rf(Pn,h,tr,Z,te,be,yr,Ht,ye,ft,gt,ve,Se,fn,Me,ot,ze,yt)}h.uploadCommonUniforms(N,Tn,Ht.toUnwrapped(),null,Mt);let Kn=Wt.segments;if(F.projection.name==="mercator"&&!qe&&(Kn=Wt.getVisibleSegments(kt.tileID,h.terrain,h.transform.getFrustum(0)),!Kn.get().length))continue;if(dt)if(qe)for(const Pn of Kn.get())dt.numRenderedVerticesInShadowPass+=Pn.primitiveLength;else for(const Pn of Kn.get())dt.numRenderedVerticesInTransparentPass+=Pn.primitiveLength;const ci=[];(h.terrain||R)&&ci.push(Wt.centroidVertexBuffer),Ae&&ci.push(Wt.layoutVertexExtBuffer),Xe&&ci.push(Wt.wallVertexBuffer),Tn.draw(h,N.gl.TRIANGLES,m,v,w,Dn.backCCW,Gr,i.id,Wt.layoutVertexBuffer,Wt.indexBuffer,Kn,i.paint,h.transform.zoom,bn,ci)}h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!1)}function id(h,t,i,d,m,v,w,R,N,P,F,V,j,Z,Q,K,te,re,pe){const be=h.context,ye=be.gl,Ae=h.transform,ve=h.transform.zoom,Se=[],Te=wa(h,i.paint.get("fill-extrusion-cutoff-fade-range"));P==="clear"?(Se.push("CLEAR_SUBPASS"),pe&&(Se.push("CLEAR_FROM_TEXTURE"),be.activeTexture.set(ye.TEXTURE0),pe.bind(ye.LINEAR,ye.CLAMP_TO_EDGE))):P==="sdf"&&Se.push("SDF_SUBPASS"),te&&Se.push("HAS_CENTROID"),Te.shouldRenderCutoff&&Se.push("RENDER_CUTOFF");const Me=i.layout.get("fill-extrusion-edge-radius"),ze=(ot,Xe,ft,gt,Mt)=>{const He=Xe.programConfigurations.get(i.id),mt=h.isTileAffectedByFog(ot),qe=h.getOrCreateProgram("fillExtrusionGroundEffect",{config:He,defines:Se,overrideFog:mt}),pt=((yt,st,dt,Ht,kt,Wt,hn,In,bn,Tn,Mn)=>({u_matrix:st,u_opacity:dt,u_ao_pass:Ht?1:0,u_meter_to_tile:kt,u_ao:Wt,u_flood_light_intensity:hn,u_flood_light_color:In,u_attenuation:bn,u_edge_radius:Tn,u_fb:0,u_fb_size:Mn,u_dynamic_offset:1}))(0,gt,F,N,Mt,[V,j*Mt],Z,Q,K,ve>=17?0:Me*Mt,pe?pe.size[0]:0),lt=[];te&&lt.push(Xe.hiddenByLandmarkVertexBuffer),h.uploadCommonUniforms(be,qe,ot.toUnwrapped(),null,Te),qe.draw(h,be.gl.TRIANGLES,m,v,w,R,pt,i.id,Xe.vertexBuffer,Xe.indexBuffer,ft,i.paint,ve,He,lt)};for(const ot of d){const Xe=t.getTile(ot),ft=Xe.getBucket(i);if(!ft||ft.projection.name!==Ae.projection.name||!ft.groundEffect||ft.groundEffect&&!ft.groundEffect.hasData())continue;const gt=ft.groundEffect,Mt=1/ft.tileToMeter;{const He=h.translatePosMatrix(ot.projMatrix,Xe,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),mt=gt.getDefaultSegment();ze(ot,gt,mt,He,Mt)}if(re)for(let He=0;He<4;He++){const mt=a.d7[He](ot),qe=t.getTile(mt);if(!qe)continue;const pt=qe.getBucket(i);if(!pt||pt.projection.name!==Ae.projection.name||!pt.groundEffect||pt.groundEffect&&!pt.groundEffect.hasData())continue;const lt=pt.groundEffect;let yt,st;He===0?(yt=[-a.ai,0,0],st=1):He===1?(yt=[a.ai,0,0],st=0):He===2?(yt=[0,-a.ai,0],st=3):(yt=[0,a.ai,0],st=2);const dt=lt.regionSegments[st];if(!dt)continue;const Ht=new Float32Array(16);a.ad.mat4.translate(Ht,ot.projMatrix,yt),ze(ot,lt,dt,h.translatePosMatrix(Ht,Xe,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),Mt)}}}function od(h,t,i,d,m,v,w){d.centroidVertexArray.length===0&&d.createCentroidsBuffer();const R=v?v.findDEMTileFor(i):null;if(!(R&&R.dem||w))return;v&&R&&R.dem&&d.selfDEMTileTimestamp!==R.dem._timestamp&&(d.borderDoneWithNeighborZ=[-1,-1,-1,-1],d.selfDEMTileTimestamp=R.dem._timestamp);const N=re=>new a.P(Math.ceil((re+a.da)*a.db),0),P=re=>{const pe=t.getSource().minzoom,be=Ae=>{const ve=t.getTileByID(Ae);if(ve&&ve.hasData())return ve.getBucket(m)},ye=[0,-1,1];for(const Ae of ye){if(re.overscaledZ+Ae<pe)continue;const ve=be(re.calculateScaledKey(re.overscaledZ+Ae));if(ve)return ve}},F=[0,0,0],V=(re,pe)=>(F[0]=Math.min(re.min.y,pe.min.y),F[1]=Math.max(re.max.y,pe.max.y),F[2]=a.ai-pe.min.x>re.max.x?pe.min.x-a.ai:re.max.x,F),j=(re,pe)=>(F[0]=Math.min(re.min.x,pe.min.x),F[1]=Math.max(re.max.x,pe.max.x),F[2]=a.ai-pe.min.y>re.max.y?pe.min.y-a.ai:re.max.y,F),Z=[(re,pe)=>V(re,pe),(re,pe)=>V(pe,re),(re,pe)=>j(re,pe),(re,pe)=>j(pe,re)],Q=(re,pe,be,ye,Ae,ve,Se)=>{if(!v)return 0;const Te=[[ve?be:re,ve?re:be,0],[ve?be:pe,ve?pe:be,0]],Me=Se<0?a.ai+Se:Se,ze=[ve?Me:(re+pe)/2,ve?(re+pe)/2:Me,0];return be===0&&Se<0||be!==0&&Se>0?v.getForTilePoints(Ae,[ze],!0,ye):Te.push(ze),v.getForTilePoints(i,Te,!0,R),Math.max(Te[0][2],Te[1][2],ze[2])/v.exaggeration()};for(let re=0;re<4;re++){const pe=d.borderFeatureIndices[re];if(pe.length===0)continue;const be=a.d7[re](i),ye=P(be);if(!(ye&&ye instanceof a.d8))continue;const Ae=v?v.findDEMTileFor(be):null;if(!(Ae&&Ae.dem||w)||(v&&Ae&&Ae.dem&&d.borderDEMTileTimestamp[re]!==Ae.dem._timestamp&&(d.borderDoneWithNeighborZ[re]=-1,d.borderDEMTileTimestamp[re]=Ae.dem._timestamp),d.borderDoneWithNeighborZ[re]===ye.canonical.z))continue;ye.centroidVertexArray.length===0&&ye.createCentroidsBuffer();const ve=(re<2?1:5)-re,Se=ye.borderDoneWithNeighborZ[ve]!==d.canonical.z,Te=ye.borderFeatureIndices[ve];let Me=0;if(d.canonical.z!==ye.canonical.z){for(const ze of pe)d.showCentroid(d.featuresOnBorder[ze]);if(Se)for(const ze of Te)ye.showCentroid(ye.featuresOnBorder[ze]);d.borderDoneWithNeighborZ[re]=ye.canonical.z,ye.borderDoneWithNeighborZ[ve]=d.canonical.z}for(const ze of pe){const ot=d.featuresOnBorder[ze],Xe=d.centroidData[ot.centroidDataIndex],ft=ot.borders[re];let gt;for(;Me<Te.length;){gt=ye.featuresOnBorder[Te[Me]];const Mt=gt.borders[ve];if(Mt[1]>ft[0]+3||Mt[0]>ft[0]-3)break;ye.showCentroid(gt),Me++}if(gt&&Me<Te.length){const Mt=Me;let He=0;for(;!(gt.borders[ve][0]>ft[1]-3)&&(He++,++Me!==Te.length);)gt=ye.featuresOnBorder[Te[Me]];gt=ye.featuresOnBorder[Te[Mt]];let mt=!1;if(He>=1){const lt=gt.borders[ve];Math.abs(ft[0]-lt[0])<3&&Math.abs(ft[1]-lt[1])<3&&(He=1,mt=!0,Me=Mt+1)}else if(He===0){d.showCentroid(ot);continue}const qe=ye.centroidData[gt.centroidDataIndex];w&&mt&&(((K=Xe).flags|(te=qe).flags)&a.d9?(K.flags|=a.d9,te.flags|=a.d9):(K.flags&=~a.d9,te.flags&=~a.d9));const pt=ot.intersectsCount()>1||gt.intersectsCount()>1;if(He>1)Me=Mt,Xe.centroidXY=qe.centroidXY=new a.P(0,0);else if(Ae&&Ae.dem&&!pt){const lt=Z[re](Xe,qe),yt=re%2?a.ai-1:0,st=Q(lt[0],Math.min(a.ai-1,lt[1]),yt,Ae,be,re<2,lt[2]);Xe.centroidXY=qe.centroidXY=N(st)}else pt?Xe.centroidXY=qe.centroidXY=new a.P(0,0):(Xe.centroidXY=d.encodeBorderCentroid(ot),qe.centroidXY=ye.encodeBorderCentroid(gt));d.writeCentroidToBuffer(Xe),ye.writeCentroidToBuffer(qe)}else d.showCentroid(ot)}d.borderDoneWithNeighborZ[re]=ye.canonical.z,ye.borderDoneWithNeighborZ[ve]=d.canonical.z}var K,te;(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(h)}const Ta=[1,0,0],Ot=[0,1,0],en=[0,0,1];function sd(h,t,i){const d=i.transform,m=i.shadowRenderer;if(!m)return!0;const v=h.toUnwrapped(),w=d.tileSize*m._cascades[i.currentShadowCascade].scale;let R=t.maxHeight;if(d.elevation){const K=d.elevation.getMinMaxForTile(h);K&&(R+=K.max)}const N=[...m.shadowDirection];N[2]=-N[2];const P=m.computeSimplifiedTileShadowVolume(v,R,w,N);if(!P)return!1;const F=[Ta,Ot,en,N,[N[0],0,N[2]],[0,N[1],N[2]]],V=d.projection.name==="globe",j=d.scaleZoom(w),Z=a.bR.fromInvProjectionMatrix(d.invProjMatrix,d.worldSize,j,!V),Q=m.getCurrentCascadeFrustum();return Z.intersectsPrecise(P.vertices,P.planes,F)===0||Q.intersectsPrecise(P.vertices,P.planes,F)===0}function li(h){return[h[0]*a.dc,h[1]*a.dc,h[2]*a.dc,0]}function Qe(h,t,i,d,m,v,w,R,N){const P=d.getSource(),F=i.globeSharedBuffers;if(!F)return;let V,j,Z;if(t&&(V=d.getTile(t)),P instanceof a.aK?(j=P.texture,Z=a.cJ(0,0,i.transform)):V&&t&&(j=V.texture,Z=a.cJ(t.canonical.z,t.canonical.x,i.transform)),!j||!Z)return;h||(Z=a.ad.mat4.scale(a.ad.mat4.create(),Z,[1,-1,1]));const Q=i.context,K=Q.gl,te=m.paint.get("raster-resampling")==="nearest"?K.NEAREST:K.LINEAR,re=i.colorModeForDrapableLayerRenderPass(v),pe=w.defines;pe.push("GLOBE_POLES");const be=new _n(K.LEQUAL,_n.ReadWrite,i.depthRangeFor3D),ye=Float32Array.from(i.transform.expandedFarZProjMatrix),Ae=Float32Array.from(a.bc(a.cI(new a.bT(0,0,0))));i.terrain&&i.terrain.prepareDrawTile(),Q.activeTexture.set(K.TEXTURE0),j.bind(te,K.CLAMP_TO_EDGE),Q.activeTexture.set(K.TEXTURE1),j.bind(te,K.CLAMP_TO_EDGE),"useMipmap"in j&&Q.extTextureFilterAnisotropic&&i.transform.pitch>20&&K.texParameterf(K.TEXTURE_2D,Q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Q.extTextureFilterAnisotropicMax);const[ve,Se,Te,Me]=t?F.getPoleBuffers(t.canonical.z,!1):F.getPoleBuffers(0,!0),ze=m.paint.get("raster-elevation");let ot;h?(ot=ve,i.renderDefaultNorthPole=ze!==0):(ot=Se,i.renderDefaultSouthPole=ze!==0);const Xe=li(w.mix),ft=((Mt,He,mt,qe,pt,lt,yt,st,dt,Ht,kt,Wt,hn)=>hm(Mt,He,mt,new Float32Array(16),new Float32Array(9),[0,0],qe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},lt,[0,0],st,2,Ht,kt,Wt,1,0,hn))(ye,Ae,Z,a.ag(i.transform.zoom),0,m,0,ze,0,Xe,w.offset,w.range,v),gt=i.getOrCreateProgram("raster",{defines:pe});i.uploadCommonUniforms(Q,gt,null),gt.draw(i,K.TRIANGLES,be,N,re,R,ft,m.id,ot,Te,Me)}function _m(h){const t=h._nearZ,i=h.projection.farthestPixelDistance(h),d=i-t,m=.2*h.height,v=t+m;return[t,i,(v-m-t)/d,(v-t)/d]}function oh(h,t,i,d){if(h)return t instanceof Va&&h instanceof go?t.getTextureDescriptor(h,i,!0):{texture:h.texture,mix:li(d.mix),offset:d.offset,buffer:0,tileSize:1}}var Nf=a.dd([{name:"a_index",type:"Int16",components:1}]);class Vg{constructor(t,i,d,m){const v={width:d[0],height:d[1],data:null},w=t.gl;this.targetColorTexture=new a.T(t,v,w.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new a.T(t,v,w.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(i,m),this.lastInvalidatedAt=0}updateParticleTexture(t,i){if(this.particleTextureDimension===i.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const d=this.context.gl,m=i.width*i.height;this.particleTexture0=new a.T(this.context,i,d.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new a.T(this.context,i,d.RGBA8,{premultiply:!1,useMipmap:!1});const v=new a.de;v.reserve(m);for(let w=0;w<m;w++)v.emplaceBack(w);this.particleIndexBuffer=this.context.createVertexBuffer(v,Nf.members,!0),this.particleSegment=a.b8.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=i.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=a.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function zo(h,t,i){if(!h)return null;const d=t.getTextureDescriptor(h,i,!0);if(!d)return null;let{texture:m,mix:v,offset:w,tileSize:R,buffer:N,format:P}=d;if(!m||!P)return null;let F=!1;return P==="uint32"&&(F=!0,v[3]=0,v=nn(a.df,v,[0,i.paint.get("raster-particle-max-speed")]),w=Of(a.df,w,[0,i.paint.get("raster-particle-max-speed")])),{texture:m,textureOffset:[N/(R+2*N),R/(R+2*N)],tileSize:R,scalarData:F,scale:v,offset:w,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[P]]}}function qg(h){const t=h._nearZ,i=h.projection.farthestPixelDistance(h),d=i-t,m=.2*h.height,v=t+m;return[t,i,(v-m-t)/d,(v-t)/d]}const ad=new a.al(1,0,0,1),zy=new a.al(0,1,0,1),Py=new a.al(0,0,1,1),Hg=new a.al(1,0,1,1),ld=new a.al(0,1,1,1);function zl(h,t,i,d,m,v,w){const R=h.context,N=h.transform,P=R.gl,F=N.projection.name==="globe",V=F?["PROJECTION_GLOBE_VIEW"]:[];let j=a.ad.mat4.clone(i.projMatrix);if(F&&a.ag(N.zoom)>0){const Xe=a.bb(i.canonical,N),ft=a.dg(Xe);j=a.ad.mat4.multiply(new Float32Array(16),N.globeMatrix,ft),a.ad.mat4.multiply(j,N.projMatrix,j)}const Z=a.ad.mat4.create();Z[12]+=2*m/(a.q.devicePixelRatio*N.width),Z[13]+=2*v/(a.q.devicePixelRatio*N.height),a.ad.mat4.multiply(j,Z,j);const Q=h.getOrCreateProgram("debug",{defines:V}),K=t.getTileByID(i.key);h.terrain&&h.terrain.setupElevationDraw(K,Q);const te=_n.disabled,re=Bn.disabled,pe=h.colorModeForRenderPass(),be="$debug";R.activeTexture.set(P.TEXTURE0),h.emptyTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),F?K._makeGlobeTileDebugBuffers(h.context,N):K._makeDebugTileBoundsBuffers(h.context,N.projection);const ye=K._tileDebugBuffer||h.debugBuffer,Ae=K._tileDebugIndexBuffer||h.debugIndexBuffer,ve=K._tileDebugSegments||h.debugSegments;if(Q.draw(h,P.LINE_STRIP,te,re,pe,Dn.disabled,Fg(j,d),be,ye,Ae,ve,null,null,null,[K._globeTileDebugBorderBuffer]),w){const Xe=K.latestRawTileData,ft=Math.floor((Xe&&Xe.byteLength||0)/1024);let gt=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(gt+=` => ${i.overscaledZ}`),gt+=` ${K.state}`,gt+=` ${ft}kb`,function(Mt,He){Mt.initDebugOverlayCanvas();const mt=Mt.debugOverlayCanvas,qe=Mt.context.gl,pt=Mt.debugOverlayCanvas.getContext("2d");pt.clearRect(0,0,mt.width,mt.height),pt.shadowColor="white",pt.shadowBlur=2,pt.lineWidth=1.5,pt.strokeStyle="white",pt.textBaseline="top",pt.font="bold 36px Open Sans, sans-serif",pt.fillText(He,5,5),pt.strokeText(He,5,5),Mt.debugOverlayTexture.update(mt),Mt.debugOverlayTexture.bind(qe.LINEAR,qe.CLAMP_TO_EDGE)}(h,gt)}const Se=t.getTile(i).tileSize,Te=512/Math.min(Se,512)*(i.overscaledZ/N.zoom)*.5,Me=K._tileDebugTextBuffer||h.debugBuffer,ze=K._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,ot=K._tileDebugTextSegments||h.debugSegments;Q.draw(h,P.TRIANGLES,te,re,Xn.alphaBlended,Dn.disabled,Fg(j,a.al.transparent,Te),be,Me,ze,ot,null,null,null,[K._globeTileDebugTextBuffer])}function ym(h,t,i,d){tu(h,0,t+i/2,h.transform.width,i,d)}function vm(h,t,i,d){tu(h,t-i/2,0,i,h.transform.height,d)}function tu(h,t,i,d,m,v){const w=h.context,R=w.gl;R.enable(R.SCISSOR_TEST),R.scissor(t*a.q.devicePixelRatio,i*a.q.devicePixelRatio,d*a.q.devicePixelRatio,m*a.q.devicePixelRatio),w.clear({color:v}),R.disable(R.SCISSOR_TEST)}const sh=a.dd([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:nu}=sh;function ol(h,t,i,d){h.emplaceBack(t,i,d)}class Gg{constructor(t){this.vertexArray=new a.dh,this.indices=new a.aV,ol(this.vertexArray,-1,-1,1),ol(this.vertexArray,1,-1,1),ol(this.vertexArray,-1,1,1),ol(this.vertexArray,1,1,1),ol(this.vertexArray,-1,-1,-1),ol(this.vertexArray,1,-1,-1),ol(this.vertexArray,-1,1,-1),ol(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,nu),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=a.b8.simpleSegment(0,0,36,12)}}function Xi(h,t,i,d,m,v){const w=h.context.gl,R=t.paint.get("sky-atmosphere-color"),N=t.paint.get("sky-atmosphere-halo-color"),P=t.paint.get("sky-atmosphere-sun-intensity"),F=((V,j,Z,Q,K)=>({u_matrix_3f:V,u_sun_direction:j,u_sun_intensity:Z,u_color_tint_r:[Q.r,Q.g,Q.b,Q.a],u_color_tint_m:[K.r,K.g,K.b,K.a],u_luminance:5e-5}))(a.ad.mat3.fromMat4(a.ad.mat3.create(),d),m,P,R,N);w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+v,t.skyboxTexture,0),i.draw(h,w.TRIANGLES,_n.disabled,Bn.disabled,Xn.unblended,Dn.frontCW,F,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const xm=a.dd([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class cd{constructor(t){const i=new a.di;i.emplaceBack(-1,1,1,0,0),i.emplaceBack(1,1,1,1,0),i.emplaceBack(1,-1,1,1,1),i.emplaceBack(-1,-1,1,0,1);const d=new a.aV;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(i,xm.members),this.indexBuffer=t.createIndexBuffer(d),this.segments=a.b8.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Xr=a.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class _r{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class bm{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Xn([1,Al,1,Al],a.al.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Xn([1,0,1,0],a.al.transparent,[!1,!1,!1,!0]),this.params=new _r,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const i=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new cd(i);const d=this.params.sizeRange,m=this.params.intensityRange,v=function(F){const V=a.dl(30),j=[];for(let Z=0;Z<F;++Z){const Q=2*Math.PI*V(),K=Math.acos(1-2*V())-.5*Math.PI;j.push(a.ad.vec3.fromValues(Math.cos(K)*Math.cos(Q),Math.cos(K)*Math.sin(Q),Math.sin(K)))}return j}(this.params.starsCount),w=a.dl(300),R=new a.dj,N=new a.aV;let P=0;for(let F=0;F<v.length;++F){const V=a.ad.vec3.scale([],v[F],200),j=Math.max(0,1+.01*d*(1*w()-.5)),Z=Math.max(0,1+.01*m*(1*w()-.5));R.emplaceBack(V[0],V[1],V[2],-1,-1,j,Z),R.emplaceBack(V[0],V[1],V[2],1,-1,j,Z),R.emplaceBack(V[0],V[1],V[2],1,1,j,Z),R.emplaceBack(V[0],V[1],V[2],-1,1,j,Z),N.emplaceBack(P+0,P+1,P+2),N.emplaceBack(P+0,P+2,P+3),P+=4}this.starsVx=i.createVertexBuffer(R,Xr.members),this.starsIdx=i.createIndexBuffer(N),this.starsSegments=a.b8.simpleSegment(0,0,R.length,N.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,i){const d=t.context,m=d.gl,v=t.transform,w=new _n(m.LEQUAL,_n.ReadOnly,[0,1]),R=a.ag(v.zoom),N=t.style.getLut(i.scope),P=i.properties.get("color-use-theme")==="none",F=i.properties.get("color").toRenderColor(P?null:N).toArray01(),V=i.properties.get("high-color-use-theme")==="none",j=i.properties.get("high-color").toRenderColor(V?null:N).toArray01(),Z=i.properties.get("space-color-use-theme")==="none",Q=i.properties.get("space-color").toRenderColor(Z?null:N).toArray01PremultipliedAlpha(),K=5e-4,te=a.dk(i.properties.get("horizon-blend"),0,1,K,.25),re=a.cD(t,d,v)&&te===K?v.worldSize/(2*Math.PI*1.025)-1:v.globeRadius,pe=t.frameCounter/1e3%1,be=a.ad.vec3.length(v.globeCenterInViewSpace),ye=Math.sqrt(Math.pow(be,2)-Math.pow(re,2)),Ae=Math.acos(ye/be),ve=Se=>{const Te=v.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Se&&Te.push("ALPHA_PASS");const Me=t.getOrCreateProgram("globeAtmosphere",{defines:Te}),ze=((Xe,ft,gt,Mt,He,mt,qe,pt,lt,yt,st,dt)=>({u_frustum_tl:Xe,u_frustum_tr:ft,u_frustum_br:gt,u_frustum_bl:Mt,u_horizon:He,u_transition:mt,u_fadeout_range:qe,u_color:pt,u_high_color:lt,u_space_color:yt,u_temporal_offset:st,u_horizon_angle:dt}))(v.frustumCorners.TL,v.frustumCorners.TR,v.frustumCorners.BR,v.frustumCorners.BL,v.frustumCorners.horizon,R,te,F,j,Q,pe,Ae);t.uploadCommonUniforms(d,Me);const ot=this.atmosphereBuffer;ot&&Me.draw(t,m.TRIANGLES,w,Bn.disabled,Se?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Dn.backCW,ze,Se?"atmosphere_glow_alpha":"atmosphere_glow",ot.vertexBuffer,ot.indexBuffer,ot.segments)};ve(!1),ve(!0)}drawStars(t,i){const d=a.ay(i.properties.get("star-intensity"),0,1);if(d===0)return;const m=t.context,v=m.gl,w=t.transform,R=t.getOrCreateProgram("stars"),N=a.ad.quat.identity([]);a.ad.quat.rotateX(N,N,-w._pitch),a.ad.quat.rotateZ(N,N,-w.angle),a.ad.quat.rotateX(N,N,a.ak(w._center.lat)),a.ad.quat.rotateY(N,N,-a.ak(w._center.lng));const P=a.ad.mat4.fromQuat(new Float32Array(16),N),F=a.ad.mat4.multiply([],w.starsProjMatrix,P),V=a.ad.mat3.fromMat4([],P),j=a.ad.mat3.invert([],V),Z=[0,1,0];a.ad.vec3.transformMat3(Z,Z,j),a.ad.vec3.scale(Z,Z,this.params.sizeMultiplier);const Q=[1,0,0];a.ad.vec3.transformMat3(Q,Q,j),a.ad.vec3.scale(Q,Q,this.params.sizeMultiplier);const K=(te=Z,re=Q,pe=d,{u_matrix:Float32Array.from(F),u_up:te,u_right:re,u_intensity_multiplier:pe});var te,re,pe;t.uploadCommonUniforms(m,R),this.starsVx&&this.starsIdx&&R.draw(t,v.TRIANGLES,_n.disabled,Bn.disabled,this.colorModeAlphaBlendedWriteRGB,Dn.disabled,K,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Pl(h,t){const i=[...h],d=t.cameraWorldSizeForFog/t.worldSize,m=a.ad.mat4.identity([]);return a.ad.mat4.scale(m,m,[d,d,1]),a.ad.mat4.multiply(i,m,i),a.ad.mat4.multiply(i,t.worldToFogMatrix,i),i}function Bs(h,t,i,d,m){const v=i.material,w=d.context,{baseColorTexture:R,metallicRoughnessTexture:N}=v.pbrMetallicRoughness,{normalTexture:P,occlusionTexture:F,emissionTexture:V}=v;function j(Q,K,te){if(Q&&(h.push(K),w.activeTexture.set(w.gl.TEXTURE0+te),Q.gfxTexture)){const{minFilter:re,magFilter:pe,wrapS:be,wrapT:ye}=Q.sampler;Q.gfxTexture.bindExtraParam(re,pe,be,ye)}}j(R,"HAS_TEXTURE_u_baseColorTexture",mi.BaseColor),j(N,"HAS_TEXTURE_u_metallicRoughnessTexture",mi.MetallicRoughness),j(P,"HAS_TEXTURE_u_normalTexture",mi.Normal),j(F,"HAS_TEXTURE_u_occlusionTexture",mi.Occlusion),j(V,"HAS_TEXTURE_u_emissionTexture",mi.Emission),m&&(m.texture||(m.texture=new a.dn(d.context,m.image,[m.image.height,m.image.height,m.image.height],w.gl.RGBA8)),w.activeTexture.set(w.gl.TEXTURE0+mi.LUT),m.texture&&m.texture.bind(w.gl.LINEAR,w.gl.CLAMP_TO_EDGE),h.push("APPLY_LUT_ON_GPU")),i.texcoordBuffer&&(h.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(i.texcoordBuffer)),i.colorBuffer&&(h.push(i.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(i.colorBuffer)),i.normalBuffer&&(h.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(i.normalBuffer)),i.pbrBuffer&&(h.push("HAS_ATTRIBUTE_a_pbr"),h.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(i.pbrBuffer)),v.alphaMode!=="OPAQUE"&&v.alphaMode!=="MASK"||h.push("UNPREMULT_TEXTURE_IN_SHADER"),v.defined||h.push("DIFFUSE_SHADED");const Z=d.shadowRenderer;Z&&(h.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Z.useNormalOffset&&h.push("NORMAL_OFFSET"))}function sl(h,t,i,d,m,v){const w=i.paint.get("model-opacity").constantOr(1),R=t.context,N=new _n(t.context.gl.LEQUAL,_n.ReadWrite,t.depthRangeFor3D),P=t.transform,F=h.mesh,V=F.material,j=V.pbrMetallicRoughness,Z=t.style.fog;let Q;Q=t.transform.projection.zAxisUnit==="pixels"?[...h.nodeModelMatrix]:a.ad.mat4.multiply([],d.zScaleMatrix,h.nodeModelMatrix),a.ad.mat4.multiply(Q,d.negCameraPosMatrix,Q);const K=a.ad.mat4.invert([],Q);a.ad.mat4.transpose(K,K);const te=i.paint.get("model-color-use-theme").constantOr("default")==="none",re=i.paint.get("model-emissive-strength").constantOr(0),pe=ed(new Float32Array(h.worldViewProjection),new Float32Array(Q),new Float32Array(K),null,t,w,j.baseColorFactor.toRenderColor(null),V.emissiveFactor,j.metallicFactor,j.roughnessFactor,V,re,i),be={defines:[]},ye=[],Ae=t.shadowRenderer;Ae&&(Ae.useNormalOffset=!1),Bs(be.defines,ye,F,t,te?null:i.lut);let ve=null;if(Z){const Me=Pl(h.nodeModelMatrix,t.transform);if(ve=new Float32Array(Me),P.projection.name!=="globe"){const ze=F.aabb.min,ot=F.aabb.max,[Xe,ft]=Z.getOpacityForBounds(Me,ze[0],ze[1],ot[0],ot[1]);be.overrideFog=Xe>=Qt||ft>=Qt}}const Se=wa(t,i.paint.get("model-cutoff-fade-range"));Se.shouldRenderCutoff&&be.defines.push("RENDER_CUTOFF");const Te=t.getOrCreateProgram("model",be);t.uploadCommonUniforms(R,Te,null,ve,Se),t.renderPass!=="shadow"&&Ae&&Ae.setupShadowsFromMatrix(h.nodeModelMatrix,Te),Te.draw(t,R.gl.TRIANGLES,N,m,v,F.material.doubleSided?Dn.disabled:Dn.backCCW,pe,i.id,F.vertexBuffer,F.indexBuffer,F.segments,i.paint,t.transform.zoom,void 0,ye)}function ud(h,t,i,d,m,v,w){let R;R=h.projection.name==="globe"?a.dp(i,h):[...i],a.ad.mat4.multiply(R,R,t.matrix);const N=a.ad.mat4.multiply([],d,R);if(t.meshes)for(const P of t.meshes){if(P.material.alphaMode!=="BLEND"){w.push({mesh:P,depth:0,modelIndex:m,worldViewProjection:N,nodeModelMatrix:R});continue}const F=a.ad.vec3.transformMat4([],P.centroid,N);!h.isOrthographic&&F[2]<=0||v.push({mesh:P,depth:F[2],modelIndex:m,worldViewProjection:N,nodeModelMatrix:R})}if(t.children)for(const P of t.children)ud(h,P,i,d,m,v,w)}function dd(h,t,i,d){const m=i.shadowRenderer;if(!m)return;const v=m.getShadowPassDepthMode(),w=m.getShadowPassColorMode(),R=m.calculateShadowPassMatrixFromMatrix(t),N=mm(R);i.getOrCreateProgram("modelDepth",{defines:i._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(i,i.context.gl.TRIANGLES,v,Bn.disabled,w,Dn.backCCW,N,d.id,h.vertexBuffer,h.indexBuffer,h.segments,d.paint,i.transform.zoom,void 0,void 0)}function al(h,t,i){const d=t.updateZoomBasedPaintProperties(),m=function(v,w,R){let N,P,F,V=v.terrain?v.terrain.exaggeration():0;if(v.terrain&&V>0){const j=v.terrain,Z=j.findDEMTileFor(R);Z&&Z.dem?N=a.dr.create(j,R,Z):V=0}if(V===0&&(w.terrainElevationMin=0,w.terrainElevationMax=0),V===w.validForExaggeration&&(V===0||N&&N._demTile&&N._demTile.tileID===w.validForDEMTile.id&&N._dem._timestamp===w.validForDEMTile.timestamp))return!1;for(const j in w.instancesPerModel){const Z=w.instancesPerModel[j];for(let Q=0;Q<Z.instancedDataArray.length;++Q){const K=(N?V*N.getElevationAt(0|Z.instancedDataArray.float32[16*Q],0|Z.instancedDataArray.float32[16*Q+1],!0,!0):0)+Z.instancesEvaluatedElevation[Q];Z.instancedDataArray.float32[16*Q+6]=K,P=P?Math.min(w.terrainElevationMin,K):K,F=F?Math.max(w.terrainElevationMax,K):K}}return w.terrainElevationMin=P||0,w.terrainElevationMax=F||0,w.validForExaggeration=V,w.validForDEMTile=N&&N._demTile?{id:N._demTile.tileID,timestamp:N._dem._timestamp}:{id:void 0,timestamp:0},!0}(h,t,i);(d||m)&&(t.uploaded=!1,t.upload(h.context))}const pa={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new a.ce([0,0,0],[a.ai,a.ai,0])};function ah(h,t){const i=1<<h.canonical.z,d=t.getFreeCameraOptions().position,m=t.elevation,v=h.canonical.x/i,w=(h.canonical.x+1)/i,R=h.canonical.y/i,N=(h.canonical.y+1)/i;let P=t._centerAltitude;if(m){const Z=m.getMinMaxForTile(h);Z&&Z.max>P&&(P=Z.max)}const F=a.ay(d.x,v,w)-d.x,V=a.ay(d.y,R,N)-d.y,j=a.bH(P,t.center.lat)-d.z;return t._zoomFromMercatorZ(Math.sqrt(F*F+V*V+j*j))}function gs(h,t,i,d,m,v,w){const R=h.context,N=h.renderPass==="shadow",P=h.shadowRenderer,F=N&&P?P.getShadowPassDepthMode():new _n(R.gl.LEQUAL,_n.ReadWrite,h.depthRangeFor3D),V=h.isTileAffectedByFog(v);if(i.meshes)for(const j of i.meshes){const Z=["MODEL_POSITION_ON_GPU"],Q=[];let K,te,re;d.instancedDataArray.length>20&&Z.push("INSTANCED_ARRAYS");const pe=wa(h,t.paint.get("model-cutoff-fade-range"));if(pe.shouldRenderCutoff&&Z.push("RENDER_CUTOFF"),N&&P)K=h.getOrCreateProgram("modelDepth",{defines:Z}),te=mm(w.shadowTileMatrix,w.shadowTileMatrix,Float32Array.from(i.matrix)),re=P.getShadowPassColorMode();else{Bs(Z,Q,j,h,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),K=h.getOrCreateProgram("model",{defines:Z,overrideFog:V});const ye=j.material,Ae=ye.pbrMetallicRoughness,ve=t.paint.get("model-opacity").constantOr(1),Se=t.paint.get("model-emissive-strength").constantOr(0);te=ed(v.expandedProjMatrix,Float32Array.from(i.matrix),new Float32Array(16),null,h,ve,Ae.baseColorFactor.toRenderColor(null),ye.emissiveFactor,Ae.metallicFactor,Ae.roughnessFactor,ye,Se,t,m),P&&(w.shadowUniformsInitialized?K.setShadowUniformValues(R,P.getShadowUniformValues()):(P.setupShadows(v.toUnwrapped(),K,"model-tile",v.overscaledZ),w.shadowUniformsInitialized=!0)),re=pe.shouldRenderCutoff||ve<1||ye.alphaMode!=="OPAQUE"?Xn.alphaBlended:Xn.unblended}h.uploadCommonUniforms(R,K,v.toUnwrapped(),null,pe);const be=j.material.doubleSided?Dn.disabled:Dn.backCCW;if(d.instancedDataArray.length>20)Q.push(d.instancedDataBuffer),K.draw(h,R.gl.TRIANGLES,F,Bn.disabled,re,be,te,t.id,j.vertexBuffer,j.indexBuffer,j.segments,t.paint,h.transform.zoom,void 0,Q,d.instancedDataArray.length);else{const ye=N?"u_instance":"u_normal_matrix";for(let Ae=0;Ae<d.instancedDataArray.length;++Ae)te[ye]=new Float32Array(d.instancedDataArray.arrayBuffer,64*Ae,16),K.draw(h,R.gl.TRIANGLES,F,Bn.disabled,re,be,te,t.id,j.vertexBuffer,j.indexBuffer,j.segments,t.paint,h.transform.zoom,void 0,Q)}}if(i.children)for(const j of i.children)gs(h,t,j,d,m,v,w)}const gi=[1,-1,1];function wm(h,t,i,d){if(!i.modelManager)return!0;const m=i.modelManager;if(!i.shadowRenderer)return!0;const v=i.shadowRenderer,w=t.aabb;let R=!0,N=h.maxHeight;if(N===0){let F=0;for(const V in h.instancesPerModel){const j=m.getModel(V,d);j?F=Math.max(F,Math.max(Math.max(j.aabb.max[0],j.aabb.max[1]),j.aabb.max[2])):R=!1}N=h.maxScale*F*1.41+h.maxVerticalOffset,R&&(h.maxHeight=N)}w.max[2]=N,w.min[2]+=h.terrainElevationMin,w.max[2]+=h.terrainElevationMax,a.ad.vec3.transformMat4(w.min,w.min,t.tileMatrix),a.ad.vec3.transformMat4(w.max,w.max,t.tileMatrix);const P=w.intersects(v.getCurrentCascadeFrustum());return i.currentShadowCascade===0&&(h.isInsideFirstShadowMapFrustum=P===2),P===0}function Sm(h,t){const i=h.uniformValues.u_cutoff_params[0],d=h.uniformValues.u_cutoff_params[1],m=h.uniformValues.u_cutoff_params[2],v=h.uniformValues.u_cutoff_params[3];return d===i||v===m?1:a.ay(((t-i)/(d-i)-m)/(v-m),0,1)}function Tm(h,t,i,d){if(t.pitch<20)return 1;const m=t.getWorldToCameraMatrix();a.ad.mat4.multiply(m,m,h);const v=a.ad.vec4.fromValues(i.min[0],i.min[1],i.min[2],1);let w=a.ad.vec4.transformMat4(a.ad.vec4.create(),v,m),R=w,N=w;v[1]=i.max[1],w=a.ad.vec4.transformMat4(a.ad.vec4.create(),v,m),R=w[1]<R[1]?w:R,N=w[1]>N[1]?w:N,v[0]=i.max[0],w=a.ad.vec4.transformMat4(a.ad.vec4.create(),v,m),R=w[1]<R[1]?w:R,N=w[1]>N[1]?w:N,v[1]=i.min[1],w=a.ad.vec4.transformMat4(a.ad.vec4.create(),v,m),R=w[1]<R[1]?w:R,N=w[1]>N[1]?w:N;const P=a.ay(d[0],0,1),F=100*t.pixelsPerMeter*a.ay(d[1],0,1),V=a.ay(d[2],0,1),j=a.ad.vec4.lerp(a.ad.vec4.create(),R,N,P),Z=Math.tan(.5*t.fovX),Q=-j[2]*Z;if(F===0)return j[1]<-Math.abs(Q)?V:1;const K=(-Math.abs(Q)-j[1])/F,te=(pe,be,ye)=>(1-ye)*pe+ye*be,re=a.ay(te(1,V,K),V,1);return te(1,re,a.ay((t.pitch-20)/20,0,1))}class Ea{}class ru{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,i,d){{const V=this._storage.get(i.id);if(V)return V.lastUsedFrameIdx=t,V.buf}const m=d.gl,v=m.getBufferParameter(m.ELEMENT_ARRAY_BUFFER,m.BUFFER_SIZE),w=new ArrayBuffer(v),R=new Int16Array(w);m.getBufferSubData(m.ELEMENT_ARRAY_BUFFER,0,new Int16Array(w));const N=new a.dt;for(let V=0;V<v/2;V+=3){const j=R[V],Z=R[V+1],Q=R[V+2];N.emplaceBack(j,Z),N.emplaceBack(Z,Q),N.emplaceBack(Q,j)}const P=d.bindVertexArrayOES.current,F=new Ea;return F.buf=new nl(d,N),F.lastUsedFrameIdx=t,this._storage.set(i.id,F),d.bindVertexArrayOES.set(P),F.buf}update(t){for(const[i,d]of this._storage)t-d.lastUsedFrameIdx>30&&(d.buf.destroy(),this._storage.delete(i))}destroy(){for(const[t,i]of this._storage)i.buf.destroy(),this._storage.delete(t)}}class zf{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Aa=a.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class iu{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class lh{constructor(t,i){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...i,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...i,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Pf=a.dd([{type:"Float32",name:"a_pos_2f",components:2}]);class Em{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,i){const d=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const w=new a.du,R=new a.aV;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(1,1),w.emplaceBack(-1,1),R.emplaceBack(0,1,2),R.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(w,Pf.members),this.vignetteIdx=t.context.createIndexBuffer(R)}const m=a.b8.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,d);const w={u_vignetteShape:(v={vignetteShape:[i.start,i.range,Math.pow(10,i.fadePower)],vignetteColor:[i.color.r,i.color.g,i.color.b,i.color.a*i.strength]}).vignetteShape,u_vignetteColor:v.vignetteColor};d.draw(t,t.context.gl.TRIANGLES,_n.disabled,Bn.disabled,Xn.alphaBlended,Dn.disabled,w,"vignette",this.vignetteVx,this.vignetteIdx,m)}var v}}class xo{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,i){const d=t.getFreeCameraOptions().position,m=d.toAltitude(),v=d.toLngLat(),w=a.ak(v.lng),R=a.ak(v.lat),N=t.pixelsPerMeter/i,P=w*a.dv,F=a.dv*Math.log(Math.tan(Math.PI/4+R/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const V=-this._offsetYPrev+F,j=-this._elevationPrev+m;this._accumulatedOffsetX+=(-this._offsetXPrev+P)*N,this._accumulatedOffsetY+=V*N,this._accumulatedElevation+=j*N,this._offsetXPrev=P,this._offsetYPrev=F,this._elevationPrev=m}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Am(h,t){return[-(h[0]-Math.floor(h[0]/t)*t),-(h[1]-Math.floor(h[1]/t)*t),-(h[2]-Math.floor(h[2]/t)*t)]}function Lf(h){const t=a.dl(1323123451230),i=[];for(let d=0;d<h;++d){const m=2*t()-1,v=2*t()-1,w=2*t()-1;i.push(a.ad.vec3.fromValues(m,v,w))}return i}function Fs(h,t,i,d,m){const v=a.ay((m-i)/(d-i),0,1);return(1-v)*h+v*t}class ou{constructor(t){this._movement=new xo,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Em,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,i){const d=t.transform;this._movement.update(d,this._ppmScaleFactor);const m=d.starsProjMatrix,v=a.ad.quat.identity([]);a.ad.quat.rotateX(v,v,a.ak(90)-d._pitch),a.ad.quat.rotateZ(v,v,-d.angle);const w=a.ad.mat4.fromQuat(new Float32Array(16),v),R=a.ad.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),N=a.ad.mat4.transpose([],R),P=a.ad.mat4.multiply([],N,w),F=Date.now()/1e3;return this._accumulatedTimeFromStart+=(F-this._prevTime)*i,this._prevTime=F,{projectionMatrix:m,modelviewMatrix:P}}}class Ca extends ou{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new lh(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const i=t.context;if(!this.particlesVx){const d=Lf(this.particlesCount),m=new a.dw,v=new a.aV;let w=0;const R=a.dl(1323123451230);for(let N=0;N<d.length;++N){const P=d[N],F=[2*R()-1,R(),R(),R()];m.emplaceBack(P[0],P[1],P[2],-1,-1,...F),m.emplaceBack(P[0],P[1],P[2],1,-1,...F),m.emplaceBack(P[0],P[1],P[2],1,1,...F),m.emplaceBack(P[0],P[1],P[2],-1,1,...F),v.emplaceBack(w+0,w+1,w+2),v.emplaceBack(w+0,w+2,w+3),w+=4}this.particlesVx=i.createVertexBuffer(m,Aa.members),this.particlesIdx=i.createIndexBuffer(v)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const i=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},d=t.transform.zoom;if(i.revealStart>d)return;const m=Fs(0,1,i.revealStart,i.revealStart+i.revealRange,d);if(!this.particlesVx||!this.particlesIdx)return;const v=structuredClone(this._params);let w=[-v.direction.x,v.direction.y,-100];a.ad.vec3.normalize(w,w);const R=structuredClone(this._vignetteParams);R.strength*=m,v.overrideStyleParameters||(v.intensity=t.style.rain.state.density,v.timeFactor=t.style.rain.state.intensity,v.color=structuredClone(t.style.rain.state.color),w=structuredClone(t.style.rain.state.direction),v.screenThinning.intensity=t.style.rain.state.centerThinning,v.dropletSizeX=t.style.rain.state.dropletSize[0],v.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],v.distortionStrength=100*t.style.rain.state.distortionStrength,R.strength=1,R.color=structuredClone(t.style.rain.state.vignetteColor));const N=this.updateOnRender(t,v.timeFactor),P=t.context,F=P.gl,V=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new a.T(P,{width:t.width,height:t.height,data:null},F.RGBA8)),v.distortionStrength>0&&(P.activeTexture.set(F.TEXTURE0),this.screenTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),F.copyTexSubImage2D(F.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const j=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(P,j),P.activeTexture.set(F.TEXTURE0),this.screenTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const Z=[v.color.r,v.color.g,v.color.b,v.color.a],Q=(K,te)=>{const re=Am(this._movement.getPosition(),K),pe=v.dropletSizeX,be=v.dropletSizeX*v.dropletSizeYScale,ye=t.width/2,Ae=t.height/2,ve=Fs(0,v.screenThinning.start,0,1,v.screenThinning.intensity),Se=Fs(.001,v.screenThinning.range,0,1,v.screenThinning.intensity),Te=Fs(0,v.screenThinning.particleOffset,0,1,v.screenThinning.intensity),Me=(ze={modelview:N.modelviewMatrix,projection:N.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:re,velocityConeAperture:v.velocityConeAperture,velocity:v.velocity,boxSize:K,rainDropletSize:[pe,be],distortionStrength:v.distortionStrength,rainDirection:w,color:Z,screenSize:[V.width,V.height],thinningCenterPos:[ye,Ae],thinningShape:[ve,Se,Math.pow(10,v.screenThinning.fadePower)],thinningAffectedRatio:v.screenThinning.affectedRatio,thinningParticleOffset:Te,shapeDirectionalPower:v.shapeDirPower,shapeNormalPower:v.shapeNormalPower,mode:te?0:1},{u_modelview:Float32Array.from(ze.modelview),u_projection:Float32Array.from(ze.projection),u_time:ze.time,u_cam_pos:ze.camPos,u_texScreen:0,u_velocityConeAperture:ze.velocityConeAperture,u_velocity:ze.velocity,u_boxSize:ze.boxSize,u_rainDropletSize:ze.rainDropletSize,u_distortionStrength:ze.distortionStrength,u_rainDirection:ze.rainDirection,u_color:ze.color,u_screenSize:ze.screenSize,u_thinningCenterPos:ze.thinningCenterPos,u_thinningShape:ze.thinningShape,u_thinningAffectedRatio:ze.thinningAffectedRatio,u_thinningParticleOffset:ze.thinningParticleOffset,u_shapeDirectionalPower:ze.shapeDirectionalPower,u_shapeNormalPower:ze.shapeNormalPower,u_mode:ze.mode});var ze;const ot=Math.round(v.intensity*this.particlesCount),Xe=a.b8.simpleSegment(0,0,4*ot,2*ot);j.draw(t,F.TRIANGLES,_n.disabled,Bn.disabled,Xn.alphaBlended,Dn.disabled,Me,"rain_particles",this.particlesVx,this.particlesIdx,Xe)};v.distortionStrength>0&&Q(v.boxSize,!0),Q(v.boxSize,!1),this._vignette.draw(t,R)}}const Cm=a.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class ch extends ou{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new lh(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const i=t.context;if(!this.particlesVx){const d=Lf(this.particlesCount),m=new a.dx,v=new a.aV;let w=0;const R=a.dl(1323123451230);for(let N=0;N<d.length;++N){const P=d[N],F=R(),V=R(),j=R(),Z=[N/d.length,F,V,j],Q=[R(),R()];m.emplaceBack(P[0],P[1],P[2],-1,-1,...Z,...Q),m.emplaceBack(P[0],P[1],P[2],1,-1,...Z,...Q),m.emplaceBack(P[0],P[1],P[2],1,1,...Z,...Q),m.emplaceBack(P[0],P[1],P[2],-1,1,...Z,...Q),v.emplaceBack(w+0,w+1,w+2),v.emplaceBack(w+0,w+2,w+3),w+=4}this.particlesVx=i.createVertexBuffer(m,Cm.members),this.particlesIdx=i.createIndexBuffer(v)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const i=structuredClone(this._params);let d=[-i.direction.x,i.direction.y,-100];a.ad.vec3.normalize(d,d);const m=structuredClone(this._vignetteParams),v=i.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},w=t.transform.zoom;if(v.revealStart>w)return;const R=Fs(0,1,v.revealStart,v.revealStart+v.revealRange,w);m.strength*=R,i.overrideStyleParameters||(i.intensity=t.style.snow.state.density,i.timeFactor=t.style.snow.state.intensity,i.color=structuredClone(t.style.snow.state.color),d=structuredClone(t.style.snow.state.direction),i.screenThinning.intensity=t.style.snow.state.centerThinning,i.billboardSize=2.79*t.style.snow.state.flakeSize,m.strength=1,m.color=structuredClone(t.style.snow.state.vignetteColor));const N=this.updateOnRender(t,i.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const P=t.context,F=P.gl,V=t.transform,j=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(P,j),((Z,Q,K)=>{const te=Am(this._movement.getPosition(),Z),re=V.width/2,pe=V.height/2,be=Fs(0,K.screenThinning.start,0,1,K.screenThinning.intensity),ye=Fs(.001,K.screenThinning.range,0,1,K.screenThinning.intensity),Ae=Fs(0,K.screenThinning.particleOffset,0,1,K.screenThinning.intensity),ve=(Se={modelview:N.modelviewMatrix,projection:N.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:te,velocityConeAperture:K.velocityConeAperture,velocity:K.velocity,horizontalOscillationRadius:K.horizontalOscillationRadius,horizontalOscillationRate:K.horizontalOscillationRate,boxSize:Z,billboardSize:1*K.billboardSize,simpleShapeParameters:[K.shapeFadeStart,K.shapeFadePower],screenSize:[V.width,V.height],thinningCenterPos:[re,pe],thinningShape:[be,ye,Math.pow(10,K.screenThinning.fadePower)],thinningAffectedRatio:K.screenThinning.affectedRatio,thinningParticleOffset:Ae,color:[K.color.r,K.color.g,K.color.b,K.color.a],direction:d},{u_modelview:Float32Array.from(Se.modelview),u_projection:Float32Array.from(Se.projection),u_time:Se.time,u_cam_pos:Se.camPos,u_velocityConeAperture:Se.velocityConeAperture,u_velocity:Se.velocity,u_horizontalOscillationRadius:Se.horizontalOscillationRadius,u_horizontalOscillationRate:Se.horizontalOscillationRate,u_boxSize:Se.boxSize,u_billboardSize:Se.billboardSize,u_simpleShapeParameters:Se.simpleShapeParameters,u_screenSize:Se.screenSize,u_thinningCenterPos:Se.thinningCenterPos,u_thinningShape:Se.thinningShape,u_thinningAffectedRatio:Se.thinningAffectedRatio,u_thinningParticleOffset:Se.thinningParticleOffset,u_particleColor:Se.color,u_direction:Se.direction});var Se;const Te=Math.round(K.intensity*this.particlesCount),Me=a.b8.simpleSegment(0,0,4*Te,2*Te);this.particlesVx&&this.particlesIdx&&j.draw(t,F.TRIANGLES,_n.disabled,Bn.disabled,Xn.alphaBlended,Dn.disabled,ve,"snow_particles",this.particlesVx,this.particlesIdx,Me)})(i.boxSize,0,i),this._vignette.draw(t,m)}}const uh={symbol:function(h,t,i,d,m){if(h.renderPass!=="translucent")return;const v=Bn.disabled,w=h.colorModeForRenderPass(),R=i.layout.get("text-variable-anchor"),N=i.layout.get("text-size-scale-range"),P=a.ay(h.scaleFactor,N[0],N[1]);R&&function(j,Z,Q,K,te,re,pe,be){const ye=Z.transform,Ae=te==="map",ve=re==="map";for(const Se of j){const Te=K.getTile(Se),Me=Te.getBucket(Q);if(!Me||!Me.text||!Me.text.segments.get().length)continue;const ze=a.bp(Me.textSizeData,ye.zoom,be),ot=zs(Se,Me.getProjection(),ye),Xe=ye.calculatePixelsToTileUnitsMatrix(Te),ft=Sl(ot,Te.tileID.canonical,ve,Ae,ye,Me.getProjection(),Xe),gt=Me.hasIconTextFit()&&Me.hasIconData();if(ze){const Mt=Math.pow(2,ye.zoom-Te.tileID.overscaledZ);vo(Me,Ae,ve,pe,a.cY,ye,ft,Se,Mt,ze,gt)}}}(d,h,i,t,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),m,P);const F=i.paint.get("icon-opacity").constantOr(1)!==0,V=i.paint.get("text-opacity").constantOr(1)!==0;i.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(F||V)?Hr(h,t,i,d,v,w):(F&&Hr(h,t,i,d,v,w,{onlyIcons:!0}),V&&Hr(h,t,i,d,v,w,{onlyText:!0})),t.map.showCollisionBoxes&&(td(h,t,i,d,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),!0),td(h,t,i,d,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),!1))},circle:function(h,t,i,d){if(h.renderPass!=="translucent")return;const m=i.paint.get("circle-opacity"),v=i.paint.get("circle-stroke-width"),w=i.paint.get("circle-stroke-opacity"),R=i.layout.get("circle-sort-key").constantOr(1)!==void 0,N=i.paint.get("circle-emissive-strength");if(m.constantOr(1)===0&&(v.constantOr(1)===0||w.constantOr(1)===0))return;const P=h.context,F=P.gl,V=h.transform,j=h.depthModeForSublayer(0,_n.ReadOnly),Z=Bn.disabled,Q=h.colorModeForDrapableLayerRenderPass(N),K=V.projection.name==="globe",te=[a.av(V.center.lng),a.aC(V.center.lat)],re=[];for(let be=0;be<d.length;be++){const ye=d[be],Ae=t.getTile(ye),ve=Ae.getBucket(i);if(!ve||ve.projection.name!==V.projection.name)continue;const Se=ve.programConfigurations.get(i.id),Te=a.cZ(i),Me=h.isTileAffectedByFog(ye);K&&Te.push("PROJECTION_GLOBE_VIEW"),Te.push("DEPTH_D24"),h.terrain&&V.depthOcclusionForSymbolsAndCircles&&Te.push("DEPTH_OCCLUSION");const ze=h.getOrCreateProgram("circle",{config:Se,defines:Te,overrideFog:Me}),ot=ve.layoutVertexBuffer,Xe=ve.globeExtVertexBuffer,ft=ve.indexBuffer,gt=V.projection.createInversionMatrix(V,ye.canonical),Mt={programConfiguration:Se,program:ze,layoutVertexBuffer:ot,globeExtVertexBuffer:Xe,indexBuffer:ft,uniformValues:a.c_(h,ye,Ae,gt,te,i),tile:Ae};if(R){const He=ve.segments.get();for(const mt of He)re.push({segments:new a.b8([mt]),sortKey:mt.sortKey,state:Mt})}else re.push({segments:ve.segments,sortKey:0,state:Mt})}R&&re.sort((be,ye)=>be.sortKey-ye.sortKey);const pe={useDepthForOcclusion:V.depthOcclusionForSymbolsAndCircles};for(const be of re){const{programConfiguration:ye,program:Ae,layoutVertexBuffer:ve,globeExtVertexBuffer:Se,indexBuffer:Te,uniformValues:Me,tile:ze}=be.state,ot=be.segments;h.terrain&&h.terrain.setupElevationDraw(ze,Ae,pe),h.uploadCommonUniforms(P,Ae,ze.tileID.toUnwrapped()),Ae.draw(h,F.TRIANGLES,j,Z,Q,Dn.disabled,Me,i.id,ve,Te,ot,i.paint,V.zoom,ye,[Se])}},heatmap:function(h,t,i,d){if(i.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const m=h.context,v=m.gl,w=Bn.disabled,R=new Xn([v.ONE,v.ONE,v.ONE,v.ONE],a.al.transparent,[!0,!0,!0,!0]);(function(Z,Q,K,te){const re=Z.gl,pe=Q.width*te,be=Q.height*te;Z.activeTexture.set(re.TEXTURE1),Z.viewport.set([0,0,pe,be]);let ye=K.heatmapFbo;if(!ye||ye&&(ye.width!==pe||ye.height!==be)){ye&&ye.destroy();const Ae=re.createTexture();re.bindTexture(re.TEXTURE_2D,Ae),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_WRAP_S,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_WRAP_T,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_MIN_FILTER,re.LINEAR),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_MAG_FILTER,re.LINEAR),ye=K.heatmapFbo=Z.createFramebuffer(pe,be,!0,null),function(ve,Se,Te,Me,ze,ot){const Xe=ve.gl;Xe.texImage2D(Xe.TEXTURE_2D,0,ve.extRenderToTextureHalfFloat?Xe.RGBA16F:Xe.RGBA,ze,ot,0,Xe.RGBA,ve.extRenderToTextureHalfFloat?Xe.HALF_FLOAT:Xe.UNSIGNED_BYTE,null),Me.colorAttachment.set(Te)}(Z,0,Ae,ye,pe,be)}else re.bindTexture(re.TEXTURE_2D,ye.colorAttachment.get()),Z.bindFramebuffer.set(ye.framebuffer)})(m,h,i,h.transform.projection.name==="globe"?.5:.25),m.clear({color:a.al.transparent});const N=h.transform,P=N.projection.name==="globe",F=P?["PROJECTION_GLOBE_VIEW"]:[],V=P?Dn.frontCCW:Dn.disabled,j=[a.av(N.center.lng),a.aC(N.center.lat)];for(let Z=0;Z<d.length;Z++){const Q=d[Z];if(t.hasRenderableParent(Q))continue;const K=t.getTile(Q),te=K.getBucket(i);if(!te||te.projection.name!==N.projection.name)continue;const re=h.isTileAffectedByFog(Q),pe=te.programConfigurations.get(i.id),be=h.getOrCreateProgram("heatmap",{config:pe,defines:F,overrideFog:re}),{zoom:ye}=h.transform;h.terrain&&h.terrain.setupElevationDraw(K,be),h.uploadCommonUniforms(m,be,Q.toUnwrapped());const Ae=N.projection.createInversionMatrix(N,Q.canonical);be.draw(h,v.TRIANGLES,_n.disabled,w,R,V,kf(h,Q,K,Ae,j,ye,i.paint.get("heatmap-intensity")),i.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,i.paint,h.transform.zoom,pe,P?[te.globeExtVertexBuffer]:null)}m.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(m,v){const w=m.context,R=w.gl,N=v.heatmapFbo;if(!N)return;w.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,N.colorAttachment.get()),w.activeTexture.set(R.TEXTURE1);let P=v.colorRampTexture;P||(P=v.colorRampTexture=new a.T(w,v.colorRamp,R.RGBA8)),P.bind(R.LINEAR,R.CLAMP_TO_EDGE),m.getOrCreateProgram("heatmapTexture").draw(m,R.TRIANGLES,_n.disabled,Bn.disabled,m.colorModeForRenderPass(),Dn.disabled,((F,V,j,Z)=>({u_image:0,u_color_ramp:1,u_opacity:V.paint.get("heatmap-opacity")}))(0,v),v.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,v.paint,m.transform.zoom)}(h,i))},line:function(h,t,i,d){if(h.renderPass!=="translucent")return;const m=i.paint.get("line-opacity"),v=i.paint.get("line-width");if(m.constantOr(1)===0||v.constantOr(1)===0)return;const w=i.paint.get("line-emissive-strength"),R=i.paint.get("line-occlusion-opacity"),N=i.layout.get("line-elevation-reference"),P=i.layout.get("line-width-unit")==="meters",F=N==="sea",V=h.context,j=V.gl;if(i.hasElevatedBuckets&&h.transform.projection.name==="globe")return;const Z=i.layout.get("line-cross-slope"),Q=Z!==void 0,K=Z<1,te=h.colorModeForDrapableLayerRenderPass(w),re=h.terrain&&h.terrain.renderingToTexture,pe=re?1:a.q.devicePixelRatio,be=i.paint.get("line-dasharray"),ye=be.constantOr(1),Ae=i.layout.get("line-cap"),ve=be.constantOr(null),Se=Ae.constantOr(null),Te=i.paint.get("line-pattern"),Me=Te.constantOr(1),ze=Te.constantOr(null),ot=i.paint.get("line-opacity").constantOr(1);let Xe=!Me&&ot!==1||h.depthOcclusion&&R>0&&R<1;const ft=i.paint.get("line-gradient"),gt=Me?"linePattern":"line",Mt=a.c$(i);let He;if(re&&h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(Xe=!1),R!==0&&h.depthOcclusion){const qe=i.paint._values["line-opacity"];qe&&qe.value&&qe.value.kind==="constant"?He=qe.value:a.w(`Occlusion opacity for layer ${i.id} is supported only when line-opacity isn't data-driven.`)}v.value.kind!=="constant"&&v.value.isLineProgressConstant===!1&&Mt.push("VARIABLE_LINE_WIDTH");const mt=(qe,pt,lt,yt,st,dt)=>{for(const Ht of qe){const kt=t.getTile(Ht);if(Me&&!kt.patternsLoaded())continue;const Wt=kt.getBucket(i);if(!Wt||Wt.hasZOffset&&!st||!Wt.hasZOffset&&st)continue;h.prepareDrawTile();const hn=Wt.programConfigurations.get(i.id),In=h.isTileAffectedByFog(Ht),bn=h.getOrCreateProgram(gt,{config:hn,defines:pt,overrideFog:In,overrideRtt:!st&&void 0});if(ze&&kt.imageAtlas){const Pn=a.d0.from(ze).getPrimary().scaleSelf(pe).toString(),fn=kt.imageAtlas.patternPositions.get(Pn);fn&&hn.setConstantPatternPositions(fn)}if(!Me&&ve&&Se&&kt.lineAtlas){const Pn=kt.lineAtlas.getDash(ve,Se);Pn&&hn.setConstantPatternPositions(Pn)}let[Tn,Mn]=i.paint.get("line-trim-offset");(Se==="round"||Se==="square")&&Tn!==Mn&&(Tn===0&&(Tn-=1),Mn===1&&(Mn+=1));const tr=re?Ht.projMatrix:null,yr=P?1/Wt.tileToMeter/a.at(kt,1,h.transform.zoom):1,Gr=P?1/Wt.tileToMeter/a.at(kt,1,Math.floor(h.transform.zoom)):1,Kn=Me?a.d1(h,kt,i,tr,pe,yr,Gr,[Tn,Mn]):a.d2(h,kt,i,tr,Wt.lineClipsArray.length,pe,yr,Gr,[Tn,Mn]);if(ft){const Pn=Wt.gradients[i.id];let fn=Pn.texture;if(i.gradientVersion!==Pn.version){let ar=256;if(i.stepInterpolant){const Dr=t.getSource().maxzoom,vr=Ht.canonical.z===Dr?Math.ceil(1<<h.transform.maxZoom-Ht.canonical.z):1;ar=a.ay(a.d3(Wt.maxLineLength/a.ai*1024*vr),256,V.maxTextureSize)}Pn.gradient=a.d4({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:ar,image:Pn.gradient||void 0,clips:Wt.lineClipsArray}),Pn.texture?Pn.texture.update(Pn.gradient):Pn.texture=new a.T(V,Pn.gradient,j.RGBA8),Pn.version=i.gradientVersion,fn=Pn.texture}V.activeTexture.set(j.TEXTURE1),fn.bind(i.stepInterpolant?j.NEAREST:j.LINEAR,j.CLAMP_TO_EDGE)}ye&&(V.activeTexture.set(j.TEXTURE0),kt.lineAtlasTexture&&kt.lineAtlasTexture.bind(j.LINEAR,j.REPEAT),hn.updatePaintBuffers()),Me&&(V.activeTexture.set(j.TEXTURE0),kt.imageAtlasTexture&&kt.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),hn.updatePaintBuffers()),st&&!F&&h.terrain.setupElevationDraw(kt,bn),h.uploadCommonUniforms(V,bn,Ht.toUnwrapped());const ci=Pn=>{He!=null&&(He.value=ot*R),bn.draw(h,j.TRIANGLES,lt,Pn,te,Dn.disabled,Kn,i.id,Wt.layoutVertexBuffer,Wt.indexBuffer,Wt.segments,i.paint,h.transform.zoom,hn,[Wt.layoutVertexBuffer2,Wt.patternVertexBuffer,Wt.zOffsetVertexBuffer]),He!=null&&(He.value=ot)};if(Xe&&!st){const Pn=h.stencilModeForClipping(Ht).ref;Pn===0&&re&&V.clear({stencil:0});const fn={func:j.EQUAL,mask:255};Kn.u_alpha_discard_threshold=.8,ci(new Bn(fn,Pn,255,j.KEEP,j.KEEP,j.INVERT)),Kn.u_alpha_discard_threshold=0,ci(new Bn(fn,Pn,255,j.KEEP,j.KEEP,j.KEEP))}else Kn.u_alpha_discard_threshold=Xe&&st&&dt?.8:0,ci(st?yt:h.stencilModeForClipping(Ht))}};if(i.hasNonElevatedBuckets){const qe=!re&&h.terrain;R!==0&&qe?a.w(`Occlusion opacity for layer ${i.id} is supported on terrain only if the layer has line-z-offset enabled.`):qe?a.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${i.id}.`):mt(d,Mt,h.depthModeForSublayer(0,_n.ReadOnly),Bn.disabled,!1,!0)}if(i.hasElevatedBuckets){Mt.push("ELEVATED"),Q&&Mt.push(K?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),F&&Mt.push("ELEVATION_REFERENCE_SEA");const qe=Xe?h.stencilModeFor3D():Bn.disabled,pt=new _n(h.depthOcclusion?j.GREATER:j.LEQUAL,_n.ReadOnly,h.depthRangeFor3D);h.forceTerrainMode=!0,mt(d,Mt,pt,qe,!0,!0),Xe&&mt(d,Mt,pt,qe,!0,!1),h.forceTerrainMode=!1}Xe&&(h.resetStencilClippingMasks(),re&&V.clear({stencil:0})),R===0||h.depthOcclusion||re||h.layersWithOcclusionOpacity.push(h.currentLayer)},fill:function(h,t,i,d){const m=i.paint.get("fill-color"),v=i.paint.get("fill-opacity");if(v.constantOr(1)===0)return;const w=i.paint.get("fill-emissive-strength"),R=h.colorModeForDrapableLayerRenderPass(w),N=i.paint.get("fill-pattern"),P=h.opaquePassEnabledForLayer()&&!N.constantOr(1)&&m.constantOr(a.al.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";let F="none";i.layout.get("fill-elevation-reference")!=="none"?F="road":i.paint.get("fill-z-offset").constantOr(1)!==0&&(F="offset");const V=!(!h.terrain||!h.terrain.enabled),j={painter:h,sourceCache:t,layer:i,coords:d,colorMode:R,elevationType:F,terrainEnabled:V,pass:P};if(F!=="offset"){if(ih(j,!1),F==="road"){const Z=!V&&h.renderPass==="translucent";Z&&rh(h,t,i,d,"geometry"),ih(j,!0,Bn.disabled),Z&&function(Q){const{painter:K,sourceCache:te,layer:re,coords:pe,colorMode:be}=Q,ye=K.context.gl,Ae=new _n(K.context.gl.LEQUAL,_n.ReadOnly,K.depthRangeFor3D);for(const ve of pe){const Se=te.getTile(ve),Te=Se.getBucket(re);if(!Te)continue;const Me=Te.elevatedStructures;if(!Me||!Me.renderableSegments||Me.renderableSegments.segments[0].primitiveLength===0)continue;K.prepareDrawTile();const ze=Te.bufferData.programConfigurations.get(re.id),ot=K.isTileAffectedByFog(ve),Xe=K.getOrCreateProgram("elevatedStructures",{config:ze,overrideFog:ot,defines:["NORMAL_OFFSET"]}),ft={u_matrix:K.translatePosMatrix(ve.projMatrix,Se,re.paint.get("fill-translate"),re.paint.get("fill-translate-anchor"))};K.uploadCommonUniforms(K.context,Xe,ve.toUnwrapped()),Xe.draw(K,ye.TRIANGLES,Ae,Bn.disabled,be,Dn.backCCW,ft,re.id,Me.vertexBuffer,Me.indexBuffer,Me.renderableSegments,re.paint,K.transform.zoom,ze,[Me.vertexBufferNormal])}}(j)}}else ih(j,!1,h.stencilModeFor3D())},"fill-extrusion":function(h,t,i,d){const m=i.paint.get("fill-extrusion-opacity"),v=h.context,w=v.gl,R=h.terrain,N=R&&R.renderingToTexture;if(m===0)return;const P=h.conflationActive&&h.style.isLayerClipped(i,t.getSource()),F=h.style.order.indexOf(i.fqid);if(P&&function(V,j,Z,Q,K){for(const te of Q){const re=j.getTile(te).getBucket(Z);re&&(re.updateReplacement(te,V.replacementSource,K),re.uploadCentroid(V.context))}}(h,t,i,d,F),R||P)for(const V of d){const j=t.getTile(V).getBucket(i);j&&od(h.context,t,V,j,i,R,P)}if(h.renderPass==="shadow"&&h.shadowRenderer){const V=h.shadowRenderer;if(R&&m<.65&&i._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof a.ab)return;const j=V.getShadowPassDepthMode(),Z=V.getShadowPassColorMode();rd(h,t,i,d,j,Bn.disabled,Z,P)}else if(h.renderPass==="translucent"){const V=!i.paint.get("fill-extrusion-pattern").constantOr(1),j=i.paint.get("fill-extrusion-color").constantOr(a.al.white);if(!N&&j.a!==0){const Z=new _n(h.context.gl.LEQUAL,_n.ReadWrite,h.depthRangeFor3D);m===1&&V?rd(h,t,i,d,Z,Bn.disabled,Xn.unblended,P):(rd(h,t,i,d,Z,Bn.disabled,Xn.disabled,P),rd(h,t,i,d,Z,h.stencilModeFor3D(),h.colorModeForRenderPass(),P),h.resetStencilClippingMasks())}if(h.style.enable3dLights()&&V&&(!R&&h.transform.projection.name!=="globe"||N)){const Z=i.paint.get("fill-extrusion-opacity"),Q=i.paint.get("fill-extrusion-ambient-occlusion-intensity"),K=i.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),te=i.paint.get("fill-extrusion-flood-light-intensity"),re=i.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",pe=i.paint.get("fill-extrusion-flood-light-color").toRenderColor(re?null:i.lut).toArray01().slice(0,3),be=Q>0&&K>0,ye=te>0,Ae=(Se,Te,Me)=>(1-Me)*Se+Me*Te,ve=Se=>{const Te=h.depthModeForSublayer(1,_n.ReadOnly,w.LEQUAL,!0),Me=i.paint.get(Se?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ze=Ae(.1,3,Me),ot=h._showOverdrawInspector;if(!ot){const Xe=new Bn({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),ft=new Xn([w.ONE,w.ONE,w.ONE,w.ONE],a.al.transparent,[!1,!1,!1,!0],w.MIN);id(h,t,i,d,Te,Xe,ft,Dn.disabled,Se,"sdf",Z,Q,K,te,pe,ze,P,!1)}{const Xe=ot?Bn.disabled:new Bn({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),ft=ot?h.colorModeForRenderPass():new Xn([w.ONE_MINUS_DST_ALPHA,w.DST_ALPHA,w.ONE,w.ONE],a.al.transparent,[!0,!0,!0,!0]);id(h,t,i,d,Te,Xe,ft,Dn.disabled,Se,"color",Z,Q,K,te,pe,ze,P,!1)}};if(N){const Se=(Te,Me,ze)=>{const ot=h.depthModeForSublayer(1,_n.ReadOnly,w.LEQUAL,!1),Xe=i.paint.get(Te?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ft=Ae(.1,3,Xe);{const gt=new Xn([w.ONE,w.ONE,w.ONE,w.ONE],a.al.transparent,[!1,!1,!1,!0]);id(h,t,i,d,ot,Bn.disabled,gt,Dn.disabled,Te,"clear",Z,Q,K,te,pe,ft,P,Me)}{const gt=new Bn({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),Mt=new Xn([w.ONE,w.ONE,w.ONE,w.ONE],a.al.transparent,[!1,!1,!1,!0],w.MIN);id(h,t,i,d,ot,gt,Mt,Dn.disabled,Te,"sdf",Z,Q,K,te,pe,ft,P,Me)}{const gt=Te?w.ZERO:w.ONE_MINUS_DST_ALPHA,Mt=new Bn({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),He=new Xn([gt,w.DST_ALPHA,w.ONE_MINUS_DST_ALPHA,w.ZERO],a.al.transparent,[!0,!0,!0,!0]);id(h,t,i,d,ot,Mt,He,Dn.disabled,Te,"color",Z,Q,K,te,pe,ft,P,Me)}{const gt=new Xn([w.ONE,w.ONE,w.ONE,Te?w.ZERO:w.ONE],a.al.transparent,[!1,!1,!1,!0],Te?w.FUNC_ADD:w.MAX);id(h,t,i,d,ot,Bn.disabled,gt,Dn.disabled,Te,"clear",Z,Q,K,te,pe,ft,P,Me,ze)}};if(be||ye){let Te;if(h.prepareDrawTile(),R){const Me=R.drapeBufferSize[0],ze=R.drapeBufferSize[1];Te=R.framebufferCopyTexture,Te&&(!Te||Te.size[0]===Me&&Te.size[1]===ze)||(Te&&Te.destroy(),Te=R.framebufferCopyTexture=new a.T(v,new a.r({width:Me,height:ze}),w.RGBA8)),Te.bind(w.LINEAR,w.CLAMP_TO_EDGE),w.copyTexSubImage2D(w.TEXTURE_2D,0,0,0,0,0,Me,ze)}be&&Se(!0,!1,Te),ye&&Se(!1,!0,Te)}}else be&&ve(!0),ye&&ve(!1),(be||ye)&&h.resetStencilClippingMasks()}}},hillshade:function(h,t,i,d){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent"||h.style.disableElevatedTerrain)return;const m=h.context,v=h.terrain&&h.terrain.renderingToTexture,[w,R]=h.renderPass!=="translucent"||v?[{},d]:h.stencilConfigForOverlap(d);for(const N of R){const P=t.getTile(N);if(P.needsHillshadePrepare&&h.renderPass==="offscreen")Ig(h,P,i);else if(h.renderPass==="translucent"){const F=h.depthModeForSublayer(0,_n.ReadOnly),V=i.paint.get("hillshade-emissive-strength"),j=h.colorModeForDrapableLayerRenderPass(V),Z=v&&h.terrain?h.terrain.stencilModeForRTTOverlap(N):w[N.overscaledZ];qu(h,N,P,i,F,Z,j)}}m.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,t,i,d,m,v){if(h.renderPass!=="translucent"||i.paint.get("raster-opacity")===0)return;const w=h.transform.projection.name==="globe",R=i.paint.get("raster-elevation")!==0,N=R&&w;if(h.renderElevatedRasterBackface&&!N)return;const P=h.context,F=P.gl,V=t.getSource(),j=function(ve,Se,Te,Me){const ze=Se.paint.get("raster-color"),ot=ve.type==="raster-array",Xe=[],ft=Se.paint.get("raster-resampling"),gt=Se.paint.get("raster-color-mix");let Mt=Se.paint.get("raster-color-range");const He=[gt[0],gt[1],gt[2],0],mt=gt[3];let qe=ft==="nearest"?Me.NEAREST:Me.LINEAR;if(ot&&(Xe.push("RASTER_ARRAY"),ze||Xe.push("RASTER_COLOR"),ft==="linear"&&Xe.push("RASTER_ARRAY_LINEAR"),qe=Me.NEAREST,!Mt&&ve.rasterLayers)){const pt=ve.rasterLayers.find(({id:lt})=>lt===Se.sourceLayer);pt&&pt.fields&&pt.fields.range&&(Mt=pt.fields.range)}if(Mt=Mt||[0,1],ze){Xe.push("RASTER_COLOR"),Te.activeTexture.set(Me.TEXTURE2),Se.updateColorRamp(Mt);let pt=Se.colorRampTexture;pt||(pt=Se.colorRampTexture=new a.T(Te,Se.colorRamp,Me.RGBA8)),pt.bind(Me.LINEAR,Me.CLAMP_TO_EDGE)}return{mix:He,range:Mt,offset:mt,defines:Xe,resampling:qe}}(V,i,P,F);if(V instanceof a.aK&&!d.length&&!w)return;const Z=i.paint.get("raster-emissive-strength"),Q=h.colorModeForDrapableLayerRenderPass(Z),K=h.terrain&&h.terrain.renderingToTexture,te=!h.options.moving,re=i.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;if(V instanceof a.aK&&!d.length&&(V.onNorthPole||V.onSouthPole)){const ve=R?h.stencilModeFor3D():Bn.disabled;return void Qe(!!V.onNorthPole,null,h,t,i,Z,j,Dn.disabled,ve)}if(!d.length)return;const[pe,be]=V instanceof a.aK||K?[{},d]:h.stencilConfigForOverlap(d),ye=be[be.length-1].overscaledZ;N&&j.defines.push("PROJECTION_GLOBE_VIEW"),R&&j.defines.push("RENDER_CUTOFF");const Ae=(ve,Se,Te)=>{for(const Me of ve){const ze=Me.toUnwrapped(),ot=t.getTile(Me);if(K&&(!ot||!ot.hasData()))continue;P.activeTexture.set(F.TEXTURE0);const Xe=oh(ot,V,i,j);if(!Xe||!Xe.texture)continue;const{texture:ft,mix:gt,offset:Mt,tileSize:He,buffer:mt}=Xe;let qe,pt;K?(qe=_n.disabled,pt=Me.projMatrix):R?(qe=new _n(F.LEQUAL,_n.ReadWrite,h.depthRangeFor3D),pt=w?Float32Array.from(h.transform.expandedFarZProjMatrix):h.transform.calculateProjMatrix(ze,te)):(qe=h.depthModeForSublayer(Me.overscaledZ-ye,i.paint.get("raster-opacity")===1?_n.ReadWrite:_n.ReadOnly,F.LESS),pt=h.transform.calculateProjMatrix(ze,te));const lt=h.terrain&&K?h.terrain.stencilModeForRTTOverlap(Me):pe[Me.overscaledZ],yt=v?0:i.paint.get("raster-fade-duration");ot.registerFadeDuration(yt);const st=t.findLoadedParent(Me,0),dt=yc(ot,st,t,h.transform,yt);let Ht,kt;h.terrain&&h.terrain.prepareDrawTile(),P.activeTexture.set(F.TEXTURE0),ft.bind(re,F.CLAMP_TO_EDGE),P.activeTexture.set(F.TEXTURE1),st?(st.texture&&st.texture.bind(re,F.CLAMP_TO_EDGE),Ht=Math.pow(2,st.tileID.overscaledZ-ot.tileID.overscaledZ),kt=[ot.tileID.canonical.x*Ht%1,ot.tileID.canonical.y*Ht%1]):ft.bind(re,F.CLAMP_TO_EDGE),"useMipmap"in ft&&P.extTextureFilterAnisotropic&&h.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,P.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,P.extTextureFilterAnisotropicMax);const Wt=h.transform;let hn;const In=R?_m(Wt):[0,0,0,0];let bn,Tn,Mn,tr,yr,Gr=0;if(N&&V instanceof a.aK&&V.coordinates.length>3)bn=Float32Array.from(a.bc(a.cI(new a.bT(0,0,0)))),Tn=Float32Array.from(Wt.globeMatrix),Mn=Float32Array.from(a.cE(Wt)),tr=[a.av(Wt.center.lng),a.aC(Wt.center.lat)],hn=V.elevatedGlobePerspectiveTransform,yr=V.elevatedGlobeGridMatrix||new Float32Array(9);else if(N){const fn=a.cF(Me.canonical);Gr=a.cG(fn.getCenter().lat),bn=Float32Array.from(a.bc(a.cI(Me.canonical))),Tn=Float32Array.from(Wt.globeMatrix),Mn=Float32Array.from(a.cE(Wt)),tr=[a.av(Wt.center.lng),a.aC(Wt.center.lat)],hn=[0,0],yr=Float32Array.from(a.cH(Me.canonical,fn,Gr,Wt.worldSize/Wt._pixelsPerMercatorPixel))}else hn=V instanceof a.aK?V.perspectiveTransform:[0,0],bn=new Float32Array(16),Tn=new Float32Array(9),Mn=new Float32Array(16),tr=[0,0],yr=new Float32Array(9);const Kn=hm(pt,bn,Tn,Mn,yr,kt||[0,0],a.ag(h.transform.zoom),tr,In,Ht||1,dt,i,hn,R?i.paint.get("raster-elevation"):0,2,gt,Mt,j.range,He,mt,Z),ci=h.isTileAffectedByFog(Me),Pn=h.getOrCreateProgram("raster",{defines:j.defines,overrideFog:ci});if(h.uploadCommonUniforms(P,Pn,ze),V instanceof a.aK){const fn=V.elevatedGlobeVertexBuffer,ar=V.elevatedGlobeIndexBuffer;if(K||!w)V.boundsBuffer&&V.boundsSegments&&Pn.draw(h,F.TRIANGLES,qe,Bn.disabled,Q,Dn.disabled,Kn,i.id,V.boundsBuffer,h.quadTriangleIndexBuffer,V.boundsSegments);else if(fn&&ar){const Dr=Wt.zoom<=a.c6?V.elevatedGlobeSegments:V.getSegmentsForLongitude(Wt.center.lng);Dr&&Pn.draw(h,F.TRIANGLES,qe,Bn.disabled,Q,Se,Kn,i.id,fn,ar,Dr)}}else if(N){qe=new _n(F.LEQUAL,_n.ReadOnly,h.depthRangeFor3D);const fn=h.globeSharedBuffers;if(fn){const[ar,Dr,vr]=fn.getGridBuffers(Gr,!1);Pn.draw(h,F.TRIANGLES,qe,Te||lt,h.colorModeForRenderPass(),Se,Kn,i.id,ar,Dr,vr)}}else{const{tileBoundsBuffer:fn,tileBoundsIndexBuffer:ar,tileBoundsSegments:Dr}=h.getTileBoundsBuffers(ot);Pn.draw(h,F.TRIANGLES,qe,lt,Q,Dn.disabled,Kn,i.id,fn,ar,Dr)}}if(!(V instanceof a.aK)&&N)for(const Me of ve){const ze=Me.canonical.y===(1<<Me.canonical.z)-1;Me.canonical.y===0&&Qe(!0,Me,h,t,i,Z,j,Se,Te||Bn.disabled),ze&&Qe(!1,Me,h,t,i,Z,j,Se===Dn.frontCW?Dn.backCW:Dn.frontCW,Te||Bn.disabled)}};N?Ae(be,h.renderElevatedRasterBackface?Dn.backCW:Dn.frontCW,h.stencilModeFor3D()):Ae(be,Dn.disabled,void 0),h.resetStencilClippingMasks()},"raster-particle":function(h,t,i,d,m,v){h.renderPass==="offscreen"&&function(w,R,N,P){if(!P.length)return;const F=w.context,V=F.gl,j=R.getSource();if(!(j instanceof Va))return;const Z=Math.ceil(Math.sqrt(N.paint.get("raster-particle-count")));let Q=N.particlePositionRGBAImage;if(!Q||Q.width!==Z){const be=function(ye){const Ae=ye*ye,ve=new Uint8Array(4*Ae),Se=function(Me){return Me|=0,Me=Math.imul(2747636419^Me,2654435769),Me=Math.imul(Me^Me>>>16,2654435769),((Me=Math.imul(Me^Me>>>16,2654435769))>>>0)/4294967296},Te=1/1.1;for(let Me=0;Me<Ae;Me++){const ze=Te*(Se(2*Me+0)+ms),ot=Te*(Se(2*Me+1)+ms),Xe=255*ze%1,ft=255*ot%1,gt=Xe,Mt=ot-ft/255,He=ft;ve[4*Me+0]=255*(ze-Xe/255),ve[4*Me+1]=255*gt,ve[4*Me+2]=255*Mt,ve[4*Me+3]=255*He}return ve}(Z);Q=N.particlePositionRGBAImage=new a.r({width:Z,height:Z},be)}let K=N.particleFramebuffer;K?K.width!==Z&&(K.destroy(),K=N.particleFramebuffer=F.createFramebuffer(Z,Z,!0,null)):K=N.particleFramebuffer=F.createFramebuffer(Z,Z,!0,null);const te=[];for(const be of P){const ye=R.getTile(be);if(!(ye instanceof go))continue;const Ae=zo(ye,j,N);if(!Ae)continue;const ve=[ye.tileSize,ye.tileSize];let Se=N.tileFramebuffer;Se||(Se=N.tileFramebuffer=F.createFramebuffer(ve[0],ve[1],!0,null));let Te=ye.rasterParticleState;Te||(Te=ye.rasterParticleState=new Vg(F,be,ve,Q));const Me=Te.update(N.lastInvalidatedAt);Te.particleTextureDimension!==Z&&Te.updateParticleTexture(be,Q);const ze=Te.targetColorTexture;Te.targetColorTexture=Te.backgroundColorTexture,Te.backgroundColorTexture=ze;const ot=Te.particleTexture0;Te.particleTexture0=Te.particleTexture1,Te.particleTexture1=ot,te.push([be,Ae,Te,Me])}if(te.length===0)return;const re=a.q.now(),pe=N.previousDrawTimestamp?.001*(re-N.previousDrawTimestamp):.0167;if(N.previousDrawTimestamp=re,N.hasColorMap()){F.activeTexture.set(V.TEXTURE0+2);let be=N.colorRampTexture;be||(be=N.colorRampTexture=new a.T(F,N.colorRamp,V.RGBA8)),be.bind(V.LINEAR,V.CLAMP_TO_EDGE)}F.bindFramebuffer.set(N.tileFramebuffer.framebuffer),function(be,ye,Ae){const ve=be.context,Se=ve.gl,Te=ye.tileFramebuffer;ve.activeTexture.set(Se.TEXTURE0);const Me={u_texture:0,u_opacity:1.05*(ot=ye.paint.get("raster-particle-fade-opacity-factor"))/(ot+.05)},ze=be.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ot;for(const Xe of Ae){const[,,ft,gt]=Xe;Te.colorAttachment.set(ft.targetColorTexture.texture),ve.viewport.set([0,0,Te.width,Te.height]),ve.clear({color:a.al.transparent}),gt&&(ft.backgroundColorTexture.bind(Se.NEAREST,Se.CLAMP_TO_EDGE),ze.draw(be,Se.TRIANGLES,_n.disabled,Bn.disabled,Xn.alphaBlended,Dn.disabled,Me,ye.id,be.viewportBuffer,be.quadTriangleIndexBuffer,be.viewportSegments))}}(w,N,te),function(be,ye,Ae,ve){const Se=be.context,Te=Se.gl,Me=Ae.tileFramebuffer,ze=be.transform.projection.name==="globe",ot=Ae.paint.get("raster-particle-max-speed");for(const Xe of ve){const[ft,gt,Mt]=Xe;Se.activeTexture.set(Te.TEXTURE0+0),gt.texture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE),Me.colorAttachment.set(Mt.targetColorTexture.texture);const He=be.getOrCreateProgram("rasterParticleDraw",{defines:gt.defines,overrideFog:!1});Se.activeTexture.set(Te.TEXTURE0+1);const mt=gt.scalarData?[]:[0,1,2,3].map(lt=>a.d7[lt](ft));mt.push(ft);const qe=ft.canonical.x,pt=ft.canonical.y;for(const lt of mt){const yt=ye.getTile(ze?lt.wrapped():lt);if(!yt)continue;const st=yt.rasterParticleState;if(!st)continue;const dt=lt.canonical.x+(1<<lt.canonical.z)*(lt.wrap-ft.wrap),Ht=lt.canonical.y;st.particleTexture0.bind(Te.NEAREST,Te.CLAMP_TO_EDGE);const kt=fm(1,st.particleTexture0.size[0],[dt-qe,Ht-pt],0,gt.texture.size,2,ot,gt.textureOffset,gt.scale,gt.offset);He.draw(be,Te.POINTS,_n.disabled,Bn.disabled,Xn.alphaBlended,Dn.disabled,kt,Ae.id,st.particleIndexBuffer,void 0,st.particleSegment)}}}(w,R,N,te),F.bindFramebuffer.set(N.particleFramebuffer.framebuffer),function(be,ye,Ae,ve){const Se=be.context,Te=Se.gl,Me=ye.paint.get("raster-particle-max-speed"),ze=ve*ye.paint.get("raster-particle-speed-factor")*.15,ot=function(ft){return Math.pow(ft,6)}(.01+1*ye.paint.get("raster-particle-reset-rate-factor")),Xe=ye.particleFramebuffer;Se.viewport.set([0,0,Xe.width,Xe.height]);for(const ft of Ae){const[,gt,Mt]=ft;Se.activeTexture.set(Te.TEXTURE0+0),gt.texture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE),Se.activeTexture.set(Te.TEXTURE0+1);const He=Mt.particleTexture0;He.bind(Te.NEAREST,Te.CLAMP_TO_EDGE);const mt=Qu(1,He.size[0],0,gt.texture.size,Me,ze,ot,gt.textureOffset,gt.scale,gt.offset);Xe.colorAttachment.set(Mt.particleTexture1.texture),Se.clear({color:a.al.transparent}),be.getOrCreateProgram("rasterParticleUpdate",{defines:gt.defines}).draw(be,Te.TRIANGLES,_n.disabled,Bn.disabled,Xn.unblended,Dn.disabled,mt,ye.id,be.viewportBuffer,be.quadTriangleIndexBuffer,be.viewportSegments)}}(w,N,te,pe)}(h,t,i,d),h.renderPass==="translucent"&&(function(w,R,N,P,F){const V=w.context,j=V.gl,Z=R.getSource().tileSize,Q=5*(1-a.ae(a.bY,a.bY+1,w.transform.zoom))*Z+N.paint.get("raster-particle-elevation"),K=!w.options.moving,te=w.transform.projection.name==="globe";if(!P.length)return;const[re,pe]=w.stencilConfigForOverlap(P),be=[];te&&be.push("PROJECTION_GLOBE_VIEW");const ye=w.stencilModeFor3D();for(const Ae of pe){const ve=Ae.toUnwrapped(),Se=R.getTile(Ae);if(!Se.rasterParticleState)continue;const Te=Se.rasterParticleState,Me=100;Se.registerFadeDuration(Me);const ze=R.findLoadedParent(Ae,0),ot=yc(Se,ze,R,w.transform,Me);let Xe,ft;w.terrain&&w.terrain.prepareDrawTile(),V.activeTexture.set(j.TEXTURE0),Te.targetColorTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),V.activeTexture.set(j.TEXTURE1),ze&&ze.rasterParticleState?(ze.rasterParticleState.targetColorTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),Xe=Math.pow(2,ze.tileID.overscaledZ-Se.tileID.overscaledZ),ft=[Se.tileID.canonical.x*Xe%1,Se.tileID.canonical.y*Xe%1]):Te.targetColorTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const gt=te?Float32Array.from(w.transform.expandedFarZProjMatrix):w.transform.calculateProjMatrix(ve,K),Mt=w.transform,He=qg(Mt),mt=a.cF(Ae.canonical),qe=a.cG(mt.getCenter().lat);let pt,lt,yt,st,dt;te?(pt=Float32Array.from(a.bc(a.cI(Ae.canonical))),lt=Float32Array.from(Mt.globeMatrix),yt=Float32Array.from(a.cE(Mt)),st=[a.av(Mt.center.lng),a.aC(Mt.center.lat)],dt=Float32Array.from(a.cH(Ae.canonical,mt,qe,Mt.worldSize/Mt._pixelsPerMercatorPixel))):(pt=new Float32Array(16),lt=new Float32Array(9),yt=new Float32Array(16),st=[0,0],dt=new Float32Array(9));const Ht=vn(gt,pt,lt,yt,dt,ft||[0,0],a.ag(w.transform.zoom),st,He,Xe||1,ot,Q),kt=w.isTileAffectedByFog(Ae),Wt=w.getOrCreateProgram("rasterParticle",{defines:be,overrideFog:kt});if(w.uploadCommonUniforms(V,Wt,ve),te){const hn=new _n(j.LEQUAL,_n.ReadOnly,w.depthRangeFor3D),In=0,bn=w.globeSharedBuffers;if(bn){const[Tn,Mn,tr]=bn.getGridBuffers(qe,In!==0);Wt.draw(w,j.TRIANGLES,hn,ye,Xn.alphaBlended,w.renderElevatedRasterBackface?Dn.frontCCW:Dn.backCCW,Ht,N.id,Tn,Mn,tr)}}else{const hn=w.depthModeForSublayer(0,_n.ReadOnly),In=re[Ae.overscaledZ],{tileBoundsBuffer:bn,tileBoundsIndexBuffer:Tn,tileBoundsSegments:Mn}=w.getTileBoundsBuffers(Se);Wt.draw(w,j.TRIANGLES,hn,In,Xn.alphaBlended,Dn.disabled,Ht,N.id,bn,Tn,Mn)}}w.resetStencilClippingMasks()}(h,t,i,d),h.style.map.triggerRepaint())},background:function(h,t,i,d){const m=i.paint.get("background-color"),v=i.paint.get("background-color-use-theme").constantOr("default")==="none",w=i.paint.get("background-opacity"),R=i.paint.get("background-emissive-strength"),N=i.paint.get("background-pitch-alignment")==="viewport";if(w===0)return;const P=h.context,F=P.gl,V=h.transform,j=V.tileSize,Z=i.paint.get("background-pattern");let Q;if(Z!==void 0&&(Z===null||(Q=h.imageManager.getPattern(a.I.from(Z.toString()),i.scope,h.style.getLut(i.scope)),!Q)))return;const K=!Z&&m.a===1&&w===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==K)return;const te=Bn.disabled,re=h.depthModeForSublayer(0,K==="opaque"?_n.ReadWrite:_n.ReadOnly),pe=h.colorModeForDrapableLayerRenderPass(R),be=Z?"backgroundPattern":"background";let ye,Ae=d;if(Ae||(ye=h.getBackgroundTiles(),Ae=Object.values(ye).map(ve=>ve.tileID)),Z&&(P.activeTexture.set(F.TEXTURE0),h.imageManager.bind(h.context,i.scope)),N){const ve=h.getOrCreateProgram(be,{overrideFog:!1,overrideRtt:!0}),Se=new Float32Array(a.ad.mat4.identity([])),Te=new a.aH(0,0,0,0,0),Me=Z?Ny(Se,R,w,h,0,i.scope,Q,N,{tileID:Te,tileSize:j}):Ug(Se,R,w,m.toRenderColor(v?null:i.lut));ve.draw(h,F.TRIANGLES,re,te,pe,Dn.disabled,Me,i.id,h.viewportBuffer,h.quadTriangleIndexBuffer,h.viewportSegments)}else for(const ve of Ae){const Se=h.isTileAffectedByFog(ve),Te=h.getOrCreateProgram(be,{overrideFog:Se}),Me=ve.toUnwrapped(),ze=d?ve.projMatrix:h.transform.calculateProjMatrix(Me);h.prepareDrawTile();const ot=t?t.getTile(ve):ye?ye[ve.key]:new Is(ve,j,V.zoom,h),Xe=Z?Ny(ze,R,w,h,0,i.scope,Q,N,{tileID:ve,tileSize:j}):Ug(ze,R,w,m.toRenderColor(v?null:i.lut));h.uploadCommonUniforms(P,Te,Me);const{tileBoundsBuffer:ft,tileBoundsIndexBuffer:gt,tileBoundsSegments:Mt}=h.getTileBoundsBuffers(ot);Te.draw(h,F.TRIANGLES,re,te,pe,Dn.disabled,Xe,i.id,ft,gt,Mt)}},sky:function(h,t,i){const d=h._atmosphere?a.ag(h.transform.zoom):1,m=i.paint.get("sky-opacity")*d;if(m===0)return;const v=h.context,w=i.paint.get("sky-type"),R=new _n(v.gl.LEQUAL,_n.ReadOnly,[0,1]),N=h.frameCounter/1e3%1;w==="atmosphere"?h.renderPass==="offscreen"?i.needsSkyboxCapture(h)&&(function(P,F,V,j){const Z=P.context,Q=Z.gl;let K=F.skyboxFbo;if(!K){K=F.skyboxFbo=Z.createFramebuffer(32,32,!0,null),F.skyboxGeometry=new Gg(Z),F.skyboxTexture=Z.gl.createTexture(),Q.bindTexture(Q.TEXTURE_CUBE_MAP,F.skyboxTexture),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MAG_FILTER,Q.LINEAR);for(let be=0;be<6;++be)Q.texImage2D(Q.TEXTURE_CUBE_MAP_POSITIVE_X+be,0,Q.RGBA,32,32,0,Q.RGBA,Q.UNSIGNED_BYTE,null)}Z.bindFramebuffer.set(K.framebuffer),Z.viewport.set([0,0,32,32]);const te=F.getCenter(P,!0),re=P.getOrCreateProgram("skyboxCapture"),pe=new Float64Array(16);a.ad.mat4.identity(pe),a.ad.mat4.rotateY(pe,pe,.5*-Math.PI),Xi(P,F,re,pe,te,0),a.ad.mat4.identity(pe),a.ad.mat4.rotateY(pe,pe,.5*Math.PI),Xi(P,F,re,pe,te,1),a.ad.mat4.identity(pe),a.ad.mat4.rotateX(pe,pe,.5*-Math.PI),Xi(P,F,re,pe,te,2),a.ad.mat4.identity(pe),a.ad.mat4.rotateX(pe,pe,.5*Math.PI),Xi(P,F,re,pe,te,3),a.ad.mat4.identity(pe),Xi(P,F,re,pe,te,4),a.ad.mat4.identity(pe),a.ad.mat4.rotateY(pe,pe,Math.PI),Xi(P,F,re,pe,te,5),Z.viewport.set([0,0,P.width,P.height])}(h,i),i.markSkyboxValid(h)):h.renderPass==="sky"&&function(P,F,V,j,Z){const Q=P.context,K=Q.gl,te=P.transform,re=P.getOrCreateProgram("skybox");Q.activeTexture.set(K.TEXTURE0),K.bindTexture(K.TEXTURE_CUBE_MAP,F.skyboxTexture);const pe=((be,ye,Ae,ve,Se)=>({u_matrix:be,u_sun_direction:ye,u_cubemap:0,u_opacity:ve,u_temporal_offset:Se}))(te.skyboxMatrix,F.getCenter(P,!1),0,j,Z);P.uploadCommonUniforms(Q,re),re.draw(P,K.TRIANGLES,V,Bn.disabled,P.colorModeForRenderPass(),Dn.backCW,pe,"skybox",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(h,i,R,m,N):w==="gradient"&&h.renderPass==="sky"&&function(P,F,V,j,Z){const Q=P.context,K=Q.gl,te=P.transform,re=P.getOrCreateProgram("skyboxGradient");F.skyboxGeometry||(F.skyboxGeometry=new Gg(Q)),Q.activeTexture.set(K.TEXTURE0);let pe=F.colorRampTexture;pe||(pe=F.colorRampTexture=new a.T(Q,F.colorRamp,K.RGBA8)),pe.bind(K.LINEAR,K.CLAMP_TO_EDGE);const be=((ye,Ae,ve,Se,Te)=>({u_matrix:ye,u_color_ramp:0,u_center_direction:Ae,u_radius:a.ak(ve),u_opacity:Se,u_temporal_offset:Te}))(te.skyboxMatrix,F.getCenter(P,!1),F.paint.get("sky-gradient-radius"),j,Z);P.uploadCommonUniforms(Q,re),re.draw(P,K.TRIANGLES,V,Bn.disabled,P.colorModeForRenderPass(),Dn.backCW,be,"skyboxGradient",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(h,i,R,m,N)},debug:function(h,t,i,d,m,v){for(let w=0;w<i.length;w++)if(m){const P=new a.al(d.r*.8,d.g*.8,d.b*.8,1);zl(h,t,i[w],d,-1,-1,v),zl(h,t,i[w],d,-1,1,v),zl(h,t,i[w],d,1,1,v),zl(h,t,i[w],d,1,-1,v),zl(h,t,i[w],P,0,0,v)}else zl(h,t,i[w],d,0,0,v)},custom:function(h,t,i,d){const m=h.context,v=i.implementation;if(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes("custom")||h.terrain&&(h.terrain.renderingToTexture||h.renderPass==="offscreen")&&i.isDraped(t)){if(h.renderPass==="offscreen"){const w=v.prerender;if(w){if(h.setCustomLayerDefaults(),m.setColorMode(h.colorModeForRenderPass()),h.transform.projection.name==="globe"){const R=h.transform.pointMerc;w.call(v,m.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),a.ag(h.transform.zoom),[R.x,R.y],h.transform.pixelsPerMeterRatio)}else w.call(v,m.gl,h.transform.customLayerMatrix());m.setDirty(),h.setBaseState()}}else if(h.renderPass==="translucent"){if(h.terrain&&h.terrain.renderingToTexture){const R=v.renderToTile;if(R){const N=d[0].canonical,P=new a.ac(N.x+d[0].wrap*(1<<N.z),N.y,N.z);m.setDepthMode(_n.disabled),m.setStencilMode(Bn.disabled),m.setColorMode(h.colorModeForRenderPass()),h.setCustomLayerDefaults(),R.call(v,m.gl,P),m.setDirty(),h.setBaseState()}return}h.setCustomLayerDefaults(),m.setColorMode(h.colorModeForRenderPass()),m.setStencilMode(Bn.disabled);const w=v.renderingMode==="3d"?new _n(h.context.gl.LEQUAL,_n.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,_n.ReadOnly);if(m.setDepthMode(w),h.transform.projection.name==="globe"){const R=h.transform.pointMerc;v.render(m.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),a.ag(h.transform.zoom),[R.x,R.y],h.transform.pixelsPerMeterRatio)}else v.render(m.gl,h.transform.customLayerMatrix());m.setDirty(),h.setBaseState(),m.bindFramebuffer.set(null)}}else a.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(h,t,i,d){if(h.renderPass==="opaque")return;const m=i.paint.get("model-opacity").constantOr(1);if(m===0)return;const v=i.paint.get("model-cast-shadows");if(h.renderPass==="shadow"&&(!v||h.terrain&&m<.65&&i._transitionablePaint._values["model-opacity"].value.expression instanceof a.ab))return;const w=h.shadowRenderer,R=i.paint.get("model-receive-shadows");w&&(w.useNormalOffset=!0,R||(w.enabled=!1));const N=()=>{w&&(w.useNormalOffset=!0,R||(w.enabled=!0))},P=t.getSource();if(h.renderPass==="light-beam"&&P.type!=="batched-model")return;if(P.type==="vector"||P.type==="geojson")return function(re,pe,be,ye,Ae){const ve=re.transform;if(ve.projection.name!=="mercator")return void a.w(`Drawing 3D models for ${ve.projection.name} projection is not yet implemented`);const Se=ve.getFreeCameraOptions().position;if(!re.modelManager)return;const Te=re.modelManager;be.modelManager=Te;const Me=re.shadowRenderer;if(!be._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const ze=be._unevaluatedLayout._values["model-id"],ot=Object.assign({},be.layout.get("model-id").parameters),Xe=re.style.order.indexOf(be.fqid);for(const ft of ye){const gt=pe.getTile(ft).getBucket(be);if(!gt||gt.projection.name!==ve.projection.name)continue;const Mt=gt.getModelUris();Mt&&!gt.modelsRequested&&(Te.addModelsFromBucket(Mt,Ae),gt.modelsRequested=!0);const He=ah(ft,ve);ot.zoom=He;const mt=ze.possiblyEvaluate(ot);if(al(re,gt,ft),pa.shadowUniformsInitialized=!1,pa.useSingleShadowCascade=!!Me&&Me.getMaxCascadeForTile(ft.toUnwrapped())===0,re.renderPass==="shadow"&&Me){if(re.currentShadowCascade===1&&gt.isInsideFirstShadowMapFrustum)continue;const lt=ve.calculatePosMatrix(ft.toUnwrapped(),ve.worldSize);if(pa.tileMatrix.set(lt),pa.shadowTileMatrix=Float32Array.from(Me.calculateShadowPassMatrixFromMatrix(lt)),pa.aabb.min.fill(0),pa.aabb.max[0]=pa.aabb.max[1]=a.ai,pa.aabb.max[2]=0,wm(gt,pa,re,be.scope))continue}const qe=1<<ft.canonical.z,pt=[((Se.x-ft.wrap)*qe-ft.canonical.x)*a.ai,(Se.y*qe-ft.canonical.y)*a.ai,Se.z*qe*a.ai];re.conflationActive&&Object.keys(gt.instancesPerModel).length>0&&re.style.isLayerClipped(be,pe.getSource())&&gt.updateReplacement(ft,re.replacementSource,Xe,Ae)&&(gt.uploaded=!1,gt.upload(re.context));for(let lt in gt.instancesPerModel){const yt=gt.instancesPerModel[lt];yt.features.length>0&&(lt=mt.evaluate(yt.features[0].feature,{}));const st=Te.getModel(lt,Ae);if(st&&st.uploaded)for(const dt of st.nodes)gs(re,be,dt,yt,pt,ft,pa)}}}(h,t,i,d,P.type==="vector"?i.scope:""),void N();if(!P.loaded())return;if(P.type==="batched-model")return function(re,pe,be,ye){be.resetLayerRenderingStats(re);const Ae=re.context,ve=re.transform,Se=re.style.fog,Te=re.shadowRenderer;if(ve.projection.name!=="mercator")return void a.w(`Drawing 3D landmark models for ${ve.projection.name} projection is not yet implemented`);const Me=re.transform.getFreeCameraOptions().position,ze=a.ad.vec3.scale([],[Me.x,Me.y,Me.z],re.transform.worldSize),ot=a.ad.vec3.negate([],ze),Xe=a.ad.mat4.identity([]),ft=a.dm(ve.center.lat,ve.zoom),gt=a.ad.mat4.fromScaling([],[1,1,1/ft]);a.ad.mat4.translate(Xe,Xe,ot);const Mt=be.paint.get("model-opacity").constantOr(1),He=new _n(Ae.gl.LEQUAL,_n.ReadWrite,re.depthRangeFor3D),mt=new _n(Ae.gl.LEQUAL,_n.ReadOnly,re.depthRangeFor3D),qe=new a.ce([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),pt=re.renderPass==="shadow",lt=pt&&Te?Te.getCurrentCascadeFrustum():ve.getFrustum(ve.scaleZoom(ve.worldSize)),yt=be.paint.get("model-front-cutoff"),st=yt[2]<1,dt=wa(re,be.paint.get("model-cutoff-fade-range")),Ht=be.getLayerRenderingStats();(function(kt,Wt,hn,In){const bn=kt.terrain?kt.terrain.exaggeration():0,Tn=kt.transform.zoom;for(const Mn of In){const tr=Wt.getTile(Mn).getBucket(hn);tr&&(tr.setFilter(hn.filter),kt.conflationActive&&tr.updateReplacement(Mn,kt.replacementSource),tr.evaluateScale(kt,hn),kt.terrain&&bn>0&&tr.elevationUpdate(kt.terrain,bn,Mn,hn.source),tr.needsReEvaluation(kt,Tn,hn)&&tr.evaluate(hn))}})(re,pe,be,ye),function(){let kt,Wt,hn;st?(kt=ye.length-1,Wt=-1,hn=-1):(kt=0,Wt=ye.length,hn=1);const In=new Float64Array(16),bn=a.ad.vec3.create(),Tn=new a.P(0,0);for(let Mn=kt;Mn!==Wt;Mn+=hn){const tr=ye[Mn],yr=pe.getTile(tr).getBucket(be);if(!yr||!yr.uploaded)continue;let Gr=!1;Te&&(Gr=Te.getMaxCascadeForTile(tr.toUnwrapped())===0);const Kn=ve.calculatePosMatrix(tr.toUnwrapped(),ve.worldSize),ci=yr.modelTraits;!pt&&st&&(a.ad.mat4.invert(In,Kn),a.ad.vec3.transformMat4(bn,ze,In),Tn.x=bn[0],Tn.y=bn[1]);const Pn=[];yr.setFilter(be.filter);for(const fn of yr.getNodesInfo()){if(fn.hiddenByReplacement||!fn.node.meshes)continue;const ar=fn.node;let Dr=0;re.terrain&&ar.elevation&&(Dr=ar.elevation*re.terrain.exaggeration());const vr=(()=>{const $r=fn.aabb;return qe.min=[...$r.min],qe.max=[...$r.max],qe.min[2]+=Dr,qe.max[2]+=Dr,a.ad.vec3.transformMat4(qe.min,qe.min,Kn),a.ad.vec3.transformMat4(qe.max,qe.max,Kn),qe})(),Di=fn.evaluatedScale;if(Di[0]<=1&&Di[1]<=1&&Di[2]<=1&&vr.intersects(lt)===0)continue;if(!pt&&st){const $r=.16666666666666666;fn.cameraCollisionOpacity=ze[0]>vr.min[0]&&ze[0]<vr.max[0]&&ze[1]>vr.min[1]&&ze[1]<vr.max[1]&&ze[2]*ft<vr.max[2]&&ar.footprint&&a.bA(Tn,ar.footprint)?Math.max(fn.cameraCollisionOpacity-$r,0):Math.min(1,fn.cameraCollisionOpacity+$r)}const Bi=[...Kn],Ji=ar.anchor?ar.anchor[0]:0,Qi=ar.anchor?ar.anchor[1]:0;a.ad.mat4.translate(Bi,Bi,[Ji*(Di[0]-1),Qi*(Di[1]-1),Dr]),a.ad.vec3.exactEquals(Di,a.dq)||a.ad.mat4.scale(Bi,Bi,Di);const ma=a.ad.mat4.multiply([],Bi,ar.matrix),Fi=a.ad.mat4.multiply([],ve.expandedFarZProjMatrix,ma),fr=a.ad.mat4.multiply([],ve.expandedFarZProjMatrix,Bi),ui=a.ad.vec4.transformMat4([],[Ji,Qi,Dr,1],Fi)[2];ar.hidden=!1;let xr=Mt;pt||(st&&(xr*=fn.cameraCollisionOpacity,xr*=Tm(Bi,ve,fn.aabb,yt)),xr*=Sm(dt,ui)),xr!==0?Pn.push({nodeInfo:fn,depth:ui,opacity:xr,wvpForNode:Fi,wvpForTile:fr,nodeModelMatrix:ma,tileModelMatrix:Bi}):ar.hidden=!0}pt||Pn.sort((fn,ar)=>!st||fn.opacity===1&&ar.opacity===1?fn.depth<ar.depth?-1:1:fn.opacity===1?-1:ar.opacity===1?1:fn.depth>ar.depth?-1:1);for(const fn of Pn){const ar=fn.nodeInfo,Dr=ar.node;let vr=a.ad.mat4.multiply([],gt,fn.tileModelMatrix);a.ad.mat4.multiply(vr,Xe,vr);const Di=a.ad.mat4.invert([],vr);a.ad.mat4.transpose(Di,Di),a.ad.mat4.scale(Di,Di,gi),vr=a.ad.mat4.multiply(vr,vr,Dr.matrix);const Bi=re.renderPass==="light-beam",Ji=be.paint.get("model-color-use-theme").constantOr("default")==="none",Qi=ci&a.ds.HasMapboxMeshFeatures,ma=Qi?0:ar.evaluatedRMEA[0][2];for(let Fi=0;Fi<Dr.meshes.length;++Fi){const fr=Dr.meshes[Fi],ui=Fi===Dr.lightMeshIndex;let xr=fn.wvpForNode;if(ui){if(!Bi&&!re.terrain&&re.shadowRenderer){re.currentLayer<re.firstLightBeamLayer&&(re.firstLightBeamLayer=re.currentLayer);continue}xr=fn.wvpForTile}else if(Bi)continue;const $r={defines:[]},wo=[];if(!pt&&Te&&(Te.useNormalOffset=!!fr.normalBuffer),Bs($r.defines,wo,fr,re,Ji?null:be.lut),Qi||$r.defines.push("DIFFUSE_SHADED"),Gr&&$r.defines.push("SHADOWS_SINGLE_CASCADE"),Ht&&(pt?Ht.numRenderedVerticesInShadowPass+=fr.vertexArray.length:Ht.numRenderedVerticesInTransparentPass+=fr.vertexArray.length),pt){dd(fr,fn.nodeModelMatrix,re,be);continue}let ii=null;if(Se){const Oa=Pl(fn.nodeModelMatrix,re.transform);if(ii=new Float32Array(Oa),ve.projection.name!=="globe"){const Pi=fr.aabb.min,Fl=fr.aabb.max,[cl,Ul]=Se.getOpacityForBounds(Oa,Pi[0],Pi[1],Fl[0],Fl[1]);$r.overrideFog=cl>=Qt||Ul>=Qt}}const eo=fr.material;let Ra;eo.occlusionTexture&&eo.occlusionTexture.offsetScale&&(Ra=eo.occlusionTexture.offsetScale,$r.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Hs=re.getOrCreateProgram("model",$r);!pt&&Te&&Te.setupShadowsFromMatrix(fn.tileModelMatrix,Hs,Te.useNormalOffset),re.uploadCommonUniforms(Ae,Hs,null,ii);const ka=eo.pbrMetallicRoughness;ka.metallicFactor=.9,ka.roughnessFactor=.5;const Yo=ed(new Float32Array(xr),new Float32Array(vr),new Float32Array(Di),new Float32Array(Dr.matrix),re,fn.opacity,ka.baseColorFactor.toRenderColor(null),eo.emissiveFactor,ka.metallicFactor,ka.roughnessFactor,eo,ma,be,[0,0,0],Ra);!ui&&(ar.hasTranslucentParts||fn.opacity<1)&&Hs.draw(re,Ae.gl.TRIANGLES,He,Bn.disabled,Xn.disabled,Dn.backCCW,Yo,be.id,fr.vertexBuffer,fr.indexBuffer,fr.segments,be.paint,re.transform.zoom,void 0,wo),Hs.draw(re,Ae.gl.TRIANGLES,ui?mt:He,Bn.disabled,ui||fn.opacity<1||ar.hasTranslucentParts?Xn.alphaBlended:Xn.unblended,Dn.backCCW,Yo,be.id,fr.vertexBuffer,fr.indexBuffer,fr.segments,be.paint,re.transform.zoom,void 0,wo)}}}}()}(h,t,i,d),void N();if(P.type!=="model")return;const F=P.getModels(),V=[],j=h.transform.getFreeCameraOptions().position,Z=a.ad.vec3.scale([],[j.x,j.y,j.z],h.transform.worldSize);a.ad.vec3.negate(Z,Z);const Q=[],K=[];let te=0;for(const re of F){const pe=i.paint.get("model-rotation").constantOr(null),be=i.paint.get("model-scale").constantOr(null),ye=i.paint.get("model-translation").constantOr(null);re.computeModelMatrix(h,pe,be,ye,!0,!0,!1);const Ae=a.ad.mat4.identity([]),ve=a.dm(re.position.lat,h.transform.zoom),Se=a.ad.mat4.fromScaling([],[1,1,1/ve]);a.ad.mat4.translate(Ae,Ae,Z),V.push({zScaleMatrix:Se,negCameraPosMatrix:Ae});for(const Te of re.nodes)ud(h.transform,Te,re.matrix,h.transform.expandedFarZProjMatrix,te,Q,K);te++}if(Q.sort((re,pe)=>pe.depth-re.depth),h.renderPass!=="shadow"){if(m===1)for(const re of K)sl(re,h,i,V[re.modelIndex],Bn.disabled,h.colorModeForRenderPass());else{for(const re of K)sl(re,h,i,V[re.modelIndex],Bn.disabled,Xn.disabled);for(const re of K)sl(re,h,i,V[re.modelIndex],h.stencilModeFor3D(),h.colorModeForRenderPass());h.resetStencilClippingMasks()}for(const re of Q)sl(re,h,i,V[re.modelIndex],Bn.disabled,h.colorModeForRenderPass());N()}else{for(const re of K)dd(re.mesh,re.nodeModelMatrix,h,i);for(const re of Q)dd(re.mesh,re.nodeModelMatrix,h,i);N()}}},dh={line:function(h,t,i){if(h.hasElevatedBuckets=!1,h.hasNonElevatedBuckets=!1,h._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||h._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const d=t.getVisibleCoordinates();for(const m of d){const v=t.getTile(m).getBucket(h);if(v&&(v.hasZOffset?h.hasElevatedBuckets=!0:h.hasNonElevatedBuckets=!0,h.hasElevatedBuckets&&h.hasNonElevatedBuckets))break}}}else h.hasNonElevatedBuckets=!0},model:function(h,t,i){const d=t.getSource();if(!d.loaded())return;if(d.type==="vector"||d.type==="geojson")return void(i.modelManager&&i.modelManager.upload(i,d.type==="vector"?h.scope:""));if(d.type==="batched-model"||d.type!=="model")return;const m=d.getModels();for(const v of m)v.upload(i.context)},raster:function(h,t,i){const d=t.getSource();if(!(d instanceof Va&&d.loaded()))return;const m=h.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!m)return;const v=h.paint.get("raster-array-band")||d.getInitialBand(m);if(v==null)return;const w=t.getIds().map(R=>t.getTileByID(R));for(const R of w)R.updateNeeded(m,v)&&d.prepareTile(R,m,v)},"raster-particle":function(h,t,i){const d=t.getSource();if(!(d instanceof Va&&d.loaded()))return;const m=h.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!m)return;const v=h.paint.get("raster-particle-array-band")||d.getInitialBand(m);if(v==null)return;const w=t.getIds().map(R=>t.getTileByID(R));for(const R of w)R.updateNeeded(m,v)&&d.prepareTile(R,m,v)}},Bf={fill:rh};class hh{constructor(t,i,d,m,v){this.context=new rl(t,i),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=v,this._timeStamp=a.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const w=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const N of w)this._debugParams.enabledLayers[N]=!0;v.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),v.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),v.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),v.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const N of w)v.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],N);this.occlusionParams=new zf(v),this.setup(),this.numSublayers=aa.maxUnderzooming+aa.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new a.dy,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Xa(this),this._wireframeDebugCache=new ru,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const R=new a.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new a.T(this.context,R,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=m}updateTerrain(t,i){const d=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Df(this,t));const m=this._terrain;this.transform.elevation=d?m:null,m.update(t,this.transform,i),this.transform.elevation&&!m.enabled&&(this.transform.elevation=null)}_updateFog(t){const i=t.fog;if(!i||this.transform.projection.name==="globe"||i.getOpacity(this.transform.pitch)<1||i.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[d,m]=i.getFovAdjustedRange(this.transform._fov);if(d>m)return void(this.transform.fogCullDistSq=null);const v=d+.78*(m-d);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new Df(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,i){if(this.width=t*a.q.devicePixelRatio,this.height=i*a.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style.order)this.style._mergedLayers[d].resize()}setup(){const t=this.context,i=new a.b5;i.emplaceBack(0,0),i.emplaceBack(a.ai,0),i.emplaceBack(0,a.ai),i.emplaceBack(a.ai,a.ai),this.tileExtentBuffer=t.createVertexBuffer(i,a.b7.members),this.tileExtentSegments=a.b8.simpleSegment(0,0,4,2);const d=new a.b5;d.emplaceBack(0,0),d.emplaceBack(a.ai,0),d.emplaceBack(0,a.ai),d.emplaceBack(a.ai,a.ai),this.debugBuffer=t.createVertexBuffer(d,a.b7.members),this.debugSegments=a.b8.simpleSegment(0,0,4,5);const m=new a.b5;m.emplaceBack(-1,-1),m.emplaceBack(1,-1),m.emplaceBack(-1,1),m.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(m,a.b7.members),this.viewportSegments=a.b8.simpleSegment(0,0,4,2);const v=new a.aU;v.emplaceBack(0,0,0,0),v.emplaceBack(a.ai,0,a.ai,0),v.emplaceBack(0,a.ai,0,a.ai),v.emplaceBack(a.ai,a.ai,a.ai,a.ai),this.mercatorBoundsBuffer=t.createVertexBuffer(v,a.ba.members),this.mercatorBoundsSegments=a.b8.simpleSegment(0,0,4,2);const w=new a.aV;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(w);const R=new a.b6;for(const P of[0,1,3,2,0])R.emplaceBack(P);this.debugIndexBuffer=t.createIndexBuffer(R),this.emptyTexture=new a.T(t,new a.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=a.ad.mat4.create();const N=this.context.gl;this.stencilClearMode=new Bn({func:N.ALWAYS,mask:0},0,255,N.ZERO,N.ZERO,N.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,_n.disabled,this.stencilClearMode,Xn.disabled,Dn.disabled,Yu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,i,d){if(!i||this.currentStencilSource===i.id||!t.isTileClipped()||!d||d.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let R=!1;for(const N of d)if(this._tileClippingMaskIDs[N.key]===void 0){R=!0;break}if(!R)return}this.currentStencilSource=i.id;const m=this.context,v=m.gl;this.nextStencilID+d.length>256&&this.clearStencil(),m.setColorMode(Xn.disabled),m.setDepthMode(_n.disabled);const w=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const R of d){const N=i.getTile(R),P=this._tileClippingMaskIDs[R.key]=this.nextStencilID++,{tileBoundsBuffer:F,tileBoundsIndexBuffer:V,tileBoundsSegments:j}=this.getTileBoundsBuffers(N);w.draw(this,v.TRIANGLES,_n.disabled,new Bn({func:v.ALWAYS,mask:0},P,255,v.KEEP,v.KEEP,v.REPLACE),Xn.disabled,Dn.disabled,Yu(R.projMatrix),"$clipping",F,V,j)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,i=this.context.gl;return new Bn({func:i.NOTEQUAL,mask:255},t,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const i=this.context.gl;return new Bn({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,i.KEEP,i.KEEP,i.REPLACE)}stencilConfigForOverlap(t){const i=this.context.gl,d=t.sort((w,R)=>R.overscaledZ-w.overscaledZ),m=d[d.length-1].overscaledZ,v=d[0].overscaledZ-m+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const w={};for(let R=0;R<v;R++)w[R+m]=new Bn({func:i.GEQUAL,mask:255},R+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=v,[w,d]}return[{[m]:Bn.disabled},d]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Xn([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new a.al(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Xn.unblended:Xn.alphaBlended}colorModeForDrapableLayerRenderPass(t){const i=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Xn([i.ONE,i.ONE_MINUS_SRC_ALPHA,i.CONSTANT_ALPHA,i.ONE_MINUS_SRC_ALPHA],new a.al(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,i,d,m=!1){if(this.depthOcclusion)return new _n(this.context.gl.GREATER,_n.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!m)return _n.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new _n(d||this.context.gl.LEQUAL,i,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,i=Math.ceil(this.width),d=Math.ceil(this.height),m=this.context.bindFramebuffer.get(),v=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===i&&this.depthFBO.height===d||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),i!==0&&d!==0&&(this.depthFBO=new No(this.context,i,d,!1,"texture"),this.depthTexture=new a.T(this.context,{width:i,height:d,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(m),t.bindTexture(t.TEXTURE_2D,v),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,i,d,0,0,i,d,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,i)=>t+i/this._fpsHistory.length,0))}render(t,i){const d=a.q.now();this._dt=d-this._timeStamp,this._timeStamp=d,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=i;const m=this.style._mergedLayers,v=!(!this.terrain||!this.terrain.enabled),w=()=>this.style._getOrder(v).filter(He=>{const mt=m[He];return!(mt.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[mt.type]});let R=w(),N=!1,P=!1;for(const He of R){const mt=m[He];mt.type==="circle"&&(N=!0),mt.type==="symbol"&&(mt.hasInitialOcclusionOpacityProperties?P=!0:N=!0)}let F=R.map(He=>m[He]);const V=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(a.q.now()),this.imageManager.beginFrame();let j=0,Z=!1;for(const He in V){const mt=V[He];mt.used&&(mt.prepare(this.context),mt.getSource().usedInConflation&&++j)}let Q=!1;for(const He of F)He.isHidden(this.transform.zoom)||(He.type==="clip"&&(Q=!0),this.prepareLayer(He));const K={},te={},re={},pe={},be={};for(const He in V){const mt=V[He];K[He]=mt.getVisibleCoordinates(),te[He]=K[He].slice().reverse(),re[He]=mt.getVisibleCoordinates(!0).reverse(),pe[He]=mt.getShadowCasterCoordinates(),be[He]=mt.sortCoordinatesByDistance(K[He])}const ye=He=>{const mt=this.style.getLayerSourceCache(He);return mt&&mt.used?mt.getSource():null};if(j||Q||this._clippingActiveLastFrame){const He=[],mt=[];let qe=0;for(const pt of F)this.isSourceForClippingOrConflation(pt,ye(pt))&&(He.push(pt),mt.push(qe)),qe++;if(He&&(Q||He.length>1)||this._clippingActiveLastFrame){Q=!1;const pt=[];for(let lt=0;lt<He.length;lt++){const yt=He[lt],st=mt[lt],dt=this.style.getLayerSourceCache(yt);if(!dt||!dt.used||!dt.getSource().usedInConflation&&yt.type!=="clip")continue;let Ht=a.dA,kt=a.by.None;const Wt=[];let hn=!0;if(yt.type==="clip"){Ht=st;for(const In of yt.layout.get("clip-layer-types"))kt|=In==="model"?a.by.Model:In==="symbol"?a.by.Symbol:a.by.FillExtrusion;for(const In of yt.layout.get("clip-layer-scope"))Wt.push(In);yt.isHidden(this.transform.zoom)?hn=!1:Q=!0}hn&&pt.push({layer:yt.fqid,cache:dt,order:Ht,clipMask:kt,clipScope:Wt})}this.replacementSource.setSources(pt),Z=!0}}this._clippingActiveLastFrame=Q,Z||this.replacementSource.clear(),this.conflationActive=Z,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let He=0;He<F.length;He++){const mt=F[He],qe=mt.cutoffRange();if(this.longestCutoffRange=Math.max(qe,this.longestCutoffRange),qe>0){const pt=ye(mt);pt&&(this.minCutoffZoom=Math.max(pt.minzoom,this.minCutoffZoom)),mt.minzoom&&(this.minCutoffZoom=Math.max(mt.minzoom,this.minCutoffZoom))}mt.is3D(v)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=He),this._lastOcclusionLayer=He)}const Ae=this.style&&this.style.fog;Ae?(this._fogVisible=Ae.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ae.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(re),this.opaquePassCutoff=0,R=w(),F=R.map(He=>m[He]));const ve=this._shadowRenderer;if(ve){ve.updateShadowParameters(this.transform,this.style.directionalLight);for(const He in V)for(const mt of K[He]){let qe={min:0,max:0};this.terrain&&(qe=this.terrain.getMinMaxForTile(mt)||qe),ve.addShadowReceiver(mt.toUnwrapped(),qe.min,qe.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.dz(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new bm(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Se=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Te=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Se&&!this._snow&&(this._snow=new ch(this)),!Se&&this._snow&&(this._snow.destroy(),delete this._snow),Te&&!this._rain&&(this._rain=new Ca(this)),!Te&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!po.has(this.context.gl))return;this.renderPass="offscreen";for(const He of F){const mt=t.getLayerSourceCache(He);if(!He.hasOffscreenPass()||He.isHidden(this.transform.zoom))continue;const qe=mt?te[mt.id]:void 0;(He.type==="custom"||He.type==="raster"||He.type==="raster-particle"||He.isSky()||qe&&qe.length)&&this.renderLayer(this,mt,He,qe)}this.depthRangeFor3D=[0,1-(F.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,pe)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Me=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ze=(()=>{if(i.showOverdrawInspector)return a.al.black;const He=this.style.fog;if(He&&this.transform.projection.supportsFog){const mt=this.style.getLut(He.scope);if(!Me){const qe=He.properties.get("color-use-theme")==="none",pt=He.properties.get("color").toRenderColor(qe?null:mt).toArray01();return new a.al(...pt)}if(Me){const qe=He.properties.get("space-color-use-theme")==="none",pt=He.properties.get("space-color").toRenderColor(qe?null:mt).toArray01();return new a.al(...pt)}}return a.al.transparent})();if(this.context.clear({color:ze,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Me&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=R.length-1;this.currentLayer>=0;this.currentLayer--){const He=F[this.currentLayer],mt=t.getLayerSourceCache(He);if(He.isSky())continue;const qe=mt?(He.is3D(v)?be:te)[mt.id]:void 0;this._renderTileClippingMasks(He,mt,qe),this.renderLayer(this,mt,He,qe)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Me&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||a.ag(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<R.length;this.currentLayer++){const He=F[this.currentLayer],mt=t.getLayerSourceCache(He);He.isSky()&&this.renderLayer(this,mt,He,mt?te[mt.id]:void 0)}function ot(He,mt){let qe;return mt&&(qe=(He.type==="symbol"?re:He.is3D(v)?be:te)[mt.id]),qe}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<R.length;){const He=F[this.currentLayer];if(He.type==="raster"||He.type==="raster-particle"){const mt=t.getLayerSourceCache(He);this.renderLayer(this,mt,He,ot(He,mt))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Xe=0;ve&&(Xe=ve.getShadowCastingLayerCount());let ft=!1,gt=-1;for(let He=0;He<R.length;++He){const mt=F[He];mt.isHidden(this.transform.zoom)||mt.is3D(v)&&(gt=He)}P&&gt===-1&&(N=!0);let Mt=!1;for(;this.currentLayer<R.length;){const He=F[this.currentLayer],mt=t.getLayerSourceCache(He);if(He.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(He)){if(He.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Mt&&He.is3D(v)&&!v){const qe=this.currentLayer,pt=lt=>{for(this.currentLayer=0;this.currentLayer<F.length;this.currentLayer++){const yt=F[this.currentLayer];if(Bf[yt.type]){const st=this.style.getLayerSourceCache(yt);Bf[yt.type](this,st,yt,ot(yt,st),lt)}}};pt("initialize"),pt("reset"),this.currentLayer=qe,Mt=!0}if(N&&!ft&&this.terrain&&!this.transform.isOrthographic&&(ft=!0,this.blitDepth()),P&&gt!==-1&&this.currentLayer===gt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(He,mt,mt?K[mt.id]:void 0),this.renderLayer(this,mt,He,ot(He,mt)),!this.terrain&&ve&&Xe>0&&He.hasShadowPass()&&--Xe==0&&(ve.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const qe=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=qe;this.currentLayer++){const pt=F[this.currentLayer];if(!pt.hasLightBeamPass())continue;const lt=t.getLayerSourceCache(pt);this.renderLayer(this,lt,pt,lt?te[lt.id]:void 0)}this.currentLayer=qe,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const qe=this.currentLayer;this.depthOcclusion=!0;for(const pt of this.layersWithOcclusionOpacity){this.currentLayer=pt;const lt=F[this.currentLayer],yt=t.getLayerSourceCache(lt),st=yt?te[yt.id]:void 0;this.terrain||this._renderTileClippingMasks(lt,yt,yt?K[yt.id]:void 0),this.renderLayer(this,yt,lt,st)}this.depthOcclusion=!1,this.currentLayer=qe,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let He=null;F.forEach(mt=>{const qe=t.getLayerSourceCache(mt);qe&&!mt.isHidden(this.transform.zoom)&&qe.getVisibleCoordinates().length&&(!He||He.getSource().maxzoom<qe.getSource().maxzoom)&&(He=qe)}),He&&this.options.showTileBoundaries&&uh.debug(this,He,He.getVisibleCoordinates(),a.al.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&uh.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new a.al(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(He){const mt=He.transform.padding;ym(He,He.transform.height-(mt.top||0),3,ad),ym(He,mt.bottom||0,3,zy),vm(He,mt.left||0,3,Py),vm(He,He.transform.width-(mt.right||0),3,Hg);const qe=He.transform.centerPoint;(function(pt,lt,yt,st){tu(pt,lt-1,yt-10,2,20,st),tu(pt,lt-10,yt-1,20,2,st)})(He,qe.x,He.transform.height-qe.y,ld)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),Z||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:i}=this.transform.projection,d=!i||!i.includes(t.type);if(dh[t.type]&&(d||this.terrain&&t.type==="custom")){const m=this.style.getLayerSourceCache(t);dh[t.type](t,m,this)}this.gpuTimingEnd()}renderLayer(t,i,d,m){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||d.type==="model"||d.type==="raster"||d.type==="raster-particle"||m&&m.length)&&(this.id=d.id,this.gpuTimingStart(d),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(d.type)&&(!t.terrain||d.type!=="custom")||d.type==="clip"||uh[d.type](t,i,d,m,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const i=this.context.extTimerQuery,d=this.context.gl;let m=this.gpuTimers[t.id];m||(m=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:d.createQuery()}),m.calls++,d.beginQuery(i.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,i=this.context.gl,d=i.createQuery();this.deferredRenderGpuTimeQueries.push(d),i.beginQuery(t.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const i={};for(const d in t){const m=t[d],v=this.context.extTimerQuery,w=v.getQueryParameter(m.query,this.context.gl.QUERY_RESULT)/1e6;v.deleteQueryEXT(m.query),i[d]=w}return i}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const i=this.context.gl;let d=0;for(const m of t)d+=i.getQueryParameter(m,i.QUERY_RESULT)/1e6,i.deleteQuery(m);return d}translatePosMatrix(t,i,d,m,v){if(!d[0]&&!d[1])return t;const w=v?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(w){const P=Math.sin(w),F=Math.cos(w);d=[d[0]*F-d[1]*P,d[0]*P+d[1]*F]}const R=[v?d[0]:a.at(i,d[0],this.transform.zoom),v?d[1]:a.at(i,d[1],this.transform.zoom),0],N=new Float32Array(16);return a.ad.mat4.translate(N,t,R),N}saveTileTexture(t){const i=t.size[0],d=this._tileTextures[i];d?d.push(t):this._tileTextures[i]=[t]}getTileTexture(t){const i=this._tileTextures[t];return i&&i.length>0?i.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,i,d){const m=d===void 0?this.terrain&&this.terrain.renderingToTexture:d,v=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(v.push("LIGHTING_3D_MODE"),v.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):m||v.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||v.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(v.push("TERRAIN"),this.linearFloatFilteringSupported()&&v.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&v.push("GLOBE"),!this._fogVisible||m||i!==void 0&&!i||v.push("FOG","FOG_DITHERING"),m&&v.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&v.push("OVERDRAW_INSPECTOR"),v}getOrCreateProgram(t,i){this.cache=this.cache||{};const d=i&&i.defines||[],m=i&&i.config,v=this.currentGlobalDefines(t,i&&i.overrideFog,i&&i.overrideRtt).concat(d),w=Kc.cacheKey(Zc[t],t,v,m);return this.cache[w]||(this.cache[w]=new Kc(this.context,t,Zc[t],m,nh[t],v)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,i){if(this.style.enable3dLights()){const d=this.style.directionalLight,m=this.style.ambientLight;if(d&&m){const v=((w,R,N)=>{const P=w.properties.get("direction"),F=w.properties.get("color-use-theme")==="none",V=w.properties.get("color").toRenderColor(F?null:N.getLut(w.scope)).toArray01(),j=w.properties.get("intensity"),Z=R.properties.get("color-use-theme")==="none",Q=R.properties.get("color").toRenderColor(Z?null:N.getLut(R.scope)).toArray01(),K=R.properties.get("intensity"),te=[P.x,P.y,P.z],re=a.cN(Q,K),pe=a.cN(V,j);return{u_lighting_ambient_color:re,u_lighting_directional_dir:te,u_lighting_directional_color:pe,u_ground_radiance:Wu(te,pe,re)}})(d,m,this.style);i.setLightsUniformValues(t,v)}}}uploadCommonUniforms(t,i,d,m,v){if(this.uploadCommonLightUniforms(t,i),this.terrain&&this.terrain.renderingToTexture)return;const w=this.style.fog;if(w){const R=w.getOpacity(this.transform.pitch),N=((P,F,V,j,Z,Q,K,te,re,pe,be,ye)=>{const Ae=P.transform,ve=F.properties.get("color-use-theme")==="none",Se=F.properties.get("color").toRenderColor(ve?null:P.style.getLut(F.scope)).toArray01();Se[3]=j;const Te=P.frameCounter/1e3%1,[Me,ze]=F.properties.get("vertical-range");return{u_fog_matrix:V?Ae.calculateFogTileMatrix(V):ye||P.identityMat,u_fog_range:F.getFovAdjustedRange(Ae._fov),u_fog_color:Se,u_fog_horizon_blend:F.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Me,ze),ze],u_fog_temporal_offset:Te,u_frustum_tl:Z,u_frustum_tr:Q,u_frustum_br:K,u_frustum_bl:te,u_globe_pos:re,u_globe_radius:pe,u_viewport:be,u_globe_transition:a.ag(Ae.zoom),u_is_globe:+(Ae.projection.name==="globe")}})(this,w,d,R,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.q.devicePixelRatio,this.transform.height*a.q.devicePixelRatio],m);i.setFogUniformValues(t,N)}v&&i.setCutoffUniformValues(t,v.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,i=t.createTexture();return t.bindTexture(t.TEXTURE_2D,i),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),i}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,i=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(const m of d)i[m.key]=t[m.key]||new Is(m,512,this.transform.tileZoom,this);return i}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,i){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!i||i.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let i=this._cachedTileFogOpacities[t.key];return i||(this._cachedTileFogOpacities[t.key]=i=this.style.fog.getOpacityForTile(t)),i[0]>=Qt||i[1]>=Qt}setupDepthForOcclusion(t,i,d){const m=this.context,v=m.gl,w=!!d;var R;d||(d={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),m.activeTexture.set(v.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),d.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],d.u_depth_range_unpack=[2/((R=this.depthRangeFor3D)[1]-R[0]),-1-2*R[0]/(R[1]-R[0])],d.u_occluder_half_size=.5*this.occlusionParams.occluderSize,d.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),m.activeTexture.set(v.TEXTURE0),w||i.setTerrainUniformValues(m,d)}}function fh(h,t){let i=!1,d=null;const m=()=>{d=null,i&&(h(),d=setTimeout(m,t),i=!1)};return()=>(i=!0,d||m(),d)}class ph{constructor(t){this._hashName=t&&encodeURIComponent(t),a.aQ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=fh(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const i=$g(t);if(this._hashName){const d=this._hashName;let m=!1;const v=location.hash.slice(1).split("&").map(w=>{const R=w.split("=")[0];return R===d?(m=!0,`${R}=${i}`):w}).filter(w=>w);return m||v.push(`${d}=${i}`),`#${v.join("&")}`}return`#${i}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let i;return t.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(i=d)}),(i&&i[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const i=this._getCurrentHash();if(i.length>=3&&!i.some(d=>isNaN(d))){const d=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(i[3]||0):t.getBearing();return t.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:d,pitch:+(i[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function $g(h,t){const i=h.getCenter(),d=Math.round(100*h.getZoom())/100,m=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,m),w=Math.round(i.lng*v)/v,R=Math.round(i.lat*v)/v,N=h.getBearing(),P=h.getPitch();let F=t?`/${w}/${R}/${d}`:`${d}/${R}/${w}`;return(N||P)&&(F+="/"+Math.round(10*N)/10),P&&(F+=`/${Math.round(P)}`),F}const mh={linearity:.3,easing:a.dB(0,0,.3,1)},Ly=a.l({deceleration:2500,maxSpeed:1400},mh),Zg=a.l({deceleration:20,maxSpeed:1400},mh),Yg=a.l({deceleration:1e3,maxSpeed:360},mh),Ll=a.l({deceleration:1e3,maxSpeed:90},mh);class Wg{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,i=a.q.now();for(;t.length>0&&i-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const i={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)i.zoom+=v.zoomDelta||0,i.bearing+=v.bearingDelta||0,i.pitch+=v.pitchDelta||0,v.panDelta&&i.pan._add(v.panDelta),v.around&&(i.around=v.around),v.pinchAround&&(i.pinchAround=v.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(i.pan.mag()){const v=Ff(i.pan.mag(),d,a.l({},Ly,t||{}));m.offset=i.pan.mult(v.amount/i.pan.mag()),m.center=this._map.transform.center,gh(m,v)}if(i.zoom){const v=Ff(i.zoom,d,Zg);m.zoom=this._map.transform.zoom+v.amount,gh(m,v)}if(i.bearing){const v=Ff(i.bearing,d,Yg);m.bearing=this._map.transform.bearing+a.ay(v.amount,-179,179),gh(m,v)}if(i.pitch){const v=Ff(i.pitch,d,Ll);m.pitch=this._map.transform.pitch+v.amount,gh(m,v)}if(m.zoom||m.bearing){const v=i.pinchAround===void 0?i.around:i.pinchAround;m.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),m.noMoveStart=!0,m}}function gh(h,t){(!h.duration||h.duration<t.duration)&&(h.duration=t.duration,h.easing=t.easing)}function Ff(h,t,i){const{maxSpeed:d,linearity:m,deceleration:v}=i,w=a.ay(h*m/(t/1e3),-d,d),R=Math.abs(w)/(v*m);return{easing:i.easing,duration:1e3*R,amount:w*(R/2)}}class Qo extends a.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,d,m={}){const v=rn(i.getCanvasContainer(),d),w=i.unproject(v);super(t,a.l({point:v,lngLat:w,originalEvent:d},m)),this._defaultPrevented=!1,this.target=i}}class Ho extends a.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,d){const m=t==="touchend"?d.changedTouches:d.touches,v=Ut(i.getCanvasContainer(),m),w=v.map(N=>i.unproject(N)),R=v.reduce((N,P,F,V)=>N.add(P.div(V.length)),new a.P(0,0));super(t,{points:v,point:R,lngLats:w,lngLat:i.unproject(R),originalEvent:d}),this._defaultPrevented=!1}}class Xg extends a.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i){super("wheel",{originalEvent:i}),this._defaultPrevented=!1}}class Us{constructor(t,i){this._map=t,this._clickTolerance=i.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Xg(this._map,t))}mousedown(t,i){return this._mousedownPos=i,this._firePreventable(new Qo(t.type,this._map,t))}mouseup(t){this._map.fire(new Qo(t.type,this._map,t))}preclick(t){const i=a.l({},t);i.type="preclick",this._map.fire(new Qo(i.type,this._map,i))}click(t,i){this._mousedownPos&&this._mousedownPos.dist(i)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Qo(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Qo(t.type,this._map,t))}mouseover(t){this._map.fire(new Qo(t.type,this._map,t))}mouseout(t){this._map.fire(new Qo(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Ho(t.type,this._map,t))}touchmove(t){this._map.fire(new Ho(t.type,this._map,t))}touchend(t){this._map.fire(new Ho(t.type,this._map,t))}touchcancel(t){this._map.fire(new Ho(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class By{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Qo(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Qo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Qo(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class wc{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=i.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,i){this.isEnabled()&&t.shiftKey&&t.button===0&&(St(),this._startPos=this._lastPos=i,this._active=!0)}mousemoveWindow(t,i){if(!this._active)return;const d=i,m=this._startPos,v=this._lastPos;if(!m||!v||v.equals(d)||!this._box&&d.dist(m)<this._clickTolerance)return;this._lastPos=d,this._box||(this._box=Ue("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const w=Math.min(m.x,d.x),R=Math.max(m.x,d.x),N=Math.min(m.y,d.y),P=Math.max(m.y,d.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${w}px,${N}px)`,this._box.style.width=R-w+"px",this._box.style.height=P-N+"px")})}mouseupWindow(t,i){if(!this._active)return;const d=this._startPos,m=i;if(d&&t.button===0){if(this.reset(),xt(),d.x!==m.x||d.y!==m.y)return this._map.fire(new a.A("boxzoomend",{originalEvent:t})),{cameraAnimation:v=>v.fitScreenCoordinates(d,m,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Xt(),delete this._startPos,delete this._lastPos}_fireEvent(t,i){return this._map.fire(new a.A(t,{originalEvent:i}))}}function ri(h,t){const i={};for(let d=0;d<h.length;d++)i[h[d].identifier]=t[d];return i}class su{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,i,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),d.length===this.numTouches&&(this.centroid=function(m){const v=new a.P(0,0);for(const w of m)v._add(w);return v.div(m.length)}(i),this.touches=ri(d,i)))}touchmove(t,i,d){if(this.aborted||!this.centroid)return;const m=ri(d,i);for(const v in this.touches){const w=m[v];(!w||w.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(t,i,d){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Dm{constructor(t){this.singleTap=new su(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,i,d){this.singleTap.touchstart(t,i,d)}touchmove(t,i,d){this.singleTap.touchmove(t,i,d)}touchend(t,i,d){const m=this.singleTap.touchend(t,i,d);if(m){const v=t.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(m)<30;if(v&&w||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class Sc{constructor(){this._zoomIn=new Dm({numTouches:1,numTaps:2}),this._zoomOut=new Dm({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,i,d){this._zoomIn.touchstart(t,i,d),this._zoomOut.touchstart(t,i,d)}touchmove(t,i,d){this._zoomIn.touchmove(t,i,d),this._zoomOut.touchmove(t,i,d)}touchend(t,i,d){const m=this._zoomIn.touchend(t,i,d),v=this._zoomOut.touchend(t,i,d);return m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(m)},{originalEvent:t})}):v?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(v)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const hd={0:1,2:2},Uf={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class js{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,i){return!1}_move(t,i){return{}}mousedown(t,i){if(this._lastPoint)return;const d=Yt(t);this._correctButton(t,d)&&(this._lastPoint=i,this._eventButton=d)}mousemoveWindow(t,i){const d=this._lastPoint;if(d){if(t.preventDefault(),this._eventButton!=null&&function(m,v){const w=hd[v];return m.buttons===void 0||(m.buttons&w)!==w}(t,this._eventButton))this.reset();else if(this._moved||!(i.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=i,this._move(d,i)}}mouseupWindow(t){this._lastPoint&&Yt(t)===this._eventButton&&(this._moved&&xt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class jf extends js{mousedown(t,i){super.mousedown(t,i),this._lastPoint&&(this._active=!0)}_correctButton(t,i){return i===0&&!t.ctrlKey}_move(t,i){return{around:i,panDelta:i.sub(t)}}}class _s extends js{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Uf[t.pitchRotateKey]:void 0}_correctButton(t,i){return this._pitchRotateKey?i===0&&t[this._pitchRotateKey]:i===0&&t.ctrlKey||i===2}_move(t,i){const d=.8*(i.x-t.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class _h extends js{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Uf[t.pitchRotateKey]:void 0}_correctButton(t,i){return this._pitchRotateKey?i===0&&t[this._pitchRotateKey]:i===0&&t.ctrlKey||i===2}_move(t,i){const d=-.5*(i.y-t.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Ti{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset(),a.aQ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}touchstart(t,i,d){return this._calculateTransform(t,i,d)}touchmove(t,i,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1&&!a.dC())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,i,d)}}touchend(t,i,d){this._calculateTransform(t,i,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,i,d){d.length>0&&(this._active=!0);const m=ri(d,i),v=new a.P(0,0),w=new a.P(0,0);let R=0;for(const P in m){const F=m[P],V=this._touches[P];V&&(v._add(F),w._add(F.sub(V)),R++,m[P]=F)}if(this._touches=m,R<this._minTouches||!w.mag())return;const N=w.div(R);return this._sum._add(N),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(R),panDelta:N}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ue("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Go{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,i,d){return{}}touchstart(t,i,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([i[0],i[1]]))}touchmove(t,i,d){const m=this._firstTwoTouches;if(!m)return;t.preventDefault();const[v,w]=m,R=fd(d,i,v),N=fd(d,i,w);if(!R||!N)return;const P=this._aroundCenter?null:R.add(N).div(2);return this._move([R,N],P,t)}touchend(t,i,d){if(!this._firstTwoTouches)return;const[m,v]=this._firstTwoTouches,w=fd(d,i,m),R=fd(d,i,v);w&&R||(this._active&&xt(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function fd(h,t,i){for(let d=0;d<h.length;d++)if(h[d].identifier===i)return t[d]}function yh(h,t){return Math.log(h/t)/Math.LN2}class vh extends Go{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,i){const d=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(yh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:yh(this._distance,d),pinchAround:i}}}function Kg(h,t){return 180*h.angleWith(t)/Math.PI}class au extends Go{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,i){const d=this._vector;if(this._vector=t[0].sub(t[1]),d&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Kg(this._vector,d),pinchAround:i}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const i=25/(Math.PI*this._minDiameter)*360,d=this._startVector;if(!d)return!1;const m=Kg(t,d);return Math.abs(m)<i}}function Mm(h){return Math.abs(h.y)>Math.abs(h.x)}class Fy extends Go{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Mm(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,i,d){const m=this._lastPoints;if(!m)return;const v=t[0].sub(m[0]),w=t[1].sub(m[1]);return this._map._cooperativeGestures&&!a.dC()&&d.touches.length<3||(this._valid=this.gestureBeginsVertically(v,w,d.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(v.y+w.y)/2*-.5})}gestureBeginsVertically(t,i,d){if(this._valid!==void 0)return this._valid;const m=t.mag()>=2,v=i.mag()>=2;if(!m&&!v)return;if(!m||!v)return this._firstMove==null&&(this._firstMove=d),d-this._firstMove<100&&void 0;const w=t.y>0==i.y>0;return Mm(t)&&Mm(i)&&w}}const Jg={panStep:100,bearingStep:15,pitchStep:10};class Rm{constructor(){const t=Jg;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let i=0,d=0,m=0,v=0,w=0;switch(t.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:t.shiftKey?d=-1:(t.preventDefault(),v=-1);break;case 39:t.shiftKey?d=1:(t.preventDefault(),v=1);break;case 38:t.shiftKey?m=1:(t.preventDefault(),w=-1);break;case 40:t.shiftKey?m=-1:(t.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(d=0,m=0),{cameraAnimation:R=>{const N=R.getZoom();R.easeTo({duration:300,easeId:"keyboardHandler",easing:$o,zoom:i?Math.round(N)+i*(t.shiftKey?2:1):N,bearing:R.getBearing()+d*this._bearingStep,pitch:R.getPitch()+m*this._pitchStep,offset:[-v*this._panStep,-w*this._panStep],center:R.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function $o(h){return h*(2-h)}const lu=4.000244140625,Ei=1/450;class Da{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._handler=i,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Ei,a.aQ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||a.dC()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let i=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const d=a.q.now(),m=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,i!==0&&i%lu==0?this._type="wheel":i!==0&&Math.abs(i)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=i,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(m*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),t.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=t,this._delta-=i,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const i=rn(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:i,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const i=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const P=this._type==="wheel"&&Math.abs(this._delta)>lu?this._wheelZoomRate:this._defaultZoomRate;let F=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&F!==0&&(F=1/F);const V=i(),j=Math.pow(2,V),Z=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):j;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(Z*F))),this._type==="wheel"&&(this._startZoom=V,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:i(),m=this._startZoom,v=this._easing;let w,R=!1;if(this._type==="wheel"&&m&&v){const P=Math.min((a.q.now()-this._lastWheelEventTime)/200,1),F=v(P);w=a.ah(m,d,F),P<1?this._frameId||(this._frameId=!0):R=!0}else w=d,R=!0;this._active=!0,R&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let N=w-i();return N*this._lastDelta<0&&(N=0),{noInertia:!0,needsRenderFrame:!R,zoomDelta:N,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let i=a.dD;if(this._prevEase){const d=this._prevEase,m=(a.q.now()-d.start)/d.duration,v=d.easing(m+.01)-d.easing(m),w=.27/Math.sqrt(v*v+1e-4)*.01,R=Math.sqrt(.0729-w*w);i=a.dB(w,R,.25,1)}return this._prevEase={start:a.q.now(),duration:t,easing:i},i}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ue("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Tc{constructor(t,i){this._clickZoom=t,this._tapZoom=i}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class pd{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,i){return t.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(t.shiftKey?-1:1),around:d.unproject(i)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ys{constructor(){this._tap=new Dm({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,i,d){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=i[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(t,i,d))}touchmove(t,i,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const m=i[0],v=m.y-this._swipePoint.y;return this._swipePoint=m,t.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(t,i,d)}touchend(t,i,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(t,i,d)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xh{constructor(t,i,d){this._el=t,this._mousePan=i,this._touchPan=d}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Qg{constructor(t,i,d){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=i,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class bh{constructor(t,i,d,m){this._el=t,this._touchZoom=i,this._touchRotate=d,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Vf=h=>h.zoom||h.drag||h.pitch||h.rotate;class e_ extends a.A{}class Zo{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,i){const d=a.ad.vec3.sub([],i,t);this.radius=a.ad.vec3.length(d[2]<0?a.ad.vec3.div([],d,this.constants):[d[0],d[1],0])}projectRay(t){a.ad.vec3.div(t,t,this.constants),a.ad.vec3.normalize(t,t),a.ad.vec3.mul(t,t,this.constants);const i=a.ad.vec3.scale([],t,this.radius);if(i[2]>0){const d=a.ad.vec3.scale([],[0,0,1],a.ad.vec3.dot(i,[0,0,1])),m=a.ad.vec3.scale([],a.ad.vec3.normalize([],[i[0],i[1],0]),this.radius),v=a.ad.vec3.add([],i,a.ad.vec3.scale([],a.ad.vec3.sub([],a.ad.vec3.add([],m,d),i),2));i[0]=v[0],i[1]=v[1]}return i}}function cu(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class km{constructor(t,i){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Wg(t),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Zo,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(i),a.aQ(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,v,w]of this._listeners){const R=m===document?this.handleWindowEvent:this.handleEvent;m.addEventListener(v,R,w)}}destroy(){for(const[t,i,d]of this._listeners){const m=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(i,m,d)}}_addDefaultHandlers(t){const i=this._map,d=i.getCanvasContainer();this._add("mapEvent",new Us(i,t));const m=i.boxZoom=new wc(i,t);this._add("boxZoom",m);const v=new Sc,w=new pd;i.doubleClickZoom=new Tc(w,v),this._add("tapZoom",v),this._add("clickZoom",w);const R=new ys;this._add("tapDragZoom",R);const N=i.touchPitch=new Fy(i);this._add("touchPitch",N);const P=new _s(t),F=new _h(t);i.dragRotate=new Qg(t,P,F),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);const V=new jf(t),j=new Ti(i,t);i.dragPan=new xh(d,V,j),this._add("mousePan",V),this._add("touchPan",j,["touchZoom","touchRotate"]);const Z=new au,Q=new vh;i.touchZoomRotate=new bh(d,Q,Z,R),this._add("touchRotate",Z,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new By(i));const K=i.scrollZoom=new Da(i,this);this._add("scrollZoom",K,["mousePan"]);const te=i.keyboard=new Rm;this._add("keyboard",te);for(const re of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[re]&&i[re].enable(t[re])}_add(t,i,d){this._handlers.push({handlerName:t,handler:i,allowed:d}),this._handlersById[t]=i}stop(t){if(!this._updatingCamera){for(const{handler:i}of this._handlers)i.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Vf(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,i,d){for(const m in t)if(m!==d&&(!i||i.indexOf(m)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const i=[];for(const d of t)this._el.contains(d.target)&&i.push(d);return i}handleEvent(t,i){this._updatingCamera=!0;const d=t.type==="renderFrame",m=d?void 0:t,v={needsRenderFrame:!1},w={},R={},N=t.touches?this._getMapTouches(t.touches):void 0,P=N?Ut(this._el,N):d?void 0:rn(this._el,t);for(const{handlerName:j,handler:Z,allowed:Q}of this._handlers){if(!Z.isEnabled())continue;let K;this._blockedByActive(R,Q,j)?Z.reset():Z[i||t.type]&&(K=Z[i||t.type](t,P,N),this.mergeHandlerResult(v,w,K,j,m),K&&K.needsRenderFrame&&this._triggerRenderFrame()),(K||Z.isActive())&&(R[j]=Z)}const F={};for(const j in this._previousActiveHandlers)R[j]||(F[j]=m);this._previousActiveHandlers=R,(Object.keys(F).length||cu(v))&&(this._changes.push([v,w,F]),this._triggerRenderFrame()),(Object.keys(R).length||cu(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:V}=v;V&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],V(this._map))}mergeHandlerResult(t,i,d,m,v){if(!d)return;a.l(t,d);const w={handlerName:m,originalEvent:d.originalEvent||v};d.zoomDelta!==void 0&&(i.zoom=w),d.panDelta!==void 0&&(i.drag=w),d.pitchDelta!==void 0&&(i.pitch=w),d.bearingDelta!==void 0&&(i.rotate=w)}_applyChanges(){const t={},i={},d={};for(const[m,v,w]of this._changes)m.panDelta&&(t.panDelta=(t.panDelta||new a.P(0,0))._add(m.panDelta)),m.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(t.around=m.around),m.aroundCoord!==void 0&&(t.aroundCoord=m.aroundCoord),m.pinchAround!==void 0&&(t.pinchAround=m.pinchAround),m.noInertia&&(t.noInertia=m.noInertia),a.l(i,v),a.l(d,w);this._updateMapTransform(t,i,d),this._changes=[]}_updateMapTransform(t,i,d){const m=this._map,v=m.transform,w=pe=>[pe.x,pe.y,pe.z];if((pe=>{const be=this._eventsInProgress.drag;return be&&!this._handlersById[be.handlerName].isActive()})()&&!cu(t)){const pe=v.zoom;v.cameraElevationReference="sea",this._originalZoom!=null&&v._orthographicProjectionAtLowPitch&&v.projection.name!=="globe"&&v.pitch===0?(v.cameraElevationReference="ground",v.zoom=this._originalZoom):(v.recenterOnTerrain(),v.cameraElevationReference="ground"),pe!==v.zoom&&this._map._update(!0)}if(v._isCameraConstrained&&m._stop(!0),!cu(t))return void this._fireEvents(i,d,!0);let{panDelta:R,zoomDelta:N,bearingDelta:P,pitchDelta:F,around:V,aroundCoord:j,pinchAround:Z}=t;v._isCameraConstrained&&(N>0&&(N=0),v._isCameraConstrained=!1),Z!==void 0&&(V=Z),(N||(pe=>i[pe]&&!this._eventsInProgress[pe])("drag"))&&V&&(this._dragOrigin=w(v.pointCoordinate3D(V)),this._originalZoom=v.zoom,this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",m._stop(!0),V=V||m.transform.centerPoint,P&&(v.bearing+=P),F&&(v.pitch+=F),v._updateCameraState();const Q=[0,0,0];if(R)if(v.projection.name==="mercator"){const pe=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(V).dir),be=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(V.sub(R)).dir);Q[0]=be[0]-pe[0],Q[1]=be[1]-pe[1]}else{const pe=v.pointCoordinate(V);if(v.projection.name==="globe"){R=R.rotate(-v.angle);const be=v._pixelsPerMercatorPixel/v.worldSize;Q[0]=-R.x*a.dE(a.aT(pe.y))*be,Q[1]=-R.y*a.dE(v.center.lat)*be}else{const be=v.pointCoordinate(V.sub(R));pe&&be&&(Q[0]=be.x-pe.x,Q[1]=be.y-pe.y)}}const K=v.zoom,te=[0,0,0];if(N){const pe=w(j||v.pointCoordinate3D(V)),be={dir:a.ad.vec3.normalize([],a.ad.vec3.sub([],pe,v._camera.position))};if(be.dir[2]<0){const ye=v.zoomDeltaToMovement(pe,N);a.ad.vec3.scale(te,be.dir,ye)}}const re=a.ad.vec3.add(Q,Q,te);v._translateCameraConstrained(re),N&&Math.abs(v.zoom-K)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(i,d,!0)}_fireEvents(t,i,d){const m=Vf(this._eventsInProgress),v=Vf(t),w={};for(const F in t){const{originalEvent:V}=t[F];this._eventsInProgress[F]||(w[`${F}start`]=V),this._eventsInProgress[F]=t[F]}!m&&v&&this._fireEvent("movestart",v.originalEvent);for(const F in w)this._fireEvent(F,w[F]);v&&this._fireEvent("move",v.originalEvent);for(const F in t){const{originalEvent:V}=t[F];this._fireEvent(F,V)}const R={};let N;for(const F in this._eventsInProgress){const{handlerName:V,originalEvent:j}=this._eventsInProgress[F];this._handlersById[V].isActive()||(delete this._eventsInProgress[F],N=i[V]||j,R[`${F}end`]=N)}for(const F in R)this._fireEvent(F,R[F]);const P=Vf(this._eventsInProgress);if(d&&(m||v)&&!P){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),V=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;F?(V(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:N})):(this._map.fire(new a.A("moveend",{originalEvent:N})),V(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,i){this._map.fire(new a.A(t,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new e_("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const t_="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class wh extends a.E{constructor(t,i){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=i.bearingSnap,this._respectPrefersReducedMotion=i.respectPrefersReducedMotion!==!1,a.aQ(["_renderFrameCallback"],this)}getCenter(){return new a.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(t,i){return this.jumpTo({center:t},i)}panBy(t,i,d){return t=a.P.convert(t).mult(-1),this.panTo(this.transform.center,a.l({offset:t},i),d)}panTo(t,i,d){return this.easeTo(a.l({center:t},i),d)}getZoom(){return this.transform.zoom}setZoom(t,i){return this.jumpTo({zoom:t},i),this}zoomTo(t,i,d){return this.easeTo(a.l({zoom:t},i),d)}zoomIn(t,i){return this.zoomTo(this.getZoom()+1,t,i),this}zoomOut(t,i){return this.zoomTo(this.getZoom()-1,t,i),this}getBearing(){return this.transform.bearing}setBearing(t,i){return this.jumpTo({bearing:t},i),this}getPadding(){return this.transform.padding}setPadding(t,i){return this.jumpTo({padding:t},i),this}rotateTo(t,i,d){return this.easeTo(a.l({bearing:t},i),d)}resetNorth(t,i){return this.rotateTo(0,a.l({duration:1e3},t),i),this}resetNorthPitch(t,i){return this.easeTo(a.l({bearing:0,pitch:0,duration:1e3},t),i),this}snapToNorth(t,i){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,i):this}getPitch(){return this.transform.pitch}setPitch(t,i){return this.jumpTo({pitch:t},i),this}cameraForBounds(t,i){t=a.aB.convert(t);const d=i&&i.bearing||0,m=i&&i.pitch||0,v=t.getNorthWest(),w=t.getSouthEast();return this._cameraForBounds(this.transform,v,w,d,m,i)}_extendPadding(t){const i={top:0,right:0,bottom:0,left:0};return t==null?a.l({},i,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:a.l({},i,t)}_extendCameraOptions(t){return(t=a.l({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,i){const d=i.max[0]-i.min[0],m=i.max[1]-i.min[1];return d/m>t.aspect?d/(2*Math.tan(.5*t.fovX)*t.aspect):m/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,i,d,m,v,w){const R=t.clone(),N=this._extendCameraOptions(w);R.bearing=m,R.pitch=v;const P=a.bO.convert(i),F=a.bO.convert(d),V=.5*(P.lat+F.lat),j=.5*(P.lng+F.lng),Z=a.dF(V,j),Q=a.ad.vec3.normalize([],Z),K=a.ad.vec3.normalize([],a.ad.vec3.cross([],Q,[0,1,0])),te=a.ad.vec3.cross([],K,Q),re=[K[0],K[1],K[2],0,te[0],te[1],te[2],0,Q[0],Q[1],Q[2],0,0,0,0,1],pe=[Z,a.dF(P.lat,P.lng),a.dF(F.lat,P.lng),a.dF(F.lat,F.lng),a.dF(P.lat,F.lng),a.dF(V,P.lng),a.dF(V,F.lng),a.dF(P.lat,j),a.dF(F.lat,j)];let be=a.ce.fromPoints(pe.map(lt=>[a.ad.vec3.dot(K,lt),a.ad.vec3.dot(te,lt),a.ad.vec3.dot(Q,lt)]));const ye=a.ad.vec3.transformMat4([],be.center,re);a.ad.vec3.squaredLength(ye)===0&&a.ad.vec3.set(ye,0,0,1),a.ad.vec3.normalize(ye,ye),a.ad.vec3.scale(ye,ye,a.az),R.center=a.dG(ye);const Ae=R.getWorldToCameraMatrix(),ve=a.ad.mat4.invert(new Float64Array(16),Ae);be=a.ce.applyTransform(be,a.ad.mat4.multiply([],Ae,re));const Se=this._extendAABB(be,R,N,m);if(!Se)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");be=Se,a.ad.vec3.transformMat4(ye,ye,Ae);const Te=.5*(be.max[2]-be.min[2]),Me=this._minimumAABBFrustumDistance(R,be),ze=a.ad.vec3.scale([],[0,0,1],Te),ot=a.ad.vec3.add(ze,ye,ze),Xe=Me+(R.pitch===0?0:a.ad.vec3.distance(ye,ot)),ft=R.globeCenterInViewSpace,gt=a.ad.vec3.sub([],ye,[ft[0],ft[1],ft[2]]);a.ad.vec3.normalize(gt,gt),a.ad.vec3.scale(gt,gt,Xe);const Mt=a.ad.vec3.add([],ye,gt);a.ad.vec3.transformMat4(Mt,Mt,ve);const He=a.dv/a.az,mt=a.ad.vec3.length(Mt),qe=a.bH(Math.max(mt*He-a.dv,Number.EPSILON),0),pt=Math.min(R.zoomFromMercatorZAdjusted(qe),N.maxZoom);return pt>.5*(a.c6+a.bY)?(R.setProjection({name:"mercator"}),R.zoom=pt,this._cameraForBounds(R,i,d,m,v,w)):{center:R.center,zoom:pt,bearing:m,pitch:v}}_extendAABB(t,i,d,m){const v=.5*((d.padding.left||0)+(d.padding.right||0)),w=.5*((d.padding.top||0)+(d.padding.bottom||0)),R=w,N=v,P=v,F=w,V=i.width-(N+P),j=i.height-(R+F),Z=a.ad.vec3.sub([],t.max,t.min),Q=Math.min(V/Z[0],j/Z[1]),K=Math.min(i.scaleZoom(i.scale*Q),d.maxZoom);if(isNaN(K))return null;const te=i.scale/i.zoomScale(K),re=new a.ce([t.min[0]-N*te,t.min[1]-F*te,t.min[2]],[t.max[0]+P*te,t.max[1]+R*te,t.max[2]]),pe=(typeof d.offset.x=="number"&&typeof d.offset.y=="number"?new a.P(d.offset.x,d.offset.y):a.P.convert(d.offset)).rotate(-a.ak(m));return re.center[0]-=pe.x*te,re.center[1]+=pe.y*te,re}queryTerrainElevation(t,i){const d=this.transform.elevation;return d?(i=a.l({},{exaggerated:!0},i),d.getAtPoint(a.ac.fromLngLat(t),null,i.exaggerated)):null}_cameraForBounds(t,i,d,m,v,w){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,i,d,m,v,w);const R=t.clone(),N=this._extendCameraOptions(w);R.bearing=m,R.pitch=v;const P=a.bO.convert(i),F=a.bO.convert(d),V=new a.bO(P.lng,F.lat),j=new a.bO(F.lng,P.lat),Z=R.project(P),Q=R.project(F),K=this.queryTerrainElevation(P),te=this.queryTerrainElevation(F),re=this.queryTerrainElevation(V),pe=this.queryTerrainElevation(j),be=[[Z.x,Z.y,Math.min(K||0,te||0,re||0,pe||0)],[Q.x,Q.y,Math.max(K||0,te||0,re||0,pe||0)]];let ye=a.ce.fromPoints(be);const Ae=R.getWorldToCameraMatrix(),ve=a.ad.mat4.invert(new Float64Array(16),Ae);ye=a.ce.applyTransform(ye,Ae);const Se=this._extendAABB(ye,R,N,m);if(!Se)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ye=Se;const Te=.5*a.ad.vec3.sub([],ye.max,ye.min)[2],Me=this._minimumAABBFrustumDistance(R,ye),ze=[0,0,1,0];a.ad.vec4.transformMat4(ze,ze,Ae),a.ad.vec4.normalize(ze,ze);const ot=a.ad.vec3.scale([],ze,Me+Te),Xe=a.ad.vec3.add([],ye.center,ot);a.ad.vec3.transformMat4(ye.center,ye.center,ve),a.ad.vec3.transformMat4(Xe,Xe,ve);const ft=R.unproject(new a.P(ye.center[0],ye.center[1])),gt=a.dH(R.projection,ft),Mt=Math.pow(2,gt),He=Math.min(R._zoomFromMercatorZ(Xe[2]*R.pixelsPerMeter*Mt/R.worldSize),N.maxZoom);return R.mercatorFromTransition&&He<.5*(a.c6+a.bY)?(R.setProjection({name:"globe"}),R.zoom=He,this._cameraForBounds(R,i,d,m,v,w)):{center:ft,zoom:He,bearing:m,pitch:v}}fitBounds(t,i,d){const m=this.cameraForBounds(t,i);return this._fitInternal(m,i,d)}fitScreenCoordinates(t,i,d,m,v){const w=a.P.convert(t),R=a.P.convert(i),N=new a.P(Math.min(w.x,R.x),Math.min(w.y,R.y)),P=new a.P(Math.max(w.x,R.x),Math.max(w.y,R.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(w,R))return this;const F=this.transform.pointLocation3D(N),V=this.transform.pointLocation3D(P),j=this.transform.pointLocation3D(new a.P(N.x,P.y)),Z=this.transform.pointLocation3D(new a.P(P.x,N.y)),Q=[Math.min(F.lng,V.lng,j.lng,Z.lng),Math.min(F.lat,V.lat,j.lat,Z.lat)],K=[Math.max(F.lng,V.lng,j.lng,Z.lng),Math.max(F.lat,V.lat,j.lat,Z.lat)],te=m&&m.pitch?m.pitch:this.getPitch(),re=this._cameraForBounds(this.transform,Q,K,d,te,m);return this._fitInternal(re,m,v)}_fitInternal(t,i,d){return t?(i=a.l(t,i)).linear?this.easeTo(i,d):this.flyTo(i,d):this}jumpTo(t,i){this.stop();const d=t.preloadOnly?this.transform.clone():this.transform;let m=!1,v=!1,w=!1;"zoom"in t&&d.zoom!==+t.zoom&&(m=!0,d.zoom=+t.zoom),t.center!==void 0&&(d.center=a.bO.convert(t.center)),"bearing"in t&&d.bearing!==+t.bearing&&(v=!0,d.bearing=+t.bearing),"pitch"in t&&d.pitch!==+t.pitch&&(w=!0,d.pitch=+t.pitch);const R=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!d.isPaddingEqual(R))if(t.retainPadding===!1){const N=d.clone();N.padding=R,d.setLocationAtPoint(d.center,N.centerPoint)}else d.padding=R;return t.preloadOnly?(this._preloadTiles(d),this):(this.fire(new a.A("movestart",i)).fire(new a.A("move",i)),m&&this.fire(new a.A("zoomstart",i)).fire(new a.A("zoom",i)).fire(new a.A("zoomend",i)),v&&this.fire(new a.A("rotatestart",i)).fire(new a.A("rotate",i)).fire(new a.A("rotateend",i)),w&&this.fire(new a.A("pitchstart",i)).fire(new a.A("pitch",i)).fire(new a.A("pitchend",i)),this.fire(new a.A("moveend",i)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.w(t_),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,i){const d=this.transform;if(!d.projection.supportsFreeCamera)return a.w(t_),this;this.stop();const m=d.zoom,v=d.pitch,w=d.bearing;d.setFreeCameraOptions(t);const R=m!==d.zoom,N=v!==d.pitch,P=w!==d.bearing;return this.fire(new a.A("movestart",i)).fire(new a.A("move",i)),R&&this.fire(new a.A("zoomstart",i)).fire(new a.A("zoom",i)).fire(new a.A("zoomend",i)),P&&this.fire(new a.A("rotatestart",i)).fire(new a.A("rotate",i)).fire(new a.A("rotateend",i)),N&&this.fire(new a.A("pitchstart",i)).fire(new a.A("pitch",i)).fire(new a.A("pitchend",i)),this.fire(new a.A("moveend",i)),this}easeTo(t,i){this._stop(!1,t.easeId),((t=a.l({offset:[0,0],duration:500,easing:a.dD},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const d=this.transform,m=this.getZoom(),v=this.getBearing(),w=this.getPitch(),R=this.getPadding(),N="zoom"in t?+t.zoom:m,P="bearing"in t?this._normalizeBearing(t.bearing,v):v,F="pitch"in t?+t.pitch:w,V=this._extendPadding(t.padding),j=a.P.convert(t.offset);let Z,Q,K;if(d.projection.name==="globe"){const ze=a.ac.fromLngLat(d.center),ot=j.rotate(-d.angle);ze.x+=ot.x/d.worldSize,ze.y+=ot.y/d.worldSize;const Xe=ze.toLngLat(),ft=a.bO.convert(t.center||Xe);this._normalizeCenter(ft),Z=d.centerPoint.add(ot),Q=new a.P(ze.x,ze.y).mult(d.worldSize),K=new a.P(a.av(ft.lng),a.aC(ft.lat)).mult(d.worldSize).sub(Q)}else{Z=d.centerPoint.add(j);const ze=d.pointLocation(Z),ot=a.bO.convert(t.center||ze);this._normalizeCenter(ot),Q=d.project(ze),K=d.project(ot).sub(Q)}const te=d.zoomScale(N-m);let re,pe;t.around&&(re=a.bO.convert(t.around),pe=d.locationPoint(re));const be=this._zooming||N!==m,ye=this._rotating||v!==P,Ae=this._pitching||F!==w,ve=!d.isPaddingEqual(V),Se=t.retainPadding===!1?d.clone():d,Te=ze=>ot=>{if(be&&(ze.zoom=a.ah(m,N,ot)),ye&&(ze.bearing=a.ah(v,P,ot)),Ae&&(ze.pitch=a.ah(w,F,ot)),ve&&(Se.interpolatePadding(R,V,ot),Z=Se.centerPoint.add(j)),re)ze.setLocationAtPoint(re,pe);else{const Xe=ze.zoomScale(ze.zoom-m),ft=N>m?Math.min(2,te):Math.max(.5,te),gt=Math.pow(ft,1-ot),Mt=ze.unproject(Q.add(K.mult(ot*gt)).mult(Xe));ze.setLocationAtPoint(ze.renderWorldCopies?Mt.wrap():Mt,Z)}return t.preloadOnly||this._fireMoveEvents(i),ze};if(t.preloadOnly){const ze=this._emulate(Te,t.duration,d);return this._preloadTiles(ze),this}const Me={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=be,this._rotating=ye,this._pitching=Ae,this._padding=ve,this._easeId=t.easeId,this._prepareEase(i,t.noMoveStart,Me),this._ease(Te(d),ze=>{d.cameraElevationReference==="sea"&&d.recenterOnTerrain(),this._afterEase(i,ze)},t),this}_prepareEase(t,i,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),i||d.moving||this.fire(new a.A("movestart",t)),this._zooming&&!d.zooming&&this.fire(new a.A("zoomstart",t)),this._rotating&&!d.rotating&&this.fire(new a.A("rotatestart",t)),this._pitching&&!d.pitching&&this.fire(new a.A("pitchstart",t))}_fireMoveEvents(t){this.fire(new a.A("move",t)),this._zooming&&this.fire(new a.A("zoom",t)),this._rotating&&this.fire(new a.A("rotate",t)),this._pitching&&this.fire(new a.A("pitch",t))}_afterEase(t,i){if(this._easeId&&i&&this._easeId===i)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const d=this._zooming,m=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new a.A("zoomend",t)),m&&this.fire(new a.A("rotateend",t)),v&&this.fire(new a.A("pitchend",t)),this.fire(new a.A("moveend",t))}flyTo(t,i){if(this._prefersReducedMotion(t)){const lt=a.aA(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(lt,i)}this.stop(),t=a.l({offset:[0,0],speed:1.2,curve:1.42,easing:a.dD},t);const d=this.transform,m=this.getZoom(),v=this.getBearing(),w=this.getPitch(),R=this.getPadding(),N="zoom"in t?a.ay(+t.zoom,d.minZoom,d.maxZoom):m,P="bearing"in t?this._normalizeBearing(t.bearing,v):v,F="pitch"in t?+t.pitch:w,V=this._extendPadding(t.padding),j=d.zoomScale(N-m),Z=a.P.convert(t.offset);let Q=d.centerPoint.add(Z);const K=d.pointLocation(Q),te=a.bO.convert(t.center||K);this._normalizeCenter(te);const re=d.project(K),pe=d.project(te).sub(re);let be=t.curve;const ye=Math.max(d.width,d.height),Ae=ye/j,ve=pe.mag();if("minZoom"in t){const lt=a.ay(Math.min(t.minZoom,m,N),d.minZoom,d.maxZoom),yt=ye/d.zoomScale(lt-m);be=Math.sqrt(yt/ve*2)}const Se=be*be;function Te(lt){const yt=(Ae*Ae-ye*ye+(lt?-1:1)*Se*Se*ve*ve)/(2*(lt?Ae:ye)*Se*ve);return Math.log(Math.sqrt(yt*yt+1)-yt)}function Me(lt){return(Math.exp(lt)-Math.exp(-lt))/2}function ze(lt){return(Math.exp(lt)+Math.exp(-lt))/2}const ot=Te(0);let Xe=function(lt){return ze(ot)/ze(ot+be*lt)},ft=function(lt){return ye*((ze(ot)*(Me(yt=ot+be*lt)/ze(yt))-Me(ot))/Se)/ve;var yt},gt=(Te(1)-ot)/be;if(Math.abs(ve)<1e-6||!isFinite(gt)){if(Math.abs(ye-Ae)<1e-6)return this.easeTo(t,i);const lt=Ae<ye?-1:1;gt=Math.abs(Math.log(Ae/ye))/be,ft=function(){return 0},Xe=function(yt){return Math.exp(lt*be*yt)}}t.duration="duration"in t?+t.duration:1e3*gt/("screenSpeed"in t?+t.screenSpeed/be:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const Mt=v!==P,He=F!==w,mt=!d.isPaddingEqual(V),qe=t.retainPadding===!1?d.clone():d,pt=lt=>yt=>{const st=yt*gt,dt=1/Xe(st);lt.zoom=yt===1?N:m+lt.scaleZoom(dt),Mt&&(lt.bearing=a.ah(v,P,yt)),He&&(lt.pitch=a.ah(w,F,yt)),mt&&(qe.interpolatePadding(R,V,yt),Q=qe.centerPoint.add(Z));const Ht=yt===1?te:lt.unproject(re.add(pe.mult(ft(st))).mult(dt));return lt.setLocationAtPoint(lt.renderWorldCopies?Ht.wrap():Ht,Q),lt._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(i),lt};if(t.preloadOnly){const lt=this._emulate(pt,t.duration,d);return this._preloadTiles(lt),this}return this._zooming=!0,this._rotating=Mt,this._pitching=He,this._padding=mt,this._prepareEase(i,!1),this._ease(pt(d),()=>this._afterEase(i),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,i){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const d=this._onEaseEnd;this._onEaseEnd=void 0,d.call(this,i)}if(!t){const d=this.handlers;d&&d.stop(!1)}return this}_ease(t,i,d){d.animate===!1||d.duration===0?(t(1),i()):(this._easeStart=a.q.now(),this._easeOptions=d,this._onEaseFrame=t,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((a.q.now()-this._easeStart)/this._easeOptions.duration,1),i=this._onEaseFrame;i&&i(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,i){t=a.bF(t,-180,180);const d=Math.abs(t-i);return Math.abs(t-360-i)<d&&(t-=360),Math.abs(t+360-i)<d&&(t+=360),t}_normalizeCenter(t){const i=this.transform;if(i.maxBounds||i.projection.name!=="globe"&&!i.renderWorldCopies)return;const d=t.lng-i.center.lng;t.lng+=d>180?-360:d<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&a.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,i,d){const m=Math.ceil(15*i/1e3),v=[],w=t(d.clone());for(let R=0;R<=m;R++){const N=w(R/m);v.push(N.clone())}return v}_preloadTiles(t,i){}}class Om{constructor(t={}){this.options=t,a.aQ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const i=this.options&&this.options.compact,d=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=Ue("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ue("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",d);const m=Ue("span","mapboxgl-ctrl-icon",this._compactButton);return m.setAttribute("aria-hidden","true"),m.setAttribute("title",d),this._innerContainer=Ue("div","mapboxgl-ctrl-attrib-inner",this._container),i&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),i===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.e.ACCESS_TOKEN}];if(t){const d=i.reduce((m,v,w)=>(v.value&&(m+=`${v.key}=${v.value}${w<i.length-1?"&":""}`),m),"?");t.href=`${a.e.FEEDBACK_URL}/${d}#${$g(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const i=this._map.style._mergedSourceCaches;for(const m in i){const v=i[m];if(v.used){const w=v.getSource();w.attribution&&t.indexOf(w.attribution)<0&&t.push(w.attribution)}}t.sort((m,v)=>m.length-v.length),t=t.filter((m,v)=>{for(let w=v+1;w<t.length;w++)if(t[w].indexOf(m)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const d=t.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,t.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Vs{constructor(){a.aQ(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=Ue("div","mapboxgl-ctrl");const i=Ue("a","mapboxgl-ctrl-logo");return i.target="_blank",i.rel="noopener nofollow",i.href="https://www.mapbox.com/",i.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),i.setAttribute("rel","noopener nofollow"),this._container.appendChild(i),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const i in t){const d=t[i].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const i=t[0];this._map.getCanvasContainer().offsetWidth<250?i.classList.add("mapboxgl-compact"):i.classList.remove("mapboxgl-compact")}}}class qs{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const i=++this._id;return this._queue.push({callback:t,id:i,cancelled:!1}),i}remove(t){const i=this._currentlyRunning,d=i?this._queue.concat(i):this._queue;for(const m of d)if(m.id===t)return void(m.cancelled=!0)}run(t=0){const i=this._currentlyRunning=this._queue;this._queue=[];for(const d of i)if(!d.cancelled&&(d.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Sh{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const i=a.cC((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-i)+this._end*i}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,i,d){this._start=this.getValue(i),this._end=t,this._startTime=i,this._endTime=i+d}}const Ma={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Bl extends a.A{constructor(t,i,d,m){const{point:v,lngLat:w,originalEvent:R,target:N}=t;super(t.type,{point:v,lngLat:w,originalEvent:R,target:N}),this.preventDefault=()=>{t.preventDefault()},this.id=i,this.interaction=d,this.feature=m}}class Im{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,i){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const d=i.filter;let m=i.type;d&&this.filters.set(t,a.a_(d)),m==="mouseover"&&(m="mouseenter"),m==="mouseout"&&(m="mouseleave");const v=this.interactionsByType.get(m)||new Map;m==="mouseenter"||m==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,i)):v.size===0&&this.map.on(m,this.handleType),v.size===0&&this.interactionsByType.set(m,v),v.set(t,i),this.typeById.set(t,m)}get(t){const i=this.typeById.get(t);if(!i)return;const d=this.interactionsByType.get(i);return d?d.get(t):void 0}remove(t){const i=this.typeById.get(t);if(!i)return;this.typeById.delete(t),this.filters.delete(t);const d=this.interactionsByType.get(i);d&&(d.delete(t),i==="mouseenter"||i==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):d.size===0&&this.map.off(i,this.handleType))}queryTargets(t,i){const d=[];for(const[m,v]of i)v.target&&d.push({targetId:m,target:v.target,filter:this.filters.get(m)});return this.map.style.queryRenderedTargets(t,d,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const i=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());i.length&&(t.type="mouseenter",this.handleType(t,i));const d=new Map;for(const[m,{feature:v}]of this.prevHoveredFeatures)this.hoveredFeatures.has(m)||d.set(v.id,v);d.size&&(t.type="mouseleave",this.handleType(t,Array.from(d.values())))}handleOut(t){const i=Array.from(this.hoveredFeatures.values()).map(({feature:d})=>d);i.length&&(t.type="mouseleave",this.handleType(t,i)),this.hoveredFeatures.clear()}handleType(t,i){const d=Array.from(this.interactionsByType.get(t.type)).reverse(),m=!!i;i=i||this.queryTargets(t.point,d);const v=t.type==="mouseenter";let w=!1;const R=new Set;for(const N of i){for(const[P,F]of d){if(!F.target)continue;const V=N.variants?N.variants[P]:null;if(V){for(const j of V){if(wl(j,N,R,P))continue;const Z=new a.cx(N,j),Q=Cu(j,N,P);m&&(Z.state=this.map.getFeatureState(Z));const K=v?this.prevHoveredFeatures.get(Q):null,te=new Bl(t,P,F,Z),re=K?K.stop:F.handler(te);if(v&&this.hoveredFeatures.set(Q,{feature:N,stop:re}),re!==!1){w=!0;break}}if(w)break}}if(w)break}if(!w)for(const[N,P]of d){const{handler:F,target:V}=P;if(!V&&F(new Bl(t,N,P,null))!==!1)break}}}function hr(h,t){if(Array.isArray(h)&&Array.isArray(t)){const i=new Set(h),d=new Set(t);return i.size===d.size&&h.every(m=>d.has(m))}return a.bn(h,t)}const Ec={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Uy={showCompass:!0,showZoom:!0,visualizePitch:!1};class jy{constructor(t,i,d=!1){this._clickTolerance=10,this.element=i,this.mouseRotate=new _s({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,d&&(this.mousePitch=new _h({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),a.aQ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener("mousedown",this.mousedown),i.addEventListener("touchstart",this.touchstart,{passive:!1}),i.addEventListener("touchmove",this.touchmove),i.addEventListener("touchend",this.touchend),i.addEventListener("touchcancel",this.reset)}down(t,i){this.mouseRotate.mousedown(t,i),this.mousePitch&&this.mousePitch.mousedown(t,i),St()}move(t,i){const d=this.map,m=this.mouseRotate.mousemoveWindow(t,i),v=m&&m.bearingDelta;if(v&&d.setBearing(d.getBearing()+v),this.mousePitch){const w=this.mousePitch.mousemoveWindow(t,i),R=w&&w.pitchDelta;R&&d.setPitch(d.getPitch()+R)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Xt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(a.l({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),rn(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,rn(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ut(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Ut(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Nm(h,t,i){if(h=new a.bO(h.lng,h.lat),t){const d=new a.bO(h.lng-360,h.lat),m=new a.bO(h.lng+360,h.lat),v=360*Math.ceil(Math.abs(h.lng-i.center.lng)/360),w=i.locationPoint3D(h).distSqr(t),R=t.x<0||t.y<0||t.x>i.width||t.y>i.height;i.locationPoint3D(d).distSqr(t)<w&&(R||Math.abs(d.lng-i.center.lng)<v)?h=d:i.locationPoint3D(m).distSqr(t)<w&&(R||Math.abs(m.lng-i.center.lng)<v)&&(h=m)}for(;Math.abs(h.lng-i.center.lng)>180;){const d=i.locationPoint3D(h);if(d.x>=0&&d.y>=0&&d.x<=i.width&&d.y<=i.height)break;h.lng>i.center.lng?h.lng-=360:h.lng+=360}return h}const ll={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Ki={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class bo extends a.E{constructor(t,i){super(),(t instanceof HTMLElement||i)&&(t=a.l({element:t},i)),a.aQ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:d="center",color:m="#3FB1CE",scale:v=1,draggable:w=!1,clickTolerance:R=0,rotation:N=Ki.rotation,rotationAlignment:P=Ki.rotationAlignment,pitchAlignment:F=Ki.pitchAlignment,occludedOpacity:V=Ki.occludedOpacity,altitude:j=Ki.altitude}=t||{};this._anchor=d,this._color=m,this._scale=v,this._draggable=w,this._clickTolerance=R,this._rotation=N,this._rotationAlignment=P,this._pitchAlignment=F,this._occludedOpacity=V,this._altitude=j,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=a.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=a.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",K=>{K.preventDefault()}),this._element.addEventListener("mousedown",K=>{K.preventDefault()});const Z=this._element.classList;for(const K in ll)Z.remove(`mapboxgl-marker-anchor-${K}`);Z.add(`mapboxgl-marker-anchor-${this._anchor}`);const Q=t&&t.className?t.className.trim().split(/\s+/):[];Z.add(...Q),this._popup=null}_createDefaultMarker(){const t=Ue("div"),i=Pe("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const d=Pe("radialGradient",{id:"shadowGradient"},Pe("defs",{},i));Pe("stop",{offset:"10%","stop-opacity":.4},d),Pe("stop",{offset:"100%","stop-opacity":.05},d),Pe("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},i)}return Pe("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},i),Pe("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},i),Pe("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},i),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=a.bO.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||Ki.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const m=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const i=t.code,d=t.charCode||t.keyCode;i!=="Space"&&i!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(t){const i=t.originalEvent.target,d=this._element;this._popup&&(i===d||d.contains(i))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,i=this._pos;if(!t||!i)return!1;const d=t.unproject(i,this._altitude),m=t.getFreeCameraOptions();if(!m.position)return!1;const v=m.position.toLngLat();return v.distanceTo(d)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const i=this._pos;if(!i||i.x<0||i.x>t.transform.width||i.y<0||i.y>t.transform.height)return void this._clearFadeTimer();const d=t.unproject(i,this._altitude);let m;t._showingGlobe()&&a.dK(t.transform,this._lngLat)?m=0:(m=1-t._queryFogOpacity(d),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(m*=this._occludedOpacity)),this._element.style.opacity=`${m}`,this._element.style.pointerEvents=m>0?"auto":"none",this._popup&&this._popup._setOpacity(m),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const i=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${ll[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${i.x}px,${i.y}px)
        `}_calculateXYTransform(){const t=this._pos,i=this._map,d=this.getPitchAlignment();if(!i||!t||d!=="map")return"";if(!i._showingGlobe()){const N=i.getPitch();return N?`rotateX(${N}deg)`:""}const m=a.c4(a.dL(i.transform,this._lngLat)),v=t.sub(a.dM(i.transform)),w=Math.abs(v.x)+Math.abs(v.y);if(w===0)return"";const R=m/w;return`rotateX(${-v.y*R}deg) rotateY(${v.x*R}deg)`}_calculateZTransform(){const t=this._pos,i=this._map;if(!i||!t)return"";let d=0;const m=this.getRotationAlignment();if(m==="map")if(i._showingGlobe()){const v=i.project(new a.bO(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),w=i.project(new a.bO(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(v);d=a.c4(Math.atan2(w.y,w.x))-90}else d=-i.getBearing();else if(m==="horizon"){const v=a.ae(4,6,i.getZoom()),w=a.dM(i.transform);w.y+=v*i.transform.height;const R=t.sub(w),N=a.c4(Math.atan2(R.y,R.x));d=(N>90?N-270:N+90)*(1-v)}return d+=this._rotation,d?`rotateZ(${d}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const i=this._map;i&&(i.transform.renderWorldCopies&&(this._lngLat=Nm(this._lngLat,this._pos,i.transform)),this._pos=i.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),i._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(i._showingGlobe()||i.getTerrain()||i.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=a.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const i=this._map;if(!i)return;const d=this._pointerdownPos,m=this._positionDelta;if(d&&m){if(!this._isDragging){const v=this._clickTolerance||i._clickTolerance;if(t.point.dist(d)<v)return;this._isDragging=!0}this._pos=t.point.sub(m),this._lngLat=i.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.A("dragstart"))),this.fire(new a.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new a.A("dragend")),this._state="inactive"}_addDragHandler(t){const i=this._map,d=this._pos;i&&d&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(d),this._pointerdownPos=t.point,this._state="pending",i.on("mousemove",this._onMove),i.on("touchmove",this._onMove),i.once("mouseup",this._onUp),i.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const i=this._map;return i&&(t?(i.on("mousedown",this._addDragHandler),i.on("touchstart",this._addDragHandler)):(i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||Ki.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||Ki.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||Ki.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||Ki.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const vs={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Sr={maxWidth:100,unit:"metric"},qf={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},xs={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},n_=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function uu(h=new a.P(0,0),t="bottom"){if(typeof h=="number"){const i=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(t){case"top":return new a.P(0,h);case"top-left":return new a.P(i,i);case"top-right":return new a.P(-i,i);case"bottom":return new a.P(0,-h);case"bottom-left":return new a.P(i,-i);case"bottom-right":return new a.P(-i,-i);case"left":return new a.P(h,0);case"right":return new a.P(-h,0)}return new a.P(0,0)}return h instanceof a.P||Array.isArray(h)?a.P.convert(h):a.P.convert(h[t]||[0,0])}return{version:ee,supported:Re.supported,setRTLTextPlugin:a.dN,getRTLTextPluginStatus:a.dO,Map:class extends wh{constructor(h){fe.mark(se.create);const t=h;if((h=a.l({},Ec,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&a.dI(window)&&(h.antialias=!1,a.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new gf(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies,null,null),h),this._repaint=!!h.repaint,this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new qs,this._domRenderTaskQueue=new qs,this._controls=[],this._markers=[],this._popups=[],this._mapId=a.aW(),this._locale=a.l({},Ma,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._tessellationStep=h.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=h.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Sh(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=h.scaleFactor,this._requestManager=new mn(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,this._contextCreateOptions=h.contextCreateOptions?Object.assign({},h.contextCreateOptions):{},typeof h.container=="string"){const i=document.getElementById(h.container);if(!i)throw new Error(`Container '${h.container.toString()}' not found.`);this._container=i}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&a.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),this._spriteFormat=h.spriteFormat,a.aQ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new iu),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new km(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,(h.style||!h.testMode)&&this.setStyle(h.style||a.e.DEFAULT_STYLE,{config:h.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),this.indoor=new Zd(this),h.hash&&(this._hash=new ph(typeof h.hash=="string"&&h.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch});const i=h.bounds;i&&(this.resize(),this.fitBounds(i,a.l({},h.fitBoundsOptions,{duration:0})))}this.resize(),h.attributionControl&&this.addControl(new Om({customAttribution:h.customAttribution})),this._logoControl=new Vs,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",i=>{this._update(i.dataType==="style"),this.fire(new a.A(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new a.A(`${i.dataType}dataloading`,i))}),this._interactions=new Im(this)}_getMapId(){return this._mapId}addControl(h,t){if(t===void 0&&(t=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new a.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=h.onAdd(this);this._controls.push(h);const d=this._controlPositions[t];return t.indexOf("bottom")!==-1?d.insertBefore(i,d.firstChild):d.appendChild(i),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new a.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(h);return t>-1&&this._controls.splice(t,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new a.A("movestart",h)).fire(new a.A("move",h)),this.fire(new a.A("resize",h)),t&&this.fire(new a.A("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(a.aB.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new a.A("zoomstart")).fire(new a.A("zoom")).fire(new a.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new a.A("zoomstart")).fire(new a.A("zoom")).fire(new a.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new a.A("pitchstart")).fire(new a.A("pitch")).fire(new a.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new a.A("pitchstart")).fire(new a.A("pitch")).fire(new a.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(h){return this._scaleFactor=h,this.painter.scaleFactor=h,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return h==="auto"?navigator.language:Array.isArray(h)?h.length===0?void 0:h.map(t=>t==="auto"?navigator.language:t):h}setLanguage(h){const t=this._parseLanguage(h);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const i of this._controls)i._setLanguage&&i._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(h){return this._lazyInitEmptyStyle(),h?typeof h=="string"&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const h=this.transform,t=h.projection.name;let i;t==="globe"&&h.zoom>=a.bY?(h.setMercatorFromTransition(),i=!0):t==="mercator"&&h.zoom<a.bY&&(h.setProjection({name:"globe"}),i=!0),i&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(h,t){return this._updateProjection(h||t||{name:"mercator"})}_updateProjection(h){let t;return t=h.name==="globe"&&this.transform.zoom>=a.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(h,t){return this.transform.locationPoint3D(a.bO.convert(h),t)}unproject(h,t){return this.transform.pointLocation3D(a.P.convert(h),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,t,i){const d=m=>{let v=[];if(Array.isArray(t)){const w=t.filter(R=>this.getLayer(R));v=w.length?this.queryRenderedFeatures(m,{layers:w}):[]}else v=this.queryRenderedFeatures(m,{target:t});return v};if(h==="mouseenter"||h==="mouseover"){let m=!1;return{listener:i,targets:t,delegates:{mousemove:w=>{const R=d(w.point);R.length?m||(m=!0,i.call(this,new Qo(h,this,w.originalEvent,{features:R}))):m=!1},mouseout:()=>{m=!1}}}}if(h==="mouseleave"||h==="mouseout"){let m=!1;return{listener:i,targets:t,delegates:{mousemove:R=>{d(R.point).length?m=!0:m&&(m=!1,i.call(this,new Qo(h,this,R.originalEvent)))},mouseout:R=>{m&&(m=!1,i.call(this,new Qo(h,this,R.originalEvent)))}}}}{const m=v=>{const w=d(v.point);w.length&&(v.features=w,i.call(this,v),delete v.features)};return{listener:i,targets:t,delegates:{[h]:m}}}}on(h,t,i){if(typeof t=="function"||i===void 0)return super.on(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._createDelegatedListener(h,t,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(d);for(const m in d.delegates)this.on(m,d.delegates[m]);return this}once(h,t,i){if(typeof t=="function"||i===void 0)return super.once(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._createDelegatedListener(h,t,i);for(const m in d.delegates)this.once(m,d.delegates[m]);return this}off(h,t,i){if(typeof t=="function"||i===void 0)return super.off(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._delegatedListeners?this._delegatedListeners[h]:void 0;return d&&(m=>{for(let v=0;v<m.length;v++){const w=m[v];if(w.listener===i&&hr(w.targets,t)){for(const R in w.delegates)this.off(R,w.delegates[R]);return m.splice(v,1),this}}})(d),this}queryRenderedFeatures(h,t){if(!this.style)return[];if(h===void 0||h instanceof a.P||Array.isArray(h)||t!==void 0||(t=h,h=void 0),h=h||[[0,0],[this.transform.width,this.transform.height]],!t){const v=this.style.queryRenderedFeatures(h,void 0,this.transform),w=this.style.queryRenderedFeatureset(h,void 0,this.transform);return v.concat(w)}let i=!0;if(t.target&&(i=this._isTargetValid(t.target),i&&!t.layers))return this.style.queryRenderedFeatureset(h,t,this.transform);let d=!0;if(t.layers&&Array.isArray(t.layers)){for(const v of t.layers)if(!this._isValidId(v)){d=!1;break}if(d&&!t.target)return this.style.queryRenderedFeatures(h,t,this.transform)}let m=[];return d&&(m=m.concat(this.style.queryRenderedFeatures(h,t,this.transform))),i&&(m=m.concat(this.style.queryRenderedFeatureset(h,t,this.transform))),m}querySourceFeatures(h,t){return!h||typeof h=="string"&&!this._isValidId(h)?[]:this.style.querySourceFeatures(h,t)}isPointOnSurface(h){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&a.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(a.P.convert(h))}addInteraction(h,t){return this._interactions.add(h,t),this}removeInteraction(h){return this._interactions.remove(h),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(h){return this._cooperativeGestures=h,this}setStyle(h,t){return t=a.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&h&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(h,(i,d)=>{i?(a.w(`Unable to perform style diff: ${String(i.message||i.error||i)}. Rebuilding the style from scratch.`),this._updateStyle(h,t)):d&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(h,t))}_getUIString(h){const t=this._locale[h];if(t==null)throw new Error(`Missing UI string '${h}'`);return t}_updateStyle(h,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h){const i=a.l({},t);t&&t.config&&(i.initialConfig=t.config,delete i.config),this.style=new Qa(this,i).load(h),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Qa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.w("There is no style added to the map."),!1)}_isValidId(h){return h==null?(this.fire(new a.z(new Error("IDs can't be empty."))),!1):!a.cs(h)||(this.fire(new a.z(new Error(`IDs can't contain special symbols: "${h}".`))),!1)}_isTargetValid(h){return"featuresetId"in h?this._isValidId("importId"in h?h.importId:h.featuresetId):"layerId"in h&&this._isValidId(h.layerId)}_areTargetsValid(h){if(Array.isArray(h)){for(const t of h)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(h)}addSource(h,t){return this._isValidId(h)?(this._lazyInitEmptyStyle(),this.style.addSource(h,t),this._update(!0)):this}isSourceLoaded(h){return!!this._isValidId(h)&&!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(h,t,i){this._lazyInitEmptyStyle(),this.style.addSourceType(h,t,i)}removeSource(h){return this._isValidId(h)?(this.style.removeSource(h),this._updateTerrain(),this._update(!0)):this}getSource(h){return this._isValidId(h)?this.style.getOwnSource(h):null}addImage(h,t,{pixelRatio:i=1,sdf:d=!1,stretchX:m,stretchY:v,content:w}={}){this._lazyInitEmptyStyle();const R=a.I.from(h);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:N,height:P,data:F}=a.q.getImageData(t);this.style.addImage(R,this.style.scope,{data:new a.r({width:N,height:P},F),pixelRatio:i,stretchX:m,stretchY:v,content:w,sdf:d,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new a.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:N,height:P}=t,F=t;this.style.addImage(R,this.style.scope,{data:new a.r({width:N,height:P},new Uint8Array(F.data)),pixelRatio:i,stretchX:m,stretchY:v,content:w,sdf:d,usvg:!1,version:0,userImage:F}),F.onAdd&&F.onAdd(this,h)}}updateImage(h,t){this._lazyInitEmptyStyle();const i=a.I.from(h),d=this.style.getImage(i,this.style.scope);if(!d)return void this.fire(new a.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?a.q.getImageData(t):t,{width:v,height:w,data:R}=m;if(v===void 0||w===void 0)return void this.fire(new a.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==(d.usvg?d.icon.usvg_tree.width:d.data.width)||w!==(d.usvg?d.icon.usvg_tree.height:d.data.height))return void this.fire(new a.z(new Error(`The width and height of the updated image (${v}, ${w})
                must be that same as the previous version of the image
                (${d.data.width}, ${d.data.height})`)));const N=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let P=!1;d.usvg?(d.data=new a.r({width:v,height:w},new Uint8Array(R)),d.usvg=!1,d.icon=void 0,P=!0):d.data.replace(R,N),this.style.updateImage(i,this.style.scope,d,P)}hasImage(h){return h?!!this.style&&!!this.style.getImage(a.I.from(h),this.style.scope):(this.fire(new a.z(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(a.I.from(h),this.style.scope)}loadImage(h,t){a.o(this._requestManager.transformRequest(h,a.R.Image),(i,d)=>{t(i,d instanceof HTMLImageElement?a.q.getImageData(d):d)})}listImages(){return this.style.listImages().map(h=>h.name)}addModel(h,t){this._lazyInitEmptyStyle(),this.style.addModel(h,t)}hasModel(h){return h?this.style.hasModel(h):(this.fire(new a.z(new Error("Missing required model id"))),!1)}removeModel(h){this.style.removeModel(h)}listModels(){return this.style.listModels()}addLayer(h,t){return this._isValidId(h.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(h,t),this._update(!0)):this}getSlot(h){const t=this.getLayer(h);return t&&t.slot||null}setSlot(h,t){return this.style.setSlot(h,t),this.style.mergeLayers(),this._update(!0)}addImport(h,t){return this.style.addImport(h,t),this}updateImport(h,t){return typeof t!="string"&&t.id!==h?(this.removeImport(h),this.addImport(t)):(this.style.updateImport(h,t),this._update(!0))}removeImport(h){return this.style.removeImport(h),this}moveImport(h,t){return this.style.moveImport(h,t),this._update(!0)}moveLayer(h,t){return this._isValidId(h)?(this.style.moveLayer(h,t),this._update(!0)):this}removeLayer(h){return this._isValidId(h)?(this.style.removeLayer(h),this._update(!0)):this}getLayer(h){if(!this._isValidId(h))return null;const t=this.style.getOwnLayer(h);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(h,t,i){return this._isValidId(h)?(this.style.setLayerZoomRange(h,t,i),this._update(!0)):this}setFilter(h,t,i={}){return this._isValidId(h)?(this.style.setFilter(h,t,i),this._update(!0)):this}getFilter(h){return this._isValidId(h)?this.style.getFilter(h):null}setPaintProperty(h,t,i,d={}){return this._isValidId(h)?(this.style.setPaintProperty(h,t,i,d),this._update(!0)):this}getPaintProperty(h,t){return this._isValidId(h)?this.style.getPaintProperty(h,t):null}setLayoutProperty(h,t,i,d={}){return this._isValidId(h)?(this.style.setLayoutProperty(h,t,i,d),this._update(!0)):this}getLayoutProperty(h,t){return this._isValidId(h)?this.style.getLayoutProperty(h,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(h){return this.style.setGlyphsUrl(h),this._update(!0)}getSchema(h){return this.style.getSchema(h)}setSchema(h,t){return this.style.setSchema(h,t),this._update(!0)}getConfig(h){return this.style.getConfig(h)}setConfig(h,t){return this.style.setConfig(h,t),this._update(!0)}getConfigProperty(h,t){return this.style.getConfigProperty(h,t)}setConfigProperty(h,t,i){return this.style.setConfigProperty(h,t,i),this._update(!0)}getFeaturesetDescriptors(h){return this.style.getFeaturesetDescriptors(h)}setLights(h){if(this._lazyInitEmptyStyle(),h&&h.length===1&&h[0].type==="flat"){const t=h[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(h),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const h=this.style.getLights()||[];return h.length===0&&h.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),h}setLight(h,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:h}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(h){return this._lazyInitEmptyStyle(),this.style.setSnow(h),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(h){return this._lazyInitEmptyStyle(),this.style.setRain(h),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(h){return this._lazyInitEmptyStyle(),this.style.setColorTheme(h),this._update(!0)}setImportColorTheme(h,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(h,t),this._update(!0)}setCamera(h){return this.style.setCamera(h),this._triggerCameraUpdate(h)}_triggerCameraUpdate(h){return this._update(this.transform.setOrthographicProjectionAtLowPitch(h["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.bO.convert(h),this.transform):0}setFeatureState(h,t){return h.source&&!this._isValidId(h.source)?this:(this.style.setFeatureState(h,t),this._update())}removeFeatureState(h,t){return h.source&&!this._isValidId(h.source)?this:(this.style.removeFeatureState(h,t),this._update())}getFeatureState(h){return h.source&&!this._isValidId(h.source)?null:this.style.getFeatureState(h)}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let i,d,m,v=this._container;for(;v&&(!d||!m);){const w=window.getComputedStyle(v).transform;w&&w!=="none"&&(i=w.match(/matrix.*\((.+)\)/)[1].split(", "),i[0]&&i[0]!=="0"&&i[0]!=="1"&&(d=i[0]),i[3]&&i[3]!=="0"&&i[3]!=="1"&&(m=i[3])),v=v.parentElement}this._containerWidth=d?Math.abs(h/d):h,this._containerHeight=m?Math.abs(t/m):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ue("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=Ue("div","mapboxgl-canvas-container",h);this._canvas=Ue("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const i=this._controlContainer=Ue("div","mapboxgl-control-container",h),d=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(m=>{d[m]=Ue("div",`mapboxgl-ctrl-${m}`,i)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,t){const i=a.q.devicePixelRatio||1;this._canvas.width=i*Math.ceil(h),this._canvas.height=i*Math.ceil(t),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${t}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const t=this._markers.indexOf(h);t!==-1&&this._markers.splice(t,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){const t=this._popups.indexOf(h);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const h=a.l({},Re.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",h);t?(Uo(t,!0),this.painter=new hh(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",i=>{i.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.m.testSupport(t)):this.fire(new a.z(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.A("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style.reloadModels(),this.style.clearSources(),this._update(),this.fire(new a.A("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let t;this.fire(new a.A("renderstart")),++this._frameId;const i=this.painter.context.extTimerQuery,d=a.q.now(),m=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=m.createQuery(),m.beginQuery(i.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const P=this.transform.zoom,F=this.transform.pitch,V=a.q.now(),j=new a.aa(P,{now:V,fadeDuration:v,pitch:F,transition:this.style.transition});this.style.update(j)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(d),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):w=this._updateAverageElevation(d);const R=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),R&&(this._placementDirty=R.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,fe.mark(se.load),this.fire(new a.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const P=a.q.now()-d;m.endQuery(i.TIME_ELAPSED_EXT),setTimeout(()=>{const F=m.getQueryParameter(t,m.QUERY_RESULT)/1e6;m.deleteQuery(t),this.fire(new a.A("gpu-timing-frame",{cpuTime:P,gpuTime:F}))},50)}if(this.listens("gpu-timing-layer")){const P=this.painter.collectGpuTimers();setTimeout(()=>{const F=this.painter.queryGpuTimers(P);this.fire(new a.A("gpu-timing-layer",{layerTimes:F}))},50)}if(this.listens("gpu-timing-deferred-render")){const P=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const F=this.painter.queryGpuTimeDeferredRender(P);this.fire(new a.A("gpu-timing-deferred-render",{gpuTime:F}))},50)}const N=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(N||this._repaint)this.triggerRepaint();else{const P=this.idle();if(P&&(w=this._updateAverageElevation(d,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),P&&(this.fire(new a.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const F=this._calculateSpeedIndex();this.fire(new a.A("speedindexcompleted",{speedIndex:F})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||N||(this._fullyLoaded=!0,fe.mark(se.fullLoad),this._performanceMetricsCollection&&sr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(const t of this._markers)h&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!h||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(h,t=!1){const i=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&i(0);const d=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(d||(t||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const m=this.transform.averageElevation;let v=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=h;const w=Math.abs(m-v);if(w>1){if(this._isInitialLoad||d)return this._averageElevation.jumpTo(v),i(v);this._averageElevation.easeTo(v,h,300)}else if(w>1e-4)return this._averageElevation.jumpTo(v),i(v)}return!!this._averageElevation.isEasing(h)&&i(this._averageElevation.getValue(h))}_authenticate(){de(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===An||h.status===401)){const t=this.painter.context.gl;Uo(t,!1),this._logoControl instanceof Vs&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),ir(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&rr(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const i=this.painter.context.gl,d=i.createFramebuffer();function m(v){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,v,0);const w=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,w),w}return i.bindFramebuffer(i.FRAMEBUFFER,d),this._canvasPixelComparison(m(h),t.canvasCopies.map(m),t.timeStamps)}_canvasPixelComparison(h,t,i){let d=i[1]-i[0];const m=h.length/4;for(let v=0;v<t.length;v++){const w=t[v];let R=0;for(let N=0;N<w.length;N+=4)w[N]===h[N]&&w[N+1]===h[N+1]&&w[N+2]===h[N+2]&&w[N+3]===h[N+3]&&(R+=1);d+=(i[v+2]-i[v+1])*(1-R/m)}return d}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),po.delete(this.painter.context.gl),Yr.remove(),Vt.remove(),this._removed=!0,this.fire(new a.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=a.q.frame(t=>{const i=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,i&&this._render(t)}))}_preloadTiles(h){const t=this.style?this.style.getSourceCaches():[];return a.bl(t,(i,d)=>i._preloadTiles(h,d),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(h){this._showParseStatus!==h&&(this._showParseStatus=h,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(h){this._showLayers2DWireframe!==h&&(this._showLayers2DWireframe=h,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(h){this._showLayers3DWireframe!==h&&(this._showLayers3DWireframe=h,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,this._tp.refreshUI(),h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,this._tp.refreshUI(),h&&this._update())}_setCacheLimits(h,t){a.dJ(h,t)}get version(){return ee}},NavigationControl:class{constructor(h={}){this.options=a.l({},Uy,h),this._container=Ue("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(a.aQ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),Ue("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),Ue("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.aQ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const i=this._map;i&&(this.options.visualizePitch?i.resetNorthPitch({},{originalEvent:t}):i.resetNorth({},{originalEvent:t}))}),this._compassIcon=Ue("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const t=h.getZoom(),i=t===h.getMaxZoom(),d=t===h.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new jy(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,t){const i=Ue("button",h,this._container);return i.type="button",i.addEventListener("click",t),i}_setButtonTitle(h,t){if(!this._map)return;const i=this._map._getUIString(`NavigationControl.${t}`);h.setAttribute("aria-label",i),h.firstElementChild&&h.firstElementChild.setAttribute("title",i)}},GeolocateControl:class extends a.E{constructor(h={}){super();const t=navigator.geolocation;this.options=a.l({geolocation:t},vs,h),a.aQ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=fh(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=Ue("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){const t=(i=!!this.options.geolocation)=>{this._supportsGeolocation=i,h(i)};this._supportsGeolocation!==void 0?h(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(i=>t(i.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(h){const t=this._map.getMaxBounds(),i=h.coords;return!!t&&(i.longitude<t.getWest()||i.longitude>t.getEast()||i.latitude<t.getSouth()||i.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new a.A("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.A("geolocate",h)),this._finish()}}_updateCamera(h){const t=new a.bO(h.coords.longitude,h.coords.latitude),i=h.coords.accuracy,d=this._map.getBearing(),m=a.l({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(i),m,{geolocateSource:!0})}_updateMarker(h){if(h){const t=new a.bO(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,t=a.bH(1,h._center.lat)*h.worldSize,i=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${i}px`,this._circleElement.style.height=`${i}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.A("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=Ue("button","mapboxgl-ctrl-geolocate",this._container),Ue("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ue("div","mapboxgl-user-location"),this._dotElement.appendChild(Ue("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ue("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new bo({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ue("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new bo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.A("trackuserlocationend")))})}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Om,ScaleControl:class{constructor(h={}){this.options=a.l({},Sr,h),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),a.aQ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,t=this._map,i=t._containerHeight/2,d=t._containerWidth/2-h/2,m=t.unproject([d,i]),v=t.unproject([d+h,i]),w=m.distanceTo(v);if(this.options.unit==="imperial"){const R=3.2808*w;R>5280?this._setScale(h,R/5280,"mile"):this._setScale(h,R,"foot")}else this.options.unit==="nautical"?this._setScale(h,w/1852,"nautical-mile"):w>=1e3?this._setScale(h,w/1e3,"kilometer"):this._setScale(h,w,"meter")}_setScale(h,t,i){this._map._requestDomTask(()=>{const d=function(v){const w=Math.pow(10,`${Math.floor(v)}`.length-1);let R=v/w;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(N){const P=Math.pow(10,Math.ceil(-Math.log(N)/Math.LN10));return Math.round(N*P)/P}(R),w*R}(t),m=d/t;this._container.innerHTML=this._isNumberFormatSupported&&i!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:i}).format(d):`${d}&nbsp;${qf[i]}`,this._container.style.width=h*m+"px"})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=Ue("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h={}){this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:a.w("Full screen control 'container' must be a DOM element.")),a.aQ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ue("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=Ue("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ue("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.E{constructor(h){super(),this.options=a.l(Object.create(xs),h),this._altitude=this.options.altitude,a.aQ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new a.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new a.A("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=a.bO.convert(h),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(h){return this._altitude=h,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const t=document.createDocumentFragment(),i=document.createElement("body");let d;for(i.innerHTML=h;d=i.firstChild,d;)t.appendChild(d);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=Ue("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(h),this.options.closeButton){const i=this._closeButton=Ue("button","mapboxgl-popup-close-button",t);i.type="button",i.setAttribute("aria-label","Close popup"),i.innerHTML='<span aria-hidden="true">&#215;</span>',i.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let t;return this._classList.delete(h)?t=!1:(this._classList.add(h),t=!0),this._updateClassList(),t}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const t=this._map,i=this._container,d=this._pos;if(!t||!i||!d)return"bottom";const m=i.offsetWidth,v=i.offsetHeight,w=d.x<m/2,R=d.x>t.transform.width-m/2;if(d.y+h<v)return w?"top-left":R?"top-right":"top";if(d.y>t.transform.height-v){if(w)return"bottom-left";if(R)return"bottom-right"}return w?"left":R?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),h.className=t.join(" ")}_update(h){const t=this._map,i=this._content;if(!t||!this._lngLat&&!this._trackPointer||!i)return;let d=this._container;if(d||(d=this._container=Ue("div","mapboxgl-popup",t.getContainer()),this._tip=Ue("div","mapboxgl-popup-tip",d),d.appendChild(i)),this.options.maxWidth&&d.style.maxWidth!==this.options.maxWidth&&(d.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Nm(this._lngLat,this._pos,t.transform)),!this._trackPointer||h){const m=this._pos=this._trackPointer&&h instanceof a.P?h:t.project(this._lngLat,this._altitude),v=uu(this.options.offset),w=this._anchor=this._getAnchor(v.y),R=uu(this.options.offset,w),N=m.add(R).round();t._requestDomTask(()=>{this._container&&w&&(this._container.style.transform=`${ll[w]} translate(${N.x}px,${N.y}px)`)})}if(!this._marker&&t._showingGlobe()){const m=a.dK(t.transform,this._lngLat)?0:1;this._setOpacity(m)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(n_);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:bo,Style:Qa,LngLat:a.bO,LngLatBounds:a.aB,Point:a.P,MercatorCoordinate:a.ac,FreeCameraOptions:Kp,Evented:a.E,config:a.e,prewarm:a.dP,clearPrewarmedResources:a.dQ,get accessToken(){return a.e.ACCESS_TOKEN},set accessToken(h){a.e.ACCESS_TOKEN=h},get baseApiUrl(){return a.e.API_URL},set baseApiUrl(h){a.e.API_URL=h},get workerCount(){return a.dR.workerCount},set workerCount(h){a.dR.workerCount=h},get maxParallelImageRequests(){return a.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){a.e.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){a.dS(h)},get workerUrl(){return a.dT.workerUrl},set workerUrl(h){a.dT.workerUrl=h},get workerClass(){return a.dT.workerClass},set workerClass(h){a.dT.workerClass=h},get workerParams(){return a.dT.workerParams},set workerParams(h){a.dT.workerParams=h},get dracoUrl(){return a.dU()},set dracoUrl(h){a.dV(h)},get meshoptUrl(){return a.dW()},set meshoptUrl(h){a.dX(h)},setNow:a.q.setNow,restoreNow:a.q.restoreNow}});var X=L;return X})}(bw)),bw.exports}var sz=oz();const Fd=kw(sz),eE=({initialCenter:g=[-74.0066,40.7135],initialZoom:y=15.5,markerColor:T="red",onLocationChange:k=null,height:L="400px",width:$="100%",showControls:X=!0,draggableMarker:a=!1,markers:ee=[],routeCoordinates:se=null,showDirections:fe=!1,enableRealTimeTracking:ge=!1,userLocation:le=null,showSOSButton:ke=!0})=>{const Re=Fe.useRef(null),Ue=Fe.useRef(null),[Pe,We]=Fe.useState(null),Tt=Fe.useRef([]);Fe.useRef(null),Fe.useRef(null);const wt=Fe.useRef(null),[St,Xt]=Fe.useState(!1),[cn,xt]=Fe.useState({latitude:Array.isArray(g)?g[1]:g.latitude,longitude:Array.isArray(g)?g[0]:g.longitude});Fe.useEffect(()=>{g&&xt({latitude:Array.isArray(g)?g[1]:g.latitude,longitude:Array.isArray(g)?g[0]:g.longitude})},[g]),Fe.useEffect(()=>{if(!Re.current)return;const Rt="pk.eyJ1IjoidmljdG9ybm5hbWRpIiwiYSI6ImNtZWd6YjVnczAyZjEyanF0OWdiMmdxZ28ifQ.sggaJEbeqjR-174Yl2V3hg";Fd.accessToken=Rt;const ln=new Fd.Map({container:Re.current,style:"mapbox://styles/mapbox/streets-v12",center:[cn.longitude,cn.latitude],zoom:y,antialias:!0});if(Ue.current=ln,X&&(ln.addControl(new Fd.NavigationControl,"top-right"),ln.addControl(new Fd.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),"top-right")),a||ee.length===0){const An=new Fd.Marker({color:T,draggable:a}).setLngLat([cn.longitude,cn.latitude]).addTo(ln);We(An),a&&An.on("dragend",()=>{const mn=An.getLngLat(),$t={latitude:mn.lat,longitude:mn.lng};xt($t),k&&k($t)})}return ee.length>0&&ee.forEach(An=>{try{const mn=new Fd.Marker({color:An.color||T}).setLngLat([An.longitude,An.latitude]);An.popupContent&&mn.setPopup(new Fd.Popup({offset:25}).setHTML(An.popupContent)),mn.addTo(ln),Tt.current.push(mn)}catch(mn){console.error("Error adding marker:",mn)}}),()=>{ln.remove(),Pe&&Pe.remove(),Tt.current.forEach(An=>An.remove())}},[]);const rn=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(Rt=>{const{latitude:ln,longitude:An}=Rt.coords,mn={latitude:ln,longitude:An};xt(mn),k&&k(mn),Ue.current&&Ue.current.flyTo({center:[An,ln],zoom:y,essential:!0})},Rt=>{console.error("Error getting location:",Rt),alert(`Could not get your location: ${Rt.message}`)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}):alert("Geolocation not supported by this browser.")},Ut=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(Rt=>{const{latitude:ln,longitude:An}=Rt.coords;rz(async()=>{const{sendSOSAlert:mn}=await Promise.resolve().then(()=>KN);return{sendSOSAlert:mn}},[]).then(({sendSOSAlert:mn})=>{mn({longitude:An,latitude:ln}),alert("SOS alert sent!")}).catch(mn=>{console.error("Error importing socket service:",mn),alert("Failed to send SOS alert.")})},Rt=>{console.error("Error getting location for SOS:",Rt),alert(`Could not get your location: ${Rt.message}`)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}):alert("Geolocation not supported by this browser.")},Yt=()=>{wt.current&&(navigator.geolocation.clearWatch(wt.current),wt.current=null),Xt(!1)};return he.jsxDEV("div",{style:{position:"relative",width:$,height:L},children:[he.jsxDEV("div",{ref:Re,style:{width:"100%",height:"100%",borderRadius:"8px"}},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/MapComponent.jsx",lineNumber:177,columnNumber:7},void 0),he.jsxDEV("div",{style:{position:"absolute",bottom:"20px",left:"20px",zIndex:10,display:"flex",flexDirection:"column",gap:"10px"},children:[ke&&he.jsxDEV("button",{onClick:Ut,style:{padding:"10px 20px",backgroundColor:"#FF0000",color:"white",borderRadius:"8px",fontWeight:"bold",display:"flex",alignItems:"center",gap:"8px",boxShadow:"0 4px 8px rgba(0,0,0,0.3)",transition:"0.3s"},children:[he.jsxDEV("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:he.jsxDEV("path",{d:"M12 2v8M12 18v4M4.93 4.93l4.24 4.24M14.83 14.83l4.24 4.24M2 12h8M18 12h4M4.93 19.07l4.24-4.24M14.83 9.17l4.24-4.24"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/MapComponent.jsx",lineNumber:213,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/MapComponent.jsx",lineNumber:212,columnNumber:13},void 0),"SOS"]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/MapComponent.jsx",lineNumber:197,columnNumber:11},void 0),ge?he.jsxDEV("button",{onClick:Yt,style:{padding:"8px 12px",backgroundColor:"#4285F4",color:"white",borderRadius:"8px",fontWeight:"bold",display:"flex",alignItems:"center",gap:"6px",boxShadow:"0 2px 4px rgba(0,0,0,0.3)"},children:"Stop Tracking"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/MapComponent.jsx",lineNumber:220,columnNumber:11},void 0):he.jsxDEV("button",{onClick:rn,style:{padding:"8px 12px",backgroundColor:"#FF3A3A",color:"white",borderRadius:"8px",fontWeight:"bold",display:"flex",alignItems:"center",gap:"6px",boxShadow:"0 2px 4px rgba(0,0,0,0.3)"},children:"Locate Me"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/MapComponent.jsx",lineNumber:237,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/MapComponent.jsx",lineNumber:187,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/MapComponent.jsx",lineNumber:175,columnNumber:5},void 0)},az=()=>{const g=Up(),y=Cg(),{emergencies:T,loading:k,error:L}=Ba(le=>le.emergency),{currentLocation:$}=Ba(le=>le.user),[X,a]=Fe.useState([]),ee=[-122.4194,37.7749],se=$||ee;Fe.useEffect(()=>{if($){const[le,ke]=$;g(eb({longitude:le,latitude:ke}))}else{const[le,ke]=ee;g(eb({longitude:le,latitude:ke}))}},[$,g]),Fe.useEffect(()=>{if(T.length>0){const le=T.map(ke=>{if(ke.location&&ke.location.coordinates){const[Re,Ue]=ke.location.coordinates;return{id:ke._id,longitude:Re,latitude:Ue,color:fe(ke.emergencyType),popupContent:`
              <h3 class="text-base font-bold">${ke.emergencyType.toUpperCase()}</h3>
              <p class="text-sm">${ke.description}</p>
              <p class="text-xs text-gray-500 mt-1">
                ${new Date(ke.createdAt).toLocaleTimeString()}
              </p>
            `,onClick:()=>y(`/emergency/${ke._id}`)}}return null}).filter(Boolean);a(le)}},[T,y]);const fe=le=>{switch(le.toLowerCase()){case"fire":return"#FF4136";case"medical":return"#2ECC40";case"security":return"#0074D9";case"natural_disaster":return"#FF851B";default:return"#B10DC9"}},ge=le=>{const ke=new Date(le),Ue=Math.floor((new Date-ke)/(1e3*60));if(Ue<1)return"Just now";if(Ue<60)return`${Ue}m ago`;const Pe=Math.floor(Ue/60);return Pe<24?`${Pe}h ago`:`${Math.floor(Pe/24)}d ago`};return he.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[he.jsxDEV("div",{className:"md:col-span-2",children:he.jsxDEV("div",{className:"bg-card rounded-lg shadow-md overflow-hidden h-[500px] relative",children:he.jsxDEV(eE,{initialCenter:se,initialZoom:13,height:"500px",width:"100%",markerColor:"#0074D9",markers:X,showSOSButton:!0},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Dashboard.jsx",lineNumber:102,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Dashboard.jsx",lineNumber:101,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Dashboard.jsx",lineNumber:100,columnNumber:7},void 0),he.jsxDEV("div",{children:he.jsxDEV("div",{className:"bg-card rounded-lg shadow-md overflow-hidden",children:[he.jsxDEV("div",{className:"p-4 border-b border-border",children:he.jsxDEV("h2",{className:"text-lg font-semibold",children:"Nearby Emergencies"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Dashboard.jsx",lineNumber:117,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Dashboard.jsx",lineNumber:116,columnNumber:11},void 0),he.jsxDEV("div",{className:"p-0 max-h-[460px] overflow-y-auto",children:k?he.jsxDEV("div",{className:"p-4 text-center text-muted-foreground",children:"Loading emergencies..."},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Dashboard.jsx",lineNumber:122,columnNumber:15},void 0):L?he.jsxDEV("div",{className:"p-4 text-center text-destructive",children:["Error: ",L]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Dashboard.jsx",lineNumber:126,columnNumber:15},void 0):T.length===0?he.jsxDEV("div",{className:"p-4 text-center text-muted-foreground",children:"No emergencies nearby"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Dashboard.jsx",lineNumber:130,columnNumber:15},void 0):he.jsxDEV("div",{className:"divide-y divide-border",children:T.map(le=>{var ke,Re,Ue;return he.jsxDEV("div",{className:"p-4 hover:bg-muted transition-colors cursor-pointer",onClick:()=>y(`/emergency/${le._id}`),children:he.jsxDEV("div",{className:"flex items-start",children:[he.jsxDEV("div",{className:"w-10 h-10 rounded-full flex items-center justify-center mr-3 mt-1",style:{backgroundColor:`${fe(le.emergencyType)}20`},children:he.jsxDEV(mC,{size:20,className:"text-foreground",style:{color:fe(le.emergencyType)}},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Dashboard.jsx",lineNumber:150,columnNumber:25},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Dashboard.jsx",lineNumber:142,columnNumber:23},void 0),he.jsxDEV("div",{className:"flex-1",children:[he.jsxDEV("h3",{className:"font-medium",children:[le.emergencyType.charAt(0).toUpperCase()+le.emergencyType.slice(1)," ","Emergency"]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Dashboard.jsx",lineNumber:159,columnNumber:25},void 0),he.jsxDEV("p",{className:"text-sm text-muted-foreground line-clamp-2 mt-1",children:le.description},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Dashboard.jsx",lineNumber:164,columnNumber:25},void 0),he.jsxDEV("div",{className:"flex items-center space-x-4 mt-2 text-xs text-muted-foreground",children:[he.jsxDEV("div",{className:"flex items-center",children:[he.jsxDEV(gC,{size:12,className:"mr-1"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Dashboard.jsx",lineNumber:169,columnNumber:29},void 0),ge(le.createdAt)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Dashboard.jsx",lineNumber:168,columnNumber:27},void 0),he.jsxDEV("div",{className:"flex items-center",children:[he.jsxDEV(iT,{size:12,className:"mr-1"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Dashboard.jsx",lineNumber:173,columnNumber:29},void 0),(ke=le.location)!=null&&ke.address?le.location.address.split(",")[0]:"Unknown location"]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Dashboard.jsx",lineNumber:172,columnNumber:27},void 0),he.jsxDEV("div",{className:"flex items-center",children:[he.jsxDEV(lk,{size:12,className:"mr-1"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Dashboard.jsx",lineNumber:179,columnNumber:29},void 0),((Re=le.responders)==null?void 0:Re.length)||0," ",((Ue=le.responders)==null?void 0:Ue.length)===1?"responder":"responders"]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Dashboard.jsx",lineNumber:178,columnNumber:27},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Dashboard.jsx",lineNumber:167,columnNumber:25},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Dashboard.jsx",lineNumber:158,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Dashboard.jsx",lineNumber:141,columnNumber:21},void 0)},le._id,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Dashboard.jsx",lineNumber:136,columnNumber:19},void 0)})},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Dashboard.jsx",lineNumber:134,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Dashboard.jsx",lineNumber:120,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Dashboard.jsx",lineNumber:115,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Dashboard.jsx",lineNumber:114,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Dashboard.jsx",lineNumber:99,columnNumber:5},void 0)},mA=({size:g=24,className:y=""})=>he.jsxDEV("svg",{width:g,height:g,viewBox:"0 0 512 512",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:y,children:[he.jsxDEV("circle",{cx:"256",cy:"256",r:"256",fill:"#0066FF"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:21,columnNumber:5},void 0),he.jsxDEV("path",{d:"M256 140c-8 0-15-6-15-15v-20c0-8 7-15 15-15s15 7 15 15v20c0 9-7 15-15 15z",fill:"white"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:22,columnNumber:5},void 0),he.jsxDEV("path",{d:"M320 260c0 35-29 65-64 65s-64-30-64-65c0-35 29-65 64-65s64 30 64 65z",fill:"white"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:26,columnNumber:5},void 0),he.jsxDEV("rect",{x:"220",y:"240",width:"30",height:"15",rx:"7.5",fill:"#0066FF"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:30,columnNumber:5},void 0),he.jsxDEV("rect",{x:"270",y:"240",width:"30",height:"15",rx:"7.5",fill:"#0066FF"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:31,columnNumber:5},void 0),he.jsxDEV("path",{d:"M180 200c-11 0-20-9-20-20v-10c0-11 9-20 20-20h30c6 0 10 4 10 10v30c0 6-4 10-10 10h-30z",fill:"white"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:32,columnNumber:5},void 0),he.jsxDEV("path",{d:"M310 200c11 0 20-9 20-20v-10c0-11-9-20-20-20h-30c-6 0-10 4-10 10v30c0 6-4 10-10 10h30z",fill:"white"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:36,columnNumber:5},void 0),he.jsxDEV("path",{d:"M320 310c0 8-7 15-15 15h-100c-8 0-15-7-15-15v-20c0-8 7-15 15-15h100c8 0 15 7 15 15v20z",fill:"white"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:40,columnNumber:5},void 0),he.jsxDEV("path",{d:"M320 310v15c0 8-7 15-15 15h-100c-8 0-15-7-15-15v-15l65-25 65 25z",fill:"white"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:44,columnNumber:5},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:13,columnNumber:3},void 0),lz=()=>{const[g,y]=Fe.useState(!1),[T,k]=Fe.useState(!1),[L,$]=Fe.useState(""),[X,a]=Fe.useState(!1),[ee,se]=Fe.useState(null),[fe,ge]=Fe.useState(!1),le=Fe.useRef(null),ke=Fe.useRef([]),Re=Fe.useRef(null),Ue=Fe.useRef(null),Pe=Fe.useRef(null),We=Cg(),{currentLocation:Tt}=Ba(ln=>ln.user),{isAuthenticated:wt}=Ba(ln=>ln.auth);Fe.useEffect(()=>{if(console.log("[VOICE ASSISTANT] Initializing with auth status:",wt),wt&&!window.socket){console.log("[VOICE ASSISTANT] No global socket found, initializing...");const ln=Rw();if(ln)console.log("[VOICE ASSISTANT] Socket initialized successfully"),window.socket=ln,Pe.current=ln;else{console.warn("[VOICE ASSISTANT] Failed to initialize real socket, creating mock socket for testing");const An=Tg();window.socket=An,Pe.current=An}}else if(console.log("[VOICE ASSISTANT] Using existing socket"),Pe.current=window.socket,!Pe.current){console.warn("[VOICE ASSISTANT] No socket available, creating mock socket");const ln=Tg();window.socket=ln,Pe.current=ln}return()=>{Pe.current&&(console.log("[VOICE ASSISTANT] Cleaning up socket listeners"),Pe.current.off("voice_assistant_result"))}},[wt]);const St=()=>{y(!g),T&&cn()},Xt=async()=>{try{const ln=await navigator.mediaDevices.getUserMedia({audio:!0});le.current=new MediaRecorder(ln),ke.current=[],le.current.ondataavailable=An=>{An.data.size>0&&ke.current.push(An.data)},le.current.onstop=()=>{const An=new Blob(ke.current,{type:"audio/wav"});a(!0),se(null);const mn={longitude:Tt?Tt[0]:-122.4194,latitude:Tt?Tt[1]:37.7749,address:"Current location"};try{if(console.log("[VOICE ASSISTANT] Processing recorded audio..."),!Pe.current){console.warn("[VOICE ASSISTANT] No socket reference, creating mock socket");const $t=Tg();window.socket=$t,Pe.current=$t}if(Pe.current.connected)console.log("[VOICE ASSISTANT] Socket connected, sending audio"),Xx(An,mn),rn(Pe.current);else{console.warn("[VOICE ASSISTANT] Socket not connected, attempting to reconnect");const $t=Rw();if($t)console.log("[VOICE ASSISTANT] Reconnected successfully"),window.socket=$t,Pe.current=$t,setTimeout(()=>{if(Pe.current.connected)console.log("[VOICE ASSISTANT] Connection confirmed, sending audio"),Xx(An,mn),rn(Pe.current);else{console.error("[VOICE ASSISTANT] Still not connected after reconnect attempt");const Nt=Tg();window.socket=Nt,Pe.current=Nt,console.log("[VOICE ASSISTANT] Using mock socket instead"),Xx(An,mn),rn(Nt)}},1e3);else{console.error("[VOICE ASSISTANT] Reconnection failed, using mock socket");const Nt=Tg();window.socket=Nt,Pe.current=Nt,Xx(An,mn),rn(Nt)}}}catch($t){console.error("[VOICE ASSISTANT] Socket error:",$t),xt()}},le.current.start(),k(!0),Yt()}catch(ln){console.error("Error accessing microphone:",ln),alert("Could not access your microphone. Please check permissions and try again.")}},cn=()=>{le.current&&T&&(le.current.stop(),k(!1),Rt(),le.current.stream.getTracks().forEach(ln=>ln.stop()))},xt=()=>{console.error("[VOICE ASSISTANT] Socket error occurred"),a(!1),ge(!0),$("Could not connect to server. Please try again later.");try{console.log("[VOICE ASSISTANT] Creating mock socket as fallback");const ln=Tg();window.socket=ln,Pe.current=ln}catch(ln){console.error("[VOICE ASSISTANT] Failed to create mock socket:",ln)}},rn=ln=>{console.log("[VOICE ASSISTANT] Setting up result listener");const An=$t=>{if(console.log("[VOICE ASSISTANT] Received result:",$t),a(!1),se($t),$t.success){$($t.text);const Nt=setTimeout(()=>{g&&(console.log("[VOICE ASSISTANT] Auto-navigating to emergency details:",$t.emergencyId),$t.emergencyId&&$t.emergencyId.startsWith("mock-")?We("/dashboard"):We(`/emergency/${$t.emergencyId}`))},2e3);$t.navigationTimeoutId=Nt}else $($t.text||"Failed to process audio. Please try again.");ln.off("voice_assistant_result",An)},mn=setTimeout(()=>{if(console.warn("[VOICE ASSISTANT] Response timeout reached"),ln.off("voice_assistant_result",An),ln!==window.mockSocket){console.log("[VOICE ASSISTANT] Trying with mock socket as fallback");const $t=Tg();window.mockSocket=$t,$t.on("voice_assistant_result",Nt=>{console.log("[VOICE ASSISTANT] Received mock result:",Nt),a(!1),se(Nt),$(Nt.text),setTimeout(()=>{Nt.emergencyId&&Nt.emergencyId.startsWith("mock-")?(console.log("[VOICE ASSISTANT] Mock ID detected, navigating to dashboard"),We("/dashboard")):We(`/emergency/${Nt.emergencyId}`)},2e3)}),setTimeout(()=>{$t._callbacks.voice_assistant_result({success:!0,text:"This is a mock response for testing. Fire emergency detected at your location.",emergencyId:"mock-emergency-123",message:"Fire emergency detected"})},1e3)}else xt()},1e4);ln.on("voice_assistant_result",$t=>{console.log("[VOICE ASSISTANT] Result received, clearing timeout"),clearTimeout(mn),An($t)})},Ut=()=>{ee&&ee.success?(console.log("[VOICE ASSISTANT] Manual navigation triggered for emergency:",ee.emergencyId),ee.emergencyId&&ee.emergencyId.startsWith("mock-")?We("/dashboard"):We(`/emergency/${ee.emergencyId}`)):($(""),se(null),ge(!1),y(!1))},Yt=()=>{if(!Ue.current)return;const ln=Ue.current,An=ln.getContext("2d"),mn=ln.width,$t=ln.height,Nt=()=>{An.clearRect(0,0,mn,$t),Kt(An,mn,$t,"#4f46e5",1.5,15,0),Kt(An,mn,$t,"#2563eb",2,12,.3),Kt(An,mn,$t,"#3b82f6",2.5,8,.6),Re.current=requestAnimationFrame(Nt)};function Kt(It,sn,tt,un,pn,Vt,ir){It.beginPath();const Nr=tt/2,rr=Date.now()/1e3,kr=.15;It.moveTo(0,Nr);for(let sr=0;sr<sn;sr+=2){const Yr=(Math.sin(rr*2+ir)+1)*Vt/2,de=Nr+Math.sin(sr*kr+rr*3+ir)*Yr;It.lineTo(sr,de)}It.strokeStyle=un,It.lineWidth=pn,It.stroke()}Nt()},Rt=()=>{Re.current&&(cancelAnimationFrame(Re.current),Re.current=null,Ue.current&&Ue.current.getContext("2d").clearRect(0,0,Ue.current.width,Ue.current.height))};return Fe.useEffect(()=>()=>{le.current&&T&&le.current.stream.getTracks().forEach(ln=>ln.stop()),Re.current&&cancelAnimationFrame(Re.current),ee&&ee.navigationTimeoutId&&clearTimeout(ee.navigationTimeoutId)},[T,ee]),he.jsxDEV("div",{className:"fixed bottom-6 right-6 z-50",children:[he.jsxDEV("button",{onClick:St,className:`flex flex-col items-center justify-center w-20 h-20 rounded-full shadow-lg transition-all duration-300 ${g?"bg-destructive text-white rotate-90":"text-white"}`,style:{boxShadow:g?"0 4px 12px rgba(220, 38, 38, 0.5)":"0 4px 12px rgba(37, 99, 235, 0.5)",padding:0,overflow:"hidden",border:"none"},children:g?he.jsxDEV("span",{className:"text-2xl font-bold",children:"×"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:505,columnNumber:11},void 0):he.jsxDEV("div",{className:"flex flex-col items-center justify-center w-full h-full",children:he.jsxDEV(mA,{size:80},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:508,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:507,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:490,columnNumber:7},void 0),g&&he.jsxDEV("div",{className:"absolute bottom-24 right-0 w-80 bg-white rounded-lg shadow-2xl border border-blue-100 overflow-hidden",children:[he.jsxDEV("div",{className:"p-4 bg-gradient-to-r from-blue-500 to-blue-600 border-b border-blue-200",children:[he.jsxDEV("div",{className:"flex items-center",children:[he.jsxDEV(mA,{size:28,className:"mr-2"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:518,columnNumber:15},void 0),he.jsxDEV("h3",{className:"font-medium text-white text-base",children:"Voice Assistant"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:519,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:517,columnNumber:13},void 0),he.jsxDEV("p",{className:"text-xs text-blue-100",children:"Describe your emergency situation"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:523,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:516,columnNumber:11},void 0),he.jsxDEV("div",{className:"p-4",children:[X?he.jsxDEV("div",{className:"flex flex-col items-center justify-center py-4",children:[he.jsxDEV(dk,{size:32,className:"animate-spin text-blue-600 mb-2"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:531,columnNumber:17},void 0),he.jsxDEV("p",{className:"text-sm text-blue-600 font-medium",children:"Processing your emergency report..."},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:532,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:530,columnNumber:15},void 0):L?he.jsxDEV("div",{className:"mb-4",children:[he.jsxDEV("p",{className:"text-sm mb-2 font-medium",children:"Transcription:"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:538,columnNumber:17},void 0),he.jsxDEV("div",{className:"bg-muted p-2 rounded-md text-sm",children:L},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:539,columnNumber:17},void 0),ee&&ee.success&&he.jsxDEV("div",{className:"mt-2 p-2 bg-green-50 border border-green-100 rounded-md",children:[he.jsxDEV("p",{className:"text-sm text-green-600",children:[he.jsxDEV("span",{className:"font-medium",children:"Emergency detected:"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:545,columnNumber:23},void 0)," ",ee.message]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:544,columnNumber:21},void 0),he.jsxDEV("p",{className:"text-xs text-green-500 mt-1",children:"Redirecting to emergency details..."},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:548,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:543,columnNumber:19},void 0),ee&&!ee.success&&he.jsxDEV("div",{className:"mt-2 p-2 bg-red-50 border border-red-100 rounded-md",children:he.jsxDEV("p",{className:"text-sm text-red-600",children:ee.message},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:555,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:554,columnNumber:19},void 0),fe&&he.jsxDEV("div",{className:"mt-2 p-2 bg-red-50 border border-red-100 rounded-md",children:[he.jsxDEV("p",{className:"text-sm text-red-600",children:[he.jsxDEV("span",{className:"font-medium",children:"Connection Error:"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:564,columnNumber:23},void 0)," ","Could not connect to server"]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:563,columnNumber:21},void 0),he.jsxDEV("p",{className:"text-xs text-red-500 mt-1",children:"Please check your connection and try again"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:567,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:562,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:537,columnNumber:15},void 0):he.jsxDEV("div",{className:"text-center py-2 text-sm text-muted-foreground",children:T?"Listening...":"Press the microphone to start recording"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:574,columnNumber:15},void 0),T&&he.jsxDEV("div",{className:"my-3 bg-blue-50 rounded-md p-3 border border-blue-100",children:he.jsxDEV("canvas",{ref:Ue,width:"280",height:"60",className:"w-full"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:583,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:582,columnNumber:15},void 0),he.jsxDEV("div",{className:"flex justify-center mt-2 space-x-3",children:T?he.jsxDEV("button",{onClick:cn,className:"flex items-center justify-center w-14 h-14 rounded-full bg-red-600 text-white shadow-lg",style:{boxShadow:"0 4px 12px rgba(220, 38, 38, 0.5)"},children:he.jsxDEV(ok,{size:28},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:599,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:594,columnNumber:17},void 0):L?he.jsxDEV("button",{onClick:Ut,className:"flex items-center justify-center px-6 py-3 rounded-md bg-gradient-to-r from-blue-600 to-indigo-700 text-white font-medium shadow-lg",style:{boxShadow:"0 4px 12px rgba(37, 99, 235, 0.3)"},children:ee&&ee.success?he.jsxDEV("span",{children:"View Emergency"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:608,columnNumber:21},void 0):he.jsxDEV("span",{children:"Close"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:610,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:602,columnNumber:17},void 0):he.jsxDEV("button",{onClick:Xt,className:"flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-r from-blue-600 to-indigo-700 text-white shadow-lg",style:{boxShadow:"0 4px 12px rgba(37, 99, 235, 0.5)"},children:he.jsxDEV(yk,{size:32},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:619,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:614,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:592,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:528,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:515,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/AudioAssistantBot.jsx",lineNumber:488,columnNumber:5},void 0)};Fd.accessToken="pk.eyJ1IjoidmljdG9ybm5hbWRpIiwiYSI6ImNtZWd6YjVnczAyZjEyanF0OWdiMmdxZ28ifQ.sggaJEbeqjR-174Yl2V3hg";const cz=[{id:"fire",label:"Fire",color:"#FF4136"},{id:"medical",label:"Medical",color:"#2ECC40"},{id:"security",label:"Security",color:"#0074D9"},{id:"natural_disaster",label:"Natural Disaster",color:"#FF851B"},{id:"other",label:"Other",color:"#B10DC9"}],uz=()=>{const g=Up(),y=Cg(),{loading:T,error:k}=Ba(ke=>ke.emergency),{currentLocation:L}=Ba(ke=>ke.user),X=L||[-122.4194,37.7749],[a,ee]=Fe.useState({emergencyType:"",description:"",longitude:X[0],latitude:X[1],address:""}),se=ke=>{ee(Re=>({...Re,longitude:ke.longitude,latitude:ke.latitude})),fe(ke.longitude,ke.latitude)};Fe.useEffect(()=>{if(L){const[ke,Re]=L;ee(Ue=>({...Ue,longitude:ke,latitude:Re})),fe(ke,Re)}},[L]);const fe=async(ke,Re)=>{try{const Pe=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${ke},${Re}.json?access_token=${Fd.accessToken}`)).json();Pe.features&&Pe.features.length>0&&ee(We=>({...We,address:Pe.features[0].place_name}))}catch(Ue){console.error("Error in reverse geocoding:",Ue)}},ge=ke=>{const{name:Re,value:Ue}=ke.target;ee(Pe=>({...Pe,[Re]:Ue}))},le=ke=>{if(ke.preventDefault(),!a.emergencyType){alert("Please select an emergency type");return}if(!a.description){alert("Please provide a description of the emergency");return}g(yw(a)).unwrap().then(Re=>{y(`/emergency/${Re.emergency._id}`)}).catch(Re=>{console.error("Error creating emergency:",Re)})};return he.jsxDEV("div",{children:[he.jsxDEV("h2",{className:"text-2xl font-bold mb-6",children:"Report Emergency"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyReport.jsx",lineNumber:127,columnNumber:7},void 0),he.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[he.jsxDEV("div",{className:"md:col-span-2",children:he.jsxDEV("div",{className:"bg-card rounded-lg shadow-md overflow-hidden",children:[he.jsxDEV("div",{className:"p-4 border-b border-border",children:[he.jsxDEV("h3",{className:"font-medium",children:"Select Location"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyReport.jsx",lineNumber:133,columnNumber:15},void 0),he.jsxDEV("p",{className:"text-sm text-muted-foreground mt-1",children:"Drag the marker to the exact emergency location"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyReport.jsx",lineNumber:134,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyReport.jsx",lineNumber:132,columnNumber:13},void 0),he.jsxDEV(eE,{initialCenter:[a.longitude,a.latitude],initialZoom:15,height:"400px",width:"100%",markerColor:"#FF4136",draggableMarker:!0,onLocationChange:se,showSOSButton:!1},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyReport.jsx",lineNumber:138,columnNumber:13},void 0),a.address&&he.jsxDEV("div",{className:"p-3 bg-muted/50 text-sm",children:[he.jsxDEV("strong",{children:"Address:"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyReport.jsx",lineNumber:150,columnNumber:17},void 0)," ",a.address]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyReport.jsx",lineNumber:149,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyReport.jsx",lineNumber:131,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyReport.jsx",lineNumber:130,columnNumber:9},void 0),he.jsxDEV("div",{children:he.jsxDEV("div",{className:"bg-card rounded-lg shadow-md p-4",children:he.jsxDEV("form",{onSubmit:le,children:[he.jsxDEV("div",{className:"mb-4",children:[he.jsxDEV("label",{className:"block text-sm font-medium mb-1",children:"Emergency Type"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyReport.jsx",lineNumber:160,columnNumber:17},void 0),he.jsxDEV("div",{className:"grid grid-cols-2 gap-2",children:cz.map(ke=>he.jsxDEV("label",{className:`
                        flex items-center p-3 rounded-md border cursor-pointer
                        ${a.emergencyType===ke.id?"border-primary bg-primary/10":"border-input hover:bg-muted"}
                      `,children:[he.jsxDEV("input",{type:"radio",name:"emergencyType",value:ke.id,checked:a.emergencyType===ke.id,onChange:ge,className:"sr-only"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyReport.jsx",lineNumber:174,columnNumber:23},void 0),he.jsxDEV("div",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:ke.color}},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyReport.jsx",lineNumber:182,columnNumber:23},void 0),he.jsxDEV("span",{className:"text-sm",children:ke.label},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyReport.jsx",lineNumber:186,columnNumber:23},void 0)]},ke.id,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyReport.jsx",lineNumber:165,columnNumber:21},void 0))},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyReport.jsx",lineNumber:163,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyReport.jsx",lineNumber:159,columnNumber:15},void 0),he.jsxDEV("div",{className:"mb-4",children:[he.jsxDEV("label",{className:"block text-sm font-medium mb-1",htmlFor:"description",children:"Description"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyReport.jsx",lineNumber:193,columnNumber:17},void 0),he.jsxDEV("textarea",{id:"description",name:"description",value:a.description,onChange:ge,rows:"4",className:"w-full px-3 py-2 border border-input rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50",placeholder:"Describe the emergency situation...",required:!0},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyReport.jsx",lineNumber:196,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyReport.jsx",lineNumber:192,columnNumber:15},void 0),k&&he.jsxDEV("div",{className:"bg-destructive/10 text-destructive px-4 py-3 rounded-md mb-4 text-sm",children:k},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyReport.jsx",lineNumber:209,columnNumber:17},void 0),he.jsxDEV("div",{className:"flex justify-end",children:he.jsxDEV("button",{type:"submit",disabled:T,className:"flex items-center bg-primary text-primary-foreground px-4 py-2 rounded-md hover:bg-primary/90 transition-colors disabled:opacity-70",children:T?"Reporting...":he.jsxDEV(he.Fragment,{children:[he.jsxDEV(rb,{size:18,className:"mr-2"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyReport.jsx",lineNumber:224,columnNumber:23},void 0),"Report Emergency"]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyReport.jsx",lineNumber:223,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyReport.jsx",lineNumber:215,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyReport.jsx",lineNumber:214,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyReport.jsx",lineNumber:158,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyReport.jsx",lineNumber:157,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyReport.jsx",lineNumber:156,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyReport.jsx",lineNumber:129,columnNumber:7},void 0),he.jsxDEV(lz,{},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyReport.jsx",lineNumber:236,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyReport.jsx",lineNumber:126,columnNumber:5},void 0)};Fd.accessToken="pk.eyJ1IjoidmljdG9ybm5hbWRpIiwiYSI6ImNtZWd6YjVnczAyZjEyanF0OWdiMmdxZ28ifQ.sggaJEbeqjR-174Yl2V3hg";const dz=()=>{const{id:g}=FM(),y=Up(),T=Cg(),{currentEmergency:k,loading:L,error:$}=Ba(Kt=>Kt.emergency),{profile:X,currentLocation:a}=Ba(Kt=>Kt.user),[ee,se]=Fe.useState(null),[fe,ge]=Fe.useState(!1),[le,ke]=Fe.useState(!1),[Re,Ue]=Fe.useState([]),[Pe,We]=Fe.useState(null),[Tt,wt]=Fe.useState(!1),[St,Xt]=Fe.useState(!1),[cn,xt]=Fe.useState(null),rn=Fe.useRef(null),Ut=[-122.4194,37.7749];Fe.useEffect(()=>{y(vw(g))},[y,g]),Fe.useEffect(()=>{if(k&&a){const Kt=k.location.coordinates,[It,sn]=a||Ut,tt=[{id:"emergency",longitude:Kt[0],latitude:Kt[1],color:"#FF4136",popupContent:`
            <h3 class="text-base font-bold">${k.emergencyType.toUpperCase()}</h3>
            <p class="text-sm">${k.description}</p>
          `},{id:"user",longitude:It,latitude:sn,color:"#0074D9",popupContent:"<p>Your location</p>"}];Ue(tt),Yt(It,sn,Kt[0],Kt[1]),An()&&(wt(!0),Xt(!0))}},[k,a]);const Yt=async(Kt,It,sn,tt)=>{try{const pn=await(await fetch(`https://api.mapbox.com/directions/v5/mapbox/driving/${Kt},${It};${sn},${tt}?geometries=geojson&overview=full&steps=true&access_token=${Fd.accessToken}`)).json();if(pn.routes&&pn.routes.length>0){const Vt=pn.routes[0];se({distance:(Vt.distance/1e3).toFixed(1),duration:Math.round(Vt.duration/60),steps:Vt.legs[0].steps}),We(Vt.geometry.coordinates)}}catch(un){console.error("Error getting directions:",un)}},Rt=()=>{ge(!0),y(UD(g)).unwrap().then(()=>{if(ge(!1),wt(!0),Xt(!0),!Pe&&a){const Kt=k.location.coordinates,[It,sn]=a||Ut;Yt(It,sn,Kt[0],Kt[1])}}).catch(Kt=>{console.error("Error responding to emergency:",Kt),ge(!1)})},ln=Kt=>{ke(!0),y(jD({emergencyId:g,status:Kt})).unwrap().then(()=>{ke(!1)}).catch(It=>{console.error("Error updating emergency status:",It),ke(!1)})},An=()=>!k||!X?!1:k.responders.some(Kt=>Kt.userId===X._id||Kt.userId&&typeof Kt.userId=="object"&&Kt.userId._id===X._id),mn=()=>{if(!k||!X)return null;const Kt=k.responders.find(It=>It.userId===X._id||It.userId&&typeof It.userId=="object"&&It.userId._id===X._id);return Kt?Kt.status:null},$t=Kt=>{if(xt(Kt),Tt&&k&&Pe){const It=k.location.coordinates,sn=localStorage.getItem("lastRouteUpdate"),tt=Date.now();(!sn||tt-parseInt(sn)>3e4)&&(Yt(Kt.longitude,Kt.latitude,It[0],It[1]),localStorage.setItem("lastRouteUpdate",tt.toString()))}},Nt=Kt=>{switch(Kt){case"active":return"text-destructive";case"responding":return"text-primary";case"resolved":return"text-green-600";case"cancelled":return"text-gray-500";default:return"text-foreground"}};return L?he.jsxDEV("div",{className:"text-center p-8",children:[he.jsxDEV("div",{className:"animate-spin h-8 w-8 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:221,columnNumber:9},void 0),he.jsxDEV("p",{className:"text-muted-foreground",children:"Loading emergency details..."},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:222,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:220,columnNumber:7},void 0):$?he.jsxDEV("div",{className:"text-center p-8",children:[he.jsxDEV(rb,{size:32,className:"text-destructive mx-auto mb-4"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:230,columnNumber:9},void 0),he.jsxDEV("p",{className:"text-destructive mb-2",children:["Error: ",$]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:231,columnNumber:9},void 0),he.jsxDEV("button",{onClick:()=>T("/"),className:"text-primary hover:underline",children:"Return to Dashboard"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:232,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:229,columnNumber:7},void 0):k?he.jsxDEV("div",{children:[he.jsxDEV("div",{className:"flex items-center justify-between mb-6",children:[he.jsxDEV("h2",{className:"text-2xl font-bold",children:"Emergency Details"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:259,columnNumber:9},void 0),he.jsxDEV("div",{className:"flex items-center",children:[he.jsxDEV("span",{className:"text-sm mr-2",children:"Status:"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:261,columnNumber:11},void 0),he.jsxDEV("span",{className:`font-medium ${Nt(k.status)}`,children:k.status.toUpperCase()},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:262,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:260,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:258,columnNumber:7},void 0),he.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[he.jsxDEV("div",{className:"md:col-span-2",children:[he.jsxDEV("div",{className:"bg-card rounded-lg shadow-md overflow-hidden mb-6",children:k&&he.jsxDEV(eE,{initialCenter:k.location.coordinates,initialZoom:14,height:"400px",width:"100%",markers:Re,routeCoordinates:Pe,showDirections:Tt||An(),enableRealTimeTracking:St||An(),userLocation:cn,onLocationChange:$t,showSOSButton:!0,ref:rn},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:272,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:270,columnNumber:11},void 0),ee&&he.jsxDEV("div",{className:"bg-card rounded-lg shadow-md overflow-hidden",children:[he.jsxDEV("div",{className:"p-4 border-b border-border",children:he.jsxDEV("h3",{className:"font-medium",children:"Route Information"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:292,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:291,columnNumber:15},void 0),he.jsxDEV("div",{className:"p-4",children:[he.jsxDEV("div",{className:"flex items-center justify-between mb-4",children:[he.jsxDEV("div",{className:"flex items-center",children:[he.jsxDEV(iT,{className:"text-primary mr-2",size:18},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:298,columnNumber:21},void 0),he.jsxDEV("span",{className:"text-sm font-medium",children:[ee.distance," km"]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:299,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:297,columnNumber:19},void 0),he.jsxDEV("div",{className:"flex items-center",children:[he.jsxDEV(gC,{className:"text-primary mr-2",size:18},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:303,columnNumber:21},void 0),he.jsxDEV("span",{className:"text-sm font-medium",children:[ee.duration," min"]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:304,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:302,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:296,columnNumber:17},void 0),he.jsxDEV("div",{className:"space-y-2 text-sm",children:ee.steps.map((Kt,It)=>he.jsxDEV("div",{className:"flex items-start py-2 border-b border-border last:border-0",children:[he.jsxDEV("div",{className:"bg-primary/10 text-primary rounded-full p-1 mr-3 mt-0.5",children:he.jsxDEV(Q2,{size:14},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:312,columnNumber:25},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:311,columnNumber:23},void 0),he.jsxDEV("div",{dangerouslySetInnerHTML:{__html:Kt.maneuver.instruction}},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:314,columnNumber:23},void 0)]},It,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:310,columnNumber:21},void 0))},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:308,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:295,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:290,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:269,columnNumber:9},void 0),he.jsxDEV("div",{children:[he.jsxDEV("div",{className:"bg-card rounded-lg shadow-md overflow-hidden mb-6",children:[he.jsxDEV("div",{className:"p-4 border-b border-border",children:he.jsxDEV("h3",{className:"font-medium",children:"Actions"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:326,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:325,columnNumber:13},void 0),he.jsxDEV("div",{className:"p-4",children:[k.status==="active"&&!An()&&he.jsxDEV("button",{onClick:Rt,disabled:fe,className:"w-full flex items-center justify-center bg-primary text-primary-foreground py-2 px-4 rounded-md hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:fe?he.jsxDEV(he.Fragment,{children:[he.jsxDEV("div",{className:"animate-spin h-4 w-4 border-2 border-primary-foreground border-t-transparent rounded-full mr-2"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:338,columnNumber:23},void 0),"Responding..."]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:337,columnNumber:21},void 0):he.jsxDEV(he.Fragment,{children:[he.jsxDEV(iT,{className:"mr-2",size:16},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:343,columnNumber:23},void 0),"Respond to Emergency"]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:342,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:331,columnNumber:17},void 0),An()&&mn()==="en-route"&&he.jsxDEV("button",{onClick:()=>ln("arrived"),disabled:le,className:"w-full flex items-center justify-center bg-primary text-primary-foreground py-2 px-4 rounded-md hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed mb-3",children:le?he.jsxDEV(he.Fragment,{children:[he.jsxDEV("div",{className:"animate-spin h-4 w-4 border-2 border-primary-foreground border-t-transparent rounded-full mr-2"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:358,columnNumber:23},void 0),"Updating..."]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:357,columnNumber:21},void 0):he.jsxDEV(he.Fragment,{children:[he.jsxDEV(pk,{className:"mr-2",size:16},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:363,columnNumber:23},void 0),"Mark as Arrived"]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:362,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:351,columnNumber:17},void 0),(k.status==="responding"||k.status==="active")&&(X.role==="admin"||An())&&he.jsxDEV("button",{onClick:()=>ln("resolved"),disabled:le,className:"w-full flex items-center justify-center bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed mb-3",children:le?he.jsxDEV(he.Fragment,{children:[he.jsxDEV("div",{className:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full mr-2"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:379,columnNumber:23},void 0),"Updating..."]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:378,columnNumber:21},void 0):he.jsxDEV(he.Fragment,{children:[he.jsxDEV(pC,{className:"mr-2",size:16},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:384,columnNumber:23},void 0),"Mark as Resolved"]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:383,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:372,columnNumber:17},void 0),(k.status==="active"||k.status==="responding")&&X.role==="admin"&&he.jsxDEV("button",{onClick:()=>ln("cancelled"),disabled:le,className:"w-full flex items-center justify-center bg-destructive text-destructive-foreground py-2 px-4 rounded-md hover:bg-destructive/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:le?he.jsxDEV(he.Fragment,{children:[he.jsxDEV("div",{className:"animate-spin h-4 w-4 border-2 border-destructive-foreground border-t-transparent rounded-full mr-2"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:400,columnNumber:23},void 0),"Updating..."]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:399,columnNumber:21},void 0):he.jsxDEV(he.Fragment,{children:[he.jsxDEV(zw,{className:"mr-2",size:16},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:405,columnNumber:23},void 0),"Cancel Emergency"]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:404,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:393,columnNumber:17},void 0),(k.status==="resolved"||k.status==="cancelled")&&he.jsxDEV("button",{onClick:()=>T("/"),className:"w-full flex items-center justify-center bg-secondary text-secondary-foreground py-2 px-4 rounded-md hover:bg-secondary/90 transition-colors",children:"Return to Dashboard"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:413,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:329,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:324,columnNumber:11},void 0),he.jsxDEV("div",{className:"bg-card rounded-lg shadow-md overflow-hidden",children:[he.jsxDEV("div",{className:"p-4 border-b border-border",children:he.jsxDEV("h3",{className:"font-medium",children:"Responders"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:425,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:424,columnNumber:13},void 0),he.jsxDEV("div",{className:"p-4",children:k.responders.length===0?he.jsxDEV("div",{className:"text-center text-muted-foreground text-sm py-4",children:"No responders yet"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:430,columnNumber:17},void 0):he.jsxDEV("div",{className:"space-y-3",children:k.responders.map((Kt,It)=>{const sn=typeof Kt.userId=="object"?Kt.userId._id:Kt.userId,tt=typeof Kt.userId=="object"?Kt.userId.name:"Responder",un=typeof Kt.userId=="object"?Kt.userId.phone:null;return he.jsxDEV("div",{className:"flex items-center justify-between",children:[he.jsxDEV("div",{className:"flex items-center",children:[he.jsxDEV("div",{className:"h-8 w-8 rounded-full bg-primary/10 text-primary flex items-center justify-center mr-3",children:he.jsxDEV(Sw,{size:16},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:447,columnNumber:29},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:446,columnNumber:27},void 0),he.jsxDEV("div",{children:[he.jsxDEV("div",{className:"font-medium text-sm",children:sn===X._id?"You":tt},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:450,columnNumber:29},void 0),he.jsxDEV("div",{className:"text-xs text-muted-foreground",children:["Status: ",Kt.status]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:453,columnNumber:29},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:449,columnNumber:27},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:445,columnNumber:25},void 0),sn!==X._id&&un&&he.jsxDEV("a",{href:`tel:${un}`,className:"p-2 bg-primary/10 text-primary rounded-full hover:bg-primary/20 transition-colors",children:he.jsxDEV(bk,{size:16},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:464,columnNumber:29},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:460,columnNumber:27},void 0)]},It,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:444,columnNumber:23},void 0)})},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:434,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:428,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:423,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:323,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:268,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:257,columnNumber:5},void 0):he.jsxDEV("div",{className:"text-center p-8",children:[he.jsxDEV("p",{className:"text-muted-foreground",children:"No emergency details found"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:245,columnNumber:9},void 0),he.jsxDEV("button",{onClick:()=>T("/"),className:"text-primary hover:underline mt-2",children:"Return to Dashboard"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:246,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/EmergencyDetail.jsx",lineNumber:244,columnNumber:7},void 0)},gA=[{id:"first_aid",label:"First Aid"},{id:"cpr",label:"CPR"},{id:"fire_safety",label:"Fire Safety"},{id:"search_rescue",label:"Search & Rescue"},{id:"medical",label:"Medical Professional"},{id:"emergency_response",label:"Emergency Response"}],hz=()=>{const g=Up(),{profile:y,loading:T,error:k}=Ba(le=>le.user),[L,$]=Fe.useState(!1),[X,a]=Fe.useState({name:"",phone:"",skills:[]});Fe.useEffect(()=>{y&&a({name:y.name||"",phone:y.phone||"",skills:y.skills||[]})},[y]);const ee=le=>{const{name:ke,value:Re,type:Ue,checked:Pe}=le.target;if(Ue==="checkbox"){const We=Pe?[...X.skills,ke]:X.skills.filter(Tt=>Tt!==ke);a({...X,skills:We})}else a({...X,[ke]:Re})},se=()=>{$(!L),L||a({name:y.name||"",phone:y.phone||"",skills:y.skills||[]})},fe=le=>{le.preventDefault(),g(uw(X)).unwrap().then(()=>{$(!1)}).catch(ke=>{console.error("Error updating profile:",ke)})},ge=()=>{g(bD(!y.availabilityStatus))};return y?he.jsxDEV("div",{children:[he.jsxDEV("h2",{className:"text-2xl font-bold mb-6",children:"Profile"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:97,columnNumber:7},void 0),he.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[he.jsxDEV("div",{children:he.jsxDEV("div",{className:"bg-card rounded-lg shadow-md overflow-hidden",children:[he.jsxDEV("div",{className:"pt-8 px-8 pb-6 text-center border-b border-border",children:[he.jsxDEV("div",{className:"h-20 w-20 rounded-full bg-primary/10 text-primary flex items-center justify-center mx-auto mb-4",children:he.jsxDEV(Sw,{size:40},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:104,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:103,columnNumber:15},void 0),he.jsxDEV("h3",{className:"text-lg font-semibold",children:y.name},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:107,columnNumber:15},void 0),he.jsxDEV("p",{className:"text-muted-foreground mt-1",children:y.email},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:108,columnNumber:15},void 0),he.jsxDEV("div",{className:"flex justify-center mt-4",children:he.jsxDEV("button",{onClick:ge,disabled:T,className:`
                    px-4 py-2 rounded-full flex items-center text-sm font-medium
                    ${y.availabilityStatus?"bg-green-600/10 text-green-600 hover:bg-green-600/20":"bg-destructive/10 text-destructive hover:bg-destructive/20"}
                    transition-colors
                  `,children:y.availabilityStatus?he.jsxDEV(he.Fragment,{children:[he.jsxDEV(pC,{size:16,className:"mr-1"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:125,columnNumber:23},void 0),"Available for Emergencies"]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:124,columnNumber:21},void 0):he.jsxDEV(he.Fragment,{children:[he.jsxDEV(zw,{size:16,className:"mr-1"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:130,columnNumber:23},void 0),"Unavailable"]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:129,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:111,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:110,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:102,columnNumber:13},void 0),he.jsxDEV("div",{className:"p-4",children:[he.jsxDEV("div",{className:"space-y-3",children:[he.jsxDEV("div",{children:[he.jsxDEV("div",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Phone"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:141,columnNumber:19},void 0),he.jsxDEV("div",{children:y.phone||"Not provided"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:144,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:140,columnNumber:17},void 0),he.jsxDEV("div",{children:[he.jsxDEV("div",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Member Since"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:148,columnNumber:19},void 0),he.jsxDEV("div",{children:new Date(y.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:151,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:147,columnNumber:17},void 0),he.jsxDEV("div",{children:[he.jsxDEV("div",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Emergency Skills"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:161,columnNumber:19},void 0),y.skills&&y.skills.length>0?he.jsxDEV("div",{className:"flex flex-wrap gap-2",children:y.skills.map(le=>{var ke;return he.jsxDEV("div",{className:"bg-primary/10 text-primary text-xs px-2 py-1 rounded-md",children:((ke=gA.find(Re=>Re.id===le))==null?void 0:ke.label)||le},le,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:167,columnNumber:25},void 0)})},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:165,columnNumber:21},void 0):he.jsxDEV("div",{className:"text-muted-foreground text-sm",children:"No skills added"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:176,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:160,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:139,columnNumber:15},void 0),he.jsxDEV("div",{className:"mt-6",children:he.jsxDEV("button",{onClick:se,className:"w-full bg-muted text-foreground py-2 rounded-md hover:bg-muted-foreground/20 transition-colors",children:L?"Cancel Editing":"Edit Profile"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:182,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:181,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:138,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:101,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:100,columnNumber:9},void 0),he.jsxDEV("div",{className:"md:col-span-2",children:L?he.jsxDEV("div",{className:"bg-card rounded-lg shadow-md overflow-hidden",children:[he.jsxDEV("div",{className:"p-4 border-b border-border",children:he.jsxDEV("h3",{className:"font-medium",children:"Edit Profile"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:197,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:196,columnNumber:15},void 0),he.jsxDEV("div",{className:"p-4",children:[k&&he.jsxDEV("div",{className:"bg-destructive/10 text-destructive px-4 py-3 rounded-md mb-4 text-sm flex items-start",children:[he.jsxDEV(mC,{size:18,className:"mr-2 mt-0.5 flex-shrink-0"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:203,columnNumber:21},void 0),he.jsxDEV("div",{children:k},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:204,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:202,columnNumber:19},void 0),he.jsxDEV("form",{onSubmit:fe,children:he.jsxDEV("div",{className:"space-y-4",children:[he.jsxDEV("div",{children:[he.jsxDEV("label",{className:"block text-sm font-medium mb-1",htmlFor:"name",children:"Name"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:211,columnNumber:23},void 0),he.jsxDEV("input",{type:"text",id:"name",name:"name",value:X.name,onChange:ee,className:"w-full px-3 py-2 border border-input rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50",required:!0},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:214,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:210,columnNumber:21},void 0),he.jsxDEV("div",{children:[he.jsxDEV("label",{className:"block text-sm font-medium mb-1",htmlFor:"phone",children:"Phone Number"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:226,columnNumber:23},void 0),he.jsxDEV("input",{type:"tel",id:"phone",name:"phone",value:X.phone,onChange:ee,className:"w-full px-3 py-2 border border-input rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50",required:!0},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:229,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:225,columnNumber:21},void 0),he.jsxDEV("div",{children:[he.jsxDEV("label",{className:"block text-sm font-medium mb-2",children:"Emergency Skills"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:241,columnNumber:23},void 0),he.jsxDEV("div",{className:"grid grid-cols-2 gap-2",children:gA.map(le=>he.jsxDEV("div",{className:"flex items-center space-x-2",children:[he.jsxDEV("input",{type:"checkbox",id:le.id,name:le.id,checked:X.skills.includes(le.id),onChange:ee,className:"rounded text-primary focus:ring-primary"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:247,columnNumber:29},void 0),he.jsxDEV("label",{htmlFor:le.id,className:"text-sm",children:le.label},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:255,columnNumber:29},void 0)]},le.id,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:246,columnNumber:27},void 0))},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:244,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:240,columnNumber:21},void 0),he.jsxDEV("div",{className:"flex justify-end",children:he.jsxDEV("button",{type:"submit",disabled:T,className:"flex items-center bg-primary text-primary-foreground px-4 py-2 rounded-md hover:bg-primary/90 transition-colors disabled:opacity-70",children:T?"Saving...":he.jsxDEV(he.Fragment,{children:[he.jsxDEV(Sk,{size:18,className:"mr-2"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:273,columnNumber:29},void 0),"Save Changes"]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:272,columnNumber:27},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:264,columnNumber:23},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:263,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:209,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:208,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:200,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:195,columnNumber:13},void 0):he.jsxDEV("div",{className:"bg-card rounded-lg shadow-md overflow-hidden",children:[he.jsxDEV("div",{className:"p-4 border-b border-border",children:he.jsxDEV("h3",{className:"font-medium",children:"Response History"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:286,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:285,columnNumber:15},void 0),he.jsxDEV("div",{className:"p-4",children:y.responseHistory&&y.responseHistory.length>0?he.jsxDEV("div",{className:"divide-y divide-border",children:y.responseHistory.map((le,ke)=>he.jsxDEV("div",{className:"py-3 first:pt-0 last:pb-0",children:he.jsxDEV("div",{className:"flex items-center justify-between",children:[he.jsxDEV("div",{children:[he.jsxDEV("div",{className:"font-medium",children:["Emergency #",le.emergencyId]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:296,columnNumber:29},void 0),he.jsxDEV("div",{className:"text-sm text-muted-foreground mt-1",children:["Response time: ",le.responseTime?`${Math.round(le.responseTime/60)} minutes`:"N/A"]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:297,columnNumber:29},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:295,columnNumber:27},void 0),le.feedback&&he.jsxDEV("div",{className:"flex items-center",children:Array.from({length:5}).map((Re,Ue)=>he.jsxDEV("svg",{className:`h-4 w-4 ${Ue<le.feedback?"text-yellow-500":"text-muted"}`,fill:"currentColor",viewBox:"0 0 20 20",children:he.jsxDEV("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:312,columnNumber:35},void 0)},Ue,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:304,columnNumber:33},void 0))},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:302,columnNumber:29},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:294,columnNumber:25},void 0)},ke,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:293,columnNumber:23},void 0))},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:291,columnNumber:19},void 0):he.jsxDEV("div",{className:"text-center text-muted-foreground py-4",children:"You haven't responded to any emergencies yet."},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:322,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:289,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:284,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:193,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:99,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:96,columnNumber:5},void 0):he.jsxDEV("div",{className:"text-center p-8",children:[he.jsxDEV("div",{className:"animate-spin h-8 w-8 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:89,columnNumber:9},void 0),he.jsxDEV("p",{className:"text-muted-foreground",children:"Loading profile..."},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:90,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/Profile.jsx",lineNumber:88,columnNumber:7},void 0)},fz=()=>he.jsxDEV("div",{className:"min-h-[60vh] flex flex-col items-center justify-center",children:[he.jsxDEV(rb,{size:64,className:"text-muted-foreground mb-6"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/NotFound.jsx",lineNumber:8,columnNumber:7},void 0),he.jsxDEV("h1",{className:"text-3xl font-bold mb-2",children:"Page Not Found"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/NotFound.jsx",lineNumber:9,columnNumber:7},void 0),he.jsxDEV("p",{className:"text-muted-foreground mb-6",children:"The page you're looking for doesn't exist or has been moved."},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/NotFound.jsx",lineNumber:10,columnNumber:7},void 0),he.jsxDEV(cb,{to:"/",className:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors",children:"Return to Dashboard"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/NotFound.jsx",lineNumber:13,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/pages/NotFound.jsx",lineNumber:7,columnNumber:5},void 0),_A=()=>{const g=Up(),y=Cg(),[T,k]=Fe.useState(!1),L=Fe.useRef(null),{notifications:$,unreadCount:X}=Ba(ge=>ge.notification);Fe.useEffect(()=>{const ge=le=>{L.current&&!L.current.contains(le.target)&&k(!1)};return document.addEventListener("mousedown",ge),()=>{document.removeEventListener("mousedown",ge)}},[]);const a=()=>{k(!T)},ee=()=>{g(HD())},se=ge=>{ge.status!=="read"&&g(qD(ge._id)),ge.emergencyId&&y(`/emergency/${ge.emergencyId}`),k(!1)},fe=ge=>{const le=new Date(ge),Re=Math.floor((new Date-le)/1e3);if(Re<60)return"just now";const Ue=Math.floor(Re/60);if(Ue<60)return`${Ue}m ago`;const Pe=Math.floor(Ue/60);if(Pe<24)return`${Pe}h ago`;const We=Math.floor(Pe/24);return We<7?`${We}d ago`:le.toLocaleDateString()};return he.jsxDEV("div",{className:"relative",ref:L,children:[he.jsxDEV("button",{onClick:a,className:"relative p-2 rounded-full bg-muted text-foreground hover:bg-muted-foreground/20",children:[he.jsxDEV(tk,{size:18},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/NotificationDropdown.jsx",lineNumber:87,columnNumber:9},void 0),X>0&&he.jsxDEV("span",{className:"absolute -top-1 -right-1 bg-destructive text-destructive-foreground text-xs rounded-full h-5 w-5 flex items-center justify-center",children:X>9?"9+":X},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/NotificationDropdown.jsx",lineNumber:89,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/NotificationDropdown.jsx",lineNumber:83,columnNumber:7},void 0),T&&he.jsxDEV("div",{className:"absolute right-0 mt-2 w-80 bg-background border border-border rounded-md shadow-lg z-10",children:[he.jsxDEV("div",{className:"p-3 border-b border-border flex justify-between items-center",children:[he.jsxDEV("h3",{className:"font-medium",children:"Notifications"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/NotificationDropdown.jsx",lineNumber:98,columnNumber:13},void 0),$.length>0&&he.jsxDEV("button",{onClick:ee,className:"text-sm text-primary hover:text-primary/80",children:"Mark all as read"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/NotificationDropdown.jsx",lineNumber:100,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/NotificationDropdown.jsx",lineNumber:97,columnNumber:11},void 0),he.jsxDEV("div",{className:"max-h-80 overflow-y-auto",children:$.length===0?he.jsxDEV("div",{className:"p-4 text-center text-muted-foreground",children:"No notifications"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/NotificationDropdown.jsx",lineNumber:111,columnNumber:15},void 0):he.jsxDEV("div",{children:$.map(ge=>he.jsxDEV("div",{onClick:()=>se(ge),className:`p-3 border-b border-border cursor-pointer hover:bg-muted transition-colors ${ge.type==="sos_alert"?"bg-destructive/10 border-l-4 border-l-destructive":ge.status!=="read"?"bg-primary/5":""}`,children:[he.jsxDEV("div",{className:`font-medium text-sm ${ge.type==="sos_alert"?"text-destructive":""}`,children:[ge.type==="sos_alert"&&"🆘 ",ge.title]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/NotificationDropdown.jsx",lineNumber:128,columnNumber:21},void 0),he.jsxDEV("div",{className:`text-sm mt-1 ${ge.type==="sos_alert"?"text-destructive/90 font-medium":"text-muted-foreground"}`,children:ge.message},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/NotificationDropdown.jsx",lineNumber:132,columnNumber:21},void 0),he.jsxDEV("div",{className:"text-xs text-muted-foreground mt-1",children:fe(ge.createdAt)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/NotificationDropdown.jsx",lineNumber:135,columnNumber:21},void 0)]},ge._id,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/NotificationDropdown.jsx",lineNumber:117,columnNumber:19},void 0))},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/NotificationDropdown.jsx",lineNumber:115,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/NotificationDropdown.jsx",lineNumber:109,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/NotificationDropdown.jsx",lineNumber:96,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/components/NotificationDropdown.jsx",lineNumber:82,columnNumber:5},void 0)},pz=()=>{const g=Up(),y=Cg();Fp();const[T,k]=Fe.useState(!1),{profile:L}=Ba(ee=>ee.user),{unreadCount:$}=Ba(ee=>ee.notification);Fe.useEffect(()=>{if(g(xw()),navigator.geolocation){navigator.geolocation.getCurrentPosition(se=>{const{longitude:fe,latitude:ge}=se.coords;g(Qx({longitude:fe,latitude:ge}))},se=>{console.error("Error getting location:",se)});const ee=navigator.geolocation.watchPosition(se=>{const{longitude:fe,latitude:ge}=se.coords;g(Qx({longitude:fe,latitude:ge}))},se=>{console.error("Error watching location:",se)},{enableHighAccuracy:!0});return()=>{navigator.geolocation.clearWatch(ee)}}},[g]);const X=()=>{g(LD()),y("/login")},a=()=>{k(!T)};return he.jsxDEV("div",{className:"min-h-screen flex flex-col bg-background",children:[he.jsxDEV("header",{className:"border-b border-border bg-background",children:he.jsxDEV("div",{className:"container mx-auto px-4 py-3 flex items-center justify-between",children:[he.jsxDEV("div",{className:"flex items-center",children:he.jsxDEV("h1",{className:"text-xl font-bold text-primary",children:"RapidReach"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:71,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:70,columnNumber:11},void 0),he.jsxDEV("div",{className:"flex items-center space-x-2 md:hidden",children:[he.jsxDEV(_A,{},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:75,columnNumber:13},void 0),he.jsxDEV("button",{onClick:a,className:"p-2 text-foreground",children:T?he.jsxDEV(zw,{size:24},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:77,columnNumber:33},void 0):he.jsxDEV(gk,{size:24},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:77,columnNumber:51},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:76,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:74,columnNumber:11},void 0),he.jsxDEV("nav",{className:"hidden md:flex items-center space-x-4",children:[he.jsxDEV(ay,{to:"/",className:({isActive:ee})=>`flex items-center px-3 py-2 rounded-md ${ee?"bg-primary/10 text-primary font-medium":"text-foreground hover:bg-muted"}`,children:[he.jsxDEV(ME,{size:18,className:"mr-2"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:92,columnNumber:15},void 0),he.jsxDEV("span",{children:"Dashboard"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:93,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:82,columnNumber:13},void 0),he.jsxDEV(ay,{to:"/report",className:({isActive:ee})=>`flex items-center px-3 py-2 rounded-md ${ee?"bg-primary/10 text-primary font-medium":"text-foreground hover:bg-muted"}`,children:[he.jsxDEV(rb,{size:18,className:"mr-2"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:105,columnNumber:15},void 0),he.jsxDEV("span",{children:"Report"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:106,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:95,columnNumber:13},void 0),he.jsxDEV(ay,{to:"/profile",className:({isActive:ee})=>`flex items-center px-3 py-2 rounded-md ${ee?"bg-primary/10 text-primary font-medium":"text-foreground hover:bg-muted"}`,children:[he.jsxDEV(Sw,{size:18,className:"mr-2"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:118,columnNumber:15},void 0),he.jsxDEV("span",{children:"Profile"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:119,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:108,columnNumber:13},void 0),he.jsxDEV(_A,{},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:122,columnNumber:13},void 0),he.jsxDEV("button",{onClick:X,className:"flex items-center px-3 py-2 rounded-md text-foreground hover:bg-destructive/10 hover:text-destructive",children:[he.jsxDEV(RE,{size:18,className:"mr-2"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:128,columnNumber:15},void 0),he.jsxDEV("span",{children:"Logout"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:129,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:124,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:81,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:69,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:68,columnNumber:7},void 0),T&&he.jsxDEV("div",{className:"md:hidden bg-background border-b border-border",children:he.jsxDEV("nav",{className:"container mx-auto px-4 py-2 flex flex-col",children:[he.jsxDEV(ay,{to:"/",className:({isActive:ee})=>`flex items-center px-3 py-2 rounded-md ${ee?"bg-primary/10 text-primary font-medium":"text-foreground hover:bg-muted"}`,onClick:()=>k(!1),children:[he.jsxDEV(ME,{size:18,className:"mr-2"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:150,columnNumber:15},void 0),he.jsxDEV("span",{children:"Dashboard"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:151,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:139,columnNumber:13},void 0),he.jsxDEV(ay,{to:"/report",className:({isActive:ee})=>`flex items-center px-3 py-2 rounded-md ${ee?"bg-primary/10 text-primary font-medium":"text-foreground hover:bg-muted"}`,onClick:()=>k(!1),children:[he.jsxDEV(rb,{size:18,className:"mr-2"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:164,columnNumber:15},void 0),he.jsxDEV("span",{children:"Report"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:165,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:153,columnNumber:13},void 0),he.jsxDEV(ay,{to:"/profile",className:({isActive:ee})=>`flex items-center px-3 py-2 rounded-md ${ee?"bg-primary/10 text-primary font-medium":"text-foreground hover:bg-muted"}`,onClick:()=>k(!1),children:[he.jsxDEV(Sw,{size:18,className:"mr-2"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:178,columnNumber:15},void 0),he.jsxDEV("span",{children:"Profile"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:179,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:167,columnNumber:13},void 0),he.jsxDEV("button",{onClick:X,className:"flex items-center px-3 py-2 rounded-md text-foreground hover:bg-destructive/10 hover:text-destructive",children:[he.jsxDEV(RE,{size:18,className:"mr-2"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:185,columnNumber:15},void 0),he.jsxDEV("span",{children:"Logout"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:186,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:181,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:138,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:137,columnNumber:9},void 0),he.jsxDEV("main",{className:"flex-1 container mx-auto px-4 py-6",children:he.jsxDEV(MA,{},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:194,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:193,columnNumber:7},void 0),he.jsxDEV("footer",{className:"border-t border-border bg-background py-4",children:he.jsxDEV("div",{className:"container mx-auto px-4 text-center text-muted-foreground text-sm",children:["© ",new Date().getFullYear()," RapidReach. All rights reserved."]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:199,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:198,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AppLayout.jsx",lineNumber:66,columnNumber:5},void 0)},mz=()=>{const{isAuthenticated:g}=Ba(y=>y.auth);return g?he.jsxDEV(DA,{to:"/"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AuthLayout.jsx",lineNumber:10,columnNumber:12},void 0):he.jsxDEV("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-primary/10 to-accent/10",children:he.jsxDEV("div",{className:"w-full max-w-md p-6 bg-background border border-border rounded-lg shadow-lg",children:[he.jsxDEV("div",{className:"mb-8 text-center",children:[he.jsxDEV("h1",{className:"text-3xl font-bold text-primary",children:"RapidReach"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AuthLayout.jsx",lineNumber:17,columnNumber:11},void 0),he.jsxDEV("p",{className:"text-muted-foreground",children:"Emergency Response System"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AuthLayout.jsx",lineNumber:18,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AuthLayout.jsx",lineNumber:16,columnNumber:9},void 0),he.jsxDEV(MA,{},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AuthLayout.jsx",lineNumber:20,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AuthLayout.jsx",lineNumber:15,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/layouts/AuthLayout.jsx",lineNumber:14,columnNumber:5},void 0)};function gz(){const g=Up(),{isAuthenticated:y}=Ba(T=>T.auth);return Fe.useEffect(()=>{if(y){g(cw());const T=Rw();window.socket=T}else CT(),window.socket=null;return()=>{CT(),window.socket=null}},[y,g]),he.jsxDEV(he.Fragment,{children:[he.jsxDEV(eR,{children:[he.jsxDEV(af,{element:he.jsxDEV(mz,{},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/App.jsx",lineNumber:48,columnNumber:25},this),children:[he.jsxDEV(af,{path:"/login",element:he.jsxDEV(JN,{},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/App.jsx",lineNumber:49,columnNumber:41},this)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/App.jsx",lineNumber:49,columnNumber:11},this),he.jsxDEV(af,{path:"/register",element:he.jsxDEV(ez,{},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/App.jsx",lineNumber:50,columnNumber:44},this)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/App.jsx",lineNumber:50,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/App.jsx",lineNumber:48,columnNumber:9},this),he.jsxDEV(af,{element:y?he.jsxDEV(pz,{},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/App.jsx",lineNumber:56,columnNumber:31},this):he.jsxDEV(DA,{to:"/login"},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/App.jsx",lineNumber:56,columnNumber:47},this),children:[he.jsxDEV(af,{path:"/",element:he.jsxDEV(az,{},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/App.jsx",lineNumber:59,columnNumber:36},this)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/App.jsx",lineNumber:59,columnNumber:11},this),he.jsxDEV(af,{path:"/report",element:he.jsxDEV(uz,{},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/App.jsx",lineNumber:60,columnNumber:42},this)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/App.jsx",lineNumber:60,columnNumber:11},this),he.jsxDEV(af,{path:"/emergency/:id",element:he.jsxDEV(dz,{},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/App.jsx",lineNumber:61,columnNumber:49},this)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/App.jsx",lineNumber:61,columnNumber:11},this),he.jsxDEV(af,{path:"/profile",element:he.jsxDEV(hz,{},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/App.jsx",lineNumber:62,columnNumber:43},this)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/App.jsx",lineNumber:62,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/App.jsx",lineNumber:54,columnNumber:9},this),he.jsxDEV(af,{path:"*",element:he.jsxDEV(fz,{},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/App.jsx",lineNumber:66,columnNumber:34},this)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/App.jsx",lineNumber:66,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/App.jsx",lineNumber:46,columnNumber:7},this),he.jsxDEV(gO,{},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/App.jsx",lineNumber:69,columnNumber:7},this)]},void 0,!0,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/App.jsx",lineNumber:45,columnNumber:5},this)}aM.createRoot(document.getElementById("root")).render(he.jsxDEV(Np.StrictMode,{children:he.jsxDEV(YR,{store:Sg,children:he.jsxDEV(TR,{children:he.jsxDEV(gz,{},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/main.jsx",lineNumber:14,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/main.jsx",lineNumber:13,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/main.jsx",lineNumber:12,columnNumber:5},void 0)},void 0,!1,{fileName:"C:/Users/Sky/Desktop/SOS/rapid-reach/frontend/src/main.jsx",lineNumber:11,columnNumber:3},void 0));
